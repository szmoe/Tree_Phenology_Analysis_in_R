<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="SM">
<meta name="dcterms.date" content="2025-03-04">
<title>Tree Phenology Analysis with R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="Tree_Phenology_Analysis_in_R_Logbook_files/libs/clipboard/clipboard.min.js"></script>
<script src="Tree_Phenology_Analysis_in_R_Logbook_files/libs/quarto-html/quarto.js"></script>
<script src="Tree_Phenology_Analysis_in_R_Logbook_files/libs/quarto-html/popper.min.js"></script>
<script src="Tree_Phenology_Analysis_in_R_Logbook_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Tree_Phenology_Analysis_in_R_Logbook_files/libs/quarto-html/anchor.min.js"></script>
<link href="Tree_Phenology_Analysis_in_R_Logbook_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Tree_Phenology_Analysis_in_R_Logbook_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Tree_Phenology_Analysis_in_R_Logbook_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Tree_Phenology_Analysis_in_R_Logbook_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Tree_Phenology_Analysis_in_R_Logbook_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><style>html{ scroll-behavior: smooth; }</style>
<script src="Tree_Phenology_Analysis_in_R_Logbook_files/libs/kePrint-0.0.1/kePrint.js"></script><link href="Tree_Phenology_Analysis_in_R_Logbook_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Contents</h2>
   
  <ul>
<li>
<a href="#chapter-3-tree-dormancy" id="toc-chapter-3-tree-dormancy" class="nav-link active" data-scroll-target="#chapter-3-tree-dormancy">Chapter 3: Tree Dormancy</a>
  <ul>
<li><a href="#introduction-to-dormancy" id="toc-introduction-to-dormancy" class="nav-link" data-scroll-target="#introduction-to-dormancy"><span style="color:#71797E">3.1</span>&nbsp; Introduction to dormancy</a></li>
  <li><a href="#dormancy-physiology" id="toc-dormancy-physiology" class="nav-link" data-scroll-target="#dormancy-physiology"><span style="color:#71797E">3.2</span>&nbsp; Dormancy physiology</a></li>
  <li><a href="#experimental-and-statistical-determination-of-the-chilling-and-forcing-periods" id="toc-experimental-and-statistical-determination-of-the-chilling-and-forcing-periods" class="nav-link" data-scroll-target="#experimental-and-statistical-determination-of-the-chilling-and-forcing-periods"><span style="color:#71797E">3.3</span>&nbsp; Experimental and statistical determination of the chilling and forcing periods</a></li>
  <li><a href="#phenology-record-and-bbch-scale" id="toc-phenology-record-and-bbch-scale" class="nav-link" data-scroll-target="#phenology-record-and-bbch-scale"><span style="color:#71797E">3.4</span>&nbsp; Phenology record and BBCH scale</a></li>
  <li><a href="#exercises-on-tree-dormancy" id="toc-exercises-on-tree-dormancy" class="nav-link" data-scroll-target="#exercises-on-tree-dormancy"><span style="color:#71797E">3.5</span>&nbsp; Exercises on tree dormancy</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-4-climate-change-and-impact-projection" id="toc-chapter-4-climate-change-and-impact-projection" class="nav-link" data-scroll-target="#chapter-4-climate-change-and-impact-projection">Chapter 4: Climate change and impact projection</a>
  <ul>
<li><a href="#the-drivers-of-climate-change" id="toc-the-drivers-of-climate-change" class="nav-link" data-scroll-target="#the-drivers-of-climate-change"><span style="color:#71797E">4.1</span>&nbsp; The drivers of climate change</a></li>
  <li><a href="#what-weve-already-seen" id="toc-what-weve-already-seen" class="nav-link" data-scroll-target="#what-weve-already-seen"><span style="color:#71797E">4.2</span>&nbsp; What we’ve already seen</a></li>
  <li><a href="#future-scenarios" id="toc-future-scenarios" class="nav-link" data-scroll-target="#future-scenarios"><span style="color:#71797E">4.3</span>&nbsp; Future scenarios</a></li>
  <li><a href="#impact-projection-approaches" id="toc-impact-projection-approaches" class="nav-link" data-scroll-target="#impact-projection-approaches"><span style="color:#71797E">4.4</span>&nbsp; Impact projection approaches</a></li>
  <li><a href="#exercises-on-climate-change" id="toc-exercises-on-climate-change" class="nav-link" data-scroll-target="#exercises-on-climate-change"><span style="color:#71797E">4.5</span>&nbsp; Exercises on climate change</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-5-winter-chill-projections" id="toc-chapter-5-winter-chill-projections" class="nav-link" data-scroll-target="#chapter-5-winter-chill-projections">Chapter 5: Winter chill projections</a>
  <ul>
<li>
<a href="#winter-chill-projections" id="toc-winter-chill-projections" class="nav-link" data-scroll-target="#winter-chill-projections"><span style="color:#71797E">5.1</span>&nbsp; Winter chill projections</a>
  <ul>
<li><a href="#winter-chill-in-oman" id="toc-winter-chill-in-oman" class="nav-link" data-scroll-target="#winter-chill-in-oman"><span style="color:#71797E">5.1.1</span>&nbsp; Winter chill in Oman</a></li>
  <li><a href="#chill-model-sensitivity" id="toc-chill-model-sensitivity" class="nav-link" data-scroll-target="#chill-model-sensitivity"><span style="color:#71797E">5.1.2</span>&nbsp; Chill model sensitivity</a></li>
  <li><a href="#winter-chill-in-california" id="toc-winter-chill-in-california" class="nav-link" data-scroll-target="#winter-chill-in-california"><span style="color:#71797E">5.1.3</span>&nbsp; Winter chill in California</a></li>
  <li><a href="#winter-chill-ratios" id="toc-winter-chill-ratios" class="nav-link" data-scroll-target="#winter-chill-ratios"><span style="color:#71797E">5.1.4</span>&nbsp; Winter chill ratios</a></li>
  <li><a href="#a-global-pojection-of-future-winter-chill" id="toc-a-global-pojection-of-future-winter-chill" class="nav-link" data-scroll-target="#a-global-pojection-of-future-winter-chill"><span style="color:#71797E">5.1.5</span>&nbsp; A global pojection of future winter chill</a></li>
  <li><a href="#winter-chill-in-germany" id="toc-winter-chill-in-germany" class="nav-link" data-scroll-target="#winter-chill-in-germany"><span style="color:#71797E">5.1.6</span>&nbsp; Winter chill in Germany</a></li>
  <li><a href="#winter-chill-in-tunisia" id="toc-winter-chill-in-tunisia" class="nav-link" data-scroll-target="#winter-chill-in-tunisia"><span style="color:#71797E">5.1.7</span>&nbsp; Winter chill in Tunisia</a></li>
  <li><a href="#winter-chill-in-chile" id="toc-winter-chill-in-chile" class="nav-link" data-scroll-target="#winter-chill-in-chile"><span style="color:#71797E">5.1.8</span>&nbsp; Winter chill in Chile</a></li>
  <li><a href="#chill-projection-for-patagonia" id="toc-chill-projection-for-patagonia" class="nav-link" data-scroll-target="#chill-projection-for-patagonia"><span style="color:#71797E">5.1.9</span>&nbsp; Chill projection for Patagonia</a></li>
  <li><a href="#chill-model-comparison" id="toc-chill-model-comparison" class="nav-link" data-scroll-target="#chill-model-comparison"><span style="color:#71797E">5.1.10</span>&nbsp; Chill model comparison</a></li>
  <li><a href="#chill-projection-for-all-of-tunisia" id="toc-chill-projection-for-all-of-tunisia" class="nav-link" data-scroll-target="#chill-projection-for-all-of-tunisia"><span style="color:#71797E">5.1.11</span>&nbsp; Chill projection for all of Tunisia</a></li>
  <li><a href="#revisiting-chill-accumulation-in-oman" id="toc-revisiting-chill-accumulation-in-oman" class="nav-link" data-scroll-target="#revisiting-chill-accumulation-in-oman"><span style="color:#71797E">5.1.12</span>&nbsp; Revisiting chill accumulation in Oman</a></li>
  </ul>
</li>
  <li><a href="#exercises-on-past-chill-projections" id="toc-exercises-on-past-chill-projections" class="nav-link" data-scroll-target="#exercises-on-past-chill-projections"><span style="color:#71797E">5.2</span>&nbsp; Exercises on past chill projections</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-6-manual-chill-analysis" id="toc-chapter-6-manual-chill-analysis" class="nav-link" data-scroll-target="#chapter-6-manual-chill-analysis">Chapter 6: Manual chill analysis</a>
  <ul>
<li>
<a href="#computing-chilling-hours-from-hourly-temperature-data" id="toc-computing-chilling-hours-from-hourly-temperature-data" class="nav-link" data-scroll-target="#computing-chilling-hours-from-hourly-temperature-data"><span style="color:#71797E">6.1</span>&nbsp; Computing Chilling Hours from hourly temperature data</a>
  <ul>
<li><a href="#display-the-winters_hours_gaps-dataset-in-chillr-using-kable" id="toc-display-the-winters_hours_gaps-dataset-in-chillr-using-kable" class="nav-link" data-scroll-target="#display-the-winters_hours_gaps-dataset-in-chillr-using-kable"><em>Display the <code>Winters_hours_gaps</code> dataset in <code>chillR</code> using <code>kable</code></em></a></li>
  <li><a href="#remove-column-temp_gaps-and-create-a-new-dataset-hourtemps" id="toc-remove-column-temp_gaps-and-create-a-new-dataset-hourtemps" class="nav-link" data-scroll-target="#remove-column-temp_gaps-and-create-a-new-dataset-hourtemps"><em>Remove column <code>Temp_gaps</code> and create a new dataset (<code>hourtemps</code>)</em></a></li>
  <li><a href="#display-only-the-third-row-with-all-columns" id="toc-display-only-the-third-row-with-all-columns" class="nav-link" data-scroll-target="#display-only-the-third-row-with-all-columns"><em>Display only the third row with all columns</em></a></li>
  <li><a href="#display-the-temp-column-of-the-third-row-only" id="toc-display-the-temp-column-of-the-third-row-only" class="nav-link" data-scroll-target="#display-the-temp-column-of-the-third-row-only"><em>Display the <code>Temp</code> column of the third row only</em></a></li>
  <li><a href="#display-the-first-five-rows-of-temp-column" id="toc-display-the-first-five-rows-of-temp-column" class="nav-link" data-scroll-target="#display-the-first-five-rows-of-temp-column"><em>Display the first five rows of <code>Temp</code> column</em></a></li>
  <li><a href="#display-the-first-five-rows-and-all-columns-of-hourtemps-dataset" id="toc-display-the-first-five-rows-and-all-columns-of-hourtemps-dataset" class="nav-link" data-scroll-target="#display-the-first-five-rows-and-all-columns-of-hourtemps-dataset"><em>Display the first five rows and all columns of <code>hourtemps</code> dataset</em></a></li>
  <li>
<a href="#check-for-temperatures-that-fall-within-chilling-hours-range" id="toc-check-for-temperatures-that-fall-within-chilling-hours-range" class="nav-link" data-scroll-target="#check-for-temperatures-that-fall-within-chilling-hours-range"><em>Check for temperatures that fall within <code>Chilling Hours</code> range</em></a>
  <ul>
<li><a href="#using-simple-comparison-commands" id="toc-using-simple-comparison-commands" class="nav-link" data-scroll-target="#using-simple-comparison-commands"><em>Using simple comparison commands</em></a></li>
  <li><a href="#check-for-chilling-hours" id="toc-check-for-chilling-hours" class="nav-link" data-scroll-target="#check-for-chilling-hours"><em>Check for <code>Chilling Hours</code></em></a></li>
  </ul>
</li>
  </ul>
</li>
  <li><a href="#our-first-chill-function" id="toc-our-first-chill-function" class="nav-link" data-scroll-target="#our-first-chill-function"><span style="color:#71797E">6.2</span>&nbsp; Our first chill function</a></li>
  <li><a href="#exercise-on-basic-chill-modeling" id="toc-exercise-on-basic-chill-modeling" class="nav-link" data-scroll-target="#exercise-on-basic-chill-modeling"><span style="color:#71797E">6.3</span>&nbsp; Exercise on basic chill modeling</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-7-chill-models" id="toc-chapter-7-chill-models" class="nav-link" data-scroll-target="#chapter-7-chill-models">Chapter 7: Chill models</a>
  <ul>
<li>
<a href="#chill-models-in-chillr" id="toc-chill-models-in-chillr" class="nav-link" data-scroll-target="#chill-models-in-chillr"><span style="color:#71797E">7.1</span>&nbsp; Chill models in <code>chillR</code></a>
  <ul>
<li><a href="#chilling_hours-function" id="toc-chilling_hours-function" class="nav-link" data-scroll-target="#chilling_hours-function"><em><code>Chilling_Hours()</code> function</em></a></li>
  <li><a href="#the-utah-model" id="toc-the-utah-model" class="nav-link" data-scroll-target="#the-utah-model"><em>The Utah model</em></a></li>
  <li><a href="#the-dynamic-model" id="toc-the-dynamic-model" class="nav-link" data-scroll-target="#the-dynamic-model"><em>The dynamic model</em></a></li>
  <li><a href="#make_jday-and-tempresponse-functions" id="toc-make_jday-and-tempresponse-functions" class="nav-link" data-scroll-target="#make_jday-and-tempresponse-functions"><em><code>make_JDay()</code> and <code>tempResponse</code> functions</em></a></li>
  </ul>
</li>
  <li><a href="#exercise-on-chill-models" id="toc-exercise-on-chill-models" class="nav-link" data-scroll-target="#exercise-on-chill-models"><span style="color:#71797E">7.2</span>&nbsp; Exercise on chill models</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-8-making-hourly-temperatures" id="toc-chapter-8-making-hourly-temperatures" class="nav-link" data-scroll-target="#chapter-8-making-hourly-temperatures">Chapter 8: Making hourly temperatures</a>
  <ul>
<li>
<a href="#generating-hourly-temperatures" id="toc-generating-hourly-temperatures" class="nav-link" data-scroll-target="#generating-hourly-temperatures"><span style="color:#71797E">8.1</span>&nbsp; Generating hourly temperatures</a>
  <ul>
<li>
<a href="#idealized-daily-temperature-curves" id="toc-idealized-daily-temperature-curves" class="nav-link" data-scroll-target="#idealized-daily-temperature-curves"><span style="color:#71797E">8.1.1</span>&nbsp; Idealized daily temperature curves</a>
  <ul>
<li><a href="#calculate-hourly-temperatures" id="toc-calculate-hourly-temperatures" class="nav-link" data-scroll-target="#calculate-hourly-temperatures"><em>Calculate hourly temperatures</em></a></li>
  </ul>
</li>
  <li>
<a href="#empirical-daily-temperature-curves" id="toc-empirical-daily-temperature-curves" class="nav-link" data-scroll-target="#empirical-daily-temperature-curves"><span style="color:#71797E">8.1.2</span>&nbsp; Empirical daily temperature curves</a>
  <ul>
<li><a href="#make_all_day_table-function" id="toc-make_all_day_table-function" class="nav-link" data-scroll-target="#make_all_day_table-function"><em><code>make_all_day_table</code> function</em></a></li>
  </ul>
</li>
  </ul>
</li>
  <li><a href="#exercise-on-hourly-temperatures" id="toc-exercise-on-hourly-temperatures" class="nav-link" data-scroll-target="#exercise-on-hourly-temperatures"><span style="color:#71797E">8.2</span>&nbsp; Exercise on hourly temperatures</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-9-some-useful-tools-in-r" id="toc-chapter-9-some-useful-tools-in-r" class="nav-link" data-scroll-target="#chapter-9-some-useful-tools-in-r">Chapter 9: Some useful tools in R</a>
  <ul>
<li><a href="#an-evolving-language-and-a-lifelong-learning-process" id="toc-an-evolving-language-and-a-lifelong-learning-process" class="nav-link" data-scroll-target="#an-evolving-language-and-a-lifelong-learning-process"><span style="color:#71797E">9.1</span>&nbsp; An evolving language— and a lifelong learning process</a></li>
  <li><a href="#the-tidyverse" id="toc-the-tidyverse" class="nav-link" data-scroll-target="#the-tidyverse"><span style="color:#71797E">9.2</span>&nbsp; The <code>tidyverse</code></a></li>
  <li><a href="#the-ggplot2-package" id="toc-the-ggplot2-package" class="nav-link" data-scroll-target="#the-ggplot2-package"><span style="color:#71797E">9.3</span>&nbsp; The <code>ggplot2</code> package</a></li>
  <li><a href="#the-tibble-package" id="toc-the-tibble-package" class="nav-link" data-scroll-target="#the-tibble-package"><span style="color:#71797E">9.3</span>&nbsp; The <code>tibble</code> package</a></li>
  <li><a href="#the-magrittr-package-pipes" id="toc-the-magrittr-package-pipes" class="nav-link" data-scroll-target="#the-magrittr-package-pipes"><span style="color:#71797E">9.5</span>&nbsp; The <code>magrittr</code> package— pipes</a></li>
  <li>
<a href="#the-tidyr-package" id="toc-the-tidyr-package" class="nav-link" data-scroll-target="#the-tidyr-package"><span style="color:#71797E">9.6</span>&nbsp; The <code>tidyr</code> package</a>
  <ul>
<li><a href="#pivot_longer" id="toc-pivot_longer" class="nav-link" data-scroll-target="#pivot_longer"><span style="color:#71797E">9.6.1</span>&nbsp; <code>pivot_longer</code></a></li>
  <li><a href="#pivot_wider" id="toc-pivot_wider" class="nav-link" data-scroll-target="#pivot_wider"><span style="color:#71797E">9.6.2</span>&nbsp; <code>pivot_wider</code></a></li>
  <li><a href="#select" id="toc-select" class="nav-link" data-scroll-target="#select"><span style="color:#71797E">9.6.3</span>&nbsp; <code>select</code></a></li>
  <li><a href="#filter" id="toc-filter" class="nav-link" data-scroll-target="#filter"><span style="color:#71797E">9.6.4</span>&nbsp; <code>filter</code></a></li>
  <li><a href="#mutate" id="toc-mutate" class="nav-link" data-scroll-target="#mutate"><span style="color:#71797E">9.6.5</span>&nbsp; <code>mutate</code></a></li>
  <li><a href="#arrange" id="toc-arrange" class="nav-link" data-scroll-target="#arrange"><span style="color:#71797E">9.6.6</span>&nbsp; <code>arrange</code></a></li>
  </ul>
</li>
  <li>
<a href="#loops" id="toc-loops" class="nav-link" data-scroll-target="#loops"><span style="color:#71797E">9.7</span>&nbsp; Loops</a>
  <ul>
<li><a href="#for-loops" id="toc-for-loops" class="nav-link" data-scroll-target="#for-loops"><span style="color:#71797E">9.7.1</span>&nbsp; <code>for</code> loops</a></li>
  <li><a href="#while-loops" id="toc-while-loops" class="nav-link" data-scroll-target="#while-loops"><span style="color:#71797E">9.7.2</span>&nbsp; <code>while</code> loops</a></li>
  </ul>
</li>
  <li>
<a href="#apply-functions" id="toc-apply-functions" class="nav-link" data-scroll-target="#apply-functions"><span style="color:#71797E">9.8</span>&nbsp; <code>apply</code> functions</a>
  <ul>
<li><a href="#sapply" id="toc-sapply" class="nav-link" data-scroll-target="#sapply"><span style="color:#71797E">9.8.1</span>&nbsp; <code>sapply</code></a></li>
  <li><a href="#lapply" id="toc-lapply" class="nav-link" data-scroll-target="#lapply"><span style="color:#71797E">9.8.2</span>&nbsp; <code>lapply</code></a></li>
  <li><a href="#apply" id="toc-apply" class="nav-link" data-scroll-target="#apply"><span style="color:#71797E">9.8.3</span>&nbsp; <code>apply</code></a></li>
  </ul>
</li>
  <li><a href="#exercise-on-useful-r-tools" id="toc-exercise-on-useful-r-tools" class="nav-link" data-scroll-target="#exercise-on-useful-r-tools"><span style="color:#71797E">9.9</span>&nbsp; Exercise on useful R tools</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-10-getting-temperature-data" id="toc-chapter-10-getting-temperature-data" class="nav-link" data-scroll-target="#chapter-10-getting-temperature-data">Chapter 10: Getting temperature data</a>
  <ul>
<li><a href="#temperature-data-needs" id="toc-temperature-data-needs" class="nav-link" data-scroll-target="#temperature-data-needs"><span style="color:#71797E">10.1</span>&nbsp; Temperature data needs</a></li>
  <li>
<a href="#the-global-summary-of-the-day-database" id="toc-the-global-summary-of-the-day-database" class="nav-link" data-scroll-target="#the-global-summary-of-the-day-database"><span style="color:#71797E">10.2</span>&nbsp; The Global Summary of the Day database</a>
  <ul>
<li><a href="#actionlist_stations" id="toc-actionlist_stations" class="nav-link" data-scroll-target="#actionlist_stations"><span style="color:#71797E">10.2.1</span>&nbsp; <code>action=list_stations</code></a></li>
  <li><a href="#actiondownload_weather" id="toc-actiondownload_weather" class="nav-link" data-scroll-target="#actiondownload_weather"><span style="color:#71797E">10.2.2</span>&nbsp; <code>action="download_weather"</code></a></li>
  <li><a href="#downloaded-weather-as-action-argument" id="toc-downloaded-weather-as-action-argument" class="nav-link" data-scroll-target="#downloaded-weather-as-action-argument"><span style="color:#71797E">10.2.3</span>&nbsp; downloaded weather as <code>action</code> argument</a></li>
  </ul>
</li>
  <li><a href="#exercises-on-getting-temperature-data" id="toc-exercises-on-getting-temperature-data" class="nav-link" data-scroll-target="#exercises-on-getting-temperature-data"><span style="color:#71797E">10.3</span>&nbsp; Exercises on getting temperature data</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-11-filling-gaps-in-temperature-records" id="toc-chapter-11-filling-gaps-in-temperature-records" class="nav-link" data-scroll-target="#chapter-11-filling-gaps-in-temperature-records">Chapter 11: Filling gaps in temperature records</a>
  <ul>
<li><a href="#gaps" id="toc-gaps" class="nav-link" data-scroll-target="#gaps"><span style="color:#71797E">11.1</span>&nbsp; Gaps</a></li>
  <li><a href="#filling-short-gaps-in-daily-records" id="toc-filling-short-gaps-in-daily-records" class="nav-link" data-scroll-target="#filling-short-gaps-in-daily-records"><span style="color:#71797E">11.2</span>&nbsp; Filling short gaps in daily records</a></li>
  <li>
<a href="#filling-long-gaps-in-daily-records" id="toc-filling-long-gaps-in-daily-records" class="nav-link" data-scroll-target="#filling-long-gaps-in-daily-records"><span style="color:#71797E">11.3</span>&nbsp; Filling long gaps in daily records</a>
  <ul>
<li><a href="#bias-correction-for-shorter-intervals" id="toc-bias-correction-for-shorter-intervals" class="nav-link" data-scroll-target="#bias-correction-for-shorter-intervals"><span style="color:#71797E">11.3.1</span>&nbsp; Bias-correction for shorter intervals</a></li>
  <li><a href="#saving-the-data-for-later" id="toc-saving-the-data-for-later" class="nav-link" data-scroll-target="#saving-the-data-for-later"><span style="color:#71797E">11.3.2</span>&nbsp; Saving the data for later</a></li>
  </ul>
</li>
  <li>
<a href="#filling-gaps-in-hourly-records" id="toc-filling-gaps-in-hourly-records" class="nav-link" data-scroll-target="#filling-gaps-in-hourly-records"><span style="color:#71797E">11.4</span>&nbsp; Filling gaps in hourly records</a>
  <ul>
<li>
<a href="#accuracy-assessment" id="toc-accuracy-assessment" class="nav-link" data-scroll-target="#accuracy-assessment"><span style="color:#71797E">11.4.1</span>&nbsp; Accuracy assessment</a>
  <ul>
<li><a href="#root-mean-square-error-of-the-prediction-rmsep" id="toc-root-mean-square-error-of-the-prediction-rmsep" class="nav-link" data-scroll-target="#root-mean-square-error-of-the-prediction-rmsep"><em>Root Mean Square Error of the Prediction (RMSEP)</em></a></li>
  <li><a href="#residual-prediction-deviation-rpd" id="toc-residual-prediction-deviation-rpd" class="nav-link" data-scroll-target="#residual-prediction-deviation-rpd"><em>Residual Prediction Deviation (RPD)</em></a></li>
  <li><a href="#ratio-of-performance-to-interquartile-distance-rpiq" id="toc-ratio-of-performance-to-interquartile-distance-rpiq" class="nav-link" data-scroll-target="#ratio-of-performance-to-interquartile-distance-rpiq"><em>Ratio of Performance to InterQuartile distance (RPIQ)</em></a></li>
  </ul>
</li>
  <li><a href="#computing-agroclimatic-metrics" id="toc-computing-agroclimatic-metrics" class="nav-link" data-scroll-target="#computing-agroclimatic-metrics"><span style="color:#71797E">11.4.2</span>&nbsp; Computing agroclimatic metrics</a></li>
  </ul>
</li>
  <li><a href="#exercises-on-filling-gaps" id="toc-exercises-on-filling-gaps" class="nav-link" data-scroll-target="#exercises-on-filling-gaps"><span style="color:#71797E">11.5</span>&nbsp; Exercises on filling gaps</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-12-generating-temperature-scenarios" id="toc-chapter-12-generating-temperature-scenarios" class="nav-link" data-scroll-target="#chapter-12-generating-temperature-scenarios">Chapter 12: Generating temperature scenarios</a>
  <ul>
<li><a href="#chill-scenarios" id="toc-chill-scenarios" class="nav-link" data-scroll-target="#chill-scenarios"><span style="color:#71797E">12.1</span>&nbsp; Chill scenarios</a></li>
  <li><a href="#risk-assessment-in-orchard-planning" id="toc-risk-assessment-in-orchard-planning" class="nav-link" data-scroll-target="#risk-assessment-in-orchard-planning"><span style="color:#71797E">12.2</span>&nbsp; Risk assessment in orchard planning</a></li>
  <li><a href="#weather-generators" id="toc-weather-generators" class="nav-link" data-scroll-target="#weather-generators"><span style="color:#71797E">12.3</span>&nbsp; Weather generators</a></li>
  <li><a href="#weather-generation-in-chillr" id="toc-weather-generation-in-chillr" class="nav-link" data-scroll-target="#weather-generation-in-chillr"><span style="color:#71797E">12.4</span>&nbsp; Weather generation in <code>chillR</code></a></li>
  <li><a href="#exercises-on-temperature-generation" id="toc-exercises-on-temperature-generation" class="nav-link" data-scroll-target="#exercises-on-temperature-generation"><span style="color:#71797E">12.5</span>&nbsp; Exercises on temperature generation</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-13-saving-and-loading-data-and-hiding-this-in-markdown" id="toc-chapter-13-saving-and-loading-data-and-hiding-this-in-markdown" class="nav-link" data-scroll-target="#chapter-13-saving-and-loading-data-and-hiding-this-in-markdown">Chapter 13: Saving and loading data (and hiding this in markdown)</a>
  <ul>
<li><a href="#saving-and-loading-data" id="toc-saving-and-loading-data" class="nav-link" data-scroll-target="#saving-and-loading-data"><span style="color:#71797E">13.1</span>&nbsp; Saving and loading data</a></li>
  <li><a href="#hiding-all-this-from-the-readers-of-our-markdown-file" id="toc-hiding-all-this-from-the-readers-of-our-markdown-file" class="nav-link" data-scroll-target="#hiding-all-this-from-the-readers-of-our-markdown-file"><span style="color:#71797E">13.2</span>&nbsp; Hiding all this from the readers of our markdown file</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-14-historic-temperature-scenarios" id="toc-chapter-14-historic-temperature-scenarios" class="nav-link" data-scroll-target="#chapter-14-historic-temperature-scenarios">Chapter 14: Historic temperature scenarios</a>
  <ul>
<li><a href="#climate-change-scenarios" id="toc-climate-change-scenarios" class="nav-link" data-scroll-target="#climate-change-scenarios"><span style="color:#71797E">14.1</span>&nbsp; Climate change scenarios</a></li>
  <li><a href="#making-historic-temperature-scenarios" id="toc-making-historic-temperature-scenarios" class="nav-link" data-scroll-target="#making-historic-temperature-scenarios"><span style="color:#71797E">14.2</span>&nbsp; Making historic temperature scenarios</a></li>
  <li><a href="#exercises-on-generating-historic-temperature-scenarios" id="toc-exercises-on-generating-historic-temperature-scenarios" class="nav-link" data-scroll-target="#exercises-on-generating-historic-temperature-scenarios"><span style="color:#71797E">14.3</span>&nbsp; Exercises on generating historic temperature scenarios</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-15-future-temperature-scenarios" id="toc-chapter-15-future-temperature-scenarios" class="nav-link" data-scroll-target="#chapter-15-future-temperature-scenarios">Chapter 15: Future temperature scenarios</a>
  <ul>
<li><a href="#impacts-of-future-climate-change" id="toc-impacts-of-future-climate-change" class="nav-link" data-scroll-target="#impacts-of-future-climate-change"><span style="color:#71797E">15.1</span>&nbsp; Impacts of future climate change</a></li>
  <li>
<a href="#future-climate-scenarios" id="toc-future-climate-scenarios" class="nav-link" data-scroll-target="#future-climate-scenarios"><span style="color:#71797E">15.2</span>&nbsp; Future climate scenarios</a>
  <ul>
<li><a href="#some-background-on-climate-models-and-warming-pathways" id="toc-some-background-on-climate-models-and-warming-pathways" class="nav-link" data-scroll-target="#some-background-on-climate-models-and-warming-pathways"><span style="color:#71797E">15.2.1</span>&nbsp; Some background on climate models and warming pathways</a></li>
  </ul>
</li>
  <li><a href="#exercises-on-future-temperature-scenarios" id="toc-exercises-on-future-temperature-scenarios" class="nav-link" data-scroll-target="#exercises-on-future-temperature-scenarios"><span style="color:#71797E">15.3</span>&nbsp; Exercises on future temperature scenarios</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-16-making-cmip6-scenarios" id="toc-chapter-16-making-cmip6-scenarios" class="nav-link" data-scroll-target="#chapter-16-making-cmip6-scenarios">Chapter 16: Making CMIP6 scenarios</a>
  <ul>
<li>
<a href="#accessing-gridded-climate-data-from-the-copernicus-climate-data-store-data" id="toc-accessing-gridded-climate-data-from-the-copernicus-climate-data-store-data" class="nav-link" data-scroll-target="#accessing-gridded-climate-data-from-the-copernicus-climate-data-store-data"><span style="color:#71797E">16.1</span>&nbsp; Accessing gridded climate data from the Copernicus climate data store data</a>
  <ul>
<li><a href="#downloading-future-climate-data" id="toc-downloading-future-climate-data" class="nav-link" data-scroll-target="#downloading-future-climate-data"><span style="color:#71797E">16.1.1</span>&nbsp; Downloading future climate data</a></li>
  <li><a href="#generating-change-scenarios" id="toc-generating-change-scenarios" class="nav-link" data-scroll-target="#generating-change-scenarios"><span style="color:#71797E">16.1.2</span>&nbsp; Generating change scenarios</a></li>
  <li><a href="#extracting-data-from-the-grids" id="toc-extracting-data-from-the-grids" class="nav-link" data-scroll-target="#extracting-data-from-the-grids"><span style="color:#71797E">16.1.3</span>&nbsp; Extracting data from the grids</a></li>
  <li><a href="#baseline-adjustment" id="toc-baseline-adjustment" class="nav-link" data-scroll-target="#baseline-adjustment"><span style="color:#71797E">16.1.4</span>&nbsp; Baseline adjustment</a></li>
  </ul>
</li>
  <li><a href="#exercises-on-generating-cmip6-temperature-scenarios" id="toc-exercises-on-generating-cmip6-temperature-scenarios" class="nav-link" data-scroll-target="#exercises-on-generating-cmip6-temperature-scenarios"><span style="color:#71797E">16.2</span>&nbsp; Exercises on generating CMIP6 temperature scenarios</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-18-plotting-future-scenarios" id="toc-chapter-18-plotting-future-scenarios" class="nav-link" data-scroll-target="#chapter-18-plotting-future-scenarios">Chapter 18: Plotting future scenarios</a>
  <ul>
<li><a href="#making-attractive-plots" id="toc-making-attractive-plots" class="nav-link" data-scroll-target="#making-attractive-plots"><span style="color:#71797E">18.1</span>&nbsp; Making attractive plots</a></li>
  <li><a href="#the-results" id="toc-the-results" class="nav-link" data-scroll-target="#the-results"><span style="color:#71797E">18.2</span>&nbsp; The results</a></li>
  <li><a href="#exercises-on-plotting-future-projections" id="toc-exercises-on-plotting-future-projections" class="nav-link" data-scroll-target="#exercises-on-plotting-future-projections"><span style="color:#71797E">18.3</span>&nbsp; Exercises on plotting future projections</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-19-chill-model-comparison" id="toc-chapter-19-chill-model-comparison" class="nav-link" data-scroll-target="#chapter-19-chill-model-comparison">Chapter 19: Chill model comparison</a>
  <ul>
<li><a href="#safe-winter-chill" id="toc-safe-winter-chill" class="nav-link" data-scroll-target="#safe-winter-chill"><span style="color:#71797E">19.1</span>&nbsp; Safe Winter Chill</a></li>
  <li><a href="#chill-metrics" id="toc-chill-metrics" class="nav-link" data-scroll-target="#chill-metrics"><span style="color:#71797E">19.2</span>&nbsp; Chill metrics</a></li>
  <li><a href="#an-animated-plot-of-relative-changes-in-safe-winter-chill" id="toc-an-animated-plot-of-relative-changes-in-safe-winter-chill" class="nav-link" data-scroll-target="#an-animated-plot-of-relative-changes-in-safe-winter-chill"><span style="color:#71797E">19.3</span>&nbsp; An animated plot of relative changes in Safe Winter Chill</a></li>
  <li><a href="#exercises-on-chill-model-comparison" id="toc-exercises-on-chill-model-comparison" class="nav-link" data-scroll-target="#exercises-on-chill-model-comparison"><span style="color:#71797E">19.4</span>&nbsp; Exercises on chill model comparison</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-20-simple-phenology-analysis" id="toc-chapter-20-simple-phenology-analysis" class="nav-link" data-scroll-target="#chapter-20-simple-phenology-analysis">Chapter 20: Simple phenology analysis</a>
  <ul>
<li><a href="#phenology-analysis" id="toc-phenology-analysis" class="nav-link" data-scroll-target="#phenology-analysis"><span style="color:#71797E">20.1</span>&nbsp; Phenology analysis</a></li>
  <li><a href="#time-series-analysis" id="toc-time-series-analysis" class="nav-link" data-scroll-target="#time-series-analysis"><span style="color:#71797E">20.2</span>&nbsp; Time series analysis</a></li>
  <li><a href="#p-hacking" id="toc-p-hacking" class="nav-link" data-scroll-target="#p-hacking"><span style="color:#71797E">20.3</span>&nbsp; p-hacking</a></li>
  <li><a href="#the-process-that-generates-the-data" id="toc-the-process-that-generates-the-data" class="nav-link" data-scroll-target="#the-process-that-generates-the-data"><span style="color:#71797E">20.4</span>&nbsp; The process that generates the data</a></li>
  <li><a href="#an-ecological-theory-to-guide-our-analysis" id="toc-an-ecological-theory-to-guide-our-analysis" class="nav-link" data-scroll-target="#an-ecological-theory-to-guide-our-analysis"><span style="color:#71797E">20.5</span>&nbsp; An ecological theory to guide our analysis</a></li>
  <li><a href="#temperature-correlations" id="toc-temperature-correlations" class="nav-link" data-scroll-target="#temperature-correlations"><span style="color:#71797E">20.6</span>&nbsp; Temperature correlations</a></li>
  <li><a href="#exercises-on-simple-phenology-analysis" id="toc-exercises-on-simple-phenology-analysis" class="nav-link" data-scroll-target="#exercises-on-simple-phenology-analysis"><span style="color:#71797E">20.7</span>&nbsp; Exercises on simple phenology analysis</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-21-delineating-temperature-response-phases-with-pls-regression" id="toc-chapter-21-delineating-temperature-response-phases-with-pls-regression" class="nav-link" data-scroll-target="#chapter-21-delineating-temperature-response-phases-with-pls-regression">Chapter 21: Delineating temperature response phases with PLS regression</a>
  <ul>
<li><a href="#detecting-temperature-response-phases" id="toc-detecting-temperature-response-phases" class="nav-link" data-scroll-target="#detecting-temperature-response-phases"><span style="color:#71797E">21.1</span>&nbsp; Detecting temperature response phases</a></li>
  <li><a href="#finding-signals-in-hyperspectral-remote-sensing-data" id="toc-finding-signals-in-hyperspectral-remote-sensing-data" class="nav-link" data-scroll-target="#finding-signals-in-hyperspectral-remote-sensing-data"><span style="color:#71797E">21.2</span>&nbsp; Finding signals in hyperspectral remote sensing data</a></li>
  <li><a href="#pls-regression-for-phenology-analysis" id="toc-pls-regression-for-phenology-analysis" class="nav-link" data-scroll-target="#pls-regression-for-phenology-analysis"><span style="color:#71797E">21.3</span>&nbsp; PLS regression for phenology analysis</a></li>
  <li><a href="#a-note-of-caution-about-pls-results" id="toc-a-note-of-caution-about-pls-results" class="nav-link" data-scroll-target="#a-note-of-caution-about-pls-results"><span style="color:#71797E">21.4</span>&nbsp; A note of caution about PLS results</a></li>
  <li><a href="#pls-analysis-of-alexander-lucas-pears-in-klein-altendorf" id="toc-pls-analysis-of-alexander-lucas-pears-in-klein-altendorf" class="nav-link" data-scroll-target="#pls-analysis-of-alexander-lucas-pears-in-klein-altendorf"><span style="color:#71797E">21.5</span>&nbsp; PLS analysis of ‘Alexander Lucas’ pears in Klein-Altendorf</a></li>
  <li><a href="#exercises-on-chill-model-comparison-1" id="toc-exercises-on-chill-model-comparison-1" class="nav-link" data-scroll-target="#exercises-on-chill-model-comparison-1"><span style="color:#71797E">21.6</span>&nbsp; Exercises on chill model comparison</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-22-successes-and-limitations-of-pls-regression-analysis" id="toc-chapter-22-successes-and-limitations-of-pls-regression-analysis" class="nav-link" data-scroll-target="#chapter-22-successes-and-limitations-of-pls-regression-analysis">Chapter 22: Successes and limitations of PLS regression analysis</a>
  <ul>
<li><a href="#pls-regression" id="toc-pls-regression" class="nav-link" data-scroll-target="#pls-regression"><span style="color:#71797E">22.1</span>&nbsp; PLS regression</a></li>
  <li>
<a href="#pls-examples" id="toc-pls-examples" class="nav-link" data-scroll-target="#pls-examples"><span style="color:#71797E">22.2</span>&nbsp; PLS examples</a>
  <ul>
<li><a href="#grasslands-on-the-tibetan-plateau" id="toc-grasslands-on-the-tibetan-plateau" class="nav-link" data-scroll-target="#grasslands-on-the-tibetan-plateau"><span style="color:#71797E">22.2.1</span>&nbsp; Grasslands on the Tibetan Plateau</a></li>
  <li><a href="#deciduous-trees" id="toc-deciduous-trees" class="nav-link" data-scroll-target="#deciduous-trees"><span style="color:#71797E">22.2.2</span>&nbsp; Deciduous trees</a></li>
  <li><a href="#why-were-not-seeing-the-chilling-phase" id="toc-why-were-not-seeing-the-chilling-phase" class="nav-link" data-scroll-target="#why-were-not-seeing-the-chilling-phase"><span style="color:#71797E">22.2.3</span>&nbsp; Why we’re not seeing the chilling phase</a></li>
  </ul>
</li>
  <li><a href="#exercises-on-chill-model-comparison-2" id="toc-exercises-on-chill-model-comparison-2" class="nav-link" data-scroll-target="#exercises-on-chill-model-comparison-2"><span style="color:#71797E">22.3</span>&nbsp; Exercises on chill model comparison</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-23-pls-regression-with-agroclimatic-metrics" id="toc-chapter-23-pls-regression-with-agroclimatic-metrics" class="nav-link" data-scroll-target="#chapter-23-pls-regression-with-agroclimatic-metrics">Chapter 23: PLS regression with agroclimatic metrics</a>
  <ul>
<li><a href="#adjusting-pls-for-use-with-non-monotonic-relationships" id="toc-adjusting-pls-for-use-with-non-monotonic-relationships" class="nav-link" data-scroll-target="#adjusting-pls-for-use-with-non-monotonic-relationships"><span style="color:#71797E">23.1</span>&nbsp; Adjusting PLS for use with non-monotonic relationships</a></li>
  <li><a href="#pls-analysis-with-chilling-and-forcing-data" id="toc-pls-analysis-with-chilling-and-forcing-data" class="nav-link" data-scroll-target="#pls-analysis-with-chilling-and-forcing-data"><span style="color:#71797E">23.2</span>&nbsp; PLS analysis with chilling and forcing data</a></li>
  <li><a href="#delineating-chilling-and-forcing-periods" id="toc-delineating-chilling-and-forcing-periods" class="nav-link" data-scroll-target="#delineating-chilling-and-forcing-periods"><span style="color:#71797E">23.3</span>&nbsp; Delineating chilling and forcing periods</a></li>
  <li><a href="#ggplotting-the-results" id="toc-ggplotting-the-results" class="nav-link" data-scroll-target="#ggplotting-the-results"><span style="color:#71797E">23.4</span>&nbsp; <code>ggplot</code>ting the results</a></li>
  <li><a href="#exercises-on-chill-model-comparison-3" id="toc-exercises-on-chill-model-comparison-3" class="nav-link" data-scroll-target="#exercises-on-chill-model-comparison-3"><span style="color:#71797E">23.5</span>&nbsp; Exercises on chill model comparison</a></li>
  </ul>
</li>
  </ul></nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Tree Phenology Analysis with R</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead"><strong><em>A Learning Logbook</em></strong></p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>SM </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 4, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header><style>
    body { background-color:  #F0FFFF; }
    pre, pre:not([class]) { background-color: #d7f4f4; }
</style>
<p><br></p>
<p><strong><em>This document records my notes and progress in the course titled “Tree Phenology Analysis with R.”</em></strong></p>
<p><br></p>
<section id="chapter-3-tree-dormancy" class="level2"><h2 class="anchored" data-anchor-id="chapter-3-tree-dormancy">Chapter 3: Tree Dormancy</h2>
<section id="introduction-to-dormancy" class="level3"><h3 class="anchored" data-anchor-id="introduction-to-dormancy">
<span style="color:#71797E">3.1</span>&nbsp; Introduction to dormancy</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>Fruit trees go into dormant state to survive unfavorable conditions in winter</p></li>
<li>
<p>Dormancy phases:</p>
<ul>
<li>
<strong>Dormancy establishment</strong> (controlled by environmental signals— Day length/photoperiod, Temperature)</li>
<li>
<strong>Endo-dormancy</strong> (controlled by plants’ endogenous factors— their abilities to grow even in unfavorable conditions; a period of rest and then regrow/ endo-dormancy is overcome once the trees have experienced a certain level of chill but they don’t immediately resume growth)</li>
<li>
<strong>Eco-dormancy</strong> (trees are acclimated— no morphological changes, but not deeply dormant; (warm) temp is the main environmental driver)</li>
<li>
<strong>Growth resumption</strong> (first apparent morphological changes occur in end of winter or earliest spring depending on species and cultivars— trees quickly un-acclimatized to grow and become sensitive to freezing temperature before buds burst? Warm temp promotes growth)</li>
</ul>
</li>
</ul>
<ul>
<li>Physiological processes that regulate dormancy
<ul>
<li>
<strong>Transport at both whole-plant and cellular level:</strong> The transport of water and solutes stop during dormancy both at the whole plant and cellular levels within the meristems.</li>
<li>
<strong>Phytohormone dynamics:</strong> Plant hormones are short and long distance signalling compounds acting in a very low concentrations. Myoregulators for plants growth and development, as well as mediate responses to biotic and abiotic stressors.</li>
<li>
<strong>Genetic and epigenetic regulation:</strong> A group of genes related to dormancy— regulation of bad dormancy.</li>
<li>
<strong>Dynamics of nonstructural carbohydrates:</strong> Non-structural carbohydrates have three main functions‐ energy esterase?, transport and supply, and osmotic regulation and signaling (these varies within and between seasons).</li>
</ul>
</li>
</ul>
<p><br></p>
</section><section id="dormancy-physiology" class="level3"><h3 class="anchored" data-anchor-id="dormancy-physiology">
<span style="color:#71797E">3.2</span>&nbsp; Dormancy physiology</h3>
<div style="height: 18px;">

</div>
<p><img src="./pic/ch3_1.png" class="img-fluid"></p>
<p>Reference: <a href="https://www.mdpi.com/2073-4395/10/2/241"><em>A Conceptual Framework for Winter Dormancy in Deciduous Trees (Fadón et al., 2020)</em></a></p>
<p><br></p>
</section><section id="experimental-and-statistical-determination-of-the-chilling-and-forcing-periods" class="level3"><h3 class="anchored" data-anchor-id="experimental-and-statistical-determination-of-the-chilling-and-forcing-periods">
<span style="color:#71797E">3.3</span>&nbsp; Experimental and statistical determination of the chilling and forcing periods</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>High chill accumulation during endodormancy advances flowering dates, but similarly cool temperatures during ecodormancy may cause flowering delays.</p></li>
<li><p>Endo- and eco- dormancy occur under the same phenological stage, but the temperatures have the opposite effect on flowering according to the dormancy phase.</p></li>
<li>
<p>Endo- Vs. Eco- dormancy phase differentiation:</p>
<ul>
<li>
<strong>Empirically</strong> (See if there is growth after chilling period— whether the chill period is overcome to allow forcing period)</li>
<li>
<strong>Statistically</strong> (Long phenological data sets and temperature records— estimate the date of chilling fulfillment based on the long series of phenological observations, flowering dates and relating them with previous temperature records)</li>
</ul>
</li>
</ul>
<ul>
<li>
<code>chillR</code> package to perform PLS analysis with phenology data and temperature, which gives two outputs:
<ul>
<li>
<strong>Model coefficients</strong> which indicate the strength and the sense of the influence</li>
<li>
<strong>Variable important in the projections (VIP)</strong>, which points out the significant importance of the model coefficient values— values from 0.8 are considered significant??</li>
</ul>
</li>
</ul>
<p><br></p>
</section><section id="phenology-record-and-bbch-scale" class="level3"><h3 class="anchored" data-anchor-id="phenology-record-and-bbch-scale">
<span style="color:#71797E">3.4</span>&nbsp; Phenology record and BBCH scale</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p><strong>Phenology</strong> is the study of periodic events in <strong>biological life cycles</strong> (e.g.&nbsp;seasonal changes in trees) and how these are influenced <strong>by seasonal and interannual variations</strong> in climate.</p></li>
<li>
<p>Application of phenology in agriculture:</p>
<ul>
<li>Select suitable crops and varieties (to organize the cropping schedules, organize the crop rotation)</li>
<li>Forecasts of plant development and harvest dates (e.g.&nbsp;to evaluate the risk of frost damage)</li>
<li>Timing of the agricultural practices— irrigation, fertilization, crop protection, etc.</li>
</ul>
</li>
</ul>
<ul>
<li>
<p>Trees go through many developmental stages over the course of the year, and these are usually referred to by a two-digit code. <span style="color:grey"><em>(Read more <a href="https://www.openagrar.de/servlets/MCRFileNodeServlet/openagrar_derivate_00010428/BBCH-Skala_en.pdf">here.</a>)</em></span></p>
<ul>
<li>Principal growth stages— describe time spans (0-9)</li>
<li>Secondary growth stages— precise steps in plant development (0-9)</li>
</ul>
</li>
</ul>
<p><br></p>
</section><section id="exercises-on-tree-dormancy" class="level3"><h3 class="anchored" data-anchor-id="exercises-on-tree-dormancy">
<span style="color:#71797E">3.5</span>&nbsp; Exercises on tree dormancy</h3>
<div style="height: 18px;">

</div>
<p><strong><em>1. Put yourself in the place of a breeder who wants to calculate the temperature requirements of a newly released cultivar. Which method will you use to calculate the chilling and forcing periods? Please justify your answer.</em></strong></p>
<p>As a breeder, I will use the empirical method rather than the statistical method to calculate the chilling and forcing periods in this particular case, for two reasons:</p>
<ul>
<li><p>It requires little statistical expertise, as many breeders may not have in-depth statistical expertise, and hiring an expert could incur extra costs.</p></li>
<li><p>The statistical method relies on long phenological data sets and temperature records. Since this cultivar is newly released, such longitudinal data sets and records may not be available for statistical computation.</p></li>
</ul>
<p>Anyway, after I looked up the definition of plant breeder, they are scientists, so statistics may not be a problem. In that case, start with empirical first and then combine with statistical method as more data accumulates. 😁</p>
<p><br></p>
<p><strong><em>2. Which are the advantages (2) of the BBCH scale compared with earlier scales?</em></strong></p>
<ul>
<li><p>Covers the whole development of the plant, rather than development of only the flower buds as in the traditional scale</p></li>
<li><p>Provides a general frame for all the species, while the traditional scale is species specific</p></li>
</ul>
<p><br></p>
<p><strong><em>3. Classify the following phenological stages of sweet cherry according to the BBCH scale:</em></strong></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./pic/ch3_2.png" class="img-fluid figure-img"></p>
<figcaption><strong><em>Phenological stages of cherry</em></strong></figcaption></figure>
</div>
<p>From left to right:</p>
<ul>
<li><p>BBCH stage 54 (Inflorescence enclosed by light green scales)</p></li>
<li><p>BBCH stage 65 (Full flowering: at least 50% of flowers open, first petals falling)</p></li>
<li>
<p>BBCH stage 89 (Fruit ripe for harvesting for immediate consumption— fruit have typical taste and firmness)</p>
<ul>
<li><span style="color:grey"><em>I chose stage 89, rather than the fruit-picking stage 87, due to the cherries’ uniform and rich red color. However, further assessment of their firmness, taste, and aroma is required to accurately confirm the stage.</em></span></li>
</ul>
</li>
</ul>
<p><br></p>
</section></section><section id="chapter-4-climate-change-and-impact-projection" class="level2"><h2 class="anchored" data-anchor-id="chapter-4-climate-change-and-impact-projection">Chapter 4: Climate change and impact projection</h2>
<section id="the-drivers-of-climate-change" class="level3"><h3 class="anchored" data-anchor-id="the-drivers-of-climate-change">
<span style="color:#71797E">4.1</span>&nbsp; The drivers of climate change</h3>
<div style="height: 18px;">

</div>
<p>In this lecture, I learned about how the climate changes occurs, as well as the main and long-term drivers of climate change. I also learned about the impact of greenhouse gases on recent global warming— particularly CO<sub>2</sub>, CH<sub>4</sub> and N<sub>2</sub>O in the atmosphere.</p>
<p><br></p>
</section><section id="what-weve-already-seen" class="level3"><h3 class="anchored" data-anchor-id="what-weve-already-seen">
<span style="color:#71797E">4.2</span>&nbsp; What we’ve already seen</h3>
<div style="height: 18px;">

</div>
<p>This lecture taught me about the alarming increase in global temperatures in recent decades due to human activities, and how even a slight rise in temperature can cause significant shifts in the Earth’s land areas. The lecture also discussed these trends on a global scale, as well as specifically in Germany. Additionally, there was a brief discussion on precipitation trends in Germany.</p>
<p><br></p>
</section><section id="future-scenarios" class="level3"><h3 class="anchored" data-anchor-id="future-scenarios">
<span style="color:#71797E">4.3</span>&nbsp; Future scenarios</h3>
<div style="height: 18px;">

</div>
<p>I learned a lot about future climate projections and the process to make those projections (RCP, GCM, downscaling, etc) in this lecture. I also learned about the importance of impact models— even after we achieved perfect climate projections, there is a need for multiple impact models, as there will still be uncertainty about the biological responses and how we should describe them. There was also a nice discussion on how the changes in the ocean circulation and other tipping points can drive climate change. The lecture also emphasized the importance of being concerned about the future and taking action now to ensure future generations can experience the same world we live in.</p>
<p><br></p>
</section><section id="impact-projection-approaches" class="level3"><h3 class="anchored" data-anchor-id="impact-projection-approaches">
<span style="color:#71797E">4.4</span>&nbsp; Impact projection approaches</h3>
<div style="height: 18px;">

</div>
<p>I learned about different models in making predictions for the future. The lecture compares between the four climate project models, and discussed in details the advantages and the disadvantages of each. There is also a nice instruction on how we should build a model in the beginning— we may not want to go into detail for each aspect, but try to cover all aspects in a broader sense.</p>
<p><br></p>
</section><section id="exercises-on-climate-change" class="level3"><h3 class="anchored" data-anchor-id="exercises-on-climate-change">
<span style="color:#71797E">4.5</span>&nbsp; Exercises on climate change</h3>
<div style="height: 18px;">

</div>
<p><strong><em>1. List the main drivers of climate change at the decade to century scale, and briefly explain the mechanism through which the currently most important driver affects our climate.</em></strong></p>
<ul>
<li>Sun</li>
<li>Aerosols</li>
<li>Cloud</li>
<li>Ozone</li>
<li>Surface albedo</li>
<li>Greenhouse gases</li>
<li>Long-term drivers
<ul>
<li>Trends in solar activity</li>
<li>Ocean currents/ continent constellations</li>
<li>Plant vs.&nbsp;animals (Balance of CO<sub>2</sub> production and consumption)</li>
<li>Volcanic and meteroite activity</li>
<li>Milankovic cycles</li>
</ul>
</li>
</ul>
<p>The current most important driver that affects our climate is the rising concentrations of atmospheric greenhouse gases. Human activities, particularly the burning of fossil fuels, release CO<sub>2</sub> and other greenhouse gases into the atmosphere. These gases allow the passage of short-wave radiation from the sun, while absorbing the long-wave (infrared) radiation from the Earth. The absorbed infrared radiation is then re-emitted back to the atmosphere and the Earth’s surface. This greenhouse effect traps heat in the Earth’s atmosphere, causing the planet to warm.</p>
<p><br></p>
<p><strong><em>2. Explain briefly what is special about temperature dynamics of recent decades, and why we have good reasons to be concerned.</em></strong></p>
<p>Temperature dynamics of recent decades is special—or perhaps alarming—because global temperatures have been rising faster than ever before in human history. This phenomenon was illustrated by Prof.&nbsp;Micheal E. Mann in his book, titled “The Hockey Stick and the Climate Wars.”</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./pic/ch20_2.png" class="img-fluid figure-img"></p>
<figcaption><strong><em>An annotated hockey stick</em></strong></figcaption></figure>
</div>
<p>In the figure, we can clearly see there was little change in temperature in the earlier centuries, showing that nature had a way to balance without human intervention. However, the global temperature increased substantially by 1800s, coinciding with the widespread use of steam engines and industrial revolution. As human are the dominant species on Earth, there is no predator or natural forces that can counter the environmental impacts caused by human. This is evident by the continued rise in global temperature to this decade, such as the 8°C increase in Siberia’s surface temperature in 2020 compared to the 2003-2018 average.</p>
<p>This trend gives us good reasons to be concerned because if left unaddressed, global temperature changes caused by human activities can escalate exponentially. Without proper interventions, future generations may inherit a drastically different— and likey worse— Earth than the one we experience today.</p>
<p><br></p>
<p><strong><em>3. What does the abbreviation ‘RCP’ stand for, how are RCPs defined, and what is their role in projecting future climates?</em></strong></p>
<p>The abbreviation ‘RCP’ stands for the ‘Representative Concentration Pathways.’</p>
<p>RCPs are defined by the additional radiative forcing (Wm<sup>-2</sup>) expected by the end of the 21<sup>st</sup> century (year 2100), representing different levels of greenhouse gas emissions. In the IPCC’s Fifth Assessment Reports (AR5), the four main RCPs are defined as follows:</p>
<ul>
<li><p><strong>RCP2.6:</strong> Low-emission scenario (~2.6 Wm<sup>-2</sup>)</p></li>
<li><p><strong>RCP4.5:</strong> Intermediate scenario (~4.5 Wm<sup>-2</sup>)</p></li>
<li><p><strong>RCP6.0:</strong> Moderate-emission scenario (~6.0 Wm<sup>-2</sup>)</p></li>
<li><p><strong>RCP8.5:</strong> High-emission scenario (~8.5 Wm<sup>-2</sup>)</p></li>
</ul>
<p>RCPs are the climate scenarios fed into climate models. Hence, RCPs serve as inputs for the climate models to make projections of future temperature changes and weather patterns based on varying greenhouse gas emissions. These RCP-based scenarios also allow policymakers to assess different mitigation strategies to counter climate change by exploring different emission pathways and their impacts on the global climate.</p>
<p><br></p>
<p><strong><em>4. Briefly describe the 4 climate impact projection methods described in the fourth video.</em></strong></p>
<ul>
<li><p><strong>Statistical models:</strong> These models establish relationship between climate parameters and impact measure (e.g.&nbsp;corp yield), and are used to explain past trends and project future climate impacts. However, they have limitations such as overlooking important confounding factors and relying on past trends, which may lead to invalid projections if future climate conditions change significantly.</p></li>
<li><p><strong>Process-based models:</strong> Also known as mechanistic models, which aim to represent all major system processes through equations. These models try to capture best scientific knowledge of all processes, but the problem is processes are often not sufficiently understood. Hence, process-based models may omit many key defining factors. They can also be unrealistic for most complex systems, often requiring extensive parameterization or assumptions. Another limitation is that they may become valid over time due to non-linear changes in variables, and uncertainties are not always well represented.</p></li>
<li><p><strong>Species distribution models (SDMs):</strong>They are also known as ecological niche modeling, which establish relationship between different climatic parameters and presence or absence of data for either species or ecosystems. SDMs use these relationships to project future species distributions under changing climate conditions. Results can vary significantly between different algorithms, so ensemble modeling is often used to combine multiple models for more robust predictions.</p></li>
<li><p><strong>Climate analogue models:</strong>In these models, we identify locations with climates similar to those projected for the area of interest in the future. By examining the climate conditions at these analogue sites, we can get a glimpse potential future scenarios, which allow us to explore different adaptation strategies. However, there are limitations— analogue sites may differ from the baseline in important non-climatic factors, leading to confusion about whether observed differences are due to climate or other variables. Furthermore, climate data can be too limited or of poor quality to reliably apply these models— error estimates of these models are required as all impact projects are uncertain.</p></li>
</ul>
<p><br></p>
</section></section><section id="chapter-5-winter-chill-projections" class="level2"><h2 class="anchored" data-anchor-id="chapter-5-winter-chill-projections">Chapter 5: Winter chill projections</h2>
<section id="winter-chill-projections" class="level3"><h3 class="anchored" data-anchor-id="winter-chill-projections">
<span style="color:#71797E">5.1</span>&nbsp; Winter chill projections</h3>
<section id="winter-chill-in-oman" class="level4"><h4 class="anchored" data-anchor-id="winter-chill-in-oman">
<span style="color:#71797E">5.1.1</span>&nbsp; Winter chill in Oman</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>To calculate nutrient budgets for the oases in the Sultanate of Oman, by measuring the yields of the various fruit trees there</p></li>
<li><p>But, many of the trees in the oasis system did not produce fruits in the years of analysis</p></li>
<li><p>A hypothesis for that was “the lack of chilling,” due to most of the trees in these high-altitude oases were not the typical species of the Arabian Peninsula, but temperate trees</p></li>
<li><p>So, from focusing on nutrient budget to chilling hours</p></li>
<li>
<p>Chilling Hours model— this model can’t really be trusted, especially in a warm location</p>
<ul>
<li>Placed temperature loggers in three oases at different levels of elevation, which allowed studying chill accumulation along an elevation gradient (can’t collect meaningful data for a reasonable period of time )</li>
<li>So, obtain data from an official long-term weather station is located in the vicinity, near the top of the valley, roughly 1000 m above the lowest oasis— data not representative of all the locations along the elevation gradient</li>
<li>So, use the records from the oases to define transfer functions that allowed deriving oasis temperatures from long-term data</li>
<li>Set the transfer functions up (using PLS— not a good idea?) to directly calculate hourly temperatures in the oases from the daily records of the official station at Saiq</li>
<li>Regression between temperature at Saiq and temperature in three oases to calculate winter chill dynamics over the entire time span covered by the official weather station (Hourly data were needed to calculate the number of Chilling Hours)</li>
</ul>
</li>
</ul>
<ul>
<li>Weather generators to add future climate scenarios
<ul>
<li><em>Weather generators are tools that can produce random draws of plausible weather, based on observed weather for a particular location.</em></li>
<li>Fed the LARS-WG weather generator with the data (we had) for the highest-elevation oasis and told it to generate plausible weather for a number of years
<ul>
<li>Request the generator to produce the highest-elevation oasis and told it to generate plausible weather for a number of years</li>
<li>Result: Chill prospects for 1°C and 2°C warming scenarios</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><br></p>
</section><section id="chill-model-sensitivity" class="level4"><h4 class="anchored" data-anchor-id="chill-model-sensitivity">
<span style="color:#71797E">5.1.2</span>&nbsp; Chill model sensitivity</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>In projecting climate change impacts on winter chill in the Central Valley, one of the world’s most productive regions for temperate fruit trees, <strong>the choice of chill model matters a lot</strong></p></li>
<li>
<p>Created a bunch of temperature scenarios for multiple locations and calculated how chill accumulation was likely to change in the future, according to multiple chill models</p>
<ul>
<li>Looked at what changes the various models predicted for the same locations and the same future scenarios</li>
<li>The chill projection results varied considerably across the four models— <strong>strong indication that not all models can be right</strong>
</li>
<li>Based on the literature, as well as on another study <a href="https://www.sciencedirect.com/science/article/pii/S0168192309001580">(Luedeling et al., 2009d)</a>, Dynamic Model was concluded to be the most reliable one— used mostly in this course - But, the Dynamic model is too complicated (cumbersome, error-prone and boring)</li>
</ul>
</li>
</ul>
<p><br></p>
</section><section id="winter-chill-in-california" class="level4"><h4 class="anchored" data-anchor-id="winter-chill-in-california">
<span style="color:#71797E">5.1.3</span>&nbsp; Winter chill in California</h4>
<div style="height: 18px;">

</div>
<ul>
<li>To produce a winter chill projection for California’s fruit and nut growing region— the Central Valley
<ul>
<li>Multiple scenarios (20 or so) for records of all 100+ weather stations in California (automate processing steps)</li>
</ul>
</li>
</ul>
<ul>
<li><p>Result: produce projections for all stations, which consisted of chill accumulation over 100 plausible winter seasons per scenario, generated with a weather generator</p></li>
<li>
<p>Summarize the data by defining a metric called ‘Safe Winter Chill’.</p>
<ul>
<li>This is the 10th percentile of the chill distribution, i.e.&nbsp;the amount of chill that is exceeded in 90% of all years, derived from the ‘replicates’ of annual temperature dynamics produced by the weather generator</li>
<li>Economically, it may be feasible to grow a tree cultivar that requires this much chill.</li>
</ul>
</li>
</ul>
<ul>
<li>Source: <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0006166">(Luedeling et al.,2009d)</a>
</li>
</ul>
<p><br></p>
</section><section id="winter-chill-ratios" class="level4"><h4 class="anchored" data-anchor-id="winter-chill-ratios">
<span style="color:#71797E">5.1.4</span>&nbsp; Winter chill ratios</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>To produce a chill projection for the whole planet, using data from the Global Summary of the Day database</p></li>
<li><p>Processed data for about 5000 globally distributed weather stations, for which multiple chill metrics were calculated</p></li>
<li>
<p>To compare chill models, the ratio between various chill metrics was calculated for each weather station in the data set.</p>
<ul>
<li>Had these ratios been largely constant all over the planet (e.g.&nbsp;one Chill Portion always corresponds to 10 Chilling Hours), we would have been fairly safe using any of the chill models.</li>
<li>Unfortunately, this wasn’t the case, with enormous variation in chill metric ratios around the world.</li>
</ul>
</li>
</ul>
<ul>
<li>Source: <a href="https://link.springer.com/article/10.1007/s00484-010-0352-y">(Luedeling &amp; Brown, 2011a)</a>
</li>
</ul>
<p><br></p>
</section><section id="a-global-pojection-of-future-winter-chill" class="level4"><h4 class="anchored" data-anchor-id="a-global-pojection-of-future-winter-chill">
<span style="color:#71797E">5.1.5</span>&nbsp; A global pojection of future winter chill</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>Produce a global projection of the likely impacts of climate change on winter chill</p></li>
<li><p>Projected decline in winter chill— it seems unlikely that growers will remain able to grow the tree cultivars they currently rely on with such dramatic chill losses</p></li>
<li><p>Source: <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0020155">(Luedeling et al., 2011b)</a></p></li>
</ul>
<p><br></p>
</section><section id="winter-chill-in-germany" class="level4"><h4 class="anchored" data-anchor-id="winter-chill-in-germany">
<span style="color:#71797E">5.1.6</span>&nbsp; Winter chill in Germany</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>Germany is not highlighted as particularly vulnerable to chill losses.</p></li>
<li><p>The reason for this lack of major changes is that current winter temperatures in Germany are right in the middle of what appears to be the most effective temperature range for chill accumulation.</p></li>
<li><p>Source: <a href="https://link.springer.com/article/10.1007/s10341-009-0085-4">(Luedeling et al., 2009a)</a></p></li>
</ul>
<p><br></p>
</section><section id="winter-chill-in-tunisia" class="level4"><h4 class="anchored" data-anchor-id="winter-chill-in-tunisia">
<span style="color:#71797E">5.1.7</span>&nbsp; Winter chill in Tunisia</h4>
<div style="height: 18px;">

</div>
<ul>
<li>Models: SRES, GCMs, RCPs
<ul>
<li>The so-called SRES emissions scenarios (named after the IPCC Special Report on Emissions Scenarios), usually focusing on the three most commonly used scenarios B2, A1B and A2</li>
<li>‘General Circulation Models’ (GCMs; many people also use an alternative long form: ‘Global Climate Models’)</li>
<li>‘Representative Concentration Pathways’ (RCPs) to replace the SRES scenarios</li>
</ul>
</li>
</ul>
<ul>
<li><p>No way of deciding which of these models, if any, is right— should produce <em>ensemble</em> forecasts, i.e.&nbsp;project changes using outputs from all the available models (that are considered credible)</p></li>
<li>
<p>Produce chill distribution at a particular point in time using a weather generator that is accessed by <code>chillR</code>.</p>
<ul>
<li>This weather generator is calibrated with observed weather data and provided with an estimate of how various climate metrics differed from the long-term average climate in 1975, 2000 and 2015.</li>
<li>With this information, we can generate a large number of artificial yearly weather records that might have occurred at these points in time.</li>
</ul>
</li>
</ul>
<ul>
<li>The weather generator was also used to produce future scenarios.
<ul>
<li>In the case of Pistachios in Tunisia, the tool is calibrated with observed data, but the scenarios that were added were not derived from the historic record, but extracted from the AFRICLIM database.</li>
</ul>
</li>
</ul>
<p><br></p>
</section><section id="winter-chill-in-chile" class="level4"><h4 class="anchored" data-anchor-id="winter-chill-in-chile">
<span style="color:#71797E">5.1.8</span>&nbsp; Winter chill in Chile</h4>
<div style="height: 18px;">

</div>
<ul>
<li>A tool that could quickly access single-location data for weather stations anywhere on the planet: ClimateWizard</li>
</ul>
<p><br></p>
</section><section id="chill-projection-for-patagonia" class="level4"><h4 class="anchored" data-anchor-id="chill-projection-for-patagonia">
<span style="color:#71797E">5.1.9</span>&nbsp; Chill projection for Patagonia</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>Looked into the climatic suitability for fruit and nut trees near agriculture’s southern frontier - in Patagonia, in southern Argentina <a href="https://rmets.onlinelibrary.wiley.com/doi/pdf/10.1002/joc.6649">(del Barrio et al., 2020)</a>.</p></li>
<li>
<p>Used the weather station records to calibrate weather generator and downloaded climate projections from the ClimateWizard database.</p>
<ul>
<li>to make past and future temperature scenarios for all stations</li>
<li>to compute winter chill and a few other agroclimatic metrics</li>
</ul>
</li>
</ul>
<p><br></p>
</section><section id="chill-model-comparison" class="level4"><h4 class="anchored" data-anchor-id="chill-model-comparison">
<span style="color:#71797E">5.1.10</span>&nbsp; Chill model comparison</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>Used climate change analysis framework to compare chill models <a href="https://www.sciencedirect.com/science/article/pii/S1161030120301106">(Fernandez et al., 2020b)</a></p></li>
<li><p>Model choice matters!</p></li>
</ul>
<p><br></p>
</section><section id="chill-projection-for-all-of-tunisia" class="level4"><h4 class="anchored" data-anchor-id="chill-projection-for-all-of-tunisia">
<span style="color:#71797E">5.1.11</span>&nbsp; Chill projection for all of Tunisia</h4>
<div style="height: 18px;">

</div>
<ul>
<li>Mapped chill accumulation across Tunisia, based on the previous framework
<ul>
<li>Applied the analysis framework developed to each of the 20 weather station locations across Tunisia and neighboring countries</li>
<li>Interpolated results to produce chill maps that track chill availability in Tunisia over the past few decades</li>
</ul>
</li>
</ul>
<ul>
<li>How to interpolate the site-specific results into a map that covers the whole country
<ul>
<li>Take the site-specific predictions of Safe Winter Chill and interpolate a surface through them (using the Kriging technique)</li>
<li>Repeat the same for the elevations of the locations</li>
<li>Then, fitted a linear model to relate chill accumulation to elevation</li>
<li>Calculate the difference between the elevation model derived from the weather station elevations and the true elevations of each location of the country, using a Digital Elevation Model (DEM)</li>
<li>Considering that this difference is not yet accounted for by the chill surface that was derived by interpolating chill data for the weather stations, we used the elevation~chill relationship we determined to correct chill predictions.</li>
<li>Will only work in places with a linear relationship between elevation and chill availability</li>
</ul>
</li>
</ul>
<p><br></p>
</section><section id="revisiting-chill-accumulation-in-oman" class="level4"><h4 class="anchored" data-anchor-id="revisiting-chill-accumulation-in-oman">
<span style="color:#71797E">5.1.12</span>&nbsp; Revisiting chill accumulation in Oman</h4>
<div style="height: 18px;">

</div>
<ul>
<li>Adding some new ideas on how to convert daily into hourly temperatures in a place like the oases of Oman we were interested in, we produced updated assessments of past winter chill and forecasts of future chill for the oases of Al Jabal Al Akhdar. <a href="https://link.springer.com/article/10.1007/s10584-020-02862-8">(Buerkert et al., 2020)</a>
</li>
</ul>
<p><br></p>
</section></section><section id="exercises-on-past-chill-projections" class="level3"><h3 class="anchored" data-anchor-id="exercises-on-past-chill-projections">
<span style="color:#71797E">5.2</span>&nbsp; Exercises on past chill projections</h3>
<div style="height: 18px;">

</div>
<p><strong><em>1. Sketch out three data access and processing challenges that had to be overcome in order to produce chill projections with state-of-the-art methodology.</em></strong></p>
<ul>
<li><p>The need to automate the process to create multiple climate scenarios for large number of weather stations and to handle large data output of simulation scenarios. For example, challenge in data transfer when replacing old scenarios (SRES) with the new (RCPs).</p></li>
<li><p>Scarcity of source to find appropriate information/ data on future climates that can easily be used for the purposes of chill modeling. For example, data (e.g.&nbsp;temperature records) available may not be representative of all locations of interest and the need for hourly records to run chill models.</p></li>
<li><p>The need to download large datasets when users may only be interested in data for a single location. This problem is overcome by a function that extracts data for single locations from <code>ClimateWizard</code> tool. The function is now publicly available through the use of an application programming interface (API) to access outputs from 15 climate models from the RCP scenarios.</p></li>
</ul>
<p><br></p>
<p><strong><em>2. Outline, in your understanding, the basic steps that are necessary to make such projections.</em></strong></p>
<p>Based on the information given in Chapter 5, the basic steps necessary to make chill projections are as follows:</p>
<ul>
<li><p>Set up temperature loggers in the location of interest to collect temperature data (can’t provide meaningful long-term data)</p></li>
<li><p>Obtain long-term data from official weather stations located in the vicinity (these data may not representative of all locations)</p></li>
<li><p>Using the records obtained from the location of interest, derive meaningful daily temperature data from the long-term data.</p></li>
<li>
<p>Calculate hourly temperatures directly from the daily records using methods such as PLS regression, since the chilling hours calculation requires hourly data.</p>
<ul>
<li>Now we can calculate estimated chilling hours for the entire time span covered by the official weather station. In other words, we now have chill dynamics for the past period.</li>
</ul>
</li>
</ul>
<ul>
<li><p>To add the future climate scenarios, we can input these data into a weather generator, and generate plausible weathers for a specified number of years. Here, we can also generate weather conditions based on historical temperatures or for scenarios where temperatures are a few degrees higher.</p></li>
<li><p>Now, we can make chill projections for the weather generator’s scenarios of our location, using chill models. Here the choice of chill model matters as not all chill models are reliable— select an appropriate chilling model or an ensembles of models.</p></li>
</ul>
<p><br></p>
</section></section><section id="chapter-6-manual-chill-analysis" class="level2"><h2 class="anchored" data-anchor-id="chapter-6-manual-chill-analysis">Chapter 6: Manual chill analysis</h2>
<section id="computing-chilling-hours-from-hourly-temperature-data" class="level3"><h3 class="anchored" data-anchor-id="computing-chilling-hours-from-hourly-temperature-data">
<span style="color:#71797E">6.1</span>&nbsp; Computing Chilling Hours from hourly temperature data</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>Need hourly temperature data to compute Chilling Hours</p></li>
<li><p><code>chillR</code> offers a few neat tools to make pretty good approximations of hourly temperature data from daily records</p></li>
</ul>
<p><br></p>
<section id="display-the-winters_hours_gaps-dataset-in-chillr-using-kable" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="display-the-winters_hours_gaps-dataset-in-chillr-using-kable"><em>Display the <code>Winters_hours_gaps</code> dataset in <code>chillR</code> using <code>kable</code></em></h4>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Display the Winters_hours_gaps dataset in chillR using kable</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Hour</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp_gaps</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">15.127</td>
<td style="text-align: right;">15.127</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">17.153</td>
<td style="text-align: right;">17.153</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">18.699</td>
<td style="text-align: right;">18.699</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">18.699</td>
<td style="text-align: right;">18.699</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">18.842</td>
<td style="text-align: right;">18.842</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">19.508</td>
<td style="text-align: right;">19.508</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">19.318</td>
<td style="text-align: right;">19.318</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">17.701</td>
<td style="text-align: right;">17.701</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">15.414</td>
<td style="text-align: right;">15.414</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">12.727</td>
<td style="text-align: right;">12.727</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
</section><section id="remove-column-temp_gaps-and-create-a-new-dataset-hourtemps" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="remove-column-temp_gaps-and-create-a-new-dataset-hourtemps"><em>Remove column <code>Temp_gaps</code> and create a new dataset (<code>hourtemps</code>)</em></h4>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Remove column Temp_gaps and create a new dataset (hourtemps)</span></span>
<span><span class="va">hourtemps</span> <span class="op">&lt;-</span> <span class="va">Winters_hours_gaps</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span>, <span class="st">"Month"</span>, <span class="st">"Day"</span>, <span class="st">"Hour"</span>, <span class="st">"Temp"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">hourtemps</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Hour</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">15.127</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">17.153</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">18.699</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">18.699</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">18.842</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">19.508</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">19.318</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">17.701</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">15.414</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">12.727</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
</section><section id="display-only-the-third-row-with-all-columns" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="display-only-the-third-row-with-all-columns"><em>Display only the third row with all columns</em></h4>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Display only the third row with all columns</span></span>
<span><span class="va">hourtemps</span><span class="op">[</span><span class="fl">3</span>, <span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>  Year Month Day Hour   Temp
3 2008     3   3   12 18.699</code></pre>
</div>
</div>
<p><br></p>
</section><section id="display-the-temp-column-of-the-third-row-only" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="display-the-temp-column-of-the-third-row-only"><em>Display the <code>Temp</code> column of the third row only</em></h4>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Display the temp column of the third row only</span></span>
<span><span class="va">hourtemps</span><span class="op">[</span><span class="fl">3</span>, <span class="st">"Temp"</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 18.699</code></pre>
</div>
</div>
<p><br></p>
</section><section id="display-the-first-five-rows-of-temp-column" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="display-the-first-five-rows-of-temp-column"><em>Display the first five rows of <code>Temp</code> column</em></h4>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Display the first five rows of Temp column</span></span>
<span><span class="va">hourtemps</span><span class="op">$</span><span class="va">Temp</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 15.127 17.153 18.699 18.699 18.842</code></pre>
</div>
</div>
<p><br></p>
</section><section id="display-the-first-five-rows-and-all-columns-of-hourtemps-dataset" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="display-the-first-five-rows-and-all-columns-of-hourtemps-dataset"><em>Display the first five rows and all columns of <code>hourtemps</code> dataset</em></h4>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Display the first five rows and all columns of hourtemps dataset</span></span>
<span><span class="va">hourtemps</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>  Year Month Day Hour   Temp
1 2008     3   3   10 15.127
2 2008     3   3   11 17.153
3 2008     3   3   12 18.699
4 2008     3   3   13 18.699
5 2008     3   3   14 18.842</code></pre>
</div>
</div>
<p><br></p>
</section><section id="check-for-temperatures-that-fall-within-chilling-hours-range" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="check-for-temperatures-that-fall-within-chilling-hours-range"><em>Check for temperatures that fall within <code>Chilling Hours</code> range</em></h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>Every hour with temperatures above (and including) 0°C and below (and including) 7.2°C is considered a Chilling Hour.</p></li>
<li><p>Check for every hour whether temperatures fall in this range, using simple comparison commands (<code>&lt;</code>, <code>&lt;=</code>, <code>==</code>, <code>=&gt;</code> and <code>&gt;</code>) in R</p></li>
</ul>
<p><br></p>
<section id="using-simple-comparison-commands" class="level5 unnumbered"><h5 class="unnumbered anchored" data-anchor-id="using-simple-comparison-commands"><em>Using simple comparison commands</em></h5>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use == command</span></span>
<span><span class="fl">1</span> <span class="op">==</span> <span class="fl">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">1</span> <span class="op">==</span> <span class="fl">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Test &gt; command</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE FALSE  TRUE</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use &gt;= command</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">c</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, <span class="va">c</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE  TRUE  TRUE</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use &amp; command</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, <span class="va">c</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, <span class="va">c</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE  TRUE FALSE</code></pre>
</div>
</div>
<p><br></p>
</section><section id="check-for-chilling-hours" class="level5 unnumbered"><h5 class="unnumbered anchored" data-anchor-id="check-for-chilling-hours"><em>Check for <code>Chilling Hours</code></em></h5>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Assign new column Chiling_Hour</span></span>
<span><span class="va">hourtemps</span><span class="op">[</span>, <span class="st">"Chilling_Hour"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">hourtemps</span><span class="op">$</span><span class="va">Temp</span> <span class="op">&gt;=</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">hourtemps</span><span class="op">$</span><span class="va">Temp</span> <span class="op">&lt;=</span> <span class="fl">7.2</span></span>
<span></span>
<span><span class="co"># Check if the temperatures fall within Chilling_Hour for row 13 to 20</span></span>
<span><span class="va">hourtemps</span><span class="op">[</span><span class="fl">13</span><span class="op">:</span><span class="fl">20</span>, <span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>   Year Month Day Hour  Temp Chilling_Hour
13 2008     3   3   22 9.040         FALSE
14 2008     3   3   23 7.920         FALSE
15 2008     3   4    0 6.535          TRUE
16 2008     3   4    1 6.687          TRUE
17 2008     3   4    2 8.767         FALSE
18 2008     3   4    3 9.139         FALSE
19 2008     3   4    4 6.788          TRUE
20 2008     3   4    5 5.076          TRUE</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Find total chilling hour for a particular period by defining rows (3-4 March</span></span>
<span><span class="co"># 2008)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">hourtemps</span><span class="op">$</span><span class="va">Chilling_Hour</span><span class="op">[</span><span class="fl">13</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use `which` function to set the dates for total chilling hours calculation</span></span>
<span><span class="va">Start_Date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">hourtemps</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="fl">2008</span> <span class="op">&amp;</span> <span class="va">hourtemps</span><span class="op">$</span><span class="va">Month</span> <span class="op">==</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">hourtemps</span><span class="op">$</span><span class="va">Day</span> <span class="op">==</span></span>
<span>    <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">hourtemps</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span> <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="va">End_Date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">hourtemps</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="fl">2008</span> <span class="op">&amp;</span> <span class="va">hourtemps</span><span class="op">$</span><span class="va">Month</span> <span class="op">==</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">hourtemps</span><span class="op">$</span><span class="va">Day</span> <span class="op">==</span></span>
<span>    <span class="fl">31</span> <span class="op">&amp;</span> <span class="va">hourtemps</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span> <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">hourtemps</span><span class="op">$</span><span class="va">Chilling_Hour</span><span class="op">[</span><span class="va">Start_Date</span><span class="op">:</span><span class="va">End_Date</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 28</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># So in October of 2008, Winters experienced 28 Chilling Hours.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section></section></section><section id="our-first-chill-function" class="level3"><h3 class="anchored" data-anchor-id="our-first-chill-function">
<span style="color:#71797E">6.2</span>&nbsp; Our first chill function</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>A function consists of a name, some arguments that are passed to the function, and some code that should be executed.</p></li>
<li><p>We can define is as <code>OurFunctionName &lt;- function(argument1, argument2, ...) {ourCode}</code>.</p></li>
<li><p>What’s returned is either the last object that’s mentioned in the function code or some content specified by the <code><a href="https://rdrr.io/r/base/function.html">return()</a></code> function.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Example function for Chilling_Hour calculation Function that adds</span></span>
<span><span class="co"># Chilling_Hour column to dataframe</span></span>
<span><span class="va">CH</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">hourtemps</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">hourtemps</span><span class="op">[</span>, <span class="st">"Chilling_Hour"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">hourtemps</span><span class="op">$</span><span class="va">Temp</span> <span class="op">&gt;=</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">hourtemps</span><span class="op">$</span><span class="va">Temp</span> <span class="op">&lt;=</span> <span class="fl">7.2</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">hourtemps</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Check chilling hour `yes or no` for rows 13-20</span></span>
<span><span class="fu">CH</span><span class="op">(</span><span class="va">hourtemps</span><span class="op">)</span><span class="op">[</span><span class="fl">13</span><span class="op">:</span><span class="fl">20</span>, <span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>   Year Month Day Hour  Temp Chilling_Hour
13 2008     3   3   22 9.040         FALSE
14 2008     3   3   23 7.920         FALSE
15 2008     3   4    0 6.535          TRUE
16 2008     3   4    1 6.687          TRUE
17 2008     3   4    2 8.767         FALSE
18 2008     3   4    3 9.139         FALSE
19 2008     3   4    4 6.788          TRUE
20 2008     3   4    5 5.076          TRUE</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create more complex functions, e.g. to calculate the number of Chilling Hours</span></span>
<span><span class="co"># between two dates, which we can specify in the YEARMODA format (i.e. year,</span></span>
<span><span class="co"># month and day, combined in one number).</span></span>
<span><span class="va">sum_CH</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">hourtemps</span>, <span class="va">Start_YEARMODA</span>, <span class="va">End_YEARMODA</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">Start_Year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">trunc</a></span><span class="op">(</span><span class="va">Start_YEARMODA</span><span class="op">/</span><span class="fl">10000</span><span class="op">)</span>  <span class="co"># 'trunc' removes all decimals</span></span>
<span>    <span class="va">Start_Month</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">trunc</a></span><span class="op">(</span><span class="op">(</span><span class="va">Start_YEARMODA</span> <span class="op">-</span> <span class="va">Start_Year</span> <span class="op">*</span> <span class="fl">10000</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span></span>
<span>    <span class="va">Start_Day</span> <span class="op">&lt;-</span> <span class="va">Start_YEARMODA</span> <span class="op">-</span> <span class="va">Start_Year</span> <span class="op">*</span> <span class="fl">10000</span> <span class="op">-</span> <span class="va">Start_Month</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>    <span class="va">Start_Hour</span> <span class="op">&lt;-</span> <span class="fl">12</span>  <span class="co"># This could also be flexible, but let's skip this for now</span></span>
<span>    <span class="va">End_Year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">trunc</a></span><span class="op">(</span><span class="va">End_YEARMODA</span><span class="op">/</span><span class="fl">10000</span><span class="op">)</span></span>
<span>    <span class="va">End_Month</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">trunc</a></span><span class="op">(</span><span class="op">(</span><span class="va">End_YEARMODA</span> <span class="op">-</span> <span class="va">End_Year</span> <span class="op">*</span> <span class="fl">10000</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span></span>
<span>    <span class="va">End_Day</span> <span class="op">&lt;-</span> <span class="va">End_YEARMODA</span> <span class="op">-</span> <span class="va">End_Year</span> <span class="op">*</span> <span class="fl">10000</span> <span class="op">-</span> <span class="va">End_Month</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>    <span class="va">End_Hour</span> <span class="op">&lt;-</span> <span class="fl">12</span>  <span class="co"># This could also be flexible, but let's skip this for now</span></span>
<span></span>
<span>    <span class="va">Start_Date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">hourtemps</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="va">Start_Year</span> <span class="op">&amp;</span> <span class="va">hourtemps</span><span class="op">$</span><span class="va">Month</span> <span class="op">==</span> <span class="va">Start_Month</span> <span class="op">&amp;</span></span>
<span>        <span class="va">hourtemps</span><span class="op">$</span><span class="va">Day</span> <span class="op">==</span> <span class="va">Start_Day</span> <span class="op">&amp;</span> <span class="va">hourtemps</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span> <span class="va">Start_Hour</span><span class="op">)</span></span>
<span>    <span class="va">End_Date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">hourtemps</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="va">End_Year</span> <span class="op">&amp;</span> <span class="va">hourtemps</span><span class="op">$</span><span class="va">Month</span> <span class="op">==</span> <span class="va">End_Month</span> <span class="op">&amp;</span></span>
<span>        <span class="va">hourtemps</span><span class="op">$</span><span class="va">Day</span> <span class="op">==</span> <span class="va">End_Day</span> <span class="op">&amp;</span> <span class="va">hourtemps</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span> <span class="va">End_Hour</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">Chill_hours</span> <span class="op">&lt;-</span> <span class="fu">CH</span><span class="op">(</span><span class="va">hourtemps</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Chill_hours</span><span class="op">$</span><span class="va">Chilling_Hour</span><span class="op">[</span><span class="va">Start_Date</span><span class="op">:</span><span class="va">End_Date</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Check the total chilling hours from March 1 to October 11, 2008 Note that the</span></span>
<span><span class="co"># dataset only goes from 3rd March to 11th November 2008, so use of any dates</span></span>
<span><span class="co"># outside that range will generate an error message.</span></span>
<span><span class="fu">sum_CH</span><span class="op">(</span><span class="va">hourtemps</span>, <span class="fl">20080401</span>, <span class="fl">20081011</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 77</code></pre>
</div>
</div>
<p><br></p>
</section><section id="exercise-on-basic-chill-modeling" class="level3"><h3 class="anchored" data-anchor-id="exercise-on-basic-chill-modeling">
<span style="color:#71797E">6.3</span>&nbsp; Exercise on basic chill modeling</h3>
<div style="height: 18px;">

</div>
<p><strong><em>1. Write a basic function that calculates warm hours (&gt;25°C)</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Check for warm hours above 25 degree C in Winters_hours_gaps dataset Create</span></span>
<span><span class="co">## a dataset without temperature gaps</span></span>
<span><span class="va">W_data</span> <span class="op">&lt;-</span> <span class="va">Winters_hours_gaps</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span>, <span class="st">"Month"</span>, <span class="st">"Day"</span>, <span class="st">"Hour"</span>, <span class="st">"Temp"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Write function that calculates warm hours above 25 degree C</span></span>
<span><span class="va">WH</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">W_data</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">W_data</span><span class="op">[</span>, <span class="st">"Warm_Hour"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">W_data</span><span class="op">$</span><span class="va">Temp</span> <span class="op">&gt;</span> <span class="fl">25</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">W_data</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Show the the first 4 rows</span></span>
<span><span class="fu">WH</span><span class="op">(</span><span class="va">W_data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>  Year Month Day Hour   Temp Warm_Hour
1 2008     3   3   10 15.127     FALSE
2 2008     3   3   11 17.153     FALSE
3 2008     3   3   12 18.699     FALSE
4 2008     3   3   13 18.699     FALSE</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calculate total warm hours for the dataset</span></span>
<span><span class="va">WH_sum</span> <span class="op">&lt;-</span> <span class="fu">WH</span><span class="op">(</span><span class="va">W_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">WH_sum</span><span class="op">$</span><span class="va">Warm_Hour</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 1275</code></pre>
</div>
</div>
<p><br></p>
<p><strong><em>2. Apply this function to the Winters_hours_gaps dataset</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Apply the function to original Winters_hours_gaps dataset</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu">WH</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">[</span><span class="fl">961</span><span class="op">:</span><span class="fl">970</span>, <span class="op">]</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Hour</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp_gaps</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Warm_Hour</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">25.501</td>
<td style="text-align: right;">25.501</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">27.653</td>
<td style="text-align: right;">27.653</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">29.015</td>
<td style="text-align: right;">29.015</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">29.890</td>
<td style="text-align: right;">29.890</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">30.748</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">30.117</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">29.090</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">28.221</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">25.744</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">21.604</td>
<td style="text-align: left;">FALSE</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p><strong><em>3. Extend this function, so that it can take start and end dates as inputs and sums up warm hours between these dates</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sum_WH</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">W_data</span>, <span class="va">Start_YEARMODA</span>, <span class="va">End_YEARMODA</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">Start_Year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">trunc</a></span><span class="op">(</span><span class="va">Start_YEARMODA</span><span class="op">/</span><span class="fl">10000</span><span class="op">)</span></span>
<span>    <span class="va">Start_Month</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">trunc</a></span><span class="op">(</span><span class="op">(</span><span class="va">Start_YEARMODA</span> <span class="op">-</span> <span class="va">Start_Year</span> <span class="op">*</span> <span class="fl">10000</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span></span>
<span>    <span class="va">Start_Day</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">trunc</a></span><span class="op">(</span><span class="op">(</span><span class="va">Start_YEARMODA</span> <span class="op">-</span> <span class="va">Start_Year</span> <span class="op">*</span> <span class="fl">10000</span><span class="op">)</span> <span class="op">-</span> <span class="va">Start_Month</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span></span>
<span>    <span class="va">Start_Hour</span> <span class="op">&lt;-</span> <span class="fl">12</span></span>
<span></span>
<span>    <span class="va">End_Year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">trunc</a></span><span class="op">(</span><span class="va">End_YEARMODA</span><span class="op">/</span><span class="fl">10000</span><span class="op">)</span></span>
<span>    <span class="va">End_Month</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">trunc</a></span><span class="op">(</span><span class="op">(</span><span class="va">End_YEARMODA</span> <span class="op">-</span> <span class="va">Start_Year</span> <span class="op">*</span> <span class="fl">10000</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span></span>
<span>    <span class="va">End_Day</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">trunc</a></span><span class="op">(</span><span class="op">(</span><span class="va">End_YEARMODA</span> <span class="op">-</span> <span class="va">Start_Year</span> <span class="op">*</span> <span class="fl">10000</span><span class="op">)</span> <span class="op">-</span> <span class="va">End_Month</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span></span>
<span>    <span class="va">End_Hour</span> <span class="op">&lt;-</span> <span class="fl">12</span></span>
<span></span>
<span>    <span class="va">Start_Date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">W_data</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="va">Start_Year</span> <span class="op">&amp;</span> <span class="va">W_data</span><span class="op">$</span><span class="va">Month</span> <span class="op">==</span> <span class="va">Start_Month</span> <span class="op">&amp;</span></span>
<span>        <span class="va">W_data</span><span class="op">$</span><span class="va">Day</span> <span class="op">==</span> <span class="va">Start_Day</span> <span class="op">&amp;</span> <span class="va">W_data</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span> <span class="va">Start_Hour</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">End_Date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">W_data</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="va">End_Year</span> <span class="op">&amp;</span> <span class="va">W_data</span><span class="op">$</span><span class="va">Month</span> <span class="op">==</span> <span class="va">End_Month</span> <span class="op">&amp;</span> <span class="va">W_data</span><span class="op">$</span><span class="va">Day</span> <span class="op">==</span></span>
<span>        <span class="va">End_Day</span> <span class="op">&amp;</span> <span class="va">W_data</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span> <span class="va">End_Hour</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">Warm_Hours</span> <span class="op">&lt;-</span> <span class="fu">WH</span><span class="op">(</span><span class="va">W_data</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Warm_Hours</span><span class="op">$</span><span class="va">Warm_Hour</span><span class="op">[</span><span class="va">Start_Date</span><span class="op">:</span><span class="va">End_Date</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span>  <span class="co"># See in-class script for setting year, month and date with substr </span></span>
<span></span>
<span><span class="co"># Total warm hours for the whole period of dataset</span></span>
<span><span class="fu">sum_WH</span><span class="op">(</span><span class="va">W_data</span>, <span class="fl">20080303</span>, <span class="fl">20081110</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 1275</code></pre>
</div>
</div>
<p><br></p>
</section></section><section id="chapter-7-chill-models" class="level2"><h2 class="anchored" data-anchor-id="chapter-7-chill-models">Chapter 7: Chill models</h2>
<section id="chill-models-in-chillr" class="level3"><h3 class="anchored" data-anchor-id="chill-models-in-chillr">
<span style="color:#71797E">7.1</span>&nbsp; Chill models in <code>chillR</code>
</h3>
<section id="chilling_hours-function" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="chilling_hours-function"><em><code>Chilling_Hours()</code> function</em></h4>
<div style="height: 18px;">

</div>
<ul>
<li>Chilling Hours are great for an entry-level tutorial on chill modeling, but they’re not a particularly credible metric, so I suggest you forget them right away.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Chilling_Hours() function in chillR to calculate chilling hours</span></span>
<span><span class="va">Chilling_Hours</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>function (HourTemp, summ = TRUE) 
{
    CH_range &lt;- which(HourTemp &lt;= 7.2 &amp; HourTemp &gt;= 0)
    CH_weights &lt;- rep(0, length(HourTemp))
    CH_weights[CH_range] &lt;- 1
    if (summ == TRUE) 
        return(cumsum(CH_weights))
    else return(CH_weights)
}
&lt;bytecode: 0x12f3c6f60&gt;
&lt;environment: namespace:chillR&gt;</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Apply Chilling_Hours() function to Winters_hours_gap dataset</span></span>
<span><span class="fu">Chilling_Hours</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">$</span><span class="va">Temp</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>  [1]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1  2  2  2  3  4  5  6  6  6  6
 [26]  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6
 [51]  6  6  6  6  6  6  6  6  6  6  6  7  8  9 10 11 12 13 14 15 16 16 16 16 16
 [76] 16 16 16 16 16 16 16 16 16 16 17 18 19 20 21 22 23 24 25 25 25 25 25 25 25</code></pre>
</div>
</div>
<p><br></p>
</section><section id="the-utah-model" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="the-utah-model"><em>The Utah model</em></h4>
<div style="height: 18px;">

</div>
<ul>
<li><p><code><a href="https://rdrr.io/pkg/chillR/man/step_model.html">step_model()</a></code> function allows you to define your own model, based on temperature thresholds and weights.</p></li>
<li><p>To implement various variations of the Utah Model that have been developed for different locations</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Utah_Model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>function (HourTemp, summ = TRUE) 
return(step_model(HourTemp, df = data.frame(lower = c(-1000, 
    1.4, 2.4, 9.1, 12.4, 15.9, 18), upper = c(1.4, 2.4, 9.1, 
    12.4, 15.9, 18, 1000), weight = c(0, 0.5, 1, 0.5, 0, -0.5, 
    -1)), summ = summ))
&lt;bytecode: 0x12eab0ab8&gt;
&lt;environment: namespace:chillR&gt;</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">Utah_Model</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">$</span><span class="va">Temp</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>  [1]  0.0 -0.5 -1.5 -2.5 -3.5 -4.5 -5.5 -6.0 -6.0 -6.0 -5.5 -5.0 -4.0 -3.0 -2.0
 [16] -1.0  0.0  0.5  1.5  2.5  3.5  4.5  5.0  5.0  5.0  4.0  3.0  2.0  1.0  0.0
 [31] -1.0 -2.0 -2.5 -2.5 -2.0 -1.5 -1.0 -0.5  0.5  1.0  1.5  2.0  2.0  2.5  3.0
 [46]  3.5  4.0  4.0  4.0  3.5  2.5  1.5  0.5 -0.5 -1.5 -2.5 -3.0 -3.0 -2.5 -1.5
 [61] -0.5  0.5  1.5  2.5  3.5  4.5  5.5  6.5  7.5  8.5  9.5 10.0 10.0  9.5  9.0
 [76]  8.5  8.0  7.5  7.0  6.5  6.5  7.0  7.5  8.5  9.5 10.5 11.5 12.5 13.5 14.5
 [91] 15.5 16.5 17.5 18.5 19.0 19.0 19.0 18.5 17.5 16.5</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create a data.frame for temperatures with weights</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1000</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span>, upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>,</span>
<span>    <span class="fl">1000</span><span class="op">)</span>, weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">lower</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">upper</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">weight</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">-1000</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1000</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use custom() function to implement a chill model based on df</span></span>
<span><span class="va">custom</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">step_model</span><span class="op">(</span><span class="va">x</span>, <span class="va">df</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">custom</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">$</span><span class="va">Temp</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>  [1]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1  4  7  7  7  7
 [26]  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7
 [51]  7  7  7  7  7  7  7  7  7  7  7  7  7  7  8 10 13 16 19 22 22 22 22 22 22
 [76] 22 22 22 22 22 22 22 22 22 22 22 22 23 25 27 29 31 34 37 37 37 37 37 37 37</code></pre>
</div>
</div>
<p><br></p>
</section><section id="the-dynamic-model" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="the-dynamic-model"><em>The dynamic model</em></h4>
<div style="height: 18px;">

</div>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Dynamic_Model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>function (HourTemp, summ = TRUE, E0 = 4153.5, E1 = 12888.8, A0 = 139500, 
    A1 = 2.567e+18, slope = 1.6, Tf = 277) 
{
    if (missing(HourTemp)) {
        stop("HourTemp must be present! Aborting.")
    }
    TK &lt;- HourTemp + 273
    aa &lt;- A0/A1
    ee &lt;- E1 - E0
    sr &lt;- exp(slope * Tf * (TK - Tf)/TK)
    xi &lt;- sr/(1 + sr)
    xs &lt;- aa * exp(ee/TK)
    eak1 &lt;- exp(-A1 * exp(-E1/TK))
    x = 0
    for (l in c(2:length(HourTemp))) {
        S &lt;- x[l - 1]
        if (x[l - 1] &gt;= 1) {
            S &lt;- S * (1 - xi[l - 2])
        }
        x[l] &lt;- xs[l - 1] - (xs[l - 1] - S) * eak1[l - 1]
    }
    delta &lt;- rep(0, length(HourTemp))
    ii &lt;- which(x &gt;= 1)
    delta[ii] &lt;- x[ii] * xi[ii - 1]
    if (summ) 
        return(cumsum(delta))
    return(delta)
}
&lt;bytecode: 0x12a715f90&gt;
&lt;environment: namespace:chillR&gt;</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">Dynamic_Model</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">$</span><span class="va">Temp</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>  [1] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
  [8] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
 [15] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
 [22] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
 [29] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
 [36] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
 [43] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
 [50] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
 [57] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
 [64] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
 [71] 0.0000000 0.9698435 0.9698435 0.9698435 0.9698435 0.9698435 0.9698435
 [78] 0.9698435 0.9698435 0.9698435 0.9698435 0.9698435 0.9698435 0.9698435
 [85] 0.9698435 0.9698435 0.9698435 0.9698435 0.9698435 0.9698435 0.9698435
 [92] 0.9698435 0.9698435 0.9698435 0.9698435 0.9698435 0.9698435 0.9698435
 [99] 0.9698435 0.9698435</code></pre>
</div>
</div>
<p><br></p>
</section><section id="make_jday-and-tempresponse-functions" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="make_jday-and-tempresponse-functions"><em><code>make_JDay()</code> and <code>tempResponse</code> functions</em></h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>Add the Julian dates (counts the days of the year) to the dataset</p></li>
<li><p>The <code><a href="https://rdrr.io/pkg/chillR/man/chilling.html">chilling()</a></code> function implements the Chilling Hours, Utah and Dynamic Models, and it also calculates Growing Degree Days (GDH); use <code>tempResponse</code> function otherwise</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use chilling() function</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">chilling</span><span class="op">(</span><span class="fu">make_JDay</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">)</span>, Start_JDay <span class="op">=</span> <span class="fl">90</span>, End_JDay <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">output</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Chilling_Hours</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Utah_Model</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Chill_portions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">GDH</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: left;">2007/2008</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">15.5</td>
<td style="text-align: right;">2.009147</td>
<td style="text-align: right;">2406.52</td>
</tr></tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use tempResponse function</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">tempResponse</span><span class="op">(</span><span class="fu">make_JDay</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">)</span>, Start_JDay <span class="op">=</span> <span class="fl">90</span>, End_JDay <span class="op">=</span> <span class="fl">100</span>,</span>
<span>    models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Chill_Portions <span class="op">=</span> <span class="va">Dynamic_Model</span>, GDH <span class="op">=</span> <span class="va">GDH</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">output</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Chill_Portions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">GDH</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: left;">2007/2008</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">2.009147</td>
<td style="text-align: right;">2406.52</td>
</tr></tbody>
</table>
</div>
</div>
<p><br></p>
</section></section><section id="exercise-on-chill-models" class="level3"><h3 class="anchored" data-anchor-id="exercise-on-chill-models">
<span style="color:#71797E">7.2</span>&nbsp; Exercise on chill models</h3>
<div style="height: 18px;">

</div>
<p><strong><em>1. Run the <code><a href="https://rdrr.io/pkg/chillR/man/chilling.html">chilling()</a></code> function on the <code>Winters_hours_gap</code> dataset</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Check JDay for start and end of dataset period</span></span>
<span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2008</span>, <span class="fl">2008</span><span class="op">)</span>, Month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">11</span><span class="op">)</span>, Day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">11</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu">make_JDay</span><span class="op">(</span><span class="va">dates</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">JDay</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">63</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">316</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Apply chilling() function on Winters_hours_gap dataset</span></span>
<span><span class="va">c_output</span> <span class="op">&lt;-</span> <span class="fu">chilling</span><span class="op">(</span><span class="fu">make_JDay</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">)</span>, Start_JDay <span class="op">=</span> <span class="fl">63</span>, End_JDay <span class="op">=</span> <span class="fl">316</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">c_output</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Chilling_Hours</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Utah_Model</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Chill_portions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">GDH</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: left;">2007/2008</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">254</td>
<td style="text-align: right;">253.0833</td>
<td style="text-align: right;">99.63911</td>
<td style="text-align: right;">203</td>
<td style="text-align: right;">-2492</td>
<td style="text-align: right;">12.22258</td>
<td style="text-align: right;">72925.48</td>
</tr></tbody>
</table>
</div>
</div>
<p><br></p>
<p><strong><em>2. Create your own temperature-weighting chill model using the <code><a href="https://rdrr.io/pkg/chillR/man/step_model.html">step_model()</a></code> function</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">t_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1000</span>, <span class="fl">2</span>, <span class="fl">8</span>, <span class="fl">12</span>, <span class="fl">15</span>, <span class="fl">18</span>, <span class="fl">20</span>, <span class="fl">25</span><span class="op">)</span>, upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">8</span>,</span>
<span>    <span class="fl">12</span>, <span class="fl">15</span>, <span class="fl">18</span>, <span class="fl">20</span>, <span class="fl">25</span>, <span class="fl">1000</span><span class="op">)</span>, weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">t_data</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">lower</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">upper</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">weight</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">-1000</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">8</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1.0</td>
</tr>
<tr class="even">
<td style="text-align: right;">12</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">2.0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="even">
<td style="text-align: right;">18</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">-0.5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">-1.0</td>
</tr>
<tr class="even">
<td style="text-align: right;">25</td>
<td style="text-align: right;">1000</td>
<td style="text-align: right;">-2.0</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">custom</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">step_model</span><span class="op">(</span><span class="va">x</span>, <span class="va">t_data</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
<p><strong><em>3. Run this model on the <code>Winters_hours_gaps</code> dataset using the <code><a href="https://rdrr.io/pkg/chillR/man/tempResponse.html">tempResponse()</a></code> function.</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">t_output</span> <span class="op">&lt;-</span> <span class="fu">tempResponse</span><span class="op">(</span><span class="fu">make_JDay</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">)</span>, Start_JDay <span class="op">=</span> <span class="fl">63</span>, End_JDay <span class="op">=</span> <span class="fl">316</span>,</span>
<span>    models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Cumulative_Temp <span class="op">=</span> <span class="va">custom</span>, Chilling_Hours <span class="op">=</span> <span class="va">Chilling_Hours</span>, Chill_Portions <span class="op">=</span> <span class="va">Dynamic_Model</span>,</span>
<span>        Utah_Model <span class="op">=</span> <span class="va">Utah_Model</span>, GDH <span class="op">=</span> <span class="va">GDH</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">t_output</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Cumulative_Temp</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Chilling_Hours</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Chill_Portions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Utah_Model</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">GDH</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: left;">2007/2008</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">254</td>
<td style="text-align: right;">253.0833</td>
<td style="text-align: right;">99.63911</td>
<td style="text-align: right;">-682</td>
<td style="text-align: right;">203</td>
<td style="text-align: right;">12.2227</td>
<td style="text-align: right;">-2492</td>
<td style="text-align: right;">72925.48</td>
</tr></tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Here we see a big difference between the outputs of various models, due to</span></span>
<span><span class="co"># the different parameters chosen?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section></section><section id="chapter-8-making-hourly-temperatures" class="level2"><h2 class="anchored" data-anchor-id="chapter-8-making-hourly-temperatures">Chapter 8: Making hourly temperatures</h2>
<section id="generating-hourly-temperatures" class="level3"><h3 class="anchored" data-anchor-id="generating-hourly-temperatures">
<span style="color:#71797E">8.1</span>&nbsp; Generating hourly temperatures</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>Most sources only provide daily data, usually including minimum and maximum temperature of the day, from which we can’t directly calculate Chilling Hours.</p></li>
<li>
<p>The rate of temperature increase in the morning is not the same as the rate of decrease in the evening. Besides, in particular the time of the lowest daily temperature varies considerably throughout the year (unless you’re close to the equator), and it would be good to consider this.</p>
<ul>
<li>‘Triangular’ daily temperature pattern, achieved by interpolating linearly for hours between daily minimum temperature recorded at a certain time of day, and the maximum temperature at another time, is not realistic.</li>
</ul>
</li>
</ul>
<p><br></p>
<section id="idealized-daily-temperature-curves" class="level4"><h4 class="anchored" data-anchor-id="idealized-daily-temperature-curves">
<span style="color:#71797E">8.1.1</span>&nbsp; Idealized daily temperature curves</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p><a href="https://journals.ashs.org/hortsci/view/journals/hortsci/25/1/article-p14.xml">(Linvill, 1990)</a> described the daily temperature curve using a combination of two mathematical equations: a sine curve to describe daytime warming, and a logarithmic decay function for nighttime cooling.</p></li>
<li><p>The transition points between the two parts were determined by sunrise and sunset, and the duration of the parts was related to daylength.</p></li>
<li><p>One aspect that made Linvill’s equations hard to use across different locations was the dependency on sunrise and sunset times.</p></li>
<li><p>Fortunately, at least for locations without major topographic features, sunrise and sunset times can be calculated based on what we know about the geometry of our solar system.</p></li>
<li><p>Use <code>daylength</code> function to produce daily temperature curves.</p></li>
<li><p>January 1st ist JDay 1, and December 31st either JDay 365 (in normal years) or JDay 366 (in leap years).</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Make plots of the sunrise time, sunset time and daylength at Klein-Altendorf</span></span>
<span><span class="co"># (Latitude: 50.4°N) over the course of the year</span></span>
<span><span class="va">Days</span> <span class="op">&lt;-</span> <span class="fu">daylength</span><span class="op">(</span>latitude <span class="op">=</span> <span class="fl">50.4</span>, JDay <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">365</span><span class="op">)</span></span>
<span><span class="va">Days_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>JDay <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, Sunrise <span class="op">=</span> <span class="va">Days</span><span class="op">$</span><span class="va">Sunrise</span>, Sunset <span class="op">=</span> <span class="va">Days</span><span class="op">$</span><span class="va">Sunset</span>,</span>
<span>    Daylength <span class="op">=</span> <span class="va">Days</span><span class="op">$</span><span class="va">Daylength</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use pivot_longer from tidyr to convert the data.frame, so that the three time</span></span>
<span><span class="co"># series (Sunrise, Sunset and Daylength) were stacked on top of each other.</span></span>
<span><span class="va">Days_df</span> <span class="op">&lt;-</span> <span class="fu">pivot_longer</span><span class="op">(</span><span class="va">Days_df</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Sunrise</span><span class="op">:</span><span class="va">Daylength</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">Days_df</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">JDay</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu">facet_grid</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Time of Day / Daylength (Hours)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/8.1.1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<section id="calculate-hourly-temperatures" class="level5 unnumbered"><h5 class="unnumbered anchored" data-anchor-id="calculate-hourly-temperatures"><em>Calculate hourly temperatures</em></h5>
<div style="height: 18px;">

</div>
<ul>
<li>
<code><a href="https://rdrr.io/pkg/chillR/man/stack_hourly_temps.html">stack_hourly_temps()</a></code> function takes as input a dataset of daily minimum and maximum temperatures
<ul>
<li>Columns: <code>Tmin</code>, <code>Tmax</code>, <code>Year</code>, <code>Month</code>, <code>Day</code>
</li>
<li>Need the latitude of the place of interest</li>
<li>Can also output the sunrise and sunset times</li>
</ul>
</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use KA_weather dataset to demonstrate stack_hourly_temps() function</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu">chillR</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/chillR/man/KA_weather.html">KA_weather</a></span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8.2</td>
<td style="text-align: right;">5.1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">9.1</td>
<td style="text-align: right;">5.0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">10.4</td>
<td style="text-align: right;">3.3</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">8.4</td>
<td style="text-align: right;">4.5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">8.1</td>
<td style="text-align: right;">4.4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">12.0</td>
<td style="text-align: right;">6.9</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">11.2</td>
<td style="text-align: right;">8.6</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">13.9</td>
<td style="text-align: right;">8.5</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">14.5</td>
<td style="text-align: right;">3.6</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Adrian's codes i recommend getting the prior day as well - because it will</span></span>
<span><span class="co">## affect the idealized curve pattern</span></span>
<span><span class="va">KA_weather_subset</span> <span class="op">&lt;-</span> <span class="va">KA_weather</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Year</span> <span class="op">==</span> <span class="fl">1998</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Month</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Day</span> <span class="op">==</span> <span class="fl">4</span> <span class="op">|</span> <span class="va">Day</span> <span class="op">==</span> <span class="fl">5</span> <span class="op">|</span> <span class="va">Day</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sh_data</span> <span class="op">&lt;-</span> <span class="fu">stack_hourly_temps</span><span class="op">(</span><span class="va">KA_weather_subset</span>, latitude <span class="op">=</span> <span class="fl">50.4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># stack_hourly_temps produces a list with 2 elements - the data and a quality</span></span>
<span><span class="co"># control table - select the hourtemps element to get the actual data</span></span>
<span><span class="va">sh_data</span> <span class="op">&lt;-</span> <span class="va">sh_data</span><span class="op">[[</span><span class="st">"hourtemps"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># filter by day if you want to</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">sh_data</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Day</span> <span class="op">==</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">JDay</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Hour</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5.195369</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5.066660</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4.950314</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4.844164</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4.746566</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4.656244</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">4.572187</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">4.493583</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">4.569464</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.384001</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">6.139939</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">6.787169</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">7.282787</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">7.593939</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">7.700000</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">7.593939</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">7.282787</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">6.591821</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">6.168074</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">5.870570</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">5.641106</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">5.454280</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">5.296704</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">5.160445</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p>Here, I will try to recreate the line graph shown in the coursebook.</p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Here I select from day 1 to 6 because the graph in the coursebook starts from</span></span>
<span><span class="co"># day 2. I found the graph lies flat if I started from day 2, so need to select</span></span>
<span><span class="co"># one day before and one day after to show the direction of the graph better</span></span>
<span><span class="va">KA_weather_subset</span> <span class="op">&lt;-</span> <span class="va">KA_weather</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Year</span> <span class="op">==</span> <span class="fl">1998</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Month</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Day</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">Day</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">|</span> <span class="va">Day</span> <span class="op">==</span> <span class="fl">3</span> <span class="op">|</span> <span class="va">Day</span> <span class="op">==</span> <span class="fl">4</span> <span class="op">|</span> <span class="va">Day</span> <span class="op">==</span> <span class="fl">5</span> <span class="op">|</span> <span class="va">Day</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sh_data</span> <span class="op">&lt;-</span> <span class="fu">stack_hourly_temps</span><span class="op">(</span><span class="va">KA_weather_subset</span>, latitude <span class="op">=</span> <span class="fl">50.4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sh_data</span> <span class="op">&lt;-</span> <span class="va">sh_data</span><span class="op">[[</span><span class="st">"hourtemps"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Choose from day 1 to 5 to show x-axis from day 2 to 5</span></span>
<span><span class="va">sh_data_plot</span> <span class="op">&lt;-</span> <span class="va">sh_data</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Day</span> <span class="op">&gt;=</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">Day</span> <span class="op">&lt;=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>DateTime <span class="op">=</span> <span class="fu">ymd_h</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">Year</span>, <span class="va">Month</span>, <span class="va">Day</span>, <span class="va">Hour</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the data with DateTime on the x-axis for continuous plotting and use</span></span>
<span><span class="co"># POSIXct to extend the curve a bit before day 2 and beyond day 5 like the</span></span>
<span><span class="co"># graph in the coursebook</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">sh_data_plot</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">DateTime</span>, y <span class="op">=</span> <span class="va">Temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_x_datetime</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="st">"1998-01-01 20:00:00"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="st">"1998-01-05 07:00:00"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date"</span>, y <span class="op">=</span> <span class="st">"Temperature (°C)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/8.1.1b-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section></section><section id="empirical-daily-temperature-curves" class="level4"><h4 class="anchored" data-anchor-id="empirical-daily-temperature-curves">
<span style="color:#71797E">8.1.2</span>&nbsp; Empirical daily temperature curves</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>There are some locations where idealized daily temperature curves don’t work, e.g., rugged topography— trees maybe shaded for part of the day.</p></li>
<li><p>Also the temperature curve in an orchard, which may feature its own microclimate, with shaded and sunny spots, with dew-covered grass or bare ground etc., may not closely resemble the curve drawn up by <a href="https://journals.ashs.org/hortsci/view/journals/hortsci/25/1/article-p14.xml">Linvill (1990)</a></p></li>
<li>
<p>Addressing the issue with <a href="https://link.springer.com/article/10.1007/s10584-020-02862-8">(Buerkert et al., 2020)</a></p>
<ul>
<li>Obtain a dataset of hourly temperature data for the location interest (at least a full year, ideally multiple years)</li>
<li>Then, use <code><a href="https://rdrr.io/pkg/chillR/man/Empirical_daily_temperature_curve.html">Empirical_daily_temperature_curve()</a></code> function to determine the typical pattern of hourly temperatures at this location— done separately for each month of the year (could be continuous?)</li>
<li>Then, apply the obtained set of coefficients to a daily dataset from the same location to get a reasonable hourly temperature record. Use <code>Empirical_hourly_temperatures</code> function which requires as inputs a set of hourly coefficients, and a daily temperature record (which includes <code>Tmin</code> and <code>Tmax</code> columns).</li>
</ul>
</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">empi_curve</span> <span class="op">&lt;-</span> <span class="fu">Empirical_daily_temperature_curve</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show results in a table </span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">empi_curve</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">48</span>, <span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Hour</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Prediction_coefficient</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1774859</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.1550693</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.1285651</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.1145597</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.0696064</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.0339583</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.0313115</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0.3121959</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0.4953232</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0.6819674</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0.8227423</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0.9506491</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">0.9662604</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0.9915996</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1.0000000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">0.9490319</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">0.8483098</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">0.6864529</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">0.4945415</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0.3636642</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0.2972377</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">0.2360349</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">0.1794802</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1960789</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.1407018</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.1283250</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.0819307</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.0541415</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.0188241</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.1697052</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0.4442722</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0.5939797</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0.7363923</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0.8399804</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0.9245702</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">0.9770693</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0.9963131</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1.0000000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">0.9568107</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">0.8698369</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">0.7343896</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">0.5330597</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0.3941038</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0.3186075</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">0.2594569</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">0.2114486</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Show results in a figure</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">empi_curve</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">96</span>, <span class="op">]</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span><span class="va">Hour</span>, <span class="va">Prediction_coefficient</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">1.3</span>,</span>
<span>            col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span>rows <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">Month</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Hour of the day"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Prediction coefficient"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># hourly coefficients needed as inputs for step 3</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/8.1.2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<section id="make_all_day_table-function" class="level5 unnumbered"><h5 class="unnumbered anchored" data-anchor-id="make_all_day_table-function"><em><code>make_all_day_table</code> function</em></h5>
<div style="height: 18px;">

</div>
<ul>
<li><p>Fill gaps in daily or hourly temperature records</p></li>
<li><p>Summarize hourly records into daily minimum and maximum temperatures</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Summarize hourly records into daily minimum and maximum temperatures</span></span>
<span><span class="va">coeffs</span> <span class="op">&lt;-</span> <span class="fu">Empirical_daily_temperature_curve</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">)</span></span>
<span><span class="va">Winters_daily</span> <span class="op">&lt;-</span> <span class="fu">make_all_day_table</span><span class="op">(</span><span class="va">Winters_hours_gaps</span>, input_timestep <span class="op">=</span> <span class="st">"hour"</span><span class="op">)</span></span>
<span><span class="va">Winters_hours</span> <span class="op">&lt;-</span> <span class="fu">Empirical_hourly_temperatures</span><span class="op">(</span><span class="va">Winters_daily</span>, <span class="va">coeffs</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simplify data a bit to make it easier to use require(reshape2)</span></span>
<span><span class="va">Winters_hours</span> <span class="op">&lt;-</span> <span class="va">Winters_hours</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span>, <span class="st">"Month"</span>, <span class="st">"Day"</span>, <span class="st">"Hour"</span>, <span class="st">"Temp"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">Winters_hours</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">Winters_hours</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Temp_empirical"</span></span>
<span><span class="va">Winters_ideal</span> <span class="op">&lt;-</span> <span class="fu">stack_hourly_temps</span><span class="op">(</span><span class="va">Winters_daily</span>, latitude <span class="op">=</span> <span class="fl">38.5</span><span class="op">)</span><span class="op">$</span><span class="va">hourtemps</span></span>
<span><span class="va">Winters_ideal</span> <span class="op">&lt;-</span> <span class="va">Winters_ideal</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span>, <span class="st">"Month"</span>, <span class="st">"Day"</span>, <span class="st">"Hour"</span>, <span class="st">"Temp"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">Winters_ideal</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">Winters_ideal</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Temp_ideal"</span></span>
<span></span>
<span><span class="co"># Make triangular dataset to understand how it works</span></span>
<span><span class="va">Winters_triangle</span> <span class="op">&lt;-</span> <span class="va">Winters_daily</span></span>
<span><span class="va">Winters_triangle</span><span class="op">[</span>, <span class="st">"Hour"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Hour</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">Winters_triangle</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">23</span></span>
<span><span class="va">Winters_triangle</span><span class="op">[</span>, <span class="st">"Temp"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">Winters_triangle</span> <span class="op">&lt;-</span> <span class="fu">make_all_day_table</span><span class="op">(</span><span class="va">Winters_triangle</span>, timestep <span class="op">=</span> <span class="st">"hour"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">Winters_triangle</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">Winters_triangle</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Temp_triangular"</span></span>
<span></span>
<span><span class="co"># with the following loop, we fill in the daily Tmin and Tmax values for every</span></span>
<span><span class="co"># hour of the dataset</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">Winters_triangle</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Tmin</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Tmin</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Tmin</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Tmax</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Tmax</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Tmax</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Temp_triangular</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="co"># now we assign the daily Tmin value to the 6th hour of every day</span></span>
<span><span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Temp_triangular</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Tmin</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span></span>
<span>    <span class="fl">6</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># we also assign the daily Tmax value to the 18th hour of every day</span></span>
<span><span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Temp_triangular</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span> <span class="fl">18</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Tmax</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span></span>
<span>    <span class="fl">18</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># in the following step, we use the chillR function 'interpolate_gaps' to fill</span></span>
<span><span class="co"># in all the gaps in the hourly record with straight lines</span></span>
<span><span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Temp_triangular</span> <span class="op">&lt;-</span> <span class="fu">interpolate_gaps</span><span class="op">(</span><span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Temp_triangular</span><span class="op">)</span><span class="op">$</span><span class="va">interp</span></span>
<span><span class="va">Winters_triangle</span> <span class="op">&lt;-</span> <span class="va">Winters_triangle</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span>, <span class="st">"Month"</span>, <span class="st">"Day"</span>, <span class="st">"Hour"</span>, <span class="st">"Temp_triangular"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Now, merge all these into data.frames to display them easily</span></span>
<span><span class="va">Winters_temps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">Winters_hours_gaps</span>, <span class="va">Winters_hours</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span>, <span class="st">"Month"</span>,</span>
<span>    <span class="st">"Day"</span>, <span class="st">"Hour"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Winters_temps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">Winters_temps</span>, <span class="va">Winters_triangle</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span>, <span class="st">"Month"</span>, <span class="st">"Day"</span>,</span>
<span>    <span class="st">"Hour"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Winters_temps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">Winters_temps</span>, <span class="va">Winters_ideal</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span>, <span class="st">"Month"</span>, <span class="st">"Day"</span>,</span>
<span>    <span class="st">"Hour"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now we have a dataset with the observed temperatures and the three</span></span>
<span><span class="co"># approximations (triangular, idealized curve and empirical curve).  To plot</span></span>
<span><span class="co"># this effectively, let’s convert the Year, Month, Day and Hour columns into</span></span>
<span><span class="co"># R’s date format (using ISOdate) and reorganize the data.frame a bit.</span></span>
<span><span class="va">Winters_temps</span><span class="op">[</span>, <span class="st">"DATE"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="va">Winters_temps</span><span class="op">$</span><span class="va">Year</span>, <span class="va">Winters_temps</span><span class="op">$</span><span class="va">Month</span>, <span class="va">Winters_temps</span><span class="op">$</span><span class="va">Day</span>,</span>
<span>    <span class="va">Winters_temps</span><span class="op">$</span><span class="va">Hour</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">Winters_temps_to_plot</span> <span class="op">&lt;-</span> <span class="va">Winters_temps</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DATE"</span>, <span class="st">"Temp"</span>, <span class="st">"Temp_empirical"</span>, <span class="st">"Temp_triangular"</span>,</span>
<span>    <span class="st">"Temp_ideal"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">Winters_temps_to_plot</span> <span class="op">&lt;-</span> <span class="va">Winters_temps_to_plot</span><span class="op">[</span><span class="fl">100</span><span class="op">:</span><span class="fl">200</span>, <span class="op">]</span></span>
<span><span class="va">Winters_temps_to_plot</span> <span class="op">&lt;-</span> <span class="fu">pivot_longer</span><span class="op">(</span><span class="va">Winters_temps_to_plot</span>, cols <span class="op">=</span> <span class="va">Temp</span><span class="op">:</span><span class="va">Temp_ideal</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">Winters_temps_to_plot</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DATE"</span>, <span class="st">"Method"</span>, <span class="st">"Temperature"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">Winters_temps_to_plot</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">DATE</span>, <span class="va">Temperature</span>, colour <span class="op">=</span> <span class="va">Method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Temperature (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/8.1.2a-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># This plots shows that the triangular curve is quite far off the mark.</span></span>
<span><span class="co"># Temp_empirical and Temp_ideal look pretty similar and are hard to</span></span>
<span><span class="co"># distinguish.</span></span>
<span></span>
<span><span class="co"># Use the `Root Mean Square Error` function-- useful for quantifying the</span></span>
<span><span class="co"># correspondence between predicted and observed values-- to compare these</span></span>
<span><span class="co"># curves a bit more thoroughly by computing</span></span>
<span></span>
<span><span class="co"># here's the RMSE for the triangular method:</span></span>
<span><span class="fu">chillR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/RMSEP.html">RMSEP</a></span><span class="op">(</span><span class="va">Winters_temps</span><span class="op">$</span><span class="va">Temp_triangular</span>, <span class="va">Winters_temps</span><span class="op">$</span><span class="va">Temp</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 4.695289</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># here's the RMSE for the idealized-curve method:</span></span>
<span><span class="fu">chillR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/RMSEP.html">RMSEP</a></span><span class="op">(</span><span class="va">Winters_temps</span><span class="op">$</span><span class="va">Temp_ideal</span>, <span class="va">Winters_temps</span><span class="op">$</span><span class="va">Temp</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 1.630714</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb73"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># and here's the RMSE for the empirical-curve method:</span></span>
<span><span class="fu">chillR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/RMSEP.html">RMSEP</a></span><span class="op">(</span><span class="va">Winters_temps</span><span class="op">$</span><span class="va">Temp_empirical</span>, <span class="va">Winters_temps</span><span class="op">$</span><span class="va">Temp</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 1.410625</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># RMSE of 4.7 for the triangular method, an RMSE of 1.63 for the</span></span>
<span><span class="co"># idealized-curve method, and an RMSE of 1.41 for the empirical-curve method.</span></span>
<span><span class="co"># Since this metric should be low, we see that calibrating the prediction</span></span>
<span><span class="co"># function with observed hourly data brought some advantages, in particular</span></span>
<span><span class="co"># when compared with the triangular method.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section></section></section><section id="exercise-on-hourly-temperatures" class="level3"><h3 class="anchored" data-anchor-id="exercise-on-hourly-temperatures">
<span style="color:#71797E">8.2</span>&nbsp; Exercise on hourly temperatures</h3>
<div style="height: 18px;">

</div>
<p><strong><em>1. Choose a location of interest, find out its latitude and produce plots of daily sunrise, sunset and daylength.</em></strong></p>
<p>My location of interest is Mössigen, an orchard town in Baden-Württemberg, which is a state that ranks highest among regions for cultivation of top fruits, according to the <a href="https://www.destatis.de/EN/Themes/Economic-Sectors-Enterprises/Agriculture-Forestry-Fisheries/Fruit-Vegetables-Horticulture/Tables/2-2-area-of-tree-fruits-laender.html">report</a> by Statistisches Bundesmat. The GPS coordinates of Mössigen are 48.40567° N latitude, and 9.05419° E longitude, as stated in <a href="https://database.earth/countries/germany/regions/baden-wurttemberg/cities/mossingen">database.earth</a>.</p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb76"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Compute daylength</span></span>
<span><span class="va">MS_days</span> <span class="op">&lt;-</span> <span class="fu">daylength</span><span class="op">(</span>latitude <span class="op">=</span> <span class="fl">48.4</span>, JDay <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">365</span><span class="op">)</span></span>
<span><span class="va">MS_days_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>JDay <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, Sunrise <span class="op">=</span> <span class="va">MS_days</span><span class="op">$</span><span class="va">Sunrise</span>, Sunset <span class="op">=</span> <span class="va">MS_days</span><span class="op">$</span><span class="va">Sunset</span>,</span>
<span>    Daylength <span class="op">=</span> <span class="va">MS_days</span><span class="op">$</span><span class="va">Daylength</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert data.frame for ggplot</span></span>
<span><span class="va">MS_days_df</span> <span class="op">&lt;-</span> <span class="fu">pivot_longer</span><span class="op">(</span><span class="va">MS_days_df</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Sunrise</span><span class="op">:</span><span class="va">Daylength</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">MS_days_df</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">JDay</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu">facet_grid</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Time of Day / Daylength (Hours)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/8.2.1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p><strong><em>2. Produce an hourly dataset, based on idealized daily curves, for the <code>KA_weather</code> dataset (included in <code>chillR</code>)</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># I want to produce an hourly dataset for 4 October 1998 Chose values for one</span></span>
<span><span class="co"># day before and one day after as they can impact the curve</span></span>
<span><span class="va">KA_weather_subset</span> <span class="op">&lt;-</span> <span class="va">KA_weather</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Year</span> <span class="op">==</span> <span class="fl">1998</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Month</span> <span class="op">==</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Day</span> <span class="op">==</span> <span class="fl">3</span> <span class="op">|</span> <span class="va">Day</span> <span class="op">==</span> <span class="fl">4</span> <span class="op">|</span> <span class="va">Day</span> <span class="op">==</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Produce hourly dataset</span></span>
<span><span class="va">MS_sh_data</span> <span class="op">&lt;-</span> <span class="fu">stack_hourly_temps</span><span class="op">(</span><span class="va">KA_weather_subset</span>, latitude <span class="op">=</span> <span class="fl">48.4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select the hourtemps output only</span></span>
<span><span class="va">MS_sh_data</span> <span class="op">&lt;-</span> <span class="va">MS_sh_data</span><span class="op">[[</span><span class="st">"hourtemps"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Filter for day 4</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">MS_sh_data</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Day</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">JDay</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Hour</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5.333759</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5.277981</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5.228638</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5.184396</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5.144299</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5.107636</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">5.073866</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">5.712152</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">6.472033</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">7.176185</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">7.796004</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">8.306316</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">8.686392</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">8.920794</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">9.000000</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">8.920794</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">8.686392</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">8.306316</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">7.764207</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">7.299387</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">7.010700</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">6.800761</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">6.635690</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">6.499645</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p><strong><em>3. Produce empirical temperature curve parameters for the <code>Winters_hours_gaps</code> dataset, and use them to predict hourly values from daily temperatures (this is very similar to the example above, but please make sure you understand what’s going on)</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb78"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Produce empirical daily temperature coefficients from observed hourly data</span></span>
<span><span class="va">WH_empi_temp_coeff</span> <span class="op">&lt;-</span> <span class="fu">Empirical_daily_temperature_curve</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fill the missing gaps in hourly data of daily records</span></span>
<span><span class="va">WH_daily</span> <span class="op">&lt;-</span> <span class="fu">make_all_day_table</span><span class="op">(</span><span class="va">Winters_hours_gaps</span>, input_timestep <span class="op">=</span> <span class="st">"hour"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Predict hourly temperatures from daily dataset using the obtained</span></span>
<span><span class="co"># coefficients</span></span>
<span><span class="va">WH_hours</span> <span class="op">&lt;-</span> <span class="fu">Empirical_hourly_temperatures</span><span class="op">(</span><span class="va">WH_daily</span>, <span class="va">WH_empi_temp_coeff</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select necessary columns from WH_hours dataset</span></span>
<span><span class="va">WH_hours</span> <span class="op">&lt;-</span> <span class="va">WH_hours</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span>, <span class="st">"Month"</span>, <span class="st">"Day"</span>, <span class="st">"Hour"</span>, <span class="st">"Temp"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Rename the last column 'Temp' to 'Temp_empirical'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">WH_hours</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">WH_hours</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Temp_empirical"</span></span>
<span></span>
<span><span class="co"># Merge predicted WH_hours with Winter_hours_gaps dataset to display observed</span></span>
<span><span class="co"># vs. approximated temperatures</span></span>
<span><span class="va">WH_temps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">Winters_hours_gaps</span>, <span class="va">WH_hours</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span>, <span class="st">"Month"</span>, <span class="st">"Day"</span>, <span class="st">"Hour"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add a new 'DATE' column with R's date format for plotting purpose</span></span>
<span><span class="va">WH_temps</span><span class="op">[</span>, <span class="st">"DATE"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="va">WH_temps</span><span class="op">$</span><span class="va">Year</span>, <span class="va">WH_temps</span><span class="op">$</span><span class="va">Month</span>, <span class="va">WH_temps</span><span class="op">$</span><span class="va">Day</span>, <span class="va">WH_temps</span><span class="op">$</span><span class="va">Hour</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select the necessary columns and add into a new data.frame</span></span>
<span><span class="va">WH_temps_to_plot</span> <span class="op">&lt;-</span> <span class="va">WH_temps</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DATE"</span>, <span class="st">"Temp"</span>, <span class="st">"Temp_empirical"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Specify rows 300-400 (October 20-25) to plot</span></span>
<span><span class="va">WH_temps_to_plot</span> <span class="op">&lt;-</span> <span class="va">WH_temps_to_plot</span><span class="op">[</span><span class="fl">300</span><span class="op">:</span><span class="fl">400</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Stack columns into rows for plotting</span></span>
<span><span class="va">WH_temps_to_plot</span> <span class="op">&lt;-</span> <span class="fu">pivot_longer</span><span class="op">(</span><span class="va">WH_temps_to_plot</span>, cols <span class="op">=</span> <span class="va">Temp</span><span class="op">:</span><span class="va">Temp_empirical</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Rename columns for graph display</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">WH_temps_to_plot</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DATE"</span>, <span class="st">"Method"</span>, <span class="st">"Temperature"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">WH_temps_to_plot</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">DATE</span>, <span class="va">Temperature</span>, colour <span class="op">=</span> <span class="va">Method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Temperature (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/8.2.3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section></section><section id="chapter-9-some-useful-tools-in-r" class="level2"><h2 class="anchored" data-anchor-id="chapter-9-some-useful-tools-in-r">Chapter 9: Some useful tools in R</h2>
<section id="an-evolving-language-and-a-lifelong-learning-process" class="level3"><h3 class="anchored" data-anchor-id="an-evolving-language-and-a-lifelong-learning-process">
<span style="color:#71797E">9.1</span>&nbsp; An evolving language— and a lifelong learning process</h3>
<div style="height: 18px;">

</div>
<ul>
<li>Possible to solve most problems with <code>base R</code> functions</li>
</ul>
<p><br></p>
</section><section id="the-tidyverse" class="level3"><h3 class="anchored" data-anchor-id="the-tidyverse">
<span style="color:#71797E">9.2</span>&nbsp; The <code>tidyverse</code>
</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>Access the whole collection of the <code>tidyverse</code> package <a href="https://www.tidyverse.org/">here.</a></p></li>
<li><p>Load <code><a href="https://tidyverse.tidyverse.org">library(tidyverse)</a></code> to access the package</p></li>
</ul>
<p><br></p>
</section><section id="the-ggplot2-package" class="level3"><h3 class="anchored" data-anchor-id="the-ggplot2-package">
<span style="color:#71797E">9.3</span>&nbsp; The <code>ggplot2</code> package</h3>
<div style="height: 18px;">

</div>
<ul>
<li>A great introduction to ggplot2 and links to various tutorials etc. can be accessed <a href="https://ggplot2.tidyverse.org/">here.</a>
</li>
</ul>
<p><br></p>
</section><section id="the-tibble-package" class="level3"><h3 class="anchored" data-anchor-id="the-tibble-package">
<span style="color:#71797E">9.3</span>&nbsp; The <code>tibble</code> package</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>A <code>tibble</code> is an advanced version of a <code>data.frame</code>, which includes several improvements.</p></li>
<li><p>A <code>tibble</code> doesn’t follow the classic <code>data.frame</code> habit of converting strings to factors at times when you don’t expect it.</p></li>
<li><p>Read more <a href="https://tibble.tidyverse.org/">here.</a></p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use as_tibble command to create a normal data.frame (or a similar structure)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
      a     b
  &lt;dbl&gt; &lt;dbl&gt;
1     1     4
2     2     5
3     3     6</code></pre>
</div>
</div>
<p><br></p>
</section><section id="the-magrittr-package-pipes" class="level3"><h3 class="anchored" data-anchor-id="the-magrittr-package-pipes">
<span style="color:#71797E">9.5</span>&nbsp; The <code>magrittr</code> package— pipes</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>The main thing <code>magrittr</code> adds is a structure to organize workflows that are applied to the same dataset.</p></li>
<li><p>A data structure such as a <code>tibble</code> can be subjected to one or multiple operations organized in a pipe— <code>%&gt;%</code></p></li>
<li><p>After a pipe, the following function always assumes that the first input to the function is the product received through the pipe.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb81"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calculate the sum of all numbers in the tibble 'd' created above</span></span>
<span><span class="va">d</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 21</code></pre>
</div>
</div>
<p><br></p>
</section><section id="the-tidyr-package" class="level3"><h3 class="anchored" data-anchor-id="the-tidyr-package">
<span style="color:#71797E">9.6</span>&nbsp; The <code>tidyr</code> package</h3>
<div style="height: 18px;">

</div>
<ul>
<li>Provides useful functions for organizing data.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb83"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use KA_weather dataset to see how it works</span></span>
<span><span class="va">KAw</span> <span class="op">&lt;-</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="va">KA_weather</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="va">KAw</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
    Year Month   Day  Tmax  Tmin
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  1998     1     1   8.2   5.1
 2  1998     1     2   9.1   5  
 3  1998     1     3  10.4   3.3
 4  1998     1     4   8.4   4.5
 5  1998     1     5   7.7   4.5
 6  1998     1     6   8.1   4.4
 7  1998     1     7  12     6.9
 8  1998     1     8  11.2   8.6
 9  1998     1     9  13.9   8.5
10  1998     1    10  14.5   3.6</code></pre>
</div>
</div>
<p><br></p>
<section id="pivot_longer" class="level4"><h4 class="anchored" data-anchor-id="pivot_longer">
<span style="color:#71797E">9.6.1</span>&nbsp; <code>pivot_longer</code>
</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>Use <code>pivot_longer</code> to transfer data from separate columns into distinct rows.</p></li>
<li><p>Stack one row of a column over another row of another column— often necessary, for instance, when using <code>ggplot2</code> package for plotting data.</p></li>
<li><p><code>pivot_longer</code> fulfills a similar function to the <code>melt</code> function of the <code>reshape2</code> package</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb85"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Generate a table with one row containing Tmin and one row for Tmax for each</span></span>
<span><span class="co"># day of the record (with a pipe)</span></span>
<span><span class="va">KAwlong</span> <span class="op">&lt;-</span> <span class="va">KAw</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="va">Tmax</span><span class="op">:</span><span class="va">Tmin</span><span class="op">)</span>  <span class="co"># specify column we want to stack up </span></span>
<span></span>
<span><span class="va">KAwlong</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 5
    Year Month   Day name  value
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;dbl&gt;
 1  1998     1     1 Tmax    8.2
 2  1998     1     1 Tmin    5.1
 3  1998     1     2 Tmax    9.1
 4  1998     1     2 Tmin    5  
 5  1998     1     3 Tmax   10.4
 6  1998     1     3 Tmin    3.3
 7  1998     1     4 Tmax    8.4
 8  1998     1     4 Tmin    4.5
 9  1998     1     5 Tmax    7.7
10  1998     1     5 Tmin    4.5
11  1998     1     6 Tmax    8.1
12  1998     1     6 Tmin    4.4
13  1998     1     7 Tmax   12  
14  1998     1     7 Tmin    6.9
15  1998     1     8 Tmax   11.2
16  1998     1     8 Tmin    8.6
17  1998     1     9 Tmax   13.9
18  1998     1     9 Tmin    8.5
19  1998     1    10 Tmax   14.5
20  1998     1    10 Tmin    3.6</code></pre>
</div>
</div>
<p><br></p>
</section><section id="pivot_wider" class="level4"><h4 class="anchored" data-anchor-id="pivot_wider">
<span style="color:#71797E">9.6.2</span>&nbsp; <code>pivot_wider</code>
</h4>
<div style="height: 18px;">

</div>
<ul>
<li>We can also do an opposite conversion to the one implemented by <code>pivot_longer</code> by using the <code>pivot_wider</code> command.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb87"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">KAwwide</span> <span class="op">&lt;-</span> <span class="va">KAwlong</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">name</span><span class="op">)</span>  <span class="co">#can work without () `here`</span></span>
<span><span class="co"># name_from specifies the column that contains new column header</span></span>
<span></span>
<span><span class="va">KAwwide</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
    Year Month   Day  Tmax  Tmin
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  1998     1     1   8.2   5.1
 2  1998     1     2   9.1   5  
 3  1998     1     3  10.4   3.3
 4  1998     1     4   8.4   4.5
 5  1998     1     5   7.7   4.5
 6  1998     1     6   8.1   4.4
 7  1998     1     7  12     6.9
 8  1998     1     8  11.2   8.6
 9  1998     1     9  13.9   8.5
10  1998     1    10  14.5   3.6</code></pre>
</div>
</div>
<p><br></p>
</section><section id="select" class="level4"><h4 class="anchored" data-anchor-id="select">
<span style="color:#71797E">9.6.3</span>&nbsp; <code>select</code>
</h4>
<div style="height: 18px;">

</div>
<ul>
<li>
<code>select</code> function picks out a subset of the columns of a <code>data.frame</code> or <code>tibble</code>.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb89"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">KAw</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Month</span>, <span class="va">Day</span>, <span class="va">Tmax</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   Month   Day  Tmax
   &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
 1     1     1   8.2
 2     1     2   9.1
 3     1     3  10.4
 4     1     4   8.4
 5     1     5   7.7
 6     1     6   8.1
 7     1     7  12  
 8     1     8  11.2
 9     1     9  13.9
10     1    10  14.5</code></pre>
</div>
</div>
<p><br></p>
</section><section id="filter" class="level4"><h4 class="anchored" data-anchor-id="filter">
<span style="color:#71797E">9.6.4</span>&nbsp; <code>filter</code>
</h4>
<div style="height: 18px;">

</div>
<ul>
<li>The <code>filter</code> function reduces a <code>data.frame</code> or <code>tibble</code> to just the rows that fulfill certain conditions.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb91"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">KAw</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Tmax</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
   Year Month   Day  Tmax  Tmin
  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
1  1998     1     3  10.4   3.3
2  1998     1     7  12     6.9
3  1998     1     8  11.2   8.6
4  1998     1     9  13.9   8.5
5  1998     1    10  14.5   3.6</code></pre>
</div>
</div>
<p><br></p>
</section><section id="mutate" class="level4"><h4 class="anchored" data-anchor-id="mutate">
<span style="color:#71797E">9.6.5</span>&nbsp; <code>mutate</code>
</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>The <code>mutate</code> function creates, modifies, and deletes columns from a <code>data.frame</code> or <code>tibble</code>.</p></li>
<li><p>Check out <a href="https://dplyr.tidyverse.org/reference/mutate.html">help file</a> for more options that can be done with <code>mutate</code>.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb93"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create two new columns that contain Tmin and Tmax in Kelvin</span></span>
<span><span class="va">KAw_K</span> <span class="op">&lt;-</span> <span class="va">KAw</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>Tmax_K <span class="op">=</span> <span class="va">Tmax</span> <span class="op">+</span> <span class="fl">273.5</span>, Tmin_K <span class="op">=</span> <span class="va">Tmin</span> <span class="op">+</span> <span class="fl">273.15</span><span class="op">)</span></span>
<span></span>
<span><span class="va">KAw_K</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 7
    Year Month   Day  Tmax  Tmin Tmax_K Tmin_K
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1  1998     1     1   8.2   5.1   282.   278.
 2  1998     1     2   9.1   5     283.   278.
 3  1998     1     3  10.4   3.3   284.   276.
 4  1998     1     4   8.4   4.5   282.   278.
 5  1998     1     5   7.7   4.5   281.   278.
 6  1998     1     6   8.1   4.4   282.   278.
 7  1998     1     7  12     6.9   286.   280.
 8  1998     1     8  11.2   8.6   285.   282.
 9  1998     1     9  13.9   8.5   287.   282.
10  1998     1    10  14.5   3.6   288    277.</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb95"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Delete these columns again, by setting them to NULL</span></span>
<span><span class="va">KAw_K</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>Tmin_K <span class="op">=</span> <span class="cn">NULL</span>, Tmax_K <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
    Year Month   Day  Tmax  Tmin
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  1998     1     1   8.2   5.1
 2  1998     1     2   9.1   5  
 3  1998     1     3  10.4   3.3
 4  1998     1     4   8.4   4.5
 5  1998     1     5   7.7   4.5
 6  1998     1     6   8.1   4.4
 7  1998     1     7  12     6.9
 8  1998     1     8  11.2   8.6
 9  1998     1     9  13.9   8.5
10  1998     1    10  14.5   3.6</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb97"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Replace the original temperature values directly with the Kelvin values.</span></span>
<span><span class="va">KAw</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>Tmin <span class="op">=</span> <span class="va">Tmin</span> <span class="op">+</span> <span class="fl">273.15</span>, Tmax <span class="op">=</span> <span class="va">Tmax</span> <span class="op">+</span> <span class="fl">273.15</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
    Year Month   Day  Tmax  Tmin
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  1998     1     1  281.  278.
 2  1998     1     2  282.  278.
 3  1998     1     3  284.  276.
 4  1998     1     4  282.  278.
 5  1998     1     5  281.  278.
 6  1998     1     6  281.  278.
 7  1998     1     7  285.  280.
 8  1998     1     8  284.  282.
 9  1998     1     9  287.  282.
10  1998     1    10  288.  277.</code></pre>
</div>
</div>
<p><br></p>
</section><section id="arrange" class="level4"><h4 class="anchored" data-anchor-id="arrange">
<span style="color:#71797E">9.6.6</span>&nbsp; <code>arrange</code>
</h4>
<div style="height: 18px;">

</div>
<ul>
<li>
<code>arrange</code> is a function to sort data in <code>data.frames</code> or <code>tibbles</code>.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb99"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">KAw</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="va">Tmax</span>, <span class="va">Tmin</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
    Year Month   Day  Tmax  Tmin
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  1998     1     5   7.7   4.5
 2  1998     1     6   8.1   4.4
 3  1998     1     1   8.2   5.1
 4  1998     1     4   8.4   4.5
 5  1998     1     2   9.1   5  
 6  1998     1     3  10.4   3.3
 7  1998     1     8  11.2   8.6
 8  1998     1     7  12     6.9
 9  1998     1     9  13.9   8.5
10  1998     1    10  14.5   3.6</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb101"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Sort in descending order</span></span>
<span><span class="va">KAw</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">Tmax</span><span class="op">)</span>, <span class="va">Tmin</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
    Year Month   Day  Tmax  Tmin
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  1998     1    10  14.5   3.6
 2  1998     1     9  13.9   8.5
 3  1998     1     7  12     6.9
 4  1998     1     8  11.2   8.6
 5  1998     1     3  10.4   3.3
 6  1998     1     2   9.1   5  
 7  1998     1     4   8.4   4.5
 8  1998     1     1   8.2   5.1
 9  1998     1     6   8.1   4.4
10  1998     1     5   7.7   4.5</code></pre>
</div>
</div>
<p><br></p>
</section></section><section id="loops" class="level3"><h3 class="anchored" data-anchor-id="loops">
<span style="color:#71797E">9.7</span>&nbsp; Loops</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>A loop repeats the same operation many times without having to explicitly retype (or copy and paste) the code.</p></li>
<li><p>More importantly, it also runs the same code while introducing certain modifications in every run.</p></li>
<li><p>Two basic types of loops: <code>for</code> loops and <code>while</code> loops— both functions need instructions that regulate the number of runs, as well as instructions on what to do in each of the runs.</p></li>
<li><p>Read detailed explanations on loops <a href="https://intro2r.com/loops.html">here.</a></p></li>
</ul>
<p><br></p>
<section id="for-loops" class="level4"><h4 class="anchored" data-anchor-id="for-loops">
<span style="color:#71797E">9.7.1</span>&nbsp; <code>for</code> loops</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>A <code>for</code> loop requires explicit instructions on how many times the code within the loop should be run.</p></li>
<li><p>This is usually specified by providing a vector or list of elements and instructing R to run the code for each of these elements.</p></li>
<li><p>This means that the number of times the code is run equals the number of elements in the vector or list.</p></li>
<li><p>We need a <em>counter</em> (often called <code>i</code> but can also be any other variable name) to keep track of which run we’re in.</p></li>
<li><p>The <em>counter</em> doesn’t have to be numeric, but it can assume many other shapes, e.g.&nbsp;that of a string.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb103"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Run the code three times with for command</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Hello"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] "Hello"
[1] "Hello"
[1] "Hello"</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb105"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Make the structure more complex by providing multiple lines of code within</span></span>
<span><span class="co"># winged brackets</span></span>
<span><span class="va">addition</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="co"># operation is embedded in a loop</span></span>
<span><span class="op">{</span> </span>
<span>  <span class="va">addition</span> <span class="op">&lt;-</span> <span class="va">addition</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">addition</span><span class="op">)</span> <span class="co"># need to instruct R to print value</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 2
[1] 3
[1] 4</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb107"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use i in more creative ways</span></span>
<span><span class="va">names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Paul"</span>, <span class="st">"Mary"</span>, <span class="st">"John"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Hello"</span>, <span class="va">names</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] "Hello Paul"
[1] "Hello Mary"
[1] "Hello John"</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb109"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Non-numerical counter</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Paul"</span>, <span class="st">"Mary"</span>, <span class="st">"John"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Hello"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] "Hello Paul"
[1] "Hello Mary"
[1] "Hello John"</code></pre>
</div>
</div>
<p><br></p>
</section><section id="while-loops" class="level4"><h4 class="anchored" data-anchor-id="while-loops">
<span style="color:#71797E">9.7.2</span>&nbsp; <code>while</code> loops</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>A loop with a <code>while</code> statement will run, until the specified condition is no longer fulfilled.</p></li>
<li><p>This only makes sense, of course, if the condition can change as a result of what happens inside the loop.</p></li>
<li><p>Note that <code>while</code> loops can easily cause problems if the condition remains fulfilled regardless of what happens in the code block. Your code will then get hung up and needs to be cancelled manually.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb111"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Run the `while` loop till the condition is met-- stop running when cond</span></span>
<span><span class="co"># reaches 0 (no longer fulfilled)</span></span>
<span><span class="va">cond</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="kw">while</span> <span class="op">(</span><span class="va">cond</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">cond</span><span class="op">)</span></span>
<span>    <span class="va">cond</span> <span class="op">&lt;-</span> <span class="va">cond</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 5
[1] 4
[1] 3
[1] 2
[1] 1</code></pre>
</div>
</div>
<p><br></p>
</section></section><section id="apply-functions" class="level3"><h3 class="anchored" data-anchor-id="apply-functions">
<span style="color:#71797E">9.8</span>&nbsp; <code>apply</code> functions</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>The functions from the <code>apply</code> family— <code>apply</code>, <code>lapply</code> and <code>sapply</code>— are often a much faster way to apply certain operations to multiple elements at the same time.</p></li>
<li><p>The two central arguments that need to be provided to these functions are the list of items to apply the operation to, and the operation itself.</p></li>
</ul>
<p><br></p>
<section id="sapply" class="level4"><h4 class="anchored" data-anchor-id="sapply">
<span style="color:#71797E">9.8.1</span>&nbsp; <code>sapply</code>
</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>The easiest function to apply an operation to a vector of elements is <code>sapply</code>.</p></li>
<li><p>It only needs two arguments: the vector (<code>X</code>), and the function to be applied (<code>FUN</code>).</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb113"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create a simple function `func` which just adds 1 to an object</span></span>
<span><span class="va">func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">+</span> <span class="fl">1</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="va">func</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 2 3 4 5 6</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb115"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># If we apply this function to a list of numbers, the output is a matrix (but</span></span>
<span><span class="co"># the values are the same).</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, <span class="va">func</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>     [,1]
[1,]    2
[2,]    3
[3,]    4
[4,]    5
[5,]    6</code></pre>
</div>
</div>
<p><br></p>
</section><section id="lapply" class="level4"><h4 class="anchored" data-anchor-id="lapply">
<span style="color:#71797E">9.8.2</span>&nbsp; <code>lapply</code>
</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p><code>lapply</code> function produces output as a list.</p></li>
<li><p>It interprets the input element <code>X</code> as a list and returns a list with as many elements as were provided in that list, with each one containing the output of applying <code>FUN</code> to the respective element.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb117"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="va">func</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 2

[[2]]
[1] 3

[[3]]
[1] 4

[[4]]
[1] 5

[[5]]
[1] 6</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb119"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Note that if the input element X is itself a list, this list is treated as</span></span>
<span><span class="co"># one input element, with FUN applied to the entire list and the result</span></span>
<span><span class="co"># returned as a single list element.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, <span class="va">func</span><span class="op">)</span>  <span class="co"># example to understand how it works</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 2 3 4 5 6</code></pre>
</div>
</div>
<p><br></p>
</section><section id="apply" class="level4"><h4 class="anchored" data-anchor-id="apply">
<span style="color:#71797E">9.8.3</span>&nbsp; <code>apply</code>
</h4>
<div style="height: 18px;">

</div>
<ul>
<li>The basic <code>apply</code> function is for applying functions to arrays, where we can operate either on the rows (<code>MARGIN = 1</code>) or on the columns (<code>MARGIN = 1</code>) of the array. <em>(Not use much)</em>
</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb121"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mat</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    1    2    3
[2,]    1    2    3
[3,]    1    2    3</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb123"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">mat</span>, MARGIN <span class="op">=</span> <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span>  <span class="co"># adding up all the data in each row</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 6 6 6</code></pre>
</div>
</div>
<p><br></p>
</section></section><section id="exercise-on-useful-r-tools" class="level3"><h3 class="anchored" data-anchor-id="exercise-on-useful-r-tools">
<span style="color:#71797E">9.9</span>&nbsp; Exercise on useful R tools</h3>
<div style="height: 18px;">

</div>
<p><strong><em>1. Based on the <code>Winters_hours_gaps</code> dataset, use <code>magrittr</code> pipes and functions of the <code>tidyverse</code> to accomplish the following:</em></strong></p>
<p><strong>a. Convert the dataset into a <code>tibble</code>.</strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb125"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">WHG_tibble</span> <span class="op">&lt;-</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">WHG_tibble</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 6
   Year Month   Day  Hour Temp_gaps  Temp
  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;
1  2008     3     3    10      15.1  15.1
2  2008     3     3    11      17.2  17.2
3  2008     3     3    12      18.7  18.7
4  2008     3     3    13      18.7  18.7
5  2008     3     3    14      18.8  18.8</code></pre>
</div>
</div>
<p><br></p>
<p><strong>b. Select only the top 10 rows of the dataset</strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb127"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">WHG_data</span> <span class="op">&lt;-</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">WHG_data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 6
    Year Month   Day  Hour Temp_gaps  Temp
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1  2008     3     3    10      15.1  15.1
 2  2008     3     3    11      17.2  17.2
 3  2008     3     3    12      18.7  18.7
 4  2008     3     3    13      18.7  18.7
 5  2008     3     3    14      18.8  18.8
 6  2008     3     3    15      19.5  19.5
 7  2008     3     3    16      19.3  19.3
 8  2008     3     3    17      17.7  17.7
 9  2008     3     3    18      15.4  15.4
10  2008     3     3    19      12.7  12.7</code></pre>
</div>
</div>
<p><br></p>
<p><strong>c.&nbsp;Convert the <code>tibble</code> to a <code>long</code> format, with separate rows for <code>Temp_gaps</code> and <code>Temp</code></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb129"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">WHG_data_long</span> <span class="op">&lt;-</span> <span class="va">WHG_tibble</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="va">Temp_gaps</span><span class="op">:</span><span class="va">Temp</span><span class="op">)</span></span>
<span></span>
<span><span class="va">WHG_data_long</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 6
    Year Month   Day  Hour name      value
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;
 1  2008     3     3    10 Temp_gaps  15.1
 2  2008     3     3    10 Temp       15.1
 3  2008     3     3    11 Temp_gaps  17.2
 4  2008     3     3    11 Temp       17.2
 5  2008     3     3    12 Temp_gaps  18.7
 6  2008     3     3    12 Temp       18.7
 7  2008     3     3    13 Temp_gaps  18.7
 8  2008     3     3    13 Temp       18.7
 9  2008     3     3    14 Temp_gaps  18.8
10  2008     3     3    14 Temp       18.8
11  2008     3     3    15 Temp_gaps  19.5
12  2008     3     3    15 Temp       19.5
13  2008     3     3    16 Temp_gaps  19.3
14  2008     3     3    16 Temp       19.3
15  2008     3     3    17 Temp_gaps  17.7
16  2008     3     3    17 Temp       17.7
17  2008     3     3    18 Temp_gaps  15.4
18  2008     3     3    18 Temp       15.4
19  2008     3     3    19 Temp_gaps  12.7
20  2008     3     3    19 Temp       12.7</code></pre>
</div>
</div>
<p><br></p>
<p><strong>d.&nbsp;Use <code>ggplot2</code> to plot <code>Temp_gaps</code> and <code>Temp</code> as facets (point or line plot)</strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb131"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Point plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">WHG_data_long</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">28</span>, <span class="op">]</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">Hour</span>, <span class="va">value</span>, colour <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">facet_grid</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">xlab</span><span class="op">(</span><span class="st">"Hour (JDay 63)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Temperature (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>colour <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Point plot"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/9.9.1d-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb132"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># The first 28 rows is for JDay 63 and there is no missing data in Temp_gaps</span></span>
<span></span>
<span><span class="co">## Line plot</span></span>
<span></span>
<span><span class="co"># So, for the line plot I will choose the JDay with gaps in temperature After</span></span>
<span><span class="co"># checking the dataset, I found JDay 78 has some missing Temp_gaps values JDay</span></span>
<span><span class="co"># 78 (18 MAR 2008) is rows 701:748</span></span>
<span></span>
<span><span class="co"># Line plot of Temp and Temp_gaps for JDay 78</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">WHG_data_long</span><span class="op">[</span><span class="fl">701</span><span class="op">:</span><span class="fl">748</span>, <span class="op">]</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">Hour</span>, <span class="va">value</span>, colour <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_grid</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Hour (JDay 78)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Temperature (°C)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>colour <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Line plot"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/9.9.1d-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p><strong>e. Convert the dataset back to the <code>wide</code> format</strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb133"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">WHG_data_wide</span> <span class="op">&lt;-</span> <span class="va">WHG_data_long</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">pivot_wider</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display for JDay 78</span></span>
<span><span class="va">WHG_data_wide</span><span class="op">[</span><span class="fl">351</span><span class="op">:</span><span class="fl">374</span>, <span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 6
    Year Month   Day  Hour Temp_gaps  Temp
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1  2008     3    18     0     NA    11.4 
 2  2008     3    18     1     NA    11.2 
 3  2008     3    18     2     NA    10.9 
 4  2008     3    18     3     NA     9.58
 5  2008     3    18     4      8.17  8.17
 6  2008     3    18     5      7.04  7.04
 7  2008     3    18     6      6.08  6.08
 8  2008     3    18     7     NA     7.19
 9  2008     3    18     8     NA    12.8 
10  2008     3    18     9     NA    16.0 
# ℹ 14 more rows</code></pre>
</div>
</div>
<p><br></p>
<p><strong>f.&nbsp;Select only the following columns: <code>Year</code>, <code>Month</code>, <code>Day</code> and <code>Temp</code></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb135"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">WHG_data_wide</span><span class="op">[</span><span class="fl">351</span><span class="op">:</span><span class="fl">374</span>, <span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Year</span>, <span class="va">Month</span>, <span class="va">Day</span>, <span class="va">Temp</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 4
    Year Month   Day  Temp
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
 1  2008     3    18 11.4 
 2  2008     3    18 11.2 
 3  2008     3    18 10.9 
 4  2008     3    18  9.58
 5  2008     3    18  8.17
 6  2008     3    18  7.04
 7  2008     3    18  6.08
 8  2008     3    18  7.19
 9  2008     3    18 12.8 
10  2008     3    18 16.0 
# ℹ 14 more rows</code></pre>
</div>
</div>
<p><br></p>
<p><strong>g. Sort the dataset by the <code>Temp</code> column, in descending order</strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb137"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">WHG_data_wide</span><span class="op">[</span><span class="fl">351</span><span class="op">:</span><span class="fl">374</span>, <span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">Temp</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 6
    Year Month   Day  Hour Temp_gaps  Temp
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1  2008     3    18    15      NA    24.7
 2  2008     3    18    14      NA    24.1
 3  2008     3    18    13      NA    23.6
 4  2008     3    18    16      NA    23.6
 5  2008     3    18    12      23.1  23.1
 6  2008     3    18    17      NA    22.0
 7  2008     3    18    11      21.4  21.4
 8  2008     3    18    18      20.1  20.1
 9  2008     3    18    10      19.3  19.3
10  2008     3    18    19      16.9  16.9
# ℹ 14 more rows</code></pre>
</div>
</div>
<p><br></p>
<p><strong><em>2. For the <code>Winter_hours_gaps</code> dataset, write a <code>for</code> loop to convert all temperatures (Temp column) to degrees Fahrenheit</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb139"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># I want this output to match the output from 1.g</span></span>
<span><span class="va">WHG_JDay78</span> <span class="op">&lt;-</span> <span class="va">WHG_data_wide</span><span class="op">[</span><span class="fl">351</span><span class="op">:</span><span class="fl">374</span>, <span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">Temp</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">WHG_JDay78</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">WHG_JDay78</span><span class="op">$</span><span class="va">Temp</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">WHG_JDay78</span><span class="op">$</span><span class="va">Temp</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="fl">1.8</span> <span class="op">+</span> <span class="fl">32</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">WHG_JDay78</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 6
    Year Month   Day  Hour Temp_gaps  Temp
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1  2008     3    18    15      NA    76.5
 2  2008     3    18    14      NA    75.4
 3  2008     3    18    13      NA    74.6
 4  2008     3    18    16      NA    74.4
 5  2008     3    18    12      23.1  73.5
 6  2008     3    18    17      NA    71.6
 7  2008     3    18    11      21.4  70.5
 8  2008     3    18    18      20.1  68.2
 9  2008     3    18    10      19.3  66.8
10  2008     3    18    19      16.9  62.5
# ℹ 14 more rows</code></pre>
</div>
</div>
<p><br></p>
<p><strong><em>3. Execute the same operation with a function from the <code>apply</code> family</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb141"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">WHG_JDay78_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">1.8</span> <span class="op">+</span> <span class="fl">32</span></span>
<span></span>
<span><span class="co"># Apply function to Temp column only</span></span>
<span><span class="va">WHG_data_wide</span><span class="op">$</span><span class="va">Temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">WHG_data_wide</span><span class="op">$</span><span class="va">Temp</span>, <span class="va">WHG_JDay78_function</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print in descending order</span></span>
<span><span class="va">WHG_data_wide</span><span class="op">[</span><span class="fl">351</span><span class="op">:</span><span class="fl">374</span>, <span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">Temp</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 6
    Year Month   Day  Hour Temp_gaps  Temp
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1  2008     3    18    15      NA    76.5
 2  2008     3    18    14      NA    75.4
 3  2008     3    18    13      NA    74.6
 4  2008     3    18    16      NA    74.4
 5  2008     3    18    12      23.1  73.5
 6  2008     3    18    17      NA    71.6
 7  2008     3    18    11      21.4  70.5
 8  2008     3    18    18      20.1  68.2
 9  2008     3    18    10      19.3  66.8
10  2008     3    18    19      16.9  62.5
# ℹ 14 more rows</code></pre>
</div>
</div>
<p><br></p>
<p><strong><em>4. Now use the <code>tidyverse</code> function <code>mutate</code> to achieve the same outcome</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb143"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Call the WHG_data_wide again to run the original values</span></span>
<span><span class="va">WHG_data_wide</span> <span class="op">&lt;-</span> <span class="va">WHG_data_long</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">pivot_wider</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">WHG_mutate</span> <span class="op">&lt;-</span> <span class="va">WHG_data_wide</span><span class="op">[</span><span class="fl">351</span><span class="op">:</span><span class="fl">374</span>, <span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>Temp_C <span class="op">=</span> <span class="va">Temp</span>, Temp_F <span class="op">=</span> <span class="va">Temp</span> <span class="op">*</span> <span class="fl">1.8</span> <span class="op">+</span> <span class="fl">32</span>, Temp <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="va">WHG_mutate</span> <span class="op">&lt;-</span> <span class="va">WHG_mutate</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">Temp_F</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">WHG_mutate</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 7
    Year Month   Day  Hour Temp_gaps Temp_C Temp_F
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1  2008     3    18    15      NA     24.7   76.5
 2  2008     3    18    14      NA     24.1   75.4
 3  2008     3    18    13      NA     23.6   74.6
 4  2008     3    18    16      NA     23.6   74.4
 5  2008     3    18    12      23.1   23.1   73.5
 6  2008     3    18    17      NA     22.0   71.6
 7  2008     3    18    11      21.4   21.4   70.5
 8  2008     3    18    18      20.1   20.1   68.2
 9  2008     3    18    10      19.3   19.3   66.8
10  2008     3    18    19      16.9   16.9   62.5
# ℹ 14 more rows</code></pre>
</div>
</div>
<p><br></p>
<p><strong><em>5. Voluntary: consider taking a look at the instruction materials on all these functions, which I linked above, as well as at other sources on the internet. There’s a lot more to discover here, with lots of potential for making your coding more elegant and easier - and possibly even more fun!</em></strong></p>
<p><br></p>
</section></section><section id="chapter-10-getting-temperature-data" class="level2"><h2 class="anchored" data-anchor-id="chapter-10-getting-temperature-data">Chapter 10: Getting temperature data</h2>
<section id="temperature-data-needs" class="level3"><h3 class="anchored" data-anchor-id="temperature-data-needs">
<span style="color:#71797E">10.1</span>&nbsp; Temperature data needs</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>It is preferable to have a high-quality dataset collected in the exact place that you want to analyze.</p></li>
<li><p>If we don’t have such data, however, there are a few databases out there that we can draw on as an alternative option— <code>chillR</code> has access to one global database and one for California.</p></li>
</ul>
<p><br></p>
</section><section id="the-global-summary-of-the-day-database" class="level3"><h3 class="anchored" data-anchor-id="the-global-summary-of-the-day-database">
<span style="color:#71797E">10.2</span>&nbsp; The Global Summary of the Day database</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>An invaluable source of temperature data: <a href="https://www.geoplatform.gov/metadata/89cd9f7c-c14a-4ec2-a51d-7f69dc46ea41">Global Summary of the Day (GSOD) database</a> by the <a href="https://www.ncei.noaa.gov/">National Centers for Environmental Information (NCEI), formerly the National Climatic Data Center (NCDC)</a> of the <a href="https://www.noaa.gov/">United States National Oceanic and Atmospheric Administration (NOAA)</a>— direct access to the weather data <a href="https://www.ncei.noaa.gov/data/global-summary-of-the-day/access/">here.</a></p></li>
<li><p><code>chillR</code> automates the tedious data download and assembling process</p></li>
<li><p><code><a href="https://rdrr.io/pkg/chillR/man/handle_gsod.html">handle_gsod()</a></code> can take care of all data retrieval steps by telling the function’s <code>action</code> parameter on what to do, since there are multiple steps involved.</p></li>
</ul>
<p><br></p>
<section id="actionlist_stations" class="level4"><h4 class="anchored" data-anchor-id="actionlist_stations">
<span style="color:#71797E">10.2.1</span>&nbsp; <code>action=list_stations</code>
</h4>
<div style="height: 18px;">

</div>
<ul>
<li>
<code><a href="https://rdrr.io/pkg/chillR/man/handle_gsod.html">handle_gsod()</a></code> retrieves the station list and sorts the station based on their proximity to a set of coordinates we specify.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb145"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Search for stations near Bonn (Latitude: 50.73, Longitude: 7.10)</span></span>
<span><span class="va">station_list</span> <span class="op">&lt;-</span> <span class="fu">handle_gsod</span><span class="op">(</span>action <span class="op">=</span> <span class="st">"list_stations"</span>, location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>long <span class="op">=</span> <span class="fl">7.1</span>, lat <span class="op">=</span> <span class="fl">50.73</span><span class="op">)</span>,</span>
<span>    time_interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1990</span>, <span class="fl">2020</span><span class="op">)</span><span class="op">)</span>  <span class="co"># limit search data</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">station_list</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">chillR_code</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">STATION.NAME</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">CTRY</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Lat</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Long</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BEGIN</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">END</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Distance</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Overlap_years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_interval_covered</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">10517099999</td>
<td style="text-align: left;">BONN/FRIESDORF(AUT)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.700</td>
<td style="text-align: right;">7.150</td>
<td style="text-align: right;">19360102</td>
<td style="text-align: right;">19921231</td>
<td style="text-align: right;">4.86</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">10518099999</td>
<td style="text-align: left;">BONN-HARDTHOEHE</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.700</td>
<td style="text-align: right;">7.033</td>
<td style="text-align: right;">19750523</td>
<td style="text-align: right;">19971223</td>
<td style="text-align: right;">5.78</td>
<td style="text-align: right;">7.98</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10519099999</td>
<td style="text-align: left;">BONN-ROLEBER</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.733</td>
<td style="text-align: right;">7.200</td>
<td style="text-align: right;">20010705</td>
<td style="text-align: right;">20081231</td>
<td style="text-align: right;">7.05</td>
<td style="text-align: right;">7.49</td>
<td style="text-align: right;">24</td>
</tr>
<tr class="even">
<td style="text-align: left;">10513099999</td>
<td style="text-align: left;">KOLN BONN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.866</td>
<td style="text-align: right;">7.143</td>
<td style="text-align: right;">19310101</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">15.44</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10509099999</td>
<td style="text-align: left;">BUTZWEILERHOF(BAFB)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.983</td>
<td style="text-align: right;">6.900</td>
<td style="text-align: right;">19780901</td>
<td style="text-align: right;">19950823</td>
<td style="text-align: right;">31.48</td>
<td style="text-align: right;">5.64</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="even">
<td style="text-align: left;">10502099999</td>
<td style="text-align: left;">NORVENICH</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.831</td>
<td style="text-align: right;">6.658</td>
<td style="text-align: right;">19730101</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">33.08</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10514099999</td>
<td style="text-align: left;">MENDIG</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.366</td>
<td style="text-align: right;">7.315</td>
<td style="text-align: right;">19730102</td>
<td style="text-align: right;">19971231</td>
<td style="text-align: right;">43.28</td>
<td style="text-align: right;">8.00</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: left;">10506099999</td>
<td style="text-align: left;">NUERBURG-BARWEILER</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.367</td>
<td style="text-align: right;">6.867</td>
<td style="text-align: right;">19950401</td>
<td style="text-align: right;">19971231</td>
<td style="text-align: right;">43.64</td>
<td style="text-align: right;">2.75</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10508099999</td>
<td style="text-align: left;">BLANKENHEIM</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.450</td>
<td style="text-align: right;">6.650</td>
<td style="text-align: right;">19781002</td>
<td style="text-align: right;">19840504</td>
<td style="text-align: right;">44.53</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">10510099999</td>
<td style="text-align: left;">NUERBURG</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.333</td>
<td style="text-align: right;">6.950</td>
<td style="text-align: right;">19300901</td>
<td style="text-align: right;">19921231</td>
<td style="text-align: right;">45.45</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10515099999</td>
<td style="text-align: left;">BENDORF</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.417</td>
<td style="text-align: right;">7.583</td>
<td style="text-align: right;">19310102</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">48.79</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="even">
<td style="text-align: left;">10504099999</td>
<td style="text-align: left;">EIFEL</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.650</td>
<td style="text-align: right;">6.283</td>
<td style="text-align: right;">20040501</td>
<td style="text-align: right;">20040501</td>
<td style="text-align: right;">58.30</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10526099999</td>
<td style="text-align: left;">BAD MARIENBERG</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.667</td>
<td style="text-align: right;">7.967</td>
<td style="text-align: right;">19730101</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">61.54</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="even">
<td style="text-align: left;">10613099999</td>
<td style="text-align: left;">BUCHEL</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.174</td>
<td style="text-align: right;">7.063</td>
<td style="text-align: right;">19730101</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">61.95</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10503099999</td>
<td style="text-align: left;">AACHEN/MERZBRUCK</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.817</td>
<td style="text-align: right;">6.183</td>
<td style="text-align: right;">19780901</td>
<td style="text-align: right;">19971212</td>
<td style="text-align: right;">65.28</td>
<td style="text-align: right;">7.95</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: left;">10419099999</td>
<td style="text-align: left;">LUDENSCHEID &amp;</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">51.233</td>
<td style="text-align: right;">7.600</td>
<td style="text-align: right;">19270906</td>
<td style="text-align: right;">20030306</td>
<td style="text-align: right;">66.06</td>
<td style="text-align: right;">13.18</td>
<td style="text-align: right;">43</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10400099999</td>
<td style="text-align: left;">DUSSELDORF</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">51.289</td>
<td style="text-align: right;">6.767</td>
<td style="text-align: right;">19310102</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">66.46</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">10616299999</td>
<td style="text-align: left;">SIEGERLAND</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.708</td>
<td style="text-align: right;">8.083</td>
<td style="text-align: right;">20040510</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">69.33</td>
<td style="text-align: right;">16.65</td>
<td style="text-align: right;">54</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10418099999</td>
<td style="text-align: left;">LUEDENSCHEID</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">51.250</td>
<td style="text-align: right;">7.650</td>
<td style="text-align: right;">19940301</td>
<td style="text-align: right;">19971231</td>
<td style="text-align: right;">69.54</td>
<td style="text-align: right;">3.84</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="even">
<td style="text-align: left;">10437499999</td>
<td style="text-align: left;">MONCHENGLADBACH</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">51.230</td>
<td style="text-align: right;">6.504</td>
<td style="text-align: right;">19960715</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">69.59</td>
<td style="text-align: right;">24.47</td>
<td style="text-align: right;">79</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10403099999</td>
<td style="text-align: left;">MOENCHENGLADBACH</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">51.233</td>
<td style="text-align: right;">6.500</td>
<td style="text-align: right;">19381001</td>
<td style="text-align: right;">19421031</td>
<td style="text-align: right;">70.03</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">10501099999</td>
<td style="text-align: left;">AACHEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.783</td>
<td style="text-align: right;">6.100</td>
<td style="text-align: right;">19280101</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">70.67</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">06496099999</td>
<td style="text-align: left;">ELSENBORN (MIL)</td>
<td style="text-align: left;">BE</td>
<td style="text-align: right;">50.467</td>
<td style="text-align: right;">6.183</td>
<td style="text-align: right;">19840501</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">71.10</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">06495099999</td>
<td style="text-align: left;">BOTRANGE (MOUNT)</td>
<td style="text-align: left;">BE</td>
<td style="text-align: right;">50.500</td>
<td style="text-align: right;">6.100</td>
<td style="text-align: right;">19510201</td>
<td style="text-align: right;">20011015</td>
<td style="text-align: right;">75.13</td>
<td style="text-align: right;">11.79</td>
<td style="text-align: right;">38</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10409099999</td>
<td style="text-align: left;">ESSEN/MUELHEIM</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">51.400</td>
<td style="text-align: right;">6.967</td>
<td style="text-align: right;">19300414</td>
<td style="text-align: right;">19431231</td>
<td style="text-align: right;">75.17</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb146"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 25 closest stations to the location set, ordered by their distance to the</span></span>
<span><span class="co"># target coordinates</span></span>
<span></span>
<span><span class="co"># Overlap_years column: the number of years that are available</span></span>
<span></span>
<span><span class="co"># Perc_interval_covered column: the percentage of the target interval that is</span></span>
<span><span class="co"># covered based on BEGIN and END dates in the table - it’s quite possible (and</span></span>
<span><span class="co"># usually the case) that the dataset contains gaps, which sometimes cover</span></span>
<span><span class="co"># almost the entire record.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section><section id="actiondownload_weather" class="level4"><h4 class="anchored" data-anchor-id="actiondownload_weather">
<span style="color:#71797E">10.2.2</span>&nbsp; <code>action="download_weather"</code>
</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>When used with this option, the <code><a href="https://rdrr.io/pkg/chillR/man/handle_gsod.html">handle_gsod()</a></code> function downloads the weather data for a particular station, based on a station-specific <code>chillR_code</code>.</p></li>
<li><p>Rather than typing the code manually, we can refer to the code in the station_list.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb147"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Download for the 4th entry in the list, which covers most of our period of interest</span></span>
<span>  <span class="va">weather</span> <span class="op">&lt;-</span> <span class="fu">handle_gsod</span><span class="op">(</span>action <span class="op">=</span> <span class="st">"download_weather"</span>,</span>
<span>                       location <span class="op">=</span> <span class="va">station_list</span><span class="op">$</span><span class="va">chillR_code</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, <span class="co">#Koln_bonn airport</span></span>
<span>                       time_interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1990</span>, <span class="fl">2020</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Loading data for 31 years from station 'KOLN BONN'
================================================================================</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb149"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Result is a list of two elements:</span></span>
<span><span class="co"># Element 1 (weather[[1]]) - an indication of the database the data come from</span></span>
<span><span class="co"># Element 2 (weather[[2]]) - the actual dataset</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">weather</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">STATION</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">DATE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LATITUDE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LONGITUDE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ELEVATION</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">NAME</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">TEMP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">TEMP_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">DEWP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">DEWP_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SLP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SLP_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">STP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">STP_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">VISIB</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">VISIB_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">WDSP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">WDSP_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MXSPD</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">GUST</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MAX</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">MAX_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MIN</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">MIN_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">PRCP</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">PRCP_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SNDP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">FRSHTT</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-01</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">32.0</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">30.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">5.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">8.9</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">33.8</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">30.2</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-02</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">33.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">31.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9.9</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">35.6</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">32.0</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">110000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-03</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">33.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">29.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">10.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">15.9</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">35.6</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">31.3</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">100000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-04</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">31.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">27.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">10.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">17.1</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">35.6</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">30.0</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-05</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">34.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">31.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4.4</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">3.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">6.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">37.6</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">30.0</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-06</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">34.4</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">31.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">11.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">15.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">36.3</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">32.0</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-07</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">33.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">29.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">10.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">15.9</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">39.7</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">31.8</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-08</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">37.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">34.0</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6.0</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">7.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9.9</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">44.6</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">31.8</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-09</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">41.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">38.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5.4</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">5.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">11.1</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">46.4</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">38.8</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.02</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-10</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">40.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">37.4</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">5.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">8.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">42.8</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">37.4</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10010</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-11</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">41.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">35.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">6.4</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">8.9</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">44.6</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">37.9</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.01</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-12</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">35.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">31.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">8.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">13.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">41.4</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">30.2</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-13</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">34.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">31.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1028.1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">15.5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">6.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">6.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">11.1</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">39.2</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">29.7</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-14</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">37.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">35.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">4.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">8.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">41.0</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">31.6</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">C</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-15</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">40.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">37.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">7.4</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">11.1</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">48.2</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">33.6</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.04</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-16</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">49.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">45.0</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">7.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">14.0</td>
<td style="text-align: right;">27.0</td>
<td style="text-align: right;">51.8</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">43.2</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-17</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">47.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">40.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">10.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">17.1</td>
<td style="text-align: right;">35.0</td>
<td style="text-align: right;">51.8</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">33.8</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-18</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">36.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">32.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">5.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">12.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">44.6</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">30.2</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-19</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">40.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">33.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">7.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">14.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">44.8</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">35.6</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-20</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">42.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">38.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1024.9</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">12.5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">8.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">14.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">47.3</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">39.2</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.09</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
</tbody>
</table>
</div>
</div>
<div style="height: 18px;">

</div>
<ul>
<li><p>The output looks pretty complicated, and it contains a lot of information we don’t need.</p></li>
<li>
<p><code>chillR</code> has a function to simplify this record. But,</p>
<ul>
<li>This removes a lot of variables you may be interested in.</li>
<li>More importantly, this also removes quality flags, which may indicate that particular records aren’t reliable.</li>
</ul>
</li>
</ul>
<p><br></p>
</section><section id="downloaded-weather-as-action-argument" class="level4"><h4 class="anchored" data-anchor-id="downloaded-weather-as-action-argument">
<span style="color:#71797E">10.2.3</span>&nbsp; downloaded weather as <code>action</code> argument</h4>
<div style="height: 18px;">

</div>
<ul>
<li>This way of calling <code><a href="https://rdrr.io/pkg/chillR/man/handle_gsod.html">handle_gsod()</a></code> serves to clean the dataset and convert it into a format that <code>chillR</code> can easily handle</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb150"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Clean dataset</span></span>
<span><span class="va">cleaned_weather</span> <span class="op">&lt;-</span> <span class="fu">handle_gsod</span><span class="op">(</span><span class="va">weather</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">cleaned_weather</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Date</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Prec</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1990-01-01 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1.000</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-02 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">2.000</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-03 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">-0.389</td>
<td style="text-align: right;">2.000</td>
<td style="text-align: right;">0.722</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-04 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">-1.111</td>
<td style="text-align: right;">2.000</td>
<td style="text-align: right;">-0.056</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-05 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">-1.111</td>
<td style="text-align: right;">3.111</td>
<td style="text-align: right;">1.556</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-06 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">2.389</td>
<td style="text-align: right;">1.333</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-07 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">-0.111</td>
<td style="text-align: right;">4.278</td>
<td style="text-align: right;">1.056</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-08 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">-0.111</td>
<td style="text-align: right;">7.000</td>
<td style="text-align: right;">3.278</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-09 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">3.778</td>
<td style="text-align: right;">8.000</td>
<td style="text-align: right;">5.333</td>
<td style="text-align: right;">0.508</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-10 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">3.000</td>
<td style="text-align: right;">6.000</td>
<td style="text-align: right;">4.556</td>
<td style="text-align: right;">1.016</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-11 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">3.278</td>
<td style="text-align: right;">7.000</td>
<td style="text-align: right;">5.167</td>
<td style="text-align: right;">0.254</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-12 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">-1.000</td>
<td style="text-align: right;">5.222</td>
<td style="text-align: right;">1.778</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-13 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">-1.278</td>
<td style="text-align: right;">4.000</td>
<td style="text-align: right;">1.389</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-14 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">-0.222</td>
<td style="text-align: right;">5.000</td>
<td style="text-align: right;">3.167</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-15 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">0.889</td>
<td style="text-align: right;">9.000</td>
<td style="text-align: right;">4.556</td>
<td style="text-align: right;">1.016</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-16 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">6.222</td>
<td style="text-align: right;">11.000</td>
<td style="text-align: right;">9.944</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-17 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">11.000</td>
<td style="text-align: right;">8.500</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-18 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">-1.000</td>
<td style="text-align: right;">7.000</td>
<td style="text-align: right;">2.722</td>
<td style="text-align: right;">0.254</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-19 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">2.000</td>
<td style="text-align: right;">7.111</td>
<td style="text-align: right;">4.611</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-20 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">4.000</td>
<td style="text-align: right;">8.500</td>
<td style="text-align: right;">6.056</td>
<td style="text-align: right;">2.286</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb151"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Save the output files generated, so that we can use in the next chapters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="st">"data/Bonn"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">station_list</span>, <span class="st">"data/Bonn/station_list.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">weather</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">"data/Bonn/Bonn_raw_weather.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">cleaned_weather</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">"data/Bonn/Bonn_chillR_weather.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div style="height: 18px;">

</div>
<ul>
<li><p>The output record contains many strange numbers— degrees Fahrenheit values in origianl database are converted to degrees Celsius</p></li>
<li><p><span class="math inline">\(Temperature[^\circ C] = (Temperature[^\circ F] - 32) . \frac{5}{9}\)</span></p></li>
<li><p>The dataset still has pretty substantial gaps, including several entire years of missing data— Filling gaps in temperature records</p></li>
<li><p><code>chillR</code> has a pretty similar function to download data from the <a href="https://cimis.water.ca.gov/">California Irrigation Management Information System (CIMIS).</a></p></li>
</ul>
<p><br></p>
</section></section><section id="exercises-on-getting-temperature-data" class="level3"><h3 class="anchored" data-anchor-id="exercises-on-getting-temperature-data">
<span style="color:#71797E">10.3</span>&nbsp; Exercises on getting temperature data</h3>
<div style="height: 18px;">

</div>
<p><strong><em>1. Choose a location of interest and find the 25 closest weather stations using the <code>handle_gsod</code> function</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb152"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Look for stations near M&amp;ouml;ssigen (48.40567° N, 9.05419° E)</span></span>
<span><span class="va">MS_station_list</span> <span class="op">&lt;-</span> <span class="fu">handle_gsod</span><span class="op">(</span>action <span class="op">=</span> <span class="st">"list_stations"</span>, location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>long <span class="op">=</span> <span class="fl">9.05</span>,</span>
<span>    lat <span class="op">=</span> <span class="fl">48.4</span><span class="op">)</span>, time_interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1990</span>, <span class="fl">2020</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">MS_station_list</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">chillR_code</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">STATION.NAME</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">CTRY</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Lat</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Long</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BEGIN</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">END</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Distance</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Overlap_years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_interval_covered</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">10826099999</td>
<td style="text-align: left;">TUBINGEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.517</td>
<td style="text-align: right;">9.050</td>
<td style="text-align: right;">19730101</td>
<td style="text-align: right;">19790809</td>
<td style="text-align: right;">13.02</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">10827099999</td>
<td style="text-align: left;">MESSSTETTEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.183</td>
<td style="text-align: right;">9.000</td>
<td style="text-align: right;">19740820</td>
<td style="text-align: right;">19971231</td>
<td style="text-align: right;">24.44</td>
<td style="text-align: right;">8.00</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10738099999</td>
<td style="text-align: left;">STUTTGART</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.690</td>
<td style="text-align: right;">9.222</td>
<td style="text-align: right;">19390902</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">34.68</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">10828099999</td>
<td style="text-align: left;">SIGMARINGEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.100</td>
<td style="text-align: right;">9.250</td>
<td style="text-align: right;">19950201</td>
<td style="text-align: right;">19971230</td>
<td style="text-align: right;">36.54</td>
<td style="text-align: right;">2.91</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10818099999</td>
<td style="text-align: left;">KLIPPENECK (CLIFF)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.100</td>
<td style="text-align: right;">8.750</td>
<td style="text-align: right;">19300903</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">40.12</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="even">
<td style="text-align: left;">10737099999</td>
<td style="text-align: left;">STUTTGART</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.767</td>
<td style="text-align: right;">9.183</td>
<td style="text-align: right;">19360701</td>
<td style="text-align: right;">20030425</td>
<td style="text-align: right;">42.01</td>
<td style="text-align: right;">13.31</td>
<td style="text-align: right;">43</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10834099999</td>
<td style="text-align: left;">RIEDLINGEN (AUT)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.167</td>
<td style="text-align: right;">9.500</td>
<td style="text-align: right;">19880105</td>
<td style="text-align: right;">19921231</td>
<td style="text-align: right;">42.24</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">10815099999</td>
<td style="text-align: left;">FREUDENSTADT</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.450</td>
<td style="text-align: right;">8.417</td>
<td style="text-align: right;">19730101</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">47.09</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10921099999</td>
<td style="text-align: left;">NEUHAUSEN OB ECK</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">47.983</td>
<td style="text-align: right;">8.900</td>
<td style="text-align: right;">19730102</td>
<td style="text-align: right;">19950228</td>
<td style="text-align: right;">47.74</td>
<td style="text-align: right;">5.16</td>
<td style="text-align: right;">17</td>
</tr>
<tr class="even">
<td style="text-align: left;">10739099999</td>
<td style="text-align: left;">STUTTGART/SCHNARREN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.833</td>
<td style="text-align: right;">9.200</td>
<td style="text-align: right;">19840807</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">49.45</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10832099999</td>
<td style="text-align: left;">TUERKHEIM</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.583</td>
<td style="text-align: right;">9.783</td>
<td style="text-align: right;">20040818</td>
<td style="text-align: right;">20040818</td>
<td style="text-align: right;">57.79</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">10835099999</td>
<td style="text-align: left;">GOPPINGEN(US ARMY)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.717</td>
<td style="text-align: right;">9.700</td>
<td style="text-align: right;">19730102</td>
<td style="text-align: right;">19750214</td>
<td style="text-align: right;">59.49</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10835499999</td>
<td style="text-align: left;">GOPPINGEN (USA-AF)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.717</td>
<td style="text-align: right;">9.700</td>
<td style="text-align: right;">19370104</td>
<td style="text-align: right;">19900201</td>
<td style="text-align: right;">59.49</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">10912099999</td>
<td style="text-align: left;">DONAUESCHINGEN VILLINGEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">47.973</td>
<td style="text-align: right;">8.522</td>
<td style="text-align: right;">20040406</td>
<td style="text-align: right;">20191118</td>
<td style="text-align: right;">61.61</td>
<td style="text-align: right;">15.62</td>
<td style="text-align: right;">50</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10736099999</td>
<td style="text-align: left;">MUEHLACKER (AUT)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.967</td>
<td style="text-align: right;">8.867</td>
<td style="text-align: right;">19790314</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">64.54</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="even">
<td style="text-align: left;">10838099999</td>
<td style="text-align: left;">ULM (MIL/MET)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.383</td>
<td style="text-align: right;">9.950</td>
<td style="text-align: right;">19490101</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">66.56</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10837099999</td>
<td style="text-align: left;">LAUPHEIM</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.220</td>
<td style="text-align: right;">9.910</td>
<td style="text-align: right;">19730102</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">66.75</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">10836099999</td>
<td style="text-align: left;">STOETTEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.667</td>
<td style="text-align: right;">9.867</td>
<td style="text-align: right;">19490101</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">67.16</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10839099999</td>
<td style="text-align: left;">ULM/WILHELMSBURG &amp;</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.400</td>
<td style="text-align: right;">9.983</td>
<td style="text-align: right;">19410116</td>
<td style="text-align: right;">19430430</td>
<td style="text-align: right;">68.96</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">10805199999</td>
<td style="text-align: left;">BADEN OOS</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.791</td>
<td style="text-align: right;">8.187</td>
<td style="text-align: right;">20171201</td>
<td style="text-align: right;">20180522</td>
<td style="text-align: right;">77.02</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10725099999</td>
<td style="text-align: left;">BADEN-OOS</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.800</td>
<td style="text-align: right;">8.183</td>
<td style="text-align: right;">19770803</td>
<td style="text-align: right;">20020311</td>
<td style="text-align: right;">77.83</td>
<td style="text-align: right;">12.19</td>
<td style="text-align: right;">39</td>
</tr>
<tr class="even">
<td style="text-align: left;">10929099999</td>
<td style="text-align: left;">KONSTANZ</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">47.683</td>
<td style="text-align: right;">9.183</td>
<td style="text-align: right;">19360102</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">80.43</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">06671099999</td>
<td style="text-align: left;">STECKBORN</td>
<td style="text-align: left;">CH</td>
<td style="text-align: right;">47.667</td>
<td style="text-align: right;">8.983</td>
<td style="text-align: right;">20120209</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">81.75</td>
<td style="text-align: right;">8.90</td>
<td style="text-align: right;">29</td>
</tr>
<tr class="even">
<td style="text-align: left;">10727599999</td>
<td style="text-align: left;">KARLSRUHE BADEN BADEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.779</td>
<td style="text-align: right;">8.081</td>
<td style="text-align: right;">19970723</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">82.89</td>
<td style="text-align: right;">23.44</td>
<td style="text-align: right;">76</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10702099999</td>
<td style="text-align: left;">KARLSRUHE/BADEN-B</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.783</td>
<td style="text-align: right;">8.083</td>
<td style="text-align: right;">19860107</td>
<td style="text-align: right;">20010918</td>
<td style="text-align: right;">82.99</td>
<td style="text-align: right;">11.72</td>
<td style="text-align: right;">38</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p><strong><em>2. Download weather data for the most promising station on the list</em></strong></p>
<p>The most promising station in my case is the STUTTGART (airport) weather station (<code>chillR_code</code>: 10738099999), which is 34.68 km away from our location of interest.</p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb153"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Download weather data for STUTTGART</span></span>
<span><span class="va">STG_weather</span> <span class="op">&lt;-</span> <span class="fu">handle_gsod</span><span class="op">(</span>action <span class="op">=</span> <span class="st">"download_weather"</span>, location <span class="op">=</span> <span class="va">MS_station_list</span><span class="op">$</span><span class="va">chillR_code</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>    time_interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1990</span>, <span class="fl">2020</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Loading data for 31 years from station 'STUTTGART'
================================================================================</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb155"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Show output in table</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">STG_weather</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">STATION</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">DATE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LATITUDE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LONGITUDE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ELEVATION</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">NAME</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">TEMP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">TEMP_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">DEWP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">DEWP_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SLP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SLP_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">STP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">STP_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">VISIB</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">VISIB_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">WDSP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">WDSP_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MXSPD</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">GUST</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MAX</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">MAX_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MIN</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">MIN_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">PRCP</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">PRCP_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SNDP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">FRSHTT</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-01</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">23.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">22.0</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">0.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1.9</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">35.6</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">15.8</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">100000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-02</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">24.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">23.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">35.6</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">16.9</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">100000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-03</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">29.4</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">28.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">3.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">7.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">30.7</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">24.1</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-04</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">28.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">24.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">3.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">6.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">32.0</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">19.4</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-05</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">27.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">25.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">32.0</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">18.5</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">E</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">111000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-06</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">31.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">30.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2.4</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">39.2</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">26.6</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">1.2</td>
<td style="text-align: right;">1000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-07</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">29.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">27.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">36.3</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">23.0</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">0.8</td>
<td style="text-align: right;">100000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-08</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">29.0</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">27.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2.4</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">2.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">4.1</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">33.8</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">22.6</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">0.8</td>
<td style="text-align: right;">110000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-09</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">30.4</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">30.0</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">4.1</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">32.5</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">24.8</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">100000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-10</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">28.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">28.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">2.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">6.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">30.2</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">27.7</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">100000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-11</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">27.0</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">26.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">3.4</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">6.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">28.8</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">23.0</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">E</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">100000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-12</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">23.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">22.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">4.1</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">32.0</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">19.0</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">100000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-13</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">23.4</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">21.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">0.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1.9</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">34.5</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">14.0</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">100000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-14</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">24.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">23.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">2.9</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">35.6</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">15.8</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">H</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">101000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-15</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">34.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">29.0</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">4.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9.9</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">44.6</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">22.8</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">C</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">110000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-16</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">43.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">38.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7.0</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">5.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9.9</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">46.8</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">37.4</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">11000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-17</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">43.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">39.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">6.4</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">11.1</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">46.4</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">35.6</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-18</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">35.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">31.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">2.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">8.9</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">41.0</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">26.6</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">100000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-19</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">31.0</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">26.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">2.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">8.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">39.6</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">23.0</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-20</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">38.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">28.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">7.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">13.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">43.2</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">29.8</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">11000</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p><strong><em>3. Convert the weather data into <code>chillR</code> format</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb156"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Clean the dataset and convert to chillR format</span></span>
<span><span class="va">STG_cleaned_weather</span> <span class="op">&lt;-</span> <span class="fu">handle_gsod</span><span class="op">(</span><span class="va">STG_weather</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">STG_cleaned_weather</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Date</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Prec</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1990-01-01 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-9.000</td>
<td style="text-align: right;">2.000</td>
<td style="text-align: right;">-4.556</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-02 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">-8.389</td>
<td style="text-align: right;">2.000</td>
<td style="text-align: right;">-4.056</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-03 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">-4.389</td>
<td style="text-align: right;">-0.722</td>
<td style="text-align: right;">-1.444</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-04 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">-7.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">-2.056</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-05 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">-7.500</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">-2.611</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-06 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">-3.000</td>
<td style="text-align: right;">4.000</td>
<td style="text-align: right;">-0.278</td>
<td style="text-align: right;">4.826</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-07 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">-5.000</td>
<td style="text-align: right;">2.389</td>
<td style="text-align: right;">-1.167</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-08 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">-5.222</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">-1.667</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-09 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">-4.000</td>
<td style="text-align: right;">0.278</td>
<td style="text-align: right;">-0.889</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-10 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">-2.389</td>
<td style="text-align: right;">-1.000</td>
<td style="text-align: right;">-1.778</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-11 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">-5.000</td>
<td style="text-align: right;">-1.778</td>
<td style="text-align: right;">-2.778</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-12 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">-7.222</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">-4.611</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-13 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">-10.000</td>
<td style="text-align: right;">1.389</td>
<td style="text-align: right;">-4.778</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-14 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">-9.000</td>
<td style="text-align: right;">2.000</td>
<td style="text-align: right;">-4.111</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-15 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">-5.111</td>
<td style="text-align: right;">7.000</td>
<td style="text-align: right;">1.611</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-16 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">3.000</td>
<td style="text-align: right;">8.222</td>
<td style="text-align: right;">6.222</td>
<td style="text-align: right;">2.032</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-17 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">2.000</td>
<td style="text-align: right;">8.000</td>
<td style="text-align: right;">6.167</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-18 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">-3.000</td>
<td style="text-align: right;">5.000</td>
<td style="text-align: right;">1.944</td>
<td style="text-align: right;">1.778</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-19 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">-5.000</td>
<td style="text-align: right;">4.222</td>
<td style="text-align: right;">-0.556</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-20 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">-1.222</td>
<td style="text-align: right;">6.222</td>
<td style="text-align: right;">3.833</td>
<td style="text-align: right;">0.000</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb157"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Save the output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="st">"data/MS"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">MS_station_list</span>, <span class="st">"data/MS/MS_station_list.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">STG_weather</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">"data/MS/STG_raw_weather.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">STG_cleaned_weather</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">"data/MS/STG_chillR_weather.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section></section><section id="chapter-11-filling-gaps-in-temperature-records" class="level2"><h2 class="anchored" data-anchor-id="chapter-11-filling-gaps-in-temperature-records">Chapter 11: Filling gaps in temperature records</h2>
<section id="gaps" class="level3"><h3 class="anchored" data-anchor-id="gaps">
<span style="color:#71797E">11.1</span>&nbsp; Gaps</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>Lots of things can go wrong when recording temperature data, including malfunctioning equipment, flat batteries, power cuts or lack of maintenance. Data archiving, transmission and storage in a database presents the next hurdle.</p></li>
<li><p>Many datasets therefore have gaps— many scientific methods don’t deal very well with missing data, so we need ways of filling such gaps.</p></li>
</ul>
<p><br></p>
</section><section id="filling-short-gaps-in-daily-records" class="level3"><h3 class="anchored" data-anchor-id="filling-short-gaps-in-daily-records">
<span style="color:#71797E">11.2</span>&nbsp; Filling short gaps in daily records</h3>
<div style="height: 18px;">

</div>
<ul>
<li>
<p>Simple linear interpolation is good enough for largely complete weather records, except for isolated incidences of missing daily minimum or maximum temperatures.</p>
<ul>
<li>Take the last recorded value before a gaps and the first after the gap and compute the average</li>
<li>Also use for slightly longer gaps (e.g.&nbsp;2-3 days) or maybe a few days more, but it will be dubious</li>
</ul>
</li>
<li><p>In case gaps extend to several weeks or even months, linear interpolation, which simply connects the start and end points of the gap by a straight line, may miss important features of the local temperature dynamics.</p></li>
<li><p>In the extreme case, where we’re missing an entire year of data, such linear interpolation would miss entire seasons, producing unacceptable errors.</p></li>
<li>
<p>Other options:</p>
<ul>
<li>
<code><a href="https://rdrr.io/pkg/chillR/man/fix_weather.html">fix_weather()</a></code> function, without additional argument, linearly interpolates all gaps in the Tmin and Tmax columns</li>
<li>
<code><a href="https://rdrr.io/pkg/chillR/man/make_all_day_table.html">make_all_day_table()</a></code> function adds news lines for the entire days missing in the records</li>
<li>
<code>start_year</code> and <code>end_year</code> to specify the range of years to apply this procedure for; <code>start_date</code> and <code>end_date</code> in Julian days for the dates to work on; and names of the columns to work on if these are different from <code>Tmin</code> and <code>Tmax</code>
</li>
</ul>
</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb158"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># This add DATE column in R format</span></span>
<span><span class="va">weather</span> <span class="op">&lt;-</span> <span class="va">KA_weather</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">make_all_day_table</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Interpolate the gaps for Tmin (output: interp- numeric vector with all gaps</span></span>
<span><span class="co"># linearly interpolated and missing- boolean vector, either TRUE (gap) or FALSE</span></span>
<span><span class="co"># (no gap))</span></span>
<span><span class="va">Tmin_int</span> <span class="op">&lt;-</span> <span class="fu">interpolate_gaps</span><span class="op">(</span><span class="va">weather</span><span class="op">[</span>, <span class="st">"Tmin"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add Tmin and Tmin_interpolated to weather dataset</span></span>
<span><span class="va">weather</span> <span class="op">&lt;-</span> <span class="va">weather</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>Tmin <span class="op">=</span> <span class="va">Tmin_int</span><span class="op">$</span><span class="va">interp</span>, Tmin_interpolated <span class="op">=</span> <span class="va">Tmin_int</span><span class="op">$</span><span class="va">missing</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Interpolate the gaps for Tmax</span></span>
<span><span class="va">Tmax_int</span> <span class="op">&lt;-</span> <span class="fu">interpolate_gaps</span><span class="op">(</span><span class="va">weather</span><span class="op">[</span>, <span class="st">"Tmax"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add Tmax and Tmax_interpolated to weather dataset</span></span>
<span><span class="va">weather</span> <span class="op">&lt;-</span> <span class="va">weather</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>Tmax <span class="op">=</span> <span class="va">Tmax_int</span><span class="op">$</span><span class="va">interp</span>, Tmax_interpolated <span class="op">=</span> <span class="va">Tmax_int</span><span class="op">$</span><span class="va">missing</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add an extra day to the KA_weather dataset that is not connected to the days</span></span>
<span><span class="co"># that are already there.  this creates a large gap, which we can then</span></span>
<span><span class="co"># interpolate</span></span>
<span><span class="va">KA_weather_gap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">KA_weather</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Year <span class="op">=</span> <span class="fl">2011</span>, Month <span class="op">=</span> <span class="fl">3</span>, Day <span class="op">=</span> <span class="fl">3</span>, Tmax <span class="op">=</span> <span class="fl">26</span>,</span>
<span>    Tmin <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fill in the gaps between Julian date 300 (late October) and 100 (early</span></span>
<span><span class="co"># April), only returning data between 2000 and 2011</span></span>
<span><span class="va">fixed_winter_days</span> <span class="op">&lt;-</span> <span class="va">KA_weather_gap</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">fix_weather</span><span class="op">(</span>start_year <span class="op">=</span> <span class="fl">2000</span>, end_year <span class="op">=</span> <span class="fl">2011</span>, start_date <span class="op">=</span> <span class="fl">300</span>, end_date <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fill in all gaps</span></span>
<span><span class="va">fixed_all_days</span> <span class="op">&lt;-</span> <span class="va">KA_weather_gap</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">fix_weather</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>
<code><a href="https://rdrr.io/pkg/chillR/man/fix_weather.html">fix_weather()</a></code> function produces a list of two outputs:
<ul>
<li>
<code>weather</code>: a <code>data.frame</code> with the interpolated weather data, now including columns <code>no_Tmin</code> and <code>no_Tmax</code>, which contain <code>TRUE</code> for rows where the respective values were originally missing (<code>FALSE</code> otherwise).</li>
<li>
<code>QC</code>: a quality control object that summarizes how many values were interpolated for each season.</li>
</ul>
</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb159"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># QC elements for interpolated fixed_winter_days dataset</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">fixed_winter_days</span><span class="op">$</span><span class="va">QC</span>, caption <span class="op">=</span> <span class="st">"Table 11.2a: Quality control summary produced by fixed_weather(), with</span></span>
<span><span class="st">      only winter days interpolated"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.2a: Quality control summary produced by fixed_weather(), with only winter days interpolated</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Incomplete_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1999/2000</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">60.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">2000/2001</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">167</td>
<td style="text-align: right;">167</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2001/2002</td>
<td style="text-align: right;">2002</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2002/2003</td>
<td style="text-align: right;">2003</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2003/2004</td>
<td style="text-align: right;">2004</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2004/2005</td>
<td style="text-align: right;">2005</td>
<td style="text-align: right;">167</td>
<td style="text-align: right;">167</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2005/2006</td>
<td style="text-align: right;">2006</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2006/2007</td>
<td style="text-align: right;">2007</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2007/2008</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2008/2009</td>
<td style="text-align: right;">2009</td>
<td style="text-align: right;">167</td>
<td style="text-align: right;">167</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2009/2010</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2010/2011</td>
<td style="text-align: right;">2011</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">128</td>
<td style="text-align: right;">165</td>
<td style="text-align: right;">165</td>
<td style="text-align: right;">165</td>
<td style="text-align: right;">0.6</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb160"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># QC elements for interpolated fixed_all_days dataset</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">fixed_all_days</span><span class="op">$</span><span class="va">QC</span>, caption <span class="op">=</span> <span class="st">"Table 11.2b: Quality control summary produced by fix_weather(),</span></span>
<span><span class="st">      with all days interpolated"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.2b: Quality control summary produced by fix_weather(), with all days interpolated</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Incomplete_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1997/1998</td>
<td style="text-align: right;">1998</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1998/1999</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1999/2000</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2000/2001</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2001/2002</td>
<td style="text-align: right;">2002</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2002/2003</td>
<td style="text-align: right;">2003</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2003/2004</td>
<td style="text-align: right;">2004</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2004/2005</td>
<td style="text-align: right;">2005</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2005/2006</td>
<td style="text-align: right;">2006</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2006/2007</td>
<td style="text-align: right;">2007</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2007/2008</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2008/2009</td>
<td style="text-align: right;">2009</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2009/2010</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">214</td>
<td style="text-align: right;">214</td>
<td style="text-align: right;">214</td>
<td style="text-align: right;">41.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">2010/2011</td>
<td style="text-align: right;">2011</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">62</td>
<td style="text-align: right;">364</td>
<td style="text-align: right;">364</td>
<td style="text-align: right;">364</td>
<td style="text-align: right;">0.3</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>Linear interpolation is usually acceptable for short gaps in the records, but it gets increasingly less convincing, when the gaps are longer. Here’s a quick demonstration of this:</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb161"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create gap_weather dataset with rows 200:305 of KA_weather dataset</span></span>
<span><span class="va">gap_weather</span> <span class="op">&lt;-</span> <span class="va">KA_weather</span><span class="op">[</span><span class="fl">200</span><span class="op">:</span><span class="fl">305</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Add a new Tmin_observed column which copies Tmin values</span></span>
<span><span class="va">gap_weather</span><span class="op">[</span>, <span class="st">"Tmin_observed"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">gap_weather</span><span class="op">$</span><span class="va">Tmin</span></span>
<span></span>
<span><span class="co"># Replace with NA for Tmin values in selected rows (Create gaps)</span></span>
<span><span class="va">gap_weather</span><span class="op">$</span><span class="va">Tmin</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">7</span><span class="op">:</span><span class="fl">9</span>, <span class="fl">11</span><span class="op">:</span><span class="fl">14</span>, <span class="fl">16</span><span class="op">:</span><span class="fl">20</span>, <span class="fl">22</span><span class="op">:</span><span class="fl">27</span>, <span class="fl">29</span><span class="op">:</span><span class="fl">35</span>, <span class="fl">37</span><span class="op">:</span><span class="fl">44</span>, <span class="fl">46</span><span class="op">:</span><span class="fl">54</span>, <span class="fl">56</span><span class="op">:</span><span class="fl">65</span>,</span>
<span>    <span class="fl">67</span><span class="op">:</span><span class="fl">77</span>, <span class="fl">79</span><span class="op">:</span><span class="fl">90</span>, <span class="fl">92</span><span class="op">:</span><span class="fl">104</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="co"># Interpolate the gaps with fix_weather function</span></span>
<span><span class="va">fixed_gaps</span> <span class="op">&lt;-</span> <span class="fu">fix_weather</span><span class="op">(</span><span class="va">gap_weather</span><span class="op">)</span><span class="op">$</span><span class="va">weather</span>  <span class="co"># only select weather output</span></span>
<span></span>
<span><span class="co"># Plot the result</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">fixed_gaps</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">DATE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">Tmin_observed</span>, color <span class="op">=</span> <span class="st">"Tmin Observed"</span><span class="op">)</span>,</span>
<span>    lwd <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">Tmin</span>, color <span class="op">=</span> <span class="st">"Tmin Interpolated"</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`Tmin Observed` <span class="op">=</span> <span class="st">"black"</span>, `Tmin Interpolated` <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"Legend"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Daily minimum temperature (°C)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/11.2b-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb162"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calculate absolute difference between Tmin_iterpolated and Tmin_observed</span></span>
<span><span class="va">fixed_gaps</span><span class="op">[</span>, <span class="st">"error"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">fixed_gaps</span><span class="op">$</span><span class="va">Tmin</span> <span class="op">-</span> <span class="va">fixed_gaps</span><span class="op">$</span><span class="va">Tmin_observed</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">fixed_gaps</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">DATE</span>, <span class="va">error</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available  Only include rows where no_Tmin is FALSE ylab("Error</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available  Only include rows where no_Tmin is FALSE introduced</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available  Only include rows where no_Tmin is FALSE by</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available  Only include rows where no_Tmin is FALSE interpolation</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available  Only include rows where no_Tmin is FALSE (°C)")</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available  Only include rows where no_Tmin is FALSE +</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available  Only include rows where no_Tmin is FALSE #</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available  Only include rows where no_Tmin is FALSE Show</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available  Only include rows where no_Tmin is FALSE in</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available  Only include rows where no_Tmin is FALSE cex=3</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available  Only include rows where no_Tmin is FALSE size</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available  Only include rows where no_Tmin is FALSE dots</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available  Only include rows where no_Tmin is FALSE the</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available  Only include rows where no_Tmin is FALSE dates</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available  Only include rows where no_Tmin is FALSE where</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available  Only include rows where no_Tmin is FALSE observed</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available  Only include rows where no_Tmin is FALSE Tmin</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available  Only include rows where no_Tmin is FALSE is</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available  Only include rows where no_Tmin is FALSE available</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available  Only include rows where no_Tmin is FALSE Only</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available  Only include rows where no_Tmin is FALSE include</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available  Only include rows where no_Tmin is FALSE rows</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available  Only include rows where no_Tmin is FALSE where</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available  Only include rows where no_Tmin is FALSE no_Tmin</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available  Only include rows where no_Tmin is FALSE is</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available  Only include rows where no_Tmin is FALSE FALSE</span></span>
<span><span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">fixed_gaps</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">fixed_gaps</span><span class="op">$</span><span class="va">no_Tmin</span><span class="op">)</span>, <span class="op">]</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">DATE</span>, <span class="va">error</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    cex <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/11.2c-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb163"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Gaps of length == 1 only on the left, and gaps of length == 13 on the right -</span></span>
<span><span class="co"># temperature dynamics are captured quite well on the left, but no longer very</span></span>
<span><span class="co"># well on the right.</span></span>
<span></span>
<span><span class="co"># How big the errors get obviously depends on the nature of the dataset - was</span></span>
<span><span class="co"># there a lot of variation during the period of interest, or not?  Yet we see a</span></span>
<span><span class="co"># tendency here of errors getting bigger and bigger with increasing gap sizes.</span></span>
<span><span class="co"># Of course for the non-gap points (shown in red in the plot), the error is</span></span>
<span><span class="co"># zero, but especially in the middle of the larger gaps, we can be quite far</span></span>
<span><span class="co"># off from what actually happened.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section><section id="filling-long-gaps-in-daily-records" class="level3"><h3 class="anchored" data-anchor-id="filling-long-gaps-in-daily-records">
<span style="color:#71797E">11.3</span>&nbsp; Filling long gaps in daily records</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>For longer gaps, we can experiment with more complex interpolation algorithms, or try to look for additional data— find another weather station that is close enough to be in a climatically comparable setting and use the data from there to fill gaps for the site of interest.</p></li>
<li>
<p>This may work ok, if the auxiliary station is in a very similar climatic setting, but it will already introduce an error if we’re dealing with some elevation differences, or with other landscape features that have climatic effects (e.g.&nbsp;lakes, sea, forest).</p>
<ul>
<li>Such features, as well as topography, can modulate temperatures at a particular place in a way that makes them poor proxies of temperatures in another location.</li>
</ul>
</li>
</ul>
<ul>
<li>
<code>patch_weather()</code> function can fill gaps in a weather record based on a list of weather datasets from auxiliary stations.
<ul>
<li>The function can also test for (some) biases, correct data for bias in mean temperatures, and use the result to fill gaps in the record for the location of interest.</li>
</ul>
</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb164"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fill gaps in dataset for Bonn that was downloaded in Ch. 10</span></span>
<span><span class="va">Bonn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/Bonn/Bonn_chillR_weather.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check the quality control summary with fix_weather()</span></span>
<span><span class="va">Bonn_QC</span> <span class="op">&lt;-</span> <span class="fu">fix_weather</span><span class="op">(</span><span class="va">Bonn</span><span class="op">)</span><span class="op">$</span><span class="va">QC</span></span>
<span></span>
<span><span class="co"># Display the QC summary</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">Bonn_QC</span>, caption <span class="op">=</span> <span class="st">"Table 11.3a: Quality control summary produced by fix_weather()"</span>,</span>
<span>    <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.3a: Quality control summary produced by fix_weather()</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Incomplete_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1989/1990</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990/1991</td>
<td style="text-align: right;">1991</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1991/1992</td>
<td style="text-align: right;">1992</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1992/1993</td>
<td style="text-align: right;">1993</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1993/1994</td>
<td style="text-align: right;">1994</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1994/1995</td>
<td style="text-align: right;">1995</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1995/1996</td>
<td style="text-align: right;">1996</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1996/1997</td>
<td style="text-align: right;">1997</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1997/1998</td>
<td style="text-align: right;">1998</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">98.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">1998/1999</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1999/2000</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2000/2001</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2001/2002</td>
<td style="text-align: right;">2002</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2002/2003</td>
<td style="text-align: right;">2003</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">316</td>
<td style="text-align: right;">316</td>
<td style="text-align: right;">316</td>
<td style="text-align: right;">13.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2003/2004</td>
<td style="text-align: right;">2004</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2004/2005</td>
<td style="text-align: right;">2005</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2005/2006</td>
<td style="text-align: right;">2006</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2006/2007</td>
<td style="text-align: right;">2007</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2007/2008</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2008/2009</td>
<td style="text-align: right;">2009</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2009/2010</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2010/2011</td>
<td style="text-align: right;">2011</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2011/2012</td>
<td style="text-align: right;">2012</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2012/2013</td>
<td style="text-align: right;">2013</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2013/2014</td>
<td style="text-align: right;">2014</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2014/2015</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2015/2016</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2016/2017</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2017/2018</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2018/2019</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2019/2020</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li><p>The dataset has substantial gaps between 1998 and 2004 and in 2008 (almost all values missing), and some shorter gaps in 2015, 2018 and 2020.</p></li>
<li><p>We will use data from neighbouring weather stations to patch the dataset.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb165"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Find nearby weather stations using handle_gsod()</span></span>
<span><span class="va">station_list</span> <span class="op">&lt;-</span> <span class="fu">handle_gsod</span><span class="op">(</span>action <span class="op">=</span> <span class="st">"list_stations"</span>, location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7.1</span>, <span class="fl">50.73</span><span class="op">)</span>, time_interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1990</span>,</span>
<span>    <span class="fl">2020</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">station_list</span>, caption <span class="op">=</span> <span class="st">"Table 11.3b: List of GSOD weather stations close to Bonn"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.3b: List of GSOD weather stations close to Bonn</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">chillR_code</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">STATION.NAME</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">CTRY</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Lat</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Long</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BEGIN</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">END</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Distance</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Overlap_years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_interval_covered</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">10517099999</td>
<td style="text-align: left;">BONN/FRIESDORF(AUT)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.700</td>
<td style="text-align: right;">7.150</td>
<td style="text-align: right;">19360102</td>
<td style="text-align: right;">19921231</td>
<td style="text-align: right;">4.86</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">10518099999</td>
<td style="text-align: left;">BONN-HARDTHOEHE</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.700</td>
<td style="text-align: right;">7.033</td>
<td style="text-align: right;">19750523</td>
<td style="text-align: right;">19971223</td>
<td style="text-align: right;">5.78</td>
<td style="text-align: right;">7.98</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10519099999</td>
<td style="text-align: left;">BONN-ROLEBER</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.733</td>
<td style="text-align: right;">7.200</td>
<td style="text-align: right;">20010705</td>
<td style="text-align: right;">20081231</td>
<td style="text-align: right;">7.05</td>
<td style="text-align: right;">7.49</td>
<td style="text-align: right;">24</td>
</tr>
<tr class="even">
<td style="text-align: left;">10513099999</td>
<td style="text-align: left;">KOLN BONN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.866</td>
<td style="text-align: right;">7.143</td>
<td style="text-align: right;">19310101</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">15.44</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10509099999</td>
<td style="text-align: left;">BUTZWEILERHOF(BAFB)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.983</td>
<td style="text-align: right;">6.900</td>
<td style="text-align: right;">19780901</td>
<td style="text-align: right;">19950823</td>
<td style="text-align: right;">31.48</td>
<td style="text-align: right;">5.64</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="even">
<td style="text-align: left;">10502099999</td>
<td style="text-align: left;">NORVENICH</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.831</td>
<td style="text-align: right;">6.658</td>
<td style="text-align: right;">19730101</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">33.08</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10514099999</td>
<td style="text-align: left;">MENDIG</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.366</td>
<td style="text-align: right;">7.315</td>
<td style="text-align: right;">19730102</td>
<td style="text-align: right;">19971231</td>
<td style="text-align: right;">43.28</td>
<td style="text-align: right;">8.00</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: left;">10506099999</td>
<td style="text-align: left;">NUERBURG-BARWEILER</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.367</td>
<td style="text-align: right;">6.867</td>
<td style="text-align: right;">19950401</td>
<td style="text-align: right;">19971231</td>
<td style="text-align: right;">43.64</td>
<td style="text-align: right;">2.75</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10508099999</td>
<td style="text-align: left;">BLANKENHEIM</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.450</td>
<td style="text-align: right;">6.650</td>
<td style="text-align: right;">19781002</td>
<td style="text-align: right;">19840504</td>
<td style="text-align: right;">44.53</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">10510099999</td>
<td style="text-align: left;">NUERBURG</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.333</td>
<td style="text-align: right;">6.950</td>
<td style="text-align: right;">19300901</td>
<td style="text-align: right;">19921231</td>
<td style="text-align: right;">45.45</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10515099999</td>
<td style="text-align: left;">BENDORF</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.417</td>
<td style="text-align: right;">7.583</td>
<td style="text-align: right;">19310102</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">48.79</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="even">
<td style="text-align: left;">10504099999</td>
<td style="text-align: left;">EIFEL</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.650</td>
<td style="text-align: right;">6.283</td>
<td style="text-align: right;">20040501</td>
<td style="text-align: right;">20040501</td>
<td style="text-align: right;">58.30</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10526099999</td>
<td style="text-align: left;">BAD MARIENBERG</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.667</td>
<td style="text-align: right;">7.967</td>
<td style="text-align: right;">19730101</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">61.54</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="even">
<td style="text-align: left;">10613099999</td>
<td style="text-align: left;">BUCHEL</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.174</td>
<td style="text-align: right;">7.063</td>
<td style="text-align: right;">19730101</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">61.95</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10503099999</td>
<td style="text-align: left;">AACHEN/MERZBRUCK</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.817</td>
<td style="text-align: right;">6.183</td>
<td style="text-align: right;">19780901</td>
<td style="text-align: right;">19971212</td>
<td style="text-align: right;">65.28</td>
<td style="text-align: right;">7.95</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: left;">10419099999</td>
<td style="text-align: left;">LUDENSCHEID &amp;</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">51.233</td>
<td style="text-align: right;">7.600</td>
<td style="text-align: right;">19270906</td>
<td style="text-align: right;">20030306</td>
<td style="text-align: right;">66.06</td>
<td style="text-align: right;">13.18</td>
<td style="text-align: right;">43</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10400099999</td>
<td style="text-align: left;">DUSSELDORF</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">51.289</td>
<td style="text-align: right;">6.767</td>
<td style="text-align: right;">19310102</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">66.46</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">10616299999</td>
<td style="text-align: left;">SIEGERLAND</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.708</td>
<td style="text-align: right;">8.083</td>
<td style="text-align: right;">20040510</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">69.33</td>
<td style="text-align: right;">16.65</td>
<td style="text-align: right;">54</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10418099999</td>
<td style="text-align: left;">LUEDENSCHEID</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">51.250</td>
<td style="text-align: right;">7.650</td>
<td style="text-align: right;">19940301</td>
<td style="text-align: right;">19971231</td>
<td style="text-align: right;">69.54</td>
<td style="text-align: right;">3.84</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="even">
<td style="text-align: left;">10437499999</td>
<td style="text-align: left;">MONCHENGLADBACH</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">51.230</td>
<td style="text-align: right;">6.504</td>
<td style="text-align: right;">19960715</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">69.59</td>
<td style="text-align: right;">24.47</td>
<td style="text-align: right;">79</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10403099999</td>
<td style="text-align: left;">MOENCHENGLADBACH</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">51.233</td>
<td style="text-align: right;">6.500</td>
<td style="text-align: right;">19381001</td>
<td style="text-align: right;">19421031</td>
<td style="text-align: right;">70.03</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">10501099999</td>
<td style="text-align: left;">AACHEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.783</td>
<td style="text-align: right;">6.100</td>
<td style="text-align: right;">19280101</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">70.67</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">06496099999</td>
<td style="text-align: left;">ELSENBORN (MIL)</td>
<td style="text-align: left;">BE</td>
<td style="text-align: right;">50.467</td>
<td style="text-align: right;">6.183</td>
<td style="text-align: right;">19840501</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">71.10</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">06495099999</td>
<td style="text-align: left;">BOTRANGE (MOUNT)</td>
<td style="text-align: left;">BE</td>
<td style="text-align: right;">50.500</td>
<td style="text-align: right;">6.100</td>
<td style="text-align: right;">19510201</td>
<td style="text-align: right;">20011015</td>
<td style="text-align: right;">75.13</td>
<td style="text-align: right;">11.79</td>
<td style="text-align: right;">38</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10409099999</td>
<td style="text-align: left;">ESSEN/MUELHEIM</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">51.400</td>
<td style="text-align: right;">6.967</td>
<td style="text-align: right;">19300414</td>
<td style="text-align: right;">19431231</td>
<td style="text-align: right;">75.17</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li><p>Many of these stations are not very useful because they only overlap with the record we already have for a few years, in some cases not at all.</p></li>
<li><p>Maybe we can combine data from multiple auxiliary stations to close all the gaps.</p></li>
<li><p>Stations that look promising are BONN-HARDTHOEHE, BONN-ROLEBER, and NORVENICH.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb166"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Download data for promising stations (position 2, 3, 6 in station_list) and</span></span>
<span><span class="co"># store them in a list.</span></span>
<span></span>
<span><span class="co"># The handle_gsod function can download multiple files at ones, returning a</span></span>
<span><span class="co"># named list of station records.</span></span>
<span><span class="va">patch_weather</span> <span class="op">&lt;-</span> <span class="fu">handle_gsod</span><span class="op">(</span>action <span class="op">=</span> <span class="st">"download_weather"</span>, location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">station_list</span><span class="op">$</span><span class="va">chillR_code</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,</span>
<span>    <span class="fl">3</span>, <span class="fl">6</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, time_interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1990</span>, <span class="fl">2020</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">handle_gsod</span><span class="op">(</span><span class="op">)</span>  <span class="co"># clean the downloaded data ?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Loading data for 31 years from station 'NORVENICH'
================================================================================

Loading data for 31 years from station 'BONN-HARDTHOEHE'
================================================================================

Loading data for 31 years from station 'BONN-ROLEBER'
================================================================================</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb168"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use the list of dowloaded weather records to fill gaps in record for Bonn</span></span>
<span><span class="va">patched</span> <span class="op">&lt;-</span> <span class="fu">patch_daily_temperatures</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">Bonn</span>, patch_weather <span class="op">=</span> <span class="va">patch_weather</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Look at what happened by looking at `statistics` of the `patched` object</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">patched</span><span class="op">$</span><span class="va">statistics</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, caption <span class="op">=</span> <span class="st">"Table 11.3c: Patch statistics for NORVENICH"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.3c: Patch statistics for NORVENICH</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stdev_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">filled</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">gaps_remain</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Tmin</td>
<td style="text-align: right;">-0.307</td>
<td style="text-align: right;">1.304</td>
<td style="text-align: right;">2146</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tmax</td>
<td style="text-align: right;">0.202</td>
<td style="text-align: right;">1.154</td>
<td style="text-align: right;">2146</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb169"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">kable</span><span class="op">(</span><span class="va">patched</span><span class="op">$</span><span class="va">statistics</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, caption <span class="op">=</span> <span class="st">"Table 11.3d: Patch statistics for BONN-HARDTHOEHE"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.3d: Patch statistics for BONN-HARDTHOEHE</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stdev_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">filled</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">gaps_remain</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Tmin</td>
<td style="text-align: right;">-1.871</td>
<td style="text-align: right;">2.080</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tmax</td>
<td style="text-align: right;">1.466</td>
<td style="text-align: right;">1.427</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb170"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">kable</span><span class="op">(</span><span class="va">patched</span><span class="op">$</span><span class="va">statistics</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, caption <span class="op">=</span> <span class="st">"Table 11.3e: Patch statistics for BONN-ROLEBER"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.3e: Patch statistics for BONN-ROLEBER</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stdev_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">filled</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">gaps_remain</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Tmin</td>
<td style="text-align: right;">-0.546</td>
<td style="text-align: right;">1.186</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tmax</td>
<td style="text-align: right;">1.314</td>
<td style="text-align: right;">1.089</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li><p>Here we see an analysis of how similar the temperature records (separately for Tmin and Tmax) were between each auxiliary station and our station of interest in Bonn, based on days for which both stations had data.</p></li>
<li>
<p>Besides the number of days for which information was taken from each auxiliary station (<code>filled</code>) and the number of gaps that remained afterwards (<code>gaps_remain</code>), we see two quality statistics:</p>
<ul>
<li>the mean bias (<code>mean_bias</code>), i.e.&nbsp;the mean temperature difference— easy to address by setting threshold</li>
<li>the standard deviation of the daily differences (<code>stdev_bias</code>)— more problematic as this indicates the extent of additional (possibly unsystematic) differences between stations (not sure this can be adjusted or not); so for now we should treat this as an exclusion criterion (i.e.&nbsp;if stdev_bias is above a certain value, we reject the station)</li>
</ul>
</li>
</ul>
<ul>
<li><p>Let’s set some limits for both metrics, which we can pass as arguments to <code><a href="https://rdrr.io/pkg/chillR/man/patch_daily_temperatures.html">patch_daily_temperatures()</a></code> (using the max_mean_bias and max_stdev_bias parameters).</p></li>
<li><p>Let’s cap the <code>mean_bias</code> at 1 °C and the <code>stdev_bias</code> at 2°C, and then look at the statistics again.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb171"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">patched</span> <span class="op">&lt;-</span> <span class="fu">patch_daily_temperatures</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">Bonn</span>, patch_weather <span class="op">=</span> <span class="va">patch_weather</span>,</span>
<span>    max_mean_bias <span class="op">=</span> <span class="fl">1</span>, max_stdev_bias <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">patched</span><span class="op">$</span><span class="va">statistics</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, caption <span class="op">=</span> <span class="st">"Table 11.3f: Patch statistics for NORVENICH"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.3f: Patch statistics for NORVENICH</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stdev_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">filled</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">gaps_remain</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Tmin</td>
<td style="text-align: right;">-0.307</td>
<td style="text-align: right;">1.304</td>
<td style="text-align: right;">2146</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tmax</td>
<td style="text-align: right;">0.202</td>
<td style="text-align: right;">1.154</td>
<td style="text-align: right;">2146</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb172"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">kable</span><span class="op">(</span><span class="va">patched</span><span class="op">$</span><span class="va">statistics</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, caption <span class="op">=</span> <span class="st">"Table 11.3g: Patch statistics for BONN-HARDTHOEHE"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.3g: Patch statistics for BONN-HARDTHOEHE</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stdev_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">filled</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">gaps_remain</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Tmin</td>
<td style="text-align: right;">-1.871</td>
<td style="text-align: right;">2.080</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tmax</td>
<td style="text-align: right;">1.466</td>
<td style="text-align: right;">1.427</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb173"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">kable</span><span class="op">(</span><span class="va">patched</span><span class="op">$</span><span class="va">statistics</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, caption <span class="op">=</span> <span class="st">"Table 11.3h: Patch statistics for BONN-ROLEBER"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.3h: Patch statistics for BONN-ROLEBER</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stdev_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">filled</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">gaps_remain</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Tmin</td>
<td style="text-align: right;">-0.546</td>
<td style="text-align: right;">1.186</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tmax</td>
<td style="text-align: right;">1.314</td>
<td style="text-align: right;">1.089</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li><p>All records from BONN-HARDTHOEHE, as well as the <code>Tmax</code> records from BONN-ROLEBER were rejected, because they didn’t pass the <code>mean_bias</code> filter.</p></li>
<li><p>Data from NORVENICH are pretty good— fill 2146 gaps for <code>Tmin</code> and 2146 for <code>Tmax</code>. Only 1 and 1 gaps remain for Tmin and Tmax, respectively.</p></li>
<li><p>Use <code><a href="https://rdrr.io/pkg/chillR/man/fix_weather.html">fix_weather()</a></code> function to take a look at where the remaining gaps are:</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb174"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">post_patch_stats</span> <span class="op">&lt;-</span> <span class="fu">fix_weather</span><span class="op">(</span><span class="va">patched</span><span class="op">)</span><span class="op">$</span><span class="va">QC</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">post_patch_stats</span>, caption <span class="op">=</span> <span class="st">"Table 11.3i: Data completeness table for the weather record </span></span>
<span><span class="st">      from Bonn, after applying the patch procedure"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.3i: Data completeness table for the weather record from Bonn, after applying the patch procedure</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Incomplete_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1989/1990</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990/1991</td>
<td style="text-align: right;">1991</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1991/1992</td>
<td style="text-align: right;">1992</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1992/1993</td>
<td style="text-align: right;">1993</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1993/1994</td>
<td style="text-align: right;">1994</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1994/1995</td>
<td style="text-align: right;">1995</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1995/1996</td>
<td style="text-align: right;">1996</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1996/1997</td>
<td style="text-align: right;">1997</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1997/1998</td>
<td style="text-align: right;">1998</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1998/1999</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">99.7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1999/2000</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2000/2001</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2001/2002</td>
<td style="text-align: right;">2002</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2002/2003</td>
<td style="text-align: right;">2003</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2003/2004</td>
<td style="text-align: right;">2004</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2004/2005</td>
<td style="text-align: right;">2005</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2005/2006</td>
<td style="text-align: right;">2006</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2006/2007</td>
<td style="text-align: right;">2007</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2007/2008</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2008/2009</td>
<td style="text-align: right;">2009</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2009/2010</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2010/2011</td>
<td style="text-align: right;">2011</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2011/2012</td>
<td style="text-align: right;">2012</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2012/2013</td>
<td style="text-align: right;">2013</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2013/2014</td>
<td style="text-align: right;">2014</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2014/2015</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2015/2016</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2016/2017</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2017/2018</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2018/2019</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2019/2020</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>Almost all gaps are filled, with only data for 1 day missing after the patching. It seems safe to use linear interpolation for such a short gap, by applying the <code><a href="https://rdrr.io/pkg/chillR/man/fix_weather.html">fix_weather()</a></code> function.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb175"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Linear interpoloation to fix a short gap of one day</span></span>
<span><span class="va">Bonn_weather</span> <span class="op">&lt;-</span> <span class="fu">fix_weather</span><span class="op">(</span><span class="va">patched</span><span class="op">)</span></span>
<span></span>
<span><span class="va">post_patch_stats_2</span> <span class="op">&lt;-</span> <span class="fu">fix_weather</span><span class="op">(</span><span class="va">Bonn_weather</span><span class="op">)</span><span class="op">$</span><span class="va">QC</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">post_patch_stats_2</span>, caption <span class="op">=</span> <span class="st">"Table 11.3j: Data completeness table for the weather record </span></span>
<span><span class="st">      from Bonn, after applying the linear interpolation"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.3j: Data completeness table for the weather record from Bonn, after applying the linear interpolation</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Incomplete_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1989/1990</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990/1991</td>
<td style="text-align: right;">1991</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1991/1992</td>
<td style="text-align: right;">1992</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">1992/1993</td>
<td style="text-align: right;">1993</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1993/1994</td>
<td style="text-align: right;">1994</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">1994/1995</td>
<td style="text-align: right;">1995</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1995/1996</td>
<td style="text-align: right;">1996</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">1996/1997</td>
<td style="text-align: right;">1997</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1997/1998</td>
<td style="text-align: right;">1998</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">1998/1999</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1999/2000</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">2000/2001</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2001/2002</td>
<td style="text-align: right;">2002</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">2002/2003</td>
<td style="text-align: right;">2003</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2003/2004</td>
<td style="text-align: right;">2004</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">2004/2005</td>
<td style="text-align: right;">2005</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2005/2006</td>
<td style="text-align: right;">2006</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">2006/2007</td>
<td style="text-align: right;">2007</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2007/2008</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">2008/2009</td>
<td style="text-align: right;">2009</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2009/2010</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">2010/2011</td>
<td style="text-align: right;">2011</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2011/2012</td>
<td style="text-align: right;">2012</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">2012/2013</td>
<td style="text-align: right;">2013</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2013/2014</td>
<td style="text-align: right;">2014</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">2014/2015</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2015/2016</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">2016/2017</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2017/2018</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">2018/2019</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2019/2020</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<section id="bias-correction-for-shorter-intervals" class="level4"><h4 class="anchored" data-anchor-id="bias-correction-for-shorter-intervals">
<span style="color:#71797E">11.3.1</span>&nbsp; Bias-correction for shorter intervals</h4>
<div style="height: 18px;">

</div>
<ul>
<li>In the <code>patch_daily_temperatures</code> function, the bias correction is based on the average difference between the temperatures of a pair of weather stations over the entire year.
<ul>
<li>The between-station bias can varies throughout the year.</li>
<li>A particular station is useful data source for temperatures in certain seasons but not in others.</li>
<li>So, different bias corrections during different parts of the year give better approximations (smaller biases) than the bias correction for the entire year— use <code>patch_daily_temps</code> (not <code>patch_daily_temperatures</code>)</li>
</ul>
</li>
</ul>
<ul>
<li><p>The <code>patch_daily_temps</code> function, as a default, evaluates temperature records on a monthly basis, i.e.&nbsp;it makes separate between-station comparisons for the temperatures of each calendar month.</p></li>
<li><p>It can then take separate decisions on whether a potential auxiliary station is a useful proxy for temperatures in this monthly interval, and it can apply month-specific bias correction.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb176"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">patched_monthly</span> <span class="op">&lt;-</span> <span class="fu">patch_daily_temps</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">Bonn</span>, patch_weather <span class="op">=</span> <span class="va">patch_weather</span>,</span>
<span>    max_mean_bias <span class="op">=</span> <span class="fl">1</span>, max_stdev_bias <span class="op">=</span> <span class="fl">2</span>, time_interval <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Finding for minimum temperatures for the NORVENICH station</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">patched_monthly</span><span class="op">$</span><span class="va">statistics</span><span class="op">$</span><span class="va">Tmin</span><span class="op">$</span><span class="va">NORVENICH</span>, caption <span class="op">=</span> <span class="st">"Table 11.3.1a: Bias analysis table for the first station in the</span></span>
<span><span class="st">      proxy station list, showing biases on a monthly level"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.3.1a: Bias analysis table for the first station in the proxy station list, showing biases on a monthly level</caption>
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Interval</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Total_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Overlap_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mean_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Stdev_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Gaps_before</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Filled</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Gaps_remain</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">961</td>
<td style="text-align: right;">773</td>
<td style="text-align: right;">0.184</td>
<td style="text-align: right;">1.260</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">185</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">961</td>
<td style="text-align: right;">774</td>
<td style="text-align: right;">0.281</td>
<td style="text-align: right;">1.242</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">876</td>
<td style="text-align: right;">706</td>
<td style="text-align: right;">0.269</td>
<td style="text-align: right;">1.248</td>
<td style="text-align: right;">170</td>
<td style="text-align: right;">170</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">961</td>
<td style="text-align: right;">775</td>
<td style="text-align: right;">0.253</td>
<td style="text-align: right;">1.427</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">930</td>
<td style="text-align: right;">758</td>
<td style="text-align: right;">0.509</td>
<td style="text-align: right;">1.431</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">961</td>
<td style="text-align: right;">801</td>
<td style="text-align: right;">0.373</td>
<td style="text-align: right;">1.238</td>
<td style="text-align: right;">158</td>
<td style="text-align: right;">158</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">930</td>
<td style="text-align: right;">749</td>
<td style="text-align: right;">0.396</td>
<td style="text-align: right;">1.210</td>
<td style="text-align: right;">180</td>
<td style="text-align: right;">180</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">961</td>
<td style="text-align: right;">781</td>
<td style="text-align: right;">0.480</td>
<td style="text-align: right;">1.305</td>
<td style="text-align: right;">179</td>
<td style="text-align: right;">179</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: right;">961</td>
<td style="text-align: right;">774</td>
<td style="text-align: right;">0.529</td>
<td style="text-align: right;">1.302</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: right;">930</td>
<td style="text-align: right;">750</td>
<td style="text-align: right;">0.205</td>
<td style="text-align: right;">1.264</td>
<td style="text-align: right;">180</td>
<td style="text-align: right;">180</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11</td>
<td style="text-align: right;">961</td>
<td style="text-align: right;">775</td>
<td style="text-align: right;">0.098</td>
<td style="text-align: right;">1.307</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">12</td>
<td style="text-align: right;">930</td>
<td style="text-align: right;">745</td>
<td style="text-align: right;">0.101</td>
<td style="text-align: right;">1.308</td>
<td style="text-align: right;">184</td>
<td style="text-align: right;">184</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb177"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># The mean bias really varies quite a bit here- probably benefit from a</span></span>
<span><span class="co"># month-specific bias correction.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li><p>The <code>time_interval</code> parameter of the <code>patch_daily_temps</code> function allows us to specify the interval, i.e.&nbsp;either month or week or multiple of these, such as <code>10 days</code> or <code>2 weeks</code>.</p></li>
<li><p>Note that the function starts counting these intervals on 1<sup>st</sup> January in each year— lead to intervals at the end of the year that are smaller than the interval you selected <strong><em>(this generates warnings, as you can see below).</em></strong></p></li>
<li><p>Note also that the smaller these intervals get, the less data can be used for determining the bias. Especially for short time series, a very short interval may therefore not be desirable.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb178"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Warning for very short interval (shorter than specified)</span></span>
<span><span class="va">patch_2weeks</span> <span class="op">&lt;-</span> <span class="fu">patch_daily_temps</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">Bonn</span>, patch_weather <span class="op">=</span> <span class="va">patch_weather</span>,</span>
<span>    max_mean_bias <span class="op">=</span> <span class="fl">1</span>, max_stdev_bias <span class="op">=</span> <span class="fl">2</span>, time_interval <span class="op">=</span> <span class="st">"2 weeks"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Warning in patch_daily_temps(weather = Bonn, patch_weather = patch_weather, :
The number of days in the last interval is often a lot smaller than in other
intervals. Consider changing the time interval.
Warning in patch_daily_temps(weather = Bonn, patch_weather = patch_weather, :
The number of days in the last interval is often a lot smaller than in other
intervals. Consider changing the time interval.
Warning in patch_daily_temps(weather = Bonn, patch_weather = patch_weather, :
The number of days in the last interval is often a lot smaller than in other
intervals. Consider changing the time interval.</code></pre>
</div>
</div>
<ul>
<li>To illustrate the effects of this, let’s create 5000 gaps in the Bonn weather record and fill them with proxy data using annual, monthly and bi-weekly intervals for the bias evaluation.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb180"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Gaps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">Bonn</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">5000</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># no duplicate indices</span></span>
<span></span>
<span><span class="va">Bonn_gaps</span> <span class="op">&lt;-</span> <span class="va">Bonn</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>obs_Tmin <span class="op">=</span> <span class="va">Tmin</span>,</span>
<span>                             obs_Tmax <span class="op">=</span> <span class="va">Tmax</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmin</span><span class="op">[</span><span class="va">Gaps</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmax</span><span class="op">[</span><span class="va">Gaps</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="va">patch_annual</span> <span class="op">&lt;-</span> <span class="fu">patch_daily_temps</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">Bonn_gaps</span>,</span>
<span>                                  patch_weather <span class="op">=</span> <span class="va">patch_weather</span>,</span>
<span>                                  max_mean_bias <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                  max_stdev_bias <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                  time_interval <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">patch_month</span> <span class="op">&lt;-</span> <span class="fu">patch_daily_temps</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">Bonn_gaps</span>,</span>
<span>                                 patch_weather <span class="op">=</span> <span class="va">patch_weather</span>,</span>
<span>                                 max_mean_bias <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                 max_stdev_bias <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                 time_interval <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">patch_2weeks</span> <span class="op">&lt;-</span> <span class="fu">patch_daily_temps</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">Bonn_gaps</span>,</span>
<span>                                  patch_weather <span class="op">=</span> <span class="va">patch_weather</span>,</span>
<span>                                  max_mean_bias <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                  max_stdev_bias <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                  time_interval <span class="op">=</span> <span class="st">"2 weeks"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add new column values of difference between observed and patched values</span></span>
<span><span class="va">Bonn_gaps</span><span class="op">[</span>,<span class="st">"Tmin_annual"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">obs_Tmin</span> <span class="op">-</span> <span class="va">patch_annual</span><span class="op">$</span><span class="va">weather</span><span class="op">$</span><span class="va">Tmin</span></span>
<span><span class="va">Bonn_gaps</span><span class="op">[</span>,<span class="st">"Tmax_annual"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">obs_Tmax</span> <span class="op">-</span> <span class="va">patch_annual</span><span class="op">$</span><span class="va">weather</span><span class="op">$</span><span class="va">Tmax</span></span>
<span><span class="va">Bonn_gaps</span><span class="op">[</span>,<span class="st">"Tmin_month"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">obs_Tmin</span> <span class="op">-</span> <span class="va">patch_month</span><span class="op">$</span><span class="va">weather</span><span class="op">$</span><span class="va">Tmin</span></span>
<span><span class="va">Bonn_gaps</span><span class="op">[</span>,<span class="st">"Tmax_month"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">obs_Tmax</span> <span class="op">-</span> <span class="va">patch_month</span><span class="op">$</span><span class="va">weather</span><span class="op">$</span><span class="va">Tmax</span></span>
<span><span class="va">Bonn_gaps</span><span class="op">[</span>,<span class="st">"Tmin_2weeks"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">obs_Tmin</span> <span class="op">-</span> <span class="va">patch_2weeks</span><span class="op">$</span><span class="va">weather</span><span class="op">$</span><span class="va">Tmin</span></span>
<span><span class="va">Bonn_gaps</span><span class="op">[</span>,<span class="st">"Tmax_2weeks"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">obs_Tmax</span> <span class="op">-</span> <span class="va">patch_2weeks</span><span class="op">$</span><span class="va">weather</span><span class="op">$</span><span class="va">Tmax</span></span>
<span></span>
<span><span class="co"># Modify data for ggplotting</span></span>
<span><span class="va">Interval_eval</span> <span class="op">&lt;-</span> <span class="va">Bonn_gaps</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Tmin</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># only choose when Tmin is NA</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="va">Tmin_annual</span><span class="op">:</span><span class="va">Tmax_2weeks</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># stack columns into rows under name</span></span>
<span>    <span class="co"># create a new Type column as a factor to have specific order for plotting,</span></span>
<span>    <span class="co"># rather than default alphabetical sorting</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>Type<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">name</span>,</span>
<span>                     levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tmin_annual"</span>,</span>
<span>                                <span class="st">"Tmin_month"</span>,</span>
<span>                                <span class="st">"Tmin_2weeks"</span>,</span>
<span>                                <span class="st">"Tmax_annual"</span>,</span>
<span>                                <span class="st">"Tmax_month"</span>,</span>
<span>                                <span class="st">"Tmax_2weeks"</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the resulting errors with ggplot2 using a violin plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">Interval_eval</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span><span class="va">Type</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_violin</span><span class="op">(</span>draw_quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Variable and bias evaluation interval"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Prediction error"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/11.3.1c-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb181"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Also evaluate the mean daily error</span></span>
<span><span class="va">error_eval</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Tmin"</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Tmax"</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             Interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span>, <span class="st">"Month"</span>, <span class="st">"Two weeks"</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>             Error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="co"># Get absolute mean of temps differences for rows with missing values in Tmin/max</span></span>
<span>               <span class="co"># na.rm set to TRUE to ignore any NA values in the vector</span></span>
<span>               <span class="co"># na.rm set to FALSE will return NA if there are NA values in data</span></span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmin_annual</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmin</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmin_month</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmin</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmin_2weeks</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmin</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmax_annual</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmin</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmax_month</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmin</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmax_2weeks</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmin</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">error_eval</span>, </span>
<span>      caption <span class="op">=</span> <span class="st">"Table 11.3.1b: Mean absolute prediction error for minimun and </span></span>
<span><span class="st">      maximum temperature when using different time intervals as a basis for</span></span>
<span><span class="st">      correcting for between-station biases"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.3.1b: Mean absolute prediction error for minimun and maximum temperature when using different time intervals as a basis for correcting for between-station biases</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Interval</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Error</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Tmin</td>
<td style="text-align: left;">Year</td>
<td style="text-align: right;">0.9884602</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tmin</td>
<td style="text-align: left;">Month</td>
<td style="text-align: right;">0.9804947</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tmin</td>
<td style="text-align: left;">Two weeks</td>
<td style="text-align: right;">0.9823963</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tmax</td>
<td style="text-align: left;">Year</td>
<td style="text-align: right;">0.8426638</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tmax</td>
<td style="text-align: left;">Month</td>
<td style="text-align: right;">0.8195965</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tmax</td>
<td style="text-align: left;">Two weeks</td>
<td style="text-align: right;">0.8247608</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb182"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># The improvement isn't very impressive here, possibly because the stations used</span></span>
<span><span class="co"># are quite close to each other and the weather doesn't differ much between them.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section><section id="saving-the-data-for-later" class="level4"><h4 class="anchored" data-anchor-id="saving-the-data-for-later">
<span style="color:#71797E">11.3.2</span>&nbsp; Saving the data for later</h4>
<div style="height: 18px;">

</div>
<ul>
<li>Save for later the fairly convincing long-term record (from 1990 to 2020) for Bonn, with no remaining gaps.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb183"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Choose the dataset with bias correction on monthly intervals- still need to</span></span>
<span><span class="co"># interpolate the one missing day, before saving the record</span></span>
<span><span class="va">monthly_bias_fixed</span> <span class="op">&lt;-</span> <span class="fu">fix_weather</span><span class="op">(</span><span class="va">patched_monthly</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save the record for weather element only- the data.frame that can easily be</span></span>
<span><span class="co"># saved as a spreadsheet table (.csv file).  We can also save list (including</span></span>
<span><span class="co"># the QC element) but it is a bit more complicated- save it for later.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">monthly_bias_fixed</span><span class="op">$</span><span class="va">weather</span>, <span class="st">"data/Bonn/Bonn_weather.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section></section><section id="filling-gaps-in-hourly-records" class="level3"><h3 class="anchored" data-anchor-id="filling-gaps-in-hourly-records">
<span style="color:#71797E">11.4</span>&nbsp; Filling gaps in hourly records</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>Gaps in hourly records are a lot harder to handle, because linear interpolation usually isn’t an option.</p></li>
<li><p>This works for very short gaps only, but it’s probably quite obvious that for gaps that extend over multiple days, you can’t just connect the start and end points with a straight line— makes it hard to use hourly records, even when they are available.</p></li>
<li><p><a href="https://link.springer.com/article/10.1007/s00484-018-1582-7">(Luedeling, 2018)</a> found a solution to make use of hourly data in such cases.</p></li>
<li><p>In principle, having an actual record of hourly temperatures is preferable to deriving hourly data from daily records, but it may cause problems when the record isn’t complete, e.g.&nbsp;<code>Winters_hours_gaps</code> dataset.</p></li>
<li><p>Such situations arise quite often, because temperature loggers can temporarily fail for many reasons.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb184"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># See what happens when we use linear interpolation for Winters_hours_gaps</span></span>
<span><span class="co"># Select rows to match the chart in coursebook</span></span>
<span><span class="va">gap_Winters</span> <span class="op">&lt;-</span> <span class="va">Winters_hours_gaps</span><span class="op">[</span><span class="fl">39</span><span class="op">:</span><span class="fl">350</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Add date in chillR format (for plotting)</span></span>
<span><span class="va">gap_Winters</span> <span class="op">&lt;-</span> <span class="fu">add_date</span><span class="op">(</span><span class="va">gap_Winters</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View(gap_Winters)</span></span>
<span></span>
<span><span class="co"># Create Tmin and Tmax columns to comply with chillR data format</span></span>
<span><span class="va">gap_Winters</span><span class="op">[</span>, <span class="st">"Tmin"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">gap_Winters</span><span class="op">$</span><span class="va">Temp_gaps</span></span>
<span><span class="va">gap_Winters</span><span class="op">[</span>, <span class="st">"Tmin_observed"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">gap_Winters</span><span class="op">$</span><span class="va">Temp</span></span>
<span><span class="va">gap_Winters</span><span class="op">[</span>, <span class="st">"Tmax"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">gap_Winters</span><span class="op">$</span><span class="va">Temp</span>  <span class="co"># just placeholder</span></span>
<span></span>
<span><span class="co"># View(gap_Winters)</span></span>
<span></span>
<span><span class="co"># Interpolate the gaps in Temp_gaps</span></span>
<span><span class="va">Temp_int</span> <span class="op">&lt;-</span> <span class="fu">interpolate_gaps</span><span class="op">(</span><span class="va">gap_Winters</span><span class="op">[</span>, <span class="st">"Tmin"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add interpolated Temp to the dataset</span></span>
<span><span class="va">weather_Winters</span> <span class="op">&lt;-</span> <span class="va">gap_Winters</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>Temp_interpolated <span class="op">=</span> <span class="va">Temp_int</span><span class="op">$</span><span class="va">interp</span>, Temps_interpolated <span class="op">=</span> <span class="va">Temp_int</span><span class="op">$</span><span class="va">missing</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View(weather_Winters)</span></span>
<span></span>
<span><span class="co"># Plot the result</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">weather_Winters</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">260</span>, <span class="op">]</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">Date</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">Tmin_observed</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Temp Observed"</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">Temp_interpolated</span>, color <span class="op">=</span> <span class="st">"Temp Interpolated"</span><span class="op">)</span>,</span>
<span>    lwd <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`Temp Observed` <span class="op">=</span> <span class="st">"black"</span>, `Temp Interpolated` <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Legend"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Temperature (°C)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/11.4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb185"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># In this interpolation, some daytime or nighttime cycles were missed entirely,</span></span>
<span><span class="co"># which can lead to substantial errors when calculating agroclimatic metrics,</span></span>
<span><span class="co"># such as chill or heat stress, that are of particular concern during the</span></span>
<span><span class="co"># warmest and coolest parts of the day.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>
<code><a href="https://rdrr.io/pkg/chillR/man/interpolate_gaps_hourly.html">interpolate_gaps_hourly()</a></code> can produce credible and continuous hourly records from a patchy dataset. It can also derive daily temperature extremes from hourly data that were recorded. Rough mode of operation:
<ul>
<li>Express temperatures for each hour as a function of daily temperature extremes using the functions of <a href="https://journals.ashs.org/hortsci/view/journals/hortsci/25/1/article-p14.xml">Linvill (1990).</a> According to this idealized curve, all hourly temperatures can be expressed as a function of <code>Tmin</code> and <code>Tmax</code> on the previous, same or next day of the temperature record (depending on which hour is of interest). For a day with a complete record, 24 equations can be set up.</li>
<li>For each daily temperature extreme, empirically solve the system of all equations that contain the respective <code>Tmin</code> or <code>Tmax</code> variable (this is only attempted, when a minimum of 5 equations are available, to avoid spurious results).</li>
<li>Close gaps in the resulting dataset of daily Tmin and Tmax using data from proxy stations or, as a last resort, linear interpolation.</li>
<li>Compute idealized temperature curves from the now continuous record of daily <code>Tmin</code> and <code>Tmax</code> values.</li>
<li>Calculate the difference between recorded temperatures and this idealized curve.</li>
<li>Linearly interpolate this difference and add then result to the idealized temperature curve.</li>
</ul>
</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb186"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># See how this function works on the Winters dataset, using daily data from </span></span>
<span><span class="co"># a nearby station of the California Irrigation Management Information System </span></span>
<span><span class="co"># (CIMIS) as a proxy.  </span></span>
<span><span class="co"># Usually can't download coz of server fails to connect</span></span>
<span><span class="va">stations</span> <span class="op">&lt;-</span> <span class="fu">handle_cimis</span><span class="op">(</span><span class="st">"list_stations"</span>, <span class="co"># handle_cimis is similar to handle_gsod</span></span>
<span>                         location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">122</span>,<span class="fl">38.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">downloaded_winters</span> <span class="op">&lt;-</span> <span class="fu">handle_cimis</span><span class="op">(</span><span class="st">"download_weather"</span>,</span>
<span>                                   <span class="va">stations</span><span class="op">$</span><span class="va">chillR_code</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                                   time_interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2008</span>,<span class="fl">2008</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">winters_daily</span> <span class="op">&lt;-</span> <span class="fu">handle_cimis</span><span class="op">(</span><span class="va">downloaded_winters</span><span class="op">)</span><span class="op">$</span><span class="va">weather</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>We will use a provided dataset instead.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb187"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># So, we use a ready-made dataset</span></span>
<span><span class="va">winters_daily</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/OT/winters_daily.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the dataset</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">winters_daily</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Prec</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">-1.7</td>
<td style="text-align: right;">13.6</td>
<td style="text-align: right;">5.0</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">12.2</td>
<td style="text-align: right;">6.9</td>
<td style="text-align: right;">12.0</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">8.0</td>
<td style="text-align: right;">11.0</td>
<td style="text-align: right;">9.2</td>
<td style="text-align: right;">132.8</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5.3</td>
<td style="text-align: right;">9.5</td>
<td style="text-align: right;">7.2</td>
<td style="text-align: right;">10.3</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb188"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Use interpolate_gaps_hourly() function to patch Call dataset to patch</span></span>
<span><span class="va">to_interp</span> <span class="op">&lt;-</span> <span class="va">Winters_hours_gaps</span></span>
<span></span>
<span><span class="co"># Add Temp data to new Temp_recorded column</span></span>
<span><span class="va">to_interp</span><span class="op">[</span>, <span class="st">"Temp_recorded"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">to_interp</span><span class="op">[</span>, <span class="st">"Temp"</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Add Temp_gaps data to the Temp column</span></span>
<span><span class="va">to_interp</span><span class="op">[</span>, <span class="st">"Temp"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">to_interp</span><span class="op">[</span>, <span class="st">"Temp_gaps"</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Generate continous hourly records</span></span>
<span><span class="va">interp</span> <span class="op">&lt;-</span> <span class="fu">interpolate_gaps_hourly</span><span class="op">(</span>hourtemps <span class="op">=</span> <span class="va">to_interp</span>, latitude <span class="op">=</span> <span class="fl">38.5</span>, daily_temps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Winters <span class="op">=</span> <span class="va">winters_daily</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># hourtemps: data.frame containing hourly temperatures.  This has to contain</span></span>
<span><span class="co"># columns c('Year','Month','Day','Hour','Temp').  latitude: location of</span></span>
<span><span class="co"># interest daily_temps: list of (chillR compliant) daily temperature data sets</span></span>
<span><span class="co"># for patching gaps in the record.  Winters = : give name to the station,</span></span>
<span><span class="co"># otherwise report as station_x in result</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The resulting dataset has two elements: $weather and daily_patch_report. Let’s first look at the <code>daily_patch_report</code> element.</p>
<ul>
<li>The resulting table of the <code>daily_patch_report</code> element contains information on
<ul>
<li>how many gaps in the daily record were filled by solving the system of hourly equations (‘solved’),</li>
<li>how many <code>Tmin</code> and <code>Tmax</code> values were derived from proxy stations (listed by name, if names were provided in the call to <code>interpolate_gaps_hourly</code>; otherwise as station_x),</li>
<li>how many were filled by linear interpolation (this option can be turned off using the <code>interpolate_remaining</code> parameter).</li>
</ul>
</li>
</ul>
<ul>
<li>For proxy stations, it also provides the bias in mean Tmin and Tmax, which has been corrected, as well as the bias in the standard deviation of Tmin and Tmax (which was not corrected).</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb189"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">kable</span><span class="op">(</span><span class="va">interp</span><span class="op">$</span><span class="va">daily_patch_report</span>, caption <span class="op">=</span> <span class="st">"The element of `daily_patch_report`"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>The element of `daily_patch_report`</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Var</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Proxy</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">mean_bias</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">stdev_bias</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">filled</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">gaps_remain</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Tmin</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">193</td>
<td style="text-align: left;">61</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tmin</td>
<td style="text-align: left;">Winters</td>
<td style="text-align: left;">0.282</td>
<td style="text-align: left;">1.908</td>
<td style="text-align: left;">61</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tmin</td>
<td style="text-align: left;">interpolated</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tmax</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">204</td>
<td style="text-align: left;">50</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tmax</td>
<td style="text-align: left;">Winters</td>
<td style="text-align: left;">-1.835</td>
<td style="text-align: left;">2.393</td>
<td style="text-align: left;">50</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tmax</td>
<td style="text-align: left;">interpolated</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p>The <code>$weather</code> element of the interpolation result contains the table of interpolated temperatures.</p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb190"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Show only Day 6 of the dataset</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">interp</span><span class="op">$</span><span class="va">weather</span><span class="op">[</span><span class="fl">63</span><span class="op">:</span><span class="fl">86</span>, <span class="op">]</span>, caption <span class="op">=</span> <span class="st">"The element of `weather`"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>The element of `weather`</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Hour</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp_gaps</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp_measured</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp_recorded</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Tmin_source</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Tmax_source</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">63</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6.611</td>
<td style="text-align: right;">6.611</td>
<td style="text-align: right;">6.611</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">6.611000</td>
</tr>
<tr class="even">
<td style="text-align: left;">64</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">6.585</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">solved</td>
<td style="text-align: right;">6.127331</td>
</tr>
<tr class="odd">
<td style="text-align: left;">65</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">5.231</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">solved</td>
<td style="text-align: right;">5.721483</td>
</tr>
<tr class="even">
<td style="text-align: left;">66</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">4.844</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">solved</td>
<td style="text-align: right;">5.377439</td>
</tr>
<tr class="odd">
<td style="text-align: left;">67</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">3.643</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">solved</td>
<td style="text-align: right;">5.083670</td>
</tr>
<tr class="even">
<td style="text-align: left;">68</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">3.459</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">solved</td>
<td style="text-align: right;">4.831597</td>
</tr>
<tr class="odd">
<td style="text-align: left;">69</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">3.063</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">solved</td>
<td style="text-align: right;">4.614667</td>
</tr>
<tr class="even">
<td style="text-align: left;">70</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">3.670</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">7.187229</td>
</tr>
<tr class="odd">
<td style="text-align: left;">71</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">6.128</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">9.961071</td>
</tr>
<tr class="even">
<td style="text-align: left;">72</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">11.248</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">12.546187</td>
</tr>
<tr class="odd">
<td style="text-align: left;">73</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">15.581</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">14.845358</td>
</tr>
<tr class="even">
<td style="text-align: left;">74</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">16.773</td>
<td style="text-align: right;">16.773</td>
<td style="text-align: right;">16.773</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">16.773000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">75</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">17.534</td>
<td style="text-align: right;">17.534</td>
<td style="text-align: right;">17.534</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">17.534000</td>
</tr>
<tr class="even">
<td style="text-align: left;">76</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">16.606</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">18.169898</td>
</tr>
<tr class="odd">
<td style="text-align: left;">77</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">17.177</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">18.278931</td>
</tr>
<tr class="even">
<td style="text-align: left;">78</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">17.819</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">17.850162</td>
</tr>
<tr class="odd">
<td style="text-align: left;">79</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">17.701</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">16.894530</td>
</tr>
<tr class="even">
<td style="text-align: left;">80</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">17.510</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">15.444406</td>
</tr>
<tr class="odd">
<td style="text-align: left;">81</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">15.485</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">13.722715</td>
</tr>
<tr class="even">
<td style="text-align: left;">82</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">12.050</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">11.612484</td>
</tr>
<tr class="odd">
<td style="text-align: left;">83</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">9.756</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">10.239534</td>
</tr>
<tr class="even">
<td style="text-align: left;">84</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">9.064</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">9.196937</td>
</tr>
<tr class="odd">
<td style="text-align: left;">85</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">8.020</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">8.342747</td>
</tr>
<tr class="even">
<td style="text-align: left;">86</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">6.889</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">7.610517</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p>Here I will try to plot the result like in the coursebook.</p>
<ul>
<li>This illustration shows that the <code><a href="https://rdrr.io/pkg/chillR/man/interpolate_gaps_hourly.html">interpolate_gaps_hourly()</a></code> function produced a pretty good approximation (red lines) to the actual temperatures (gray line).</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb191"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Add date in chillR format</span></span>
<span><span class="va">interp_plot</span> <span class="op">&lt;-</span> <span class="fu">add_date</span><span class="op">(</span><span class="va">interp</span><span class="op">$</span><span class="va">weather</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Use codes from package example Interpolated temperatures are shown in red,</span></span>
<span><span class="co">## measured temperatures in black.</span></span>
<span><span class="co">## plot(interp_plot$Temp[45:320]~c(interp_plot$Date[45:320]),type='l',</span></span>
<span><span class="co">## col='RED',lwd=2,xlab='Date',ylab='Temperature')</span></span>
<span><span class="co">## lines(interp_plot$Temp_measured[45:320]~c(interp_plot$Date[45:320]),lwd=2)</span></span>
<span></span>
<span><span class="co"># Create a subset of the data for the range between March 6-16</span></span>
<span><span class="va">interp_subset</span> <span class="op">&lt;-</span> <span class="va">interp_plot</span><span class="op">[</span><span class="fl">45</span><span class="op">:</span><span class="fl">320</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Use ggplot Add the fist line for recorded temperatures as a gray line Add the</span></span>
<span><span class="co"># second line for interpolated temperatures as a red line Add the third line</span></span>
<span><span class="co"># for measured temperatures as a black line (this is choppy)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">interp_subset</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">Temp_recorded</span>, color <span class="op">=</span> <span class="st">"Temp Recorded"</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">Temp</span>, color <span class="op">=</span> <span class="st">"Temp Interpolated"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">Temp_measured</span>, color <span class="op">=</span> <span class="st">"Temp Measured"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`Temp Interpolated` <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    `Temp Measured` <span class="op">=</span> <span class="st">"black"</span>, `Temp Recorded` <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Legend"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Temperature (°C)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/11.4e-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<section id="accuracy-assessment" class="level4"><h4 class="anchored" data-anchor-id="accuracy-assessment">
<span style="color:#71797E">11.4.1</span>&nbsp; Accuracy assessment</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>Since the actual hourly temperatures are known, the accuracy of the predictions produced by the various interpolation methods can be evaluated.</p></li>
<li><p>A common measure for validating predictions is the Root Mean Square Error of the Prediction (RMSEP).</p></li>
</ul>
<p><br></p>
<section id="root-mean-square-error-of-the-prediction-rmsep" class="level5 unnumbered"><h5 class="unnumbered anchored" data-anchor-id="root-mean-square-error-of-the-prediction-rmsep"><em>Root Mean Square Error of the Prediction (RMSEP)</em></h5>
<div style="height: 18px;">

</div>
<p><span class="math display">\[
RMSEP = \sqrt{\frac{1}{n} \sum_{i=1}^{n} (y_i - \hat{y}_i)^2}
\]</span></p>
<p>, with <span class="math inline">\(\hat{y}_i\)</span> being the observed values, <span class="math inline">\(y_i\)</span> the predicted values, and <span class="math inline">\(n\)</span> the number of values.</p>
<ul>
<li><p>The RMSEP provides an indication of how far each predicted value deviates, on average, from the actual values.</p></li>
<li>
<p>It is, however, quite difficult to interpret RMSEP values alone, because whether they indicate a good or poor model fit depends on how variable the actual values are.</p>
<ul>
<li>For instance, an RMSEP of 5 days for a phenology model (which is close to, but not quite the same as a mean error of 5 days), could indicate a very good model, if observed dates vary by several weeks or months (e.g.&nbsp;for bloom dates of deciduous trees), but a terrible model, if the phenological stage of interest occurs on the same day every year (e.g.&nbsp;the ‘phenological’ event of candles lighting up on ‘festive indoor conifers’).</li>
</ul>
</li>
</ul>
<ul>
<li><p>This is why it makes sense to include in such accuracy assessment the variation in observed values.</p></li>
<li><p>This can be achieved by dividing the standard deviation of the observed data by the RMSEP to calculate the Residual Prediction Deviation (RPD).</p></li>
</ul>
<p><br></p>
</section><section id="residual-prediction-deviation-rpd" class="level5 unnumbered"><h5 class="unnumbered anchored" data-anchor-id="residual-prediction-deviation-rpd"><em>Residual Prediction Deviation (RPD)</em></h5>
<div style="height: 18px;">

</div>
<p><span class="math display">\[
RPD = \frac{sd_y}{RMSEP}
\]</span> </p>
<ul>
<li>This equation contains the RMSEP as computed above as well as the standard deviation of the observed values from their mean, defined as:</li>
</ul>
<p><span class="math display">\[
sd_y = \sqrt{\frac{\sum_{i=1}^n (y_i - \bar{y})^2}{n-1}}
\]</span></p>
<p>, with <span class="math inline">\(\bar{y}\)</span> being the mean over all observations.</p>
<ul>
<li><p>The RPD is more useful than the RMSEP, but its use of the standard deviation can be a problem, when actual values of <span class="math inline">\(y\)</span> aren’t normally distributed (then the standard deviation can be a poor measure of variation).</p></li>
<li><p>A more robust approach is use the interquartile range instead of the standard deviation. This metric is called the Ratio of Performance to InterQuartile distance (RPIQ).</p></li>
</ul>
<p><br></p>
</section><section id="ratio-of-performance-to-interquartile-distance-rpiq" class="level5 unnumbered"><h5 class="unnumbered anchored" data-anchor-id="ratio-of-performance-to-interquartile-distance-rpiq"><em>Ratio of Performance to InterQuartile distance (RPIQ)</em></h5>
<div style="height: 18px;">

</div>
<p><span class="math display">\[
RPIQ = \frac{IQ}{RMSEP}
\]</span></p>
<ul>
<li>IQ is calculated by subtracting the 75<sup>th</sup> percentile of the distribution of all <span class="math inline">\(y\)</span> from the 25<sup>th</sup> percentile.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb192"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># require(stats)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">IQ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">IQ</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>     75% 
1.444812 </code></pre>
</div>
</div>
<p><br></p>
<ul>
<li><p>The RPIQ score is a bit harder to evaluate than the RMSEP, with different quality thresholds in use and a very high context dependency.</p></li>
<li><p>Quite commonly, values above 2 are considered ‘good’ or even ‘excellent’, though some studies use substantially higher thresholds (up to 8 for excellence).</p></li>
<li>
<p>Since the RPIQ makes no assumption about the distribution of <span class="math inline">\(y\)</span>, let’s use this for assessing the accuracy of the various interpolation methods. We have a total of four methods to evaluate:</p>
<ul>
<li>
<strong>idealized</strong> temperature curves from <strong>daily</strong> records of <code>Tmin</code> and <code>Tmax</code>, based on records from a <strong>nearby weather station</strong>
</li>
<li>
<strong>idealized</strong> temperature curves from <strong>daily</strong> records of <code>Tmin</code> and <code>Tmax</code>, based on records from <strong>the same location</strong>
</li>
<li>
<strong>linear</strong> interpolation of <strong>hourly</strong> temperatures</li>
<li>interpolation of <strong>hourly</strong> temperatures with <code>interpolate_gaps_hourly</code>
</li>
</ul>
</li>
</ul>
<ul>
<li>Use the <code><a href="https://rdrr.io/pkg/chillR/man/make_all_day_table.html">make_all_day_table()</a></code> function to generate a dataset of daily minimum and maximum temperatures from the hourly records for option 2.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb194"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Call dataset</span></span>
<span><span class="va">inter</span> <span class="op">&lt;-</span> <span class="va">interp</span><span class="op">$</span><span class="va">weather</span></span>
<span></span>
<span><span class="co"># Add date column in chillR format</span></span>
<span><span class="va">inter</span><span class="op">[</span>, <span class="st">"DATE"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Year</span>, <span class="va">inter</span><span class="op">$</span><span class="va">Month</span>, <span class="va">inter</span><span class="op">$</span><span class="va">Day</span>, <span class="va">inter</span><span class="op">$</span><span class="va">Hour</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Aggregate hourly records to daily Tmin, Tmean and Tmax</span></span>
<span><span class="va">orchard_extremes</span> <span class="op">&lt;-</span> <span class="fu">make_all_day_table</span><span class="op">(</span><span class="va">inter</span>, timestep <span class="op">=</span> <span class="st">"day"</span>, input_timestep <span class="op">=</span> <span class="st">"hour"</span><span class="op">)</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">orchard_extremes</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">DATE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp_gaps</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp_measured</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp_recorded</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Tmin_source</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Tmax_source</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">DATE.1</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmax</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2008-03-03 12:00:00</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">15.01593</td>
<td style="text-align: right;">15.01593</td>
<td style="text-align: right;">15.01593</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2008-03-03 12:00:00</td>
<td style="text-align: right;">7.920000</td>
<td style="text-align: right;">15.01593</td>
<td style="text-align: right;">19.50800</td>
</tr>
<tr class="even">
<td style="text-align: left;">2008-03-04 12:00:00</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">12.81204</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2008-03-04 12:00:00</td>
<td style="text-align: right;">3.775000</td>
<td style="text-align: right;">12.90918</td>
<td style="text-align: right;">21.86700</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2008-03-05 12:00:00</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">13.75604</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">2008-03-05 12:00:00</td>
<td style="text-align: right;">6.611000</td>
<td style="text-align: right;">13.18230</td>
<td style="text-align: right;">20.79300</td>
</tr>
<tr class="even">
<td style="text-align: left;">2008-03-06 12:00:00</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">10.51863</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2008-03-06 12:00:00</td>
<td style="text-align: right;">4.614667</td>
<td style="text-align: right;">11.02404</td>
<td style="text-align: right;">18.27893</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2008-03-07 12:00:00</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">12.43037</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: left;">2008-03-07 12:00:00</td>
<td style="text-align: right;">3.248000</td>
<td style="text-align: right;">12.42736</td>
<td style="text-align: right;">21.10300</td>
</tr>
<tr class="even">
<td style="text-align: left;">2008-03-08 12:00:00</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">14.63242</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">2008-03-08 12:00:00</td>
<td style="text-align: right;">9.192859</td>
<td style="text-align: right;">13.79199</td>
<td style="text-align: right;">19.34624</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2008-03-09 12:00:00</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">14.59242</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2008-03-09 12:00:00</td>
<td style="text-align: right;">9.594037</td>
<td style="text-align: right;">15.64157</td>
<td style="text-align: right;">23.74003</td>
</tr>
<tr class="even">
<td style="text-align: left;">2008-03-10 12:00:00</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">14.54471</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">2008-03-10 12:00:00</td>
<td style="text-align: right;">3.844381</td>
<td style="text-align: right;">14.35162</td>
<td style="text-align: right;">23.42400</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2008-03-11 12:00:00</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">14.59100</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2008-03-11 12:00:00</td>
<td style="text-align: right;">6.788000</td>
<td style="text-align: right;">14.57792</td>
<td style="text-align: right;">21.41300</td>
</tr>
<tr class="even">
<td style="text-align: left;">2008-03-12 12:00:00</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">15.14142</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">2008-03-12 12:00:00</td>
<td style="text-align: right;">5.194364</td>
<td style="text-align: right;">14.66290</td>
<td style="text-align: right;">22.36900</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<ul>
<li>Let’s first look at the performance of the four methods for the periods that were missing in the hourly temperature record:</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb195"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Interpolate gaps in daily records and generate hourly temperatures</span></span>
<span><span class="va">winters_hours</span> <span class="op">&lt;-</span> <span class="fu">stack_hourly_temps</span><span class="op">(</span><span class="fu">fix_weather</span><span class="op">(</span><span class="va">winters_daily</span><span class="op">)</span>,</span>
<span>                                    latitude <span class="op">=</span> <span class="fl">38</span><span class="op">)</span><span class="op">$</span><span class="va">hourtemps</span></span>
<span></span>
<span><span class="co"># Identify the date in winters_hours correspond to the first date of </span></span>
<span><span class="co"># missing period in inter dataset? </span></span>
<span><span class="co"># The output is 1499- row in the dataset???</span></span>
<span><span class="va">start_hour_winters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">winters_hours</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Year</span>,<span class="fl">1</span><span class="op">)</span><span class="op">&amp;</span></span>
<span>                              <span class="va">winters_hours</span><span class="op">$</span><span class="va">Month</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Month</span>,<span class="fl">1</span><span class="op">)</span><span class="op">&amp;</span></span>
<span>                              <span class="va">winters_hours</span><span class="op">$</span><span class="va">Day</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Day</span>,<span class="fl">1</span><span class="op">)</span><span class="op">&amp;</span></span>
<span>                              <span class="va">winters_hours</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Hour</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Identify the date in winters_hours correspond to the end date of </span></span>
<span><span class="co"># missing period in inter dataset? </span></span>
<span><span class="co"># The output is 7572- row in the dataset???</span></span>
<span><span class="va">end_hour_winters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">winters_hours</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Year</span>,<span class="fl">1</span><span class="op">)</span><span class="op">&amp;</span></span>
<span>                            <span class="va">winters_hours</span><span class="op">$</span><span class="va">Month</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Month</span>,<span class="fl">1</span><span class="op">)</span><span class="op">&amp;</span></span>
<span>                            <span class="va">winters_hours</span><span class="op">$</span><span class="va">Day</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Day</span>,<span class="fl">1</span><span class="op">)</span><span class="op">&amp;</span></span>
<span>                            <span class="va">winters_hours</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Hour</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Follow same process for orchard dataset?</span></span>
<span><span class="va">orchard_hours</span> <span class="op">&lt;-</span> <span class="fu">stack_hourly_temps</span><span class="op">(</span><span class="va">orchard_extremes</span>,</span>
<span>                                    latitude <span class="op">=</span> <span class="fl">38</span><span class="op">)</span><span class="op">$</span><span class="va">hourtemps</span></span>
<span></span>
<span><span class="va">start_hour_orchard</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">orchard_hours</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Year</span>,<span class="fl">1</span><span class="op">)</span><span class="op">&amp;</span></span>
<span>                              <span class="va">orchard_hours</span><span class="op">$</span><span class="va">Month</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Month</span>,<span class="fl">1</span><span class="op">)</span><span class="op">&amp;</span></span>
<span>                              <span class="va">orchard_hours</span><span class="op">$</span><span class="va">Day</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Day</span>,<span class="fl">1</span><span class="op">)</span><span class="op">&amp;</span></span>
<span>                              <span class="va">orchard_hours</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Hour</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">end_hour_orchard</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">orchard_hours</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Year</span>,<span class="fl">1</span><span class="op">)</span><span class="op">&amp;</span></span>
<span>                            <span class="va">orchard_hours</span><span class="op">$</span><span class="va">Month</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Month</span>,<span class="fl">1</span><span class="op">)</span><span class="op">&amp;</span></span>
<span>                            <span class="va">orchard_hours</span><span class="op">$</span><span class="va">Day</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Day</span>,<span class="fl">1</span><span class="op">)</span><span class="op">&amp;</span></span>
<span>                            <span class="va">orchard_hours</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Hour</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Extract data for each option</span></span>
<span><span class="co"># Actual temp?</span></span>
<span><span class="va">observed</span> <span class="op">&lt;-</span> <span class="va">inter</span><span class="op">$</span><span class="va">Temp_recorded</span></span>
<span></span>
<span><span class="co"># Use proxy data "winters"</span></span>
<span><span class="va">option1</span> <span class="op">&lt;-</span> <span class="va">winters_hours</span><span class="op">$</span><span class="va">Temp</span><span class="op">[</span><span class="va">start_hour_winters</span><span class="op">:</span><span class="va">end_hour_winters</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Use orchard_extremes data (same location)</span></span>
<span><span class="va">option2</span> <span class="op">&lt;-</span> <span class="va">orchard_hours</span><span class="op">$</span><span class="va">Temp</span><span class="op">[</span><span class="va">start_hour_orchard</span><span class="op">:</span><span class="va">end_hour_orchard</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Use liner interpolation</span></span>
<span><span class="va">option3</span> <span class="op">&lt;-</span> <span class="fu">interpolate_gaps</span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Temp_gaps</span><span class="op">)</span><span class="op">$</span><span class="va">interp</span></span>
<span></span>
<span><span class="co"># Use interpolate_gap_hourly() function</span></span>
<span><span class="va">option4</span> <span class="op">&lt;-</span> <span class="va">inter</span><span class="op">$</span><span class="va">Temp</span></span>
<span></span>
<span><span class="co"># Create a data.frame for output, under two names of dataset</span></span>
<span><span class="va">eval_table</span> <span class="op">&lt;-</span> <span class="co"># This line might not be needed as eval_table is set again below?</span></span>
<span>  <span class="va">eval_table_gaps</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Option <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>             Input_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"daily"</span>,<span class="st">"daily"</span>,<span class="st">"hourly"</span>,<span class="st">"hourly"</span><span class="op">)</span>,</span>
<span>             Interpolation_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"from proxy"</span>,<span class="st">"local extremes"</span>,</span>
<span>                                      <span class="st">"linear"</span>,<span class="st">"hourly interpolation"</span><span class="op">)</span>,</span>
<span>             RMSEP <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>             RPIQ <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the values in each option that correspond with the missing gaps</span></span>
<span><span class="va">observed_gaps</span> <span class="op">&lt;-</span> <span class="va">observed</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Temp_gaps</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">option1_gaps</span> <span class="op">&lt;-</span> <span class="va">option1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Temp_gaps</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">option2_gaps</span> <span class="op">&lt;-</span> <span class="va">option2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Temp_gaps</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">option3_gaps</span> <span class="op">&lt;-</span> <span class="va">option3</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Temp_gaps</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">option4_gaps</span> <span class="op">&lt;-</span> <span class="va">option4</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Temp_gaps</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Add result for RMSEP in the output table created above</span></span>
<span><span class="co"># Comparison between data from each option and the recorded data</span></span>
<span><span class="va">eval_table_gaps</span><span class="op">[</span>,<span class="st">"RMSEP"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">chillR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/RMSEP.html">RMSEP</a></span><span class="op">(</span><span class="va">option1_gaps</span>, <span class="va">observed_gaps</span><span class="op">)</span>,</span>
<span>                                     <span class="fu">chillR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/RMSEP.html">RMSEP</a></span><span class="op">(</span><span class="va">option2_gaps</span>, <span class="va">observed_gaps</span><span class="op">)</span>,</span>
<span>                                     <span class="fu">chillR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/RMSEP.html">RMSEP</a></span><span class="op">(</span><span class="va">option3_gaps</span>, <span class="va">observed_gaps</span><span class="op">)</span>,</span>
<span>                                     <span class="fu">chillR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/RMSEP.html">RMSEP</a></span><span class="op">(</span><span class="va">option4_gaps</span>, <span class="va">observed_gaps</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                   <span class="fl">1</span><span class="op">)</span> <span class="co"># round to 1 decimal point</span></span>
<span></span>
<span><span class="co"># Add result for RPIQ in the output table created above</span></span>
<span><span class="va">eval_table_gaps</span><span class="op">[</span>,<span class="st">"RPIQ"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">chillR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/RPIQ.html">RPIQ</a></span><span class="op">(</span><span class="va">option1_gaps</span>, <span class="va">observed_gaps</span><span class="op">)</span>,</span>
<span>                                    <span class="fu">chillR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/RPIQ.html">RPIQ</a></span><span class="op">(</span><span class="va">option2_gaps</span>, <span class="va">observed_gaps</span><span class="op">)</span>,</span>
<span>                                    <span class="fu">chillR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/RPIQ.html">RPIQ</a></span><span class="op">(</span><span class="va">option3_gaps</span>, <span class="va">observed_gaps</span><span class="op">)</span>,</span>
<span>                                    <span class="fu">chillR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/RPIQ.html">RPIQ</a></span><span class="op">(</span><span class="va">option4_gaps</span>, <span class="va">observed_gaps</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                  <span class="fl">1</span><span class="op">)</span> <span class="co"># round to 1 decimal point</span></span>
<span></span>
<span><span class="co"># Display the output table</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">eval_table_gaps</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Option</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Input_data</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Interpolation_method</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">RMSEP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">RPIQ</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">daily</td>
<td style="text-align: left;">from proxy</td>
<td style="text-align: right;">2.6</td>
<td style="text-align: right;">4.1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">daily</td>
<td style="text-align: left;">local extremes</td>
<td style="text-align: right;">2.1</td>
<td style="text-align: right;">5.0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">hourly</td>
<td style="text-align: left;">linear</td>
<td style="text-align: right;">5.3</td>
<td style="text-align: right;">2.0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">hourly</td>
<td style="text-align: left;">hourly interpolation</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: right;">5.4</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb196"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># This table shows that the interpolate_gaps_hourly function produced the </span></span>
<span><span class="co"># best results, with an RMSEP of 2 and an RPIQ of 5.4.</span></span>
<span></span>
<span><span class="co"># Option 3, where hourly records collected in the orchard were interpolated </span></span>
<span><span class="co"># linearly, produced the worst fit. </span></span>
<span></span>
<span><span class="co"># This highlights that, at least in this case, using an idealized temperature </span></span>
<span><span class="co"># curve to close gaps in daily temperatures from the orchard (option 2) </span></span>
<span><span class="co"># and even from the proxy station (option 1) produced more accurate results.</span></span>
<span></span>
<span><span class="co"># The quality of option 1 will depend on the similarity between weather at the </span></span>
<span><span class="co"># proxy station and in the orchard (in this case, this should be quite similar).</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li><p>Restricting the comparison to only the gaps in the record is a bit unfair, because of course records produced by option 3 (linear interpolation of hourly records from the orchard) are completely accurate for hours, when temperatures were recorded.</p></li>
<li><p>So let’s also compare the relative performance of the four methods across all hours of the record.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb197"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create data.frame for output table again</span></span>
<span><span class="va">eval_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Option <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, Input_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"daily"</span>, <span class="st">"daily"</span>, <span class="st">"hourly"</span>,</span>
<span>    <span class="st">"hourly"</span><span class="op">)</span>, Interpolation_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"from proxy"</span>, <span class="st">"local extremes"</span>, <span class="st">"linear"</span>,</span>
<span>    <span class="st">"hourly interpolation"</span><span class="op">)</span>, RMSEP <span class="op">=</span> <span class="cn">NA</span>, RPIQ <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Comparison between whole datasets- not just the gaps Add values for RMSEP</span></span>
<span><span class="va">eval_table</span><span class="op">[</span>, <span class="st">"RMSEP"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">chillR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/RMSEP.html">RMSEP</a></span><span class="op">(</span><span class="va">option1</span>, <span class="va">observed</span><span class="op">)</span>, <span class="fu">chillR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/RMSEP.html">RMSEP</a></span><span class="op">(</span><span class="va">option2</span>,</span>
<span>    <span class="va">observed</span><span class="op">)</span>, <span class="fu">chillR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/RMSEP.html">RMSEP</a></span><span class="op">(</span><span class="va">option3</span>, <span class="va">observed</span><span class="op">)</span>, <span class="fu">chillR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/RMSEP.html">RMSEP</a></span><span class="op">(</span><span class="va">option4</span>, <span class="va">observed</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add values for RPIQ</span></span>
<span><span class="va">eval_table</span><span class="op">[</span>, <span class="st">"RPIQ"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">chillR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/RPIQ.html">RPIQ</a></span><span class="op">(</span><span class="va">option1</span>, <span class="va">observed</span><span class="op">)</span>, <span class="fu">chillR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/RPIQ.html">RPIQ</a></span><span class="op">(</span><span class="va">option2</span>,</span>
<span>    <span class="va">observed</span><span class="op">)</span>, <span class="fu">chillR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/RPIQ.html">RPIQ</a></span><span class="op">(</span><span class="va">option3</span>, <span class="va">observed</span><span class="op">)</span>, <span class="fu">chillR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/RPIQ.html">RPIQ</a></span><span class="op">(</span><span class="va">option4</span>, <span class="va">observed</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Display output</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">eval_table</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Option</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Input_data</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Interpolation_method</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">RMSEP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">RPIQ</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">daily</td>
<td style="text-align: left;">from proxy</td>
<td style="text-align: right;">2.5</td>
<td style="text-align: right;">4.2</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">daily</td>
<td style="text-align: left;">local extremes</td>
<td style="text-align: right;">1.9</td>
<td style="text-align: right;">5.7</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">hourly</td>
<td style="text-align: left;">linear</td>
<td style="text-align: right;">3.9</td>
<td style="text-align: right;">2.7</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">hourly</td>
<td style="text-align: left;">hourly interpolation</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">7.2</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb198"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># The quality of the proxy-based idealized temperature curves went down</span></span>
<span><span class="co"># slightly, while all other approaches saw improvements in quality (lower RMSEP</span></span>
<span><span class="co"># and higher RPIQ).</span></span>
<span></span>
<span><span class="co"># The RPIQ values for the two interpolations that were based on local data</span></span>
<span><span class="co"># (options 2 and 4) are very high, especially for option 4, which used the</span></span>
<span><span class="co"># interpolate_gaps_hourly function.</span></span>
<span></span>
<span><span class="co"># The RPIQ score for option 4 almost exceeds the ‘excellence’ threshold for the</span></span>
<span><span class="co"># most conservative RPIQ evaluation scheme (threshold of 8). This is quite</span></span>
<span><span class="co"># remarkable, given the variable nature of daily temperature fluctuations and</span></span>
<span><span class="co"># the fact that about half of the actually recorded values were removed before</span></span>
<span><span class="co"># running the interpolation.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li><strong><em>In conclusion, the <code>interpolate_gaps_hourly</code> function provided a very good approximation of hourly temperatures for times when no values were recorded.</em></strong></li>
</ul>
<p><br></p>
</section></section><section id="computing-agroclimatic-metrics" class="level4"><h4 class="anchored" data-anchor-id="computing-agroclimatic-metrics">
<span style="color:#71797E">11.4.2</span>&nbsp; Computing agroclimatic metrics</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>Finally, let’s look at the implication of the choice of interpolation method on chill and heat estimates.</p></li>
<li><p>If we’re interested in using the Dynamic Model for winter chill or the Growing Degree Hours model for heat, we can simply calculate this using the <code>Dynamic_Model</code> and <code><a href="https://rdrr.io/pkg/chillR/man/GDH.html">GDH()</a></code> functions in <code>chillR</code>.</p></li>
<li><p>For more functionality, see the <code><a href="https://rdrr.io/pkg/chillR/man/chilling.html">chilling()</a></code> and particularly the <code><a href="https://rdrr.io/pkg/chillR/man/tempResponse.html">tempResponse()</a></code> functions.</p></li>
<li><p>First, look at the implications of method choice on chill accumulation:</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb199"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Recall the dataset (just to make sure good knitting)</span></span>
<span><span class="va">observed</span> <span class="op">&lt;-</span> <span class="va">inter</span><span class="op">$</span><span class="va">Temp_recorded</span></span>
<span><span class="va">option1</span> <span class="op">&lt;-</span> <span class="va">winters_hours</span><span class="op">$</span><span class="va">Temp</span><span class="op">[</span><span class="va">start_hour_winters</span><span class="op">:</span><span class="va">end_hour_winters</span><span class="op">]</span></span>
<span><span class="va">option2</span> <span class="op">&lt;-</span> <span class="va">orchard_hours</span><span class="op">$</span><span class="va">Temp</span><span class="op">[</span><span class="va">start_hour_orchard</span><span class="op">:</span><span class="va">end_hour_orchard</span><span class="op">]</span></span>
<span><span class="va">option3</span> <span class="op">&lt;-</span> <span class="fu">interpolate_gaps</span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Temp_gaps</span><span class="op">)</span><span class="op">$</span><span class="va">interp</span></span>
<span><span class="va">option4</span> <span class="op">&lt;-</span> <span class="va">inter</span><span class="op">$</span><span class="va">Temp</span></span>
<span></span>
<span><span class="co"># Create a data.frame with results for each option</span></span>
<span><span class="va">all_chill</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>DATE <span class="op">=</span> <span class="va">inter</span><span class="op">$</span><span class="va">DATE</span>, Obs <span class="op">=</span> <span class="fu">Dynamic_Model</span><span class="op">(</span><span class="va">observed</span><span class="op">)</span>, Opt1 <span class="op">=</span> <span class="fu">Dynamic_Model</span><span class="op">(</span><span class="va">option1</span><span class="op">)</span>,</span>
<span>    Opt2 <span class="op">=</span> <span class="fu">Dynamic_Model</span><span class="op">(</span><span class="va">option2</span><span class="op">)</span>, Opt3 <span class="op">=</span> <span class="fu">Dynamic_Model</span><span class="op">(</span><span class="va">option3</span><span class="op">)</span>, Opt4 <span class="op">=</span> <span class="fu">Dynamic_Model</span><span class="op">(</span><span class="va">option4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Collapse columns into rows</span></span>
<span><span class="va">all_chill</span> <span class="op">&lt;-</span> <span class="fu">pivot_longer</span><span class="op">(</span><span class="va">all_chill</span>, <span class="va">Obs</span><span class="op">:</span><span class="va">Opt4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add a method column with legend names for each option</span></span>
<span><span class="va">all_chill</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">all_chill</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Obs"</span><span class="op">)</span>, <span class="st">"Method"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Observed temperatures"</span></span>
<span><span class="va">all_chill</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">all_chill</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Opt1"</span><span class="op">)</span>, <span class="st">"Method"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Option 1 - idealized record from proxy data"</span></span>
<span><span class="va">all_chill</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">all_chill</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Opt2"</span><span class="op">)</span>, <span class="st">"Method"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Option 2 - idealized record from daily orchard data"</span></span>
<span><span class="va">all_chill</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">all_chill</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Opt3"</span><span class="op">)</span>, <span class="st">"Method"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Option 3 - linear interpolation of hourly data"</span></span>
<span><span class="va">all_chill</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">all_chill</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Opt4"</span><span class="op">)</span>, <span class="st">"Method"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Option 4 - use of interpolate_gaps_hourly"</span></span>
<span></span>
<span><span class="co"># Plot the data</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">all_chill</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">DATE</span>, y <span class="op">=</span> <span class="va">value</span>, colour <span class="op">=</span> <span class="va">Method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date"</span>, y <span class="op">=</span> <span class="st">"Chill accumulation (Chill Portions)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.4</span>,</span>
<span>    <span class="fl">0.85</span><span class="op">)</span>, legend.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>, legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>, legend.key.size <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1.2</span>, <span class="st">"lines"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/11.4.2a-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb200"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## I found another way to plot.  This is quite a roundabout but I will just</span></span>
<span><span class="co">## save it here anyway.</span></span>
<span></span>
<span><span class="co"># Create a data.frame with results for each option all_chill &lt;- data.frame(DATE</span></span>
<span><span class="co"># = inter$DATE, 'Obs' = Dynamic_Model(observed), 'Opt1' =</span></span>
<span><span class="co"># Dynamic_Model(option1), 'Opt2' = Dynamic_Model(option2), 'Opt3' =</span></span>
<span><span class="co"># Dynamic_Model(option3), 'Opt4' = Dynamic_Model(option4)) The latter is not</span></span>
<span><span class="co"># necessary but I just found out how to change names of column all_chill_long</span></span>
<span><span class="co"># &lt;- pivot_longer(all_chill, cols = Obs:Opt4, names_to = 'Method', values_to =</span></span>
<span><span class="co"># 'Chill_Portion')</span></span>
<span></span>
<span><span class="co"># Fill missing values for each method (ggplot gives blank plot with NA values)</span></span>
<span><span class="co"># When I first run the coursebook codes, there were NA values and I couldn't</span></span>
<span><span class="co"># plot After I filled the missing values using tidyr, I tried running the</span></span>
<span><span class="co"># original codes again and there were no NA. Don't know why but maybe this</span></span>
<span><span class="co"># filling step is not necessary.  all_chill_long &lt;- all_chill_long %&gt;%</span></span>
<span><span class="co"># group_by(Method) %&gt;% # group_by to fill values separately for each method</span></span>
<span><span class="co"># fill values in Chill_Portion using downup direction for values missing above</span></span>
<span><span class="co"># and below within a group tidyr::fill(Chill_Portion, .direction = 'downup')</span></span>
<span><span class="co"># %&gt;% ungroup() # ungroup to return data to original data.frame</span></span>
<span></span>
<span><span class="co"># Plot the results ggplot(all_chill_long, aes(x = DATE, y = Chill_Portion,</span></span>
<span><span class="co"># colour = Method)) + geom_line(size = 1.2) + labs(x = 'Date', y = 'Chill</span></span>
<span><span class="co"># accumulation (Chill Portions)') + scale_color_discrete(name = 'Method',</span></span>
<span><span class="co"># labels = c('Observed temperatures', 'Option 1 - idealized record from proxy</span></span>
<span><span class="co"># data', 'Option 2 - idealized record from daily orchard data', 'Option 3 -</span></span>
<span><span class="co"># linear interpolation of hourly data', 'Option 4 - use of</span></span>
<span><span class="co"># interpolate_gaps_hourly')) + theme( legend.position = c(0.25, 0.85),</span></span>
<span><span class="co"># legend.background = element_rect(fill = 'white', size = 0.2), legend.text =</span></span>
<span><span class="co"># element_text(size = 18), legend.title = element_text(size = 20),</span></span>
<span><span class="co"># legend.key.size = unit(1.2, 'lines') )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li><p>This figure shows that chill accumulation differed substantially between the options. Both the use of proxy data and the use of linear interpolation of hourly temperatures led to considerable overestimation of chill accumulation.</p></li>
<li><p>Do the same assessment for heat:</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb201"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">all_heat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>DATE <span class="op">=</span> <span class="va">inter</span><span class="op">$</span><span class="va">DATE</span>, Obs <span class="op">=</span> <span class="fu">GDH</span><span class="op">(</span><span class="va">observed</span><span class="op">)</span>, Opt1 <span class="op">=</span> <span class="fu">GDH</span><span class="op">(</span><span class="va">option1</span><span class="op">)</span>,</span>
<span>    Opt2 <span class="op">=</span> <span class="fu">GDH</span><span class="op">(</span><span class="va">option2</span><span class="op">)</span>, Opt3 <span class="op">=</span> <span class="fu">GDH</span><span class="op">(</span><span class="va">option3</span><span class="op">)</span>, Opt4 <span class="op">=</span> <span class="fu">GDH</span><span class="op">(</span><span class="va">option4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">all_heat</span> <span class="op">&lt;-</span> <span class="fu">pivot_longer</span><span class="op">(</span><span class="va">all_heat</span>, <span class="va">Obs</span><span class="op">:</span><span class="va">Opt4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">all_heat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">all_heat</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Obs"</span><span class="op">)</span>, <span class="st">"Method"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Observed temperatures"</span></span>
<span><span class="va">all_heat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">all_heat</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Opt1"</span><span class="op">)</span>, <span class="st">"Method"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Option 1 - idealized record from proxy data"</span></span>
<span><span class="va">all_heat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">all_heat</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Opt2"</span><span class="op">)</span>, <span class="st">"Method"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Option 2 - idealized record from daily orchard data"</span></span>
<span><span class="va">all_heat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">all_heat</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Opt3"</span><span class="op">)</span>, <span class="st">"Method"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Option 3 - linear interpolation of hourly data"</span></span>
<span><span class="va">all_heat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">all_heat</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Opt4"</span><span class="op">)</span>, <span class="st">"Method"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Option 4 - use of interpolate_gaps_hourly"</span></span>
<span></span>
<span><span class="co"># Plot the data</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">all_heat</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">DATE</span>, y <span class="op">=</span> <span class="va">value</span>, colour <span class="op">=</span> <span class="va">Method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_line</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date"</span>, y <span class="op">=</span> <span class="st">"Heat accumulation (Growing Degree Hours)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.4</span>,</span>
<span>    <span class="fl">0.85</span><span class="op">)</span>, legend.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>, legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>, legend.key.size <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1.2</span>, <span class="st">"lines"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/11.4.2b-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li><p>This comparison doesn’t look quite as bad as for chill accumulation, but also here, option 4 clearly provided the most accurate estimate (it almost coincides with the red line, making the difference hard to see).</p></li>
<li><p>This dataset didn’t cover the winter season, so the chill numbers aren’t too meaningful, but it is nevertheless instructive to compare the total accumulation of chill and heat over the whole temperature record:</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb202"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">CH_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Option <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">4</span>, Input_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"observed"</span>, <span class="st">"daily"</span>, <span class="st">"daily"</span>,</span>
<span>    <span class="st">"hourly"</span>, <span class="st">"hourly"</span><span class="op">)</span>, Interpolation_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"from proxy"</span>, <span class="st">"local extremes"</span>,</span>
<span>    <span class="st">"linear"</span>, <span class="st">"hourly interpolation"</span><span class="op">)</span>, Chill_Portions <span class="op">=</span> <span class="cn">NA</span>, Growing_Degree_Hours <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span><span class="va">CH_table</span><span class="op">$</span><span class="va">Chill_Portions</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">all_chill</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarise</span><span class="op">(</span>total_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">value</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">total_value</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">CH_table</span><span class="op">$</span><span class="va">Growing_Degree_Hours</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">all_heat</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarise</span><span class="op">(</span>total_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">value</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">total_value</span></span>
<span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">CH_table</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Option</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Input_data</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Interpolation_method</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Chill_Portions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Growing_Degree_Hours</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: left;">observed</td>
<td style="text-align: left;">none</td>
<td style="text-align: right;">39916.09</td>
<td style="text-align: right;">218539172</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">daily</td>
<td style="text-align: left;">from proxy</td>
<td style="text-align: right;">77422.85</td>
<td style="text-align: right;">194474355</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">daily</td>
<td style="text-align: left;">local extremes</td>
<td style="text-align: right;">42711.03</td>
<td style="text-align: right;">211997951</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">hourly</td>
<td style="text-align: left;">linear</td>
<td style="text-align: right;">70097.59</td>
<td style="text-align: right;">235056189</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: left;">hourly</td>
<td style="text-align: left;">hourly interpolation</td>
<td style="text-align: right;">45740.35</td>
<td style="text-align: right;">217147307</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<ul>
<li><p>This comparison shows that the choice of interpolation method can have substantial impact on our impression of accumulated chill and heat.</p></li>
<li><p>The <code><a href="https://rdrr.io/pkg/chillR/man/interpolate_gaps_hourly.html">interpolate_gaps_hourly()</a></code> function in <code>chillR</code> outperformed all other methods evaluated here.</p></li>
</ul>
<p><br></p>
</section></section><section id="exercises-on-filling-gaps" class="level3"><h3 class="anchored" data-anchor-id="exercises-on-filling-gaps">
<span style="color:#71797E">11.5</span>&nbsp; Exercises on filling gaps</h3>
<div style="height: 18px;">

</div>
<p><em>You already downloaded some weather data in the exercises for the Getting temperatures lesson. You can keep working with this.</em></p>
<p><strong><em>1. Use <code>chillR</code> functions to find out how many gaps you have in this dataset (even if you have none, please still follow all further steps)</em></strong></p>
<p>There are large gaps in the dataset, particularly missing data for whole years between 1992 and 2002.</p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb203"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">MS_weather</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/MS/STG_chillR_weather.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MS_weather_gap_check</span> <span class="op">&lt;-</span> <span class="fu">fix_weather</span><span class="op">(</span><span class="va">MS_weather</span><span class="op">)</span><span class="op">$</span><span class="va">QC</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">MS_weather_gap_check</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Incomplete_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1989/1990</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990/1991</td>
<td style="text-align: right;">1991</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1991/1992</td>
<td style="text-align: right;">1992</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1992/1993</td>
<td style="text-align: right;">1993</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1993/1994</td>
<td style="text-align: right;">1994</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1994/1995</td>
<td style="text-align: right;">1995</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1995/1996</td>
<td style="text-align: right;">1996</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1996/1997</td>
<td style="text-align: right;">1997</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1997/1998</td>
<td style="text-align: right;">1998</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1998/1999</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1999/2000</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2000/2001</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2001/2002</td>
<td style="text-align: right;">2002</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2002/2003</td>
<td style="text-align: right;">2003</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">316</td>
<td style="text-align: right;">316</td>
<td style="text-align: right;">316</td>
<td style="text-align: right;">13.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2003/2004</td>
<td style="text-align: right;">2004</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2004/2005</td>
<td style="text-align: right;">2005</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2005/2006</td>
<td style="text-align: right;">2006</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2006/2007</td>
<td style="text-align: right;">2007</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2007/2008</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">99.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">2008/2009</td>
<td style="text-align: right;">2009</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2009/2010</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2010/2011</td>
<td style="text-align: right;">2011</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2011/2012</td>
<td style="text-align: right;">2012</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2012/2013</td>
<td style="text-align: right;">2013</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2013/2014</td>
<td style="text-align: right;">2014</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">99.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">2014/2015</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2015/2016</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2016/2017</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2017/2018</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2018/2019</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2019/2020</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p><strong><em>2. Create a list of the 25 closest weather stations using the <code>handle_gsod</code> function</em></strong></p>
<p>List of stations from GSOD database:</p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb204"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Look for stations near M&amp;ouml;ssigen (48.40567° N, 9.05419° E)</span></span>
<span><span class="va">MS_station_list</span> <span class="op">&lt;-</span> <span class="fu">handle_gsod</span><span class="op">(</span>action <span class="op">=</span> <span class="st">"list_stations"</span>, location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>long <span class="op">=</span> <span class="fl">9.05</span>,</span>
<span>    lat <span class="op">=</span> <span class="fl">48.4</span><span class="op">)</span>, time_interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1990</span>, <span class="fl">2020</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">MS_station_list</span>, caption <span class="op">=</span> <span class="st">"The 25 closet weather stations to Mössigen"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>The 25 closet weather stations to Mössigen</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">chillR_code</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">STATION.NAME</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">CTRY</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Lat</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Long</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BEGIN</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">END</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Distance</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Overlap_years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_interval_covered</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">10826099999</td>
<td style="text-align: left;">TUBINGEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.517</td>
<td style="text-align: right;">9.050</td>
<td style="text-align: right;">19730101</td>
<td style="text-align: right;">19790809</td>
<td style="text-align: right;">13.02</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">10827099999</td>
<td style="text-align: left;">MESSSTETTEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.183</td>
<td style="text-align: right;">9.000</td>
<td style="text-align: right;">19740820</td>
<td style="text-align: right;">19971231</td>
<td style="text-align: right;">24.44</td>
<td style="text-align: right;">8.00</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10738099999</td>
<td style="text-align: left;">STUTTGART</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.690</td>
<td style="text-align: right;">9.222</td>
<td style="text-align: right;">19390902</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">34.68</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">10828099999</td>
<td style="text-align: left;">SIGMARINGEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.100</td>
<td style="text-align: right;">9.250</td>
<td style="text-align: right;">19950201</td>
<td style="text-align: right;">19971230</td>
<td style="text-align: right;">36.54</td>
<td style="text-align: right;">2.91</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10818099999</td>
<td style="text-align: left;">KLIPPENECK (CLIFF)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.100</td>
<td style="text-align: right;">8.750</td>
<td style="text-align: right;">19300903</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">40.12</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="even">
<td style="text-align: left;">10737099999</td>
<td style="text-align: left;">STUTTGART</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.767</td>
<td style="text-align: right;">9.183</td>
<td style="text-align: right;">19360701</td>
<td style="text-align: right;">20030425</td>
<td style="text-align: right;">42.01</td>
<td style="text-align: right;">13.31</td>
<td style="text-align: right;">43</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10834099999</td>
<td style="text-align: left;">RIEDLINGEN (AUT)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.167</td>
<td style="text-align: right;">9.500</td>
<td style="text-align: right;">19880105</td>
<td style="text-align: right;">19921231</td>
<td style="text-align: right;">42.24</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">10815099999</td>
<td style="text-align: left;">FREUDENSTADT</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.450</td>
<td style="text-align: right;">8.417</td>
<td style="text-align: right;">19730101</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">47.09</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10921099999</td>
<td style="text-align: left;">NEUHAUSEN OB ECK</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">47.983</td>
<td style="text-align: right;">8.900</td>
<td style="text-align: right;">19730102</td>
<td style="text-align: right;">19950228</td>
<td style="text-align: right;">47.74</td>
<td style="text-align: right;">5.16</td>
<td style="text-align: right;">17</td>
</tr>
<tr class="even">
<td style="text-align: left;">10739099999</td>
<td style="text-align: left;">STUTTGART/SCHNARREN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.833</td>
<td style="text-align: right;">9.200</td>
<td style="text-align: right;">19840807</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">49.45</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10832099999</td>
<td style="text-align: left;">TUERKHEIM</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.583</td>
<td style="text-align: right;">9.783</td>
<td style="text-align: right;">20040818</td>
<td style="text-align: right;">20040818</td>
<td style="text-align: right;">57.79</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">10835099999</td>
<td style="text-align: left;">GOPPINGEN(US ARMY)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.717</td>
<td style="text-align: right;">9.700</td>
<td style="text-align: right;">19730102</td>
<td style="text-align: right;">19750214</td>
<td style="text-align: right;">59.49</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10835499999</td>
<td style="text-align: left;">GOPPINGEN (USA-AF)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.717</td>
<td style="text-align: right;">9.700</td>
<td style="text-align: right;">19370104</td>
<td style="text-align: right;">19900201</td>
<td style="text-align: right;">59.49</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">10912099999</td>
<td style="text-align: left;">DONAUESCHINGEN VILLINGEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">47.973</td>
<td style="text-align: right;">8.522</td>
<td style="text-align: right;">20040406</td>
<td style="text-align: right;">20191118</td>
<td style="text-align: right;">61.61</td>
<td style="text-align: right;">15.62</td>
<td style="text-align: right;">50</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10736099999</td>
<td style="text-align: left;">MUEHLACKER (AUT)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.967</td>
<td style="text-align: right;">8.867</td>
<td style="text-align: right;">19790314</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">64.54</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="even">
<td style="text-align: left;">10838099999</td>
<td style="text-align: left;">ULM (MIL/MET)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.383</td>
<td style="text-align: right;">9.950</td>
<td style="text-align: right;">19490101</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">66.56</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10837099999</td>
<td style="text-align: left;">LAUPHEIM</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.220</td>
<td style="text-align: right;">9.910</td>
<td style="text-align: right;">19730102</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">66.75</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">10836099999</td>
<td style="text-align: left;">STOETTEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.667</td>
<td style="text-align: right;">9.867</td>
<td style="text-align: right;">19490101</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">67.16</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10839099999</td>
<td style="text-align: left;">ULM/WILHELMSBURG &amp;</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.400</td>
<td style="text-align: right;">9.983</td>
<td style="text-align: right;">19410116</td>
<td style="text-align: right;">19430430</td>
<td style="text-align: right;">68.96</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">10805199999</td>
<td style="text-align: left;">BADEN OOS</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.791</td>
<td style="text-align: right;">8.187</td>
<td style="text-align: right;">20171201</td>
<td style="text-align: right;">20180522</td>
<td style="text-align: right;">77.02</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10725099999</td>
<td style="text-align: left;">BADEN-OOS</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.800</td>
<td style="text-align: right;">8.183</td>
<td style="text-align: right;">19770803</td>
<td style="text-align: right;">20020311</td>
<td style="text-align: right;">77.83</td>
<td style="text-align: right;">12.19</td>
<td style="text-align: right;">39</td>
</tr>
<tr class="even">
<td style="text-align: left;">10929099999</td>
<td style="text-align: left;">KONSTANZ</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">47.683</td>
<td style="text-align: right;">9.183</td>
<td style="text-align: right;">19360102</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">80.43</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">06671099999</td>
<td style="text-align: left;">STECKBORN</td>
<td style="text-align: left;">CH</td>
<td style="text-align: right;">47.667</td>
<td style="text-align: right;">8.983</td>
<td style="text-align: right;">20120209</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">81.75</td>
<td style="text-align: right;">8.90</td>
<td style="text-align: right;">29</td>
</tr>
<tr class="even">
<td style="text-align: left;">10727599999</td>
<td style="text-align: left;">KARLSRUHE BADEN BADEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.779</td>
<td style="text-align: right;">8.081</td>
<td style="text-align: right;">19970723</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">82.89</td>
<td style="text-align: right;">23.44</td>
<td style="text-align: right;">76</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10702099999</td>
<td style="text-align: left;">KARLSRUHE/BADEN-B</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.783</td>
<td style="text-align: right;">8.083</td>
<td style="text-align: right;">19860107</td>
<td style="text-align: right;">20010918</td>
<td style="text-align: right;">82.99</td>
<td style="text-align: right;">11.72</td>
<td style="text-align: right;">38</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p>I tried to patch data with stations from GSOD database, using the <code><a href="https://rdrr.io/pkg/chillR/man/handle_gsod.html">handle_gsod()</a></code> function, but I could not patch the data. I think it could be problems with distance and the few overlap years— it didn’t work even when I used all stations in the list.</p>
<p>So, I looked around a bit and found <code><a href="https://rdrr.io/pkg/chillR/man/handle_dwd.html">handle_dwd()</a></code> function, which draws data from the Deutscher Wetterdienst database. Since my location is in Germany, I decided to try it and it worked well.</p>
<p>Here is the list of 25 closest stations using <code><a href="https://rdrr.io/pkg/chillR/man/handle_dwd.html">handle_dwd()</a></code></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb205"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">MS_station_list_dwd</span> <span class="op">&lt;-</span> <span class="fu">handle_dwd</span><span class="op">(</span>action <span class="op">=</span> <span class="st">"list_stations"</span>, location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">9.05</span>, <span class="fl">48.4</span><span class="op">)</span>,</span>
<span>    time_interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">19900101</span>, <span class="fl">20201231</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">MS_station_list_dwd</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Station_name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Region</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Station_ID</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Elevation</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Latitude</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Longitude</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Begin</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">End</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Distance</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">386</td>
<td style="text-align: left;">Hechingen</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">02074</td>
<td style="text-align: right;">518</td>
<td style="text-align: right;">48.3752</td>
<td style="text-align: right;">8.9800</td>
<td style="text-align: left;">19470101</td>
<td style="text-align: left;">20231231</td>
<td style="text-align: right;">5.87</td>
</tr>
<tr class="even">
<td style="text-align: left;">794</td>
<td style="text-align: left;">Rottenburg-Kiebingen</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">04294</td>
<td style="text-align: right;">360</td>
<td style="text-align: right;">48.4704</td>
<td style="text-align: right;">8.9687</td>
<td style="text-align: left;">19790701</td>
<td style="text-align: left;">20021031</td>
<td style="text-align: right;">9.87</td>
</tr>
<tr class="odd">
<td style="text-align: left;">7</td>
<td style="text-align: left;">Albstadt-Onstmettingen</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">00072</td>
<td style="text-align: right;">794</td>
<td style="text-align: right;">48.2766</td>
<td style="text-align: right;">9.0001</td>
<td style="text-align: left;">19780901</td>
<td style="text-align: left;">19950531</td>
<td style="text-align: right;">14.23</td>
</tr>
<tr class="even">
<td style="text-align: left;">775</td>
<td style="text-align: left;">Reutlingen-Betzingen</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">04166</td>
<td style="text-align: right;">360</td>
<td style="text-align: right;">48.5051</td>
<td style="text-align: right;">9.1833</td>
<td style="text-align: left;">19880501</td>
<td style="text-align: left;">20021231</td>
<td style="text-align: right;">15.29</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6</td>
<td style="text-align: left;">Albstadt-Badkap</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">00071</td>
<td style="text-align: right;">759</td>
<td style="text-align: right;">48.2156</td>
<td style="text-align: right;">8.9784</td>
<td style="text-align: left;">19861101</td>
<td style="text-align: left;">20191231</td>
<td style="text-align: right;">21.20</td>
</tr>
<tr class="even">
<td style="text-align: left;">943</td>
<td style="text-align: left;">Trochtelfingen-Wilsingen</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">05107</td>
<td style="text-align: right;">769</td>
<td style="text-align: right;">48.2814</td>
<td style="text-align: right;">9.3137</td>
<td style="text-align: left;">19880601</td>
<td style="text-align: left;">20031231</td>
<td style="text-align: right;">23.56</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1239</td>
<td style="text-align: left;">UrachBad/Erms</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">19580</td>
<td style="text-align: right;">471</td>
<td style="text-align: right;">48.4951</td>
<td style="text-align: right;">9.4003</td>
<td style="text-align: left;">19750101</td>
<td style="text-align: left;">20051231</td>
<td style="text-align: right;">27.95</td>
</tr>
<tr class="even">
<td style="text-align: left;">656</td>
<td style="text-align: left;">Nagold</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">03432</td>
<td style="text-align: right;">380</td>
<td style="text-align: right;">48.5675</td>
<td style="text-align: right;">8.7179</td>
<td style="text-align: left;">19490101</td>
<td style="text-align: left;">19950331</td>
<td style="text-align: right;">30.79</td>
</tr>
<tr class="odd">
<td style="text-align: left;">115</td>
<td style="text-align: left;">Böblingen</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">00576</td>
<td style="text-align: right;">445</td>
<td style="text-align: right;">48.6759</td>
<td style="text-align: right;">8.9732</td>
<td style="text-align: left;">19870801</td>
<td style="text-align: left;">20031231</td>
<td style="text-align: right;">31.23</td>
</tr>
<tr class="even">
<td style="text-align: left;">651</td>
<td style="text-align: left;">Münsingen-Apfelstetten</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">03402</td>
<td style="text-align: right;">755</td>
<td style="text-align: right;">48.3851</td>
<td style="text-align: right;">9.4837</td>
<td style="text-align: left;">19460101</td>
<td style="text-align: left;">20231231</td>
<td style="text-align: right;">32.10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">699</td>
<td style="text-align: left;">Nürtingen</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">03671</td>
<td style="text-align: right;">280</td>
<td style="text-align: right;">48.6321</td>
<td style="text-align: right;">9.3261</td>
<td style="text-align: left;">19550101</td>
<td style="text-align: left;">19910331</td>
<td style="text-align: right;">32.90</td>
</tr>
<tr class="even">
<td style="text-align: left;">908</td>
<td style="text-align: left;">Stuttgart-Echterdingen</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">04931</td>
<td style="text-align: right;">371</td>
<td style="text-align: right;">48.6883</td>
<td style="text-align: right;">9.2235</td>
<td style="text-align: left;">19530101</td>
<td style="text-align: left;">20231231</td>
<td style="text-align: right;">34.55</td>
</tr>
<tr class="odd">
<td style="text-align: left;">703</td>
<td style="text-align: left;">Oberndorf/Neckar-Aistaig</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">03705</td>
<td style="text-align: right;">475</td>
<td style="text-align: right;">48.3147</td>
<td style="text-align: right;">8.5735</td>
<td style="text-align: left;">19820701</td>
<td style="text-align: left;">20041231</td>
<td style="text-align: right;">36.50</td>
</tr>
<tr class="even">
<td style="text-align: left;">972</td>
<td style="text-align: left;">Waldachtal-Lützenhardt</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">05289</td>
<td style="text-align: right;">595</td>
<td style="text-align: right;">48.4918</td>
<td style="text-align: right;">8.5612</td>
<td style="text-align: left;">19830101</td>
<td style="text-align: left;">20080430</td>
<td style="text-align: right;">37.51</td>
</tr>
<tr class="odd">
<td style="text-align: left;">875</td>
<td style="text-align: left;">Sigmaringen-Laiz</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">04703</td>
<td style="text-align: right;">581</td>
<td style="text-align: right;">48.0719</td>
<td style="text-align: right;">9.1943</td>
<td style="text-align: left;">19510101</td>
<td style="text-align: left;">20231231</td>
<td style="text-align: right;">38.06</td>
</tr>
<tr class="even">
<td style="text-align: left;">552</td>
<td style="text-align: left;">Lenningen-Schopfloch</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">02949</td>
<td style="text-align: right;">758</td>
<td style="text-align: right;">48.5396</td>
<td style="text-align: right;">9.5275</td>
<td style="text-align: left;">19470801</td>
<td style="text-align: left;">20020131</td>
<td style="text-align: right;">38.52</td>
</tr>
<tr class="odd">
<td style="text-align: left;">795</td>
<td style="text-align: left;">Rottweil</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">04300</td>
<td style="text-align: right;">588</td>
<td style="text-align: right;">48.1815</td>
<td style="text-align: right;">8.6356</td>
<td style="text-align: left;">19570201</td>
<td style="text-align: left;">20231231</td>
<td style="text-align: right;">39.16</td>
</tr>
<tr class="even">
<td style="text-align: left;">774</td>
<td style="text-align: left;">Renningen-Ihinger Hof</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">04160</td>
<td style="text-align: right;">478</td>
<td style="text-align: right;">48.7425</td>
<td style="text-align: right;">8.9240</td>
<td style="text-align: left;">19701222</td>
<td style="text-align: left;">20231231</td>
<td style="text-align: right;">39.24</td>
</tr>
<tr class="odd">
<td style="text-align: left;">495</td>
<td style="text-align: left;">Klippeneck</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">02638</td>
<td style="text-align: right;">974</td>
<td style="text-align: right;">48.1054</td>
<td style="text-align: right;">8.7548</td>
<td style="text-align: left;">19470101</td>
<td style="text-align: left;">20231231</td>
<td style="text-align: right;">39.43</td>
</tr>
<tr class="even">
<td style="text-align: left;">904</td>
<td style="text-align: left;">Stuttgart (Neckartal)</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">04926</td>
<td style="text-align: right;">224</td>
<td style="text-align: right;">48.7896</td>
<td style="text-align: right;">9.2167</td>
<td style="text-align: left;">19460101</td>
<td style="text-align: left;">20130514</td>
<td style="text-align: right;">45.07</td>
</tr>
<tr class="odd">
<td style="text-align: left;">298</td>
<td style="text-align: left;">Freudenstadt-Kurgarten</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">01467</td>
<td style="text-align: right;">736</td>
<td style="text-align: right;">48.4607</td>
<td style="text-align: right;">8.4141</td>
<td style="text-align: left;">19480101</td>
<td style="text-align: left;">20091231</td>
<td style="text-align: right;">47.46</td>
</tr>
<tr class="even">
<td style="text-align: left;">299</td>
<td style="text-align: left;">Freudenstadt</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">01468</td>
<td style="text-align: right;">797</td>
<td style="text-align: right;">48.4538</td>
<td style="text-align: right;">8.4090</td>
<td style="text-align: left;">19490101</td>
<td style="text-align: left;">20231231</td>
<td style="text-align: right;">47.73</td>
</tr>
<tr class="odd">
<td style="text-align: left;">665</td>
<td style="text-align: left;">Neuhausen ob Eck</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">03518</td>
<td style="text-align: right;">793</td>
<td style="text-align: right;">47.9760</td>
<td style="text-align: right;">8.9101</td>
<td style="text-align: left;">19710101</td>
<td style="text-align: left;">19931231</td>
<td style="text-align: right;">48.33</td>
</tr>
<tr class="even">
<td style="text-align: left;">906</td>
<td style="text-align: left;">Stuttgart (Schnarrenberg)</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">04928</td>
<td style="text-align: right;">314</td>
<td style="text-align: right;">48.8281</td>
<td style="text-align: right;">9.2000</td>
<td style="text-align: left;">19580101</td>
<td style="text-align: left;">20231231</td>
<td style="text-align: right;">48.92</td>
</tr>
<tr class="odd">
<td style="text-align: left;">222</td>
<td style="text-align: left;">Ebersbach/Fils</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">01102</td>
<td style="text-align: right;">300</td>
<td style="text-align: right;">48.7201</td>
<td style="text-align: right;">9.5328</td>
<td style="text-align: left;">19871101</td>
<td style="text-align: left;">20021231</td>
<td style="text-align: right;">50.35</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p><strong><em>3. Identify suitable weather stations for patching gaps</em></strong></p>
<p>I chose the suitable weather stations based on the distance and start/end years. Here are the list of stations I chose for patching weather data:</p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb206"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">kable</span><span class="op">(</span><span class="va">MS_station_list_dwd</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">7</span><span class="op">)</span>, <span class="op">]</span>, caption <span class="op">=</span> <span class="st">"List of suitable weather stations for patching weather data"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>List of suitable weather stations for patching weather data</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Station_name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Region</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Station_ID</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Elevation</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Latitude</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Longitude</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Begin</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">End</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Distance</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">386</td>
<td style="text-align: left;">Hechingen</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">02074</td>
<td style="text-align: right;">518</td>
<td style="text-align: right;">48.3752</td>
<td style="text-align: right;">8.9800</td>
<td style="text-align: left;">19470101</td>
<td style="text-align: left;">20231231</td>
<td style="text-align: right;">5.87</td>
</tr>
<tr class="even">
<td style="text-align: left;">794</td>
<td style="text-align: left;">Rottenburg-Kiebingen</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">04294</td>
<td style="text-align: right;">360</td>
<td style="text-align: right;">48.4704</td>
<td style="text-align: right;">8.9687</td>
<td style="text-align: left;">19790701</td>
<td style="text-align: left;">20021031</td>
<td style="text-align: right;">9.87</td>
</tr>
<tr class="odd">
<td style="text-align: left;">775</td>
<td style="text-align: left;">Reutlingen-Betzingen</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">04166</td>
<td style="text-align: right;">360</td>
<td style="text-align: right;">48.5051</td>
<td style="text-align: right;">9.1833</td>
<td style="text-align: left;">19880501</td>
<td style="text-align: left;">20021231</td>
<td style="text-align: right;">15.29</td>
</tr>
<tr class="even">
<td style="text-align: left;">1239</td>
<td style="text-align: left;">UrachBad/Erms</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">19580</td>
<td style="text-align: right;">471</td>
<td style="text-align: right;">48.4951</td>
<td style="text-align: right;">9.4003</td>
<td style="text-align: left;">19750101</td>
<td style="text-align: left;">20051231</td>
<td style="text-align: right;">27.95</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p><strong><em>4. Download weather data for promising stations, convert them to <code>chillR</code> format and compile them in a list</em></strong></p>
<p>Unlike the <code><a href="https://rdrr.io/pkg/chillR/man/handle_gsod.html">handle_gsod()</a></code> function, there is no need to convert to <code>chillR</code> format with an additional line of code with the <code><a href="https://rdrr.io/pkg/chillR/man/handle_dwd.html">handle_dwd()</a></code> function, as seen in the table below.</p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb207"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Download weather data for promising stations</span></span>
<span><span class="va">MS_patch_weather</span> <span class="op">&lt;-</span> <span class="fu">handle_dwd</span><span class="op">(</span>action <span class="op">=</span> <span class="st">"download_weather"</span>, location <span class="op">=</span> <span class="va">MS_station_list_dwd</span><span class="op">$</span><span class="va">Station_ID</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,</span>
<span>    <span class="fl">4</span>, <span class="fl">7</span>, <span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">MS_patch_weather</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">YEARMODA</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Station_ID</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Wind_speed</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Wind_speed_max</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ATM_pressure</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Rainfall</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Snow</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin_5cm</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">RH</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">VPD</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">19160101</td>
<td style="text-align: right;">1916</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">02074</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">19160102</td>
<td style="text-align: right;">1916</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">02074</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19160103</td>
<td style="text-align: right;">1916</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">02074</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">19160104</td>
<td style="text-align: right;">1916</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">02074</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19160105</td>
<td style="text-align: right;">1916</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">02074</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">19160106</td>
<td style="text-align: right;">1916</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">02074</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19160107</td>
<td style="text-align: right;">1916</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">02074</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">19160108</td>
<td style="text-align: right;">1916</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">02074</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19160109</td>
<td style="text-align: right;">1916</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">02074</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">19160110</td>
<td style="text-align: right;">1916</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">02074</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p><strong><em>5. Use the <code>patch_daily_temperatures</code> function to fill gaps</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb208"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">MS_weather</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/MS/STG_chillR_weather.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MS_patched</span> <span class="op">&lt;-</span> <span class="fu">patch_daily_temperatures</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">MS_weather</span>, patch_weather <span class="op">=</span> <span class="va">MS_patch_weather</span>,</span>
<span>    max_mean_bias <span class="op">=</span> <span class="fl">1</span>, max_stdev_bias <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine list elements into a data.frame to display patched statistics</span></span>
<span><span class="va">patched_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">MS_patched</span><span class="op">$</span><span class="va">statistics</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">patched_stats</span>, <span class="st">"data/MS/patched_stats.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MS_patched_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/MS/patched_stats.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">MS_patched_stats</span>, caption <span class="op">=</span> <span class="st">"Patched Statistics for Mössigen"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Patched Statistics for Mössigen</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">X</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stdev_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">filled</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">gaps_remain</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Rottenburg-Kiebingen.Tmin</td>
<td style="text-align: right;">0.334</td>
<td style="text-align: right;">1.684</td>
<td style="text-align: right;">3300</td>
<td style="text-align: right;">1036</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rottenburg-Kiebingen.Tmax</td>
<td style="text-align: right;">-0.523</td>
<td style="text-align: right;">1.101</td>
<td style="text-align: right;">3300</td>
<td style="text-align: right;">1036</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Reutlingen-Betzingen.Tmin</td>
<td style="text-align: right;">-0.627</td>
<td style="text-align: right;">1.126</td>
<td style="text-align: right;">352</td>
<td style="text-align: right;">684</td>
</tr>
<tr class="even">
<td style="text-align: left;">Reutlingen-Betzingen.Tmax</td>
<td style="text-align: right;">-0.328</td>
<td style="text-align: right;">0.935</td>
<td style="text-align: right;">352</td>
<td style="text-align: right;">684</td>
</tr>
<tr class="odd">
<td style="text-align: left;">UrachBad/Erms.Tmin</td>
<td style="text-align: right;">0.017</td>
<td style="text-align: right;">1.455</td>
<td style="text-align: right;">682</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">UrachBad/Erms.Tmax</td>
<td style="text-align: right;">0.304</td>
<td style="text-align: right;">1.256</td>
<td style="text-align: right;">682</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hechingen.Tmin</td>
<td style="text-align: right;">0.824</td>
<td style="text-align: right;">1.585</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hechingen.Tmax</td>
<td style="text-align: right;">0.355</td>
<td style="text-align: right;">1.205</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb209"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Save for later use</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">MS_patched</span><span class="op">$</span><span class="va">weather</span>, <span class="st">"data/MS/MS_patched_weather.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
<p><strong><em>6. Investigate the results— have all gaps been filled?</em></strong></p>
<p>All gaps have been filled as shown in the table.</p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb210"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">MS_QC</span> <span class="op">&lt;-</span> <span class="fu">fix_weather</span><span class="op">(</span><span class="va">MS_patched</span><span class="op">)</span><span class="op">$</span><span class="va">QC</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">MS_QC</span>, <span class="st">"data/MS/MS_QC.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MS_patched_QC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/MS/MS_QC.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">MS_patched_QC</span>, caption <span class="op">=</span> <span class="st">"Check gaps on patched weather dataset for Mössigen"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Check gaps on patched weather dataset for Mössigen</caption>
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">X</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Incomplete_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">1989/1990</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">1990/1991</td>
<td style="text-align: right;">1991</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">1991/1992</td>
<td style="text-align: right;">1992</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">1992/1993</td>
<td style="text-align: right;">1993</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">1993/1994</td>
<td style="text-align: right;">1994</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: left;">1994/1995</td>
<td style="text-align: right;">1995</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: left;">1995/1996</td>
<td style="text-align: right;">1996</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: left;">1996/1997</td>
<td style="text-align: right;">1997</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: left;">1997/1998</td>
<td style="text-align: right;">1998</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: left;">1998/1999</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11</td>
<td style="text-align: left;">1999/2000</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">12</td>
<td style="text-align: left;">2000/2001</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">13</td>
<td style="text-align: left;">2001/2002</td>
<td style="text-align: right;">2002</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">14</td>
<td style="text-align: left;">2002/2003</td>
<td style="text-align: right;">2003</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15</td>
<td style="text-align: left;">2003/2004</td>
<td style="text-align: right;">2004</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">16</td>
<td style="text-align: left;">2004/2005</td>
<td style="text-align: right;">2005</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">17</td>
<td style="text-align: left;">2005/2006</td>
<td style="text-align: right;">2006</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">18</td>
<td style="text-align: left;">2006/2007</td>
<td style="text-align: right;">2007</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19</td>
<td style="text-align: left;">2007/2008</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">20</td>
<td style="text-align: left;">2008/2009</td>
<td style="text-align: right;">2009</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">21</td>
<td style="text-align: left;">2009/2010</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">22</td>
<td style="text-align: left;">2010/2011</td>
<td style="text-align: right;">2011</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">23</td>
<td style="text-align: left;">2011/2012</td>
<td style="text-align: right;">2012</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">24</td>
<td style="text-align: left;">2012/2013</td>
<td style="text-align: right;">2013</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">25</td>
<td style="text-align: left;">2013/2014</td>
<td style="text-align: right;">2014</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">26</td>
<td style="text-align: left;">2014/2015</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">27</td>
<td style="text-align: left;">2015/2016</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">28</td>
<td style="text-align: left;">2016/2017</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">29</td>
<td style="text-align: left;">2017/2018</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">30</td>
<td style="text-align: left;">2018/2019</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">31</td>
<td style="text-align: left;">2019/2020</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p><strong><em>7. If necessary, repeat until you have a dataset you can work with in further analyses</em></strong></p>
<p>I did repeat the process till I got the most suitable stations (in my opinion). The <code><a href="https://rdrr.io/pkg/chillR/man/handle_dwd.html">handle_dwd()</a></code> ran faster than the <code><a href="https://rdrr.io/pkg/chillR/man/handle_gsod.html">handle_gsod()</a></code>, so I could download all 25 stations within a few seconds. I downloaded all and check the statistics afterwards to see which stations filled the gaps. I initially chose the stations based on distance and overlap years, but then, I thought why not try all and see how it went?</p>
<p>This is what I found:</p>
<ul>
<li><p>The order to download the stations matters.</p></li>
<li><p>At first, I found station 1 is the best choice— closest in distance and it filled all the gaps if I didn’t set threshold for <code>max_mean_bias</code> and <code>max_stdev_bias</code>. So, only one station would have been needed to patch all the gaps if I didn’t mind <code>max_mean_bias</code> values of a few decimal points above 1. (Why one though?)</p></li>
<li><p>When I set those bias values, the station 1 could fill all gaps for <code>Tmin</code> but fill none for <code>Tmax</code>. Since it filled all gaps in <code>Tmin</code>, I think the program assumed that all gaps were filled (maybe the program consider <code>Tmin</code> and <code>Tmax</code> together?) and it would give <code>NA</code> values for all remaining stations I downloaded.</p></li>
<li><p>Since I want the dataset to be patched with values below the bias thresholds, I downloaded the station 1 last (<code>MS_station_list_dwd$Station_ID[c(2,4,7,1)]</code>), and it worked perfectly!</p></li>
</ul>
<p>Another thing I want to add here is I selected the best station from the list generated from the GSOD database, and patched that station with data from DWD database. Practically, I should have chosen the station 1 from the DWD list— I wouldn’t have any gaps and it would have been a better choice in terms of data quality. But, for the sake of doing the following exercises, I must either create gaps or use the station I chose from GSOD database. I chose the latter option because there might be times I could not go back to the past and redo everything— I guess it is a better practice to adapt and keep going.</p>
<p><br></p>
</section></section><section id="chapter-12-generating-temperature-scenarios" class="level2"><h2 class="anchored" data-anchor-id="chapter-12-generating-temperature-scenarios">Chapter 12: Generating temperature scenarios</h2>
<section id="chill-scenarios" class="level3"><h3 class="anchored" data-anchor-id="chill-scenarios">
<span style="color:#71797E">12.1</span>&nbsp; Chill scenarios</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>Information on chill availability (or other agroclimatic conditions) at a given site is crucial for orchard managers selecting tree species and cultivars for their orchards.</p></li>
<li><p>Looking at the historic record has already given us a lot of useful information, but this isn’t yet exactly the information that a grower making planting decisions needs.</p></li>
<li><p>What is really needed is a site-specific agroclimatic characterization that provides an impression of the range of conditions that we can reasonably expect at this location, i.e.&nbsp;how likely it is for the orchard to experience certain levels of chill, heat or whatever other metric we are interested in.</p></li>
</ul>
<p><br></p>
</section><section id="risk-assessment-in-orchard-planning" class="level3"><h3 class="anchored" data-anchor-id="risk-assessment-in-orchard-planning">
<span style="color:#71797E">12.2</span>&nbsp; Risk assessment in orchard planning</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>Since trees live and are (hopefully) productive for many years, they experience many different temperature dynamics during their productive lifetime.</p></li>
<li><p>For optimal production, trees should fulfill their climatic needs in all of these years.</p></li>
<li><p>This is why, when we select trees for planting, we need information on the plausible range of ‘weathers’ we can expect.</p></li>
<li><p>Based on this, we would be able to select trees that safely fulfill their chilling requirements in all plausible weather situations, or we could choose trees that strike a balance between early flowering and the risk of spring frost.</p></li>
<li><p>All such decisions require information on how likely it is for our orchard to experience certain conditions.</p></li>
<li><p>The plausible range of ‘weathers’ we can expect is defined by the local climate, which is the long-term average of the annually observed weather.</p></li>
<li><p>We can interpret this ‘climate’ as a virtual collection of all possible weather situations for a given location, from which we receive one random draw each year.</p></li>
<li><p>Annual weather can be interpreted as a random draw from the plausible distribution of all possible ‘weathers’.</p></li>
<li><p>For planning purposes, it would be much more useful to know this virtual distribution of possible ‘weathers’ than just looking at the random samples that happened to be drawn.</p></li>
<li><p>So far, we’ve only been able to get these samples - that was the historic analysis of observed chill.</p></li>
<li><p>We’ll try to get to the actual climate, and from there to ways to use this knowledge for producing temperature profiles for locations of interest that facilitate orchard planning.</p></li>
</ul>
<p><br></p>
</section><section id="weather-generators" class="level3"><h3 class="anchored" data-anchor-id="weather-generators">
<span style="color:#71797E">12.3</span>&nbsp; Weather generators</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>The best source of information for characterizing the climate of a given location consists in long-term weather records collected there.</p></li>
<li><p>Long-term weather records can be used to easily calculate means of monthly temperatures, rainfall extremes, the frequency of frost events and various other metrics.</p></li>
<li><p>Weather generators vary widely in the way they characterize climatic settings.</p></li>
<li><p>The <a href="https://cran.r-project.org/web/packages/RMAWGEN/index.html">RMAWGEN</a> package is the only weather generator that is compatible <code>chillR</code> structure.</p></li>
<li>
<p><a href="https://sites.google.com/view/lars-wg/">LARS-WG</a> is another weather generator that uses both temperature and rainfall data, identifying the typical length of dry and wet spells and producing distinct temperature profiles for each of these weather situations. (Luedeling et al., <a href="https://link.springer.com/article/10.1007/s00484-010-0352-y">2011a</a>, <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0020155">2011b</a>)</p>
<ul>
<li>The tool <code>chillR</code> currently uses doesn’t do that— it doesn’t even need precipitation data— but it also seems to be doing a good job.</li>
</ul>
</li>
</ul>
<ul>
<li>It is somewhat difficult to assess the performance of these tools, so there is probably still room for improvement here.</li>
</ul>
<p><br></p>
</section><section id="weather-generation-in-chillr" class="level3"><h3 class="anchored" data-anchor-id="weather-generation-in-chillr">
<span style="color:#71797E">12.4</span>&nbsp; Weather generation in <code>chillR</code>
</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p><code>chillR</code> currently can’t generate weather in a comprehensive way, but only focuses on temperature.</p></li>
<li><p>The <code>temperature_generation</code> function in <code>chillR</code> first needs to be calibrated with observed weather data, in our case long-term temperature data provided in the <code>chillR</code> format.</p></li>
<li><p>Based on this, it internally calculates parameters that characterize the local climate, which are then used to simulate a user-specified number or years of synthetic temperature data.</p></li>
<li>
<p>Besides the temperature data, for which all years have to be complete, the <code>temperature_generation</code> function needs a bit of additional information:</p>
<ul>
<li>
<strong>years:</strong> a vector specifying the years within the observed record that we want to use for climate characterization</li>
<li>
<strong>sim_years:</strong> the years we want to simulate. Note that we’re not really simulating weather for the specific years we indicate here— this is just for the way years are labeled in the output dataset</li>
<li>A few optional elements, e.g.&nbsp;<code>temperature_scenario</code>— if we use the default value, which consists of a lot of zeros, it will generate a warning message.</li>
</ul>
</li>
</ul>
<ul>
<li>Here is how to use the weather generator (just the first line of the code chunk) on the Klein-Altendorf dataset (<code>KA_weather</code>), and to get an impression of how the generated data compare with the observed records.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb211"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use weather generator on real weather data to generate simulated temp dataset</span></span>
<span><span class="va">Temp</span> <span class="op">&lt;-</span> <span class="va">KA_weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">temperature_generation</span><span class="op">(</span>years<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1998</span>,<span class="fl">2005</span><span class="op">)</span>,</span>
<span>                         sim_years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2001</span>,<span class="fl">2100</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span><span class="co"># Create a new dataset by combining observed and simulated data</span></span>
<span>                              <span class="co"># filter only data between these years</span></span>
<span><span class="va">Temperatures</span> <span class="op">&lt;-</span> <span class="va">KA_weather</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fl">1998</span><span class="op">:</span><span class="fl">2005</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="co"># only take observed data and add observe note as new Data_source column </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>Data_source<span class="op">=</span><span class="st">"observed"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="co"># Only select those columns from the list 1 of Temp (it has only one list)</span></span>
<span>    <span class="va">Temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Year</span>,<span class="va">Month</span>,<span class="va">Day</span>,<span class="va">Tmin</span>,<span class="va">Tmax</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span><span class="co"># only take simulated data and bind it- stack the observed and simulated rows</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>Data_source<span class="op">=</span><span class="st">"simulated"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># add Date column in chillR format</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>Date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2000</span>,<span class="va">Month</span>,<span class="va">Day</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the data for Tmin</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data<span class="op">=</span><span class="va">Temperatures</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span><span class="va">Date</span>,<span class="va">Tmin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_smooth</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># different colors for each year</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">Data_source</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># hides legend</span></span>
<span>  <span class="co"># customize x-axis labels:</span></span>
<span>  <span class="co"># %b:abbreviated month name, %B:full month name, %Y:year, %d:day of month,</span></span>
<span>  <span class="co"># %b %Y:Abbreviated month followed by year</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%b"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/12.4a-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb212"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Plot the data for Tmax</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data<span class="op">=</span><span class="va">Temperatures</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span><span class="va">Date</span>,<span class="va">Tmax</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_smooth</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">Data_source</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%b"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/12.4a-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li><p>The <code>geom_smooth</code> function of ggplot removed much of the noise in the dataset, which would otherwise have made this figure hard to read.</p></li>
<li><p>The overall temperature dynamics were represented quite well, though it is certainly possible that some nuances of the local weather were missed.</p></li>
<li><p>In the simulated dataset, we now have 100 years of data, even though we only used 8 years for calibration.</p></li>
<li><p>Based on these 100 years, we can now get a pretty good idea of the frequency of particular temperature-related events.</p></li>
<li><p>Let’s look at the distribution of winter chill for Klein-Altendorf based on this analysis:</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb213"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Generate hourly temps for observed data</span></span>
<span><span class="va">chill_observed</span> <span class="op">&lt;-</span> <span class="va">Temperatures</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Data_source</span> <span class="op">==</span> <span class="st">"observed"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">stack_hourly_temps</span><span class="op">(</span>latitude <span class="op">=</span> <span class="fl">50.4</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">chilling</span><span class="op">(</span>Start_JDay <span class="op">=</span> <span class="fl">305</span>, End_JDay <span class="op">=</span> <span class="fl">59</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate hourly temps for simulated data</span></span>
<span><span class="va">chill_simulated</span> <span class="op">&lt;-</span> <span class="va">Temperatures</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Data_source</span> <span class="op">==</span> <span class="st">"simulated"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">stack_hourly_temps</span><span class="op">(</span>latitude <span class="op">=</span> <span class="fl">50.4</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">chilling</span><span class="op">(</span>Start_JDay <span class="op">=</span> <span class="fl">305</span>, End_JDay <span class="op">=</span> <span class="fl">59</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Bind observed and simulated data (stacked rows)</span></span>
<span><span class="va">chill_comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">chill_observed</span>, Data_source <span class="op">=</span> <span class="st">"observed"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">chill_simulated</span>, Data_source <span class="op">=</span> <span class="st">"simulated"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove years with incomplete data days</span></span>
<span><span class="va">chill_comparison_full_seasons</span> <span class="op">&lt;-</span> <span class="va">chill_comparison</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Perc_complete</span> <span class="op">==</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the data</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">chill_comparison_full_seasons</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Chill_portions</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Data_source</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Data source"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">xlab</span><span class="op">(</span><span class="st">"Chill accumulation (Chill Portions)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Frequency"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/12.4b-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li><p>Note that in the code chunk above, we had to manually remove all incomplete winter seasons.</p></li>
<li><p>Now we have a histogram showing the distribution of chill that it would have been reasonable to expect in Klein-Altendorf betwen 1998 and 2005, and these distributions get better with more observations.</p></li>
<li><p>We can also plot these data as a cumulative distribution function, which makes it easy to extract the risk of falling below a particular level of chill accumulation.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb214"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Filter only the simulated data</span></span>
<span><span class="va">chill_simulations</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">chill_comparison_full_seasons</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Data_source</span> <span class="op">==</span> <span class="st">"simulated"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the chill portions of the data</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">chill_simulations</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Chill_portions</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Compute empirical cumulative distribution</span></span>
<span>  <span class="fu">stat_ecdf</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"step"</span>, <span class="co"># a step plot</span></span>
<span>            lwd <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>            col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Cumulative probability"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Chill accumulation (in Chill Portions)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/12.4c-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li>We can also directly compute this using the <code>quantile</code> function.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb215"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Here's the amount of chill that is exceeded in 90% of all years.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">chill_simulations</span><span class="op">$</span><span class="va">Chill_portions</span>, <span class="fl">0.1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>     10% 
76.86113 </code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb217"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># and here's the 50% confidence interval (25th to 75th percentile)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">chill_simulations</span><span class="op">$</span><span class="va">Chill_portions</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>     25%      75% 
79.78682 84.44844 </code></pre>
</div>
</div>
<p><br></p>
<ul>
<li>Note that the 10% quantile calculated above is equivalent to ‘Safe Winter Chill’.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./pic/ch12_1.png" class="img-fluid figure-img"></p>
<figcaption>Illustration of the concept of Safe Winter Chill, which is defined as the 10% quantile of the typical distribution of chill at a particular location and best calculated by using a weather generator. (<a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0006166">Luedeling et al., 2009d</a>)</figcaption></figure>
</div>
<p><br></p>
<ul>
<li><p>The idea behind Safe Winter Chill is that a grower might be able to tolerate a small risk of not meeting a tree’s chilling requirement.</p></li>
<li><p>If we grow a tree with a chilling requirement that corresponds exactly to the Safe Winter Chill of the site, we should expect chill-related problems in about one out of ten years— may or may not be an okay threshold based on the grower’s risk tolerance, but it is still a reasonable threshold to use.</p></li>
<li><p>A similar metric can be calculated for a grower with a different level of risk tolerance.</p></li>
</ul>
<p><br></p>
</section><section id="exercises-on-temperature-generation" class="level3"><h3 class="anchored" data-anchor-id="exercises-on-temperature-generation">
<span style="color:#71797E">12.5</span>&nbsp; Exercises on temperature generation</h3>
<div style="height: 18px;">

</div>
<p><strong><em>1. For the location you chose for your earlier analyses, use <code>chillR</code>’s weather generator to produce 100 years of synthetic temperature data.</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb219"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">MS_patched_weather</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/MS/MS_patched_weather.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MS_temp</span> <span class="op">&lt;-</span> <span class="va">MS_patched_weather</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">temperature_generation</span><span class="op">(</span>years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1990</span>, <span class="fl">2020</span><span class="op">)</span>, sim_years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2001</span>, <span class="fl">2100</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Modify the MS_patched_weather dataset to have same column structures as</span></span>
<span><span class="co"># MS_temp</span></span>
<span><span class="va">MS_patched_weather_fixed</span> <span class="op">&lt;-</span> <span class="va">MS_patched_weather</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="va">Year</span>, <span class="va">Month</span>, <span class="va">Day</span>, <span class="va">Tmin</span>, <span class="va">Tmax</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">MS_temperatures</span> <span class="op">&lt;-</span> <span class="va">MS_patched_weather_fixed</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fl">1990</span><span class="op">:</span><span class="fl">2020</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>Data_source <span class="op">=</span> <span class="st">"observed"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">MS_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Year</span>, <span class="va">Month</span>, <span class="va">Day</span>, <span class="va">Tmin</span>, <span class="va">Tmax</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>Data_source <span class="op">=</span> <span class="st">"simulated"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>Date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2000</span>, <span class="va">Month</span>, <span class="va">Day</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Plot for Tmin</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">MS_temperatures</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">Date</span>, <span class="va">Tmin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_smooth</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">Data_source</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_x_date</span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%b"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot for Tmax</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">MS_temperatures</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">Date</span>, <span class="va">Tmax</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_smooth</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">Data_source</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_x_date</span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%b"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine the plots vertically</span></span>
<span><span class="va">p1</span><span class="op">/</span><span class="va">p2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/12.5.1,%20-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p><strong><em>2. Calculate winter chill (in Chill Portions) for your synthetic weather, and illustrate your results as histograms and cumulative distributions.</em></strong></p>
<p><strong>Winter chill in Mössingen as histogram:</strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb220"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">MS_chill_observed</span> <span class="op">&lt;-</span> <span class="va">MS_temperatures</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Data_source</span> <span class="op">==</span> <span class="st">"observed"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">stack_hourly_temps</span><span class="op">(</span>latitude <span class="op">=</span> <span class="fl">48.4</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">chilling</span><span class="op">(</span>Start_JDay <span class="op">=</span> <span class="fl">305</span>, End_JDay <span class="op">=</span> <span class="fl">59</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MS_chill_simulated</span> <span class="op">&lt;-</span> <span class="va">MS_temperatures</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Data_source</span> <span class="op">==</span> <span class="st">"simulated"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">stack_hourly_temps</span><span class="op">(</span>latitude <span class="op">=</span> <span class="fl">48.4</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">chilling</span><span class="op">(</span>Start_JDay <span class="op">=</span> <span class="fl">305</span>, End_JDay <span class="op">=</span> <span class="fl">59</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MS_chill_comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">MS_chill_observed</span>, Data_source <span class="op">=</span> <span class="st">"observed"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">MS_chill_simulated</span>, Data_source <span class="op">=</span> <span class="st">"simulated"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MS_chill_comparison_full_seasons</span> <span class="op">&lt;-</span> <span class="va">MS_chill_comparison</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Perc_complete</span> <span class="op">==</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">MS_chill_comparison_full_seasons</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Chill_portions</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Data_source</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Data source"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">xlab</span><span class="op">(</span><span class="st">"Chill accumulation (Chill Portions)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Frequency"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/12.5.2a-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p><strong>Winter chill in Mössingen as cumulative distribution:</strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb221"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">MS_chill_simulations</span> <span class="op">&lt;-</span> <span class="va">MS_chill_comparison_full_seasons</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Data_source</span> <span class="op">==</span> <span class="st">"simulated"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">MS_chill_simulations</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Chill_portions</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">stat_ecdf</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"step"</span>,</span>
<span>    lwd <span class="op">=</span> <span class="fl">1.5</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Cumulative probability"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Chill accumulation (in Chill Portions)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/12.5.2b-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p><strong><em>3. Produce similar plots for the number of freezing hours (&lt;0°C) in April (or October, if your site is in the Southern Hemisphere) for your location of interest.</em></strong></p>
<p><strong>Check JDay for the month of April:</strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb222"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Add a freezing model</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1000</span>, <span class="fl">0</span><span class="op">)</span>, upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1000</span><span class="op">)</span>, weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">freezing_hours</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">step_model</span><span class="op">(</span><span class="va">x</span>, <span class="va">df</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Check JDay number for the month of April</span></span>
<span></span>
<span><span class="co"># Generate JDay for the dataset</span></span>
<span><span class="va">JDay_MS</span> <span class="op">&lt;-</span> <span class="fu">make_JDay</span><span class="op">(</span><span class="va">MS_temperatures</span><span class="op">$</span><span class="va">Date</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] "Table is missing at least one required column ('Day','Month' or 'Year')"</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb224"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create a data frame because JDay_MS is a vector</span></span>
<span><span class="va">JDay_MS_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">JDay_MS</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract Year, Month, and Day from the Date (to show JDay output as table)</span></span>
<span><span class="co"># This was only done because of the error message: 'Table is missing at least</span></span>
<span><span class="co"># one required column ('Day','Month' or 'Year')'</span></span>
<span><span class="va">JDay_MS_df</span><span class="op">$</span><span class="va">Year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">JDay_MS_df</span><span class="op">$</span><span class="va">Date</span>, <span class="st">"%Y"</span><span class="op">)</span></span>
<span><span class="va">JDay_MS_df</span><span class="op">$</span><span class="va">Month</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">JDay_MS_df</span><span class="op">$</span><span class="va">Date</span>, <span class="st">"%m"</span><span class="op">)</span></span>
<span><span class="va">JDay_MS_df</span><span class="op">$</span><span class="va">Day</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">JDay_MS_df</span><span class="op">$</span><span class="va">Date</span>, <span class="st">"%d"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display only for the month of April</span></span>
<span><span class="va">JDay_april</span> <span class="op">&lt;-</span> <span class="va">JDay_MS_df</span><span class="op">[</span><span class="fl">91</span><span class="op">:</span><span class="fl">120</span>, <span class="op">]</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">JDay_april</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">JDay_april</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span>, col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"JDay"</span>, <span class="st">"Date"</span>, <span class="st">"Year"</span>,</span>
<span>    <span class="st">"Month"</span>, <span class="st">"Day"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">JDay</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Date</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Day</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">91</td>
<td style="text-align: left;">2000-04-01</td>
<td style="text-align: left;">2000</td>
<td style="text-align: left;">04</td>
<td style="text-align: left;">01</td>
</tr>
<tr class="even">
<td style="text-align: left;">120</td>
<td style="text-align: left;">2000-04-30</td>
<td style="text-align: left;">2000</td>
<td style="text-align: left;">04</td>
<td style="text-align: left;">30</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p><strong>Frost incidence in Mössingen as histogram:</strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb225"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">MS_apr_chill_observed</span> <span class="op">&lt;-</span> <span class="va">MS_temperatures</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Data_source</span> <span class="op">==</span> <span class="st">"observed"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">stack_hourly_temps</span><span class="op">(</span>latitude <span class="op">=</span> <span class="fl">48.4</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">tempResponse</span><span class="op">(</span>Start_JDay <span class="op">=</span> <span class="fl">91</span>, End_JDay <span class="op">=</span> <span class="fl">120</span>, models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Frost <span class="op">=</span> <span class="va">freezing_hours</span>,</span>
<span>        Chill_portions <span class="op">=</span> <span class="va">Dynamic_Model</span>, GDH <span class="op">=</span> <span class="va">GDH</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">MS_apr_chill_simulated</span> <span class="op">&lt;-</span> <span class="va">MS_temperatures</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Data_source</span> <span class="op">==</span> <span class="st">"simulated"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">stack_hourly_temps</span><span class="op">(</span>latitude <span class="op">=</span> <span class="fl">48.4</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">tempResponse</span><span class="op">(</span>Start_JDay <span class="op">=</span> <span class="fl">91</span>, End_JDay <span class="op">=</span> <span class="fl">120</span>, models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Frost <span class="op">=</span> <span class="va">freezing_hours</span>,</span>
<span>        Chill_portions <span class="op">=</span> <span class="va">Dynamic_Model</span>, GDH <span class="op">=</span> <span class="va">GDH</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine observed and simulated in one data frame</span></span>
<span><span class="va">MS_apr_chill_comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">MS_apr_chill_observed</span>, Data_source <span class="op">=</span> <span class="st">"observed"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">MS_apr_chill_simulated</span>, Data_source <span class="op">=</span> <span class="st">"simulated"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Only include the columns with full data</span></span>
<span><span class="va">MS_apr_chill_comparison_full_seasons</span> <span class="op">&lt;-</span> <span class="va">MS_apr_chill_comparison</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Perc_complete</span> <span class="op">==</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">MS_apr_chill_comparison_full_seasons</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Frost</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Data_source</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Data source"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">xlab</span><span class="op">(</span><span class="st">"Frost incidence during April (hours)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Frequency"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/12.5.3b-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p><strong>Frost incidence in Mössingen as cumulative probability:</strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb226"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">MS_apr_chill_simulations</span> <span class="op">&lt;-</span> <span class="va">MS_apr_chill_comparison_full_seasons</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Data_source</span> <span class="op">==</span> <span class="st">"simulated"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">MS_apr_chill_simulations</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Frost</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">stat_ecdf</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"step"</span>, lwd <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Cumulative probability"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Frost incidence during April (hours)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/12.5.3c-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section></section><section id="chapter-13-saving-and-loading-data-and-hiding-this-in-markdown" class="level2"><h2 class="anchored" data-anchor-id="chapter-13-saving-and-loading-data-and-hiding-this-in-markdown">Chapter 13: Saving and loading data (and hiding this in markdown)</h2>
<section id="saving-and-loading-data" class="level3"><h3 class="anchored" data-anchor-id="saving-and-loading-data">
<span style="color:#71797E">13.1</span>&nbsp; Saving and loading data</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p><code>save</code> and <code>load</code> functions in <code>R</code>— may not allow to manually open the file for inspection outside <code>R</code>?</p></li>
<li><p>For simple <code>data.frames</code> saving can simply be done using the <code>write.csv</code> function.</p></li>
<li><p><code>chillR</code> function called <code>read_tab</code> is similar to <code>R</code>’s inbuilt <code>read.csv</code>, read the comma-separated values of the saved files, but the German computers separate values in csv file by semicolons— the <code>read_tab</code> function recognizes this and correctly reads files from different language regions.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb227"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Recall from last lesson (for knitting)</span></span>
<span><span class="va">Temp</span> <span class="op">&lt;-</span> <span class="va">KA_weather</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">temperature_generation</span><span class="op">(</span>years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1998</span>, <span class="fl">2005</span><span class="op">)</span>, sim_years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2001</span>, <span class="fl">2100</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">Temperatures</span> <span class="op">&lt;-</span> <span class="va">KA_weather</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fl">1998</span><span class="op">:</span><span class="fl">2005</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>Data_source <span class="op">=</span> <span class="st">"observed"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">Temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Year</span>, <span class="va">Month</span>, <span class="va">Day</span>, <span class="va">Tmin</span>, <span class="va">Tmax</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>Data_source <span class="op">=</span> <span class="st">"simulated"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>Date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2000</span>, <span class="va">Month</span>, <span class="va">Day</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display head data</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">Temperatures</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Data_source</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Date</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8.2</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: left;">observed</td>
<td style="text-align: left;">2000-01-01</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">9.1</td>
<td style="text-align: right;">5.0</td>
<td style="text-align: left;">observed</td>
<td style="text-align: left;">2000-01-02</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">10.4</td>
<td style="text-align: right;">3.3</td>
<td style="text-align: left;">observed</td>
<td style="text-align: left;">2000-01-03</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">8.4</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: left;">observed</td>
<td style="text-align: left;">2000-01-04</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: left;">observed</td>
<td style="text-align: left;">2000-01-05</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">8.1</td>
<td style="text-align: right;">4.4</td>
<td style="text-align: left;">observed</td>
<td style="text-align: left;">2000-01-06</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb228"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Save the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">Temperatures</span>, file <span class="op">=</span> <span class="st">"data/OT/Temperatures.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  <span class="co"># don't want rows to be numbered</span></span>
<span></span>
<span><span class="co"># Load the data again</span></span>
<span><span class="va">Temperatures</span> <span class="op">&lt;-</span> <span class="fu">read_tab</span><span class="op">(</span><span class="st">"data/OT/Temperatures.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">Temperatures</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Data_source</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Date</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8.2</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: left;">observed</td>
<td style="text-align: left;">2000-01-01</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">9.1</td>
<td style="text-align: right;">5.0</td>
<td style="text-align: left;">observed</td>
<td style="text-align: left;">2000-01-02</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">10.4</td>
<td style="text-align: right;">3.3</td>
<td style="text-align: left;">observed</td>
<td style="text-align: left;">2000-01-03</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">8.4</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: left;">observed</td>
<td style="text-align: left;">2000-01-04</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: left;">observed</td>
<td style="text-align: left;">2000-01-05</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">8.1</td>
<td style="text-align: right;">4.4</td>
<td style="text-align: left;">observed</td>
<td style="text-align: left;">2000-01-06</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<ul>
<li>To save objects that are more complex than simple <code>data.frames</code> (a list of multiple <code>data.frames</code>), <code>chillR</code> includes functions for writing and reading lists that consist of numbers, character strings and/or data.frames.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb229"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create test_list with three elements- double, character, list</span></span>
<span><span class="va">test_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Number <span class="op">=</span> <span class="fl">1</span>, String <span class="op">=</span> <span class="st">"Thanks for using chillR!"</span>, DataFrame <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,</span>
<span>    <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">4</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save the test_list in local file using `save_temperature_scenarios` function</span></span>
<span><span class="co"># It saves dataset as three separate csv files</span></span>
<span><span class="fu">save_temperature_scenarios</span><span class="op">(</span><span class="va">test_list</span>, path <span class="op">=</span> <span class="st">"data/OT"</span>, prefix <span class="op">=</span> <span class="st">"test_list"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Retreive information from three saved files using another chillR function</span></span>
<span><span class="va">test_list</span> <span class="op">&lt;-</span> <span class="fu">load_temperature_scenarios</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"data/OT"</span>, prefix <span class="op">=</span> <span class="st">"test_list"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section><section id="hiding-all-this-from-the-readers-of-our-markdown-file" class="level3"><h3 class="anchored" data-anchor-id="hiding-all-this-from-the-readers-of-our-markdown-file">
<span style="color:#71797E">13.2</span>&nbsp; Hiding all this from the readers of our markdown file</h3>
<div style="height: 18px;">

</div>
<ul>
<li>Normal code chunks start with “`{r}”. Options can be added after the r, separated by a comma.
<ul>
<li>option “echo=FALSE” means that the code block will be run but the code and output are not produced in the final document. We’ll still see ‘side effects’, such as figures that are produced.</li>
<li>option “eval=FALSE” means that the code will be shown in the final document, but it will not be run.</li>
<li>More options for code chunk are <a href="https://rmarkdown.rstudio.com/lesson-3.html">here.</a>
</li>
</ul>
</li>
</ul>
<p><br></p>
</section></section><section id="chapter-14-historic-temperature-scenarios" class="level2"><h2 class="anchored" data-anchor-id="chapter-14-historic-temperature-scenarios">Chapter 14: Historic temperature scenarios</h2>
<section id="climate-change-scenarios" class="level3"><h3 class="anchored" data-anchor-id="climate-change-scenarios">
<span style="color:#71797E">14.1</span>&nbsp; Climate change scenarios</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>We recently learned how to use a weather generator accessed by <code>chillR</code> to produce agroclimatic profiles for a given location. We calibrated the weather generator with historically observed temperature data, and the profile we produced was representative of climatic conditions during the period used for calibration.</p></li>
<li><p>The weather generator can also produce scenarios that represent different climatic conditions. Specifically, the <code>temperature_generation</code> function contains a parameter called <code>temperature_scenario</code>, which we can use to send the necessary instructions to the weather generator.</p></li>
<li><p>The temperature_scenario parameter requires a <code>data.frame</code> with columns <code>Tmin</code> and <code>Tmax</code>. Each of these columns should have 12 values that specify changes to the mean minimum and maximum temperatures, respectively, for each month of the year. If we don’t specify this parameter, the function uses the default object— a <code>data.frame</code> with zeros for all changes.</p></li>
<li><p>Our first climate change scenario will be simple. We’ll just add arbitrary numbers to all the monthly <em>T<sub>min</sub></em> and <em>T<sub>max</sub></em> values.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb230"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Here's the call from the earlier lesson. We don't have to run this again.</span></span>
<span><span class="va">Temp</span> <span class="op">&lt;-</span> <span class="fu">temperature_generation</span><span class="op">(</span><span class="va">KA_weather</span>,</span>
<span>                               years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1998</span>,<span class="fl">2005</span><span class="op">)</span>,</span>
<span>                               sim_years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2001</span>,<span class="fl">2100</span><span class="op">)</span><span class="op">)</span></span>
<span> </span>
<span><span class="co"># Now we make a temperature scenario that raises all temperatures by 2°C</span></span>
<span><span class="va">change_scenario</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Tmin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">12</span><span class="op">)</span>, <span class="co"># for 12 months</span></span>
<span>                              Tmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">change_scenario</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmax</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb231"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Input change_scenario to simulated temperature generations</span></span>
<span><span class="va">Temp_2</span> <span class="op">&lt;-</span> <span class="fu">temperature_generation</span><span class="op">(</span><span class="va">KA_weather</span>,</span>
<span>                                 years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1998</span>,<span class="fl">2005</span><span class="op">)</span>,</span>
<span>                                 sim_years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2001</span>,<span class="fl">2100</span><span class="op">)</span>,</span>
<span>                                 temperature_scenario <span class="op">=</span> <span class="va">change_scenario</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># As before, we'll make a data.frame that contains all</span></span>
<span><span class="co"># our data, so we can take a look at it.</span></span>
<span></span>
<span><span class="va">Temperature_scenarios</span> <span class="op">&lt;-</span> <span class="va">KA_weather</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fl">1998</span><span class="op">:</span><span class="fl">2005</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>Data_source <span class="op">=</span> <span class="st">"observed"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">Temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span> </span>
<span>          <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Year</span>, <span class="va">Month</span>, <span class="va">Day</span>, <span class="va">Tmin</span>, <span class="va">Tmax</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>Data_source <span class="op">=</span> <span class="st">"simulated"</span><span class="op">)</span></span>
<span>        <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">Temp_2</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>          <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Year</span>, <span class="va">Month</span>, <span class="va">Day</span>, <span class="va">Tmin</span>, <span class="va">Tmax</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>Data_source <span class="op">=</span> <span class="st">"Warming_2C"</span><span class="op">)</span></span>
<span>        <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>Date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2000</span>,</span>
<span>                                <span class="va">Month</span>,</span>
<span>                                <span class="va">Day</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
<ul>
<li>Plot for <code>Tmin</code> after applying <code>change_scenario</code> (increase temp by 2°C):</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb232"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Since the structure of this dataset is the same as we had in the earlier</span></span>
<span><span class="co"># lesson, we can use identical code to illustrate it - just have to replace the</span></span>
<span><span class="co"># data.frame name.</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">Temperature_scenarios</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">Date</span>, <span class="va">Tmin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_smooth</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">Data_source</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_x_date</span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%b"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/14.1b-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li>Plot for <code>Tmax</code> after applying <code>change_scenario</code> (increase temp by 2°C):</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb233"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">Temperature_scenarios</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">Date</span>, <span class="va">Tmax</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_smooth</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">Data_source</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_x_date</span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%b"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/14.1c-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li><p>This was an arbitrary climate scenario. Nobody expects future changes to be so uniformly distributed across all months, and this certainly hasn’t happened in the past.</p></li>
<li><p>This is, however, pretty similar to (<a href="https://link.springer.com/article/10.1007/s10584-009-9581-7">Luedeling et al., 2009b</a>)’s first attempt at climate change scenario modeling.</p></li>
<li><p>Let’s try to make scenarios that are a bit more realistic. For this, we start with scenarios that represent particular years from the historic record. As we discussed already, we could of course simply look at temperatures recorded during a particular year. We may, however, also be interested in what temperature conditions should have been considered normal at the time, rather than what actually happened.</p></li>
<li><p>Such a perspective can make it much easier to identify historic trends, because we can now try to evaluate the gradual shift in climate (the collection of plausible weather) rather than just looking at the random weathers we’ve been dealt in the past, where trends are often obscured by interannual variation and possibly by some freaky outliers that distort our trend analysis.</p></li>
</ul>
<p><br></p>
</section><section id="making-historic-temperature-scenarios" class="level3"><h3 class="anchored" data-anchor-id="making-historic-temperature-scenarios">
<span style="color:#71797E">14.2</span>&nbsp; Making historic temperature scenarios</h3>
<div style="height: 18px;">

</div>
<ul>
<li>To make this a meaningful exercise, we’ll need a long-term dataset.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb234"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Download and patch weather for Bonn</span></span>
<span></span>
<span><span class="co"># download weather station list for the vicinity of Bonn</span></span>
<span><span class="va">station_list</span> <span class="op">&lt;-</span> <span class="fu">handle_gsod</span><span class="op">(</span>action <span class="op">=</span> <span class="st">"list_stations"</span>,</span>
<span>                            location<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7.1</span>,<span class="fl">50.8</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># download weather data for Cologne/Bonn airport and convert it to chillR format</span></span>
<span><span class="va">Bonn_weather</span> <span class="op">&lt;-</span> <span class="fu">handle_gsod</span><span class="op">(</span>action <span class="op">=</span> <span class="st">"download_weather"</span>,</span>
<span>                            location <span class="op">=</span> <span class="va">station_list</span><span class="op">$</span><span class="va">chillR_code</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                            <span class="co"># more years than in previous exercies</span></span>
<span>                            time_interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1973</span>,<span class="fl">2019</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">handle_gsod</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Loading data for 47 years from station 'KOLN BONN'
================================================================================</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb236"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># check record for missing data</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu">fix_weather</span><span class="op">(</span><span class="va">Bonn_weather</span><span class="op">$</span><span class="va">`KOLN BONN`</span><span class="op">)</span><span class="op">$</span><span class="va">QC</span>,</span>
<span>      caption <span class="op">=</span> <span class="st">"Check for missing data"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Check for missing data</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Incomplete_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1972/1973</td>
<td style="text-align: right;">1973</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1973/1974</td>
<td style="text-align: right;">1974</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">99.7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1974/1975</td>
<td style="text-align: right;">1975</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">99.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">1975/1976</td>
<td style="text-align: right;">1976</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1976/1977</td>
<td style="text-align: right;">1977</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1977/1978</td>
<td style="text-align: right;">1978</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1978/1979</td>
<td style="text-align: right;">1979</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1979/1980</td>
<td style="text-align: right;">1980</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1980/1981</td>
<td style="text-align: right;">1981</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1981/1982</td>
<td style="text-align: right;">1982</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1982/1983</td>
<td style="text-align: right;">1983</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1983/1984</td>
<td style="text-align: right;">1984</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1984/1985</td>
<td style="text-align: right;">1985</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1985/1986</td>
<td style="text-align: right;">1986</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1986/1987</td>
<td style="text-align: right;">1987</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1987/1988</td>
<td style="text-align: right;">1988</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1988/1989</td>
<td style="text-align: right;">1989</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1989/1990</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990/1991</td>
<td style="text-align: right;">1991</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1991/1992</td>
<td style="text-align: right;">1992</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1992/1993</td>
<td style="text-align: right;">1993</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1993/1994</td>
<td style="text-align: right;">1994</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1994/1995</td>
<td style="text-align: right;">1995</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1995/1996</td>
<td style="text-align: right;">1996</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1996/1997</td>
<td style="text-align: right;">1997</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1997/1998</td>
<td style="text-align: right;">1998</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">98.9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1998/1999</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1999/2000</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2000/2001</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2001/2002</td>
<td style="text-align: right;">2002</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2002/2003</td>
<td style="text-align: right;">2003</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">316</td>
<td style="text-align: right;">316</td>
<td style="text-align: right;">316</td>
<td style="text-align: right;">13.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">2003/2004</td>
<td style="text-align: right;">2004</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2004/2005</td>
<td style="text-align: right;">2005</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2005/2006</td>
<td style="text-align: right;">2006</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2006/2007</td>
<td style="text-align: right;">2007</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2007/2008</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2008/2009</td>
<td style="text-align: right;">2009</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2009/2010</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2010/2011</td>
<td style="text-align: right;">2011</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2011/2012</td>
<td style="text-align: right;">2012</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2012/2013</td>
<td style="text-align: right;">2013</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2013/2014</td>
<td style="text-align: right;">2014</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2014/2015</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2015/2016</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2016/2017</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2017/2018</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2018/2019</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb237"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># (incidentally almost all gaps are for years covered by the KA_weather dataset)</span></span>
<span><span class="va">Bonn_patched</span> <span class="op">&lt;-</span> <span class="fu">patch_daily_temperatures</span><span class="op">(</span></span>
<span>  weather <span class="op">=</span> <span class="va">Bonn_weather</span><span class="op">$</span><span class="va">`KOLN BONN`</span>,</span>
<span>  patch_weather <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">KA_weather</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu">fix_weather</span><span class="op">(</span><span class="va">Bonn_patched</span><span class="op">)</span><span class="op">$</span><span class="va">QC</span>,</span>
<span>      caption <span class="op">=</span> <span class="st">"Check for missing data after patching"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Check for missing data after patching</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Incomplete_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1972/1973</td>
<td style="text-align: right;">1973</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1973/1974</td>
<td style="text-align: right;">1974</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">99.7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1974/1975</td>
<td style="text-align: right;">1975</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">99.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">1975/1976</td>
<td style="text-align: right;">1976</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1976/1977</td>
<td style="text-align: right;">1977</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1977/1978</td>
<td style="text-align: right;">1978</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1978/1979</td>
<td style="text-align: right;">1979</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1979/1980</td>
<td style="text-align: right;">1980</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1980/1981</td>
<td style="text-align: right;">1981</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1981/1982</td>
<td style="text-align: right;">1982</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1982/1983</td>
<td style="text-align: right;">1983</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1983/1984</td>
<td style="text-align: right;">1984</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1984/1985</td>
<td style="text-align: right;">1985</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1985/1986</td>
<td style="text-align: right;">1986</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1986/1987</td>
<td style="text-align: right;">1987</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1987/1988</td>
<td style="text-align: right;">1988</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1988/1989</td>
<td style="text-align: right;">1989</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1989/1990</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990/1991</td>
<td style="text-align: right;">1991</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1991/1992</td>
<td style="text-align: right;">1992</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1992/1993</td>
<td style="text-align: right;">1993</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1993/1994</td>
<td style="text-align: right;">1994</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1994/1995</td>
<td style="text-align: right;">1995</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1995/1996</td>
<td style="text-align: right;">1996</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1996/1997</td>
<td style="text-align: right;">1997</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1997/1998</td>
<td style="text-align: right;">1998</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1998/1999</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1999/2000</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2000/2001</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2001/2002</td>
<td style="text-align: right;">2002</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2002/2003</td>
<td style="text-align: right;">2003</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2003/2004</td>
<td style="text-align: right;">2004</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2004/2005</td>
<td style="text-align: right;">2005</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2005/2006</td>
<td style="text-align: right;">2006</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2006/2007</td>
<td style="text-align: right;">2007</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2007/2008</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2008/2009</td>
<td style="text-align: right;">2009</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2009/2010</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2010/2011</td>
<td style="text-align: right;">2011</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2011/2012</td>
<td style="text-align: right;">2012</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2012/2013</td>
<td style="text-align: right;">2013</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2013/2014</td>
<td style="text-align: right;">2014</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2014/2015</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2015/2016</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2016/2017</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2017/2018</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2018/2019</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb238"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># There are still 4 days missing here, out of 47 years -</span></span>
<span><span class="co"># let's simply interpolate these gaps now</span></span>
<span></span>
<span><span class="va">Bonn</span><span class="op">&lt;-</span><span class="fu">fix_weather</span><span class="op">(</span><span class="va">Bonn_patched</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Bonn_temps</span><span class="op">&lt;-</span><span class="va">Bonn</span><span class="op">$</span><span class="va">weather</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
<ul>
<li><p>We could now easily run the weather generator to produce weather scenarios that correspond to the normal climate between 1973 and 2019.</p></li>
<li><p>Since temperatures have been gradually rising over this period, the best guess for the year that would best represent this scenario would be the median of the time period, which is 1996.</p></li>
<li><p>But let’s say we’re not interested in 1996, but in scenarios representing 1980, 1990, 2000 and 2010. How can we make such scenarios?</p></li>
<li><p>The way to address this challenge is to examine the historic temperature record to determine the changes that happened between the year we’re interested in and the year our temperature data represent.</p></li>
<li><p>Let’s call this representative year the <strong>baseline</strong> of our observed temperature data, and the years we want to make simulations for the <strong>simulation</strong> years.</p></li>
<li><p><code>chillR</code> has a function that helps us make temperature scenarios from temperature records, which is called <code>temperature_scenario_from_records</code>.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb239"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">scenario_1980</span> <span class="op">&lt;-</span> <span class="fu">temperature_scenario_from_records</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">Bonn_temps</span>, year <span class="op">=</span> <span class="fl">1980</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">scenario_1980</span><span class="op">$</span><span class="va">`1980`</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Tmax</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">data.1</td>
<td style="text-align: left;">-1.67920860215054</td>
<td style="text-align: left;">4.37407741935484</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.2</td>
<td style="text-align: left;">-2.31679359605911</td>
<td style="text-align: left;">5.58055410509031</td>
</tr>
<tr class="odd">
<td style="text-align: left;">data.3</td>
<td style="text-align: left;">0.85376559139785</td>
<td style="text-align: left;">9.76355698924731</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.4</td>
<td style="text-align: left;">2.80432888888889</td>
<td style="text-align: left;">13.4744377777778</td>
</tr>
<tr class="odd">
<td style="text-align: left;">data.5</td>
<td style="text-align: left;">6.89809247311828</td>
<td style="text-align: left;">18.0162430107527</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.6</td>
<td style="text-align: left;">10.4950644444444</td>
<td style="text-align: left;">21.3704888888889</td>
</tr>
<tr class="odd">
<td style="text-align: left;">data.7</td>
<td style="text-align: left;">12.3964193548387</td>
<td style="text-align: left;">23.1756258064516</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.8</td>
<td style="text-align: left;">11.8548365591398</td>
<td style="text-align: left;">23.186135483871</td>
</tr>
<tr class="odd">
<td style="text-align: left;">data.9</td>
<td style="text-align: left;">9.26938666666667</td>
<td style="text-align: left;">19.8275266666667</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.10</td>
<td style="text-align: left;">5.84874838709677</td>
<td style="text-align: left;">14.4436172043011</td>
</tr>
<tr class="odd">
<td style="text-align: left;">data.11</td>
<td style="text-align: left;">2.23753111111111</td>
<td style="text-align: left;">9.07679555555556</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.12</td>
<td style="text-align: left;">0.112670967741936</td>
<td style="text-align: left;">6.02412903225806</td>
</tr>
<tr class="odd">
<td style="text-align: left;">scenario_year</td>
<td style="text-align: left;">1980</td>
<td style="text-align: left;">1980</td>
</tr>
<tr class="even">
<td style="text-align: left;">reference_year</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">scenario_type</td>
<td style="text-align: left;">absolute</td>
<td style="text-align: left;">absolute</td>
</tr>
<tr class="even">
<td style="text-align: left;">labels</td>
<td style="text-align: left;">running mean scenario</td>
<td style="text-align: left;">running mean scenario</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb240"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># data: a data.frame specifying Tmin and Tmax values that are representative of</span></span>
<span><span class="co"># the year of interest</span></span>
<span></span>
<span><span class="co"># scenario_year: the year we’re interested in</span></span>
<span></span>
<span><span class="co"># reference_year: for scenarios that describe temperature changes (which is not</span></span>
<span><span class="co"># the case here), this would specify relative to what year these changes are</span></span>
<span><span class="co"># expressed (NA in this case)</span></span>
<span></span>
<span><span class="co"># scenario_type: specifies whether this scenario contains absolute temperatures</span></span>
<span><span class="co"># for the year of interest (true in this case), or whether it expressed changes</span></span>
<span><span class="co"># relative to another year</span></span>
<span></span>
<span><span class="co"># labels: contains additional information we can attach to scenarios.  In this</span></span>
<span><span class="co"># case, this says “running mean scenario”.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
<ul>
<li>This explains the warning messages we previously received when we first started running our weather generator:
<ul>
<li><em>scenario doesn’t contain named elements— consider using the following element names: ‘data’, ‘reference_year’,‘scenario_type’,‘labels’</em></li>
<li><em>setting <code>scenario_type</code> to ‘relative’</em></li>
<li><em>Reference year missing— can’t check if relative temperature scenario is valid</em></li>
</ul>
</li>
</ul>
<ul>
<li><p>Our input for the scenario at that time was simply a <code>data.frame</code>, but we’ve just seen that scenarios can contain more information.The <code>temperature_generation</code> recognized this and decided to warn us. This is because all this information has a purpose, and if it’s not provided, <code>temperature_generation</code> has to make some assumptions on what it’s supposed to do with the information.</p></li>
<li><p>The second element of the warning indicates that the <code>scenario_type</code> was automatically set to ‘relative’. The function contains some decision rules for deciding whether a temperature scenario specifies absolute or relative temperatures, and here we are informed about what the outcome of that decision was.</p></li>
<li><p>Finally, we are informed that the reference year is missing. This means that we’ve specified a relative temperature scenario, but we didn’t specify relative to what. In our case, this was simply the year that the historic record represented (e.g.&nbsp;the median year of the observed record), but this isn’t always clear, as we’ll see when we start talking about future projections.</p></li>
<li><p>Well, in the scenario we just built here, we shouldn’t get such warning messages, because now we have a comprehensive list that contains all the information the <code>temperature_generation</code> function needs.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb241"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">temps_1980</span> <span class="op">&lt;-</span> <span class="fu">temperature_generation</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">Bonn_temps</span>, years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1973</span>, <span class="fl">2019</span><span class="op">)</span>,</span>
<span>    sim_years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2001</span>, <span class="fl">2100</span><span class="op">)</span>, temperature_scenario <span class="op">=</span> <span class="va">scenario_1980</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Warning: Absolute temperature scenario specified - calibration weather record
only used for simulating temperature variation, but not for the means</code></pre>
</div>
</div>
<ul>
<li><p>We still got a warning message, which means that the weather generator evaluated the calibration dataset with respect to variation of temperatures around the mean temperatures. It then generated a dataset with means (for <em>T<sub>min</sub></em> and <em>T<sub>max</sub></em> of each month) that correspond to the (absolute) temperature scenario we provided, and variation similar to that in the observed record. This is what we wanted, so we’re good.</p></li>
<li><p>If we want to convert this absolute temperature scenario into a relative scenario, we have to specify a baseline scenario to compare it with. In our case, 1996 is a good choice, because that is the median year of our observed record. So let’s make a scenario for that year:</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb243"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Absolute temperature scenario, where the baseline (reference_year) is NA</span></span>
<span><span class="va">scenario_1996</span> <span class="op">&lt;-</span> <span class="fu">temperature_scenario_from_records</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">Bonn_temps</span>, year <span class="op">=</span> <span class="fl">1996</span><span class="op">)</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">scenario_1996</span><span class="op">$</span><span class="va">`1996`</span><span class="op">)</span>, caption <span class="op">=</span> <span class="st">"Absolute temperature scenario"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Absolute temperature scenario</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Tmax</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">data.1</td>
<td style="text-align: left;">0.0509680770842057</td>
<td style="text-align: left;">5.99751358748778</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.2</td>
<td style="text-align: left;">0.301776440874661</td>
<td style="text-align: left;">7.78986289094665</td>
</tr>
<tr class="odd">
<td style="text-align: left;">data.3</td>
<td style="text-align: left;">2.64832506633152</td>
<td style="text-align: left;">11.855124340176</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.4</td>
<td style="text-align: left;">4.11737331005912</td>
<td style="text-align: left;">14.8843859889215</td>
</tr>
<tr class="odd">
<td style="text-align: left;">data.5</td>
<td style="text-align: left;">7.96058169925808</td>
<td style="text-align: left;">20.2804453189544</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.6</td>
<td style="text-align: left;">10.7094570181073</td>
<td style="text-align: left;">22.3252160117302</td>
</tr>
<tr class="odd">
<td style="text-align: left;">data.7</td>
<td style="text-align: left;">12.6913895824606</td>
<td style="text-align: left;">24.9266189638319</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.8</td>
<td style="text-align: left;">12.5913727376335</td>
<td style="text-align: left;">25.0791708510705</td>
</tr>
<tr class="odd">
<td style="text-align: left;">data.9</td>
<td style="text-align: left;">9.55441331005912</td>
<td style="text-align: left;">19.960841544477</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.10</td>
<td style="text-align: left;">6.40661968998743</td>
<td style="text-align: left;">14.768212512219</td>
</tr>
<tr class="odd">
<td style="text-align: left;">data.11</td>
<td style="text-align: left;">2.82059108783689</td>
<td style="text-align: left;">9.30895932225481</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.12</td>
<td style="text-align: left;">0.591336535264942</td>
<td style="text-align: left;">6.10391896067859</td>
</tr>
<tr class="odd">
<td style="text-align: left;">scenario_year</td>
<td style="text-align: left;">1996</td>
<td style="text-align: left;">1996</td>
</tr>
<tr class="even">
<td style="text-align: left;">reference_year</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">scenario_type</td>
<td style="text-align: left;">absolute</td>
<td style="text-align: left;">absolute</td>
</tr>
<tr class="even">
<td style="text-align: left;">labels</td>
<td style="text-align: left;">running mean scenario</td>
<td style="text-align: left;">running mean scenario</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<ul>
<li>We can produce a relative change scenario by applying the <code>temperature_scenario_baseline_adjustment</code> function:</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb244"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">relative_scenario</span> <span class="op">&lt;-</span> <span class="fu">temperature_scenario_baseline_adjustment</span><span class="op">(</span>baseline <span class="op">=</span> <span class="va">scenario_1996</span>,</span>
<span>    temperature_scenario <span class="op">=</span> <span class="va">scenario_1980</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">relative_scenario</span><span class="op">$</span><span class="va">`1980`</span><span class="op">)</span>, caption <span class="op">=</span> <span class="st">"Relative change scenario"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Relative change scenario</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Tmax</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">data.1</td>
<td style="text-align: left;">-1.73017667923474</td>
<td style="text-align: left;">-1.62343616813294</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.2</td>
<td style="text-align: left;">-2.61857003693377</td>
<td style="text-align: left;">-2.20930878585634</td>
</tr>
<tr class="odd">
<td style="text-align: left;">data.3</td>
<td style="text-align: left;">-1.79455947493367</td>
<td style="text-align: left;">-2.09156735092865</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.4</td>
<td style="text-align: left;">-1.31304442117023</td>
<td style="text-align: left;">-1.4099482111437</td>
</tr>
<tr class="odd">
<td style="text-align: left;">data.5</td>
<td style="text-align: left;">-1.0624892261398</td>
<td style="text-align: left;">-2.26420230820169</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.6</td>
<td style="text-align: left;">-0.214392573662899</td>
<td style="text-align: left;">-0.95472712284132</td>
</tr>
<tr class="odd">
<td style="text-align: left;">data.7</td>
<td style="text-align: left;">-0.294970227621846</td>
<td style="text-align: left;">-1.75099315738026</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.8</td>
<td style="text-align: left;">-0.736536178493726</td>
<td style="text-align: left;">-1.89303536719958</td>
</tr>
<tr class="odd">
<td style="text-align: left;">data.9</td>
<td style="text-align: left;">-0.285026643392454</td>
<td style="text-align: left;">-0.133314877810367</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.10</td>
<td style="text-align: left;">-0.557871302890659</td>
<td style="text-align: left;">-0.324595307917892</td>
</tr>
<tr class="odd">
<td style="text-align: left;">data.11</td>
<td style="text-align: left;">-0.583059976725782</td>
<td style="text-align: left;">-0.232163766699253</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.12</td>
<td style="text-align: left;">-0.478665567523007</td>
<td style="text-align: left;">-0.0797899284205235</td>
</tr>
<tr class="odd">
<td style="text-align: left;">scenario_year</td>
<td style="text-align: left;">1980</td>
<td style="text-align: left;">1980</td>
</tr>
<tr class="even">
<td style="text-align: left;">reference_year</td>
<td style="text-align: left;">1996</td>
<td style="text-align: left;">1996</td>
</tr>
<tr class="odd">
<td style="text-align: left;">scenario_type</td>
<td style="text-align: left;">relative</td>
<td style="text-align: left;">relative</td>
</tr>
<tr class="even">
<td style="text-align: left;">labels</td>
<td style="text-align: left;">running mean scenario</td>
<td style="text-align: left;">running mean scenario</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb245"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Now we have a relative change scenario - a list with the following elements:</span></span>
<span></span>
<span><span class="co"># data: a data.frame with Tmin and Tmax columns, but now containing relative</span></span>
<span><span class="co"># changes between 1996 and 1980 (all negative values, because 1980 was cooler</span></span>
<span><span class="co"># than 1996)</span></span>
<span></span>
<span><span class="co"># scenario_year: still 1980</span></span>
<span></span>
<span><span class="co"># reference_year: now 1996</span></span>
<span></span>
<span><span class="co"># scenario_type: now ‘relative’</span></span>
<span></span>
<span><span class="co"># labels: still ‘running mean scenario’</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>We can now try to apply this scenario in a similar way to what we did earlier, without generating error message because we provided the <code>temperature_generation</code> function with everything it needed to know:</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb246"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">temps_1980</span> <span class="op">&lt;-</span> <span class="fu">temperature_generation</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">Bonn_temps</span>, years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1973</span>, <span class="fl">2019</span><span class="op">)</span>,</span>
<span>    sim_years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2001</span>, <span class="fl">2100</span><span class="op">)</span>, temperature_scenario <span class="op">=</span> <span class="va">relative_scenario</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
<ul>
<li>So let’s now make all the scenarios we had in mind. This is facilitated by most of the functions also accepting vectors and lists, rather than just single numbers and <code>data.frames</code>.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb247"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create scenarios from records of interested years</span></span>
<span><span class="va">all_past_scenarios</span> <span class="op">&lt;-</span> <span class="fu">temperature_scenario_from_records</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">Bonn_temps</span>, year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1980</span>,</span>
<span>    <span class="fl">1990</span>, <span class="fl">2000</span>, <span class="fl">2010</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make temperature scenario relative to a particular baseline</span></span>
<span><span class="va">adjusted_scenarios</span> <span class="op">&lt;-</span> <span class="fu">temperature_scenario_baseline_adjustment</span><span class="op">(</span>baseline <span class="op">=</span> <span class="va">scenario_1996</span>,</span>
<span>    temperature_scenario <span class="op">=</span> <span class="va">all_past_scenarios</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate temperatures for simulation years, relative to adjusted_scenarios</span></span>
<span><span class="va">all_past_scenario_temps</span> <span class="op">&lt;-</span> <span class="fu">temperature_generation</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">Bonn_temps</span>, years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1973</span>,</span>
<span>    <span class="fl">2019</span><span class="op">)</span>, sim_years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2001</span>, <span class="fl">2100</span><span class="op">)</span>, temperature_scenario <span class="op">=</span> <span class="va">adjusted_scenarios</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save as four different files of 100 year simulations</span></span>
<span><span class="fu">save_temperature_scenarios</span><span class="op">(</span><span class="va">all_past_scenario_temps</span>, <span class="st">"data/bonn"</span>, <span class="st">"Bonn_hist_scenarios"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li><p>The <code>all_past_scenario_temps object</code> is a list that now contains 100 years of synthetic weather for all the past scenarios we had in mind.</p></li>
<li><p>Now, to calculate chill accumulation again, we could go back and find all the functions we used before and apply them to each of the four temperature scenarios we just generated, OR use a <code>chillR</code> function, <code>tempResponse_daily_list</code> that has already automated all this.</p></li>
<li><p>To demonstrate, make a simple frost model and select only the Dynamic Model and GDH Model for the evaluation:</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb248"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calculate heat for temperate trees according to a stepwise model provided</span></span>
<span><span class="va">frost_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">step_model</span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1000</span>, <span class="fl">0</span><span class="op">)</span>, upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,</span>
<span>    <span class="fl">1000</span><span class="op">)</span>, weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="co"># user-defined stepwise weight function </span></span>
<span></span>
<span><span class="co"># Call the functions for each model for chill, heat and frost accumulations</span></span>
<span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Chill_Portions <span class="op">=</span> <span class="va">Dynamic_Model</span>, GDH <span class="op">=</span> <span class="va">GDH</span>, Frost_H <span class="op">=</span> <span class="va">frost_model</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate chill accumulation for the four temperature scenarios generated</span></span>
<span><span class="va">chill_hist_scenario_list</span> <span class="op">&lt;-</span> <span class="fu">tempResponse_daily_list</span><span class="op">(</span><span class="va">all_past_scenario_temps</span>, latitude <span class="op">=</span> <span class="fl">50.9</span>,</span>
<span>    Start_JDay <span class="op">=</span> <span class="fl">305</span>, End_JDay <span class="op">=</span> <span class="fl">59</span>, models <span class="op">=</span> <span class="va">models</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove all the incomplete winters from the record, before saving</span></span>
<span><span class="va">chill_hist_scenario_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">chill_hist_scenario_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Perc_complete</span> <span class="op">==</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Include the place name and the start and end dates of the considered period</span></span>
<span><span class="co"># in the saved file name</span></span>
<span><span class="fu">save_temperature_scenarios</span><span class="op">(</span><span class="va">chill_hist_scenario_list</span>, <span class="st">"data/Bonn"</span>, <span class="st">"Bonn_hist_chill_305_59"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Store the years (1980, 1990, 2000, 2010) in a character vector</span></span>
<span><span class="va">scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chill_hist_scenario_list</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Combine all scenarios into one dataset, with a new column scenario for year</span></span>
<span><span class="va">all_scenarios</span> <span class="op">&lt;-</span> <span class="va">chill_hist_scenario_list</span><span class="op">[[</span><span class="va">scenarios</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>scenario <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">scenarios</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Repeat with loop for the remaining scenarios and bind to all_scenarios</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">sc</span> <span class="kw">in</span> <span class="va">scenarios</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="va">all_scenarios</span> <span class="op">&lt;-</span> <span class="va">all_scenarios</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">chill_hist_scenario_list</span><span class="op">[[</span><span class="va">sc</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>scenario <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">sc</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Perc_complete</span> <span class="op">==</span> <span class="fl">100</span><span class="op">)</span>  <span class="co"># result is chillR data.frame</span></span>
<span></span>
<span><span class="co"># Let's compute the actual 'observed' chill for comparison</span></span>
<span><span class="va">actual_chill</span> <span class="op">&lt;-</span> <span class="fu">tempResponse_daily_list</span><span class="op">(</span><span class="va">Bonn_temps</span>, latitude <span class="op">=</span> <span class="fl">50.9</span>, Start_JDay <span class="op">=</span> <span class="fl">305</span>,</span>
<span>    End_JDay <span class="op">=</span> <span class="fl">59</span>, <span class="va">models</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Perc_complete</span> <span class="op">==</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">all_scenarios</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">scenario</span>, <span class="va">Chill_Portions</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">scenario</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_violin</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Chill accumulation (Chill Portions)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Scenario year"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">90</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">actual_chill</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">End_year</span>,</span>
<span>    <span class="va">Chill_Portions</span>, fill <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_fill_discrete</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Scenario"</span>,</span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">all_scenarios</span><span class="op">$</span><span class="va">scenario</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/14.2h-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li><p>Now we have chill distribution scenarios representing the years 1980, 1990, 2000 and 2010— not much change here, which means we probably won’t have to worry about chill deficiencies in Bonn any time soon.</p></li>
<li><p>Note that all the annual scenarios so far were based on running means of <em>T<sub>min</sub></em> and <em>T<sub>max</sub></em>. This seems appropriate because in times of accelerating climate change, estimating temperatures at any given time via clean mathematical equations seems rather challenging.</p></li>
<li><p>However, <code>chillR</code> also contains the option of using linear regression to determine these representative temperatures for a particular historic scenario. Let’s quickly look at what kind of difference this makes in this case:</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb249"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Save the observed chill data to use in making the CMPI6 scenarios in later ch</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">actual_chill</span>,<span class="st">"data/Bonn/Bonn_observed_chill_305_59.csv"</span>, </span>
<span>          row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># </span></span>
<span><span class="co"># aggregate: Splits the data into subsets, computes summary statistics for each, </span></span>
<span><span class="co"># and returns the result in a convenient form.</span></span>
<span><span class="va">temperature_means</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">Bonn_temps</span><span class="op">$</span><span class="va">Year</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">Bonn_temps</span><span class="op">$</span><span class="va">Year</span><span class="op">)</span>,</span>
<span>             Tmin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">Bonn_temps</span><span class="op">$</span><span class="va">Tmin</span>,</span>
<span>                              FUN <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>                              by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">Bonn_temps</span><span class="op">$</span><span class="va">Year</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,  </span>
<span>             Tmax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">Bonn_temps</span><span class="op">$</span><span class="va">Tmax</span>,</span>
<span>                            FUN <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>                            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">Bonn_temps</span><span class="op">$</span><span class="va">Year</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># only mean column</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>runn_mean_Tmin <span class="op">=</span> <span class="fu">runn_mean</span><span class="op">(</span><span class="va">Tmin</span>,<span class="fl">15</span><span class="op">)</span>,</span>
<span>         runn_mean_Tmax <span class="op">=</span> <span class="fu">runn_mean</span><span class="op">(</span><span class="va">Tmax</span>,<span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="co"># moving average </span></span>
<span></span>
<span></span>
<span><span class="va">Tmin_regression</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Tmin</span><span class="op">~</span><span class="va">Year</span>,</span>
<span>                      <span class="va">temperature_means</span><span class="op">)</span> <span class="co"># data.frame for lm</span></span>
<span></span>
<span><span class="va">Tmax_regression</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Tmax</span><span class="op">~</span><span class="va">Year</span>,</span>
<span>                      <span class="va">temperature_means</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use regression model (y = a + bx) to predict Tmin and Tmax values for </span></span>
<span><span class="co"># each yeaer and bind them to temperature_means dataset</span></span>
<span><span class="va">temperature_means</span> <span class="op">&lt;-</span> <span class="va">temperature_means</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>regression_Tmin <span class="op">=</span> <span class="va">Tmin_regression</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span></span>
<span>           <span class="va">Tmin_regression</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="va">temperature_means</span><span class="op">$</span><span class="va">Year</span>,</span>
<span>           regression_Tmax <span class="op">=</span> <span class="va">Tmax_regression</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span></span>
<span>           <span class="va">Tmax_regression</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="va">temperature_means</span><span class="op">$</span><span class="va">Year</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot for Tmin</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">temperature_means</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span><span class="va">Year</span>,</span>
<span>           <span class="va">Tmin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>data <span class="op">=</span> <span class="va">temperature_means</span>,</span>
<span>            <span class="fu">aes</span><span class="op">(</span><span class="va">Year</span>,</span>
<span>                <span class="va">runn_mean_Tmin</span><span class="op">)</span>,</span>
<span>            lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>            col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>data <span class="op">=</span> <span class="va">temperature_means</span>,</span>
<span>            <span class="fu">aes</span><span class="op">(</span><span class="va">Year</span>,</span>
<span>                <span class="va">regression_Tmin</span><span class="op">)</span>,</span>
<span>            lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>            col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Mean monthly minimum temperature (°C)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/14.2i-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb250"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Plot for Tmax</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">temperature_means</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span><span class="va">Year</span>,</span>
<span>           <span class="va">Tmax</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>data <span class="op">=</span> <span class="va">temperature_means</span>,</span>
<span>            <span class="fu">aes</span><span class="op">(</span><span class="va">Year</span>,</span>
<span>                <span class="va">runn_mean_Tmax</span><span class="op">)</span>,</span>
<span>            lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>            col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>data <span class="op">=</span> <span class="va">temperature_means</span>,</span>
<span>            <span class="fu">aes</span><span class="op">(</span><span class="va">Year</span>, </span>
<span>                <span class="va">regression_Tmax</span><span class="op">)</span>,</span>
<span>            lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>            col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Mean monthly maximum temperature (°C)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/14.2i-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li>There’s a bit of a difference between the running mean function (blue) and the linear regression line (red). Sometimes this can be important, and we should expect the difference to become more pronounced as climate change progresses.</li>
</ul>
<p><br></p>
</section><section id="exercises-on-generating-historic-temperature-scenarios" class="level3"><h3 class="anchored" data-anchor-id="exercises-on-generating-historic-temperature-scenarios">
<span style="color:#71797E">14.3</span>&nbsp; Exercises on generating historic temperature scenarios</h3>
<div style="height: 18px;">

</div>
<p><strong><em>1. For the location you chose for previous exercises, produce historic temperature scenarios representing several years of the historic record (your choice).</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb251"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Call the patched weather dataset for Mössingen again</span></span>
<span><span class="va">MS_patched_weather</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/MS/MS_patched_weather.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># I chose years between 1990 and 2020; so set 2005 as baseline year (median)</span></span>
<span><span class="co"># and the start year of dataset 1990 scenarios for comparison</span></span>
<span><span class="va">MS_scenario_1990</span> <span class="op">&lt;-</span> <span class="fu">temperature_scenario_from_records</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">MS_patched_weather</span>,</span>
<span>    year <span class="op">=</span> <span class="fl">1990</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Absolute temperature scenario, where the baseline (reference_year) is NA</span></span>
<span><span class="va">MS_scenario_2005</span> <span class="op">&lt;-</span> <span class="fu">temperature_scenario_from_records</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">MS_patched_weather</span>,</span>
<span>    year <span class="op">=</span> <span class="fl">2005</span><span class="op">)</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">MS_scenario_2005</span><span class="op">$</span><span class="va">`2005`</span><span class="op">)</span>, caption <span class="op">=</span> <span class="st">"Absolute temperature scenario"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Absolute temperature scenario</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Tmax</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">data.1</td>
<td style="text-align: left;">-2.3290911271762</td>
<td style="text-align: left;">4.28315719415581</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.2</td>
<td style="text-align: left;">-1.94180445945015</td>
<td style="text-align: left;">5.92069996654841</td>
</tr>
<tr class="odd">
<td style="text-align: left;">data.3</td>
<td style="text-align: left;">1.06467231368402</td>
<td style="text-align: left;">10.4225120328655</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.4</td>
<td style="text-align: left;">4.32392679397076</td>
<td style="text-align: left;">15.3232790579551</td>
</tr>
<tr class="odd">
<td style="text-align: left;">data.5</td>
<td style="text-align: left;">8.69745776593105</td>
<td style="text-align: left;">19.8572399539023</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.6</td>
<td style="text-align: left;">11.973110061948</td>
<td style="text-align: left;">23.1595678725423</td>
</tr>
<tr class="odd">
<td style="text-align: left;">data.7</td>
<td style="text-align: left;">13.339295969598</td>
<td style="text-align: left;">24.2506840758762</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.8</td>
<td style="text-align: left;">13.104168265614</td>
<td style="text-align: left;">24.3649426600506</td>
</tr>
<tr class="odd">
<td style="text-align: left;">data.9</td>
<td style="text-align: left;">9.36948234952631</td>
<td style="text-align: left;">19.984167946844</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.10</td>
<td style="text-align: left;">5.55942277108909</td>
<td style="text-align: left;">14.828342259758</td>
</tr>
<tr class="odd">
<td style="text-align: left;">data.11</td>
<td style="text-align: left;">1.60339985028458</td>
<td style="text-align: left;">8.52848581156949</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.12</td>
<td style="text-align: left;">-1.42666955978417</td>
<td style="text-align: left;">4.50765755649637</td>
</tr>
<tr class="odd">
<td style="text-align: left;">scenario_year</td>
<td style="text-align: left;">2005</td>
<td style="text-align: left;">2005</td>
</tr>
<tr class="even">
<td style="text-align: left;">reference_year</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">scenario_type</td>
<td style="text-align: left;">absolute</td>
<td style="text-align: left;">absolute</td>
</tr>
<tr class="even">
<td style="text-align: left;">labels</td>
<td style="text-align: left;">running mean scenario</td>
<td style="text-align: left;">running mean scenario</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb252"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Relative change scenarios (2005 vs. 1990)</span></span>
<span><span class="va">MS_relative_scenario</span> <span class="op">&lt;-</span> <span class="fu">temperature_scenario_baseline_adjustment</span><span class="op">(</span>baseline <span class="op">=</span> <span class="va">MS_scenario_2005</span>,</span>
<span>    temperature_scenario <span class="op">=</span> <span class="va">MS_scenario_1990</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">MS_relative_scenario</span><span class="op">$</span><span class="va">`1990`</span><span class="op">)</span>, caption <span class="op">=</span> <span class="st">"Relative change scenario"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Relative change scenario</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Tmax</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">data.1</td>
<td style="text-align: left;">-0.319960059372978</td>
<td style="text-align: left;">-0.224287206595806</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.2</td>
<td style="text-align: left;">-0.316153185664095</td>
<td style="text-align: left;">0.732921684566331</td>
</tr>
<tr class="odd">
<td style="text-align: left;">data.3</td>
<td style="text-align: left;">-0.127255758297709</td>
<td style="text-align: left;">0.526547470823552</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.4</td>
<td style="text-align: left;">-1.41741402024813</td>
<td style="text-align: left;">-1.55592159901348</td>
</tr>
<tr class="odd">
<td style="text-align: left;">data.5</td>
<td style="text-align: left;">-1.59620910511165</td>
<td style="text-align: left;">-1.38615547883164</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.6</td>
<td style="text-align: left;">-1.24775978822533</td>
<td style="text-align: left;">-2.10902291360064</td>
</tr>
<tr class="odd">
<td style="text-align: left;">data.7</td>
<td style="text-align: left;">-0.399903607760073</td>
<td style="text-align: left;">0.31664962136119</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.8</td>
<td style="text-align: left;">-0.299590419905094</td>
<td style="text-align: left;">0.711810392025583</td>
</tr>
<tr class="odd">
<td style="text-align: left;">data.9</td>
<td style="text-align: left;">-1.01498676188194</td>
<td style="text-align: left;">-0.889872824875368</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.10</td>
<td style="text-align: left;">-0.734469925380198</td>
<td style="text-align: left;">-0.760383562520543</td>
</tr>
<tr class="odd">
<td style="text-align: left;">data.11</td>
<td style="text-align: left;">-0.450054262640204</td>
<td style="text-align: left;">-0.606090689600881</td>
</tr>
<tr class="even">
<td style="text-align: left;">data.12</td>
<td style="text-align: left;">0.00525547000918758</td>
<td style="text-align: left;">-0.348928697968623</td>
</tr>
<tr class="odd">
<td style="text-align: left;">scenario_year</td>
<td style="text-align: left;">1990</td>
<td style="text-align: left;">1990</td>
</tr>
<tr class="even">
<td style="text-align: left;">reference_year</td>
<td style="text-align: left;">2005</td>
<td style="text-align: left;">2005</td>
</tr>
<tr class="odd">
<td style="text-align: left;">scenario_type</td>
<td style="text-align: left;">relative</td>
<td style="text-align: left;">relative</td>
</tr>
<tr class="even">
<td style="text-align: left;">labels</td>
<td style="text-align: left;">running mean scenario</td>
<td style="text-align: left;">running mean scenario</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb253"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create scenarios from records of interested years</span></span>
<span><span class="va">MS_all_past_scenarios</span> <span class="op">&lt;-</span> <span class="fu">temperature_scenario_from_records</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">MS_patched_weather</span>,</span>
<span>    year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1990</span>, <span class="fl">2000</span>, <span class="fl">2010</span>, <span class="fl">2020</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make temperature scenario relative to a particular baseline</span></span>
<span><span class="va">MS_adjusted_scenarios</span> <span class="op">&lt;-</span> <span class="fu">temperature_scenario_baseline_adjustment</span><span class="op">(</span>baseline <span class="op">=</span> <span class="va">MS_scenario_2005</span>,</span>
<span>    temperature_scenario <span class="op">=</span> <span class="va">MS_all_past_scenarios</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate temperatures for simulation years, relative to adjusted_scenarios</span></span>
<span><span class="va">MS_all_past_scenario_temps</span> <span class="op">&lt;-</span> <span class="fu">temperature_generation</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">MS_patched_weather</span>,</span>
<span>    years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1990</span>, <span class="fl">2020</span><span class="op">)</span>, sim_years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2001</span>, <span class="fl">2100</span><span class="op">)</span>, temperature_scenario <span class="op">=</span> <span class="va">MS_adjusted_scenarios</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save as four different files of 100 year simulations</span></span>
<span><span class="fu">save_temperature_scenarios</span><span class="op">(</span><span class="va">MS_all_past_scenario_temps</span>, <span class="st">"data/MS"</span>, <span class="st">"MS_hist_scenarios"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MS_historic_temp_scenario_list</span> <span class="op">&lt;-</span> <span class="fu">load_temperature_scenarios</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"data/MS"</span>, prefix <span class="op">=</span> <span class="st">"MS_hist_scenarios"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MS_historic_sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">MS_historic_temp_scenario_list</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">MS_historic_sc</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">40001</span><span class="op">:</span><span class="fl">40010</span>, <span class="fl">80001</span><span class="op">:</span><span class="fl">80010</span>, <span class="fl">120001</span><span class="op">:</span><span class="fl">120010</span><span class="op">)</span>, <span class="op">]</span>, caption <span class="op">=</span> <span class="st">"Data snippets of historic temperature scenarios </span></span>
<span><span class="st">      representing the years 1990, 2000, 2010 and 2020 for Mössigen"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Data snippets of historic temperature scenarios representing the years 1990, 2000, 2010 and 2020 for Mössigen</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">DATE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">nodata</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmax</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1990.1</td>
<td style="text-align: left;">2001-01-01 12:00:00</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-4.4528462</td>
<td style="text-align: right;">2.7838511</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990.2</td>
<td style="text-align: left;">2001-01-02 12:00:00</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">-3.5121394</td>
<td style="text-align: right;">0.0834259</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990.3</td>
<td style="text-align: left;">2001-01-03 12:00:00</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">-4.2504236</td>
<td style="text-align: right;">-0.3243498</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990.4</td>
<td style="text-align: left;">2001-01-04 12:00:00</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">-4.8705823</td>
<td style="text-align: right;">-3.8745486</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990.5</td>
<td style="text-align: left;">2001-01-05 12:00:00</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">-5.7732966</td>
<td style="text-align: right;">-1.7434447</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990.6</td>
<td style="text-align: left;">2001-01-06 12:00:00</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">-6.2346084</td>
<td style="text-align: right;">-0.4685113</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990.7</td>
<td style="text-align: left;">2001-01-07 12:00:00</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">-4.8551823</td>
<td style="text-align: right;">6.0317922</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990.8</td>
<td style="text-align: left;">2001-01-08 12:00:00</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">-2.8983620</td>
<td style="text-align: right;">0.9439756</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990.9</td>
<td style="text-align: left;">2001-01-09 12:00:00</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">-1.3800776</td>
<td style="text-align: right;">0.7107785</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990.10</td>
<td style="text-align: left;">2001-01-10 12:00:00</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1.1413811</td>
<td style="text-align: right;">3.1928416</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2000.3477</td>
<td style="text-align: left;">2010-07-09 12:00:00</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">8.4566910</td>
<td style="text-align: right;">25.1140490</td>
</tr>
<tr class="even">
<td style="text-align: left;">2000.3478</td>
<td style="text-align: left;">2010-07-10 12:00:00</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">12.4603608</td>
<td style="text-align: right;">27.2441862</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2000.3479</td>
<td style="text-align: left;">2010-07-11 12:00:00</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">13.4290612</td>
<td style="text-align: right;">26.2686440</td>
</tr>
<tr class="even">
<td style="text-align: left;">2000.3480</td>
<td style="text-align: left;">2010-07-12 12:00:00</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">12.0821147</td>
<td style="text-align: right;">27.0396544</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2000.3481</td>
<td style="text-align: left;">2010-07-13 12:00:00</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">12.7267205</td>
<td style="text-align: right;">30.2322073</td>
</tr>
<tr class="even">
<td style="text-align: left;">2000.3482</td>
<td style="text-align: left;">2010-07-14 12:00:00</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">12.9097308</td>
<td style="text-align: right;">22.2960650</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2000.3483</td>
<td style="text-align: left;">2010-07-15 12:00:00</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">14.9783305</td>
<td style="text-align: right;">21.2339811</td>
</tr>
<tr class="even">
<td style="text-align: left;">2000.3484</td>
<td style="text-align: left;">2010-07-16 12:00:00</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">16.7687629</td>
<td style="text-align: right;">25.0773633</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2000.3485</td>
<td style="text-align: left;">2010-07-17 12:00:00</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">13.3772007</td>
<td style="text-align: right;">29.6958139</td>
</tr>
<tr class="even">
<td style="text-align: left;">2000.3486</td>
<td style="text-align: left;">2010-07-18 12:00:00</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">13.2147222</td>
<td style="text-align: right;">30.8729276</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2010.6953</td>
<td style="text-align: left;">2020-01-14 12:00:00</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">-1.1407123</td>
<td style="text-align: right;">0.6675815</td>
</tr>
<tr class="even">
<td style="text-align: left;">2010.6954</td>
<td style="text-align: left;">2020-01-15 12:00:00</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">-0.5252311</td>
<td style="text-align: right;">1.4177507</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2010.6955</td>
<td style="text-align: left;">2020-01-16 12:00:00</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">-4.9400630</td>
<td style="text-align: right;">3.1633331</td>
</tr>
<tr class="even">
<td style="text-align: left;">2010.6956</td>
<td style="text-align: left;">2020-01-17 12:00:00</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">-4.6120181</td>
<td style="text-align: right;">5.5391079</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2010.6957</td>
<td style="text-align: left;">2020-01-18 12:00:00</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">-0.7396546</td>
<td style="text-align: right;">9.6010079</td>
</tr>
<tr class="even">
<td style="text-align: left;">2010.6958</td>
<td style="text-align: left;">2020-01-19 12:00:00</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">-4.7137419</td>
<td style="text-align: right;">8.5298846</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2010.6959</td>
<td style="text-align: left;">2020-01-20 12:00:00</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">-1.9406303</td>
<td style="text-align: right;">9.4445371</td>
</tr>
<tr class="even">
<td style="text-align: left;">2010.6960</td>
<td style="text-align: left;">2020-01-21 12:00:00</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">-1.3536295</td>
<td style="text-align: right;">12.1636285</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2010.6961</td>
<td style="text-align: left;">2020-01-22 12:00:00</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">-0.9535499</td>
<td style="text-align: right;">10.7509769</td>
</tr>
<tr class="even">
<td style="text-align: left;">2010.6962</td>
<td style="text-align: left;">2020-01-23 12:00:00</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">5.5893574</td>
<td style="text-align: right;">11.9631516</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2020.10429</td>
<td style="text-align: left;">2029-07-21 12:00:00</td>
<td style="text-align: right;">2029</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">17.7782851</td>
<td style="text-align: right;">30.3032141</td>
</tr>
<tr class="even">
<td style="text-align: left;">2020.10430</td>
<td style="text-align: left;">2029-07-22 12:00:00</td>
<td style="text-align: right;">2029</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">16.6721667</td>
<td style="text-align: right;">31.5458384</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2020.10431</td>
<td style="text-align: left;">2029-07-23 12:00:00</td>
<td style="text-align: right;">2029</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">19.0341333</td>
<td style="text-align: right;">27.9408641</td>
</tr>
<tr class="even">
<td style="text-align: left;">2020.10432</td>
<td style="text-align: left;">2029-07-24 12:00:00</td>
<td style="text-align: right;">2029</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">16.3233464</td>
<td style="text-align: right;">28.8603603</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2020.10433</td>
<td style="text-align: left;">2029-07-25 12:00:00</td>
<td style="text-align: right;">2029</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">14.0082758</td>
<td style="text-align: right;">30.7631738</td>
</tr>
<tr class="even">
<td style="text-align: left;">2020.10434</td>
<td style="text-align: left;">2029-07-26 12:00:00</td>
<td style="text-align: right;">2029</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">15.6371568</td>
<td style="text-align: right;">30.0907448</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2020.10435</td>
<td style="text-align: left;">2029-07-27 12:00:00</td>
<td style="text-align: right;">2029</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">18.3545342</td>
<td style="text-align: right;">22.9516709</td>
</tr>
<tr class="even">
<td style="text-align: left;">2020.10436</td>
<td style="text-align: left;">2029-07-28 12:00:00</td>
<td style="text-align: right;">2029</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">15.2586851</td>
<td style="text-align: right;">23.0565610</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2020.10437</td>
<td style="text-align: left;">2029-07-29 12:00:00</td>
<td style="text-align: right;">2029</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">13.6594017</td>
<td style="text-align: right;">24.2402286</td>
</tr>
<tr class="even">
<td style="text-align: left;">2020.10438</td>
<td style="text-align: left;">2029-07-30 12:00:00</td>
<td style="text-align: right;">2029</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">12.4670887</td>
<td style="text-align: right;">26.2476757</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p><strong><em>2. Produce chill distributions for these scenarios and plot them.</em></strong></p>
<p>Similar to Bonn, Mössigen shows comparable chill distribution scenarios for the years 1990, 2000, 2010, and 2020, indicating a low risk of chill deficiencies in the region in the future.</p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb254"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calculate heat for temperate trees according to a stepwise model provided</span></span>
<span><span class="va">frost_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">step_model</span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1000</span>, <span class="fl">0</span><span class="op">)</span>, upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,</span>
<span>    <span class="fl">1000</span><span class="op">)</span>, weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Call the functions for each model for chill, heat and frost accumulations</span></span>
<span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Chill_Portions <span class="op">=</span> <span class="va">Dynamic_Model</span>, GDH <span class="op">=</span> <span class="va">GDH</span>, Frost_H <span class="op">=</span> <span class="va">frost_model</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate chill accumulation for the four temperature scenarios generated</span></span>
<span><span class="va">MS_chill_hist_scenario_list</span> <span class="op">&lt;-</span> <span class="fu">tempResponse_daily_list</span><span class="op">(</span><span class="va">MS_all_past_scenario_temps</span>,</span>
<span>    latitude <span class="op">=</span> <span class="fl">48.4</span>, Start_JDay <span class="op">=</span> <span class="fl">305</span>, End_JDay <span class="op">=</span> <span class="fl">59</span>, models <span class="op">=</span> <span class="va">models</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove all the incomplete winters from the record, before saving</span></span>
<span><span class="va">MS_chill_hist_scenario_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">MS_chill_hist_scenario_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Perc_complete</span> <span class="op">==</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Include the place name and the start and end dates of the considered period</span></span>
<span><span class="co"># in the saved file name</span></span>
<span><span class="fu">save_temperature_scenarios</span><span class="op">(</span><span class="va">MS_chill_hist_scenario_list</span>, <span class="st">"data/MS"</span>, <span class="st">"MS_hist_chill_305_59"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Store the years (1990, 2000, 2010, 2020) in a character vector</span></span>
<span><span class="va">scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">MS_chill_hist_scenario_list</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Combine all scenarios into one dataset, with a new column scenario for year</span></span>
<span><span class="va">MS_all_scenarios</span> <span class="op">&lt;-</span> <span class="va">MS_chill_hist_scenario_list</span><span class="op">[[</span><span class="va">scenarios</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>scenario <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">scenarios</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Repeat with loop for the remaining scenarios and bind to all_scenarios</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">sc</span> <span class="kw">in</span> <span class="va">scenarios</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="va">MS_all_scenarios</span> <span class="op">&lt;-</span> <span class="va">MS_all_scenarios</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">MS_chill_hist_scenario_list</span><span class="op">[[</span><span class="va">sc</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>scenario <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">sc</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Perc_complete</span> <span class="op">==</span> <span class="fl">100</span><span class="op">)</span>  <span class="co"># result is chillR data.frame</span></span>
<span></span>
<span><span class="co"># Call weather output of MS_patched_weather dataset</span></span>
<span><span class="va">MS_temps</span> <span class="op">&lt;-</span> <span class="fu">read_tab</span><span class="op">(</span><span class="st">"data/MS/MS_patched_weather.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's compute the actual 'observed' chill for comparison</span></span>
<span><span class="va">MS_actual_chill</span> <span class="op">&lt;-</span> <span class="fu">tempResponse_daily_list</span><span class="op">(</span><span class="va">MS_temps</span>, latitude <span class="op">=</span> <span class="fl">48.4</span>, Start_JDay <span class="op">=</span> <span class="fl">305</span>,</span>
<span>    End_JDay <span class="op">=</span> <span class="fl">59</span>, <span class="va">models</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Perc_complete</span> <span class="op">==</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">MS_all_scenarios</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">scenario</span>, <span class="va">Chill_Portions</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">scenario</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_violin</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Chill accumulation (Chill Portions)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Scenario year"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylim</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">90</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">MS_actual_chill</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span><span class="va">End_year</span>, <span class="va">Chill_Portions</span>, fill <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_fill_discrete</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Scenario"</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">MS_all_scenarios</span><span class="op">$</span><span class="va">scenario</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/14.3.2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section></section><section id="chapter-15-future-temperature-scenarios" class="level2"><h2 class="anchored" data-anchor-id="chapter-15-future-temperature-scenarios">Chapter 15: Future temperature scenarios</h2>
<section id="impacts-of-future-climate-change" class="level3"><h3 class="anchored" data-anchor-id="impacts-of-future-climate-change">
<span style="color:#71797E">15.1</span>&nbsp; Impacts of future climate change</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>We’re expecting future impacts to be more dramatic than what we’ve seen so far, mainly because atmospheric greenhouse gas concentrations are now higher than they’ve ever been, since our species appeared on the planet (and in fact many millions of years before).</p></li>
<li><p>Despite some efforts to mitigate climate change, the world’s factories, cars etc. are also still emitting carbon dioxide on the order of 40 Gt CO2-eq per year— at or at least close to the all-time peak, with only weak signs of significant slowdown over the coming decades.</p></li>
<li><p>We also know that near-global ecosystem degradation is gradually chipping away at the buffers, checks and balances that have managed to maintain stable ecosystems to date. To anticipate the future impacts of climate change, we have to keep all these dynamics in mind.</p></li>
<li><p>It then becomes pretty obvious that we cannot predict with certainty what is going to happen in the future— to what extent global efforts to curb carbon dioxide emissions or sequester carbon from the atmosphere will be successful or how much change the Earth’s marine and terrestrial ecosystems will be able to absorb before irreversible and possibly self-reinforcing degradation will set in.</p></li>
<li><p>We can’t address all uncertainties with <code>chillR</code>, but we can accommodate— to some extent— our uncertainty about future climatic conditions. In climate change adaptation research, the challenge is often conceptualized using the concept of exposure, sensitivity and adaptive capacity:</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./pic/ch15_1.png" class="img-fluid figure-img"></p>
<figcaption><strong><em>Conceptual framework for evaluating vulnerability and adaptation to climate change (<a href="https://www.actahort.org/members/showpdf?booknrarnr=1281_58">Luedeling, 2020</a>)</em></strong></figcaption></figure>
</div>
<p><br></p>
<ul>
<li><p>In this concept, <strong><em>exposure</em></strong> describes the future conditions we expect, and <strong><em>sensitivity</em></strong> is the way the system responds to change. By combining exposure and sensitivity, we can determine the <strong><em>potential impact</em></strong> of expected conditions on the system of interest.</p></li>
<li><p>These aren’t necessarily the actual impacts, however, because the system may be able to adapt to some extent. This system attribute is often referred to as <strong><em>adaptive capacity</em></strong>.</p></li>
<li><p>Adaptation actions usually either aim to reduce system sensitivity (e.g.&nbsp;by choosing different tree cultivars) or to raise adaptive capacity (e.g.&nbsp;by establishing management options that allow dealing with chill shortfalls).</p></li>
<li>
<p>What exact aspects of this concept we’re working on depends a bit on our interpretation of these terms.</p>
<ul>
<li>For the most part, we’re looking at exposure, because we’re producing scenarios of conditions that orchards will be confronted with in the future.</li>
<li>However, our chill models consider— to some extent— the biological response of trees, which we could argue comes close to the concept of sensitivity.</li>
<li>Yet we’re not fully capturing this sensitivity, so I would place the analyses we’re currently doing mostly within the exposure category.</li>
</ul>
</li>
</ul>
<p><br></p>
</section><section id="future-climate-scenarios" class="level3"><h3 class="anchored" data-anchor-id="future-climate-scenarios">
<span style="color:#71797E">15.2</span>&nbsp; Future climate scenarios</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>We have already learned about future climate scenarios, and how we can make historic chill scenarios, including some technical details, but what is still missing now is a source of information on conditions that climate models predict for the place we’re interested in.</p></li>
<li><p>In principle, all the <code>chillR</code> functions work just as well with great future scenarios as they do with deeply flawed ones— so if you happen to be collaborating with a world-class climate modeling group, or you have access to state-of-the-art climate scenarios for your region, it may be a good idea to use those data.</p></li>
<li><p><code>chillR</code> can’t keep track of all downscaling efforts that are going on, or be aware of all regional initiatives. It does, however, includes functions that allows us easy access to useful databases of climate information.</p></li>
</ul>
<p><br></p>
<section id="some-background-on-climate-models-and-warming-pathways" class="level4"><h4 class="anchored" data-anchor-id="some-background-on-climate-models-and-warming-pathways">
<span style="color:#71797E">15.2.1</span>&nbsp; Some background on climate models and warming pathways</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>Until November 2023, the best source of climate data that chillR had to offer was the <code>ClimateWizard</code> database, maintained by the Center for Tropical Agriculture (CIAT).</p></li>
<li><p>Climate science evolves rapidly and models get better and better. More importantly, the type of warming scenarios that are recommended by the IPCC get updated with every major report they issue.</p></li>
<li><p>These scenarios are produced by the <a href="https://en.wikipedia.org/wiki/Coupled_Model_Intercomparison_Project">Coupled Model Intercomparison Project (CMIP)</a>, a major effort to assemble the best that climate science has to offer in terms of future projections.</p></li>
<li>
<p>CMIP is structured in phases:</p>
<ul>
<li>Phase 5 (CMIP5) went from 2010 to 2014 and it included a certain set of climate models.</li>
<li>The following CMIP6 includes has a slightly different array of climate models, which (at the time of writing) represents the <strong>state of the art</strong> of climate science, as endorsed by the IPCC.</li>
</ul>
</li>
</ul>
<ul>
<li><p>Another feature of these future projections that gets updated occasionally are the warming scenarios which, over the years, have evolved from the scenarios contained in the <a href="https://en.wikipedia.org/wiki/Special_Report_on_Emissions_Scenarios">Special Report on Emission Scenarios (SRES)</a> via the <a href="https://en.wikipedia.org/wiki/Representative_Concentration_Pathway">Representative Concentration Pathways (RCPs)</a> to the currently recommended <a href="https://en.wikipedia.org/wiki/Shared_Socioeconomic_Pathways">Shared Socioeconomic Pathways (SSPs)</a>.</p></li>
<li><p>The SSPs are the latest generation of scenarios, which was published in 2021. If you want to produce state-of-the-art projections, these are the scenarios you should be using, and you should be using the outputs of the CMIP6 set of climate models. (<code>ClimateWizard</code> only includes RCP scenarios, and it even only has two of these, which don’t really bracket the full array of future climates that climate scientists consider plausible.)</p></li>
</ul>
<p><br></p>
</section></section><section id="exercises-on-future-temperature-scenarios" class="level3"><h3 class="anchored" data-anchor-id="exercises-on-future-temperature-scenarios">
<span style="color:#71797E">15.3</span>&nbsp; Exercises on future temperature scenarios</h3>
<div style="height: 18px;">

</div>
<p><strong><em>1. Briefly describe the differences between the RCPs and the SSPs (you may have to follow some of the links provided above).</em></strong></p>
<p>The Representative Concentration Pathways (RCP) are the climate change scenarios that project future concentrations of pollutants and greenhouse gases emitted from human activities, accounting for efforts to reduce these emissions. These scenarios quantitatively describe the concentrations of these substances in the atmosphere over time and their radiative forcing in the year 2100 (<a href="https://cicero.oslo.no/en/articles/a-guide-to-representative-concentration-pathways">Bjørnæs , 2022</a>).</p>
<p>Descriptions of various RCP scenarios are shown in the table below:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./pic/ch16_1.png" class="img-fluid figure-img"></p>
<figcaption><strong><em>Description of the Representative Concentration Pathways (RCP) scenarios (<a href="https://www.mdpi.com/2071-1050/10/4/1242">Kwon, Y., Hwang, J., &amp; Seo, Y., 2018</a>)</em></strong></figcaption></figure>
</div>
<p><br></p>
<p>The Shared Socio-economic Pathways (SSPs) are also climate change scenarios, but unlike the RCPs, their projections are for global socioeconomic changes and their impact on climate change up to the year 2100, as stated in the 2021 IPCC Sixth Assessment Report. In other words, the SSP scenarios are a further refinement of the RCP scenarios previously used for climate modelling in the IPCC fifth Assessment Report(<a href="https://environment.govt.nz/what-you-can-do/climate-scenarios-toolkit/climate-scenarios-list/ipccs-ssp-rcp-scenarios/">Ministry for the Environment, 2024</a>).</p>
<p>The SSP scenarios are built on assumptions about socio-economic, geopolitical, economic and technological trends, which are then translated into greenhouse gas emissions scenarios by coupling these assumptions with mitigation targets for climate change. On the other hand, the RCPs directly focus on <strong>greenhouse gases</strong>— such as carbon dioxide, methane, nitrous oxide, flourocarbons and sulphur groups and hexafluroide— as well as <strong>aerosols and chemically active gases</strong>, including sulphur dioxide, soot, organic carbon, carbon monoxide, nitrogen oxides, volatile organic compounds and ammonia.</p>
<p>The justification for the RCPs not including assumptions about population growth, economic and technological developments was that the level of radiative forcing can be the same for different socio-economic futures. Therefore, instead of focusing on a specific economic development and calculate climate change for that scenario, scientists could just pick a RCP scenario that is most aligned with a climate target, and experiment with various technology and policy choices(<a href="https://cicero.oslo.no/en/articles/a-guide-to-representative-concentration-pathways">Bjørnæs , 2022</a>).</p>
<p>However, this later was considered as a drawback due to the lack of standardization of the socio-economic characteristics of the RCP scenarios, which made it difficult to map out societal changes and relevant policies for a climate target. This led to the development on SSPs (based on RCPs), which provide a standardized framework for comparing socio-economic and other societal changes, as well as their impact on climate change levels (<a href="https://climatedata.ca/resource/understanding-shared-socio-economic-pathways-ssps/">ClimateData.ca, 2023</a>).</p>
<p>In the IPCC’s latest Sixth Assessment Report (AR6), the Shared Socio-economic Pathways (SSPS) are combined with the Representative Concentration Pathways (RCPs) to form the <strong>SSP-RCP</strong> scenarios, which integrate the baseline socio-economic scenarios of the SSPs with the emission trajectories from the RCPs (<a href="https://environment.govt.nz/what-you-can-do/climate-scenarios-toolkit/climate-scenarios-list/ipccs-ssp-rcp-scenarios/">Ministry for the Environment, 2024</a>).</p>
<p>The table below shows how each SSP is linked to each RCP, and its description in CMIP6.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./pic/ch16_2.png" class="img-fluid figure-img"></p>
<figcaption><strong><em>Source: <a href="https://www.climatehubs.usda.gov/hubs/northwest/topic/what-are-climate-model-phases-and-scenarios">USDA Climate Hub</a></em></strong></figcaption></figure>
</div>
<p><br></p>
</section></section><section id="chapter-16-making-cmip6-scenarios" class="level2"><h2 class="anchored" data-anchor-id="chapter-16-making-cmip6-scenarios">Chapter 16: Making CMIP6 scenarios</h2>
<section id="accessing-gridded-climate-data-from-the-copernicus-climate-data-store-data" class="level3"><h3 class="anchored" data-anchor-id="accessing-gridded-climate-data-from-the-copernicus-climate-data-store-data">
<span style="color:#71797E">16.1</span>&nbsp; Accessing gridded climate data from the Copernicus climate data store data</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>Most future climate data come in the form of grids— if we want to obtain information on a particular climatic metric for a particular place, we may have to download a sometimes fairly large file that contains data for a lot of other places as well.</p></li>
<li><p>To make use of the data provided by the <a href="https://cds.climate.copernicus.eu/">Copernicus Climate Data Store</a> via their Application Programming Interface (API), we need a user ID and a key (called Access Token on their site).</p></li>
<li><p>To get this, we have to create a free account <a href="https://cds.climate.copernicus.eu/">here</a> (registration button is in the top right corner), before using the <code>chillR</code> functions.</p></li>
<li><p>Once you’ve set up your account, navigate to your user profile on the <a href="https://cds.climate.copernicus.eu/">Copernicus Climate Data Store website</a>, where you’ll find your <code>User ID</code> and your <code>Personal Access Token</code> (both are long, cryptic strings of symbols), both of which you will need to download data.</p></li>
<li><p>After registering, you also have to read and accept the <a href="https://cds.climate.copernicus.eu/datasets/projections-cmip6?tab=download#manage-licences">Terms of Use for Data Access</a>. After this is done, the following code should work.</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./pic/ch16_2.png" class="img-fluid figure-img"></p>
<figcaption><strong><em>Relation of each SSP to each RCP and description of SSPs in CMIP6 (<a href="https://www.climatehubs.usda.gov/hubs/northwest/topic/what-are-climate-model-phases-and-scenarios">USDA Climate Hubs</a>)</em></strong></figcaption></figure>
</div>
<p><br></p>
<section id="downloading-future-climate-data" class="level4"><h4 class="anchored" data-anchor-id="downloading-future-climate-data">
<span style="color:#71797E">16.1.1</span>&nbsp; Downloading future climate data</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>With the <code>download_cmip6_ecmwfr</code> function, we can only download data for grids.</p></li>
<li>
<p>To achieve this, we need to specify the extent of the download area.</p>
<ul>
<li>We will actually download the data to our computer.</li>
<li>We can keep the data there, so that we don’t have to download them again.</li>
</ul>
</li>
</ul>
<ul>
<li><p>For subsequent steps, we can access these data and extract whatever we need. This means that if we really only want to analyze data for a single station, we can choose a small extent around this station.</p></li>
<li><p>If we want to evaluate multiple stations, however, especially when these are located close to each other, it may be advisable to choose an extent that includes all these stations.</p></li>
<li><p>For example, if we want to evaluate data for Bonn, which is located at approximately 7.1°E and 50.8°N, we should choose a small extent around this— specify in the form of a vector structured as follows: <code>c(maximum latitude, minimum longitude, minimum latitude, maximum longitude)</code>.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb255"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Choose/set area to download data</span></span>
<span><span class="va">location</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7.1</span>, <span class="fl">50.8</span><span class="op">)</span></span>
<span><span class="va">area</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">52</span>, <span class="fl">6</span>, <span class="fl">50</span>, <span class="fl">8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Download the data. The download_cmip6_ecmwfr contains a default set of</span></span>
<span><span class="co"># models.  Start by only using data for SSP1 (ssp126).</span></span>
<span><span class="fu">download_cmip6_ecmwfr</span><span class="op">(</span>scenarios <span class="op">=</span> <span class="st">"ssp126"</span>, area <span class="op">=</span> <span class="va">area</span>, user <span class="op">=</span> <span class="st">"cdc26d1b-d9e9-4552-9b32-e2b974562cee"</span>,</span>
<span>    key <span class="op">=</span> <span class="st">"1aee996e-75a8-48d2-b7e7-fe4aac7fc8df"</span>, model <span class="op">=</span> <span class="st">"default"</span>, frequency <span class="op">=</span> <span class="st">"monthly"</span>,</span>
<span>    variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tmin"</span>, <span class="st">"Tmax"</span><span class="op">)</span>, year_start <span class="op">=</span> <span class="fl">2015</span>, year_end <span class="op">=</span> <span class="fl">2100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This function took a while to run, and it generated a bunch of files in a</span></span>
<span><span class="co"># subfolder of our working directory- change the name of this folder (using the</span></span>
<span><span class="co"># path_download parameter),otherwise the data should be stored in the</span></span>
<span><span class="co"># cmip6_downloaded folder.</span></span>
<span></span>
<span><span class="co"># We also received a message about Dropped models. These are climate models,</span></span>
<span><span class="co"># for which the database contained no data with the specifications we provided.</span></span>
<span><span class="co"># For these models, the function attempted to download data but didn’t find</span></span>
<span><span class="co"># anything in the database. These models are then blacklisted, i.e. the</span></span>
<span><span class="co"># function leaves a note in the download folder to prevent the function from</span></span>
<span><span class="co"># trying to download these data again.</span></span>
<span></span>
<span><span class="co"># Assuming that this worked well, we should now expand the download to</span></span>
<span><span class="co"># additional SSP scenarios. We can simply provide a vector of such scenarios as</span></span>
<span><span class="co"># the scenarios parameter.</span></span>
<span></span>
<span><span class="co"># I’ll use the scenarios SSP126, SSP245, SSP370 and SSP585. These are the</span></span>
<span><span class="co"># standard scenarios of CMIP6 (and currently the only ones that this function</span></span>
<span><span class="co"># can download).</span></span>
<span></span>
<span><span class="co"># Note that we can add “ssp126” here again, because the function is able to</span></span>
<span><span class="co"># detect whether the respective data have already been downloaded.  It</span></span>
<span><span class="co"># automatically skips all files that are already present.</span></span>
<span></span>
<span><span class="co"># Download additional SSP scenarios</span></span>
<span><span class="fu">download_cmip6_ecmwfr</span><span class="op">(</span>scenarios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ssp126"</span>, <span class="st">"ssp245"</span>, <span class="st">"ssp370"</span>, <span class="st">"ssp585"</span><span class="op">)</span>, area <span class="op">=</span> <span class="va">area</span>,</span>
<span>    user <span class="op">=</span> <span class="st">"cdc26d1b-d9e9-4552-9b32-e2b974562cee"</span>, key <span class="op">=</span> <span class="st">"1aee996e-75a8-48d2-b7e7-fe4aac7fc8df"</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"default"</span>, frequency <span class="op">=</span> <span class="st">"monthly"</span>, variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tmin"</span>, <span class="st">"Tmax"</span><span class="op">)</span>, year_start <span class="op">=</span> <span class="fl">2015</span>,</span>
<span>    year_end <span class="op">=</span> <span class="fl">2100</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section><section id="generating-change-scenarios" class="level4"><h4 class="anchored" data-anchor-id="generating-change-scenarios">
<span style="color:#71797E">16.1.2</span>&nbsp; Generating change scenarios</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>We should now have downloaded a lot of data to a folder called <code>cmip6_downloaded/52_6_50_8</code>, but we still need more.</p></li>
<li><p>What we have now are future scenarios. The simulated records start in 2015, and earlier data aren’t available for the SSP scenarios.</p></li>
<li><p>These data come out of very coarse-resolution climate models. The pixels of such models often include entire landscapes, with rivers and mountains, coastal areas and inland regions.</p></li>
<li><p>The values we downloaded represent an average of all of these, so it may be quite unlikely that they are a good approximation of the temperature conditions of our place of interest.</p></li>
<li><p>The coarse resolution is certainly a problem, and for rainfall patterns or hydrological applications, landscape-scale features may be so important that we may have to wait for someone to apply spatial downscaling to these coarse datasets.</p></li>
<li><p>In (dynamic) downscaling, the coarse GCM outputs are inserted into a finer-scale climate model that actually represents all the crucial landscape features. After such downscaling, we may have a chance to get accurate information on rainfall patterns etc.</p></li>
<li><p>Fortunately, we’re really only interested in temperature here. While landscape features also influence temperature dynamics, the effect isn’t nearly as dramatic as for precipitation.</p></li>
<li><p>Still, we should not use temperature data from our GCM projections directly, but the temperature <strong>change</strong> projected by these models is still quite useful. If, for instance, a GCM projects January temperatures that are 2°C warmer than today for some future scenario, then we could add these 2°C to what we observe today (ideally as a scenario for a weather generator).</p></li>
<li><p>When we talk about climate change, we often refer to warming by a certain number of degrees, e.g.&nbsp;in the prerogative to limit warming to 1.5°C that the international community agreed on in the <a href="https://unfccc.int/process-and-meetings/the-paris-agreement">Paris Agreement</a>, but such talk only makes sense if we know the baseline that this change is relative to— <strong>today</strong>.</p></li>
<li><p>Quite obviously, in a warming world, a 2°C change on top of conditions in, say, 1850 takes us to a cooler scenario than if we apply the same warming to today’s much warmer climate. We therefore should be very much aware of the reference conditions that apply to our warming scenario.</p></li>
<li>
<p>In the <code>chillR</code> workflow for the CMIP6 data, we can control this to some extent, but we’ve also chosen a useful default for you: the 29-year period from 1986 to 2014, because</p>
<ul>
<li>data for this interval are available for the historical model runs in the Copernicus database,</li>
<li>the median year of this interval is a nice round number (2000), and</li>
<li>29 years is pretty close to the 30 years that climate scientists generally recommend as the basis for a robust climatology.</li>
</ul>
</li>
</ul>
<ul>
<li><p>To create change scenarios from our climate data, we have to subtract conditions during the baseline period from the future projections. For this, it is important that the baseline and the future data are generated with the same tool, i.e.&nbsp;the same climate model.</p></li>
<li><p>Fortunately, for every climate model contained in the CMIP6 ensemble, we can also retrieve historical information from the Copernicus database. We can get this done with the <code>download_baseline_cmip6_ecmwfr</code> function:</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb256"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Download historical information (baseline data for 29 years period)</span></span>
<span><span class="fu">download_baseline_cmip6_ecmwfr</span><span class="op">(</span>area <span class="op">=</span> <span class="va">area</span>, key <span class="op">=</span> <span class="st">"1aee996e-75a8-48d2-b7e7-fe4aac7fc8df"</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"match_downloaded"</span>, frequency <span class="op">=</span> <span class="st">"monthly"</span>, variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tmin"</span>, <span class="st">"Tmax"</span><span class="op">)</span>,</span>
<span>    year_start <span class="op">=</span> <span class="fl">1986</span>, year_end <span class="op">=</span> <span class="fl">2014</span>, month <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span>  <span class="co"># we are using average of the years over the period</span></span>
<span></span>
<span><span class="co"># Note that if we specify `models = match_downloaded` here, the function will</span></span>
<span><span class="co"># automatically look into the download folder, determine what models were used</span></span>
<span><span class="co"># and download all respective baseline data.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section><section id="extracting-data-from-the-grids" class="level4"><h4 class="anchored" data-anchor-id="extracting-data-from-the-grids">
<span style="color:#71797E">16.1.3</span>&nbsp; Extracting data from the grids</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>These data are still gridded, so we have to extract the data for the point of interest.</p></li>
<li><p>To do this, we’ll create a small <code>data.frame</code> that contains the station name and the coordinates for Bonn.</p></li>
<li><p>We could also add more station locations to this <code>data.frame</code> but this lesson I’m only interested in data for Bonn.</p></li>
<li><p>We’ll then use the <code>extract_cmip6_data</code> function to extract the point location data.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb257"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create data.frame for location 'Bonn'</span></span>
<span><span class="va">station</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>station_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Bonn"</span><span class="op">)</span>, longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7.1</span><span class="op">)</span>, latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">50.8</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract point location data for Bonn</span></span>
<span><span class="va">extracted</span> <span class="op">&lt;-</span> <span class="fu">extract_cmip6_data</span><span class="op">(</span>stations <span class="op">=</span> <span class="va">station</span>, download_path <span class="op">=</span> <span class="st">"data/Bonn/cmip6_downloaded"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Unzipping files
Extracting downloaded CMIP6 files</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb259"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Let’s look at some of the data for one of the climate models.</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">extracted</span><span class="op">$</span><span class="va">`ssp126_AWI-CM-1-1-MR`</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Date</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">lat</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">lon</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">location</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">model</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">ssp</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmax</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2015-01-16</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">50.9608</td>
<td style="text-align: right;">7.5</td>
<td style="text-align: left;">Bonn</td>
<td style="text-align: left;">AWI-CM-1-1-MR</td>
<td style="text-align: left;">ssp126</td>
<td style="text-align: right;">-13.6960</td>
<td style="text-align: right;">10.8620</td>
</tr>
<tr class="even">
<td style="text-align: left;">2015-02-15</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">50.9608</td>
<td style="text-align: right;">7.5</td>
<td style="text-align: left;">Bonn</td>
<td style="text-align: left;">AWI-CM-1-1-MR</td>
<td style="text-align: left;">ssp126</td>
<td style="text-align: right;">-3.2364</td>
<td style="text-align: right;">12.8374</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2015-03-16</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">50.9608</td>
<td style="text-align: right;">7.5</td>
<td style="text-align: left;">Bonn</td>
<td style="text-align: left;">AWI-CM-1-1-MR</td>
<td style="text-align: left;">ssp126</td>
<td style="text-align: right;">-2.8993</td>
<td style="text-align: right;">13.5311</td>
</tr>
<tr class="even">
<td style="text-align: left;">2015-04-16</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">50.9608</td>
<td style="text-align: right;">7.5</td>
<td style="text-align: left;">Bonn</td>
<td style="text-align: left;">AWI-CM-1-1-MR</td>
<td style="text-align: left;">ssp126</td>
<td style="text-align: right;">0.0531</td>
<td style="text-align: right;">21.7272</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2015-05-16</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">50.9608</td>
<td style="text-align: right;">7.5</td>
<td style="text-align: left;">Bonn</td>
<td style="text-align: left;">AWI-CM-1-1-MR</td>
<td style="text-align: left;">ssp126</td>
<td style="text-align: right;">3.9305</td>
<td style="text-align: right;">22.6927</td>
</tr>
<tr class="even">
<td style="text-align: left;">2015-06-16</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">50.9608</td>
<td style="text-align: right;">7.5</td>
<td style="text-align: left;">Bonn</td>
<td style="text-align: left;">AWI-CM-1-1-MR</td>
<td style="text-align: left;">ssp126</td>
<td style="text-align: right;">7.7302</td>
<td style="text-align: right;">24.7364</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<ul>
<li>Since we have stored the baseline data in the same folder, we can now use a very compact call to generate change scenarios for all the climate projections in the folder.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb260"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">change_scenarios</span> <span class="op">&lt;-</span> <span class="fu">gen_rel_change_scenario</span><span class="op">(</span><span class="va">extracted</span>, scenarios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2050</span>, <span class="fl">2085</span><span class="op">)</span>,</span>
<span>    reference_period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1986</span><span class="op">:</span><span class="fl">2014</span><span class="op">)</span>, future_window_width <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">change_scenarios</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">location</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">scenario</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">start_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">end_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">scenario_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">reference_year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">scenario_type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">labels</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Bonn</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.826612</td>
<td style="text-align: right;">1.803455</td>
<td style="text-align: left;">ssp126</td>
<td style="text-align: right;">2035</td>
<td style="text-align: right;">2065</td>
<td style="text-align: right;">2050</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">relative</td>
<td style="text-align: left;">ACCESS-CM2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bonn</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2.765976</td>
<td style="text-align: right;">2.179606</td>
<td style="text-align: left;">ssp126</td>
<td style="text-align: right;">2035</td>
<td style="text-align: right;">2065</td>
<td style="text-align: right;">2050</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">relative</td>
<td style="text-align: left;">ACCESS-CM2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Bonn</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1.485612</td>
<td style="text-align: right;">1.170670</td>
<td style="text-align: left;">ssp126</td>
<td style="text-align: right;">2035</td>
<td style="text-align: right;">2065</td>
<td style="text-align: right;">2050</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">relative</td>
<td style="text-align: left;">ACCESS-CM2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bonn</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1.501575</td>
<td style="text-align: right;">1.264827</td>
<td style="text-align: left;">ssp126</td>
<td style="text-align: right;">2035</td>
<td style="text-align: right;">2065</td>
<td style="text-align: right;">2050</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">relative</td>
<td style="text-align: left;">ACCESS-CM2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Bonn</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1.733385</td>
<td style="text-align: right;">1.485717</td>
<td style="text-align: left;">ssp126</td>
<td style="text-align: right;">2035</td>
<td style="text-align: right;">2065</td>
<td style="text-align: right;">2050</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">relative</td>
<td style="text-align: left;">ACCESS-CM2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bonn</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">1.808780</td>
<td style="text-align: right;">1.506125</td>
<td style="text-align: left;">ssp126</td>
<td style="text-align: right;">2035</td>
<td style="text-align: right;">2065</td>
<td style="text-align: right;">2050</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">relative</td>
<td style="text-align: left;">ACCESS-CM2</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<ul>
<li><p>As you can see, all the data are stored in one long data.frame. This is a format that we can easily save as a <code>csv</code> file.</p></li>
<li><p>We can’t directly use this with our weather generator, but fortunately, <code>chillR</code> has a conversion function called <code>convert_scen_information</code> that can extract the relevant information and produce scenarios that are compatible with the <code>temperature_generation</code> function.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb261"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">change_scenarios</span>, <span class="st">"data/Bonn/all_change_scenarios.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">change_scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/Bonn/all_change_scenarios.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">scen_list</span> <span class="op">&lt;-</span> <span class="fu">convert_scen_information</span><span class="op">(</span><span class="va">change_scenarios</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let’s look at one of the elements in the scenario lists.</span></span>
<span><span class="va">scen_list</span><span class="op">$</span><span class="va">Bonn</span><span class="op">$</span><span class="va">ssp126</span><span class="op">$</span><span class="va">`ACCESS-CM2`</span><span class="op">$</span><span class="st">"2050"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>$data
       Tmin     Tmax
1  1.803455 1.826612
2  2.179606 2.765976
3  1.170670 1.485612
4  1.264827 1.501575
5  1.485717 1.733385
6  1.506125 1.808780
7  2.047910 2.668619
8  1.654944 2.754484
9  2.388600 3.323390
10 2.540916 2.722248
11 2.322483 2.434944
12 2.737679 2.713174

$scenario
[1] "ssp126"

$start_year
[1] 2035

$end_year
[1] 2065

$scenario_year
[1] 2050

$reference_year
[1] 2000

$scenario_type
[1] "relative"

$labels
[1] "ACCESS-CM2"</code></pre>
</div>
</div>
<p><br></p>
<ul>
<li>As you see, this scenario contains changes for the mean daily minimum and mean daily maximum temperature of every month, as well as several pieces of information that define the scenario:
<ul>
<li>
<code>scenario</code> specifies the SSP scenario,</li>
<li>
<code>scenario_type</code> says that this is a relative scenario, and</li>
<li>
<code>labels</code> contains the name of the GCM.</li>
</ul>
</li>
</ul>
<ul>
<li><p>Then we have four attributes that contain years. <code>start_year</code>, <code>end_year</code> and <code>scenario_year</code> describe the time slice that this scenario is for.</p></li>
<li><p>We see that this corresponds to a 31-year window (2035-2065), with the median of this range (2050) serving as the <code>scenario_year</code>, i.e.&nbsp;the year that this scenario should be considered most typical for.</p></li>
<li><p>The final parameter, <code>reference_year</code>, is also quite important. This identifies the year that the specified change is relative to, i.e.&nbsp;the temperature changes given in this scenario describe the warming relative to conditions in 2000.</p></li>
<li><p>We can use the same convert_scen_information function to convert this list back to the data.frame format.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb263"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">scen_frame</span> <span class="op">&lt;-</span> <span class="fu">convert_scen_information</span><span class="op">(</span><span class="va">scen_list</span><span class="op">)</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">scen_frame</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span>, caption <span class="op">=</span> <span class="st">"First ten row in data.frame format of the converted data </span></span>
<span><span class="st">      suitable for temperature_generation function"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>First ten row in data.frame format of the converted data suitable for temperature_generation function</caption>
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmax</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">scenario</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">start_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">end_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">scenario_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">reference_year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">scenario_type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">labels</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">location</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1.803455</td>
<td style="text-align: right;">1.826612</td>
<td style="text-align: left;">ssp126</td>
<td style="text-align: right;">2035</td>
<td style="text-align: right;">2065</td>
<td style="text-align: right;">2050</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">relative</td>
<td style="text-align: left;">ACCESS-CM2</td>
<td style="text-align: left;">Bonn</td>
</tr>
<tr class="even">
<td style="text-align: right;">2.179606</td>
<td style="text-align: right;">2.765976</td>
<td style="text-align: left;">ssp126</td>
<td style="text-align: right;">2035</td>
<td style="text-align: right;">2065</td>
<td style="text-align: right;">2050</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">relative</td>
<td style="text-align: left;">ACCESS-CM2</td>
<td style="text-align: left;">Bonn</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1.170670</td>
<td style="text-align: right;">1.485612</td>
<td style="text-align: left;">ssp126</td>
<td style="text-align: right;">2035</td>
<td style="text-align: right;">2065</td>
<td style="text-align: right;">2050</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">relative</td>
<td style="text-align: left;">ACCESS-CM2</td>
<td style="text-align: left;">Bonn</td>
</tr>
<tr class="even">
<td style="text-align: right;">1.264827</td>
<td style="text-align: right;">1.501575</td>
<td style="text-align: left;">ssp126</td>
<td style="text-align: right;">2035</td>
<td style="text-align: right;">2065</td>
<td style="text-align: right;">2050</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">relative</td>
<td style="text-align: left;">ACCESS-CM2</td>
<td style="text-align: left;">Bonn</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1.485717</td>
<td style="text-align: right;">1.733385</td>
<td style="text-align: left;">ssp126</td>
<td style="text-align: right;">2035</td>
<td style="text-align: right;">2065</td>
<td style="text-align: right;">2050</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">relative</td>
<td style="text-align: left;">ACCESS-CM2</td>
<td style="text-align: left;">Bonn</td>
</tr>
<tr class="even">
<td style="text-align: right;">1.506125</td>
<td style="text-align: right;">1.808780</td>
<td style="text-align: left;">ssp126</td>
<td style="text-align: right;">2035</td>
<td style="text-align: right;">2065</td>
<td style="text-align: right;">2050</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">relative</td>
<td style="text-align: left;">ACCESS-CM2</td>
<td style="text-align: left;">Bonn</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2.047910</td>
<td style="text-align: right;">2.668619</td>
<td style="text-align: left;">ssp126</td>
<td style="text-align: right;">2035</td>
<td style="text-align: right;">2065</td>
<td style="text-align: right;">2050</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">relative</td>
<td style="text-align: left;">ACCESS-CM2</td>
<td style="text-align: left;">Bonn</td>
</tr>
<tr class="even">
<td style="text-align: right;">1.654944</td>
<td style="text-align: right;">2.754484</td>
<td style="text-align: left;">ssp126</td>
<td style="text-align: right;">2035</td>
<td style="text-align: right;">2065</td>
<td style="text-align: right;">2050</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">relative</td>
<td style="text-align: left;">ACCESS-CM2</td>
<td style="text-align: left;">Bonn</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2.388600</td>
<td style="text-align: right;">3.323390</td>
<td style="text-align: left;">ssp126</td>
<td style="text-align: right;">2035</td>
<td style="text-align: right;">2065</td>
<td style="text-align: right;">2050</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">relative</td>
<td style="text-align: left;">ACCESS-CM2</td>
<td style="text-align: left;">Bonn</td>
</tr>
<tr class="even">
<td style="text-align: right;">2.540916</td>
<td style="text-align: right;">2.722248</td>
<td style="text-align: left;">ssp126</td>
<td style="text-align: right;">2035</td>
<td style="text-align: right;">2065</td>
<td style="text-align: right;">2050</td>
<td style="text-align: right;">2000</td>
<td style="text-align: left;">relative</td>
<td style="text-align: left;">ACCESS-CM2</td>
<td style="text-align: left;">Bonn</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
</section><section id="baseline-adjustment" class="level4"><h4 class="anchored" data-anchor-id="baseline-adjustment">
<span style="color:#71797E">16.1.4</span>&nbsp; Baseline adjustment</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>We want to produce scenarios for the future, but we also want to use the observed data from Bonn to inform the weather generator and to ensure that we actually simulate temperatures for Bonn rather than the average conditions of some GCM pixel.</p></li>
<li><p>In principle, the weather generator can do this, so let’s first try with one of the scenarios.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb264"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Bonn_temps</span> <span class="op">&lt;-</span> <span class="fu">read_tab</span><span class="op">(</span><span class="st">"data/Bonn/Bonn_temps.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># temperature_generation(Bonn_temps, years = c(1973, 2019), sim_years = c(2001,</span></span>
<span><span class="co"># 2100), scen_list$Bonn$ssp126$`ACCESS-CM2`)</span></span>
<span></span>
<span><span class="co"># Error: weather data used for calibration not valid as a baseline for this</span></span>
<span><span class="co"># scenario the reference year of the scenario must correspond to the median</span></span>
<span><span class="co"># year of the weather record (specified by c(year_min,year_max). At the moment,</span></span>
<span><span class="co"># this is 1996 but it should be 2000, so that it works for this scenario</span></span>
<span></span>
<span><span class="co"># This didn’t work! Instead, we got an error message alerting us that the</span></span>
<span><span class="co"># reference year of the scenario must correspond to the reference year of the</span></span>
<span><span class="co"># future scenario.</span></span>
<span></span>
<span><span class="co"># The reference year of the weather station data is 1996, the median year of</span></span>
<span><span class="co"># the record, which runs from 1973 to 2019.</span></span>
<span></span>
<span><span class="co"># We could decide now to use fewer data. If we only use observations from 1981,</span></span>
<span><span class="co"># the median year of the observations becomes 2000 and it matches the reference</span></span>
<span><span class="co"># year of the future projections.</span></span>
<span></span>
<span><span class="co"># But maybe we really want to use the old data as well. For that case, chillR</span></span>
<span><span class="co"># offers a tool to adjust the reference year based on an analysis of the</span></span>
<span><span class="co"># temperature trends within the observed dataset.</span></span>
<span></span>
<span><span class="co"># If we want to adjust the baseline of the observed weather, we can conduct a</span></span>
<span><span class="co"># baseline adjustment. For this, we first need to find out how much warming (or</span></span>
<span><span class="co"># cooling) has occurred in Bonn between 1996 and 2000.</span></span>
<span></span>
<span><span class="co"># To do this we first determine typical temperature conditions in both years</span></span>
<span><span class="co"># using the temperature_scenario_from_records function.</span></span>
<span><span class="va">temps_1996</span> <span class="op">&lt;-</span> <span class="fu">temperature_scenario_from_records</span><span class="op">(</span><span class="va">Bonn_temps</span>, <span class="fl">1996</span><span class="op">)</span></span>
<span></span>
<span><span class="va">temps_2000</span> <span class="op">&lt;-</span> <span class="fu">temperature_scenario_from_records</span><span class="op">(</span><span class="va">Bonn_temps</span>, <span class="fl">2000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">temps_1996</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>$`1996`
$`1996`$data
          Tmin      Tmax
1   0.05096808  5.997514
2   0.30177644  7.789863
3   2.64832507 11.855124
4   4.11737331 14.884386
5   7.96058170 20.280445
6  10.70945702 22.325216
7  12.69138958 24.926619
8  12.59137274 25.079171
9   9.55441331 19.960842
10  6.40661969 14.768213
11  2.82059109  9.308959
12  0.59133654  6.103919

$`1996`$scenario_year
[1] 1996

$`1996`$reference_year
[1] NA

$`1996`$scenario_type
[1] "absolute"

$`1996`$labels
[1] "running mean scenario"</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb266"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">temps_2000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>$`2000`
$`2000`$data
          Tmin      Tmax
1   0.09999567  5.888243
2   0.49262403  7.189344
3   2.28327954 11.206499
4   4.71243331 15.764268
5   8.47223725 20.053640
6  11.06525924 22.935700
7  13.05258062 25.085306
8  12.50049711 24.345505
9  10.00307775 20.264008
10  6.84396341 15.241450
11  3.12942664  9.319114
12  0.75037488  6.036563

$`2000`$scenario_year
[1] 2000

$`2000`$reference_year
[1] NA

$`2000`$scenario_type
[1] "absolute"

$`2000`$labels
[1] "running mean scenario"</code></pre>
</div>
</div>
<p><br></p>
<ul>
<li><p>These are both absolute temperature scenarios, i.e.&nbsp;they describe typical conditions in 1996 and 2000.</p></li>
<li><p>From these, we can now compute a relative change scenario that describes the changes that occurred over this period with the <code>temperature_scenario_baseline_adjustment</code> function.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb268"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">base</span> <span class="op">&lt;-</span> <span class="fu">temperature_scenario_baseline_adjustment</span><span class="op">(</span><span class="va">temps_1996</span>, <span class="va">temps_2000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">base</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>$`2000`
$`2000`$data
          Tmin        Tmax
1   0.04902759 -0.10927019
2   0.19084759 -0.60051936
3  -0.36504552 -0.64862502
4   0.59506000  0.87988164
5   0.51165555 -0.22680567
6   0.35580222  0.61048386
7   0.36119103  0.15868680
8  -0.09087563 -0.73366588
9   0.44866444  0.30316609
10  0.43734372  0.47323734
11  0.30883555  0.01015498
12  0.15903835 -0.06735621

$`2000`$scenario_year
[1] 2000

$`2000`$reference_year
[1] 1996

$`2000`$scenario_type
[1] "relative"

$`2000`$labels
[1] "running mean scenario"</code></pre>
</div>
</div>
<p><br></p>
<ul>
<li><p>We can now apply this baseline correction to our climate scenarios.</p></li>
<li><p>For now, this only works with an unstructured list of scenarios, so we’ll have to convert the scenarios again using the <code>give_structure = FALSE</code> option.</p></li>
<li><p>Then, we can start the temperature generation process. Note that, since we have many scenarios, this can take hours.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb270"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">scen_list</span> <span class="op">&lt;-</span> <span class="fu">convert_scen_information</span><span class="op">(</span><span class="va">change_scenarios</span>, give_structure <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adjusted_list</span> <span class="op">&lt;-</span> <span class="fu">temperature_scenario_baseline_adjustment</span><span class="op">(</span><span class="va">base</span>, <span class="va">scen_list</span>, temperature_check_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>scenario_check_thresholds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,</span>
<span>    <span class="fl">15</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">scen</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">adjusted_list</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"data/Bonn/Bonn_future_climate/Bonn_future_"</span>, <span class="va">scen</span>, <span class="st">"_"</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">adjusted_list</span><span class="op">)</span><span class="op">[</span><span class="va">scen</span><span class="op">]</span>, <span class="st">".csv"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">temp_temp</span> <span class="op">&lt;-</span> <span class="fu">temperature_generation</span><span class="op">(</span><span class="va">Bonn_temps</span>, years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1973</span>, <span class="fl">2019</span><span class="op">)</span>, sim_years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2001</span>,</span>
<span>            <span class="fl">2100</span><span class="op">)</span>, <span class="va">adjusted_list</span><span class="op">[</span><span class="va">scen</span><span class="op">]</span>, temperature_check_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>scenario_check_thresholds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,</span>
<span>            <span class="fl">15</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">temp_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"data/Bonn/Bonn_future_climate/Bonn_future_"</span>,</span>
<span>            <span class="va">scen</span>, <span class="st">"_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">adjusted_list</span><span class="op">)</span><span class="op">[</span><span class="va">scen</span><span class="op">]</span>, <span class="st">".csv"</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Processed object"</span>, <span class="va">scen</span>, <span class="st">"of"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">adjusted_list</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co">## Temperature_generation function takes very long time and hard to know if it</span></span>
<span><span class="co">## is running or stuck already.  And you won't get results until the function</span></span>
<span><span class="co">## is finished running, so you will be left with nothing if computer crashes or</span></span>
<span><span class="co">## you abadon it half-way through.</span></span>
<span></span>
<span><span class="co">## So, better use the 'loop' option as shown above- that processes one scenario</span></span>
<span><span class="co">## at a time, saving the result after each run. You can even check if certain</span></span>
<span><span class="co">## scenarios have already been processed and only work on the remaining ones.</span></span>
<span><span class="co">## And you can output status messages that allow you to track the progress.</span></span>
<span></span>
<span><span class="co">## Option to use temperature-generation function temps &lt;-</span></span>
<span><span class="co">## temperature_generation( Bonn_temps, years = c(1973, 2019), sim_years =</span></span>
<span><span class="co">## c(2001, 2100), adjusted_list, temperature_check_args = list(</span></span>
<span><span class="co">## scenario_check_thresholds = c(-5, 15)))</span></span>
<span></span>
<span><span class="co"># save_temperature_scenarios(temps, 'data/future_climate', 'Bonn_futuretemps')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>Now we can calculate temperature responses based on these records by using the <code>tempResponse_daily_list</code> function— the Dynamic Model for chill accumulation, the GDH model for heat accumulation and a simple model to compute frost hours.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb271"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Make a simple model to compute frost hours</span></span>
<span><span class="va">frost_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">step_model</span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1000</span>, <span class="fl">0</span><span class="op">)</span>, upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,</span>
<span>    <span class="fl">1000</span><span class="op">)</span>, weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save the models as list</span></span>
<span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Chill_Portions <span class="op">=</span> <span class="va">Dynamic_Model</span>, GDH <span class="op">=</span> <span class="va">GDH</span>, Frost_H <span class="op">=</span> <span class="va">frost_model</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate temperature responses for chill accumulation and save output</span></span>
<span><span class="va">chill_future_scenario_list</span> <span class="op">&lt;-</span> <span class="fu">tempResponse_daily_list</span><span class="op">(</span><span class="va">temps</span>, latitude <span class="op">=</span> <span class="fl">50.8</span>, Start_JDay <span class="op">=</span> <span class="fl">305</span>,</span>
<span>    End_JDay <span class="op">=</span> <span class="fl">59</span>, models <span class="op">=</span> <span class="va">models</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Only select complete data</span></span>
<span><span class="va">chill_future_scenario_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">chill_future_scenario_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Perc_complete</span> <span class="op">==</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save future chill accumulation for Bonn</span></span>
<span><span class="fu">save_temperature_scenarios</span><span class="op">(</span><span class="va">chill_future_scenario_list</span>, <span class="st">"data/Bonn/Bonn_future_climate"</span>,</span>
<span>    <span class="st">"Bonn_futurechill"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># simulate for the observed record</span></span>
<span><span class="va">Bonn_temps</span> <span class="op">&lt;-</span> <span class="fu">read_tab</span><span class="op">(</span><span class="st">"data/Bonn/Bonn_temps.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">observed_chill</span> <span class="op">&lt;-</span> <span class="fu">tempResponse_daily_list</span><span class="op">(</span><span class="va">Bonn_temps</span>, latitude <span class="op">=</span> <span class="fl">50.8</span>, Start_JDay <span class="op">=</span> <span class="fl">305</span>,</span>
<span>    End_JDay <span class="op">=</span> <span class="fl">59</span>, models <span class="op">=</span> <span class="va">models</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">observed_chill</span>, <span class="st">"data/Bonn/Bonn_observed_chill_305_59.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li><p>In <code>chillR</code>, the most convenient way to plot all the data is to produce climate scenarios with the <code>make_climate_scenario</code> function. The plotting function then simply processes a list of such climate scenarios.</p></li>
<li><p>Let’s start with a historical scenario that contains both the distributions for historic years and the historically observed chill.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb272"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load the historical data saved in Historic Temperature Scenarios lesson</span></span>
<span><span class="va">chill_hist_scenario_list</span> <span class="op">&lt;-</span> <span class="fu">load_temperature_scenarios</span><span class="op">(</span><span class="st">"data/Bonn"</span>, <span class="st">"Bonn_hist_chill_305_59"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load the observed chill data</span></span>
<span><span class="va">observed_chill</span> <span class="op">&lt;-</span> <span class="fu">read_tab</span><span class="op">(</span><span class="st">"data/Bonn/Bonn_observed_chill_305_59.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Produce climate scenarios</span></span>
<span><span class="va">chills</span> <span class="op">&lt;-</span> <span class="fu">make_climate_scenario</span><span class="op">(</span><span class="va">chill_hist_scenario_list</span>, caption <span class="op">=</span> <span class="st">"Historical"</span>,</span>
<span>    historic_data <span class="op">=</span> <span class="va">observed_chill</span>, time_series <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot_climate_scenarios</span><span class="op">(</span>climate_scenario_list <span class="op">=</span> <span class="va">chills</span>, metric <span class="op">=</span> <span class="st">"Chill_Portions"</span>,</span>
<span>    metric_label <span class="op">=</span> <span class="st">"Chill (Chill Portions)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/16.1.4e-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "time series labels"</code></pre>
</div>
</div>
<p><br></p>
<ul>
<li><p>This function has two effects— itt produced a plot and it returned a short list containing the message “time series labels”.</p></li>
<li><p>If we want to just store this information rather than immediately displaying it in our output, we can assign the plotting command to a new object (as in <code>info &lt;- plot_climate_scenarios(...)</code>). The function will then just produce its side effect, which is the plot itself.</p></li>
<li><p>Now we run through the same process for all the future climate scenarios. For each one, we add the climate scenario to the <code>chills</code> object (<code>make_climate_scenario</code> has an argument <code>add_to</code>, where we can specify that).</p></li>
<li><p>As a preparatory step, we’ll have to identify the data that belong to specific combinations of SSP and Time.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb274"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load data</span></span>
<span><span class="va">chill_future_scenario_list</span> <span class="op">&lt;-</span> <span class="fu">load_temperature_scenarios</span><span class="op">(</span><span class="st">"data/Bonn/Bonn_future_climate"</span>,</span>
<span>    <span class="st">"Bonn_futurechill"</span><span class="op">)</span></span>
<span><span class="va">chill_hist_scenario_list</span> <span class="op">&lt;-</span> <span class="fu">load_temperature_scenarios</span><span class="op">(</span><span class="st">"data/Bonn/Bonn_future_climate"</span>,</span>
<span>    <span class="st">"Bonn_hist_chill_305_59"</span><span class="op">)</span></span>
<span><span class="va">observed_chill</span> <span class="op">&lt;-</span> <span class="fu">read_tab</span><span class="op">(</span><span class="st">"data/Bonn/Bonn_observed_chill_305_59.csv"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">SSPs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ssp126"</span>, <span class="st">"ssp245"</span>, <span class="st">"ssp370"</span>, <span class="st">"ssp585"</span><span class="op">)</span></span>
<span><span class="va">Times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2050</span>, <span class="fl">2085</span><span class="op">)</span></span>
<span></span>
<span><span class="va">list_ssp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chill_future_scenario_list</span><span class="op">)</span>, <span class="st">"\\."</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">map</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">list_gcm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chill_future_scenario_list</span><span class="op">)</span>, <span class="st">"\\."</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">map</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">list_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chill_future_scenario_list</span><span class="op">)</span>, <span class="st">"\\."</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">map</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">SSP</span> <span class="kw">in</span> <span class="va">SSPs</span><span class="op">)</span> <span class="kw">for</span> <span class="op">(</span><span class="va">Time</span> <span class="kw">in</span> <span class="va">Times</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="co"># find all scenarios for the ssp and time</span></span>
<span>    <span class="va">chill</span> <span class="op">&lt;-</span> <span class="va">chill_future_scenario_list</span><span class="op">[</span><span class="va">list_ssp</span> <span class="op">==</span> <span class="va">SSP</span> <span class="op">&amp;</span> <span class="va">list_time</span> <span class="op">==</span> <span class="va">Time</span><span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chill</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">list_gcm</span><span class="op">[</span><span class="va">list_ssp</span> <span class="op">==</span> <span class="va">SSP</span> <span class="op">&amp;</span> <span class="va">list_time</span> <span class="op">==</span> <span class="va">Time</span><span class="op">]</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp126"</span><span class="op">)</span></span>
<span>        <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP1"</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp245"</span><span class="op">)</span></span>
<span>        <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP2"</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp370"</span><span class="op">)</span></span>
<span>        <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP3"</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp585"</span><span class="op">)</span></span>
<span>        <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP5"</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">Time</span> <span class="op">==</span> <span class="st">"2050"</span><span class="op">)</span></span>
<span>        <span class="va">Time_caption</span> <span class="op">&lt;-</span> <span class="st">"2050"</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">Time</span> <span class="op">==</span> <span class="st">"2085"</span><span class="op">)</span></span>
<span>        <span class="va">Time_caption</span> <span class="op">&lt;-</span> <span class="st">"2085"</span></span>
<span>    <span class="va">chills</span> <span class="op">&lt;-</span> <span class="va">chill</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu">make_climate_scenario</span><span class="op">(</span>caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">SSPcaption</span>, <span class="va">Time_caption</span><span class="op">)</span>, add_to <span class="op">=</span> <span class="va">chills</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Now we have everything we need to plot the results of our climate change</span></span>
<span><span class="co">## analysis:</span></span>
<span></span>
<span><span class="co"># For Chill Accumulation in Klein-Altendorf</span></span>
<span><span class="va">info_chill</span> <span class="op">&lt;-</span> <span class="fu">plot_climate_scenarios</span><span class="op">(</span>climate_scenario_list <span class="op">=</span> <span class="va">chills</span>, metric <span class="op">=</span> <span class="st">"Chill_Portions"</span>,</span>
<span>    metric_label <span class="op">=</span> <span class="st">"Chill (Chill Portions)"</span>, texcex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/16.1.4f-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb275"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># For Heat Accumulation in Klein-Altendorf</span></span>
<span><span class="va">info_heat</span> <span class="op">&lt;-</span> <span class="fu">plot_climate_scenarios</span><span class="op">(</span>climate_scenario_list <span class="op">=</span> <span class="va">chills</span>, metric <span class="op">=</span> <span class="st">"GDH"</span>,</span>
<span>    metric_label <span class="op">=</span> <span class="st">"Heat (Growing Degree Hours)"</span>, texcex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/16.1.4f-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb276"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># For Frost hours in Klein-Altendorf</span></span>
<span><span class="va">info_frost</span> <span class="op">&lt;-</span> <span class="fu">plot_climate_scenarios</span><span class="op">(</span>climate_scenario_list <span class="op">=</span> <span class="va">chills</span>, metric <span class="op">=</span> <span class="st">"Frost_H"</span>,</span>
<span>    metric_label <span class="op">=</span> <span class="st">"Frost hours"</span>, texcex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/16.1.4f-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb277"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># As we saw earlier, the function didn’t only return the plot, but also some</span></span>
<span><span class="co"># supplementary information, which we stored in the `info...` objects in the</span></span>
<span><span class="co"># latest code chunk.</span></span>
<span></span>
<span><span class="co"># If you inspect these objects, you’ll see that they contain the names of the</span></span>
<span><span class="co"># climate models for each of the subplots (in addition to the time series</span></span>
<span><span class="co"># labels for the historic plot).</span></span>
<span></span>
<span><span class="co"># Since we used the same models each time, all information is listed multiple</span></span>
<span><span class="co"># times. Let’s only look at this once, and only for one of the plots:</span></span>
<span></span>
<span><span class="co"># These labels aren’t provided directly in the plot, because they would take up</span></span>
<span><span class="co"># quite a bit of space. Instead, each model is specified by a number, with the</span></span>
<span><span class="co"># key to these number codes given in this table.</span></span>
<span><span class="va">info_chill</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>   code            Label
1     1        CMCC-ESM2
2     2           MIROC6
3     3      FIO-ESM-2-0
4     4    CNRM-CM6-1-HR
5     5        INM-CM5-0
6     6            NESM3
7     7 EC-Earth3-Veg-LR
8     8        GFDL-ESM4
9     9    MPI-ESM1-2-LR
10   10      CNRM-ESM2-1
11   11     IPSL-CM6A-LR
12   12        FGOALS-g3
13   13        INM-CM4-8
14   14       MRI-ESM2-0
15   15       ACCESS-CM2
16   16    AWI-CM-1-1-MR</code></pre>
</div>
</div>
<p><br></p>
</section></section><section id="exercises-on-generating-cmip6-temperature-scenarios" class="level3"><h3 class="anchored" data-anchor-id="exercises-on-generating-cmip6-temperature-scenarios">
<span style="color:#71797E">16.2</span>&nbsp; Exercises on generating CMIP6 temperature scenarios</h3>
<div style="height: 18px;">

</div>
<p><strong><em>1. Analyze the historic and future impact of climate change on two agroclimatic metrics of your choice, for the location you’ve chosen for your earlier analyses.</em></strong></p>
<p>Codes for historic and future climatic scenarios for Mössigen:</p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb279"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va">chillR</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">MS_temps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/read_tab.html">read_tab</a></span><span class="op">(</span><span class="st">"data/MS/MS_patched_weather.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">location</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fl">48.4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">area</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">8</span>, <span class="fl">48</span>, <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/download_cmip6_ecmwfr.html">download_cmip6_ecmwfr</a></span><span class="op">(</span>scenarios <span class="op">=</span> <span class="st">"ssp126"</span>, area <span class="op">=</span> <span class="va">area</span>, user <span class="op">=</span> <span class="st">"cdc26d1b-d9e9-4552-9b32-e2b974562cee"</span>,</span>
<span>    key <span class="op">=</span> <span class="st">"1aee996e-75a8-48d2-b7e7-fe4aac7fc8df"</span>, model <span class="op">=</span> <span class="st">"default"</span>, frequency <span class="op">=</span> <span class="st">"monthly"</span>,</span>
<span>    variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tmin"</span>, <span class="st">"Tmax"</span><span class="op">)</span>, year_start <span class="op">=</span> <span class="fl">2015</span>, year_end <span class="op">=</span> <span class="fl">2100</span>, path_download <span class="op">=</span> <span class="st">"data/MS/MS_cmip6_downloaded"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/download_cmip6_ecmwfr.html">download_cmip6_ecmwfr</a></span><span class="op">(</span>scenarios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ssp126"</span>, <span class="st">"ssp245"</span>, <span class="st">"ssp370"</span>, <span class="st">"ssp585"</span><span class="op">)</span>, area <span class="op">=</span> <span class="va">area</span>,</span>
<span>    user <span class="op">=</span> <span class="st">"cdc26d1b-d9e9-4552-9b32-e2b974562cee"</span>, key <span class="op">=</span> <span class="st">"1aee996e-75a8-48d2-b7e7-fe4aac7fc8df"</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"default"</span>, frequency <span class="op">=</span> <span class="st">"monthly"</span>, variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tmin"</span>, <span class="st">"Tmax"</span><span class="op">)</span>, year_start <span class="op">=</span> <span class="fl">2015</span>,</span>
<span>    year_end <span class="op">=</span> <span class="fl">2100</span>, path_download <span class="op">=</span> <span class="st">"data/MS/MS_cmip6_downloaded"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">download_baseline_cmip6_ecmwfr2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">area</span>, <span class="va">model</span> <span class="op">=</span> <span class="st">"match_downloaded"</span>, <span class="va">service</span> <span class="op">=</span> <span class="st">"cds"</span>,</span>
<span>    <span class="va">frequency</span> <span class="op">=</span> <span class="st">"monthly"</span>, <span class="va">variable</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tmin"</span>, <span class="st">"Tmax"</span><span class="op">)</span>, <span class="va">year_start</span> <span class="op">=</span> <span class="fl">1990</span>, <span class="va">year_end</span> <span class="op">=</span> <span class="fl">2020</span>,</span>
<span>    <span class="va">month</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, <span class="va">sec_wait</span> <span class="op">=</span> <span class="fl">3600</span>, <span class="va">n_try</span> <span class="op">=</span> <span class="fl">10</span>, <span class="va">update_everything</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">path_download</span> <span class="op">=</span> <span class="st">"data/MS/MS_cmip6_downloaded"</span>,</span>
<span>    <span class="va">user</span> <span class="op">=</span> <span class="st">"ecmwfr"</span>, <span class="va">key</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">model</span> <span class="op">==</span> <span class="st">"match_downloaded"</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">path_download</span>, <span class="st">"/"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">area</span>, collapse <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span></span>
<span>            <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"There is no directory matching your arguments. Check if you really downloaded the \n           SSP scenarios and that you used the same area argument."</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">path_download</span>, <span class="st">"/"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">area</span>, collapse <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"The directory is empty. Please chekc if the \"path_download\" and the \"area\" \n           argument are correct"</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="co"># model &lt;- f %&gt;% strsplit('_') %&gt;% purrr::map(function(x)</span></span>
<span>        <span class="co"># paste(x[5:(length(x) - 5)], collapse = '_')) %&gt;% unique() %&gt;%</span></span>
<span>        <span class="co"># unlist()</span></span>
<span>        <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"(tmin_|tmax_|historical_|ssp1_2_6_|ssp2_4_5_|ssp3_7_0_|ssp5_8_5_|_monthly.+$|tas.+)"</span>,</span>
<span>            <span class="st">""</span>, <span class="va">f</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>            <span class="va">.</span><span class="op">[</span><span class="va">.</span> <span class="op">!=</span> <span class="st">""</span><span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/download_cmip6_ecmwfr.html">download_cmip6_ecmwfr</a></span><span class="op">(</span>scenarios <span class="op">=</span> <span class="st">"historical"</span>, area <span class="op">=</span> <span class="va">area</span>, model <span class="op">=</span> <span class="va">model</span>, service <span class="op">=</span> <span class="va">service</span>,</span>
<span>        frequency <span class="op">=</span> <span class="va">frequency</span>, variable <span class="op">=</span> <span class="va">variable</span>, year_start <span class="op">=</span> <span class="va">year_start</span>, year_end <span class="op">=</span> <span class="va">year_end</span>,</span>
<span>        month <span class="op">=</span> <span class="va">month</span>, sec_wait <span class="op">=</span> <span class="va">sec_wait</span>, n_try <span class="op">=</span> <span class="va">n_try</span>, update_everything <span class="op">=</span> <span class="va">update_everything</span>,</span>
<span>        path_download <span class="op">=</span> <span class="va">path_download</span>, user <span class="op">=</span> <span class="va">user</span>, key <span class="op">=</span> <span class="va">key</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="fu">download_baseline_cmip6_ecmwfr2</span><span class="op">(</span>area <span class="op">=</span> <span class="va">area</span>, user <span class="op">=</span> <span class="st">"cdc26d1b-d9e9-4552-9b32-e2b974562cee"</span>,</span>
<span>    key <span class="op">=</span> <span class="st">"1aee996e-75a8-48d2-b7e7-fe4aac7fc8df"</span>, model <span class="op">=</span> <span class="st">"match_downloaded"</span>, frequency <span class="op">=</span> <span class="st">"monthly"</span>,</span>
<span>    variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tmin"</span>, <span class="st">"Tmax"</span><span class="op">)</span>, year_start <span class="op">=</span> <span class="fl">1990</span>, year_end <span class="op">=</span> <span class="fl">2020</span>, month <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12</span>,</span>
<span>    path_download <span class="op">=</span> <span class="st">"data/MS/MS_cmip6_downloaded"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">station</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>station_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"MS"</span><span class="op">)</span>, longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">9</span><span class="op">)</span>, latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">48.4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">extracted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/extract_cmip6_data.html">extract_cmip6_data</a></span><span class="op">(</span>stations <span class="op">=</span> <span class="va">station</span>, download_path <span class="op">=</span> <span class="st">"data/MS/MS_cmip6_downloaded"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://cirrus.ucsd.edu/~pierce/ncdf/">ncdf4</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.r-project.org">PCICt</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># extracted &lt;- extract_cmip6_data(stations = station)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">extracted</span><span class="op">$</span><span class="va">`ssp126_AWI-CM-1-1-MR`</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">change_scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/gen_rel_change_scenario.html">gen_rel_change_scenario</a></span><span class="op">(</span><span class="va">extracted</span>, scenarios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2050</span>, <span class="fl">2085</span><span class="op">)</span>,</span>
<span>    reference_period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1990</span><span class="op">:</span><span class="fl">2020</span><span class="op">)</span>, future_window_width <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">change_scenarios</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">change_scenarios</span>, <span class="st">"data/MS/MS_all_change_scenarios.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">change_scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/MS/MS_all_change_scenarios.csv"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">scen_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/convert_scen_information.html">convert_scen_information</a></span><span class="op">(</span><span class="va">change_scenarios</span><span class="op">)</span></span>
<span></span>
<span><span class="va">scen_frame</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/convert_scen_information.html">convert_scen_information</a></span><span class="op">(</span><span class="va">scen_list</span><span class="op">)</span></span>
<span></span>
<span><span class="va">scen_list</span><span class="op">$</span><span class="va">MS</span><span class="op">$</span><span class="va">ssp126</span><span class="op">$</span><span class="va">`ACCESS-CM2`</span><span class="op">$</span><span class="st">"2050"</span></span>
<span></span>
<span></span>
<span><span class="va">MS_temps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/read_tab.html">read_tab</a></span><span class="op">(</span><span class="st">"data/MS/MS_patched_weather.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">temps_1990</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/temperature_scenario_from_records.html">temperature_scenario_from_records</a></span><span class="op">(</span><span class="va">MS_temps</span>, <span class="fl">1990</span><span class="op">)</span></span>
<span><span class="va">temps_2005</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/temperature_scenario_from_records.html">temperature_scenario_from_records</a></span><span class="op">(</span><span class="va">MS_temps</span>, <span class="fl">2005</span><span class="op">)</span></span>
<span><span class="va">temps_1990</span></span>
<span><span class="va">temps_2005</span></span>
<span></span>
<span></span>
<span><span class="va">base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/temperature_scenario_baseline_adjustment.html">temperature_scenario_baseline_adjustment</a></span><span class="op">(</span><span class="va">temps_1990</span>, <span class="va">temps_2005</span><span class="op">)</span></span>
<span></span>
<span><span class="va">base</span></span>
<span></span>
<span></span>
<span><span class="va">scen_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/convert_scen_information.html">convert_scen_information</a></span><span class="op">(</span><span class="va">change_scenarios</span>, give_structure <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adjusted_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/temperature_scenario_baseline_adjustment.html">temperature_scenario_baseline_adjustment</a></span><span class="op">(</span><span class="va">base</span>, <span class="va">scen_list</span>, temperature_check_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>scenario_check_thresholds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>,</span>
<span>    <span class="fl">15</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="st">"data/MS/MS_future_climate"</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">scen</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">adjusted_list</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"data/MS/MS_future_climate/MS_future_"</span>, <span class="va">scen</span>, <span class="st">"_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">adjusted_list</span><span class="op">)</span><span class="op">[</span><span class="va">scen</span><span class="op">]</span>,</span>
<span>        <span class="st">".csv"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">temp_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/temperature_generation.html">temperature_generation</a></span><span class="op">(</span><span class="va">MS_temps</span>, years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1990</span>, <span class="fl">2020</span><span class="op">)</span>, sim_years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2001</span>,</span>
<span>            <span class="fl">2100</span><span class="op">)</span>, <span class="va">adjusted_list</span><span class="op">[</span><span class="va">scen</span><span class="op">]</span>, temperature_check_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>scenario_check_thresholds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>,</span>
<span>            <span class="fl">15</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">temp_temp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"data/MS/MS_future_climate/MS_future_"</span>,</span>
<span>            <span class="va">scen</span>, <span class="st">"_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">adjusted_list</span><span class="op">)</span><span class="op">[</span><span class="va">scen</span><span class="op">]</span>, <span class="st">".csv"</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Processed object"</span>, <span class="va">scen</span>, <span class="st">"of"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">adjusted_list</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">temps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/load_temperature_scenarios.html">load_temperature_scenarios</a></span><span class="op">(</span><span class="st">"data/MS/MS_future_climate"</span>, <span class="st">"MS_future_"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># now we have temperature scenarios</span></span>
<span></span>
<span><span class="va">frost_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/step_model.html">step_model</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1000</span>, <span class="fl">0</span><span class="op">)</span>, upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,</span>
<span>    <span class="fl">1000</span><span class="op">)</span>, weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Chill_Portions <span class="op">=</span> <span class="va">Dynamic_Model</span>, GDH <span class="op">=</span> <span class="va">GDH</span>, Frost_H <span class="op">=</span> <span class="va">frost_model</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">chill_future_scenario_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/tempResponse_daily_list.html">tempResponse_daily_list</a></span><span class="op">(</span><span class="va">temps</span>, latitude <span class="op">=</span> <span class="fl">48.4</span>, Start_JDay <span class="op">=</span> <span class="fl">305</span>,</span>
<span>    End_JDay <span class="op">=</span> <span class="fl">59</span>, models <span class="op">=</span> <span class="va">models</span><span class="op">)</span></span>
<span></span>
<span><span class="va">chill_future_scenario_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">chill_future_scenario_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Perc_complete</span> <span class="op">==</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/save_temperature_scenarios.html">save_temperature_scenarios</a></span><span class="op">(</span><span class="va">chill_future_scenario_list</span>, <span class="st">"data/MS/MS_future_climate"</span>,</span>
<span>    <span class="st">"MS_futurechill"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># this would be for spring frost, but we're not running this</span></span>
<span><span class="va">chill_future_scenario_list_frost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/tempResponse_daily_list.html">tempResponse_daily_list</a></span><span class="op">(</span><span class="va">temps</span>, latitude <span class="op">=</span> <span class="fl">48.4</span>,</span>
<span>    Start_JDay <span class="op">=</span> <span class="fl">75</span>, End_JDay <span class="op">=</span> <span class="fl">120</span>, models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>GDH <span class="op">=</span> <span class="va">GDH</span>, Frost_H <span class="op">=</span> <span class="va">frost_model</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">chill_future_scenario_list_frost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">chill_future_scenario_list_frost</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Perc_complete</span> <span class="op">==</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/save_temperature_scenarios.html">save_temperature_scenarios</a></span><span class="op">(</span><span class="va">chill_future_scenario_list_frost</span>, <span class="st">"data/MS/MS_future_climate"</span>,</span>
<span>    <span class="st">"MS_futurefrost"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">observed_chill</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/tempResponse_daily_list.html">tempResponse_daily_list</a></span><span class="op">(</span><span class="va">MS_temps</span>, latitude <span class="op">=</span> <span class="fl">48.4</span>, Start_JDay <span class="op">=</span> <span class="fl">305</span>,</span>
<span>    End_JDay <span class="op">=</span> <span class="fl">59</span>, models <span class="op">=</span> <span class="va">models</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">observed_chill</span>, <span class="st">"data/MS/MS_observed_chill_305_59.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># simulate chill for historic scenarios</span></span>
<span></span>
<span><span class="va">hist_temps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/load_temperature_scenarios.html">load_temperature_scenarios</a></span><span class="op">(</span><span class="st">"data/MS"</span>, <span class="st">"MS_hist_scenarios"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">chill_hist_scenario_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/tempResponse_daily_list.html">tempResponse_daily_list</a></span><span class="op">(</span><span class="va">hist_temps</span>, latitude <span class="op">=</span> <span class="fl">48.4</span>,</span>
<span>    Start_JDay <span class="op">=</span> <span class="fl">305</span>, End_JDay <span class="op">=</span> <span class="fl">59</span>, models <span class="op">=</span> <span class="va">models</span><span class="op">)</span></span>
<span></span>
<span><span class="va">chill_hist_scenario_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">chill_hist_scenario_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Perc_complete</span> <span class="op">==</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/save_temperature_scenarios.html">save_temperature_scenarios</a></span><span class="op">(</span><span class="va">chill_hist_scenario_list</span>, <span class="st">"data/MS"</span>, <span class="st">"MS_hist_chill_305_59"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
<p>Plot the results for chill/heat accumulation and frost incidence: <em>(The question asked for two only, but I added all three because I just wanted to save them.)</em></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb280"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chill_future_scenario_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/load_temperature_scenarios.html">load_temperature_scenarios</a></span><span class="op">(</span><span class="st">"data/MS/MS_future_climate"</span>,</span>
<span>    <span class="st">"MS_futurechill"</span><span class="op">)</span></span>
<span><span class="va">chill_hist_scenario_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/load_temperature_scenarios.html">load_temperature_scenarios</a></span><span class="op">(</span><span class="st">"data/MS"</span>, <span class="st">"MS_hist_chill_305_59"</span><span class="op">)</span></span>
<span><span class="va">observed_chill</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/read_tab.html">read_tab</a></span><span class="op">(</span><span class="st">"data/MS/MS_observed_chill_305_59.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># prepare for plotting</span></span>
<span></span>
<span><span class="va">chills</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/make_climate_scenario.html">make_climate_scenario</a></span><span class="op">(</span>metric_summary <span class="op">=</span> <span class="va">chill_hist_scenario_list</span>, caption <span class="op">=</span> <span class="st">"Historical"</span>,</span>
<span>    historic_data <span class="op">=</span> <span class="va">observed_chill</span>, time_series <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/plot_climate_scenarios.html">plot_climate_scenarios</a></span><span class="op">(</span>climate_scenario_list <span class="op">=</span> <span class="va">chills</span>, metric <span class="op">=</span> <span class="st">"Chill_Portions"</span>,</span>
<span>    metric_label <span class="op">=</span> <span class="st">"Chill (Chill Portions)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/16.2b-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "time series labels"</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb282"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">list_ssp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chill_future_scenario_list</span><span class="op">)</span>, <span class="st">"\\."</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">list_gcm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chill_future_scenario_list</span><span class="op">)</span>, <span class="st">"\\."</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">list_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chill_future_scenario_list</span><span class="op">)</span>, <span class="st">"\\."</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">SSPs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ssp126"</span>, <span class="st">"ssp245"</span>, <span class="st">"ssp585"</span><span class="op">)</span></span>
<span><span class="va">Times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2050</span>, <span class="fl">2085</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">SSP</span> <span class="kw">in</span> <span class="va">SSPs</span><span class="op">)</span> <span class="kw">for</span> <span class="op">(</span><span class="va">Time</span> <span class="kw">in</span> <span class="va">Times</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="co"># find all scenarios for the ssp and time</span></span>
<span>    <span class="va">chill</span> <span class="op">&lt;-</span> <span class="va">chill_future_scenario_list</span><span class="op">[</span><span class="va">list_ssp</span> <span class="op">==</span> <span class="va">SSP</span> <span class="op">&amp;</span> <span class="va">list_time</span> <span class="op">==</span> <span class="va">Time</span><span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chill</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">list_gcm</span><span class="op">[</span><span class="va">list_ssp</span> <span class="op">==</span> <span class="va">SSP</span> <span class="op">&amp;</span> <span class="va">list_time</span> <span class="op">==</span> <span class="va">Time</span><span class="op">]</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp126"</span><span class="op">)</span></span>
<span>        <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP1"</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp245"</span><span class="op">)</span></span>
<span>        <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP2"</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp585"</span><span class="op">)</span></span>
<span>        <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP5"</span></span>
<span>    <span class="va">chills</span> <span class="op">&lt;-</span> <span class="va">chill</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/make_climate_scenario.html">make_climate_scenario</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">SSPcaption</span>, <span class="va">Time</span><span class="op">)</span>, add_to <span class="op">=</span> <span class="va">chills</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">info_chill</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/plot_climate_scenarios.html">plot_climate_scenarios</a></span><span class="op">(</span>climate_scenario_list <span class="op">=</span> <span class="va">chills</span>, metric <span class="op">=</span> <span class="st">"Chill_Portions"</span>,</span>
<span>    metric_label <span class="op">=</span> <span class="st">"Chill (Chill Portions)"</span>, texcex <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/16.2b-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb283"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">info_heat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/plot_climate_scenarios.html">plot_climate_scenarios</a></span><span class="op">(</span>climate_scenario_list <span class="op">=</span> <span class="va">chills</span>, metric <span class="op">=</span> <span class="st">"GDH"</span>,</span>
<span>    metric_label <span class="op">=</span> <span class="st">"Heat (Growing Degree Hours)"</span>, texcex <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/16.2b-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb284"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">info_frost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/plot_climate_scenarios.html">plot_climate_scenarios</a></span><span class="op">(</span>climate_scenario_list <span class="op">=</span> <span class="va">chills</span>, metric <span class="op">=</span> <span class="st">"Frost_H"</span>,</span>
<span>    metric_label <span class="op">=</span> <span class="st">"Frost incidence (hours)"</span>, texcex <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/16.2b-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong><em>To check/ add details later</em></strong></p>
<p><br></p>
</section></section><section id="chapter-18-plotting-future-scenarios" class="level2"><h2 class="anchored" data-anchor-id="chapter-18-plotting-future-scenarios">Chapter 18: Plotting future scenarios</h2>
<section id="making-attractive-plots" class="level3"><h3 class="anchored" data-anchor-id="making-attractive-plots">
<span style="color:#71797E">18.1</span>&nbsp; Making attractive plots</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>We produce similar plots to <code>plot_climate_scenarios</code> using <code>ggplot</code>.</p></li>
<li><p>We’ll be building on our previous work, so we’ll have to load the outputs we produced in chapters <strong>Historic temperature scenarios</strong> and <strong>Making CMIP6 scenarios</strong> now.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb285"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># library(kableExtra) library(chillR) library(tidyverse) library(ggpmisc)</span></span>
<span><span class="co"># library(patchwork)</span></span>
<span></span>
<span><span class="va">chill_hist_scenario_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/load_temperature_scenarios.html">load_temperature_scenarios</a></span><span class="op">(</span><span class="st">"data/Bonn"</span>, <span class="st">"Bonn_hist_chill_305_59"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">actual_chill</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/read_tab.html">read_tab</a></span><span class="op">(</span><span class="st">"data/Bonn/Bonn_observed_chill_305_59.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">chill_future_scenario_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/load_temperature_scenarios.html">load_temperature_scenarios</a></span><span class="op">(</span><span class="st">"data/Bonn/Bonn_future_climate"</span>,</span>
<span>    <span class="st">"Bonn_futurechill"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">chills</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/make_climate_scenario.html">make_climate_scenario</a></span><span class="op">(</span><span class="va">chill_hist_scenario_list</span>, caption <span class="op">=</span> <span class="st">"Historic"</span>, historic_data <span class="op">=</span> <span class="va">actual_chill</span>,</span>
<span>    time_series <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">SSPs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ssp126"</span>, <span class="st">"ssp245"</span>, <span class="st">"ssp370"</span>, <span class="st">"ssp585"</span><span class="op">)</span></span>
<span><span class="va">Times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2050</span>, <span class="fl">2085</span><span class="op">)</span></span>
<span></span>
<span><span class="va">list_ssp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chill_future_scenario_list</span><span class="op">)</span>, <span class="st">"\\."</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">list_gcm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chill_future_scenario_list</span><span class="op">)</span>, <span class="st">"\\."</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">list_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chill_future_scenario_list</span><span class="op">)</span>, <span class="st">"\\."</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">SSP</span> <span class="kw">in</span> <span class="va">SSPs</span><span class="op">)</span> <span class="kw">for</span> <span class="op">(</span><span class="va">Time</span> <span class="kw">in</span> <span class="va">Times</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="co"># find all scenarios for the ssp and time</span></span>
<span>    <span class="va">chill</span> <span class="op">&lt;-</span> <span class="va">chill_future_scenario_list</span><span class="op">[</span><span class="va">list_ssp</span> <span class="op">==</span> <span class="va">SSP</span> <span class="op">&amp;</span> <span class="va">list_time</span> <span class="op">==</span> <span class="va">Time</span><span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chill</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">list_gcm</span><span class="op">[</span><span class="va">list_ssp</span> <span class="op">==</span> <span class="va">SSP</span> <span class="op">&amp;</span> <span class="va">list_time</span> <span class="op">==</span> <span class="va">Time</span><span class="op">]</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp126"</span><span class="op">)</span></span>
<span>        <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP1"</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp245"</span><span class="op">)</span></span>
<span>        <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP2"</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp370"</span><span class="op">)</span></span>
<span>        <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP3"</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp585"</span><span class="op">)</span></span>
<span>        <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP5"</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">Time</span> <span class="op">==</span> <span class="st">"2050"</span><span class="op">)</span></span>
<span>        <span class="va">Time_caption</span> <span class="op">&lt;-</span> <span class="st">"2050"</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">Time</span> <span class="op">==</span> <span class="st">"2085"</span><span class="op">)</span></span>
<span>        <span class="va">Time_caption</span> <span class="op">&lt;-</span> <span class="st">"2085"</span></span>
<span>    <span class="va">chills</span> <span class="op">&lt;-</span> <span class="va">chill</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/make_climate_scenario.html">make_climate_scenario</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">SSPcaption</span>, <span class="va">Time_caption</span><span class="op">)</span>, add_to <span class="op">=</span> <span class="va">chills</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li><p><code>ggplot</code> works best with all data arranged in a single <code>data.frame</code> rather than the kind of list we’ve stored our projection data in.</p></li>
<li><p>Each row of this <code>data.frame</code> should contain information about the GCM, the SSP and the Year.</p></li>
<li><p>This is most easily done by looping through the elements of our chill projection list, extracting the needed information and assembling it in a new, long <code>data.frame</code>.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb286"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># We'll first process the past scenarios (element 1 of the chills list).</span></span>
<span><span class="co"># Within the data element, we have a list of multiple data.frames for the</span></span>
<span><span class="co"># various past scenarios.  Using a 'for' loop, we cycle through all these</span></span>
<span><span class="co"># data.frames.</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">nam</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chills</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Extract the data frame.</span></span>
<span>    <span class="va">ch</span> <span class="op">&lt;-</span> <span class="va">chills</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="va">nam</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="co"># Add columns for the new information we have to add and fill them.</span></span>
<span>    <span class="va">ch</span><span class="op">[</span>, <span class="st">"GCM"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"none"</span></span>
<span>    <span class="va">ch</span><span class="op">[</span>, <span class="st">"SSP"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"none"</span></span>
<span>    <span class="va">ch</span><span class="op">[</span>, <span class="st">"Year"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nam</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Now check if this is the first time we've gone through this loop.  If</span></span>
<span>    <span class="co"># this is the first time, the ch data.frame becomes the output object</span></span>
<span>    <span class="co"># (past_simulated).  If it is not the first time ('else'), we add the</span></span>
<span>    <span class="co"># current data.frame to the 'past_simulated' object</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">nam</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chills</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">past_simulated</span> <span class="op">&lt;-</span> <span class="va">ch</span> <span class="kw">else</span> <span class="va">past_simulated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">past_simulated</span>, <span class="va">ch</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># We add another column called 'Scenario' and label all rows as 'Historical'</span></span>
<span><span class="va">past_simulated</span><span class="op">[</span><span class="st">"Scenario"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Historical"</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">past_simulated</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Chill_Portions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">GDH</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Frost_H</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">GCM</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">SSP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Scenario</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2001/2002</td>
<td style="text-align: right;">2002</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">82.62388</td>
<td style="text-align: right;">3099.856</td>
<td style="text-align: right;">724</td>
<td style="text-align: left;">none</td>
<td style="text-align: left;">none</td>
<td style="text-align: right;">1980</td>
<td style="text-align: left;">Historical</td>
</tr>
<tr class="even">
<td style="text-align: left;">2002/2003</td>
<td style="text-align: right;">2003</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">79.13095</td>
<td style="text-align: right;">2621.100</td>
<td style="text-align: right;">749</td>
<td style="text-align: left;">none</td>
<td style="text-align: left;">none</td>
<td style="text-align: right;">1980</td>
<td style="text-align: left;">Historical</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2003/2004</td>
<td style="text-align: right;">2004</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">76.80924</td>
<td style="text-align: right;">1126.925</td>
<td style="text-align: right;">1034</td>
<td style="text-align: left;">none</td>
<td style="text-align: left;">none</td>
<td style="text-align: right;">1980</td>
<td style="text-align: left;">Historical</td>
</tr>
<tr class="even">
<td style="text-align: left;">2004/2005</td>
<td style="text-align: right;">2005</td>
<td style="text-align: right;">121</td>
<td style="text-align: right;">121</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">81.84015</td>
<td style="text-align: right;">1756.094</td>
<td style="text-align: right;">734</td>
<td style="text-align: left;">none</td>
<td style="text-align: left;">none</td>
<td style="text-align: right;">1980</td>
<td style="text-align: left;">Historical</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2005/2006</td>
<td style="text-align: right;">2006</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">84.92486</td>
<td style="text-align: right;">2710.869</td>
<td style="text-align: right;">548</td>
<td style="text-align: left;">none</td>
<td style="text-align: left;">none</td>
<td style="text-align: right;">1980</td>
<td style="text-align: left;">Historical</td>
</tr>
<tr class="even">
<td style="text-align: left;">2006/2007</td>
<td style="text-align: right;">2007</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">80.88391</td>
<td style="text-align: right;">2253.574</td>
<td style="text-align: right;">728</td>
<td style="text-align: left;">none</td>
<td style="text-align: left;">none</td>
<td style="text-align: right;">1980</td>
<td style="text-align: left;">Historical</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb287"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># We'll want to add the historic observation too, so let's simplify the pointer</span></span>
<span><span class="co"># to this information for easier use later</span></span>
<span><span class="va">past_observed</span> <span class="op">&lt;-</span> <span class="va">chills</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"historic_data"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">past_observed</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Interpolated_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Chill_Portions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">GDH</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Frost_H</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1973/1974</td>
<td style="text-align: right;">1974</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">85.34065</td>
<td style="text-align: right;">2166.376</td>
<td style="text-align: right;">498</td>
</tr>
<tr class="even">
<td style="text-align: left;">1975/1976</td>
<td style="text-align: right;">1976</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">81.50011</td>
<td style="text-align: right;">1831.580</td>
<td style="text-align: right;">711</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1976/1977</td>
<td style="text-align: right;">1977</td>
<td style="text-align: right;">121</td>
<td style="text-align: right;">121</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">83.37374</td>
<td style="text-align: right;">1892.026</td>
<td style="text-align: right;">741</td>
</tr>
<tr class="even">
<td style="text-align: left;">1977/1978</td>
<td style="text-align: right;">1978</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">78.15125</td>
<td style="text-align: right;">2653.059</td>
<td style="text-align: right;">830</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1978/1979</td>
<td style="text-align: right;">1979</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">67.29434</td>
<td style="text-align: right;">1428.630</td>
<td style="text-align: right;">1376</td>
</tr>
<tr class="even">
<td style="text-align: left;">1979/1980</td>
<td style="text-align: right;">1980</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">82.00353</td>
<td style="text-align: right;">2356.143</td>
<td style="text-align: right;">702</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb288"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Now we do the same thing for future data Extract future data</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">chills</span><span class="op">)</span><span class="op">)</span> <span class="kw">for</span> <span class="op">(</span><span class="va">nam</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chills</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ch</span> <span class="op">&lt;-</span> <span class="va">chills</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="va">nam</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="va">ch</span><span class="op">[</span>, <span class="st">"GCM"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">nam</span></span>
<span>    <span class="va">ch</span><span class="op">[</span>, <span class="st">"SSP"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">chills</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">caption</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">ch</span><span class="op">[</span>, <span class="st">"Year"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">chills</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">caption</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="va">nam</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chills</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">future_data</span> <span class="op">&lt;-</span> <span class="va">ch</span> <span class="kw">else</span> <span class="va">future_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">future_data</span>, <span class="va">ch</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">future_data</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Chill_Portions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">GDH</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Frost_H</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">GCM</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">SSP</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2001/2002</td>
<td style="text-align: right;">2002</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">77.39646</td>
<td style="text-align: right;">3489.132</td>
<td style="text-align: right;">819</td>
<td style="text-align: left;">CMCC-ESM2</td>
<td style="text-align: left;">SSP1</td>
<td style="text-align: left;">2050</td>
</tr>
<tr class="even">
<td style="text-align: left;">2002/2003</td>
<td style="text-align: right;">2003</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">83.52480</td>
<td style="text-align: right;">3780.804</td>
<td style="text-align: right;">523</td>
<td style="text-align: left;">CMCC-ESM2</td>
<td style="text-align: left;">SSP1</td>
<td style="text-align: left;">2050</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2003/2004</td>
<td style="text-align: right;">2004</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">77.89400</td>
<td style="text-align: right;">6264.478</td>
<td style="text-align: right;">485</td>
<td style="text-align: left;">CMCC-ESM2</td>
<td style="text-align: left;">SSP1</td>
<td style="text-align: left;">2050</td>
</tr>
<tr class="even">
<td style="text-align: left;">2004/2005</td>
<td style="text-align: right;">2005</td>
<td style="text-align: right;">121</td>
<td style="text-align: right;">121</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">80.07147</td>
<td style="text-align: right;">4156.717</td>
<td style="text-align: right;">586</td>
<td style="text-align: left;">CMCC-ESM2</td>
<td style="text-align: left;">SSP1</td>
<td style="text-align: left;">2050</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2005/2006</td>
<td style="text-align: right;">2006</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">74.89679</td>
<td style="text-align: right;">3794.348</td>
<td style="text-align: right;">921</td>
<td style="text-align: left;">CMCC-ESM2</td>
<td style="text-align: left;">SSP1</td>
<td style="text-align: left;">2050</td>
</tr>
<tr class="even">
<td style="text-align: left;">2006/2007</td>
<td style="text-align: right;">2007</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">80.48275</td>
<td style="text-align: right;">4527.710</td>
<td style="text-align: right;">563</td>
<td style="text-align: left;">CMCC-ESM2</td>
<td style="text-align: left;">SSP1</td>
<td style="text-align: left;">2050</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<ul>
<li><p>Now our data are in a format that ggplot should be able to work with. We have three metrics in our dataset: <code>Chill_Portions</code>, <code>GDH</code> and <code>Frost_H</code>. We’re not going to write an actual function now (though we probably should), but the code should be flexible enough to allow plotting all three metrics without major adjustments. So I’m defining a variable <code>metric</code>, and a variable <code>axis_label</code> that we can easily adjust later.</p></li>
<li><p>The complex plot we’re going to produce is difficult (or even impossible) to make as a single <code>ggplot</code> plot, but this is no problem, because we can assemble multiple plots into a compound figure later. Here we’ll do this with the <code>plot_layout</code> function of the <code>patchwork</code> package. One problem that arises when we combine figures from multiple plots and we want to use common axes (the y-axis in this case) is that these axes may not be similar. The data in the various plots may span different ranges, so that the automatic selection of reasonable axis settings may lead to different results. Here, we’ll use the <code>range</code> function to identify reasonable axis extents that work across all plots.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb289"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Define variables `metric` and `axis_label` to easily adjust later</span></span>
<span><span class="va">metric</span> <span class="op">&lt;-</span> <span class="st">"GDH"</span></span>
<span><span class="va">axis_label</span> <span class="op">&lt;-</span> <span class="st">"Heat (in GDH)"</span></span>
<span></span>
<span><span class="co">## get extreme values for the axis scale range returns a vector containing the</span></span>
<span><span class="co">## minimum and maximum of all the given arguments.</span></span>
<span><span class="va">rng</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">past_observed</span><span class="op">[[</span><span class="va">metric</span><span class="op">]</span><span class="op">]</span>, <span class="va">past_simulated</span><span class="op">[[</span><span class="va">metric</span><span class="op">]</span><span class="op">]</span>, <span class="va">future_data</span><span class="op">[[</span><span class="va">metric</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">rng</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1]   745.3968 19539.2353</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb291"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Now we’re ready for our first plot. We’ll start with the past scenarios:</span></span>
<span><span class="va">past_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">past_simulated</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span><span class="op">(</span><span class="st">"as.numeric(Year)"</span>,</span>
<span>    <span class="va">metric</span>, group <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"skyblue"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">past_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/18.1c-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li><p>You’ll have noticed that in many places in <code>ggplot</code> commands, we can simply write the names of the variables we want to use (as in <code>group=Year</code>). This is a bit unusual, because normally in R we have to place such strings in quotation marks. Otherwise, R thinks these are variable names and— if no such variable is defined— we get an error message.</p></li>
<li><p>This requirement is no more, and it sure makes life easier, until you’re trying to use actual variable names in a <code>ggplot2</code> call. Then we’d actually like to have the distinction between strings and variable names back. Well, we can get it back by using the <code>aes_string</code> command instead of <code>aes</code>, as you can see in the call above.</p></li>
<li><p>As I said earlier, we need to make sure that the y-axis can accommodate not only the data in this plot, but also all future scenarios. We can use the <code>rng</code> range we produced before. I’ll also adjust the axis labels (including for the y axis the customized <code>axis_label</code> we made above):</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb292"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">past_plot</span> <span class="op">&lt;-</span> <span class="va">past_plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">rng</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">rng</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="va">axis_label</span><span class="op">)</span></span>
<span></span>
<span><span class="va">past_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/18.1d-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li><p>Now we already have a fine plot of the past scenarios, but to make sure it is formatted in a similar way as the future data, we still need some adjustments.</p></li>
<li><p>Here we only have one plot, but for the future scenarios, we’ll produce multiple plots, once again using the <code>facet_wrap</code> function. This will automatically add some design elements to our plot.</p></li>
<li><p>To ensure we have a consistent layout for the whole figure, we therefore also make this single plot into a facet. We’ll also choose our black and white theme again:</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb293"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">past_plot</span> <span class="op">&lt;-</span> <span class="va">past_plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">Scenario</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="va">past_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/18.1e-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li>Finally, some finishing touches, related to the facet title (make background disappear and text bold) and the x-axis text (place at an angle, so that all year labels can be displayed properly, even when we change the text size).</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb294"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">past_plot</span> <span class="op">&lt;-</span> <span class="va">past_plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">past_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/18.1f-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li>This is our plot of past scenarios. Now let’s add the actual observations. I’ll make them blue, so that they can be distinguished from the outliers in the <code>box_plots</code>. That one is fairly straightforward:</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb295"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># add historic data</span></span>
<span><span class="va">past_plot</span> <span class="op">&lt;-</span> <span class="va">past_plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">past_observed</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span><span class="op">(</span><span class="st">"End_year"</span>,</span>
<span>    <span class="va">metric</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">past_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/18.1g-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li><p>Now we have what we needed for the past. The plots for the future an be produced in a largely similar way.</p></li>
<li><p>To organize things properly, we’ll produce one plot for the two scenarios for 2050 first, and then another one for 2085. Then we can display them as two groups of two plots each.</p></li>
<li><p>I’ll save these two plots in a list. This wouldn’t really be necessary here, but such a structure would allow us to later add more scenarios, should that seem desirable. Before making the plots in such a list structure, let’s first see one being assembled. We’ll start with the year (<code>y</code>) 2050</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb296"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">2050</span></span>
<span></span>
<span><span class="va">future_2050</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">future_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">future_data</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="va">y</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span><span class="op">(</span><span class="st">"GCM"</span>,</span>
<span>    <span class="va">metric</span>, fill <span class="op">=</span> <span class="st">"GCM"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">future_2050</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/18.1h-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li>So far, we have all SSPs mixed together here. We also can’t read anything on the y-axis. That’s no big deal, because the same information is contained in the color scheme, but it sure looks ugly.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb297"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Add a bit of padding on the side of the plots (with the expand parameter), </span></span>
<span><span class="co"># to ensure that the plot doesn’t look too crowded</span></span>
<span><span class="va">future_2050</span> <span class="op">&lt;-</span> <span class="va">future_2050</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">SSP</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="co"># arrange panels in single row</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>                    expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span>add <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co"># add 1unit to both ends of x</span></span>
<span></span>
<span><span class="co"># Also here, we need to adjust the axis limits, so that the future plots can use</span></span>
<span><span class="co"># the same axis as the past plots. </span></span>
<span><span class="co"># Use the geom_text_npc function from the ggpmisc package to add scenario year </span></span>
<span><span class="co"># to the plots.</span></span>
<span><span class="va">future_2050</span> <span class="op">&lt;-</span> <span class="va">future_2050</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, </span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">1.1</span><span class="op">*</span><span class="va">rng</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># why double round?</span></span>
<span>    <span class="fu">geom_text_npc</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>npcx <span class="op">=</span> <span class="st">"center"</span>, </span>
<span>                      npcy <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>                      label <span class="op">=</span> <span class="va">Year</span><span class="op">)</span>,</span>
<span>                  size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">future_2050</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/18.1i-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li><p>Finally, some cosmetics: we again choose the black and white theme, and we’ll remove all axis text and titles (they don’t add much, and they make the figure look crowded).</p></li>
<li><p>We’ll also remove the y-axis ticks. We then want the legend at the bottom and format the facet title the same way as for the past plot.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb298"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">future_2050</span> <span class="op">&lt;-</span> <span class="va">future_2050</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    legend.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="st">"cm"</span><span class="op">)</span>, legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    legend.box.spacing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"cm"</span><span class="op">)</span>, plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>        vjust <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, size <span class="op">=</span> <span class="fl">15</span> <span class="op">*</span> <span class="fl">1.05</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">future_2050</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/18.1j-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li>Now let’s implement the same procedure in a loop, where we make a list of two plots— one for 2050 and one for 2085:</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb299"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">future_plot_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">time_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2050</span>, <span class="fl">2085</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">y</span> <span class="kw">in</span> <span class="va">time_points</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">future_plot_list</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">y</span> <span class="op">==</span> <span class="va">time_points</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">future_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">future_data</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span></span>
<span>        <span class="va">y</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span><span class="op">(</span><span class="st">"GCM"</span>, <span class="va">metric</span>, fill <span class="op">=</span> <span class="st">"GCM"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">SSP</span><span class="op">)</span>,</span>
<span>        nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="cn">NULL</span>, expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span>add <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">1.1</span> <span class="op">*</span> <span class="va">rng</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_text_npc</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>npcx <span class="op">=</span> <span class="st">"center"</span>,</span>
<span>        npcy <span class="op">=</span> <span class="st">"top"</span>, label <span class="op">=</span> <span class="va">Year</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        legend.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="st">"cm"</span><span class="op">)</span>, legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>        legend.box.spacing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"cm"</span><span class="op">)</span>, plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>            vjust <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, size <span class="op">=</span> <span class="fl">15</span> <span class="op">*</span> <span class="fl">1.05</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">future_plot_list</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[[1]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/18.1k-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[2]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/18.1k-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb302"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Put the two plots together using + sign</span></span>
<span><span class="va">both_plots</span> <span class="op">&lt;-</span> <span class="va">past_plot</span> <span class="op">+</span> <span class="va">future_plot_list</span></span>
<span></span>
<span><span class="va">both_plots</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/18.1k-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li><p>All the basics are there, but we need a few adjustments, mainly to the legend.</p></li>
<li><p>For this, we use the <code>plot_layout</code> function of the <a href="https://cran.r-project.org/web/packages/patchwork/patchwork.pdf"><code>patchwork</code></a> package.</p></li>
<li><p>This supports the production of such patchwork figures, e.g.&nbsp;by collecting all legends and removing duplicates. This is handy, because we only want one version of the legend drawn.</p></li>
<li><p>We can also specify the width of the various plots. I’m making a vector <code>c(1,1.8,1.8)</code> (using a slightly more flexible formulation) to specify that the width of each set of future plots should be 1.8 times the width of the past scenario plot</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb303"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">both_plots</span> <span class="op">+</span> <span class="fu">plot_layout</span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span>, widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">future_plot_list</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now we can’t really see the plot any more, so let’s place the legend at the</span></span>
<span><span class="co"># bottom. For some reason that probably has to do with the `patchwork` package,</span></span>
<span><span class="co"># we have to add the corresponding `theme` call after an `&amp;` symbol.</span></span>
<span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">plot</span> <span class="op">&amp;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section><section id="the-results" class="level3"><h3 class="anchored" data-anchor-id="the-results">
<span style="color:#71797E">18.2</span>&nbsp; The results</h3>
<div style="height: 18px;">

</div>
<ul>
<li>Now we have some fairly nice ggplot figures showing a heat analysis for Bonn:</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb304"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/18.2a-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li>Do the same for the Chill model, by changing the <code>metric</code> and <code>axis_label</code>.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb305"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Define variables `metric` and `axis_label` to easily adjust later</span></span>
<span><span class="va">metric</span> <span class="op">&lt;-</span> <span class="st">"Chill_Portions"</span></span>
<span><span class="va">axis_label</span> <span class="op">&lt;-</span> <span class="st">"Chill (in CP)"</span></span>
<span></span>
<span><span class="co">## get extreme values for the axis scale range returns a vector containing the</span></span>
<span><span class="co">## minimum and maximum of all the given arguments.</span></span>
<span><span class="va">rng</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">past_observed</span><span class="op">[[</span><span class="va">metric</span><span class="op">]</span><span class="op">]</span>, <span class="va">past_simulated</span><span class="op">[[</span><span class="va">metric</span><span class="op">]</span><span class="op">]</span>, <span class="va">future_data</span><span class="op">[[</span><span class="va">metric</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Past plot</span></span>
<span><span class="va">past_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">past_simulated</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span><span class="op">(</span><span class="st">"as.numeric(Year)"</span>,</span>
<span>    <span class="va">metric</span>, group <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"skyblue"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">rng</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">rng</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="va">axis_label</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">Scenario</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">past_observed</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span><span class="op">(</span><span class="st">"End_year"</span>, <span class="va">metric</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Future plots</span></span>
<span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">2050</span></span>
<span></span>
<span><span class="va">future_2050</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">future_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">future_data</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="va">y</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span><span class="op">(</span><span class="st">"GCM"</span>,</span>
<span>    <span class="va">metric</span>, fill <span class="op">=</span> <span class="st">"GCM"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">SSP</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span>add <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">1.1</span> <span class="op">*</span></span>
<span>    <span class="va">rng</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_text_npc</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>npcx <span class="op">=</span> <span class="st">"center"</span>, npcy <span class="op">=</span> <span class="st">"top"</span>, label <span class="op">=</span> <span class="va">Year</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    legend.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="st">"cm"</span><span class="op">)</span>, legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    legend.box.spacing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"cm"</span><span class="op">)</span>, plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>        vjust <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, size <span class="op">=</span> <span class="fl">15</span> <span class="op">*</span> <span class="fl">1.05</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">future_plot_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">time_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2050</span>, <span class="fl">2085</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">y</span> <span class="kw">in</span> <span class="va">time_points</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">future_plot_list</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">y</span> <span class="op">==</span> <span class="va">time_points</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">future_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">future_data</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span></span>
<span>        <span class="va">y</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span><span class="op">(</span><span class="st">"GCM"</span>, <span class="va">metric</span>, fill <span class="op">=</span> <span class="st">"GCM"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">SSP</span><span class="op">)</span>,</span>
<span>        nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="cn">NULL</span>, expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span>add <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">1.1</span> <span class="op">*</span> <span class="va">rng</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_text_npc</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>npcx <span class="op">=</span> <span class="st">"center"</span>,</span>
<span>        npcy <span class="op">=</span> <span class="st">"top"</span>, label <span class="op">=</span> <span class="va">Year</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        legend.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="st">"cm"</span><span class="op">)</span>, legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>        legend.box.spacing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"cm"</span><span class="op">)</span>, plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>            vjust <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, size <span class="op">=</span> <span class="fl">15</span> <span class="op">*</span> <span class="fl">1.05</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">both_plots</span> <span class="op">&lt;-</span> <span class="va">past_plot</span> <span class="op">+</span> <span class="va">future_plot_list</span></span>
<span></span>
<span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">both_plots</span> <span class="op">+</span> <span class="fu">plot_layout</span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span>, widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">future_plot_list</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">plot</span> <span class="op">&amp;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/18.2b-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li>Plot the Frost duration:</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb306"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Define variables `metric` and `axis_label` to easily adjust later</span></span>
<span><span class="va">metric</span> <span class="op">&lt;-</span> <span class="st">"Frost_H"</span></span>
<span><span class="va">axis_label</span> <span class="op">&lt;-</span> <span class="st">"Frost duration (in hours)"</span></span>
<span></span>
<span><span class="co">## get extreme values for the axis scale range returns a vector containing the</span></span>
<span><span class="co">## minimum and maximum of all the given arguments.</span></span>
<span><span class="va">rng</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">past_observed</span><span class="op">[[</span><span class="va">metric</span><span class="op">]</span><span class="op">]</span>, <span class="va">past_simulated</span><span class="op">[[</span><span class="va">metric</span><span class="op">]</span><span class="op">]</span>, <span class="va">future_data</span><span class="op">[[</span><span class="va">metric</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Past plot</span></span>
<span><span class="va">past_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">past_simulated</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span><span class="op">(</span><span class="st">"as.numeric(Year)"</span>,</span>
<span>    <span class="va">metric</span>, group <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"skyblue"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">rng</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">rng</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="va">axis_label</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">Scenario</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">past_observed</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span><span class="op">(</span><span class="st">"End_year"</span>, <span class="va">metric</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Future plots</span></span>
<span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">2050</span></span>
<span></span>
<span><span class="va">future_2050</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">future_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">future_data</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="va">y</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span><span class="op">(</span><span class="st">"GCM"</span>,</span>
<span>    <span class="va">metric</span>, fill <span class="op">=</span> <span class="st">"GCM"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">SSP</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span>add <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">1.1</span> <span class="op">*</span></span>
<span>    <span class="va">rng</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_text_npc</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>npcx <span class="op">=</span> <span class="st">"center"</span>, npcy <span class="op">=</span> <span class="st">"top"</span>, label <span class="op">=</span> <span class="va">Year</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    legend.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="st">"cm"</span><span class="op">)</span>, legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    legend.box.spacing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"cm"</span><span class="op">)</span>, plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>        vjust <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, size <span class="op">=</span> <span class="fl">15</span> <span class="op">*</span> <span class="fl">1.05</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">future_plot_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">time_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2050</span>, <span class="fl">2085</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">y</span> <span class="kw">in</span> <span class="va">time_points</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">future_plot_list</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">y</span> <span class="op">==</span> <span class="va">time_points</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">future_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">future_data</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span></span>
<span>        <span class="va">y</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span><span class="op">(</span><span class="st">"GCM"</span>, <span class="va">metric</span>, fill <span class="op">=</span> <span class="st">"GCM"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">SSP</span><span class="op">)</span>,</span>
<span>        nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="cn">NULL</span>, expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span>add <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">1.1</span> <span class="op">*</span> <span class="va">rng</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_text_npc</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>npcx <span class="op">=</span> <span class="st">"center"</span>,</span>
<span>        npcy <span class="op">=</span> <span class="st">"top"</span>, label <span class="op">=</span> <span class="va">Year</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        legend.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="st">"cm"</span><span class="op">)</span>, legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>        legend.box.spacing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"cm"</span><span class="op">)</span>, plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>            vjust <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, size <span class="op">=</span> <span class="fl">15</span> <span class="op">*</span> <span class="fl">1.05</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">both_plots</span> <span class="op">&lt;-</span> <span class="va">past_plot</span> <span class="op">+</span> <span class="va">future_plot_list</span></span>
<span></span>
<span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">both_plots</span> <span class="op">+</span> <span class="fu">plot_layout</span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span>, widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">future_plot_list</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">plot</span> <span class="op">&amp;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/18.2c-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li><p>If we wanted to make a generally applicable function that does all the processing we just set up, we’d have to make sure that the function produces warnings or errors when it’s fed with inappropriate inputs, and that it’s flexible enough to deal with various types of inputs.</p></li>
<li><p>But let’s assume we only want to use it with data that has the same structure as what we’ve used so far. Then we can just take all the commands so far and wrap them in a function call:</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb307"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plot_scenarios_gg</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">past_observed</span>, <span class="va">past_simulated</span>, <span class="va">future_data</span>, <span class="va">metric</span>,</span>
<span>    <span class="va">axis_label</span>, <span class="va">time_points</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">rng</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">past_observed</span><span class="op">[[</span><span class="va">metric</span><span class="op">]</span><span class="op">]</span>, <span class="va">past_simulated</span><span class="op">[[</span><span class="va">metric</span><span class="op">]</span><span class="op">]</span>, <span class="va">future_data</span><span class="op">[[</span><span class="va">metric</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">past_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">past_simulated</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span><span class="op">(</span><span class="st">"as.numeric(Year)"</span>,</span>
<span>        <span class="va">metric</span>, group <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"skyblue"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">1.1</span> <span class="op">*</span> <span class="va">rng</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="va">axis_label</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">Scenario</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">past_observed</span>,</span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span><span class="op">(</span><span class="st">"End_year"</span>, <span class="va">metric</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">future_plot_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">y</span> <span class="kw">in</span> <span class="va">time_points</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">future_plot_list</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">y</span> <span class="op">==</span> <span class="va">time_points</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">future_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">future_data</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span></span>
<span>            <span class="va">y</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span><span class="op">(</span><span class="st">"GCM"</span>, <span class="va">metric</span>, fill <span class="op">=</span> <span class="st">"GCM"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">SSP</span><span class="op">)</span>,</span>
<span>            nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="cn">NULL</span>, expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span>add <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">1.1</span> <span class="op">*</span> <span class="va">rng</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_text_npc</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>npcx <span class="op">=</span> <span class="st">"center"</span>,</span>
<span>            npcy <span class="op">=</span> <span class="st">"top"</span>, label <span class="op">=</span> <span class="va">Year</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>            legend.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="st">"cm"</span><span class="op">)</span>, legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>            legend.box.spacing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"cm"</span><span class="op">)</span>, plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                vjust <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, size <span class="op">=</span> <span class="fl">15</span> <span class="op">*</span> <span class="fl">1.05</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="va">plot</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">past_plot</span> <span class="op">+</span> <span class="va">future_plot_list</span> <span class="op">+</span> <span class="fu">plot_layout</span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span>, widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">future_plot_list</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">plot</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Now we can produce the same outputs a bit more quickly: For Heat</span></span>
<span><span class="fu">plot_scenarios_gg</span><span class="op">(</span>past_observed <span class="op">=</span> <span class="va">past_observed</span>, past_simulated <span class="op">=</span> <span class="va">past_simulated</span>,</span>
<span>    future_data <span class="op">=</span> <span class="va">future_data</span>, metric <span class="op">=</span> <span class="st">"GDH"</span>, axis_label <span class="op">=</span> <span class="st">"Heat (in Growing Degree Hours)"</span>,</span>
<span>    time_points <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2050</span>, <span class="fl">2085</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/18.2d-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb308"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># For Chill</span></span>
<span><span class="fu">plot_scenarios_gg</span><span class="op">(</span>past_observed <span class="op">=</span> <span class="va">past_observed</span>, past_simulated <span class="op">=</span> <span class="va">past_simulated</span>,</span>
<span>    future_data <span class="op">=</span> <span class="va">future_data</span>, metric <span class="op">=</span> <span class="st">"Chill_Portions"</span>, axis_label <span class="op">=</span> <span class="st">"Chill (in Chill Portions)"</span>,</span>
<span>    time_points <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2050</span>, <span class="fl">2085</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/18.2d-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb309"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># For Frost</span></span>
<span><span class="fu">plot_scenarios_gg</span><span class="op">(</span>past_observed <span class="op">=</span> <span class="va">past_observed</span>, past_simulated <span class="op">=</span> <span class="va">past_simulated</span>,</span>
<span>    future_data <span class="op">=</span> <span class="va">future_data</span>, metric <span class="op">=</span> <span class="st">"Frost_H"</span>, axis_label <span class="op">=</span> <span class="st">"Frost duration (in hours)"</span>,</span>
<span>    time_points <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2050</span>, <span class="fl">2085</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/18.2d-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section><section id="exercises-on-plotting-future-projections" class="level3"><h3 class="anchored" data-anchor-id="exercises-on-plotting-future-projections">
<span style="color:#71797E">18.3</span>&nbsp; Exercises on plotting future projections</h3>
<div style="height: 18px;">

</div>
<p><strong><em>1. Produce similar plots for the weather station you selected for earlier exercises.</em></strong></p>
<p>Create similar plots for <strong>Mössingen</strong>:</p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb310"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chill_hist_scenario_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/load_temperature_scenarios.html">load_temperature_scenarios</a></span><span class="op">(</span><span class="st">"data/MS"</span>, <span class="st">"MS_hist_chill_305_59"</span><span class="op">)</span></span>
<span><span class="va">actual_chill</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/read_tab.html">read_tab</a></span><span class="op">(</span><span class="st">"data/MS/MS_observed_chill_305_59.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">chill_future_scenario_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/load_temperature_scenarios.html">load_temperature_scenarios</a></span><span class="op">(</span><span class="st">"data/MS/MS_future_climate"</span>,</span>
<span>    <span class="st">"MS_futurechill"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">chills</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/make_climate_scenario.html">make_climate_scenario</a></span><span class="op">(</span><span class="va">chill_hist_scenario_list</span>, caption <span class="op">=</span> <span class="st">"Historic"</span>, historic_data <span class="op">=</span> <span class="va">actual_chill</span>,</span>
<span>    time_series <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">SSPs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ssp126"</span>, <span class="st">"ssp245"</span>, <span class="st">"ssp370"</span>, <span class="st">"ssp585"</span><span class="op">)</span></span>
<span><span class="va">Times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2050</span>, <span class="fl">2085</span><span class="op">)</span></span>
<span></span>
<span><span class="va">list_ssp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chill_future_scenario_list</span><span class="op">)</span>, <span class="st">"\\."</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">list_gcm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chill_future_scenario_list</span><span class="op">)</span>, <span class="st">"\\."</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">list_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chill_future_scenario_list</span><span class="op">)</span>, <span class="st">"\\."</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">SSP</span> <span class="kw">in</span> <span class="va">SSPs</span><span class="op">)</span> <span class="kw">for</span> <span class="op">(</span><span class="va">Time</span> <span class="kw">in</span> <span class="va">Times</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="co"># find all scenarios for the ssp and time</span></span>
<span>    <span class="va">chill</span> <span class="op">&lt;-</span> <span class="va">chill_future_scenario_list</span><span class="op">[</span><span class="va">list_ssp</span> <span class="op">==</span> <span class="va">SSP</span> <span class="op">&amp;</span> <span class="va">list_time</span> <span class="op">==</span> <span class="va">Time</span><span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chill</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">list_gcm</span><span class="op">[</span><span class="va">list_ssp</span> <span class="op">==</span> <span class="va">SSP</span> <span class="op">&amp;</span> <span class="va">list_time</span> <span class="op">==</span> <span class="va">Time</span><span class="op">]</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp126"</span><span class="op">)</span></span>
<span>        <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP1"</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp245"</span><span class="op">)</span></span>
<span>        <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP2"</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp370"</span><span class="op">)</span></span>
<span>        <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP3"</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp585"</span><span class="op">)</span></span>
<span>        <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP5"</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">Time</span> <span class="op">==</span> <span class="st">"2050"</span><span class="op">)</span></span>
<span>        <span class="va">Time_caption</span> <span class="op">&lt;-</span> <span class="st">"2050"</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">Time</span> <span class="op">==</span> <span class="st">"2085"</span><span class="op">)</span></span>
<span>        <span class="va">Time_caption</span> <span class="op">&lt;-</span> <span class="st">"2085"</span></span>
<span>    <span class="va">chills</span> <span class="op">&lt;-</span> <span class="va">chill</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/make_climate_scenario.html">make_climate_scenario</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">SSPcaption</span>, <span class="va">Time_caption</span><span class="op">)</span>, add_to <span class="op">=</span> <span class="va">chills</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># We'll first process the past scenarios (element 1 of the chills list).</span></span>
<span><span class="co"># Within the data element, we have a list of multiple data.frames for the</span></span>
<span><span class="co"># various past scenarios.  Using a 'for' loop, we cycle through all these</span></span>
<span><span class="co"># data.frames.</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">nam</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chills</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Extract the data frame.</span></span>
<span>    <span class="va">ch</span> <span class="op">&lt;-</span> <span class="va">chills</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="va">nam</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="co"># Add columns for the new information we have to add and fill them.</span></span>
<span>    <span class="va">ch</span><span class="op">[</span>, <span class="st">"GCM"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"none"</span></span>
<span>    <span class="va">ch</span><span class="op">[</span>, <span class="st">"SSP"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"none"</span></span>
<span>    <span class="va">ch</span><span class="op">[</span>, <span class="st">"Year"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">nam</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Now check if this is the first time we've gone through this loop.  If</span></span>
<span>    <span class="co"># this is the first time, the ch data.frame becomes the output object</span></span>
<span>    <span class="co"># (past_simulated).  If it is not the first time ('else'), we add the</span></span>
<span>    <span class="co"># current data.frame to the 'past_simulated' object</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">nam</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chills</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">past_simulated</span> <span class="op">&lt;-</span> <span class="va">ch</span> <span class="kw">else</span> <span class="va">past_simulated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">past_simulated</span>, <span class="va">ch</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># We add another column called 'Scenario' and label all rows as 'Historical'</span></span>
<span><span class="va">past_simulated</span><span class="op">[</span><span class="st">"Scenario"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Historical"</span></span>
<span></span>
<span><span class="co"># We'll want to add the historic observation too, so let's simplify the pointer</span></span>
<span><span class="co"># to this information for easier use later</span></span>
<span></span>
<span><span class="va">past_observed</span> <span class="op">&lt;-</span> <span class="va">chills</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"historic_data"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Extract future data</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">chills</span><span class="op">)</span><span class="op">)</span> <span class="kw">for</span> <span class="op">(</span><span class="va">nam</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chills</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ch</span> <span class="op">&lt;-</span> <span class="va">chills</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="va">nam</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="va">ch</span><span class="op">[</span>, <span class="st">"GCM"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">nam</span></span>
<span>    <span class="va">ch</span><span class="op">[</span>, <span class="st">"SSP"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">chills</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">caption</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">ch</span><span class="op">[</span>, <span class="st">"Year"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">chills</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">caption</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="va">nam</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chills</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="va">future_data</span> <span class="op">&lt;-</span> <span class="va">ch</span> <span class="kw">else</span> <span class="va">future_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">future_data</span>, <span class="va">ch</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">plot_scenarios_gg</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">past_observed</span>, <span class="va">past_simulated</span>, <span class="va">future_data</span>, <span class="va">metric</span>,</span>
<span>    <span class="va">axis_label</span>, <span class="va">time_points</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">rng</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">past_observed</span><span class="op">[[</span><span class="va">metric</span><span class="op">]</span><span class="op">]</span>, <span class="va">past_simulated</span><span class="op">[[</span><span class="va">metric</span><span class="op">]</span><span class="op">]</span>, <span class="va">future_data</span><span class="op">[[</span><span class="va">metric</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">past_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">past_simulated</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span><span class="op">(</span><span class="st">"as.numeric(Year)"</span>,</span>
<span>        <span class="va">metric</span>, group <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"skyblue"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">1.1</span> <span class="op">*</span> <span class="va">rng</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="va">axis_label</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">Scenario</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">past_observed</span>,</span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span><span class="op">(</span><span class="st">"End_year"</span>, <span class="va">metric</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">future_plot_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">y</span> <span class="kw">in</span> <span class="va">time_points</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">future_plot_list</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">y</span> <span class="op">==</span> <span class="va">time_points</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">future_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">future_data</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span></span>
<span>            <span class="va">y</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span><span class="op">(</span><span class="st">"GCM"</span>, <span class="va">metric</span>, fill <span class="op">=</span> <span class="st">"GCM"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">SSP</span><span class="op">)</span>,</span>
<span>            nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="cn">NULL</span>, expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span>add <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">1.1</span> <span class="op">*</span> <span class="va">rng</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_text_npc</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>npcx <span class="op">=</span> <span class="st">"center"</span>,</span>
<span>            npcy <span class="op">=</span> <span class="st">"top"</span>, label <span class="op">=</span> <span class="va">Year</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>            legend.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="st">"cm"</span><span class="op">)</span>, legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>            legend.box.spacing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"cm"</span><span class="op">)</span>, plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                vjust <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, size <span class="op">=</span> <span class="fl">15</span> <span class="op">*</span> <span class="fl">1.05</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="va">plot</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">past_plot</span> <span class="op">+</span> <span class="va">future_plot_list</span> <span class="op">+</span> <span class="fu">plot_layout</span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span>, widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">future_plot_list</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">plot</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">plot_scenarios_gg</span><span class="op">(</span>past_observed <span class="op">=</span> <span class="va">past_observed</span>, past_simulated <span class="op">=</span> <span class="va">past_simulated</span>,</span>
<span>    future_data <span class="op">=</span> <span class="va">future_data</span>, metric <span class="op">=</span> <span class="st">"GDH"</span>, axis_label <span class="op">=</span> <span class="st">"Heat (in Growing Degree Hours)"</span>,</span>
<span>    time_points <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2050</span>, <span class="fl">2085</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/18.3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb311"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">plot_scenarios_gg</span><span class="op">(</span>past_observed <span class="op">=</span> <span class="va">past_observed</span>, past_simulated <span class="op">=</span> <span class="va">past_simulated</span>,</span>
<span>    future_data <span class="op">=</span> <span class="va">future_data</span>, metric <span class="op">=</span> <span class="st">"Chill_Portions"</span>, axis_label <span class="op">=</span> <span class="st">"Chill (in Chill Portions)"</span>,</span>
<span>    time_points <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2050</span>, <span class="fl">2085</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/18.3-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb312"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">plot_scenarios_gg</span><span class="op">(</span>past_observed <span class="op">=</span> <span class="va">past_observed</span>, past_simulated <span class="op">=</span> <span class="va">past_simulated</span>,</span>
<span>    future_data <span class="op">=</span> <span class="va">future_data</span>, metric <span class="op">=</span> <span class="st">"Frost_H"</span>, axis_label <span class="op">=</span> <span class="st">"Frost duration (in hours)"</span>,</span>
<span>    time_points <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2050</span>, <span class="fl">2085</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/18.3-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section></section><section id="chapter-19-chill-model-comparison" class="level2"><h2 class="anchored" data-anchor-id="chapter-19-chill-model-comparison">Chapter 19: Chill model comparison</h2>
<section id="safe-winter-chill" class="level3"><h3 class="anchored" data-anchor-id="safe-winter-chill">
<span style="color:#71797E">19.1</span>&nbsp; Safe Winter Chill</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>Safe Winter Chill is defined as the 10% quantile of the kind of chill distributions. For growers, this measure corresponds to the amount of chill that is likely to be exceeded in 90% of all years. A specific tree cultivar with a chilling requirement that corresponds to Safe Winter Chill can be expected to meet this requirement about 90% of the time.</p></li>
<li><p>Besides practical usefulness, Safe Winter Chill also offers an opportunity for reducing the complexity of our simulation results by computing the 10% quantiles of each of the distributions we generated.</p></li>
<li><p>While such a reduction always involves a loss of information, it gives us the opportunity to present our data in different, possibly more attractive, formats— for example, heat map which illustrates differences in the behavior of the various chill models that have been used in the literature (and sometimes in practice).</p></li>
</ul>
<p><br></p>
</section><section id="chill-metrics" class="level3"><h3 class="anchored" data-anchor-id="chill-metrics">
<span style="color:#71797E">19.2</span>&nbsp; Chill metrics</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>A list of 13 chill metrics, which has recently been compiled and published in <a href="https://www.sciencedirect.com/science/article/pii/S1161030120301106">a paper by Eduardo Fernandez</a>, provides the blueprint for the present analysis.</p></li>
<li><p>The models are compiled in <code>dormancyR</code> package, and using the <code>devtools</code> package, we can install this directly from github.</p></li>
<li><p>We also need <code>chillR</code>, because Eduardo did not include in this package the chill models that are already contained in <code>chillR</code>.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb313"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># library(chillR)</span></span>
<span><span class="co"># library(devtools)</span></span>
<span><span class="co"># install_github("EduardoFernandezC/dormancyR")</span></span>
<span><span class="co"># library(dormancyR)</span></span>
<span></span>
<span><span class="co"># Make a list of models that calculate chilling using hourly temp data</span></span>
<span><span class="va">hourly_models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Chilling_units <span class="op">=</span> <span class="va">chilling_units</span>,</span>
<span>     Low_chill <span class="op">=</span> <span class="va">low_chill_model</span>,</span>
<span>     Modified_Utah <span class="op">=</span> <span class="va">modified_utah_model</span>,</span>
<span>     North_Carolina <span class="op">=</span> <span class="va">north_carolina_model</span>,</span>
<span>     Positive_Utah <span class="op">=</span> <span class="va">positive_utah_model</span>,</span>
<span>     Chilling_Hours <span class="op">=</span> <span class="va">Chilling_Hours</span>,</span>
<span>     Utah_Chill_Units <span class="op">=</span> <span class="va">Utah_Model</span>,</span>
<span>     Chill_Portions <span class="op">=</span> <span class="va">Dynamic_Model</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># list for daily models that use daily temp data</span></span>
<span><span class="va">daily_models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Rate_of_Chill <span class="op">=</span> <span class="va">rate_of_chill</span>,</span>
<span>                     Chill_Days <span class="op">=</span> <span class="va">chill_days</span>,</span>
<span>                     Exponential_Chill <span class="op">=</span> <span class="va">exponential_chill</span>,</span>
<span>                     <span class="co"># Triangular_Chill_Haninnen = triangular_chill_1,</span></span>
<span>                     Triangular_Chill_Legave <span class="op">=</span> <span class="va">triangular_chill_2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combines hourly and daily model names into a single vector</span></span>
<span><span class="va">metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">daily_models</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">hourly_models</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Give readable names</span></span>
<span><span class="va">model_labels</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Rate of Chill"</span>,</span>
<span>                 <span class="st">"Chill Days"</span>,</span>
<span>                 <span class="st">"Exponential Chill"</span>,</span>
<span>                 <span class="co"># "Triangular Chill (Häninnen)",</span></span>
<span>                 <span class="st">"Triangular Chill (Legave)"</span>,</span>
<span>                 <span class="st">"Chilling Units"</span>,</span>
<span>                 <span class="st">"Low-Chill Chill Units"</span>,</span>
<span>                 <span class="st">"Modified Utah Chill Units"</span>,</span>
<span>                 <span class="st">"North Carolina Chill Units"</span>,</span>
<span>                 <span class="st">"Positive Utah Chill Units"</span>,</span>
<span>                 <span class="st">"Chilling Hours"</span>,</span>
<span>                 <span class="st">"Utah Chill Units"</span>,</span>
<span>                 <span class="st">"Chill Portions"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a data frame</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Metric <span class="op">=</span> <span class="va">model_labels</span>, <span class="st">'Function name'</span> <span class="op">=</span> <span class="va">metrics</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span>  <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Metric</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Function.name</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Rate of Chill</td>
<td style="text-align: left;">Rate_of_Chill</td>
</tr>
<tr class="even">
<td style="text-align: left;">Chill Days</td>
<td style="text-align: left;">Chill_Days</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Exponential Chill</td>
<td style="text-align: left;">Exponential_Chill</td>
</tr>
<tr class="even">
<td style="text-align: left;">Triangular Chill (Legave)</td>
<td style="text-align: left;">Triangular_Chill_Legave</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Chilling Units</td>
<td style="text-align: left;">Chilling_units</td>
</tr>
<tr class="even">
<td style="text-align: left;">Low-Chill Chill Units</td>
<td style="text-align: left;">Low_chill</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Modified Utah Chill Units</td>
<td style="text-align: left;">Modified_Utah</td>
</tr>
<tr class="even">
<td style="text-align: left;">North Carolina Chill Units</td>
<td style="text-align: left;">North_Carolina</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Positive Utah Chill Units</td>
<td style="text-align: left;">Positive_Utah</td>
</tr>
<tr class="even">
<td style="text-align: left;">Chilling Hours</td>
<td style="text-align: left;">Chilling_Hours</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Utah Chill Units</td>
<td style="text-align: left;">Utah_Chill_Units</td>
</tr>
<tr class="even">
<td style="text-align: left;">Chill Portions</td>
<td style="text-align: left;">Chill_Portions</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<ul>
<li>Now we want to apply all these chill models to our observed temperature record, as well as to the past and future temperature scenarios for Bonn.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb314"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load saved historical temp data for Bonn</span></span>
<span><span class="va">Bonn_temps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/read_tab.html">read_tab</a></span><span class="op">(</span><span class="st">"data/Bonn/Bonn_temps.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Temps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/load_temperature_scenarios.html">load_temperature_scenarios</a></span><span class="op">(</span><span class="st">"data/Bonn"</span>, <span class="st">"Bonn_hist_scenarios"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now we can apply the chill models.  We’ve already seen how we can use models</span></span>
<span><span class="co"># that use hourly temperature data as input. However, some of the models on the</span></span>
<span><span class="co"># list require daily temperature only, so Eduardo wrote the</span></span>
<span><span class="co"># `tempResponse_list_daily` function, which applies similar procedures to daily</span></span>
<span><span class="co"># data.  Unlike the `tempResponse_daily_list` function from `chillR`, this</span></span>
<span><span class="co"># function doesn’t include a `misstolerance` parameter, so we have to manually</span></span>
<span><span class="co"># remove all years with incomplete winter seasons.  We save all results in the</span></span>
<span><span class="co"># data/chill folder, using the prefix Bonn_multichill:</span></span>
<span><span class="va">Start_JDay</span> <span class="op">&lt;-</span> <span class="fl">305</span></span>
<span><span class="va">End_JDay</span> <span class="op">&lt;-</span> <span class="fl">59</span></span>
<span></span>
<span><span class="co"># Compute metrics from model using daily temps as input(rather than hourly</span></span>
<span><span class="co"># temp)</span></span>
<span><span class="va">daily_models_past_scenarios</span> <span class="op">&lt;-</span> <span class="fu">tempResponse_list_daily</span><span class="op">(</span><span class="va">Temps</span>, Start_JDay <span class="op">=</span> <span class="va">Start_JDay</span>,</span>
<span>    End_JDay <span class="op">=</span> <span class="va">End_JDay</span>, models <span class="op">=</span> <span class="va">daily_models</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter years with more than 90% temp data is available</span></span>
<span><span class="va">daily_models_past_scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">daily_models_past_scenarios</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Perc_complete</span> <span class="op">&gt;</span></span>
<span>    <span class="fl">90</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use chillR function to calculate from hourly temp data</span></span>
<span><span class="va">hourly_models_past_scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/tempResponse_daily_list.html">tempResponse_daily_list</a></span><span class="op">(</span><span class="va">Temps</span>, latitude <span class="op">=</span> <span class="fl">50.866</span>,</span>
<span>    Start_JDay <span class="op">=</span> <span class="va">Start_JDay</span>, End_JDay <span class="op">=</span> <span class="va">End_JDay</span>, models <span class="op">=</span> <span class="va">hourly_models</span>, misstolerance <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>  <span class="co"># maximum percentage of values for </span></span>
<span><span class="co"># a given season that can be missing without the record being removed from the</span></span>
<span><span class="co"># output. Defaults to 50.</span></span>
<span></span>
<span><span class="va">past_scenarios</span> <span class="op">&lt;-</span> <span class="va">daily_models_past_scenarios</span></span>
<span></span>
<span><span class="co"># Combine daily and hourly results into a single dataset</span></span>
<span><span class="va">past_scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">past_scenarios</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">past_scenarios</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    <span class="va">hourly_models_past_scenarios</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">hourly_models</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Take the years?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">past_scenarios</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">daily_models_past_scenarios</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Produce a summarize data.frame of chill responses from daily chill models</span></span>
<span><span class="va">daily_models_observed</span> <span class="op">&lt;-</span> <span class="fu">tempResponse_daily</span><span class="op">(</span><span class="va">Bonn_temps</span>, Start_JDay <span class="op">=</span> <span class="va">Start_JDay</span>,</span>
<span>    End_JDay <span class="op">=</span> <span class="va">End_JDay</span>, models <span class="op">=</span> <span class="va">daily_models</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter only the records with more than 90% completeness</span></span>
<span><span class="va">daily_models_observed</span> <span class="op">&lt;-</span> <span class="va">daily_models_observed</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">daily_models_observed</span><span class="op">$</span><span class="va">Perc_complete</span> <span class="op">&gt;</span></span>
<span>    <span class="fl">90</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Produce a data frame showing totals for all specified models for the</span></span>
<span><span class="co"># respective periods for all seasons included in the temperature records.</span></span>
<span><span class="co"># Calculation of climatic metrics from lists of daily temperature records</span></span>
<span><span class="co"># (hourly)</span></span>
<span><span class="va">hourly_models_observed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/tempResponse_daily_list.html">tempResponse_daily_list</a></span><span class="op">(</span><span class="va">Bonn_temps</span>, latitude <span class="op">=</span> <span class="fl">50.866</span>,</span>
<span>    Start_JDay <span class="op">=</span> <span class="va">Start_JDay</span>, End_JDay <span class="op">=</span> <span class="va">End_JDay</span>, models <span class="op">=</span> <span class="va">hourly_models</span>, misstolerance <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Bind the observed daily and hourly resutls with respective model names</span></span>
<span><span class="va">past_observed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">daily_models_observed</span>, <span class="va">hourly_models_observed</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">hourly_models</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save data for later use</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/save_temperature_scenarios.html">save_temperature_scenarios</a></span><span class="op">(</span><span class="va">past_scenarios</span>, <span class="st">"data/Bonn/Bonn_future_climate"</span>, <span class="st">"Bonn_multichill_305_59_historic"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">past_observed</span>, <span class="st">"data/Bonn/Bonn_future_climate/Bonn_multichill_305_59_observed.csv"</span>,</span>
<span>    row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
<ul>
<li>Now we apply similar procedures to the future data. Since we have eight scenarios again here, it makes sense to design this as a loop:</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb315"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Do the same for future scenarios but in a loop</span></span>
<span></span>
<span><span class="co"># Load future data</span></span>
<span><span class="va">future_temps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/load_temperature_scenarios.html">load_temperature_scenarios</a></span><span class="op">(</span><span class="st">"data/Bonn/Bonn_future_climate"</span>, <span class="st">"Bonn_future_"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define SSP models and years</span></span>
<span><span class="va">SSPs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ssp126"</span>, <span class="st">"ssp245"</span>, <span class="st">"ssp370"</span>, <span class="st">"ssp585"</span><span class="op">)</span></span>
<span><span class="va">Times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2050</span>, <span class="fl">2085</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Split names for ssp models</span></span>
<span><span class="va">list_ssp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">future_temps</span><span class="op">)</span>, <span class="st">"\\."</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Split for model names</span></span>
<span><span class="va">list_gcm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">future_temps</span><span class="op">)</span>, <span class="st">"\\."</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Split the years</span></span>
<span><span class="va">list_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">future_temps</span><span class="op">)</span>, <span class="st">"\\."</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make loop to repeat for all 8 scenarios</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">SSP</span> <span class="kw">in</span> <span class="va">SSPs</span><span class="op">)</span> <span class="kw">for</span> <span class="op">(</span><span class="va">Time</span> <span class="kw">in</span> <span class="va">Times</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">Temps</span> <span class="op">&lt;-</span> <span class="va">future_temps</span><span class="op">[</span><span class="va">list_ssp</span> <span class="op">==</span> <span class="va">SSP</span> <span class="op">&amp;</span> <span class="va">list_time</span> <span class="op">==</span> <span class="va">Time</span><span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">Temps</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">list_gcm</span><span class="op">[</span><span class="va">list_ssp</span> <span class="op">==</span> <span class="va">SSP</span> <span class="op">&amp;</span> <span class="va">list_time</span> <span class="op">==</span> <span class="va">Time</span><span class="op">]</span></span>
<span>    <span class="va">daily_models_future_scenarios</span> <span class="op">&lt;-</span> <span class="fu">tempResponse_list_daily</span><span class="op">(</span><span class="va">Temps</span>, Start_JDay <span class="op">=</span> <span class="va">Start_JDay</span>,</span>
<span>        End_JDay <span class="op">=</span> <span class="va">End_JDay</span>, models <span class="op">=</span> <span class="va">daily_models</span><span class="op">)</span></span>
<span>    <span class="va">daily_models_future_scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">daily_models_future_scenarios</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Perc_complete</span> <span class="op">&gt;</span></span>
<span>        <span class="fl">90</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">hourly_models_future_scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/tempResponse_daily_list.html">tempResponse_daily_list</a></span><span class="op">(</span><span class="va">Temps</span>, latitude <span class="op">=</span> <span class="fl">50.866</span>,</span>
<span>        Start_JDay <span class="op">=</span> <span class="va">Start_JDay</span>, End_JDay <span class="op">=</span> <span class="va">End_JDay</span>, models <span class="op">=</span> <span class="va">hourly_models</span>, misstolerance <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">future_scenarios</span> <span class="op">&lt;-</span> <span class="va">daily_models_future_scenarios</span></span>
<span></span>
<span>    <span class="va">future_scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">future_scenarios</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">future_scenarios</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>,</span>
<span>        <span class="va">hourly_models_future_scenarios</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">hourly_models</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">future_scenarios</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">daily_models_future_scenarios</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">chill</span> <span class="op">&lt;-</span> <span class="va">future_scenarios</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/save_temperature_scenarios.html">save_temperature_scenarios</a></span><span class="op">(</span><span class="va">chill</span>, <span class="st">"data/Bonn/Bonn_future_climate"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Bonn_multichill_305_59_"</span>,</span>
<span>        <span class="va">Time</span>, <span class="st">"_"</span>, <span class="va">SSP</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
<ul>
<li>Now all scenarios we want to process and plot have been saved to disk. We can now load them and produce chill scenarios.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb316"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chill_past_scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/load_temperature_scenarios.html">load_temperature_scenarios</a></span><span class="op">(</span></span>
<span>  <span class="st">"data/Bonn/Bonn_future_climate"</span>,</span>
<span>  <span class="st">"Bonn_multichill_305_59_historic"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">chill_observed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/read_tab.html">read_tab</a></span><span class="op">(</span></span>
<span>  <span class="st">"data/Bonn/Bonn_future_climate/Bonn_multichill_305_59_observed.csv"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Make climate scenarios for plotting from a list of climate metric data </span></span>
<span><span class="co"># produced by tempResponse_daily_list, for example</span></span>
<span><span class="va">chills</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/make_climate_scenario.html">make_climate_scenario</a></span><span class="op">(</span><span class="va">chill_past_scenarios</span>,</span>
<span>                                caption <span class="op">=</span> <span class="st">"Historical"</span>,</span>
<span>                                historic_data <span class="op">=</span> <span class="va">chill_observed</span>,</span>
<span>                                time_series <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add this again to knit better</span></span>
<span><span class="va">SSPs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ssp126"</span>, <span class="st">"ssp245"</span>,<span class="st">"ssp370"</span>, <span class="st">"ssp585"</span><span class="op">)</span></span>
<span><span class="va">Times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2050</span>, <span class="fl">2085</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create loops for future scenarios</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">SSP</span> <span class="kw">in</span> <span class="va">SSPs</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">Time</span> <span class="kw">in</span> <span class="va">Times</span><span class="op">)</span></span>
<span>    <span class="op">{</span> <span class="co"># load future climate scenarios with designated file names</span></span>
<span>    <span class="va">chill</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/load_temperature_scenarios.html">load_temperature_scenarios</a></span><span class="op">(</span></span>
<span>      <span class="st">"data/Bonn/Bonn_future_climate"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Bonn_multichill_305_59_"</span>,<span class="va">Time</span>,<span class="st">"_"</span>,<span class="va">SSP</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp126"</span><span class="op">)</span> <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP1"</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp245"</span><span class="op">)</span> <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP2"</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp370"</span><span class="op">)</span> <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP3"</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp585"</span><span class="op">)</span> <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP5"</span>    </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">Time</span> <span class="op">==</span> <span class="st">"2050"</span><span class="op">)</span> <span class="va">Time_caption</span> <span class="op">&lt;-</span> <span class="st">"2050"</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">Time</span> <span class="op">==</span> <span class="st">"2085"</span><span class="op">)</span> <span class="va">Time_caption</span> <span class="op">&lt;-</span> <span class="st">"2085"</span></span>
<span>    <span class="va">chills</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/make_climate_scenario.html">make_climate_scenario</a></span><span class="op">(</span><span class="va">chill</span>,</span>
<span>                                    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">SSPcaption</span>,</span>
<span>                                                <span class="va">Time_caption</span><span class="op">)</span>,</span>
<span>                                    add_to <span class="op">=</span> <span class="va">chills</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Now we want to make a heat map of Safe Winter Chill, using the ggplot2. </span></span>
<span><span class="co"># This again requires reorganizing our data into a long data.frame. </span></span>
<span><span class="co"># We also have to calculate the 10% quantiles from the distributions. </span></span>
<span></span>
<span><span class="co"># Since all the chill models have different units, and numeric values differ </span></span>
<span><span class="co"># greatly across the models, we normalize all the results, expressing them as </span></span>
<span><span class="co"># changes relative to a 1980 baseline:</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">chills</span><span class="op">)</span><span class="op">)</span></span>
<span>   <span class="op">{</span><span class="va">ch</span> <span class="op">&lt;-</span> <span class="va">chills</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>   <span class="kw">if</span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">caption</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Historical"</span><span class="op">)</span></span>
<span>     <span class="op">{</span><span class="va">GCMs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"none"</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">SSPs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"none"</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">Years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">labels</span><span class="op">)</span></span>
<span>      <span class="va">Scenario</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Historical"</span>,</span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">}</span> <span class="kw">else</span></span>
<span>                        <span class="op">{</span><span class="va">GCMs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span>                        <span class="va">SSPs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">caption</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                                    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>                        <span class="va">Years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">caption</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                                     <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>                        <span class="va">Scenario</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Future"</span>,</span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span>
<span>   <span class="kw">for</span><span class="op">(</span><span class="va">nam</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="op">{</span><span class="kw">for</span><span class="op">(</span><span class="va">met</span> <span class="kw">in</span> <span class="va">metrics</span><span class="op">)</span></span>
<span>       <span class="op">{</span><span class="va">temp_res</span> <span class="op">&lt;-</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Metric <span class="op">=</span> <span class="va">met</span>,</span>
<span>                    GCM <span class="op">=</span> <span class="va">GCMs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">nam</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                    SSP <span class="op">=</span> <span class="va">SSPs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">nam</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                    Year <span class="op">=</span> <span class="va">Years</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">nam</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                    Result <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="va">nam</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">met</span><span class="op">]</span>,<span class="fl">0.1</span><span class="op">)</span>, <span class="co"># calculate 10% quantile</span></span>
<span>                    Scenario <span class="op">=</span> <span class="va">Scenario</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">nam</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>       <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">nam</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">met</span> <span class="op">==</span> <span class="va">metrics</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>         <span class="va">results</span> <span class="op">&lt;-</span> <span class="va">temp_res</span> <span class="kw">else</span></span>
<span>           <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">results</span>,</span>
<span>                            <span class="va">temp_res</span><span class="op">)</span></span>
<span>         <span class="op">}</span></span>
<span>     <span class="op">}</span></span>
<span>   <span class="op">}</span></span>
<span></span>
<span><span class="co"># Normalize the results by dividing with the 1989 baseline value</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">met</span> <span class="kw">in</span> <span class="va">metrics</span><span class="op">)</span></span>
<span>  <span class="va">results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Metric</span> <span class="op">==</span> <span class="va">met</span><span class="op">)</span>,<span class="st">"SWC"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Metric</span> <span class="op">==</span> <span class="va">met</span><span class="op">)</span>,<span class="st">"Result"</span><span class="op">]</span><span class="op">/</span></span>
<span>      <span class="va">results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Metric</span> <span class="op">==</span> <span class="va">met</span> <span class="op">&amp;</span> <span class="va">results</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="fl">1980</span><span class="op">)</span>,</span>
<span>              <span class="st">"Result"</span><span class="op">]</span><span class="op">-</span><span class="fl">1</span> <span class="co"># calculate percentage change compared to baseline</span></span>
<span><span class="co"># subtract 1 to change to percent change (% increase or decrease)</span></span>
<span></span>
<span></span>
<span><span class="co"># Now we’re ready for plotting the results. Since we’ll have different panels in</span></span>
<span><span class="co"># this plot and we want axes to be consistent, we need to capture the full range</span></span>
<span><span class="co"># of Safe Winter Chill change values. </span></span>
<span></span>
<span><span class="co"># Then we can make our first heat map plot. Let’s start with the future (the </span></span>
<span><span class="co"># ones where the GCM is not ‘none’). Note that in the aesthetics we’re using </span></span>
<span><span class="co"># `factor` here for the y element. This ensures that the metrics are plotted in </span></span>
<span><span class="co"># the order specified by the `levels` parameter.</span></span>
<span></span>
<span><span class="co"># Get the minimum and maximum values using range function</span></span>
<span><span class="va">rng</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">SWC</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">p_future</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">results</span><span class="op">$</span><span class="va">GCM</span> <span class="op">==</span> <span class="st">"none"</span><span class="op">)</span>,<span class="op">]</span>, <span class="co"># future ones</span></span>
<span>                   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">GCM</span>,</span>
<span>                       y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Metric</span>, <span class="co"># factor as categorical data </span></span>
<span>                                  levels <span class="op">=</span> <span class="va">metrics</span><span class="op">)</span>, <span class="co"># follow order in metrics</span></span>
<span>                       fill <span class="op">=</span> <span class="va">SWC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_future</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/19.2d-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb317"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># This plot still combines information for both SSPs and both points in time. </span></span>
<span><span class="co"># Let’s show these in separate facets:</span></span>
<span><span class="va">p_future</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">p_future</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">SSP</span> <span class="op">~</span> <span class="va">Year</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">p_future</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/19.2d-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb318"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Let’s choose the black and white scheme and make the axis text a bit smaller. </span></span>
<span><span class="co"># The latter seems reasonable here, because we have a lot of text there, </span></span>
<span><span class="co"># which will be hard to show at full size.</span></span>
<span><span class="va">p_future</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">p_future</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_future</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/19.2d-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li><p>The current color scheme makes it hard to distinguish subtle differences. Let’s use a red to blue color ramp with a few intermediate values.</p></li>
<li><p>The <code>colorRamps</code> library has a few nice schemes, including the <code>matlab.like</code> color ramp, from which we choose 15 equally spaced values.</p></li>
<li><p>We’ll also show the changes in percent, and set the scale limits to the full range of the data we determined earlier:</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb319"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># library(colorRamps)</span></span>
<span><span class="va">p_future</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">p_future</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu">matlab.like</span><span class="op">(</span><span class="fl">15</span><span class="op">)</span>,</span>
<span>                       labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span>,</span>
<span>                       limits <span class="op">=</span> <span class="va">rng</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_future</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/19.2e-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb320"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Let’s change the angle of the x-axis labels to 75°, so that the labels are </span></span>
<span><span class="co"># actually readable.</span></span>
<span><span class="co"># We’ll also add a nicer title to the legend (note the ‘backslash n’ commands </span></span>
<span><span class="co"># that stand for line breaks), replace the automatic axis labels with the nicer </span></span>
<span><span class="co"># ones we designed above and change the label of the y-axis to “Chill metric”.</span></span>
<span><span class="va">p_future</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">p_future</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">75</span>, </span>
<span>                                   hjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                   vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Change in\nSafe Winter Chill\nsince 1980"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_y_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">model_labels</span><span class="op">)</span> <span class="op">+</span> <span class="co"># change to publishable format</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Chill metric"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_future</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/19.2e-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li><p>Now we can make the plot of past scenarios.</p></li>
<li><p>Note that we’re moving the x-axis to the top using the <code>scale_x_continuous(position = "top")</code> command.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb321"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p_past</span><span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">GCM</span> <span class="op">==</span> <span class="st">"none"</span><span class="op">)</span>,<span class="op">]</span>,</span>
<span>         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Year</span>,</span>
<span>             y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Metric</span>, </span>
<span>                        levels<span class="op">=</span><span class="va">metrics</span><span class="op">)</span>,</span>
<span>             fill <span class="op">=</span> <span class="va">SWC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_past</span><span class="op">&lt;-</span></span>
<span>  <span class="va">p_past</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_past</span><span class="op">&lt;-</span></span>
<span>  <span class="va">p_past</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu">matlab.like</span><span class="op">(</span><span class="fl">15</span><span class="op">)</span>,</span>
<span>                       labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span>,</span>
<span>                       limits <span class="op">=</span> <span class="va">rng</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_past</span><span class="op">&lt;-</span></span>
<span>  <span class="va">p_past</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">p_past</span><span class="op">&lt;-</span></span>
<span>  <span class="va">p_past</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Change in\nSafe Winter Chill\nsince 1980"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_y_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">model_labels</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Chill metric"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_past</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/19.2f-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb322"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Now we can combine the plots. We’ll again use the patchwork package for this. </span></span>
<span><span class="co"># Mainly the plots are now on top of each other (nrow=2, with relative heights </span></span>
<span><span class="co"># specified by heights=c(1,2)). </span></span>
<span><span class="va">chill_comp_plot</span><span class="op">&lt;-</span></span>
<span>  <span class="op">(</span><span class="va">p_past</span> <span class="op">+</span></span>
<span>     <span class="va">p_future</span> <span class="op">+</span></span>
<span>     <span class="co"># collect guides below to the given nesting level, removing duplicates/</span></span>
<span>     <span class="co"># collect all legends from two plots into a single legend</span></span>
<span>     <span class="fu">plot_layout</span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span>, </span>
<span>                 nrow <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                 heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span>,</span>
<span>        strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">chill_comp_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/19.2f-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li>Note the major differences between the behaviors of the various model. Some models indicate that Safe Winter Chill is increasing, while other say it’s decreasing. This is a clear indication that model choice matters!</li>
</ul>
<p><br></p>
</section><section id="an-animated-plot-of-relative-changes-in-safe-winter-chill" class="level3"><h3 class="anchored" data-anchor-id="an-animated-plot-of-relative-changes-in-safe-winter-chill">
<span style="color:#71797E">19.3</span>&nbsp; An animated plot of relative changes in Safe Winter Chill</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>Another R package <code>gganimate</code> can add a cool feature to figures produced with <code>ggplot2</code>.</p></li>
<li><p>To make use of this, let’s produce a simpler representation of the Safe Winter Chill data. For this, let’s summarize the results across all the GCMs.</p></li>
<li><p>We’ll also duplicate the historic data and assign one of each of the duplicates to each SSP scenario. This is needed for easily plotting the full time series, disaggregated by SSP.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb323"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Copy historical data for each SSP and then bind into data frame</span></span>
<span><span class="va">hist_results</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">GCM</span> <span class="op">==</span> <span class="st">"none"</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">hist_results</span><span class="op">$</span><span class="va">SSP</span> <span class="op">&lt;-</span> <span class="st">"SSP1"</span></span>
<span><span class="va">hist_results_2</span> <span class="op">&lt;-</span> <span class="va">hist_results</span></span>
<span><span class="va">hist_results_2</span><span class="op">$</span><span class="va">SSP</span> <span class="op">&lt;-</span> <span class="st">"SSP2"</span></span>
<span><span class="va">hist_results_3</span> <span class="op">&lt;-</span> <span class="va">hist_results</span></span>
<span><span class="va">hist_results_3</span><span class="op">$</span><span class="va">SSP</span> <span class="op">&lt;-</span> <span class="st">"SSP3"</span></span>
<span><span class="va">hist_results_4</span> <span class="op">&lt;-</span> <span class="va">hist_results</span></span>
<span><span class="va">hist_results_4</span><span class="op">$</span><span class="va">SSP</span> <span class="op">&lt;-</span> <span class="st">"SSP5"</span></span>
<span><span class="va">hist_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">hist_results</span>,</span>
<span>                      <span class="va">hist_results_2</span>,</span>
<span>                      <span class="va">hist_results_3</span>,</span>
<span>                      <span class="va">hist_results_4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">future_results</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">results</span><span class="op">$</span><span class="va">GCM</span> <span class="op">==</span> <span class="st">"none"</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Compute summary statistics of data subsets</span></span>
<span><span class="va">GCM_aggregate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span></span>
<span>  <span class="va">future_results</span><span class="op">$</span><span class="va">SWC</span>, <span class="co"># safe winter chill- the value to aggregate</span></span>
<span>  by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">future_results</span><span class="op">$</span><span class="va">Metric</span>, <span class="co"># group data by these categories/select only</span></span>
<span>          <span class="va">future_results</span><span class="op">$</span><span class="va">SSP</span>,</span>
<span>          <span class="va">future_results</span><span class="op">$</span><span class="va">Year</span><span class="op">)</span>,</span>
<span>  FUN<span class="op">=</span><span class="va">mean</span><span class="op">)</span> <span class="co"># calculate the mean</span></span>
<span></span>
<span><span class="co"># Rename the columns</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">GCM_aggregate</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Metric"</span>,</span>
<span>                             <span class="st">"SSP"</span>,</span>
<span>                             <span class="st">"Year"</span>,</span>
<span>                             <span class="st">"SWC"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Combine historical SWC data (for SSPs) and mean future SWC projection </span></span>
<span><span class="va">SSP_Time_series</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">hist_results</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Metric"</span>,</span>
<span>                                       <span class="st">"SSP"</span>,</span>
<span>                                       <span class="st">"Year"</span>,</span>
<span>                                       <span class="st">"SWC"</span><span class="op">)</span><span class="op">]</span>, <span class="co"># only select these 4 columns</span></span>
<span>                       <span class="va">GCM_aggregate</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now we can make a line plot showing changes in Safe Winter Chill over the two </span></span>
<span><span class="co"># SSP scenarios for all of the chill metrics. This is very similar to the </span></span>
<span><span class="co"># procedures above, except that now we’re using the geom_line command </span></span>
<span><span class="co"># rather than geom_tile (there are some more minor differences).</span></span>
<span></span>
<span><span class="co"># Make sure all are numeric years</span></span>
<span><span class="va">SSP_Time_series</span><span class="op">$</span><span class="va">Year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">SSP_Time_series</span><span class="op">$</span><span class="va">Year</span><span class="op">)</span></span>
<span></span>
<span><span class="va">chill_change_plot</span><span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">SSP_Time_series</span>,</span>
<span>         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span>,</span>
<span>             y <span class="op">=</span> <span class="va">SWC</span>,</span>
<span>             col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Metric</span>,</span>
<span>                          levels <span class="op">=</span> <span class="va">metrics</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">SSP</span>,</span>
<span>             nrow <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"Change in\nSafe Winter Chill\nsince 1980"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html">scale_color_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">model_labels</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span><span class="op">)</span> <span class="op">+</span> <span class="co"># display values as %</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Safe Winter Chill"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">chill_change_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/19.3a-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li>Now as a final step, we’ll convert this into a moving picture using the <code>transition_reveal</code> function from the <code>gganimate</code> package. We’ll save the resulting animation.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb324"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># library(gganimate) library(gifski) library(png) library(transformr)</span></span>
<span></span>
<span><span class="va">ccp</span> <span class="op">&lt;-</span> <span class="va">chill_change_plot</span> <span class="op">+</span> <span class="fu">transition_reveal</span><span class="op">(</span><span class="va">Year</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">animate</span><span class="op">(</span><span class="va">ccp</span>, fps <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">anim_save</span><span class="op">(</span><span class="st">"data/Bonn/Bonn_chill_comparison_animation.gif"</span>, animation <span class="op">=</span> <span class="fu">last_animation</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">include_graphics</span><span class="op">(</span><span class="st">"data/Bonn/Bonn_chill_comparison_animation.gif"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="data/Bonn/Bonn_chill_comparison_animation.gif" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li>Animation of chill development over time, relative to 1980 and evaluated with 13 chill models.</li>
</ul>
<p><br></p>
</section><section id="exercises-on-chill-model-comparison" class="level3"><h3 class="anchored" data-anchor-id="exercises-on-chill-model-comparison">
<span style="color:#71797E">19.4</span>&nbsp; Exercises on chill model comparison</h3>
<div style="height: 18px;">

</div>
<p><strong><em>1. Perform a similar analysis for the location you’ve chosen for your exercises.</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb325"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Make a list of models that calculate chilling using hourly temp data</span></span>
<span><span class="va">hourly_models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Chilling_units <span class="op">=</span> <span class="va">chilling_units</span>,</span>
<span>     Low_chill <span class="op">=</span> <span class="va">low_chill_model</span>,</span>
<span>     Modified_Utah <span class="op">=</span> <span class="va">modified_utah_model</span>,</span>
<span>     North_Carolina <span class="op">=</span> <span class="va">north_carolina_model</span>,</span>
<span>     Positive_Utah <span class="op">=</span> <span class="va">positive_utah_model</span>,</span>
<span>     Chilling_Hours <span class="op">=</span> <span class="va">Chilling_Hours</span>,</span>
<span>     Utah_Chill_Units <span class="op">=</span> <span class="va">Utah_Model</span>,</span>
<span>     Chill_Portions <span class="op">=</span> <span class="va">Dynamic_Model</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># list for daily models that use daily temp data</span></span>
<span><span class="va">daily_models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Rate_of_Chill <span class="op">=</span> <span class="va">rate_of_chill</span>,</span>
<span>                     Chill_Days <span class="op">=</span> <span class="va">chill_days</span>,</span>
<span>                     Exponential_Chill <span class="op">=</span> <span class="va">exponential_chill</span>,</span>
<span>                     Triangular_Chill_Legave <span class="op">=</span> <span class="va">triangular_chill_2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combines hourly and daily model names into a single vector</span></span>
<span><span class="va">metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">daily_models</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">hourly_models</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Give readable names</span></span>
<span><span class="va">model_labels</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Rate of Chill"</span>,</span>
<span>                 <span class="st">"Chill Days"</span>,</span>
<span>                 <span class="st">"Exponential Chill"</span>,</span>
<span>                 <span class="st">"Triangular Chill (Legave)"</span>,</span>
<span>                 <span class="st">"Chilling Units"</span>,</span>
<span>                 <span class="st">"Low-Chill Chill Units"</span>,</span>
<span>                 <span class="st">"Modified Utah Chill Units"</span>,</span>
<span>                 <span class="st">"North Carolina Chill Units"</span>,</span>
<span>                 <span class="st">"Positive Utah Chill Units"</span>,</span>
<span>                 <span class="st">"Chilling Hours"</span>,</span>
<span>                 <span class="st">"Utah Chill Units"</span>,</span>
<span>                 <span class="st">"Chill Portions"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load saved historical temp data for Mössingen</span></span>
<span><span class="va">MS_temps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/read_tab.html">read_tab</a></span><span class="op">(</span><span class="st">"data/MS/MS_patched_weather.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Temps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/load_temperature_scenarios.html">load_temperature_scenarios</a></span><span class="op">(</span><span class="st">"data/MS"</span>, <span class="st">"MS_hist_scenarios"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select JDays</span></span>
<span><span class="va">Start_JDay</span> <span class="op">&lt;-</span> <span class="fl">305</span></span>
<span><span class="va">End_JDay</span> <span class="op">&lt;-</span> <span class="fl">59</span></span>
<span></span>
<span><span class="co"># Compute metrics from model using daily temps as input(rather than hourly</span></span>
<span><span class="co"># temp)</span></span>
<span><span class="va">daily_models_past_scenarios</span> <span class="op">&lt;-</span> <span class="fu">tempResponse_list_daily</span><span class="op">(</span><span class="va">Temps</span>, </span>
<span>                                                       Start_JDay <span class="op">=</span> <span class="va">Start_JDay</span>,</span>
<span>                                                       End_JDay <span class="op">=</span> <span class="va">End_JDay</span>, </span>
<span>                                                       models <span class="op">=</span> <span class="va">daily_models</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter years with more than 90% temp data is available</span></span>
<span><span class="va">daily_models_past_scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">daily_models_past_scenarios</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Perc_complete</span> <span class="op">&gt;</span></span>
<span>    <span class="fl">90</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use chillR function to calculate from hourly temp data</span></span>
<span><span class="va">hourly_models_past_scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/tempResponse_daily_list.html">tempResponse_daily_list</a></span><span class="op">(</span><span class="va">Temps</span>, latitude <span class="op">=</span> <span class="fl">48.405</span>,</span>
<span>    Start_JDay <span class="op">=</span> <span class="va">Start_JDay</span>, End_JDay <span class="op">=</span> <span class="va">End_JDay</span>, models <span class="op">=</span> <span class="va">hourly_models</span>, </span>
<span>    misstolerance <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">past_scenarios</span> <span class="op">&lt;-</span> <span class="va">daily_models_past_scenarios</span></span>
<span></span>
<span><span class="co"># Combine daily and hourly results into a single dataset</span></span>
<span><span class="va">past_scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">past_scenarios</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">past_scenarios</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    <span class="va">hourly_models_past_scenarios</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">hourly_models</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Take the years</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">past_scenarios</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">daily_models_past_scenarios</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Produce a summarize data.frame of chill responses from daily chill models</span></span>
<span><span class="va">daily_models_observed</span> <span class="op">&lt;-</span> <span class="fu">tempResponse_daily</span><span class="op">(</span><span class="va">MS_temps</span>, Start_JDay <span class="op">=</span> <span class="va">Start_JDay</span>,</span>
<span>    End_JDay <span class="op">=</span> <span class="va">End_JDay</span>, models <span class="op">=</span> <span class="va">daily_models</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter only the records with more than 90% completeness</span></span>
<span><span class="va">daily_models_observed</span> <span class="op">&lt;-</span> <span class="va">daily_models_observed</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">daily_models_observed</span><span class="op">$</span><span class="va">Perc_complete</span> <span class="op">&gt;</span></span>
<span>    <span class="fl">90</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Calculation of climatic metrics from lists of daily temperature records</span></span>
<span><span class="co"># (hourly)</span></span>
<span><span class="va">hourly_models_observed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/tempResponse_daily_list.html">tempResponse_daily_list</a></span><span class="op">(</span><span class="va">MS_temps</span>, latitude <span class="op">=</span> <span class="fl">48.405</span>,</span>
<span>    Start_JDay <span class="op">=</span> <span class="va">Start_JDay</span>, End_JDay <span class="op">=</span> <span class="va">End_JDay</span>, models <span class="op">=</span> <span class="va">hourly_models</span>,</span>
<span>    misstolerance <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Bind the observed daily and hourly resutls with respective model names</span></span>
<span><span class="va">past_observed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">daily_models_observed</span>, </span>
<span>                       <span class="va">hourly_models_observed</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">hourly_models</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save data for later use</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/save_temperature_scenarios.html">save_temperature_scenarios</a></span><span class="op">(</span><span class="va">past_scenarios</span>, <span class="st">"data/MS/MS_future_climate"</span>, <span class="st">"MS_multichill_305_59_historic"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">past_observed</span>, <span class="st">"data/MS/MS_future_climate/MS_multichill_305_59_observed.csv"</span>,</span>
<span>    row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Do the same for future scenarios but in a loop</span></span>
<span></span>
<span><span class="co"># Load future data</span></span>
<span><span class="va">future_temps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/load_temperature_scenarios.html">load_temperature_scenarios</a></span><span class="op">(</span><span class="st">"data/MS/MS_future_climate"</span>, <span class="st">"MS_future_"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define SSP models and years</span></span>
<span><span class="va">SSPs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ssp126"</span>, <span class="st">"ssp245"</span>, <span class="st">"ssp370"</span>, <span class="st">"ssp585"</span><span class="op">)</span></span>
<span><span class="va">Times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2050</span>, <span class="fl">2085</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Split names for ssp models</span></span>
<span><span class="va">list_ssp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">future_temps</span><span class="op">)</span>, <span class="st">"\\."</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Split for model names</span></span>
<span><span class="va">list_gcm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">future_temps</span><span class="op">)</span>, <span class="st">"\\."</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Split the years</span></span>
<span><span class="va">list_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">future_temps</span><span class="op">)</span>, <span class="st">"\\."</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make loop to repeat for all 8 scenarios</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">SSP</span> <span class="kw">in</span> <span class="va">SSPs</span><span class="op">)</span> <span class="kw">for</span> <span class="op">(</span><span class="va">Time</span> <span class="kw">in</span> <span class="va">Times</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">Temps</span> <span class="op">&lt;-</span> <span class="va">future_temps</span><span class="op">[</span><span class="va">list_ssp</span> <span class="op">==</span> <span class="va">SSP</span> <span class="op">&amp;</span> <span class="va">list_time</span> <span class="op">==</span> <span class="va">Time</span><span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">Temps</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">list_gcm</span><span class="op">[</span><span class="va">list_ssp</span> <span class="op">==</span> <span class="va">SSP</span> <span class="op">&amp;</span> <span class="va">list_time</span> <span class="op">==</span> <span class="va">Time</span><span class="op">]</span></span>
<span>    <span class="va">daily_models_future_scenarios</span> <span class="op">&lt;-</span> <span class="fu">tempResponse_list_daily</span><span class="op">(</span><span class="va">Temps</span>, Start_JDay <span class="op">=</span> <span class="va">Start_JDay</span>,</span>
<span>        End_JDay <span class="op">=</span> <span class="va">End_JDay</span>, models <span class="op">=</span> <span class="va">daily_models</span><span class="op">)</span></span>
<span>    <span class="va">daily_models_future_scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">daily_models_future_scenarios</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">Perc_complete</span> <span class="op">&gt;</span></span>
<span>        <span class="fl">90</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">hourly_models_future_scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/tempResponse_daily_list.html">tempResponse_daily_list</a></span><span class="op">(</span><span class="va">Temps</span>, latitude <span class="op">=</span> <span class="fl">48.405</span>,</span>
<span>        Start_JDay <span class="op">=</span> <span class="va">Start_JDay</span>, End_JDay <span class="op">=</span> <span class="va">End_JDay</span>, models <span class="op">=</span> <span class="va">hourly_models</span>, misstolerance <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">future_scenarios</span> <span class="op">&lt;-</span> <span class="va">daily_models_future_scenarios</span></span>
<span></span>
<span>    <span class="va">future_scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">future_scenarios</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">future_scenarios</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>,</span>
<span>        <span class="va">hourly_models_future_scenarios</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">hourly_models</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">future_scenarios</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">daily_models_future_scenarios</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">chill</span> <span class="op">&lt;-</span> <span class="va">future_scenarios</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/save_temperature_scenarios.html">save_temperature_scenarios</a></span><span class="op">(</span><span class="va">chill</span>, <span class="st">"data/MS/MS_future_climate"</span>, </span>
<span>                               <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"MS_multichill_305_59_"</span>, <span class="va">Time</span>, <span class="st">"_"</span>, <span class="va">SSP</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">chill_past_scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/load_temperature_scenarios.html">load_temperature_scenarios</a></span><span class="op">(</span></span>
<span>  <span class="st">"data/MS/MS_future_climate"</span>,</span>
<span>  <span class="st">"MS_multichill_305_59_historic"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">chill_observed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/read_tab.html">read_tab</a></span><span class="op">(</span></span>
<span>  <span class="st">"data/MS/MS_future_climate/MS_multichill_305_59_observed.csv"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Make climate scenarios for plotting from a list of climate metric data </span></span>
<span><span class="co"># produced by tempResponse_daily_list, for example</span></span>
<span><span class="va">chills</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/make_climate_scenario.html">make_climate_scenario</a></span><span class="op">(</span><span class="va">chill_past_scenarios</span>,</span>
<span>                                caption <span class="op">=</span> <span class="st">"Historical"</span>,</span>
<span>                                historic_data <span class="op">=</span> <span class="va">chill_observed</span>,</span>
<span>                                time_series <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add this again to knit better</span></span>
<span><span class="va">SSPs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ssp126"</span>, <span class="st">"ssp245"</span>,<span class="st">"ssp370"</span>, <span class="st">"ssp585"</span><span class="op">)</span></span>
<span><span class="va">Times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2050</span>, <span class="fl">2085</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create loops for future scenarios</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">SSP</span> <span class="kw">in</span> <span class="va">SSPs</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">Time</span> <span class="kw">in</span> <span class="va">Times</span><span class="op">)</span></span>
<span>    <span class="op">{</span> <span class="co"># load future climate scenarios with designated file names</span></span>
<span>    <span class="va">chill</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/load_temperature_scenarios.html">load_temperature_scenarios</a></span><span class="op">(</span></span>
<span>      <span class="st">"data/MS/MS_future_climate"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"MS_multichill_305_59_"</span>,<span class="va">Time</span>,<span class="st">"_"</span>,<span class="va">SSP</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp126"</span><span class="op">)</span> <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP1"</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp245"</span><span class="op">)</span> <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP2"</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp370"</span><span class="op">)</span> <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP3"</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp585"</span><span class="op">)</span> <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP5"</span>    </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">Time</span> <span class="op">==</span> <span class="st">"2050"</span><span class="op">)</span> <span class="va">Time_caption</span> <span class="op">&lt;-</span> <span class="st">"2050"</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">Time</span> <span class="op">==</span> <span class="st">"2085"</span><span class="op">)</span> <span class="va">Time_caption</span> <span class="op">&lt;-</span> <span class="st">"2085"</span></span>
<span>    <span class="va">chills</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/make_climate_scenario.html">make_climate_scenario</a></span><span class="op">(</span><span class="va">chill</span>,</span>
<span>                                    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">SSPcaption</span>,</span>
<span>                                                <span class="va">Time_caption</span><span class="op">)</span>,</span>
<span>                                    add_to <span class="op">=</span> <span class="va">chills</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co"># Since all the chill models have different units, and numeric values differ </span></span>
<span><span class="co"># greatly across the models, we normalize all the results, expressing them as </span></span>
<span><span class="co"># changes relative to a 2005 baseline:</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">chills</span><span class="op">)</span><span class="op">)</span></span>
<span>   <span class="op">{</span><span class="va">ch</span> <span class="op">&lt;-</span> <span class="va">chills</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>   <span class="kw">if</span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">caption</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Historical"</span><span class="op">)</span></span>
<span>     <span class="op">{</span><span class="va">GCMs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"none"</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">SSPs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"none"</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">Years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">labels</span><span class="op">)</span></span>
<span>      <span class="va">Scenario</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Historical"</span>,</span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">}</span> <span class="kw">else</span></span>
<span>                        <span class="op">{</span><span class="va">GCMs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span>                        <span class="va">SSPs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">caption</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                                    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>                        <span class="va">Years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">caption</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                                     <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>                        <span class="va">Scenario</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Future"</span>,</span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span>
<span>   <span class="kw">for</span><span class="op">(</span><span class="va">nam</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="op">{</span><span class="kw">for</span><span class="op">(</span><span class="va">met</span> <span class="kw">in</span> <span class="va">metrics</span><span class="op">)</span></span>
<span>       <span class="op">{</span><span class="va">temp_res</span> <span class="op">&lt;-</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Metric <span class="op">=</span> <span class="va">met</span>,</span>
<span>                    GCM <span class="op">=</span> <span class="va">GCMs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">nam</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                    SSP <span class="op">=</span> <span class="va">SSPs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">nam</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                    Year <span class="op">=</span> <span class="va">Years</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">nam</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                    Result <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="va">nam</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">met</span><span class="op">]</span>,<span class="fl">0.1</span><span class="op">)</span>, </span>
<span>                    Scenario <span class="op">=</span> <span class="va">Scenario</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">nam</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>       <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">nam</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">met</span> <span class="op">==</span> <span class="va">metrics</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>         <span class="va">results</span> <span class="op">&lt;-</span> <span class="va">temp_res</span> <span class="kw">else</span></span>
<span>           <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">results</span>,</span>
<span>                            <span class="va">temp_res</span><span class="op">)</span></span>
<span>         <span class="op">}</span></span>
<span>     <span class="op">}</span></span>
<span>   <span class="op">}</span></span>
<span></span>
<span><span class="co"># Normalize the results by dividing with the 2000 baseline value</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">met</span> <span class="kw">in</span> <span class="va">metrics</span><span class="op">)</span></span>
<span>  <span class="va">results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Metric</span> <span class="op">==</span> <span class="va">met</span><span class="op">)</span>,<span class="st">"SWC"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Metric</span> <span class="op">==</span> <span class="va">met</span><span class="op">)</span>,<span class="st">"Result"</span><span class="op">]</span><span class="op">/</span></span>
<span>      <span class="va">results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Metric</span> <span class="op">==</span> <span class="va">met</span> <span class="op">&amp;</span> <span class="va">results</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="fl">2000</span><span class="op">)</span>,</span>
<span>              <span class="st">"Result"</span><span class="op">]</span><span class="op">-</span><span class="fl">1</span> </span>
<span></span>
<span><span class="co"># Get the minimum and maximum values using range function</span></span>
<span><span class="va">rng</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">SWC</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">p_future</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">results</span><span class="op">$</span><span class="va">GCM</span> <span class="op">==</span> <span class="st">"none"</span><span class="op">)</span>,<span class="op">]</span>, <span class="co"># future ones</span></span>
<span>                   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">GCM</span>,</span>
<span>                       y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Metric</span>, <span class="co"># factor as categorical data </span></span>
<span>                                  levels <span class="op">=</span> <span class="va">metrics</span><span class="op">)</span>, <span class="co"># follow order in metrics</span></span>
<span>                       fill <span class="op">=</span> <span class="va">SWC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">SSP</span> <span class="op">~</span> <span class="va">Year</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu">matlab.like</span><span class="op">(</span><span class="fl">15</span><span class="op">)</span>,</span>
<span>                       labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span>,</span>
<span>                       limits <span class="op">=</span> <span class="va">rng</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">75</span>, </span>
<span>                                   hjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                   vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Change in\nSafe Winter Chill\nsince 2005"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_y_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">model_labels</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Chill metric"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_future</span></span>
<span></span>
<span><span class="co"># Plot for past scenarios</span></span>
<span><span class="va">p_past</span><span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">GCM</span> <span class="op">==</span> <span class="st">"none"</span><span class="op">)</span>,<span class="op">]</span>,</span>
<span>         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Year</span>,</span>
<span>             y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Metric</span>, </span>
<span>                        levels<span class="op">=</span><span class="va">metrics</span><span class="op">)</span>,</span>
<span>             fill <span class="op">=</span> <span class="va">SWC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_past</span><span class="op">&lt;-</span></span>
<span>  <span class="va">p_past</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu">matlab.like</span><span class="op">(</span><span class="fl">15</span><span class="op">)</span>,</span>
<span>                       labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span>,</span>
<span>                       limits <span class="op">=</span> <span class="va">rng</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Change in\nSafe Winter Chill\nsince 2000"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_y_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">model_labels</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Chill metric"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_past</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/19.4.1b-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/19.4.1b-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p><strong><em>2. Make a heat map illustrating past and future changes in Safe Winter Chill, relative to a past scenario, for the 13 chill models used here.</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb326"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chill_past_scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/load_temperature_scenarios.html">load_temperature_scenarios</a></span><span class="op">(</span></span>
<span>  <span class="st">"data/MS/MS_future_climate"</span>,</span>
<span>  <span class="st">"MS_multichill_305_59_historic"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">chill_observed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/read_tab.html">read_tab</a></span><span class="op">(</span></span>
<span>  <span class="st">"data/MS/MS_future_climate/MS_multichill_305_59_observed.csv"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Make climate scenarios for plotting from a list of climate metric data </span></span>
<span><span class="co"># produced by tempResponse_daily_list, for example</span></span>
<span><span class="va">chills</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/make_climate_scenario.html">make_climate_scenario</a></span><span class="op">(</span><span class="va">chill_past_scenarios</span>,</span>
<span>                                caption <span class="op">=</span> <span class="st">"Historical"</span>,</span>
<span>                                historic_data <span class="op">=</span> <span class="va">chill_observed</span>,</span>
<span>                                time_series <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add this again to knit better</span></span>
<span><span class="va">SSPs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ssp126"</span>, <span class="st">"ssp245"</span>,<span class="st">"ssp370"</span>, <span class="st">"ssp585"</span><span class="op">)</span></span>
<span><span class="va">Times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2050</span>, <span class="fl">2085</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create loops for future scenarios</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">SSP</span> <span class="kw">in</span> <span class="va">SSPs</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">Time</span> <span class="kw">in</span> <span class="va">Times</span><span class="op">)</span></span>
<span>    <span class="op">{</span> <span class="co"># load future climate scenarios with designated file names</span></span>
<span>    <span class="va">chill</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/load_temperature_scenarios.html">load_temperature_scenarios</a></span><span class="op">(</span></span>
<span>      <span class="st">"data/MS/MS_future_climate"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"MS_multichill_305_59_"</span>,<span class="va">Time</span>,<span class="st">"_"</span>,<span class="va">SSP</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp126"</span><span class="op">)</span> <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP1"</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp245"</span><span class="op">)</span> <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP2"</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp370"</span><span class="op">)</span> <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP3"</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">SSP</span> <span class="op">==</span> <span class="st">"ssp585"</span><span class="op">)</span> <span class="va">SSPcaption</span> <span class="op">&lt;-</span> <span class="st">"SSP5"</span>    </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">Time</span> <span class="op">==</span> <span class="st">"2050"</span><span class="op">)</span> <span class="va">Time_caption</span> <span class="op">&lt;-</span> <span class="st">"2050"</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">Time</span> <span class="op">==</span> <span class="st">"2085"</span><span class="op">)</span> <span class="va">Time_caption</span> <span class="op">&lt;-</span> <span class="st">"2085"</span></span>
<span>    <span class="va">chills</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/make_climate_scenario.html">make_climate_scenario</a></span><span class="op">(</span><span class="va">chill</span>,</span>
<span>                                    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">SSPcaption</span>,</span>
<span>                                                <span class="va">Time_caption</span><span class="op">)</span>,</span>
<span>                                    add_to <span class="op">=</span> <span class="va">chills</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co"># Since all the chill models have different units, and numeric values differ </span></span>
<span><span class="co"># greatly across the models, we normalize all the results, expressing them as </span></span>
<span><span class="co"># changes relative to a 2005 baseline:</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">chills</span><span class="op">)</span><span class="op">)</span></span>
<span>   <span class="op">{</span><span class="va">ch</span> <span class="op">&lt;-</span> <span class="va">chills</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>   <span class="kw">if</span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">caption</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">==</span> <span class="st">"Historical"</span><span class="op">)</span></span>
<span>     <span class="op">{</span><span class="va">GCMs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"none"</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">SSPs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"none"</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">Years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">labels</span><span class="op">)</span></span>
<span>      <span class="va">Scenario</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Historical"</span>,</span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">}</span> <span class="kw">else</span></span>
<span>                        <span class="op">{</span><span class="va">GCMs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span>                        <span class="va">SSPs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">caption</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                                    <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>                        <span class="va">Years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">caption</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                                     <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>                        <span class="va">Scenario</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Future"</span>,</span>
<span>                                        <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span>
<span>   <span class="kw">for</span><span class="op">(</span><span class="va">nam</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="op">{</span><span class="kw">for</span><span class="op">(</span><span class="va">met</span> <span class="kw">in</span> <span class="va">metrics</span><span class="op">)</span></span>
<span>       <span class="op">{</span><span class="va">temp_res</span> <span class="op">&lt;-</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Metric <span class="op">=</span> <span class="va">met</span>,</span>
<span>                    GCM <span class="op">=</span> <span class="va">GCMs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">nam</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                    SSP <span class="op">=</span> <span class="va">SSPs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">nam</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                    Year <span class="op">=</span> <span class="va">Years</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">nam</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                    Result <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="va">nam</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">met</span><span class="op">]</span>,<span class="fl">0.1</span><span class="op">)</span>, </span>
<span>                    Scenario <span class="op">=</span> <span class="va">Scenario</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">nam</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>       <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">nam</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ch</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">met</span> <span class="op">==</span> <span class="va">metrics</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>         <span class="va">results</span> <span class="op">&lt;-</span> <span class="va">temp_res</span> <span class="kw">else</span></span>
<span>           <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">results</span>,</span>
<span>                            <span class="va">temp_res</span><span class="op">)</span></span>
<span>         <span class="op">}</span></span>
<span>     <span class="op">}</span></span>
<span>   <span class="op">}</span></span>
<span></span>
<span><span class="co"># Normalize the results by dividing with the 2000 baseline value</span></span>
<span><span class="co"># I couldn't use 2005 coz (I think) historical data for 2005 is not saved as csv?</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">met</span> <span class="kw">in</span> <span class="va">metrics</span><span class="op">)</span></span>
<span>  <span class="va">results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Metric</span> <span class="op">==</span> <span class="va">met</span><span class="op">)</span>,<span class="st">"SWC"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Metric</span> <span class="op">==</span> <span class="va">met</span><span class="op">)</span>,<span class="st">"Result"</span><span class="op">]</span><span class="op">/</span></span>
<span>      <span class="va">results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">Metric</span> <span class="op">==</span> <span class="va">met</span> <span class="op">&amp;</span> <span class="va">results</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="fl">2000</span><span class="op">)</span>,</span>
<span>              <span class="st">"Result"</span><span class="op">]</span><span class="op">-</span><span class="fl">1</span> </span>
<span></span>
<span><span class="co"># Get the minimum and maximum values using range function</span></span>
<span><span class="va">rng</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">SWC</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">p_future</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">results</span><span class="op">$</span><span class="va">GCM</span> <span class="op">==</span> <span class="st">"none"</span><span class="op">)</span>,<span class="op">]</span>, <span class="co"># future ones</span></span>
<span>                   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">GCM</span>,</span>
<span>                       y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Metric</span>, <span class="co"># factor as categorical data </span></span>
<span>                                  levels <span class="op">=</span> <span class="va">metrics</span><span class="op">)</span>, <span class="co"># follow order in metrics</span></span>
<span>                       fill <span class="op">=</span> <span class="va">SWC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">SSP</span> <span class="op">~</span> <span class="va">Year</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu">matlab.like</span><span class="op">(</span><span class="fl">15</span><span class="op">)</span>,</span>
<span>                       labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span>,</span>
<span>                       limits <span class="op">=</span> <span class="va">rng</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">75</span>, </span>
<span>                                   hjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                   vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Change in\nSafe Winter Chill\nsince 2000"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_y_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">model_labels</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Chill metric"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Plot for past scenarios</span></span>
<span><span class="va">p_past</span><span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">GCM</span> <span class="op">==</span> <span class="st">"none"</span><span class="op">)</span>,<span class="op">]</span>,</span>
<span>         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Year</span>,</span>
<span>             y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Metric</span>, </span>
<span>                        levels<span class="op">=</span><span class="va">metrics</span><span class="op">)</span>,</span>
<span>             fill <span class="op">=</span> <span class="va">SWC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_past</span><span class="op">&lt;-</span></span>
<span>  <span class="va">p_past</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu">matlab.like</span><span class="op">(</span><span class="fl">15</span><span class="op">)</span>,</span>
<span>                       labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span>,</span>
<span>                       limits <span class="op">=</span> <span class="va">rng</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Change in\nSafe Winter Chill\nsince 2000"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_y_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">model_labels</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Chill metric"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now we can combine the plots. We’ll again use the patchwork package for this. </span></span>
<span><span class="co"># Mainly the plots are now on top of each other (nrow=2, with relative heights </span></span>
<span><span class="co"># specified by heights=c(1,2)). </span></span>
<span><span class="va">chill_comp_plot</span><span class="op">&lt;-</span></span>
<span>  <span class="op">(</span><span class="va">p_past</span> <span class="op">+</span></span>
<span>     <span class="va">p_future</span> <span class="op">+</span></span>
<span>     <span class="co"># collect guides below to the given nesting level, removing duplicates/</span></span>
<span>     <span class="co"># collect all legends from two plots into a single legend</span></span>
<span>     <span class="fu">plot_layout</span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span>, </span>
<span>                 nrow <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                 heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span>,</span>
<span>        strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">chill_comp_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/19.4.2-1.png" style="width:100.0%;height:100.0%" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p><strong><em>3. Produce an animated line plot of your results (summarizing Safe Winter Chill across all the GCMs).</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb327"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Copy historical data for each SSP and then bind into data frame</span></span>
<span><span class="va">hist_results</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">GCM</span> <span class="op">==</span> <span class="st">"none"</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">hist_results</span><span class="op">$</span><span class="va">SSP</span> <span class="op">&lt;-</span> <span class="st">"SSP1"</span></span>
<span><span class="va">hist_results_2</span> <span class="op">&lt;-</span> <span class="va">hist_results</span></span>
<span><span class="va">hist_results_2</span><span class="op">$</span><span class="va">SSP</span> <span class="op">&lt;-</span> <span class="st">"SSP2"</span></span>
<span><span class="va">hist_results_3</span> <span class="op">&lt;-</span> <span class="va">hist_results</span></span>
<span><span class="va">hist_results_3</span><span class="op">$</span><span class="va">SSP</span> <span class="op">&lt;-</span> <span class="st">"SSP3"</span></span>
<span><span class="va">hist_results_4</span> <span class="op">&lt;-</span> <span class="va">hist_results</span></span>
<span><span class="va">hist_results_4</span><span class="op">$</span><span class="va">SSP</span> <span class="op">&lt;-</span> <span class="st">"SSP5"</span></span>
<span><span class="va">hist_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">hist_results</span>,</span>
<span>                      <span class="va">hist_results_2</span>,</span>
<span>                      <span class="va">hist_results_3</span>,</span>
<span>                      <span class="va">hist_results_4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">future_results</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">results</span><span class="op">$</span><span class="va">GCM</span> <span class="op">==</span> <span class="st">"none"</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Compute summary statistics of data subsets</span></span>
<span><span class="va">GCM_aggregate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span></span>
<span>  <span class="va">future_results</span><span class="op">$</span><span class="va">SWC</span>,</span>
<span>  by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">future_results</span><span class="op">$</span><span class="va">Metric</span>, </span>
<span>          <span class="va">future_results</span><span class="op">$</span><span class="va">SSP</span>,</span>
<span>          <span class="va">future_results</span><span class="op">$</span><span class="va">Year</span><span class="op">)</span>,</span>
<span>  FUN<span class="op">=</span><span class="va">mean</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Rename the columns</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">GCM_aggregate</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Metric"</span>,</span>
<span>                             <span class="st">"SSP"</span>,</span>
<span>                             <span class="st">"Year"</span>,</span>
<span>                             <span class="st">"SWC"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Combine historical SWC data (for SSPs) and mean future SWC projection </span></span>
<span><span class="va">SSP_Time_series</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">hist_results</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Metric"</span>,</span>
<span>                                       <span class="st">"SSP"</span>,</span>
<span>                                       <span class="st">"Year"</span>,</span>
<span>                                       <span class="st">"SWC"</span><span class="op">)</span><span class="op">]</span>, </span>
<span>                       <span class="va">GCM_aggregate</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Make sure all are numeric years</span></span>
<span><span class="va">SSP_Time_series</span><span class="op">$</span><span class="va">Year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">SSP_Time_series</span><span class="op">$</span><span class="va">Year</span><span class="op">)</span></span>
<span></span>
<span><span class="va">chill_change_plot</span><span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">SSP_Time_series</span>,</span>
<span>         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span>,</span>
<span>             y <span class="op">=</span> <span class="va">SWC</span>,</span>
<span>             col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Metric</span>,</span>
<span>                          levels <span class="op">=</span> <span class="va">metrics</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">SSP</span>,</span>
<span>             nrow <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"Change in\nSafe Winter Chill\nsince 2000"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html">scale_color_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">model_labels</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span><span class="op">)</span> <span class="op">+</span> <span class="co"># display values as %</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Safe Winter Chill"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">ccp</span> <span class="op">&lt;-</span> <span class="va">chill_change_plot</span> <span class="op">+</span> <span class="fu">transition_reveal</span><span class="op">(</span><span class="va">Year</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">animate</span><span class="op">(</span><span class="va">ccp</span>, fps <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">anim_save</span><span class="op">(</span><span class="st">"data/MS/MS_chill_comparison_animation.gif"</span>, animation <span class="op">=</span> <span class="fu">last_animation</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">include_graphics</span><span class="op">(</span><span class="st">"data/MS/MS_chill_comparison_animation.gif"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="data/MS/MS_chill_comparison_animation.gif" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p><em>Check and add details later.</em></p>
<p><br></p>
</section></section><section id="chapter-20-simple-phenology-analysis" class="level2"><h2 class="anchored" data-anchor-id="chapter-20-simple-phenology-analysis">Chapter 20: Simple phenology analysis</h2>
<section id="phenology-analysis" class="level3"><h3 class="anchored" data-anchor-id="phenology-analysis">
<span style="color:#71797E">20.1</span>&nbsp; Phenology analysis</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>Finally, we will seriously start analyzing phenology, using the example of bloom dates of the pear cultivar <em>Alexander Lucas</em> that we already worked with in the frost analysis.</p></li>
<li><p>As you may remember, we have a time series of first, full and last bloom dates recorded at Campus Klein-Altendorf between 1958 and 2019. For this analysis, I’ll just use the first bloom dates:</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb328"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Alex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/read_tab.html">read_tab</a></span><span class="op">(</span><span class="st">"data/OT/Alexander_Lucas_bloom_1958_2019.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Collapse First_bloom to Last_bloom columns into rows</span></span>
<span><span class="va">Alex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="va">Alex</span>,</span>
<span>                     cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">First_bloom</span><span class="op">:</span><span class="va">Last_bloom</span><span class="op">)</span>,</span>
<span>                     names_to <span class="op">=</span> <span class="st">"Stage"</span>,</span>
<span>                     values_to <span class="op">=</span> <span class="st">"YEARMODA"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Alex_first</span> <span class="op">&lt;-</span> <span class="va">Alex</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">YEARMODA</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>, <span class="co"># add year, month and day columns</span></span>
<span>         Month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">YEARMODA</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         Day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">YEARMODA</span>, <span class="fl">7</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/make_JDay.html">make_JDay</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># JDay column</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Stage</span> <span class="op">==</span> <span class="st">"First_bloom"</span><span class="op">)</span> <span class="co"># only select the data for First_bloom </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section><section id="time-series-analysis" class="level3"><h3 class="anchored" data-anchor-id="time-series-analysis">
<span style="color:#71797E">20.2</span>&nbsp; Time series analysis</h3>
<div style="height: 18px;">

</div>
<ul>
<li>The first analysis people often do with such a dataset is a simple analysis over time. Let’s first plot the data:</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb329"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Alex_first</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Pheno_year</span>, <span class="va">JDay</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"First bloom date (day of the year)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Year"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/20.2a-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li>It’s a bit hard to see a clear pattern here, but let’s check if there is a trend over time using the Kendall test.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb330"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># library(Kendall)</span></span>
<span><span class="fu">Kendall</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Alex_first</span><span class="op">$</span><span class="va">Pheno_year</span>, y <span class="op">=</span> <span class="va">Alex_first</span><span class="op">$</span><span class="va">JDay</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>tau = -0.186, 2-sided pvalue =0.03533</code></pre>
</div>
</div>
<ul>
<li><p>p-value is 0.035 and the tau value is negative, so it seems we have a significant trend towards earlier bloom.</p></li>
<li><p>To determine how strong this trend is, many researchers use regression analysis, with model coefficients fitted to data. To do that, we first assume a linear relationship between time and bloom dates:</p></li>
</ul>
<p><span class="math display">\[Bloomdate = a ~.~ Phenoyear + b\]</span></p>
<ul>
<li>To make the code easier to read, name the Pheno_year <code>x</code> and the Bloom date (JDay) <code>y</code>
</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb332"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">Alex_first</span><span class="op">$</span><span class="va">Pheno_year</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">Alex_first</span><span class="op">$</span><span class="va">JDay</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x)

Residuals:
     Min       1Q   Median       3Q      Max 
-30.0959  -6.3591  -0.5959   6.6468  20.1238 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept) 429.16615  142.06000   3.021   0.0037 **
x            -0.16184    0.07144  -2.266   0.0271 * 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 10.07 on 60 degrees of freedom
Multiple R-squared:  0.0788,    Adjusted R-squared:  0.06345 
F-statistic: 5.133 on 1 and 60 DF,  p-value: 0.0271</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb334"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># We get the best estimate for the slope of -0.16 and also a p-value.  But, for</span></span>
<span><span class="co"># a time series we're better off using the one returned by Kendall test.</span></span>
<span></span>
<span><span class="co"># Plot the data</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Alex_first</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Year</span>, <span class="va">JDay</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span></span>
<span>    <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"First bloom date (day of the year)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Year"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/20.2c-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li><p>In the diagram, many of the data points are still pretty far from the regression line, with many of them way outside the confidence interval that is shown.</p></li>
<li><p>Maybe we can find another model that better describes the data, e.g.&nbsp;by fitting a second-order polynomial, or maybe a third-order polynomial… Let’s cut this process short and immediately fit a 25th-order polynomial:</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb335"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ poly(x, 25))

Residuals:
     Min       1Q   Median       3Q      Max 
-13.7311  -4.5098  -0.1227   2.8640  15.4590 

Coefficients:
              Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept)   107.3387     1.0549 101.753 &lt; 0.0000000000000002 ***
poly(x, 25)1  -22.8054     8.3063  -2.746              0.00937 ** 
poly(x, 25)2   -5.8672     8.3063  -0.706              0.48451    
poly(x, 25)3   14.7725     8.3063   1.778              0.08377 .  
poly(x, 25)4   -5.3974     8.3063  -0.650              0.51995    
poly(x, 25)5  -11.6801     8.3063  -1.406              0.16825    
poly(x, 25)6    2.1928     8.3063   0.264              0.79329    
poly(x, 25)7   -0.3034     8.3063  -0.037              0.97107    
poly(x, 25)8    6.0115     8.3063   0.724              0.47391    
poly(x, 25)9  -22.2895     8.3063  -2.683              0.01094 *  
poly(x, 25)10   5.9522     8.3063   0.717              0.47825    
poly(x, 25)11  -6.1217     8.3063  -0.737              0.46590    
poly(x, 25)12   3.2676     8.3063   0.393              0.69636    
poly(x, 25)13 -14.8467     8.3063  -1.787              0.08229 .  
poly(x, 25)14  13.5180     8.3063   1.627              0.11237    
poly(x, 25)15  10.1544     8.3063   1.222              0.22946    
poly(x, 25)16 -12.6116     8.3063  -1.518              0.13767    
poly(x, 25)17  -1.3315     8.3063  -0.160              0.87354    
poly(x, 25)18  -6.3438     8.3063  -0.764              0.45000    
poly(x, 25)19  14.9753     8.3063   1.803              0.07978 .  
poly(x, 25)20   3.4573     8.3063   0.416              0.67972    
poly(x, 25)21 -29.1997     8.3063  -3.515              0.00121 ** 
poly(x, 25)22  10.4145     8.3063   1.254              0.21799    
poly(x, 25)23   2.9898     8.3063   0.360              0.72100    
poly(x, 25)24 -14.3045     8.3063  -1.722              0.09363 .  
poly(x, 25)25 -20.9324     8.3063  -2.520              0.01631 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 8.306 on 36 degrees of freedom
Multiple R-squared:  0.6237,    Adjusted R-squared:  0.3623 
F-statistic: 2.386 on 25 and 36 DF,  p-value: 0.008421</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb337"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Plot the data</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Alex_first</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Year</span>, <span class="va">JDay</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"First bloom date (day of the year)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Year"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/20.2d-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li><p>It’s a bit hard now to make a clear statement about the temporal trend, since there is no single number for the slope. The slope varies over time, but it can be calculated by taking the first derivative of the complex 25th-order polynomial we computed. But we got a stellar p-value, and almost all of the data points are contained in the confidence interval!</p></li>
<li><p>But, it is obvious that this is not a useful model. If we make the model equation increasingly more complex, we’ll eventually find a structure that can perfectly fit all data points. This is not desirable, however, because we have no reason to expect that there is such a perfect relationship between our independent and dependent variables.</p></li>
<li><p>Each measurement (such as a bloom date recording) comes with an error, and, more importantly, there may also be other factors in addition to time that affect bloom dates. If we make our model more complex than we can reasonably expect the actual relationship to be, we run the risk of <strong>overfitting</strong> our model.</p></li>
<li><p>This means that we may get a very good fit, but our regression equation isn’t very useful for explaining the actual process we’re trying to model.</p></li>
</ul>
<p><br></p>
</section><section id="p-hacking" class="level3"><h3 class="anchored" data-anchor-id="p-hacking">
<span style="color:#71797E">20.3</span>&nbsp; p-hacking</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>A concept that is closely related to overfitting and that also often occurs in machine-learning is that of <em>p-hacking</em>, also known as a <em>fishing expedition</em>.</p></li>
<li><p>The idea behind these terms is that when you look at a sufficiently large dataset, with lots of variables, you’re bound to find correlations somewhere in this dataset, regardless of whether your data involves actual causal relationships.</p></li>
<li><p>Screening large datasets for ‘significant’ relationships and then presenting these as meaningful correlations is bad scientific practice (<a href="https://www.nature.com/articles/506150a">Nuzzo, 2014</a>). Possibly, such screening can lead to hypotheses that can then be tested through further studies, but we should not rely on this to generate ‘facts’.</p></li>
</ul>
<p><br></p>
</section><section id="the-process-that-generates-the-data" class="level3"><h3 class="anchored" data-anchor-id="the-process-that-generates-the-data">
<span style="color:#71797E">20.4</span>&nbsp; The process that generates the data</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>Many researchers are focused on finding structure in the datasets they work with. What we really want to understand is <strong><em>the process that generates the data</em></strong>, rather than the data themselves.</p></li>
<li><p>Rather than digging straight into the numbers, we first need to sit back and think about what may actually be going on in the system we’re analyzing. We can then use causal diagrams to sketch out how we think our system works:</p></li>
</ul>
<p><span class="math display">\[A \rightarrow B\]</span></p>
<ul>
<li>Up to now, we were looking for the following relationship:</li>
</ul>
<p><span class="math display">\[Time \rightarrow Phenology\]</span></p>
<ul>
<li>Can this possibly be what’s going on here? Can time drive phenology? While I won’t completely rule out that trees are somehow able to track the passage of time within their annual cycle, I’m pretty sure they have no idea what the current year is…</li>
</ul>
<p><br></p>
</section><section id="an-ecological-theory-to-guide-our-analysis" class="level3"><h3 class="anchored" data-anchor-id="an-ecological-theory-to-guide-our-analysis">
<span style="color:#71797E">20.5</span>&nbsp; An ecological theory to guide our analysis</h3>
<div style="height: 18px;">

</div>
<ul>
<li>Temperature drives phenology:</li>
</ul>
<p><span class="math display">\[Temperature \rightarrow Phenology\]</span></p>
<ul>
<li>As you can see, this theory doesn’t involve time. The reason why we were able to find statistical relationships earlier is not that time (as in the calendar year) actually affects phenology— it is that temperatures have been rising over the years, mainly in response to anthropogenic global warming.</li>
</ul>
<p><span class="math display">\[Time \rightarrow Temperature\]</span></p>
<ul>
<li>Actually this is:</li>
</ul>
<p><span class="math display">\[Time \rightarrow Greenhouse~Gas~Concentrations \rightarrow Climate~Forcing \rightarrow Temperature\]</span></p>
<ul>
<li><p>Since temperature, especially at the local scale, is subject to considerable random variation, this relationship may not be particularly strong. The noise in this relationship can easily keep us from detecting the actual response of tree phenology during our time series.</p></li>
<li><p>The full causal diagram of these three variables (without the greenhouse effect part) is:</p></li>
</ul>
<p><span class="math display">\[Time \rightarrow Temperature \rightarrow Phenology\]</span></p>
<ul>
<li>Sometimes we have no data on the intermediate steps in such a diagram. In such cases, we either have to live with a model that doesn’t actually get to the direct causal mechanisms in play, or we have to get a bit more creative with our analysis. Fortunately, here we actually do have data on temperature, so we can focus on the direct causal relationship between temperature and phenology.</li>
</ul>
<p><br></p>
</section><section id="temperature-correlations" class="level3"><h3 class="anchored" data-anchor-id="temperature-correlations">
<span style="color:#71797E">20.6</span>&nbsp; Temperature correlations</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>Now that we have clarified that it would make more sense to narrow in on the temperature-phenology relationship, we gained some conceptual clarity, but we are faced with a much greater statistical challenge.</p></li>
<li><p>In correlating years with bloom dates, we had just two series of numbers to look at, since we had exactly one bloom date per year.</p></li>
<li><p>Temperature, in contrast, is a variable we can measure at different temporal scales. If we just look at the average annual temperature, the statistical challenge is similar to using just the year number.</p></li>
<li><p>Let’s see if we can find a correlation for this.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb338"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">temperature</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/read_tab.html">read_tab</a></span><span class="op">(</span><span class="st">"data/OT/TMaxTMin1958-2019_patched.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Group data by year and calculate mean of Tmin for each year</span></span>
<span><span class="va">Tmin</span> <span class="op">&lt;-</span> <span class="va">temperature</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>Tmin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Tmin</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Group data by year and calculate mean of Tmax for each year</span></span>
<span><span class="va">Tmax</span> <span class="op">&lt;-</span> <span class="va">temperature</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>Tmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Tmax</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a dataframe with year, Tmin, Tmax and Tmean columns</span></span>
<span><span class="va">Annual_means</span> <span class="op">&lt;-</span> <span class="va">Tmin</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Tmax</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># select only the Tmax column (excluding year column)</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Tmean <span class="op">=</span> <span class="op">(</span><span class="va">Tmin</span> <span class="op">+</span> <span class="va">Tmax</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Merge with Alex_first dataset</span></span>
<span><span class="va">Annual_means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">Annual_means</span>,</span>
<span>                      <span class="va">Alex_first</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Modify dataset for ggplot with pivot_longer</span></span>
<span><span class="va">Annual_means_longer</span> <span class="op">&lt;-</span> <span class="va">Annual_means</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,<span class="fl">10</span><span class="op">)</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># First 4 and 10th columns</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Tmin</span><span class="op">:</span><span class="va">Tmean</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"Variable"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"Temp"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Annual_means_longer</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Temp</span>,</span>
<span>           y<span class="op">=</span><span class="va">JDay</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"lm"</span>,</span>
<span>              formula<span class="op">=</span><span class="va">y</span><span class="op">~</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="st">"Variable"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/20.6a-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb339"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Simple linear regression between JDay (dependent/response variable, Y) and </span></span>
<span><span class="co"># Tmax (independent/predictor variable, X)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Annual_means</span><span class="op">$</span><span class="va">JDay</span> <span class="op">~</span> <span class="va">Annual_means</span><span class="op">$</span><span class="va">Tmin</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Annual_means$JDay ~ Annual_means$Tmin)

Residuals:
     Min       1Q   Median       3Q      Max 
-25.4960  -6.9227  -0.0472   6.9066  18.4940 

Coefficients:
                  Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept)        140.288      8.610  16.293 &lt; 0.0000000000000002 ***
Annual_means$Tmin   -6.020      1.558  -3.864             0.000277 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 9.385 on 60 degrees of freedom
Multiple R-squared:  0.1992,    Adjusted R-squared:  0.1859 
F-statistic: 14.93 on 1 and 60 DF,  p-value: 0.0002765</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb341"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Predict JDay based on Tmax</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Annual_means</span><span class="op">$</span><span class="va">JDay</span> <span class="op">~</span> <span class="va">Annual_means</span><span class="op">$</span><span class="va">Tmax</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Annual_means$JDay ~ Annual_means$Tmax)

Residuals:
     Min       1Q   Median       3Q      Max 
-28.2420  -5.7340   0.3032   5.8515  19.4918 

Coefficients:
                  Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept)       168.5020    12.9573  13.004 &lt; 0.0000000000000002 ***
Annual_means$Tmax  -4.3586     0.9198  -4.739            0.0000136 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 8.947 on 60 degrees of freedom
Multiple R-squared:  0.2723,    Adjusted R-squared:  0.2602 
F-statistic: 22.45 on 1 and 60 DF,  p-value: 0.00001363</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb343"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Predict JDay based on Tmean</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Annual_means</span><span class="op">$</span><span class="va">JDay</span> <span class="op">~</span> <span class="va">Annual_means</span><span class="op">$</span><span class="va">Tmean</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Annual_means$JDay ~ Annual_means$Tmean)

Residuals:
     Min       1Q   Median       3Q      Max 
-25.9808  -5.5032   0.3793   6.1267  18.1822 

Coefficients:
                   Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept)         173.467     12.379  14.013 &lt; 0.0000000000000002 ***
Annual_means$Tmean   -6.780      1.264  -5.363           0.00000138 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 8.623 on 60 degrees of freedom
Multiple R-squared:  0.324, Adjusted R-squared:  0.3128 
F-statistic: 28.76 on 1 and 60 DF,  p-value: 0.000001381</code></pre>
</div>
</div>
<ul>
<li><p>There’s a relationship here, but this is still not really a convincing analysis. The main reason is that the time period we’re calculating the mean temperatures for is the whole year, even though bloom already occurs in spring. Temperatures after this can’t possibly affect the bloom date in the year of interest!</p></li>
<li><p>Then why did we get such convincing results, with exceptionally low <code>p</code> values?</p></li>
<li><p>Again, the reason is climate change. Temperatures have been rising over time, and phenology has advanced over time, so later years generally feature earlier bloom dates.</p></li>
<li><p>To get to an analysis that has a chance of actually reflecting a causal relationship, however, we need to restrict the analysis to a range of dates that can plausibly affect bloom dates.</p></li>
<li><p>Let’s write a quick function to screen for such correlations. To facilitate this, we’ll use <code>JDay</code>, i.e.&nbsp;the day of the year, to express the date.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb345"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">temps_JDays</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/make_JDay.html">make_JDay</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">)</span></span>
<span></span>
<span><span class="va">corr_temp_pheno</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">start_JDay</span>, <span class="co"># the start JDay of the period</span></span>
<span>                            <span class="va">end_JDay</span>, <span class="co"># the start JDay of the period</span></span>
<span>                            <span class="va">temps_JDay</span> <span class="op">=</span> <span class="va">temps_JDays</span>, <span class="co"># the temperature dataset</span></span>
<span>                            <span class="va">bloom</span> <span class="op">=</span> <span class="va">Alex_first</span><span class="op">)</span> <span class="co"># a data.frame with bloom dates</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">temps_JDay</span> <span class="op">&lt;-</span> <span class="va">temps_JDay</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Season <span class="op">=</span> <span class="va">Year</span><span class="op">)</span> <span class="co"># Add a season column, with years data at first</span></span>
<span> </span>
<span>  <span class="co"># Change the year in "season" column to next year (by + 1) if start JDay is</span></span>
<span>  <span class="co"># greater than end JDay (start later in the year, end in early next year)</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">start_JDay</span> <span class="op">&gt;</span> <span class="va">end_JDay</span><span class="op">)</span> <span class="co"># select all rows where JDay is &gt;= start_JDay</span></span>
<span>    <span class="va">temps_JDay</span><span class="op">$</span><span class="va">Season</span><span class="op">[</span><span class="va">temps_JDay</span><span class="op">$</span><span class="va">JDay</span> <span class="op">&gt;=</span> <span class="va">start_JDay</span><span class="op">]</span><span class="op">&lt;-</span></span>
<span>      <span class="va">temps_JDay</span><span class="op">$</span><span class="va">Year</span><span class="op">[</span><span class="va">temps_JDay</span><span class="op">$</span><span class="va">JDay</span> <span class="op">&gt;=</span> <span class="va">start_JDay</span><span class="op">]</span><span class="op">+</span><span class="fl">1</span></span>
<span>  </span>
<span>  <span class="co"># Subset data include the JDay across year boundary, if start &gt; end</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">start_JDay</span> <span class="op">&gt;</span> <span class="va">end_JDay</span><span class="op">)</span></span>
<span>    <span class="va">sub_temps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">temps_JDay</span>,</span>
<span>                        <span class="va">JDay</span> <span class="op">&lt;=</span> <span class="va">end_JDay</span> <span class="op">|</span> <span class="va">JDay</span> <span class="op">&gt;=</span> <span class="va">start_JDay</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># If start &lt;= end, then take all days normally</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">start_JDay</span> <span class="op">&lt;=</span> <span class="va">end_JDay</span><span class="op">)</span> </span>
<span>    <span class="va">sub_temps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">temps_JDay</span>,</span>
<span>                        <span class="va">JDay</span> <span class="op">&lt;=</span> <span class="va">end_JDay</span> <span class="op">&amp;</span> <span class="va">JDay</span> <span class="op">&gt;=</span> <span class="va">start_JDay</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Add mean_temps column</span></span>
<span>  <span class="va">mean_temps</span> <span class="op">&lt;-</span> <span class="va">sub_temps</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Season</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>Tmin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Tmin</span><span class="op">)</span>, <span class="co"># summarize sum all Tmin rows by year</span></span>
<span>              Tmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Tmax</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># here summarize applies to each column separately</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Tmean <span class="op">=</span> <span class="op">(</span><span class="va">Tmin</span> <span class="op">+</span> <span class="va">Tmax</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Change first column name to Pheno_year (to merge with Pheno_year in bloom)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">mean_temps</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Pheno_year"</span><span class="op">)</span> <span class="co"># season to Pheno_year?</span></span>
<span>  </span>
<span>  <span class="co"># Merge Pheno_year from bloom and mean_temps, only keeping matching years</span></span>
<span>  <span class="co"># Add JDay only for those matched years</span></span>
<span>  <span class="co"># So, this will take temp values for years with bloom data?</span></span>
<span>  <span class="va">temps_bloom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">mean_temps</span>,</span>
<span>                       <span class="va">bloom</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Pheno_year"</span>,</span>
<span>                               <span class="st">"JDay"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Let's just extract the slopes of the regression model for now</span></span>
<span>  <span class="va">slope_Tmin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">temps_bloom</span><span class="op">$</span><span class="va">JDay</span><span class="op">~</span><span class="va">temps_bloom</span><span class="op">$</span><span class="va">Tmin</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">slope_Tmean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">temps_bloom</span><span class="op">$</span><span class="va">JDay</span><span class="op">~</span><span class="va">temps_bloom</span><span class="op">$</span><span class="va">Tmean</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">slope_Tmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">temps_bloom</span><span class="op">$</span><span class="va">JDay</span><span class="op">~</span><span class="va">temps_bloom</span><span class="op">$</span><span class="va">Tmax</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span></span>
<span> </span>
<span>  <span class="co"># Name the returned values, so we don't need to call the value by its position </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>start_JDay <span class="op">=</span> <span class="va">start_JDay</span>,</span>
<span>    end_JDay <span class="op">=</span> <span class="va">end_JDay</span>, <span class="co"># length count how many JDays in the sub_temps</span></span>
<span>    length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">sub_temps</span><span class="op">$</span><span class="va">JDay</span><span class="op">)</span><span class="op">)</span>, <span class="co"># unique removes duplicate values</span></span>
<span>    slope_Tmin <span class="op">=</span> <span class="va">slope_Tmin</span>,</span>
<span>    slope_Tmean <span class="op">=</span> <span class="va">slope_Tmean</span>,</span>
<span>    slope_Tmax <span class="op">=</span> <span class="va">slope_Tmax</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">corr_temp_pheno</span><span class="op">(</span>start_JDay <span class="op">=</span> <span class="fl">305</span>, <span class="co"># 01-11-58</span></span>
<span>                end_JDay <span class="op">=</span> <span class="fl">29</span>, <span class="co"># 29-01-59</span></span>
<span>                temps_JDay <span class="op">=</span> <span class="va">temps_JDays</span>,</span>
<span>                bloom <span class="op">=</span> <span class="va">Alex_first</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code> start_JDay    end_JDay      length  slope_Tmin slope_Tmean  slope_Tmax 
 305.000000   29.000000   91.000000   -1.821312   -2.135616   -2.237499 </code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb347"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">corr_temp_pheno</span><span class="op">(</span>start_JDay <span class="op">=</span> <span class="fl">305</span>, <span class="co"># 01-11-58</span></span>
<span>                end_JDay <span class="op">=</span> <span class="fl">45</span>, <span class="co"># 14-02-59</span></span>
<span>                temps_JDay <span class="op">=</span> <span class="va">temps_JDays</span>,</span>
<span>                bloom <span class="op">=</span> <span class="va">Alex_first</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code> start_JDay    end_JDay      length  slope_Tmin slope_Tmean  slope_Tmax 
 305.000000   45.000000  107.000000   -2.254426   -2.655599   -2.799758 </code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb349"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Now we can apply this function to all combinations of days we we find </span></span>
<span><span class="co"># reasonable. Rather than trying all possible values, I’ll only use every 10th </span></span>
<span><span class="co"># possible start and end date.</span></span>
<span></span>
<span><span class="co"># library(colorRamps) # for the color scheme we'll use in the plot</span></span>
<span></span>
<span><span class="va">stJDs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">1</span>,</span>
<span>             to <span class="op">=</span> <span class="fl">366</span>,</span>
<span>             by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">eJDs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">1</span>,</span>
<span>            to <span class="op">=</span> <span class="fl">366</span>,</span>
<span>            by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Nested loop that run every values in eJDs for each value in stJDs</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">stJD</span> <span class="kw">in</span> <span class="va">stJDs</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">eJD</span> <span class="kw">in</span> <span class="va">eJDs</span><span class="op">)</span></span>
<span>    <span class="op">{</span><span class="va">correlations</span> <span class="op">&lt;-</span> <span class="fu">corr_temp_pheno</span><span class="op">(</span><span class="va">stJD</span>,</span>
<span>                                     <span class="va">eJD</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">stJD</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">eJD</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># check if it is the first combination (first values)</span></span>
<span>      <span class="va">corrs</span> <span class="op">&lt;-</span> <span class="va">correlations</span> <span class="kw">else</span></span>
<span>        <span class="va">corrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">corrs</span>, <span class="va">correlations</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Prepare data for ggplot</span></span>
<span><span class="va">slopes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">corrs</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Tmin <span class="op">=</span> <span class="va">slope_Tmin</span>,</span>
<span>         Tmax <span class="op">=</span> <span class="va">slope_Tmax</span>,</span>
<span>         Tmean <span class="op">=</span> <span class="va">slope_Tmean</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Tmin</span> <span class="op">:</span> <span class="va">Tmax</span><span class="op">)</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"Slope"</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"Variable"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">slopes</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">start_JDay</span>,</span>
<span>           y <span class="op">=</span> <span class="va">length</span>,</span>
<span>           fill <span class="op">=</span> <span class="va">Slope</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">Variable</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu">matlab.like</span><span class="op">(</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Interval duration (days)"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Start date of temperature summary interval (Day of year)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/20.6b-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>While this plot can give us an idea about the periods during which temperatures are strongly related to bloom dates, we’ve actually veered slightly off track again.</p></li>
<li><p>First, if we now went for the strongest possible influence and declared this as the main driver of bloom dates, we’d be p-hacking again. More importantly, we’re again looking for something that’s a bit different from what we should actually expect based on our ecological knowledge.</p></li>
<li><p>We learned earlier that bloom dates are determined by two separate temperature-dependent processes: chilling and forcing. So we need more than one temperature period! We could now expand our p-hacking exercise to include multiple temperature summary variables. We could then also apply multiple regression, which can automatically identify variables that are correlated with bloom dates.</p></li>
<li><p>Such fishing for correlations is a tedious and unsatisfying exercise, and it wouldn’t seem particularly enlightened. It’s likely to lead to overfits, and it can easily miss important temperature response periods by narrowing in on the phases that are most strongly correlated to the outcome variable. So let’s not do this and instead take a step back again to think about the theory. Here’s what we should actually expect:</p></li>
</ul>
<p><img src="./pic/ch20_1.png" class="img-fluid"></p>
<ul>
<li><p>We could now start developing equations that describe what we think we know about chilling and forcing, and then fitted these equations to observed phenology data— most of the chill models we compared in the last lesson come from such exercises.</p></li>
<li><p>Some of these are clearly way off the mark— and I assume the phenology models they were a part of still did pretty well. This is possible, because most phenology models have quite a few parameters, e.g.&nbsp;the start and end dates of chilling and forcing periods, the chilling and forcing requirements and the specifications of the temperature response curves during both phases. It’s easy for these parameters to compensate for each other, so that we get the right result for the wrong reasons. Such models have also often been fitted through trial and error or through less-than-convincing machine learning algorithms.</p></li>
<li><p>In the next lesson, we’ll combine our ecological knowledge with a machine learning technique to figure out when trees are responsive to temperature.</p></li>
</ul>
<p><br></p>
</section><section id="exercises-on-simple-phenology-analysis" class="level3"><h3 class="anchored" data-anchor-id="exercises-on-simple-phenology-analysis">
<span style="color:#71797E">20.7</span>&nbsp; Exercises on simple phenology analysis</h3>
<div style="height: 18px;">

</div>
<p><strong><em>1. Provide a brief narrative describing what p-hacking is, and why this is a problematic approach to data analysis.</em></strong></p>
<p>P-hacking, a practice known as a fishing expedition, is to purposely look for any significant correlations in large datasets which contain many variables. These dataset are large enough and variables are diverse enough that some correlations are bound to be observed among variables, even if there are no actual causal relationships. In the words of <a href="https://www.nature.com/articles/506150a">Simonsohn</a>, “p-hacking is trying multiple things until you get a desired result.” This is particularly problematic because p-hacking results in findings that are not replicable (false positives)— meaningless discoveries that amount to nothing but a waste of resource and time.</p>
<p><br></p>
<p><strong><em>2. Provide a sketch of your causal understanding of the relationship between temperature and bloom dates.</em></strong></p>
<p><br></p>
<p><strong><em>3. What do we need to know to build a process-based model from this?</em></strong></p>
<p><br></p>
</section></section><section id="chapter-21-delineating-temperature-response-phases-with-pls-regression" class="level2"><h2 class="anchored" data-anchor-id="chapter-21-delineating-temperature-response-phases-with-pls-regression">Chapter 21: Delineating temperature response phases with PLS regression</h2>
<section id="detecting-temperature-response-phases" class="level3"><h3 class="anchored" data-anchor-id="detecting-temperature-response-phases">
<span style="color:#71797E">21.1</span>&nbsp; Detecting temperature response phases</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>Spring phenology responds to exposure to chilling temperatures over a considerable period, during which the precise timing of this exposure is probably not important.</p></li>
<li><p>The same applies to heat. We thus shouldn’t expect temperature during a single well-defined period to explain much of the observed variation in bloom or leafing dates.</p></li>
<li><p>It seems more likely that temperatures during longer periods have an effect, possibly with varying levels of effectiveness. Methods that either fully consider temperatures during particular intervals or completely discard them are then not very promising.</p></li>
<li><p>Another major problem is that we may have high-resolution temperature data, e.g.&nbsp;at daily or even hourly resolution, but we may not have a good way of correlating this to observed phenology. Statistically, this is because we are relating a small number of dependent variables—e.g.&nbsp;bloom dates, for which we usually just have one value per year—with a large number of independent variables - temperatures on each day, or during each hour, of the dormant season. Ordinary regression procedures don’t do well in such settings.</p></li>
<li><p>Wanting to explain relatively few observations with lots of independent variables is actually a pretty common challenge, for example in remote sensing, and researchers in several disciplines have found ways of dealing with it.</p></li>
</ul>
<p><br></p>
</section><section id="finding-signals-in-hyperspectral-remote-sensing-data" class="level3"><h3 class="anchored" data-anchor-id="finding-signals-in-hyperspectral-remote-sensing-data">
<span style="color:#71797E">21.2</span>&nbsp; Finding signals in hyperspectral remote sensing data</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>Hyperspectral data often contain spectral reflectance (or absorption) data for radiation at hundreds (even thousands) of spectral wavelengths. Such spectra are then related to properties of particular materials.</p></li>
<li><p>In the case of detecting spider mite damage in peaches in California, we had scored mite damage on 1132 peach leaves, for which we also collected reflectance spectra at wavelengths between 350 and 2500 nm (<a href="https://www.sciencedirect.com/science/article/pii/S0303243409000221">Luedeling et al., 2009c</a>).</p></li>
<li><p>The following image shows two distinct reflectance profiles that represent healthy (0% damage) and heavily affected (90% damage) leaves. As you can see, the healthy leaves reflected less light at wavelengths around 500 nm and more light in a wide region around 1000 nm. We can easily see that here, but there are also mathematical procedures for detecting the signals caused by a particular property of the material (in this case mite damage).</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./pic/ch21_1.jpg" class="img-fluid figure-img"></p>
<figcaption><strong><em>Spectral reflectance profiles of all healthy and all heavily mite-affected peach leaves and canopies (0% and 90% of the leaf area damaged for the leaf dataset, and damage classes 0–1 and 4–5 for the canopies). The gray areas around the curves indicate ± one standard error of the mean. Left: Hyperspectral reflectance spectra of healthy (0% damage) and highly mite-affected (90% damage) peach leaves in California. The lines show the averages, the shading illustrates the standard error of the mean (Luedeling et al., 2009c)</em></strong></figcaption></figure>
</div>
<p><br></p>
<ul>
<li><p>To identify significant wavelengths, we should not look at this as a regression exercise, but rather address the situation as a signal detection problem. There is a lot of noise in such datasets, and we’re looking for the signal that is produced by the property we’re trying to measure.</p></li>
<li><p>There are a number of methods to detect signals, and the blossoming machine learning literature keeps producing new ones. The method I adopted back then is Projection-to-Latent-Structures (PLS) regression, also known as Partial Least Squares regression.</p></li>
<li><p>In principle, the method identifies latent structures, a sort of principal components, that best describe the variation in the dataset. These latent structures are then used in a regression procedure.</p></li>
<li><p>This is quite effective in identifying signals in noisy datasets, and it works in situations where we have lots of independent variables and just one dependent variable, for which we don’t necessarily need a lot of observations. Here are the PLS results for the peach leaf dataset, relating reflectance to mite damage:</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./pic/ch21_2.jpg" class="img-fluid figure-img"></p>
<figcaption><strong><em>Model coefficients of the Partial Least Squares (PLS) regression between reflectance at all spectral wavelengths analyzed and the numeric mite damage classification for data measured at the leaf (left graph) and canopy (right graph) level. The bold horizontal lines in both graphs indicate the thresholds at 0.8/−0.8, above/below which wavelengths were considered significant. Left: Coefficients of a PLS model relating mite damage to hyperspectral reflectance data. Particularly prominent wavelengths are marked (Luedeling et al., 2009c)</em></strong></figcaption></figure>
</div>
<p><br></p>
<ul>
<li><p>We can see here that certain wavelengths are particularly strongly correlated with spider mite damage, so it might be possible to construct some sort of mite detection index by concentrating on wavelengths around 365 nm, 497 nm, 687 nm and so forth. Well, in this case that didn’t work so well. Except for cases of extreme damage, we didn’t really manage to detect mites.</p></li>
<li><p>The general statistical situation here is quite similar to the situation we’re facing when trying to relate high-resolution temperature to tree phenology. We have one dependent variable, just a few observations and lots of independent variables.</p></li>
</ul>
<p><br></p>
</section><section id="pls-regression-for-phenology-analysis" class="level3"><h3 class="anchored" data-anchor-id="pls-regression-for-phenology-analysis">
<span style="color:#71797E">21.3</span>&nbsp; PLS regression for phenology analysis</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>A similar analysis was done with leaf emergence data of the walnut cultivar ‘Payne’ in California (<a href="https://www.sciencedirect.com/science/article/pii/S0168192312000561">Luedeling &amp; Gassner, 2012</a>).</p></li>
<li><p>We used PLS regression on a 54-year dataset, from 1953-2007 (with data for 1996 missing), recorded at the University of California at Davis.</p></li>
<li><p>We related these leaf emergence dates with mean daily temperature, obtaining the following results:</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./pic/ch21_3.jpg" class="img-fluid figure-img"></p>
<figcaption><strong><em>Results of a PLS regression analysis of the relationship between leaf emergence of ‘Payne’ walnuts in Davis, California, and daily mean temperature during the dormant season (Luedeling et al., 2012). Comparison of different temporal resolutions of the independent input data (temperature) to the PLS analysis with leaf emergence dates of the walnut cultivar Payne. The top two panels show variable-importance-plot (VIP) and model coefficients of the centered and scaled data (MC) for daily temperature data as independent input; the middle two panels show VIP and MC for an 11-day running mean of temperature as input; and the bottom two panels show the analysis for monthly means of temperature data as independent variables.</em></strong></figcaption></figure>
</div>
<p><br></p>
<ul>
<li><p>This figure shows three versions of the analysis. In the analysis that produced the topmost set of figures, unprocessed daily mean temperatures were related to phenology dates. The results looked a little fuzzy, so I also ran the analysis with an 11-day running mean of temperatures (middle) and also with monthly data (bottom).</p></li>
<li><p>Each set of plots contains illustrations of two results: the model coefficients, which are comparable to the coefficients of a normal regression model, and the ‘variable importance in the projection’ score (VIP), which indicates how important the contribution of each daily temperature is for the overall regression model. This is often interpreted as a sort of ‘significance’, which is decided on by using a cut-off threshold (often 0.8).</p></li>
<li><p>Basically, the model coefficients illustrate how leaf emergence dates are affected by particularly warm or cool conditions on a certain day. Positive model coefficients indicate a positive relationship between (Julian) leaf emergence dates and temperature, i.e.&nbsp;warmer than usual temperatures are correlated with later than usual leaf emergence dates. Conversely, negative model coefficients indicate a negative correlation, i.e.&nbsp;warm temperatures are related to early spring phenology.</p></li>
<li><p>When we relate the emerging pattern of model coefficients to our understanding of the dormancy process, we can detect two distinct phases here.</p></li>
<li><p>Between early November and mid-January, we see a period with positive model coefficients (and high VIP scores), i.e.&nbsp;warm conditions during this period are related to delayed leaf emergence in spring. This is consistent with what we might expect to be happening during the chilling period, when warm conditions might delay the fulfillment of chilling requirements, which would in turn delay all subsequent development.</p></li>
<li><p>Following this period of positive model coefficients, we see a phase with negative coefficients between mid-January and (about) the end of March. Such coefficients are consistent with our expectation for the forcing phase, when warm temperatures would accelerate heat accumulation and thus advance leaf emergence.</p></li>
<li><p>After early to mid-April, we see an inconsistent pattern. Given that leaf emergence happens in March to very early April, this is not surprising. Temperatures after this time cannot possibly affect budbreak dates. We also see that temperature response patterns before November are inconsistent. This may indicate that no chill accumulates before the end of October.</p></li>
<li><p>We found quite similar patterns for the cultivars ‘Chandler’ and ‘Franquette’:</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./pic/ch21_4.jpg" class="img-fluid figure-img"></p>
<figcaption><strong><em>VIP scores and model coefficients of PLS models relating leaf emergence dates of the walnut cultivars ‘Payne’, ‘Chandler’ and ‘Franquette’ in Davis, California, with mean daily temperatures (Luedeling et al., 2012). Results of the PLS analysis for the phenological stage of leaf emergence for the walnut cultivars Payne, Chandler and Franquette, with 11-day running means of daily mean temperatures as independent input variables. The three top panels show variable-importance plots for each cultivar, whereas the bottom three panels display the model coefficients of the centered and scaled data.</em></strong></figcaption></figure>
</div>
<p><br></p>
<ul>
<li>The model coefficient patterns are a bit less clear here, including brief interruptions of the chilling period for the two other cultivars and lots of variation in heat and chilling responses. What does this mean?</li>
</ul>
<p><br></p>
</section><section id="a-note-of-caution-about-pls-results" class="level3"><h3 class="anchored" data-anchor-id="a-note-of-caution-about-pls-results">
<span style="color:#71797E">21.4</span>&nbsp; A note of caution about PLS results</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>PLS is a data mining technique that is usually used with a lot larger datasets than what we have here.</p></li>
<li><p>Remember that in the spider mite example, we had over 1000 leaf samples. The method also works with less data, but we should not expect results to be crystal-clear then. It is thus very important that we don’t overinterpret every little feature of the plots that emerges.</p></li>
<li><p>In fact, when we’re dealing with datasets as small as the ones we usually encounter in phenology analysis, I would strongly advise against using PLS as a data-mining tool, i.e.&nbsp;to detect patterns in the data.</p></li>
<li><p>This tool should only be used in conjunction with a theory about how the system works. With this, we can use the PLS results to support or possibly refute certain ideas.</p></li>
<li><p>In our case, we may start with a strong expectation of finding a chilling period (with positive model coefficients), followed by a forcing period (with negative coefficients). Our results are consistent with our theory, so—together with this theory—the picture that emerges is quite consistent.</p></li>
<li><p><strong><em>Important: always keep in mind that we’re using PLS with a very small dataset and we should not place too much emphasis on individual characteristics of the emerging model coefficient patterns,</em></strong> (unless of course, we have other reasons to believe they are meaningful, or we find them across many similar analyses).</p></li>
<li><p>In this context, it is important that we clarify our expectations <em>before</em> we run our analysis.</p></li>
<li><p>It’s always possible to interpret random patterns that emerge in some reasonable-sounding way after the fact, but this practice—which is also known as <em>rationalizing</em>—isn’t particularly sound.</p></li>
</ul>
<p><br></p>
</section><section id="pls-analysis-of-alexander-lucas-pears-in-klein-altendorf" class="level3"><h3 class="anchored" data-anchor-id="pls-analysis-of-alexander-lucas-pears-in-klein-altendorf">
<span style="color:#71797E">21.5</span>&nbsp; PLS analysis of ‘Alexander Lucas’ pears in Klein-Altendorf</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>Now let’s try this analysis for ourselves with the dataset of pears (cultivar ‘Alexander Lucas’).</p></li>
<li><p>We’ll start with first bloom, which we first have to convert to Julian dates, and then the temperature data:</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb350"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># library(chillR)</span></span>
<span></span>
<span><span class="co"># Create a data.frame with two columns: Year (Pheno_year) and pheno (JDay)</span></span>
<span><span class="va">Alex_first</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/read_tab.html">read_tab</a></span><span class="op">(</span><span class="st">"data/OT/Alexander_Lucas_bloom_1958_2019.csv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Pheno_year</span>, <span class="va">First_bloom</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># select only two columns</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">First_bloom</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>, <span class="co"># extract year, month,</span></span>
<span>         Month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">First_bloom</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>, <span class="co"># and day from</span></span>
<span>         Day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">First_bloom</span>, <span class="fl">7</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># First_bloom date</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/make_JDay.html">make_JDay</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># add a new JDay column</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Pheno_year</span>, <span class="va">JDay</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># select only year and JDay columns</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Year <span class="op">=</span> <span class="va">Pheno_year</span>,</span>
<span>         pheno <span class="op">=</span> <span class="va">JDay</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display head data</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">Alex_first</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pheno</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1958</td>
<td style="text-align: right;">122</td>
</tr>
<tr class="even">
<td style="text-align: right;">1959</td>
<td style="text-align: right;">98</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1960</td>
<td style="text-align: right;">101</td>
</tr>
<tr class="even">
<td style="text-align: right;">1961</td>
<td style="text-align: right;">89</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1962</td>
<td style="text-align: right;">117</td>
</tr>
<tr class="even">
<td style="text-align: right;">1963</td>
<td style="text-align: right;">118</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb351"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># The PLS function we’ll use is a bit particular about the format of this </span></span>
<span><span class="co"># data.frame, so I had to adjust the data.frame structure a bit and change </span></span>
<span><span class="co"># the column names. </span></span>
<span></span>
<span><span class="co"># Now we need temperature data, which we have also worked with before:</span></span>
<span><span class="va">KA_temps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/read_tab.html">read_tab</a></span><span class="op">(</span><span class="st">"data/OT/TMaxTMin1958-2019_patched.csv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/make_JDay.html">make_JDay</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">KA_temps</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">DATE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">YEARMODA</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmax</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Tmin_source</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Tmax_source</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">no_Tmin</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">no_Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">JDay</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">01-01-58</td>
<td style="text-align: right;">19580101</td>
<td style="text-align: right;">1958</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5.0</td>
<td style="text-align: right;">7.50</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">02-01-58</td>
<td style="text-align: right;">19580102</td>
<td style="text-align: right;">1958</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">9.00</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">03-01-58</td>
<td style="text-align: right;">19580103</td>
<td style="text-align: right;">1958</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">-5.5</td>
<td style="text-align: right;">1.10</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">04-01-58</td>
<td style="text-align: right;">19580104</td>
<td style="text-align: right;">1958</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">-5.5</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">05-01-58</td>
<td style="text-align: right;">19580105</td>
<td style="text-align: right;">1958</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3.5</td>
<td style="text-align: right;">2.75</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">06-01-58</td>
<td style="text-align: right;">19580106</td>
<td style="text-align: right;">1958</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">5.00</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">6</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<ul>
<li><p>This <code>data.frame</code> can be more complex, but it needs to conform to the typical structure of <code>chillR</code> temperature datasets, i.e.&nbsp;it must have columns <code>Year</code>, <code>Month</code>, <code>Day</code>, <code>Tmin</code>, <code>Tmax</code> and in this case also <code>JDay</code>.</p></li>
<li><p>With these two inputs, we can now use the <code>PLS_pheno</code> function from the <code>chillR</code> package. I note here that this function makes use of the <code>plsr</code> package.</p></li>
<li><p>The <code>PLS_pheno</code> function requires as a minimum just a temperature dataset (<code>weather_data</code>) and a phenology dataset (<code>bio_data</code>).</p></li>
<li><p>The result is a list of three objects: <code>$object_type</code>— just the string ‘PLS_Temp_pheno’, <code>$pheno</code>— the phenology input data, and <code>$PLS_summary</code>— the results we’re interested in.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb352"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">PLS_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/PLS_pheno.html">PLS_pheno</a></span><span class="op">(</span><span class="va">KA_temps</span>, <span class="co"># weather data</span></span>
<span>                         <span class="va">Alex_first</span><span class="op">)</span> <span class="co"># bio data</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">PLS_results</span><span class="op">$</span><span class="va">PLS_summary</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Date</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">JDay</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Coef</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">VIP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tstdev</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">801</td>
<td style="text-align: right;">-152</td>
<td style="text-align: right;">0.0826036</td>
<td style="text-align: right;">0.3676590</td>
<td style="text-align: right;">18.32970</td>
<td style="text-align: right;">1.914004</td>
</tr>
<tr class="even">
<td style="text-align: right;">802</td>
<td style="text-align: right;">-151</td>
<td style="text-align: right;">0.0932920</td>
<td style="text-align: right;">0.4159775</td>
<td style="text-align: right;">18.30846</td>
<td style="text-align: right;">1.884389</td>
</tr>
<tr class="odd">
<td style="text-align: right;">803</td>
<td style="text-align: right;">-150</td>
<td style="text-align: right;">0.0940262</td>
<td style="text-align: right;">0.4530441</td>
<td style="text-align: right;">18.27148</td>
<td style="text-align: right;">1.844368</td>
</tr>
<tr class="even">
<td style="text-align: right;">804</td>
<td style="text-align: right;">-149</td>
<td style="text-align: right;">0.0899057</td>
<td style="text-align: right;">0.4609463</td>
<td style="text-align: right;">18.23742</td>
<td style="text-align: right;">1.886276</td>
</tr>
<tr class="odd">
<td style="text-align: right;">805</td>
<td style="text-align: right;">-148</td>
<td style="text-align: right;">0.0643769</td>
<td style="text-align: right;">0.4140336</td>
<td style="text-align: right;">18.19609</td>
<td style="text-align: right;">1.884567</td>
</tr>
<tr class="even">
<td style="text-align: right;">806</td>
<td style="text-align: right;">-147</td>
<td style="text-align: right;">0.0103315</td>
<td style="text-align: right;">0.4476572</td>
<td style="text-align: right;">18.17148</td>
<td style="text-align: right;">1.855337</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<ul>
<li>This summary object contains 6 columns:
<ul>
<li>
<code>Date</code>— the calendar day coded as <code>MMDD</code>,</li>
<li>
<code>JDay</code>— the Julian date,</li>
<li>
<code>Coef</code>— the PLS model coefficient,</li>
<li>
<code>VIP</code>— the variable importance in the projection score,</li>
<li>
<code>Tmean</code>— the mean temperature on the respective day, and</li>
<li>
<code>Tstdev</code>— the standard deviation of temperatures on this day across the whole temperature dataset.</li>
</ul>
</li>
</ul>
<ul>
<li>This <code>PLS_results</code> element can now be plotted with the dedicated plotting function <code>plot_PLS</code>. Here’s what the results of this would look like:</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb353"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">PLS_output</span> <span class="op">&lt;-</span> <span class="va">PLS_results</span></span>
<span></span>
<span><span class="va">PLS_results_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/data/OT/PLS_output/PLS_output"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/plot_PLS.html">plot_PLS</a></span><span class="op">(</span><span class="va">PLS_output</span>, <span class="va">PLS_results_path</span><span class="op">)</span>  <span class="co"># this seems to create a new dir path.</span></span>
<span><span class="co"># so, i get an empty folder every time I run this. And the function doesn't run</span></span>
<span><span class="co"># if I delete the path. So, I guess I have to live with an empty folder here.</span></span>
<span></span>
<span><span class="co"># grid.raster(readPNG('data/OT/PLS_output/PLS_output.png'))</span></span>
<span><span class="co"># grid.text('Temperature response pattern of\n‘Alexander Lucas' pears in</span></span>
<span><span class="co"># Klein-Altendorf', x = 0.9, y = 0.15, gp = gpar(fontsize = 10, fontface =</span></span>
<span><span class="co"># 'italic'))</span></span>
<span></span>
<span><span class="va">img</span> <span class="op">&lt;-</span> <span class="fu">readPNG</span><span class="op">(</span><span class="st">"data/OT/PLS_output/PLS_output.png"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op">(</span><span class="fu">rasterGrob</span><span class="op">(</span><span class="va">img</span>, width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"npc"</span><span class="op">)</span>, height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">1</span>,</span>
<span>    <span class="st">"npc"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Temperature response pattern of ‘Alexander Lucas' pears in Klein-Altendorf"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/21.5c-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li><p>We have the VIP plot on top, with ‘important’ days highlighted in blue. In the second row, we have the model coefficients, with data for all the days identified as ‘important’ shown in red (when negative) or green (when positive).</p></li>
<li><p>In the bottom row, we see the temperature dynamics during this time, with the mean temperature across all years shown by the black line, and the standard deviation indicated by the shading, which uses the same color scheme as the model coefficient plot.</p></li>
<li><p>The gray shading at the left end of the plot shows the full range of observed bloom dates, with the dashed line indicating the mean bloom date.</p></li>
<li>
<p>Before we reproduce this using ggplot, let’s look at the parameters of the PLS_pheno function.</p>
<ul>
<li>
<code>split_month</code>— the <code>PLS_pheno</code> function uses temperature data for an entire year, but we can decide when to start this year. The default is 7, which means that the phenological year ends at the end of July.</li>
<li>
<code>runn_mean</code>— the running mean to be applied to the temperature data before the analysis. We can set this to 1, but then we get a fairly messy temperature response pattern. The default is 11, which has usually worked pretty well.</li>
<li>
<code>end_at_pheno_end</code>— if this is set to <code>TRUE</code> (the default), then temperatures after the latest <code>JDay</code> of the phenology dataset aren’t considered in the analysis.</li>
<li>
<code>use_Tmean</code>— this can be set to <code>TRUE</code>, if your temperature dataset has a <code>Tmean</code> column and you want to use that rather than calculating means from <code>Tmin</code> and <code>TMax</code>.</li>
<li>
<code>expl.var</code>, <code>ncomp.fix</code> and <code>crossvalidate</code> refer to specifics of the PLS analysis, <code>return.all</code> indicates that you also want all the PLS outputs to be returned. Refer to the help function of <code>PLS_pheno</code> and possibly to the <code>plsr</code> package for more details.</li>
</ul>
</li>
</ul>
<ul>
<li>So now let’s make the same plot in <code>ggplot</code>:</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb354"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># library(ggplot2)</span></span>
<span></span>
<span><span class="co"># Remove `date` column which shows month and day (eg.801 for August 1) and </span></span>
<span><span class="co"># add two columns Month and Day</span></span>
<span><span class="va">PLS_gg</span> <span class="op">&lt;-</span> <span class="va">PLS_results</span><span class="op">$</span><span class="va">PLS_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">trunc</a></span><span class="op">(</span><span class="va">Date</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span>, <span class="co"># truncate to remove decimal part</span></span>
<span>         Day <span class="op">=</span> <span class="va">Date</span> <span class="op">-</span> <span class="va">Month</span> <span class="op">*</span> <span class="fl">100</span>,</span>
<span>         Date <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Add back Date column with ISO date format (year-month-day-time)</span></span>
<span><span class="va">PLS_gg</span><span class="op">$</span><span class="va">Date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2002</span>, </span>
<span>                       <span class="va">PLS_gg</span><span class="op">$</span><span class="va">Month</span>, </span>
<span>                       <span class="va">PLS_gg</span><span class="op">$</span><span class="va">Day</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For the rows with JDay 0 or lower (negative JDay- refer to previous year)</span></span>
<span><span class="co"># Change 2002 to 2001- last year, while month and day stay the same</span></span>
<span><span class="va">PLS_gg</span><span class="op">$</span><span class="va">Date</span><span class="op">[</span><span class="va">PLS_gg</span><span class="op">$</span><span class="va">JDay</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>, </span>
<span>          <span class="va">PLS_gg</span><span class="op">$</span><span class="va">Month</span><span class="op">[</span><span class="va">PLS_gg</span><span class="op">$</span><span class="va">JDay</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">]</span>, </span>
<span>          <span class="va">PLS_gg</span><span class="op">$</span><span class="va">Day</span><span class="op">[</span><span class="va">PLS_gg</span><span class="op">$</span><span class="va">JDay</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># sing() function returns a vector with the signs of the corresponding elements </span></span>
<span><span class="co"># of x (the sign of a real number is 1, 0, or −1 if the number is positive, </span></span>
<span><span class="co"># zero, or negative, respectively)- so, 1 of Coef is positive, -1 if Coef is</span></span>
<span><span class="co"># negative and 0 if Coef is zero. So, basically change Coef into a series of </span></span>
<span><span class="co"># 1, -1 and 0. </span></span>
<span></span>
<span><span class="co"># VIP_importance is either 1 for TRUE and 0 for FALSE. So, basically only taking</span></span>
<span><span class="co"># the coef signs for singnificant values. </span></span>
<span></span>
<span><span class="co"># The function factor is used to encode a vector as a factor (the terms </span></span>
<span><span class="co"># ‘category’ and ‘enumerated type’ are also used for factors). </span></span>
<span><span class="co"># Here, factor will make R to treat the 1,-1 and 0 as categorical, rather than</span></span>
<span><span class="co"># continuous numbers.</span></span>
<span></span>
<span><span class="co"># Add two new columns: VIP_importance (TRUE/FALSE for cut-off 0.8), VIP_Coeff.</span></span>
<span><span class="va">PLS_gg</span> <span class="op">&lt;-</span> <span class="va">PLS_gg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>VIP_importance <span class="op">=</span> <span class="va">VIP</span> <span class="op">&gt;=</span> <span class="fl">0.8</span>,</span>
<span>         VIP_Coeff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sign.html">sign</a></span><span class="op">(</span><span class="va">Coef</span><span class="op">)</span> <span class="op">*</span> <span class="va">VIP_importance</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># geom_bar()'s default stat is "count"- count the number of data points for x values</span></span>
<span><span class="co"># here stat is "identity"- The identity statistic leaves the data unchanged.</span></span>
<span><span class="co"># use the data as it is for plotting height of each bar. </span></span>
<span><span class="va">VIP_plot</span><span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">PLS_gg</span>,</span>
<span>                  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>,y <span class="op">=</span> <span class="va">VIP</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">'identity'</span>,</span>
<span>           <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">VIP</span> <span class="op">&gt;</span> <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">VIP_plot</span> <span class="op">&lt;-</span> <span class="va">VIP_plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"VIP"</span>, </span>
<span>                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt;0.8"</span>, <span class="st">"&gt;0.8"</span><span class="op">)</span>, </span>
<span>                    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FALSE"</span> <span class="op">=</span> <span class="st">"grey"</span>, <span class="st">"TRUE"</span> <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># remove x-axis label and title and tick</span></span>
<span></span>
<span><span class="va">VIP_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/21.5d-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb355"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Plot PLS coefficient</span></span>
<span><span class="va">coeff_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">PLS_gg</span>,</span>
<span>                     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>,</span>
<span>                         y <span class="op">=</span> <span class="va">Coef</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span><span class="st">'identity'</span>,</span>
<span>           <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">VIP_Coeff</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Effect direction"</span>, </span>
<span>                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Advancing"</span>,</span>
<span>                               <span class="st">"Unimportant"</span>,</span>
<span>                               <span class="st">"Delaying"</span><span class="op">)</span>, </span>
<span>                    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"-1"</span> <span class="op">=</span> <span class="st">"red"</span>, </span>
<span>                               <span class="st">"0"</span> <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>                               <span class="st">"1"</span> <span class="op">=</span> <span class="st">"dark green"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"PLS coefficient"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">coeff_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/21.5d-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb356"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Plot tempearature</span></span>
<span><span class="va">temp_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">PLS_gg</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>,</span>
<span>                  ymin <span class="op">=</span> <span class="va">Tmean</span> <span class="op">-</span> <span class="va">Tstdev</span>,</span>
<span>                  ymax <span class="op">=</span> <span class="va">Tmean</span> <span class="op">+</span> <span class="va">Tstdev</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># fill grey for mix and max</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>,</span>
<span>                  ymin <span class="op">=</span> <span class="va">Tmean</span> <span class="op">-</span> <span class="va">Tstdev</span> <span class="op">*</span> <span class="op">(</span><span class="va">VIP_Coeff</span> <span class="op">==</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                  ymax <span class="op">=</span> <span class="va">Tmean</span> <span class="op">+</span> <span class="va">Tstdev</span> <span class="op">*</span> <span class="op">(</span><span class="va">VIP_Coeff</span> <span class="op">==</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># fill red when negative VIP_Coeff</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>,</span>
<span>                  ymin <span class="op">=</span> <span class="va">Tmean</span> <span class="op">-</span> <span class="va">Tstdev</span> <span class="op">*</span> <span class="op">(</span><span class="va">VIP_Coeff</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                  ymax <span class="op">=</span> <span class="va">Tmean</span> <span class="op">+</span> <span class="va">Tstdev</span> <span class="op">*</span> <span class="op">(</span><span class="va">VIP_Coeff</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="st">"dark green"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># fill green for positive VIP_Coeff</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>,</span>
<span>                y <span class="op">=</span> <span class="va">Tmean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="cn">T</span><span class="op">[</span><span class="va">mean</span><span class="op">]</span>,<span class="st">" (°C)"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">temp_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/21.5d-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb357"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Combine the plots</span></span>
<span><span class="co"># library(patchwork)</span></span>
<span></span>
<span><span class="va">plot</span><span class="op">&lt;-</span> <span class="op">(</span><span class="va">VIP_plot</span> <span class="op">+</span></span>
<span>          <span class="va">coeff_plot</span> <span class="op">+</span></span>
<span>          <span class="va">temp_plot</span> <span class="op">+</span></span>
<span>          <span class="fu">plot_layout</span><span class="op">(</span>ncol<span class="op">=</span><span class="fl">1</span>, <span class="co"># plots combine vertically in a single column</span></span>
<span>            guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span> <span class="co"># guides for each scale/give single shared legend</span></span>
<span>        <span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span>,</span>
<span>                  legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span>
<span>                  legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>                  axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/21.5d-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li>Now we have code that produces a nice compound figure that shows everything we expect of the outputs of a PLS analysis. Let’s make a function for future use.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb358"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ggplot_PLS</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">PLS_results</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span>    <span class="va">PLS_gg</span> <span class="op">&lt;-</span> <span class="va">PLS_results</span><span class="op">$</span><span class="va">PLS_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">trunc</a></span><span class="op">(</span><span class="va">Date</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span>, Day <span class="op">=</span> <span class="va">Date</span> <span class="op">-</span> <span class="va">Month</span> <span class="op">*</span> <span class="fl">100</span>, Date <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">PLS_gg</span><span class="op">$</span><span class="va">Date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2002</span>, <span class="va">PLS_gg</span><span class="op">$</span><span class="va">Month</span>, <span class="va">PLS_gg</span><span class="op">$</span><span class="va">Day</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">PLS_gg</span><span class="op">$</span><span class="va">Date</span><span class="op">[</span><span class="va">PLS_gg</span><span class="op">$</span><span class="va">JDay</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>, <span class="va">PLS_gg</span><span class="op">$</span><span class="va">Month</span><span class="op">[</span><span class="va">PLS_gg</span><span class="op">$</span><span class="va">JDay</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">]</span>,</span>
<span>        <span class="va">PLS_gg</span><span class="op">$</span><span class="va">Day</span><span class="op">[</span><span class="va">PLS_gg</span><span class="op">$</span><span class="va">JDay</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">PLS_gg</span> <span class="op">&lt;-</span> <span class="va">PLS_gg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>VIP_importance <span class="op">=</span> <span class="va">VIP</span> <span class="op">&gt;=</span> <span class="fl">0.8</span>, VIP_Coeff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sign.html">sign</a></span><span class="op">(</span><span class="va">Coef</span><span class="op">)</span> <span class="op">*</span> <span class="va">VIP_importance</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">VIP_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">PLS_gg</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>, y <span class="op">=</span> <span class="va">VIP</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">VIP</span> <span class="op">&gt;</span> <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">VIP_plot</span> <span class="op">&lt;-</span> <span class="va">VIP_plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"VIP"</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt;0.8"</span>, <span class="st">"&gt;0.8"</span><span class="op">)</span>,</span>
<span>        values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`FALSE` <span class="op">=</span> <span class="st">"grey"</span>, `TRUE` <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">coeff_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">PLS_gg</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>, y <span class="op">=</span> <span class="va">Coef</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">VIP_Coeff</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Effect direction"</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Advancing"</span>,</span>
<span>        <span class="st">"Unimportant"</span>, <span class="st">"Delaying"</span><span class="op">)</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`-1` <span class="op">=</span> <span class="st">"red"</span>, `0` <span class="op">=</span> <span class="st">"grey"</span>, `1` <span class="op">=</span> <span class="st">"dark green"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"PLS coefficient"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">temp_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">PLS_gg</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>, ymin <span class="op">=</span> <span class="va">Tmean</span> <span class="op">-</span> <span class="va">Tstdev</span>,</span>
<span>        ymax <span class="op">=</span> <span class="va">Tmean</span> <span class="op">+</span> <span class="va">Tstdev</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>, ymin <span class="op">=</span> <span class="va">Tmean</span> <span class="op">-</span></span>
<span>        <span class="va">Tstdev</span> <span class="op">*</span> <span class="op">(</span><span class="va">VIP_Coeff</span> <span class="op">==</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, ymax <span class="op">=</span> <span class="va">Tmean</span> <span class="op">+</span> <span class="va">Tstdev</span> <span class="op">*</span> <span class="op">(</span><span class="va">VIP_Coeff</span> <span class="op">==</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>, ymin <span class="op">=</span> <span class="va">Tmean</span> <span class="op">-</span> <span class="va">Tstdev</span> <span class="op">*</span> <span class="op">(</span><span class="va">VIP_Coeff</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, ymax <span class="op">=</span> <span class="va">Tmean</span> <span class="op">+</span></span>
<span>            <span class="va">Tstdev</span> <span class="op">*</span> <span class="op">(</span><span class="va">VIP_Coeff</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"dark green"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>,</span>
<span>        y <span class="op">=</span> <span class="va">Tmean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="cn">T</span><span class="op">[</span><span class="va">mean</span><span class="op">]</span>, <span class="st">" (°C)"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">plot</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">VIP_plot</span> <span class="op">+</span> <span class="va">coeff_plot</span> <span class="op">+</span> <span class="va">temp_plot</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span>, guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span>, legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>            axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">plot</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">ggplot_PLS</span><span class="op">(</span><span class="va">PLS_results</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/21.5e-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li>We see a strong bloom-advancing response to high temperatures in spring, but where is the chilling period?</li>
</ul>
<p><br></p>
</section><section id="exercises-on-chill-model-comparison-1" class="level3"><h3 class="anchored" data-anchor-id="exercises-on-chill-model-comparison-1">
<span style="color:#71797E">21.6</span>&nbsp; Exercises on chill model comparison</h3>
<div style="height: 18px;">

</div>
<p><strong><em>1. Briefly explain why you shouldn’t take the results of a PLS regression analysis between temperature and phenology at face value. What do you need in addition in order to make sense of such outputs?</em></strong></p>
<p>PLS regression is usually used for large datasets. However, in phenology analysis, dataset can be rather small. For example, in the case of bloom dates for temperate fruit trees, there is only one bloom date per year, compared to high-resolution temperature data. Although the PLS method also works with limited data, the results will be less reliable and should not be taken at face value. Several reasons can contribute to this:</p>
<ul>
<li><p>There are very few observations to correlate a dependent variable with many possible independent variables.</p></li>
<li><p>PLS only finds pattern within the dataset, which may or may not be meaningful— correlation does not mean causation.</p></li>
<li><p>A risk of overfitting where the model captures noise than meaningful trends.</p></li>
<li><p>Phenological variables may not response consistently to temperature as other environmental variables may also have impacts.</p></li>
</ul>
<p>In order to make sense of such outputs, we need to have a prior theory or assumptions about how the system works. We can then run the analyses to check if the outputs support or contradict our theory. This practice will help prevent ‘rationalizing’— a tendency to impose meaning on random patterns to make them appear reasonable.</p>
<p><br></p>
<p><strong><em>2. Replicate the PLS analysis for the Roter Boskoop dataset that you used in a previous lesson.</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb359"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create a data.frame with two columns: Year (Pheno_year) and pheno (JDay)</span></span>
<span><span class="va">Roter_first</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/read_tab.html">read_tab</a></span><span class="op">(</span><span class="st">"data/OT/Roter_Boskoop_bloom_1958_2019.csv.csv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Pheno_year</span>, <span class="va">First_bloom</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">First_bloom</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         Month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">First_bloom</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>, </span>
<span>         Day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">First_bloom</span>, <span class="fl">7</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/make_JDay.html">make_JDay</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Pheno_year</span>, <span class="va">JDay</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Year <span class="op">=</span> <span class="va">Pheno_year</span>,</span>
<span>         pheno <span class="op">=</span> <span class="va">JDay</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Recall temperature data to be used as weather data</span></span>
<span><span class="va">KA_temps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/read_tab.html">read_tab</a></span><span class="op">(</span><span class="st">"data/OT/TMaxTMin1958-2019_patched.csv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/make_JDay.html">make_JDay</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run PLS</span></span>
<span><span class="va">PLS_roter_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/PLS_pheno.html">PLS_pheno</a></span><span class="op">(</span><span class="va">KA_temps</span>, <span class="co"># weather data</span></span>
<span>                         <span class="va">Roter_first</span><span class="op">)</span> <span class="co"># bio data</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">PLS_roter_results</span><span class="op">$</span><span class="va">PLS_summary</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Date</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">JDay</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Coef</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">VIP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tstdev</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">801</td>
<td style="text-align: right;">-152</td>
<td style="text-align: right;">-0.0550839</td>
<td style="text-align: right;">0.4813947</td>
<td style="text-align: right;">18.32970</td>
<td style="text-align: right;">1.914004</td>
</tr>
<tr class="even">
<td style="text-align: right;">802</td>
<td style="text-align: right;">-151</td>
<td style="text-align: right;">-0.0280286</td>
<td style="text-align: right;">0.4583224</td>
<td style="text-align: right;">18.30846</td>
<td style="text-align: right;">1.884389</td>
</tr>
<tr class="odd">
<td style="text-align: right;">803</td>
<td style="text-align: right;">-150</td>
<td style="text-align: right;">0.0034428</td>
<td style="text-align: right;">0.4856287</td>
<td style="text-align: right;">18.27148</td>
<td style="text-align: right;">1.844368</td>
</tr>
<tr class="even">
<td style="text-align: right;">804</td>
<td style="text-align: right;">-149</td>
<td style="text-align: right;">0.0267715</td>
<td style="text-align: right;">0.4904789</td>
<td style="text-align: right;">18.23742</td>
<td style="text-align: right;">1.886276</td>
</tr>
<tr class="odd">
<td style="text-align: right;">805</td>
<td style="text-align: right;">-148</td>
<td style="text-align: right;">0.0250187</td>
<td style="text-align: right;">0.4832248</td>
<td style="text-align: right;">18.19609</td>
<td style="text-align: right;">1.884567</td>
</tr>
<tr class="even">
<td style="text-align: right;">806</td>
<td style="text-align: right;">-147</td>
<td style="text-align: right;">-0.0003849</td>
<td style="text-align: right;">0.5708911</td>
<td style="text-align: right;">18.17148</td>
<td style="text-align: right;">1.855337</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb360"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Plot PLS using function for ggplot</span></span>
<span><span class="fu">ggplot_PLS</span><span class="op">(</span><span class="va">PLS_roter_results</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/21.6.2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p><strong><em>3. Write down your thoughts on why we’re not seeing the temperature response pattern we may have expected. What happened to the chill response?</em></strong></p>
<p>It seems the answer is in the next chapter, but I will answer it based on this chapter, because this is a question for this chapter.</p>
<p>I can think of two possible reasons:</p>
<ol type="1">
<li><p>PLS method is not suitable for this analysis</p></li>
<li><p>There is actually no correlation observed— maybe the trees don’t need chilling phase?</p></li>
</ol>
<p><br></p>
</section></section><section id="chapter-22-successes-and-limitations-of-pls-regression-analysis" class="level2"><h2 class="anchored" data-anchor-id="chapter-22-successes-and-limitations-of-pls-regression-analysis">Chapter 22: Successes and limitations of PLS regression analysis</h2>
<section id="pls-regression" class="level3"><h3 class="anchored" data-anchor-id="pls-regression">
<span style="color:#71797E">22.1</span>&nbsp; PLS regression</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>In the context of phenology analysis, we can use the PLS regression method to correlate high-resolution temperature data (e.g.&nbsp;daily data) with low-resolution (annual) data on the timing of phenology events.</p></li>
<li><p>In the case of pears at Klein-Altendorf we were only really able to recognize the forcing period (where warm conditions advance bloom), while the chilling phase remained obscure.</p></li>
<li><p>This was a bit disappointing, because the two dormancy phases had emerged quite clearly in the study on walnut leaf emergence in California.</p></li>
<li><p>Let’s look at a few more examples to understand where and when this works— and to try to figure out why.</p></li>
</ul>
<p><br></p>
</section><section id="pls-examples" class="level3"><h3 class="anchored" data-anchor-id="pls-examples">
<span style="color:#71797E">22.2</span>&nbsp; PLS examples</h3>
<section id="grasslands-on-the-tibetan-plateau" class="level4"><h4 class="anchored" data-anchor-id="grasslands-on-the-tibetan-plateau">
<span style="color:#71797E">22.2.1</span>&nbsp; Grasslands on the Tibetan Plateau</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>We looked at how the beginning of the growing season has responded to climate change on the grasslands of the Tibetan Plateau.</p></li>
<li><p>When we just look at the trend over time, the pattern that emerges is rather confusing, with a fairly clear advancing trend until the late 1990s, followed by a surprising delay in ‘green up’ dates.</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./pic/ch22_1.png" class="img-fluid figure-img"></p>
<figcaption><strong><em>Beginning of the growing season (BGS) for steppe (A) and meadow (B) vegetation on the Tibetan Plateau between 1982 and 2006, derived from 15-day NDVI composites obtained from the Advanced Very High Resolution Radiometer (AVHRR) sensor. BGS dates advanced markedly between 1982 and the mid 1990s, before retreating significantly after that. Consistent increases in temperature (C and D) indicate that observed changes are not linear responses to temperature. Lines in the graph represent 3-year running means (<a href="https://www.pnas.org/doi/pdf/10.1073/pnas.1012490107">Yu et al., 2010</a>)</em></strong></figcaption></figure>
</div>
<p><br></p>
<ul>
<li>Similar to what we found for walnuts in California, we detected a conspicuous relationship between warm temperatures in winter and delayed beginning of the growing season in spring.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./pic/ch22_2.png" class="img-fluid figure-img"></p>
<figcaption><strong><em>Response of the BGS (A–D) in steppe and meadow vegetation of the Tibetan Plateau between 1982 and 2006 to monthly temperatures, according to PLS regression. The variable importance plots (VIP; C and D) indicate that temperatures in both spring (May and June) and winter (October through March) were important for explaining the response of BGS dates (VIP values above 0.8). Model coefficients (MC) of the centered and scaled data showed that warm winter temperatures delayed spring phenology (positive coefficients), whereas warm spring temperatures advanced the BGS (negative coefficients) for both steppe (A) and meadow (B). Including both effects into phenological models could substantially enhance our understanding of climate-change effects on vegetation at temperate and cold locations (<a href="https://www.pnas.org/doi/pdf/10.1073/pnas.1012490107">Yu et al., 2010</a>)</em></strong></figcaption></figure>
</div>
<p><br></p>
<ul>
<li>We later added a spatial component to this analysis, investigating vegetation responses to temperature on a pixel-by-pixel basis.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./pic/ch22_3.png" class="img-fluid figure-img"></p>
<figcaption><strong><em>Correlations of monthly temperatures (left) and precipitation (right) with the beginning of the growing season (BGS) on the Tibetan Plateau, according to Partial Least Squares (PLS) regression. For each variable, pixels for which the variable-importance-in-the-projection score was &lt;0.8 are shown in gray. Pixels with insufficient data for PLS analysis are shown in white (<a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0049230">Yu et al., 2012</a>)</em></strong></figcaption></figure>
</div>
<p><br></p>
<ul>
<li><p>In principle, the temperature response pattern of grasslands is thus similar to what we’ve seen for walnuts in California, but the mechanisms at work here are probably quite different, so we should not jump to conclusions here without adequate knowledge of grassland ecology.</p></li>
<li><p>These findings are concerning, because our initial expectation would probably have been that increasing temperature allows vegetation to get going earlier in the year. Failure of the vegetation to keep up with increasingly available thermal resources indicates a possible mismatch of the established ecosystems with future climatic conditions.</p></li>
<li><p>Such a mismatch is usually not sustainable, and it may open opportunities for invasive species that are better able to exploit the climatic ‘resources’ that will be available in the future.</p></li>
</ul>
<p><br></p>
</section><section id="deciduous-trees" class="level4"><h4 class="anchored" data-anchor-id="deciduous-trees">
<span style="color:#71797E">22.2.2</span>&nbsp; Deciduous trees</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>In his first analysis, Guo Liang looked at the phenology of Chinese chestnuts <a href="https://en.wikipedia.org/wiki/Castanea_mollissima">(<em>Castanea mollissima</em>)</a>grown in Beijing, China.</p></li>
<li><p>Once again, we can quite clearly see the forcing period - the long period of consistent negative model coefficients from January to May. The chilling period is also somewhat visible, but model coefficients are much less consistent, with many ‘unimportant’ values and even some interruptions.</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./pic/ch22_4.jpg" class="img-fluid figure-img"></p>
<figcaption><strong><em>Results of Partial Least Squares (PLS) regression correlating first flowering dates for chestnut at Beijing Summer Palace with 11-day running means of daily mean temperatures from the previous July to June. Blue bars in the top panel indicate VIP values greater than 0.8, the threshold for variable importance. In the middle and bottom panels, red color means the model coefficients are negative (and important), while the green color indicates positive (and important) relationships between flowering and temperature. The black line in the bottom figure stands for the mean temperatures, while the gray, green and red areas represent the standard deviation of daily mean temperatures for each day of the year (<a href="https://www.sciencedirect.com/science/article/pii/S0168192313001627">Guo et al., 2013</a>)</em></strong></figcaption></figure>
</div>
<p><br></p>
<ul>
<li>A similar analysis of cherry phenology from Campus Klein-Altendorf produced quite similar results. We see the pronounced forcing phase, which follows a chilling period that is difficult to delineate.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./pic/ch22_5.webp" class="img-fluid figure-img"></p>
<figcaption><strong><em>Results of Partial Least Squares (PLS) regression of bloom dates for cv. ‘Schneiders späte Knorpelkirsche’ cherries in Klein-Altendorf, Germany, with 11-day running means of daily mean temperatures. The top panel shows Variable Importance in the Projection (VIP) scores, the middle panel model coefficients of the centered and scaled data, and the bottom panel mean temperatures (black line) and their standard deviation (grey areas). Blue bars in the top panel indicate values above 0.8, the threshold for variable importance. In the middle and bottom figures, data for these dates is shown in red whenever model coefficients are negative, and green when they are positive (<a href="https://link.springer.com/article/10.1007/s00484-012-0594-y">Luedeling et al., 2013b</a>)</em></strong></figcaption></figure>
</div>
<p><br></p>
<ul>
<li>A common pattern that emerges here is that the forcing phase is clearly visible, while the chilling phase is hard to see. This is disappointing after the very clear pattern we found earlier in California:</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./pic/ch22_6.png" class="img-fluid figure-img"></p>
<figcaption><strong><em>Results of a PLS analysis relating leaf emergence dates of ‘Payne’ walnuts in California to mean daily temperature</em></strong></figcaption></figure>
</div>
<p><br></p>
</section><section id="why-were-not-seeing-the-chilling-phase" class="level4"><h4 class="anchored" data-anchor-id="why-were-not-seeing-the-chilling-phase">
<span style="color:#71797E">22.2.3</span>&nbsp; Why we’re not seeing the chilling phase</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>In the spider mite example, PLS regression was sensitive to the quantity of reflected radiation that reached the sensor, with greater reflectance at certain wavelengths and lower reflectance at other wavelengths indicating mite damage severity.</p></li>
<li><p>In detecting the forcing phase, PLS responded to temperature, with higher temperatures indicating greater heat accumulation, which was in turn related to early bloom.</p></li>
<li><p>In all of these cases, changes in the response variable were monotonically related to changes in the signal, i.e.&nbsp;the greater the signal, the greater/smaller the response.</p></li>
<li><p>Let’s look at the temperature ranges that the chill models respond to and compare this to the temperature range that we can observe at the three study locations during the winter months.</p></li>
<li><p>To determine the range of effective temperatures for the various chill models we’ve already worked with, let’s see how much chill they produce at various levels of constant temperatures (chill days is omitted here, because this model doesn’t work with constant temperatures):</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb361"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># library(chillR)</span></span>
<span><span class="co"># library(dormancyR)</span></span>
<span><span class="co"># library(ggplot2)</span></span>
<span><span class="co"># library(kableExtra)</span></span>
<span><span class="co"># library(patchwork)</span></span>
<span></span>
<span><span class="co"># List the hourly models to use for chill calculations</span></span>
<span><span class="va">hourly_models</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    Chilling_units <span class="op">=</span> <span class="va">chilling_units</span>,</span>
<span>    Low_chill <span class="op">=</span> <span class="va">low_chill_model</span>,</span>
<span>    Modified_Utah <span class="op">=</span> <span class="va">modified_utah_model</span>,</span>
<span>    North_Carolina <span class="op">=</span> <span class="va">north_carolina_model</span>,</span>
<span>    Positive_Utah <span class="op">=</span> <span class="va">positive_utah_model</span>,</span>
<span>    Chilling_Hours <span class="op">=</span> <span class="va">Chilling_Hours</span>,</span>
<span>    Utah_Chill_Units <span class="op">=</span> <span class="va">Utah_Model</span>,</span>
<span>    Chill_Portions <span class="op">=</span> <span class="va">Dynamic_Model</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># List the daily models to calculate daily chill requirements</span></span>
<span><span class="va">daily_models</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    Rate_of_Chill <span class="op">=</span> <span class="va">rate_of_chill</span>, </span>
<span>    Exponential_Chill <span class="op">=</span> <span class="va">exponential_chill</span>,</span>
<span>    Triangular_Chill_Haninnen <span class="op">=</span> <span class="va">triangular_chill_1</span>,</span>
<span>    Triangular_Chill_Legave <span class="op">=</span> <span class="va">triangular_chill_2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine both into a vector</span></span>
<span><span class="va">metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">daily_models</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">hourly_models</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Give model labels for plotting</span></span>
<span><span class="va">model_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Rate of Chill"</span>,</span>
<span>                  <span class="st">"Exponential Chill"</span>,</span>
<span>                  <span class="st">"Triangular Chill (Häninnen)"</span>,</span>
<span>                  <span class="st">"Triangular Chill (Legave)"</span>,</span>
<span>                  <span class="st">"Chilling Units"</span>,</span>
<span>                  <span class="st">"Low-Chill Chill Units"</span>,</span>
<span>                  <span class="st">"Modified Utah Chill Units"</span>,</span>
<span>                  <span class="st">"North Carolina Chill Units"</span>,</span>
<span>                  <span class="st">"Positive Utah Chill Units"</span>,</span>
<span>                  <span class="st">"Chilling Hours"</span>,</span>
<span>                  <span class="st">"Utah Chill Units"</span>,</span>
<span>                  <span class="st">"Chill Portions"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Create a function to calculate </span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="cn">T</span> <span class="kw">in</span> <span class="op">-</span><span class="fl">20</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span></span>
<span> <span class="op">{</span></span>
<span>  <span class="va">hourly</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span> <span class="va">hourly_models</span>,</span>
<span>                    <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># hourly models</span></span>
<span>                      <span class="fu">x</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">T</span>,<span class="fl">1000</span><span class="op">)</span><span class="op">)</span> <span class="co"># 51 x 1000 -&gt; 51000 outputs</span></span>
<span>                    <span class="op">)</span><span class="op">[</span><span class="fl">1000</span>,<span class="op">]</span> <span class="co"># take only 1000th row (end of a cycle run???)</span></span>
<span> </span>
<span>  <span class="co"># Just to create a data frame- same values for all columns</span></span>
<span>  <span class="va">temp_frame</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Tmin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">T</span>,<span class="fl">1000</span><span class="op">)</span>,</span>
<span>                           Tmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">T</span>,<span class="fl">1000</span><span class="op">)</span>,</span>
<span>                           Tmean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">T</span>,<span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="va">daily</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span> <span class="va">daily_models</span>,</span>
<span>                   <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> </span>
<span>                     <span class="fu">x</span><span class="op">(</span><span class="va">temp_frame</span><span class="op">)</span></span>
<span>                   <span class="op">)</span><span class="op">[</span><span class="fl">1000</span>,<span class="op">]</span></span>
<span><span class="co"># When T is -20 the sensitivity is created (the start) and then bind the rest to it</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="cn">T</span> <span class="op">==</span> <span class="op">-</span><span class="fl">20</span><span class="op">)</span></span>
<span>    <span class="va">sensitivity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>T <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                     <span class="va">daily</span>,</span>
<span>                     <span class="va">hourly</span><span class="op">)</span> <span class="kw">else</span>   </span>
<span>      <span class="va">sensitivity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">sensitivity</span>,</span>
<span>                           <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>T <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                             <span class="va">daily</span>,</span>
<span>                             <span class="va">hourly</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="va">sensitivity_normal</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">sensitivity</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">sensitivity</span><span class="op">)</span>,</span>
<span>                             <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>                               <span class="va">sensitivity</span><span class="op">[</span>,<span class="va">x</span><span class="op">]</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">sensitivity</span><span class="op">[</span>,<span class="va">x</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sensitivity_normal</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sensitivity</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sensitivity_gg</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">sensitivity_normal</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="va">Rate_of_Chill</span><span class="op">:</span><span class="va">Chill_Portions</span><span class="op">)</span></span>
<span>  </span>
<span> <span class="co"># melt(sensitivity_normal,id.vars="T")</span></span>
<span><span class="va">sensitivity_gg</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">sensitivity_gg</span><span class="op">$</span><span class="va">value</span><span class="op">&lt;=</span><span class="fl">0.001</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span></span>
<span><span class="va">chill</span><span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">sensitivity_gg</span>,</span>
<span>         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">T</span>,</span>
<span>             y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span>,</span>
<span>             size <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"light blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_y_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">model_labels</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Chill model"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Temperature (assumed constant, °C)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span>, <span class="fl">40</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"Chill \nWeight"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">chill</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/22.2.3a-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li>Now let’s summarize winter temperatures at the three locations for which we’ve seen phenology responses above: Klein-Altendorf (Germany), Beijing (China) and Davis (California).</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb362"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">KA_temps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/read_tab.html">read_tab</a></span><span class="op">(</span><span class="st">"data/OT/TMaxTMin1958-2019_patched.csv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/make_JDay.html">make_JDay</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">JDay</span> <span class="op">&gt;</span> <span class="fl">305</span> <span class="op">|</span> <span class="va">JDay</span> <span class="op">&lt;</span> <span class="fl">90</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/stack_hourly_temps.html">stack_hourly_temps</a></span><span class="op">(</span>latitude <span class="op">=</span> <span class="fl">50.6</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">hh_KA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">KA_temps</span><span class="op">$</span><span class="va">hourtemps</span><span class="op">$</span><span class="va">Temp</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hh_KA_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>T <span class="op">=</span> <span class="va">hh_KA</span><span class="op">$</span><span class="va">mids</span>, name <span class="op">=</span> <span class="st">"Klein-Altendorf, Germany"</span>, value <span class="op">=</span> <span class="va">hh_KA</span><span class="op">$</span><span class="va">counts</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">hh_KA</span><span class="op">$</span><span class="va">counts</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hh_KA_df</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">hh_KA_df</span><span class="op">$</span><span class="va">value</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span></span>
<span><span class="va">Beijing_temps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/read_tab.html">read_tab</a></span><span class="op">(</span><span class="st">"data/OT/Beijing_weather.csv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/make_JDay.html">make_JDay</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">JDay</span> <span class="op">&gt;</span> <span class="fl">305</span> <span class="op">|</span> <span class="va">JDay</span> <span class="op">&lt;</span> <span class="fl">90</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/stack_hourly_temps.html">stack_hourly_temps</a></span><span class="op">(</span>latitude <span class="op">=</span> <span class="fl">39.9</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hh_Beijing</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">Beijing_temps</span><span class="op">$</span><span class="va">hourtemps</span><span class="op">$</span><span class="va">Temp</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hh_Beijing_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>T <span class="op">=</span> <span class="va">hh_Beijing</span><span class="op">$</span><span class="va">mids</span>, name <span class="op">=</span> <span class="st">"Beijing, China"</span>, value <span class="op">=</span> <span class="va">hh_Beijing</span><span class="op">$</span><span class="va">counts</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">hh_Beijing</span><span class="op">$</span><span class="va">counts</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hh_Beijing_df</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">hh_Beijing_df</span><span class="op">$</span><span class="va">value</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span></span>
<span><span class="va">Davis_temps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/read_tab.html">read_tab</a></span><span class="op">(</span><span class="st">"data/OT/Davis_weather.csv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/make_JDay.html">make_JDay</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">JDay</span> <span class="op">&gt;</span> <span class="fl">305</span> <span class="op">|</span> <span class="va">JDay</span> <span class="op">&lt;</span> <span class="fl">90</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/stack_hourly_temps.html">stack_hourly_temps</a></span><span class="op">(</span>latitude <span class="op">=</span> <span class="fl">38.5</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">hh_Davis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">Davis_temps</span><span class="op">$</span><span class="va">hourtemps</span><span class="op">$</span><span class="va">Temp</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span><span class="op">:</span><span class="fl">40</span><span class="op">)</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hh_Davis_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>T <span class="op">=</span> <span class="va">hh_Davis</span><span class="op">$</span><span class="va">mids</span>, name <span class="op">=</span> <span class="st">"Davis, California"</span>, value <span class="op">=</span> <span class="va">hh_Davis</span><span class="op">$</span><span class="va">counts</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">hh_Davis</span><span class="op">$</span><span class="va">counts</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hh_Davis_df</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">hh_Davis_df</span><span class="op">$</span><span class="va">value</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span></span>
<span><span class="va">hh_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">hh_KA_df</span>, <span class="va">hh_Beijing_df</span>, <span class="va">hh_Davis_df</span><span class="op">)</span></span>
<span></span>
<span><span class="va">locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">hh_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">T</span>, y <span class="op">=</span> <span class="va">name</span>, size <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"coral2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Location"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Temperature (between November and March, °C)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span>,</span>
<span>    <span class="fl">40</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"Relative \nfrequency"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">locations</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/22.2.3b-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb363"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># To compare the plots, let’s combine them in one figure (using the patchwork</span></span>
<span><span class="co"># package):</span></span>
<span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">chill</span> <span class="op">+</span> <span class="va">locations</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span>, heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span>, legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/22.2.3b-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li>We already realized earlier that some of these models are probably pretty poor. So let’s simplify by only plotting chill according to the Dynamic Model:</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb364"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">chill</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">sensitivity_gg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Chill_Portions"</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">T</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"light blue"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_y_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="st">"Chill Portions"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Chill model"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Temperature (assumed constant, °C)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span>,</span>
<span>    <span class="fl">40</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"Chill \nWeight"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">chill</span> <span class="op">+</span> <span class="va">locations</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span>, heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span>, legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/22.2.3c-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li><p>If we compare the effective chill ranges with winter temperatures at the three locations, we can see that in Klein-Altendorf and Beijing, temperatures are quite often cooler than the effective temperature range for chill accumulation.</p></li>
<li><p>At Davis, this is rarely the case. Temperatures that are too warm for chill accumulation occur quite frequently at Davis, and occasionally at the other two locations. This means that at Davis, it is reasonable to expect that warm temperatures in winter reduce chill accumulation.</p></li>
<li><p>In the other two locations, this is not always the case. When it is relatively cold, warming may actually increase chill. When temperatures are relatively high, however, chill accumulation would be reduced by warming.</p></li>
<li><p>At these two locations, there is thus no monotonic relationship between temperature and chill accumulation. In such a setting, we shouldn’t expect PLS regression to produce clear results.</p></li>
</ul>
<p><br></p>
</section></section><section id="exercises-on-chill-model-comparison-2" class="level3"><h3 class="anchored" data-anchor-id="exercises-on-chill-model-comparison-2">
<span style="color:#71797E">22.3</span>&nbsp; Exercises on chill model comparison</h3>
<div style="height: 18px;">

</div>
<p><strong><em>1. Briefly explain in what climatic settings we can expect PLS regression to detect the chilling phase— and in what settings this probably won’t work.</em></strong></p>
<p>We can expect PLS regression to detect the chilling phase in relatively warmer climate where the temperature and chill accumulation have a monotonic relationship— warmer temperature during the chilling phase consistently reduces chill accumulation.</p>
<p>This probably won’t work in colder climate where the temperature and chill accumulation do not have a monotonic relationship, i.e.&nbsp;when temperatures fall below the effective chill portions range, warmer temperatures may actually contribute to better chill accumulation, while temperatures exceeding the effective chill temperature range can reduce chill accumulation.</p>
<p><br></p>
<p><strong><em>2. How could we overcome this problem?</em></strong></p>
<p>The answer to this question is in the next chapter but I have not read the next chapter yet, so I will answer based on the information given in this chapter.</p>
<p>In the examples of Beijing and Campus Klein-Altendorf, PLS regression was used to correlate the daily mean temperatures with first flowering dates. As pointed out in the lecture, the PLS could not capture chilling phase in these two colder regions, because a monotonic relationship between temperature and flowering response was not observed. When an increase in temperature can contribute to both advanced and delayed flowering response,the PLS will consider this inconsistent trend as no significant correlation— that’s why we cannot observe a proper chilling phase in the two examples.</p>
<p>To overcome this problem, we need a new independent variable other than temperature.</p>
<p>So, instead of correlating like this:</p>
<p><span class="math display">\[Temperature \rightarrow First~flowering~date\]</span></p>
<p>What if we draw the correlation like this:</p>
<p><span class="math display">\[Temperature \rightarrow Chill~hour \rightarrow First~flowering~date\]</span> Daily chill hours will have monotonic relationship with the flowering response <em>(What about excess chill hours? Can that be a problem too, as in normally more chill accumulation during chilling phase leads to earlier bloom date but too much chill accumulation leads to delayed bloom date? Will it still be monotonic if the chill portions/hours exceed the effective range or amount— can extremely low temperature delay bloom and should we consider this as well? Or this is not a problem at all because of the trend of warmer temperatures- global warming?)</em>. Therefore, the PLS would be able to identify a correlation, if one exists. Maybe we can calculate daily chill hours from the hourly temperature record and the effective chill temperature range of the location. Then, we can correlate chill hours with the first flowering dates— the PLS method can then detect the chilling phase.</p>
<p><br></p>
</section></section><section id="chapter-23-pls-regression-with-agroclimatic-metrics" class="level2"><h2 class="anchored" data-anchor-id="chapter-23-pls-regression-with-agroclimatic-metrics">Chapter 23: PLS regression with agroclimatic metrics</h2>
<section id="adjusting-pls-for-use-with-non-monotonic-relationships" class="level3"><h3 class="anchored" data-anchor-id="adjusting-pls-for-use-with-non-monotonic-relationships">
<span style="color:#71797E">23.1</span>&nbsp; Adjusting PLS for use with non-monotonic relationships</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>The most likely reason why PLS regression failed to pick up the chilling period in relatively cold locations is that there is no monotonic relationship between temperature and chill effectiveness, i.e.&nbsp;warmer temperatures may either lead to less chill (when it’s fairly warm) or more chill (when it’s cold).</p></li>
<li><p>To overcome this problem, we need to convert temperature into something that is monotonically related to chill accumulation, maybe by making use of the chill models.</p></li>
<li><p>If PLS holds its promise to identify chilling periods, it should be responsive to the daily rate of chill accumulation.</p></li>
<li><p>This brings us back to an old problem— we don’t really know how to quantify chill accumulation accurately, and we don’t really trust the models we have. But, let’s swallow this concerns for now.</p></li>
<li><p><strong><em>We’ll be converting temperature data to chill (and heat) accumulation to run PLS analyses. This strategy assumes that the respective chill and heat models are reasonable approximations of the underlying biology.</em></strong></p></li>
</ul>
<p><br></p>
</section><section id="pls-analysis-with-chilling-and-forcing-data" class="level3"><h3 class="anchored" data-anchor-id="pls-analysis-with-chilling-and-forcing-data">
<span style="color:#71797E">23.2</span>&nbsp; PLS analysis with chilling and forcing data</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>The <code>chillR</code> package has a function called <code>PLS_chill_force</code> that implements PLS analysis based on daily chill and heat accumulation rates.</p></li>
<li><p>When you look at the documentation of the <code>PLS_chill_force</code> function (e.g.&nbsp;by typing <code><a href="https://rdrr.io/pkg/chillR/man/PLS_chill_force.html">?PLS_chill_force</a></code>), you’ll see that this function requires a daily chill object (<code>daily_chill_obj</code>) as an input. This object contains daily chill and heat accumulation rates, as well as mean temperature data. (More info in documentation of <code>daily_chill</code>)</p></li>
<li><p>Let’s test on the first bloom dates of ‘Alexander Lucas’ pears in Klein-Altendorf. So we’ll start by applying the <code>daily_chill</code> function to produce such a daily chill object. We’ll also use a standard function in <code>chillR</code> (<code>make_daily_chill_plot2</code>) to plot daily chill accumulation:</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb365"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#library(chillR)</span></span>
<span></span>
<span><span class="co"># daily_chill function calculates calculates daily chill (with three models) </span></span>
<span><span class="co"># and heat accumulation for every day of an hourly temperature record </span></span>
<span><span class="co"># (best generated with stack_hourly_temps)</span></span>
<span></span>
<span><span class="co"># It includes the option to include calculation of a running mean, which smoothes </span></span>
<span><span class="co"># accumulation curves. Especially for the Dynamic Model, this may be advisable, </span></span>
<span><span class="co"># because it does not accumulate chill smoothly, but rather in steps.</span></span>
<span></span>
<span><span class="co"># Generate an hourly temperature record</span></span>
<span><span class="va">temps_hourly</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/read_tab.html">read_tab</a></span><span class="op">(</span><span class="st">"data/OT/TMaxTMin1958-2019_patched.csv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/stack_hourly_temps.html">stack_hourly_temps</a></span><span class="op">(</span>latitude <span class="op">=</span> <span class="fl">50.6</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">temps_hourly</span><span class="op">$</span><span class="va">hourtemps</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">DATE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">YEARMODA</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmax</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Tmin_source</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Tmax_source</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">no_Tmin</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">no_Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">JDay</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Hour</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">01-01-58</td>
<td style="text-align: right;">19580101</td>
<td style="text-align: right;">1958</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.5</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">22452</td>
<td style="text-align: left;">01-01-58</td>
<td style="text-align: right;">19580101</td>
<td style="text-align: right;">1958</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.5</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">44903</td>
<td style="text-align: left;">01-01-58</td>
<td style="text-align: right;">19580101</td>
<td style="text-align: right;">1958</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.5</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">67354</td>
<td style="text-align: left;">01-01-58</td>
<td style="text-align: right;">19580101</td>
<td style="text-align: right;">1958</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.5</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">89805</td>
<td style="text-align: left;">01-01-58</td>
<td style="text-align: right;">19580101</td>
<td style="text-align: right;">1958</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.5</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">112256</td>
<td style="text-align: left;">01-01-58</td>
<td style="text-align: right;">19580101</td>
<td style="text-align: right;">1958</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.5</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb366"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Apply the daily_chill function</span></span>
<span><span class="va">daychill</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/daily_chill.html">daily_chill</a></span><span class="op">(</span>hourtemps <span class="op">=</span> <span class="va">temps_hourly</span>,</span>
<span>                        running_mean <span class="op">=</span> <span class="fl">1</span>, <span class="co"># 1 (default) for no smoothing</span></span>
<span>                        models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>                          Chilling_Hours <span class="op">=</span> <span class="va">Chilling_Hours</span>,</span>
<span>                          Utah_Chill_Units <span class="op">=</span> <span class="va">Utah_Model</span>,</span>
<span>                          Chill_Portions <span class="op">=</span> <span class="va">Dynamic_Model</span>,</span>
<span>                          GDH <span class="op">=</span> <span class="va">GDH</span><span class="op">)</span></span>
<span>                        <span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">daychill</span><span class="op">$</span><span class="va">daily_chill</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">YYMMDD</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Chilling_Hours</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Utah_Chill_Units</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Chill_Portions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">GDH</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmean</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">no_Tmin</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">no_Tmax</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">19580101</td>
<td style="text-align: right;">1958</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">24.0</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">9.7845597</td>
<td style="text-align: right;">5.391120</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">FALSE</td>
</tr>
<tr class="even">
<td style="text-align: right;">19580102</td>
<td style="text-align: right;">1958</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">16.0</td>
<td style="text-align: right;">0.4444896</td>
<td style="text-align: right;">12.7332663</td>
<td style="text-align: right;">3.399713</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">FALSE</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19580103</td>
<td style="text-align: right;">1958</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.0383026</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">-2.601803</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">FALSE</td>
</tr>
<tr class="even">
<td style="text-align: right;">19580104</td>
<td style="text-align: right;">1958</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">0.3292715</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">-1.676056</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">FALSE</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19580105</td>
<td style="text-align: right;">1958</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">24.0</td>
<td style="text-align: right;">1.3920031</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">3.020140</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: right;">19580106</td>
<td style="text-align: right;">1958</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">21.5</td>
<td style="text-align: right;">1.1161587</td>
<td style="text-align: right;">0.4716365</td>
<td style="text-align: right;">3.284117</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: left;">FALSE</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb367"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Plot daily chill accumulation</span></span>
<span><span class="va">dc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/make_daily_chill_plot2.html">make_daily_chill_plot2</a></span><span class="op">(</span><span class="va">daychill</span>,</span>
<span>                             metrics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Chill_Portions"</span><span class="op">)</span>,</span>
<span>                             cumulative <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># show daily accumulation rates</span></span>
<span>                             startdate <span class="op">=</span> <span class="fl">300</span>,</span>
<span>                             enddate <span class="op">=</span> <span class="fl">30</span>,</span>
<span>                             focusyears <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2008</span><span class="op">)</span>, <span class="co"># highlight specific year</span></span>
<span>                             metriclabels <span class="op">=</span> <span class="st">"Chill Portions"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/23.2a-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li>We can also switch to cumulative view to illustrate how chill accumulation in a particular year differs from historic accumulation patterns.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb368"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/make_daily_chill_plot2.html">make_daily_chill_plot2</a></span><span class="op">(</span><span class="va">daychill</span>,</span>
<span>                             metrics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Chill_Portions"</span><span class="op">)</span>,</span>
<span>                             cumulative <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># show as cumulative accumulation</span></span>
<span>                             startdate <span class="op">=</span> <span class="fl">300</span>,</span>
<span>                             enddate <span class="op">=</span> <span class="fl">30</span>,</span>
<span>                             focusyears <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2008</span><span class="op">)</span>,</span>
<span>                             metriclabels <span class="op">=</span> <span class="st">"Chill Portions"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/23.2b-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li><p>One special feature in this plot are the double ticks on the x-axis. These account for the additional day (29<sup>th</sup> February) that is added to the year in leap years. These leap days make Julian dates not map to precisely the same calendar dates in each year. The double ticks are an attempt to do justice to this ambiguity.</p></li>
<li><p>We can now feed this daily chill object to the <code>PLS_chill_force</code> function. We’ll also need the pear bloom data again:</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb369"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create a data.frame with year and JDay of first bloom date</span></span>
<span><span class="co"># This is a required format for PLS_chill_force function</span></span>
<span><span class="va">Alex_first</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/read_tab.html">read_tab</a></span><span class="op">(</span><span class="st">"data/OT/Alexander_Lucas_bloom_1958_2019.csv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Pheno_year</span>, <span class="va">First_bloom</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">First_bloom</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         Month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">First_bloom</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         Day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">First_bloom</span>, <span class="fl">7</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/make_JDay.html">make_JDay</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Pheno_year</span>, </span>
<span>         <span class="va">JDay</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Year <span class="op">=</span> <span class="va">Pheno_year</span>,</span>
<span>         pheno <span class="op">=</span> <span class="va">JDay</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># PLS_chill_force function conducts a Partial Least Squares (PLS) regression </span></span>
<span><span class="co"># analysis relating an annual biological phenomenon, e.g. fruit tree flowering </span></span>
<span><span class="co"># or leaf emergence, to mean daily rates of chill (with three models) and heat </span></span>
<span><span class="co"># accumulation of the preceding 12 months. It produces figures that illustrate </span></span>
<span><span class="co"># statistical correlations between temperature variation during certain phases </span></span>
<span><span class="co"># and the timing of phenological events.</span></span>
<span></span>
<span><span class="va">plscf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/PLS_chill_force.html">PLS_chill_force</a></span><span class="op">(</span>daily_chill_obj <span class="op">=</span> <span class="va">daychill</span>, <span class="co">#generate with daily_chill</span></span>
<span>                         bio_data_frame <span class="op">=</span> <span class="va">Alex_first</span>,<span class="co">#Year and Pheno format only</span></span>
<span>                         split_month <span class="op">=</span> <span class="fl">6</span>,<span class="co">#last month for a given phenological year; all subsequent months in the following year </span></span>
<span>                         chill_models <span class="op">=</span> <span class="st">"Chill_Portions"</span>,</span>
<span>                         heat_models <span class="op">=</span> <span class="st">"GDH"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">plscf</span><span class="op">$</span><span class="va">Chill_Portions</span><span class="op">$</span><span class="va">GDH</span><span class="op">$</span><span class="va">PLS_summary</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Date</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Type</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">JDay</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Coef</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">VIP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MetricMean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MetricStdev</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">701</td>
<td style="text-align: left;">Chill</td>
<td style="text-align: right;">-183</td>
<td style="text-align: right;">0.0006500</td>
<td style="text-align: right;">0.3088661</td>
<td style="text-align: right;">0.0501720</td>
<td style="text-align: right;">0.2205416</td>
</tr>
<tr class="even">
<td style="text-align: right;">702</td>
<td style="text-align: left;">Chill</td>
<td style="text-align: right;">-182</td>
<td style="text-align: right;">-0.0828120</td>
<td style="text-align: right;">0.5363662</td>
<td style="text-align: right;">0.0499267</td>
<td style="text-align: right;">0.2194706</td>
</tr>
<tr class="odd">
<td style="text-align: right;">703</td>
<td style="text-align: left;">Chill</td>
<td style="text-align: right;">-181</td>
<td style="text-align: right;">0.0169911</td>
<td style="text-align: right;">0.6376308</td>
<td style="text-align: right;">0.0501616</td>
<td style="text-align: right;">0.2204947</td>
</tr>
<tr class="even">
<td style="text-align: right;">704</td>
<td style="text-align: left;">Chill</td>
<td style="text-align: right;">-180</td>
<td style="text-align: right;">-0.1470842</td>
<td style="text-align: right;">0.7171508</td>
<td style="text-align: right;">0.0671167</td>
<td style="text-align: right;">0.2532628</td>
</tr>
<tr class="odd">
<td style="text-align: right;">705</td>
<td style="text-align: left;">Chill</td>
<td style="text-align: right;">-179</td>
<td style="text-align: right;">0.2099085</td>
<td style="text-align: right;">1.7366297</td>
<td style="text-align: right;">0.0834634</td>
<td style="text-align: right;">0.2792043</td>
</tr>
<tr class="even">
<td style="text-align: right;">706</td>
<td style="text-align: left;">Chill</td>
<td style="text-align: right;">-178</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">0.0000000</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb370"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># We could have specified multiple chill and heat models, and the function would</span></span>
<span><span class="co"># have evaluated all combinations of these models. This is why, to find the </span></span>
<span><span class="co"># results, we have to look at plscf$Chill_Portions$GDH$PLS_summary</span></span>
<span></span>
<span><span class="co"># Plot the results with the inbuilt function plot_PLS, which is a fairly old</span></span>
<span><span class="co"># function that writes an image in a place you can specify.</span></span>
<span><span class="co"># This gives output in png and csv file.</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/plot_PLS.html">plot_PLS</a></span><span class="op">(</span><span class="va">plscf</span>,</span>
<span>         PLS_results_path <span class="op">=</span> <span class="st">"data/OT/plscf_outputs"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Call the generated result image</span></span>
<span><span class="fu">grid.raster</span><span class="op">(</span><span class="fu">readPNG</span><span class="op">(</span><span class="st">"data/OT/plscf_outputs_Chill_Portions_GDH.png"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/23.2c-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li><p>The results don’t look very clear quite yet. To a considerable extent, this is because we didn’t use a running mean to smooth the chill and heat data. Especially for the Dynamic Model, this is worth considering, because Chill Portions accumulate in a stepwise manner, rather than continuously. Such steps aren’t reached every day, which adds a random element to estimations of daily rates.</p></li>
<li><p>Let’s apply an 11-day running mean and plot the results again:</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb371"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plscf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/PLS_chill_force.html">PLS_chill_force</a></span><span class="op">(</span>daily_chill_obj <span class="op">=</span> <span class="va">daychill</span>, bio_data_frame <span class="op">=</span> <span class="va">Alex_first</span>,</span>
<span>    split_month <span class="op">=</span> <span class="fl">6</span>, chill_models <span class="op">=</span> <span class="st">"Chill_Portions"</span>, heat_models <span class="op">=</span> <span class="st">"GDH"</span>, runn_means <span class="op">=</span> <span class="fl">11</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/plot_PLS.html">plot_PLS</a></span><span class="op">(</span><span class="va">plscf</span>, PLS_results_path <span class="op">=</span> <span class="st">"data/OT/plscf_outputs_11days"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">grid.raster</span><span class="op">(</span><span class="fu">readPNG</span><span class="op">(</span><span class="st">"data/OT/plscf_outputs_11days_Chill_Portions_GDH.png"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/23.2d-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li><p>This looks a lot clearer now. We see two plots here, with the one on the left showing the relationship between bloom dates and chill accumulation, and the one on the right showing the same for heat accumulation.</p></li>
<li><p>Note that these are plotted in different panels, but they emerged from the same PLS analysis, which thus related bloom dates to a total of 730 independent variables— chill and heat accumulation dates for each calendar day (if you set <code>end_at_pheno_end = TRUE</code>, minus all days after the latest bloom date).</p></li>
<li><p>To find the chilling and forcing periods, we should now look for consistent periods of negative model coefficients on both sides of the figure. For the chilling period, we’ll look on the left, where the relationship of bloom dates with daily chill accumulation rates is shown, and for the forcing period, we’ll look right, where the same is shown for daily heat accumulation rates.</p></li>
<li><p>Again, the forcing period is easier to see than the chilling phase. It’s approximately between early January and the bloom date (between mid-March and early May).</p></li>
<li><p>The chilling period is still a bit hard to see, but we can now detect a phase between some point in November or early December and February where high chill accumulation rates are correlated with early bloom.</p></li>
<li><p>In these delineations, I recommend to not focus too narrowly on ‘important’ values, but rather take a broad perspective in evaluating model coefficient dynamics.</p></li>
<li><p>Always remember that PLS regression with small datasets may struggle to distinguish signals from noise, with random effects easily creeping in. We also need to remember that our chill and heat models aren’t perfect and that they don’t actually include much knowledge on dormancy physiology.</p></li>
</ul>
<p><br></p>
</section><section id="delineating-chilling-and-forcing-periods" class="level3"><h3 class="anchored" data-anchor-id="delineating-chilling-and-forcing-periods">
<span style="color:#71797E">23.3</span>&nbsp; Delineating chilling and forcing periods</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>The precise delineations of chilling and forcing periods are often a bit debatable, and there have often been slight disagreements about the precise dates to use.</p></li>
<li><p>I would recommend taking both the plot and the detailed results table into account in deciding when periods start and end. More importantly, consider what you know about tree dormancy! <strong><em>Never lose sight of the ecological theory behind your analysis when you evaluate the results.</em></strong></p></li>
<li><p>My call on the present dataset would be a chilling period between 13<sup>th</sup> November and 3<sup>rd</sup> March (Julian dates -48 to 62) and a forcing period between 3<sup>rd</sup> January and the date of bloom (Julian dates 3 to 105.5, which represents the median of all bloom dates).</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb372"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/chillR/man/plot_PLS.html">plot_PLS</a></span><span class="op">(</span><span class="va">plscf</span>, PLS_results_path <span class="op">=</span> <span class="st">"data/OT/plscf_outputs_11days_periods"</span>, add_chill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">48</span>,</span>
<span>    <span class="fl">62</span><span class="op">)</span>, add_heat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">105.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># grid.raster(readPNG('data/OT/plscf_outputs_11days_periods_Chill_Portions_GDH.png'))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./data/OT/plscf_outputs_11days_periods_Chill_Portions_GDH.png" class="img-fluid figure-img"></p>
<figcaption><strong><em>Plot of <code>PLS_chill_force</code> results, with our delineations of chilling (light blue) and forcing (light red) phases highlighted</em></strong></figcaption></figure>
</div>
<p><br></p>
</section><section id="ggplotting-the-results" class="level3"><h3 class="anchored" data-anchor-id="ggplotting-the-results">
<span style="color:#71797E">23.4</span>&nbsp; <code>ggplot</code>ting the results</h3>
<div style="height: 18px;">

</div>
<ul>
<li>The only real change is that we need to split the results according to chill vs.&nbsp;heat analysis. We’ll use <code>facet_wrap</code> for this.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb373"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## First we need to prepare the data for `ggplot`ting:</span></span>
<span></span>
<span><span class="co"># Date chillR format date</span></span>
<span><span class="va">PLS_gg</span> <span class="op">&lt;-</span> <span class="va">plscf</span><span class="op">$</span><span class="va">Chill_Portions</span><span class="op">$</span><span class="va">GDH</span><span class="op">$</span><span class="va">PLS_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">trunc</a></span><span class="op">(</span><span class="va">Date</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span>, <span class="co"># round number towards 0</span></span>
<span>         Day <span class="op">=</span> <span class="va">Date</span> <span class="op">-</span> <span class="va">Month</span> <span class="op">*</span> <span class="fl">100</span>,</span>
<span>         Date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2002</span>,</span>
<span>                        <span class="va">Month</span>,</span>
<span>                        <span class="va">Day</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Change year to last year for JDay less than or equal to zero (-JDay)</span></span>
<span><span class="va">PLS_gg</span><span class="op">[</span><span class="va">PLS_gg</span><span class="op">$</span><span class="va">JDay</span> <span class="op">&lt;=</span> <span class="fl">0</span>,<span class="st">"Date"</span><span class="op">]</span><span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>,</span>
<span>          <span class="va">PLS_gg</span><span class="op">$</span><span class="va">Month</span><span class="op">[</span><span class="va">PLS_gg</span><span class="op">$</span><span class="va">JDay</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">]</span>,</span>
<span>          <span class="va">PLS_gg</span><span class="op">$</span><span class="va">Day</span><span class="op">[</span><span class="va">PLS_gg</span><span class="op">$</span><span class="va">JDay</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># sign(Coef) gives a vector of 1, 0, -1, multiplied by VIP_importance (1 or 0). </span></span>
<span><span class="co"># Then, use factor to keep it categorical. </span></span>
<span><span class="co"># Add VIP_importance (TRUE, FALSE) and VIP_Coeff (1, -1, 0) columns.</span></span>
<span><span class="va">PLS_gg</span> <span class="op">&lt;-</span> <span class="va">PLS_gg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>VIP_importance <span class="op">=</span> <span class="va">VIP</span> <span class="op">&gt;=</span> <span class="fl">0.8</span>,</span>
<span>         VIP_Coeff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sign.html">sign</a></span><span class="op">(</span><span class="va">Coef</span><span class="op">)</span> <span class="op">*</span> <span class="va">VIP_importance</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We decide this based on csv and graph outputs?</span></span>
<span><span class="va">chill_start_JDay</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">48</span></span>
<span><span class="va">chill_end_JDay</span> <span class="op">&lt;-</span> <span class="fl">62</span></span>
<span><span class="va">heat_start_JDay</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">heat_end_JDay</span> <span class="op">&lt;-</span> <span class="fl">105.5</span></span>
<span></span>
<span></span>
<span><span class="co"># Convert JDay into Date (change JDay to seconds and then add)</span></span>
<span><span class="va">chill_start_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>,</span>
<span>                            <span class="fl">12</span>,</span>
<span>                            <span class="fl">31</span><span class="op">)</span> <span class="op">+</span> <span class="va">chill_start_JDay</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span></span>
<span><span class="va">chill_end_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>,</span>
<span>                          <span class="fl">12</span>,</span>
<span>                          <span class="fl">31</span><span class="op">)</span> <span class="op">+</span> <span class="va">chill_end_JDay</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span></span>
<span><span class="va">heat_start_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>,</span>
<span>                           <span class="fl">12</span>,</span>
<span>                           <span class="fl">31</span><span class="op">)</span> <span class="op">+</span> <span class="va">heat_start_JDay</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span></span>
<span><span class="va">heat_end_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>,</span>
<span>                         <span class="fl">12</span>,</span>
<span>                         <span class="fl">31</span><span class="op">)</span> <span class="op">+</span> <span class="va">heat_end_JDay</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span></span>
<span></span>
<span><span class="co">## This time we’ll start with the bottom plot, because that’s the most </span></span>
<span><span class="co">## complicated one. It’s complicated, because we need to put different labels on</span></span>
<span><span class="co">## the y-axes of the two facets.</span></span>
<span></span>
<span><span class="co">## Since the daily chill accumulation rate is between 0 and ~1 Chill Portions, </span></span>
<span><span class="co">## and the daily heat accumulation rate can reach 300 GDH and more, we also need </span></span>
<span><span class="co">## different scales for the axes. </span></span>
<span></span>
<span><span class="co">## We’ll start with the hardest plot, because the way we solve these problems </span></span>
<span><span class="co">## may have implications for how we have to construct the other plots.</span></span>
<span></span>
<span><span class="co">#library(ggplot2)</span></span>
<span></span>
<span><span class="va">temp_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">PLS_gg</span>,</span>
<span>                    x <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>, <span class="co"># add shaded rectangular box</span></span>
<span>           xmin <span class="op">=</span> <span class="va">chill_start_date</span>,</span>
<span>           xmax <span class="op">=</span> <span class="va">chill_end_date</span>,</span>
<span>           ymin <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span>
<span>           ymax <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>           alpha <span class="op">=</span> <span class="fl">.1</span>, <span class="co"># transparency 10%</span></span>
<span>           fill <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>,</span>
<span>           xmin <span class="op">=</span> <span class="va">heat_start_date</span>,</span>
<span>           xmax <span class="op">=</span> <span class="va">heat_end_date</span>,</span>
<span>           ymin <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span>
<span>           ymax <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>           alpha <span class="op">=</span> <span class="fl">.1</span>,</span>
<span>           fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>,</span>
<span>           xmin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>, <span class="co"># this gives earliest bloom date?</span></span>
<span>                          <span class="fl">12</span>,</span>
<span>                          <span class="fl">31</span><span class="op">)</span> <span class="op">+</span></span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">plscf</span><span class="op">$</span><span class="va">pheno</span><span class="op">$</span><span class="va">pheno</span>,</span>
<span>                 na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span>,</span>
<span>           xmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>, <span class="co"># latest bloom date?</span></span>
<span>                          <span class="fl">12</span>,</span>
<span>                          <span class="fl">31</span><span class="op">)</span> <span class="op">+</span></span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">plscf</span><span class="op">$</span><span class="va">pheno</span><span class="op">$</span><span class="va">pheno</span>,</span>
<span>                 na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span>,</span>
<span>           ymin <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span>
<span>           ymax <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>           alpha <span class="op">=</span> <span class="fl">.1</span>,</span>
<span>           fill <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>, <span class="co"># add median bloom date line</span></span>
<span>                                  <span class="fl">12</span>,</span>
<span>                                  <span class="fl">31</span><span class="op">)</span> <span class="op">+</span></span>
<span>               <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">plscf</span><span class="op">$</span><span class="va">pheno</span><span class="op">$</span><span class="va">pheno</span>,</span>
<span>                      na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span>,</span>
<span>             linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>, <span class="co"># add uncertainty</span></span>
<span>                  ymin <span class="op">=</span> <span class="va">MetricMean</span> <span class="op">-</span> <span class="va">MetricStdev</span> ,</span>
<span>                  ymax <span class="op">=</span> <span class="va">MetricMean</span> <span class="op">+</span> <span class="va">MetricStdev</span><span class="op">)</span>,</span>
<span>              fill<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>, <span class="co"># negative correlation then fill red?</span></span>
<span>                  ymin <span class="op">=</span> <span class="va">MetricMean</span> <span class="op">-</span> <span class="va">MetricStdev</span> <span class="op">*</span> <span class="op">(</span><span class="va">VIP_Coeff</span> <span class="op">==</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                  ymax <span class="op">=</span> <span class="va">MetricMean</span> <span class="op">+</span> <span class="va">MetricStdev</span> <span class="op">*</span> <span class="op">(</span><span class="va">VIP_Coeff</span> <span class="op">==</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>,</span>
<span>                  ymin <span class="op">=</span> <span class="va">MetricMean</span> <span class="op">-</span> <span class="va">MetricStdev</span> <span class="op">*</span> <span class="op">(</span><span class="va">VIP_Coeff</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                  ymax <span class="op">=</span> <span class="va">MetricMean</span> <span class="op">+</span> <span class="va">MetricStdev</span> <span class="op">*</span> <span class="op">(</span><span class="va">VIP_Coeff</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="st">"dark green"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>,</span>
<span>                y <span class="op">=</span> <span class="va">MetricMean</span> <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">temp_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/23.4a-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb374"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use the facet labels instead and moved them to the left side, using them as </span></span>
<span><span class="co"># y-axis labels. The labeller element in facet_wrap can easily be customized </span></span>
<span><span class="co"># with text of your choice. </span></span>
<span><span class="va">temp_plot</span> <span class="op">&lt;-</span> <span class="va">temp_plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">Type</span><span class="op">)</span>, </span>
<span>             scales <span class="op">=</span> <span class="st">"free_y"</span>, <span class="co"># free scales in y dimension</span></span>
<span>             strip.position <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>             labeller <span class="op">=</span></span>
<span>               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html">labeller</a></span><span class="op">(</span>Type <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/as_labeller.html">as_labeller</a></span><span class="op">(</span></span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Chill <span class="op">=</span> <span class="st">"Chill (CP)"</span>,</span>
<span>                 Heat <span class="op">=</span> <span class="st">"Heat (GDH)"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Daily chill and heat accumulation rates"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        strip.placement <span class="op">=</span> <span class="st">"outside"</span>,</span>
<span>        strip.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span><span class="fl">12</span><span class="op">)</span>,</span>
<span>        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span><span class="va">temp_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/23.4a-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li><p>Now use the same strategy to make the VIP and model coefficient plots (this is important, because the plots should have similar structures when we combine them later).</p></li>
<li><p>Create VIP plot:</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb375"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">VIP_plot</span><span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">PLS_gg</span>,</span>
<span>                  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>,</span>
<span>                      y <span class="op">=</span> <span class="va">VIP</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>,</span>
<span>           xmin <span class="op">=</span> <span class="va">chill_start_date</span>,</span>
<span>           xmax <span class="op">=</span> <span class="va">chill_end_date</span>,</span>
<span>           ymin <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span>
<span>           ymax <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>           alpha <span class="op">=</span> <span class="fl">.1</span>,</span>
<span>           fill <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>,</span>
<span>           xmin <span class="op">=</span> <span class="va">heat_start_date</span>,</span>
<span>           xmax <span class="op">=</span> <span class="va">heat_end_date</span>,</span>
<span>           ymin <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span>
<span>           ymax <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>           alpha <span class="op">=</span> <span class="fl">.1</span>,</span>
<span>           fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>,</span>
<span>           xmin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>,</span>
<span>                          <span class="fl">12</span>,</span>
<span>                          <span class="fl">31</span><span class="op">)</span> <span class="op">+</span></span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">plscf</span><span class="op">$</span><span class="va">pheno</span><span class="op">$</span><span class="va">pheno</span>,</span>
<span>                 na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span>,</span>
<span>           xmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>,</span>
<span>                          <span class="fl">12</span>,</span>
<span>                          <span class="fl">31</span><span class="op">)</span> <span class="op">+</span></span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">plscf</span><span class="op">$</span><span class="va">pheno</span><span class="op">$</span><span class="va">pheno</span>,</span>
<span>                 na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span>,</span>
<span>           ymin <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span>
<span>           ymax <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>           alpha <span class="op">=</span> <span class="fl">.1</span>,</span>
<span>           fill <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>,</span>
<span>                                  <span class="fl">12</span>,</span>
<span>                                  <span class="fl">31</span><span class="op">)</span> <span class="op">+</span></span>
<span>               <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">plscf</span><span class="op">$</span><span class="va">pheno</span><span class="op">$</span><span class="va">pheno</span>,</span>
<span>                      na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span>,</span>
<span>             linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">'identity'</span>, <span class="co"># leave data unchanged</span></span>
<span>           <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">VIP</span> <span class="op">&gt;</span> <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">VIP_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/23.4b-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb376"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Split the VIP_plot by Type</span></span>
<span><span class="va">VIP_plot</span> <span class="op">&lt;-</span> <span class="va">VIP_plot</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">Type</span><span class="op">)</span>,</span>
<span>             scales <span class="op">=</span> <span class="st">"free"</span>,</span>
<span>             strip.position <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>             labeller <span class="op">=</span> </span>
<span>               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html">labeller</a></span><span class="op">(</span>Type <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/as_labeller.html">as_labeller</a></span><span class="op">(</span></span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Chill <span class="op">=</span> <span class="st">"VIP for chill"</span>,</span>
<span>                   Heat <span class="op">=</span> <span class="st">"VIP for heat"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">plscf</span><span class="op">$</span><span class="va">Chill_Portions</span><span class="op">$</span><span class="va">GDH</span><span class="op">$</span><span class="va">PLS_summary</span><span class="op">$</span><span class="va">VIP</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Variable Importance in the Projection (VIP) scores"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        strip.placement <span class="op">=</span> <span class="st">"outside"</span>,</span>
<span>        strip.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>  </span>
<span><span class="va">VIP_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/23.4b-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb377"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Change color to grey and blue</span></span>
<span><span class="va">VIP_plot</span> <span class="op">&lt;-</span> <span class="va">VIP_plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"VIP"</span>, </span>
<span>                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt;0.8"</span>, <span class="st">"&gt;0.8"</span><span class="op">)</span>, </span>
<span>                    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FALSE"</span> <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>                               <span class="st">"TRUE"</span> <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">VIP_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/23.4b-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>_ Create model coefficient plots:</p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb378"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">coeff_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">PLS_gg</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>, y <span class="op">=</span> <span class="va">Coef</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>, xmin <span class="op">=</span> <span class="va">chill_start_date</span>,</span>
<span>    xmax <span class="op">=</span> <span class="va">chill_end_date</span>, ymin <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, ymax <span class="op">=</span> <span class="cn">Inf</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, fill <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>, xmin <span class="op">=</span> <span class="va">heat_start_date</span>, xmax <span class="op">=</span> <span class="va">heat_end_date</span>, ymin <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, ymax <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>        alpha <span class="op">=</span> <span class="fl">0.1</span>, fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>, xmin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>, <span class="fl">12</span>, <span class="fl">31</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">plscf</span><span class="op">$</span><span class="va">pheno</span><span class="op">$</span><span class="va">pheno</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span>, xmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>, <span class="fl">12</span>, <span class="fl">31</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">plscf</span><span class="op">$</span><span class="va">pheno</span><span class="op">$</span><span class="va">pheno</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span>, ymin <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, ymax <span class="op">=</span> <span class="cn">Inf</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>, <span class="fl">12</span>, <span class="fl">31</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">plscf</span><span class="op">$</span><span class="va">pheno</span><span class="op">$</span><span class="va">pheno</span>,</span>
<span>    na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">VIP_Coeff</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">coeff_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/23.4c-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb379"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Wrap by Type</span></span>
<span><span class="va">coeff_plot</span> <span class="op">&lt;-</span> <span class="va">coeff_plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">Type</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free"</span>, strip.position <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>    labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html">labeller</a></span><span class="op">(</span>Type <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/as_labeller.html">as_labeller</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Chill <span class="op">=</span> <span class="st">"MC for chill"</span>, Heat <span class="op">=</span> <span class="st">"MC for heat"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">plscf</span><span class="op">$</span><span class="va">Chill_Portions</span><span class="op">$</span><span class="va">GDH</span><span class="op">$</span><span class="va">PLS_summary</span><span class="op">$</span><span class="va">Coef</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">plscf</span><span class="op">$</span><span class="va">Chill_Portions</span><span class="op">$</span><span class="va">GDH</span><span class="op">$</span><span class="va">PLS_summary</span><span class="op">$</span><span class="va">Coef</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Model coefficients (MC)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, strip.placement <span class="op">=</span> <span class="st">"outside"</span>,</span>
<span>    strip.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">coeff_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/23.4c-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb380"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Change colors and legends</span></span>
<span><span class="va">coeff_plot</span> <span class="op">&lt;-</span> <span class="va">coeff_plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Effect direction"</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Advancing"</span>,</span>
<span>    <span class="st">"Unimportant"</span>, <span class="st">"Delaying"</span><span class="op">)</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`-1` <span class="op">=</span> <span class="st">"red"</span>, `0` <span class="op">=</span> <span class="st">"grey"</span>, `1` <span class="op">=</span> <span class="st">"dark green"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"PLS coefficient"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">coeff_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/23.4c-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li>Now it’s time to combine the plots. We’ll use the <code>patchwork</code> package again.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb381"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># library(patchwork)</span></span>
<span></span>
<span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">VIP_plot</span> <span class="op">+</span> <span class="va">coeff_plot</span> <span class="op">+</span> <span class="va">temp_plot</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span>, guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span>, legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>        axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/23.4d-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li>Make a function for later use.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb382"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plot_PLS_chill_force</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">plscf</span>, <span class="va">chill_metric</span> <span class="op">=</span> <span class="st">"Chill_Portions"</span>, <span class="va">heat_metric</span> <span class="op">=</span> <span class="st">"GDH"</span>,</span>
<span>    <span class="va">chill_label</span> <span class="op">=</span> <span class="st">"CP"</span>, <span class="va">heat_label</span> <span class="op">=</span> <span class="st">"GDH"</span>, <span class="va">chill_phase</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">48</span>, <span class="fl">62</span><span class="op">)</span>, <span class="va">heat_phase</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,</span>
<span>        <span class="fl">105.5</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">PLS_gg</span> <span class="op">&lt;-</span> <span class="va">plscf</span><span class="op">[[</span><span class="va">chill_metric</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">heat_metric</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">PLS_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">trunc</a></span><span class="op">(</span><span class="va">Date</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span>, Day <span class="op">=</span> <span class="va">Date</span> <span class="op">-</span> <span class="va">Month</span> <span class="op">*</span> <span class="fl">100</span>, Date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2002</span>,</span>
<span>            <span class="va">Month</span>, <span class="va">Day</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">PLS_gg</span><span class="op">[</span><span class="va">PLS_gg</span><span class="op">$</span><span class="va">JDay</span> <span class="op">&lt;=</span> <span class="fl">0</span>, <span class="st">"Date"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>, <span class="va">PLS_gg</span><span class="op">$</span><span class="va">Month</span><span class="op">[</span><span class="va">PLS_gg</span><span class="op">$</span><span class="va">JDay</span> <span class="op">&lt;=</span></span>
<span>        <span class="fl">0</span><span class="op">]</span>, <span class="va">PLS_gg</span><span class="op">$</span><span class="va">Day</span><span class="op">[</span><span class="va">PLS_gg</span><span class="op">$</span><span class="va">JDay</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">PLS_gg</span> <span class="op">&lt;-</span> <span class="va">PLS_gg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>VIP_importance <span class="op">=</span> <span class="va">VIP</span> <span class="op">&gt;=</span> <span class="fl">0.8</span>, VIP_Coeff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sign.html">sign</a></span><span class="op">(</span><span class="va">Coef</span><span class="op">)</span> <span class="op">*</span> <span class="va">VIP_importance</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">chill_start_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>, <span class="fl">12</span>, <span class="fl">31</span><span class="op">)</span> <span class="op">+</span> <span class="va">chill_phase</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span></span>
<span>    <span class="va">chill_end_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>, <span class="fl">12</span>, <span class="fl">31</span><span class="op">)</span> <span class="op">+</span> <span class="va">chill_phase</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span></span>
<span>    <span class="va">heat_start_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>, <span class="fl">12</span>, <span class="fl">31</span><span class="op">)</span> <span class="op">+</span> <span class="va">heat_phase</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span></span>
<span>    <span class="va">heat_end_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>, <span class="fl">12</span>, <span class="fl">31</span><span class="op">)</span> <span class="op">+</span> <span class="va">heat_phase</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span></span>
<span></span>
<span>    <span class="va">temp_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">PLS_gg</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>, xmin <span class="op">=</span> <span class="va">chill_start_date</span>, xmax <span class="op">=</span> <span class="va">chill_end_date</span>,</span>
<span>        ymin <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, ymax <span class="op">=</span> <span class="cn">Inf</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, fill <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>, xmin <span class="op">=</span> <span class="va">heat_start_date</span>,</span>
<span>        xmax <span class="op">=</span> <span class="va">heat_end_date</span>, ymin <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, ymax <span class="op">=</span> <span class="cn">Inf</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>, xmin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>, <span class="fl">12</span>, <span class="fl">31</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">plscf</span><span class="op">$</span><span class="va">pheno</span><span class="op">$</span><span class="va">pheno</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span></span>
<span>            <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span>, xmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>, <span class="fl">12</span>, <span class="fl">31</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">plscf</span><span class="op">$</span><span class="va">pheno</span><span class="op">$</span><span class="va">pheno</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span></span>
<span>            <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span>, ymin <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, ymax <span class="op">=</span> <span class="cn">Inf</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, fill <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>,</span>
<span>        <span class="fl">12</span>, <span class="fl">31</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">plscf</span><span class="op">$</span><span class="va">pheno</span><span class="op">$</span><span class="va">pheno</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>, ymin <span class="op">=</span> <span class="va">MetricMean</span> <span class="op">-</span> <span class="va">MetricStdev</span>, ymax <span class="op">=</span> <span class="va">MetricMean</span> <span class="op">+</span></span>
<span>            <span class="va">MetricStdev</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>, ymin <span class="op">=</span> <span class="va">MetricMean</span> <span class="op">-</span></span>
<span>        <span class="va">MetricStdev</span> <span class="op">*</span> <span class="op">(</span><span class="va">VIP_Coeff</span> <span class="op">==</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, ymax <span class="op">=</span> <span class="va">MetricMean</span> <span class="op">+</span> <span class="va">MetricStdev</span> <span class="op">*</span> <span class="op">(</span><span class="va">VIP_Coeff</span> <span class="op">==</span></span>
<span>        <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>, ymin <span class="op">=</span> <span class="va">MetricMean</span> <span class="op">-</span> <span class="va">MetricStdev</span> <span class="op">*</span></span>
<span>        <span class="op">(</span><span class="va">VIP_Coeff</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, ymax <span class="op">=</span> <span class="va">MetricMean</span> <span class="op">+</span> <span class="va">MetricStdev</span> <span class="op">*</span> <span class="op">(</span><span class="va">VIP_Coeff</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"dark green"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>, y <span class="op">=</span> <span class="va">MetricMean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">Type</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>,</span>
<span>        strip.position <span class="op">=</span> <span class="st">"left"</span>, labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html">labeller</a></span><span class="op">(</span>Type <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/as_labeller.html">as_labeller</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Chill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Chill ("</span>,</span>
<span>            <span class="va">chill_label</span>, <span class="st">")"</span><span class="op">)</span>, Heat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Heat ("</span>, <span class="va">heat_label</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Daily chill and heat accumulation rates"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, strip.placement <span class="op">=</span> <span class="st">"outside"</span>,</span>
<span>        strip.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">VIP_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">PLS_gg</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>, y <span class="op">=</span> <span class="va">VIP</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>, xmin <span class="op">=</span> <span class="va">chill_start_date</span>,</span>
<span>        xmax <span class="op">=</span> <span class="va">chill_end_date</span>, ymin <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, ymax <span class="op">=</span> <span class="cn">Inf</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, fill <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>, xmin <span class="op">=</span> <span class="va">heat_start_date</span>, xmax <span class="op">=</span> <span class="va">heat_end_date</span>, ymin <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span>
<span>            ymax <span class="op">=</span> <span class="cn">Inf</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>, xmin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>,</span>
<span>        <span class="fl">12</span>, <span class="fl">31</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">plscf</span><span class="op">$</span><span class="va">pheno</span><span class="op">$</span><span class="va">pheno</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span>, xmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>,</span>
<span>        <span class="fl">12</span>, <span class="fl">31</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">plscf</span><span class="op">$</span><span class="va">pheno</span><span class="op">$</span><span class="va">pheno</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span>, ymin <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span>
<span>        ymax <span class="op">=</span> <span class="cn">Inf</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, fill <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>,</span>
<span>        <span class="fl">12</span>, <span class="fl">31</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">plscf</span><span class="op">$</span><span class="va">pheno</span><span class="op">$</span><span class="va">pheno</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">VIP</span> <span class="op">&gt;</span> <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">Type</span><span class="op">)</span>,</span>
<span>        scales <span class="op">=</span> <span class="st">"free"</span>, strip.position <span class="op">=</span> <span class="st">"left"</span>, labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html">labeller</a></span><span class="op">(</span>Type <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/as_labeller.html">as_labeller</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Chill <span class="op">=</span> <span class="st">"VIP for chill"</span>,</span>
<span>            Heat <span class="op">=</span> <span class="st">"VIP for heat"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">plscf</span><span class="op">[[</span><span class="va">chill_metric</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">heat_metric</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">PLS_summary</span><span class="op">$</span><span class="va">VIP</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Variable Importance in the Projection (VIP) scores"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, strip.placement <span class="op">=</span> <span class="st">"outside"</span>, strip.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>            plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"VIP"</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt;0.8"</span>, <span class="st">"&gt;0.8"</span><span class="op">)</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`FALSE` <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>            `TRUE` <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">coeff_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">PLS_gg</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>, y <span class="op">=</span> <span class="va">Coef</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>, xmin <span class="op">=</span> <span class="va">chill_start_date</span>,</span>
<span>        xmax <span class="op">=</span> <span class="va">chill_end_date</span>, ymin <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, ymax <span class="op">=</span> <span class="cn">Inf</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, fill <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>, xmin <span class="op">=</span> <span class="va">heat_start_date</span>, xmax <span class="op">=</span> <span class="va">heat_end_date</span>, ymin <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span>
<span>            ymax <span class="op">=</span> <span class="cn">Inf</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>, xmin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>,</span>
<span>        <span class="fl">12</span>, <span class="fl">31</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">plscf</span><span class="op">$</span><span class="va">pheno</span><span class="op">$</span><span class="va">pheno</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span>, xmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>,</span>
<span>        <span class="fl">12</span>, <span class="fl">31</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">plscf</span><span class="op">$</span><span class="va">pheno</span><span class="op">$</span><span class="va">pheno</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span>, ymin <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span>
<span>        ymax <span class="op">=</span> <span class="cn">Inf</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, fill <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="fl">2001</span>,</span>
<span>        <span class="fl">12</span>, <span class="fl">31</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">plscf</span><span class="op">$</span><span class="va">pheno</span><span class="op">$</span><span class="va">pheno</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">3600</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">VIP_Coeff</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">Type</span><span class="op">)</span>,</span>
<span>        scales <span class="op">=</span> <span class="st">"free"</span>, strip.position <span class="op">=</span> <span class="st">"left"</span>, labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html">labeller</a></span><span class="op">(</span>Type <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/as_labeller.html">as_labeller</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Chill <span class="op">=</span> <span class="st">"MC for chill"</span>,</span>
<span>            Heat <span class="op">=</span> <span class="st">"MC for heat"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">plscf</span><span class="op">[[</span><span class="va">chill_metric</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">heat_metric</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">PLS_summary</span><span class="op">$</span><span class="va">Coef</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">plscf</span><span class="op">[[</span><span class="va">chill_metric</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">heat_metric</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">PLS_summary</span><span class="op">$</span><span class="va">Coef</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Model coefficients (MC)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, strip.placement <span class="op">=</span> <span class="st">"outside"</span>,</span>
<span>        strip.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Effect direction"</span>,</span>
<span>        labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Advancing"</span>, <span class="st">"Unimportant"</span>, <span class="st">"Delaying"</span><span class="op">)</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>`-1` <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>            `0` <span class="op">=</span> <span class="st">"grey"</span>, `1` <span class="op">=</span> <span class="st">"dark green"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"PLS coefficient"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">plot</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">VIP_plot</span> <span class="op">+</span> <span class="va">coeff_plot</span> <span class="op">+</span> <span class="va">temp_plot</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span>, guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span>, legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>            axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">plot</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">plot_PLS_chill_force</span><span class="op">(</span><span class="va">plscf</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/23.4e-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li>Now that we’ve automated the plot production, we can easily look at how useful other chill models would be in delineating chilling and forcing periods.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb383"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">daychill</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/daily_chill.html">daily_chill</a></span><span class="op">(</span>hourtemps <span class="op">=</span> <span class="va">temps_hourly</span>, running_mean <span class="op">=</span> <span class="fl">11</span>, models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Chilling_Hours <span class="op">=</span> <span class="va">Chilling_Hours</span>,</span>
<span>    Utah_Chill_Units <span class="op">=</span> <span class="va">Utah_Model</span>, Chill_Portions <span class="op">=</span> <span class="va">Dynamic_Model</span>, GDH <span class="op">=</span> <span class="va">GDH</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plscf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/chillR/man/PLS_chill_force.html">PLS_chill_force</a></span><span class="op">(</span>daily_chill_obj <span class="op">=</span> <span class="va">daychill</span>, bio_data_frame <span class="op">=</span> <span class="va">Alex_first</span>,</span>
<span>    split_month <span class="op">=</span> <span class="fl">6</span>, chill_models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Chilling_Hours"</span>, <span class="st">"Utah_Chill_Units"</span>, <span class="st">"Chill_Portions"</span><span class="op">)</span>,</span>
<span>    heat_models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GDH"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the Chilling Hours Model</span></span>
<span><span class="fu">plot_PLS_chill_force</span><span class="op">(</span><span class="va">plscf</span>, chill_metric <span class="op">=</span> <span class="st">"Chilling_Hours"</span>, heat_metric <span class="op">=</span> <span class="st">"GDH"</span>,</span>
<span>    chill_label <span class="op">=</span> <span class="st">"CH"</span>, heat_label <span class="op">=</span> <span class="st">"GDH"</span>, chill_phase <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, heat_phase <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,</span>
<span>        <span class="fl">0</span><span class="op">)</span><span class="op">)</span>  <span class="co"># unspecified chill/heat period?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/23.4f-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb384"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Plot the Utah Model</span></span>
<span><span class="fu">plot_PLS_chill_force</span><span class="op">(</span><span class="va">plscf</span>, chill_metric <span class="op">=</span> <span class="st">"Utah_Chill_Units"</span>, heat_metric <span class="op">=</span> <span class="st">"GDH"</span>,</span>
<span>    chill_label <span class="op">=</span> <span class="st">"CU"</span>, heat_label <span class="op">=</span> <span class="st">"GDH"</span>, chill_phase <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, heat_phase <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,</span>
<span>        <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/23.4f-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li>So the other two common models aren’t so great at picking up the chilling period either.</li>
</ul>
<p><br></p>
</section><section id="exercises-on-chill-model-comparison-3" class="level3"><h3 class="anchored" data-anchor-id="exercises-on-chill-model-comparison-3">
<span style="color:#71797E">23.5</span>&nbsp; Exercises on chill model comparison</h3>
<div style="height: 18px;">

</div>
<p><strong><em>1. Repeat the <code>PLS_chill_force</code> procedure for the ‘Roter Boskoop’ dataset. Include plots of daily chill and heat accumulation.</em></strong></p>
<p><br></p>
<p><strong><em>2. Run <code>PLS_chill_force</code> analyses for all three major chill models. Delineate your best estimates of chilling and forcing phases for all of them.</em></strong></p>
<p><br></p>
<p><strong><em>3. Plot results for all three analyses, including shaded plot areas for the chilling and forcing periods you estimated.</em></strong></p>
<hr>
<!-- -->
</section></section></main><!-- /main column --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb385" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb385-1"><a href="#cb385-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb385-2"><a href="#cb385-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Tree Phenology Analysis with R"</span></span>
<span id="cb385-3"><a href="#cb385-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "***A Learning Logbook***"</span></span>
<span id="cb385-4"><a href="#cb385-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "SM"</span></span>
<span id="cb385-5"><a href="#cb385-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r format(Sys.time(), '%B %d, %Y')`"</span></span>
<span id="cb385-6"><a href="#cb385-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb385-7"><a href="#cb385-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb385-8"><a href="#cb385-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb385-9"><a href="#cb385-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-float: true</span></span>
<span id="cb385-10"><a href="#cb385-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-title: "Contents"</span></span>
<span id="cb385-11"><a href="#cb385-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 9</span></span>
<span id="cb385-12"><a href="#cb385-12" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb385-13"><a href="#cb385-13" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: false</span></span>
<span id="cb385-14"><a href="#cb385-14" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-caption: true</span></span>
<span id="cb385-15"><a href="#cb385-15" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb385-16"><a href="#cb385-16" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb385-17"><a href="#cb385-17" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: 'Show code'</span></span>
<span id="cb385-18"><a href="#cb385-18" aria-hidden="true" tabindex="-1"></a><span class="co">    code-link: true</span></span>
<span id="cb385-19"><a href="#cb385-19" aria-hidden="true" tabindex="-1"></a><span class="co">    code-highlight: solarized-light</span></span>
<span id="cb385-20"><a href="#cb385-20" aria-hidden="true" tabindex="-1"></a><span class="co">    code-download: true</span></span>
<span id="cb385-21"><a href="#cb385-21" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: journal</span></span>
<span id="cb385-22"><a href="#cb385-22" aria-hidden="true" tabindex="-1"></a><span class="co">    highlight: solarized-light</span></span>
<span id="cb385-23"><a href="#cb385-23" aria-hidden="true" tabindex="-1"></a><span class="co">    smooth-scroll: true</span></span>
<span id="cb385-24"><a href="#cb385-24" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb385-25"><a href="#cb385-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-26"><a href="#cb385-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE, message  = FALSE, warning = F}</span></span>
<span id="cb385-27"><a href="#cb385-27" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(echo = TRUE,  message = FALSE,  warning = FALSE,  tidy = TRUE)</span></span>
<span id="cb385-28"><a href="#cb385-28" aria-hidden="true" tabindex="-1"></a><span class="in">library(chillR)</span></span>
<span id="cb385-29"><a href="#cb385-29" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb385-30"><a href="#cb385-30" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb385-31"><a href="#cb385-31" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyr)</span></span>
<span id="cb385-32"><a href="#cb385-32" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)</span></span>
<span id="cb385-33"><a href="#cb385-33" aria-hidden="true" tabindex="-1"></a><span class="in">library(pander)</span></span>
<span id="cb385-34"><a href="#cb385-34" aria-hidden="true" tabindex="-1"></a><span class="in">library(kableExtra)</span></span>
<span id="cb385-35"><a href="#cb385-35" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb385-36"><a href="#cb385-36" aria-hidden="true" tabindex="-1"></a><span class="in">library(tibble)</span></span>
<span id="cb385-37"><a href="#cb385-37" aria-hidden="true" tabindex="-1"></a><span class="in">library(lubridate)</span></span>
<span id="cb385-38"><a href="#cb385-38" aria-hidden="true" tabindex="-1"></a><span class="in">library(reshape2)</span></span>
<span id="cb385-39"><a href="#cb385-39" aria-hidden="true" tabindex="-1"></a><span class="in">library(downlit)</span></span>
<span id="cb385-40"><a href="#cb385-40" aria-hidden="true" tabindex="-1"></a><span class="in">library(xml2)</span></span>
<span id="cb385-41"><a href="#cb385-41" aria-hidden="true" tabindex="-1"></a><span class="in">library(stats)</span></span>
<span id="cb385-42"><a href="#cb385-42" aria-hidden="true" tabindex="-1"></a><span class="in">library(patchwork)</span></span>
<span id="cb385-43"><a href="#cb385-43" aria-hidden="true" tabindex="-1"></a><span class="in">library(ncdf4)</span></span>
<span id="cb385-44"><a href="#cb385-44" aria-hidden="true" tabindex="-1"></a><span class="in">library(PCICt)</span></span>
<span id="cb385-45"><a href="#cb385-45" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggpmisc)</span></span>
<span id="cb385-46"><a href="#cb385-46" aria-hidden="true" tabindex="-1"></a><span class="in">library(devtools)</span></span>
<span id="cb385-47"><a href="#cb385-47" aria-hidden="true" tabindex="-1"></a><span class="in">library(dormancyR)</span></span>
<span id="cb385-48"><a href="#cb385-48" aria-hidden="true" tabindex="-1"></a><span class="in">library(colorRamps)</span></span>
<span id="cb385-49"><a href="#cb385-49" aria-hidden="true" tabindex="-1"></a><span class="in">library(gganimate)</span></span>
<span id="cb385-50"><a href="#cb385-50" aria-hidden="true" tabindex="-1"></a><span class="in">library(gifski)</span></span>
<span id="cb385-51"><a href="#cb385-51" aria-hidden="true" tabindex="-1"></a><span class="in">library(png)</span></span>
<span id="cb385-52"><a href="#cb385-52" aria-hidden="true" tabindex="-1"></a><span class="in">library(transformr)</span></span>
<span id="cb385-53"><a href="#cb385-53" aria-hidden="true" tabindex="-1"></a><span class="in">library(Kendall)</span></span>
<span id="cb385-54"><a href="#cb385-54" aria-hidden="true" tabindex="-1"></a><span class="in">library(colorRamps)</span></span>
<span id="cb385-55"><a href="#cb385-55" aria-hidden="true" tabindex="-1"></a><span class="in">library(grid)</span></span>
<span id="cb385-56"><a href="#cb385-56" aria-hidden="true" tabindex="-1"></a><span class="in">library(pls)</span></span>
<span id="cb385-57"><a href="#cb385-57" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-58"><a href="#cb385-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-59"><a href="#cb385-59" aria-hidden="true" tabindex="-1"></a>&lt;style&gt;</span>
<span id="cb385-60"><a href="#cb385-60" aria-hidden="true" tabindex="-1"></a>    body { <span class="kw">background-color</span><span class="ch">:</span>  <span class="cn">#F0FFFF</span><span class="op">;</span> }</span>
<span id="cb385-61"><a href="#cb385-61" aria-hidden="true" tabindex="-1"></a>    pre<span class="op">,</span> pre<span class="in">:not(</span><span class="ex">[</span><span class="ss">class</span><span class="ex">]</span><span class="in">)</span> { <span class="kw">background-color</span><span class="ch">:</span> <span class="cn">#d7f4f4</span><span class="op">;</span> }</span>
<span id="cb385-62"><a href="#cb385-62" aria-hidden="true" tabindex="-1"></a>&lt;/style&gt;</span>
<span id="cb385-63"><a href="#cb385-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-64"><a href="#cb385-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-65"><a href="#cb385-65" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-66"><a href="#cb385-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-67"><a href="#cb385-67" aria-hidden="true" tabindex="-1"></a>***This document records my notes and progress in the course titled "Tree Phenology Analysis with R."***</span>
<span id="cb385-68"><a href="#cb385-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-69"><a href="#cb385-69" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-70"><a href="#cb385-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-71"><a href="#cb385-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-72"><a href="#cb385-72" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 3: Tree Dormancy</span></span>
<span id="cb385-73"><a href="#cb385-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-74"><a href="#cb385-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-75"><a href="#cb385-75" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;3.1&lt;/span&gt;&amp;nbsp; Introduction to dormancy</span></span>
<span id="cb385-76"><a href="#cb385-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-77"><a href="#cb385-77" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-78"><a href="#cb385-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-79"><a href="#cb385-79" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Fruit trees go into dormant state to survive unfavorable conditions in winter</span>
<span id="cb385-80"><a href="#cb385-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-81"><a href="#cb385-81" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Dormancy phases: </span>
<span id="cb385-82"><a href="#cb385-82" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**Dormancy establishment** (controlled by environmental signals<span class="dv">&amp;mdash;</span> Day length/photoperiod, Temperature)</span>
<span id="cb385-83"><a href="#cb385-83" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**Endo-dormancy** (controlled by plants' endogenous factors<span class="dv">&amp;mdash;</span> their abilities to grow even in unfavorable conditions; a period of rest and then regrow/ endo-dormancy is overcome once the trees have experienced a certain level of chill but they don't immediately resume growth)</span>
<span id="cb385-84"><a href="#cb385-84" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**Eco-dormancy** (trees are acclimated<span class="dv">&amp;mdash;</span> no morphological changes, but not deeply dormant; (warm) temp is the main environmental driver)</span>
<span id="cb385-85"><a href="#cb385-85" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**Growth resumption** (first apparent morphological changes occur in end of winter or earliest spring depending on species and cultivars<span class="dv">&amp;mdash;</span> trees quickly un-acclimatized to grow and become sensitive to freezing temperature before buds burst? Warm temp promotes growth)</span>
<span id="cb385-86"><a href="#cb385-86" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-87"><a href="#cb385-87" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-88"><a href="#cb385-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-89"><a href="#cb385-89" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Physiological processes that regulate dormancy</span>
<span id="cb385-90"><a href="#cb385-90" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**Transport at both whole-plant and cellular level:** The transport of water and solutes stop during dormancy both at the whole plant and cellular levels within the meristems.</span>
<span id="cb385-91"><a href="#cb385-91" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**Phytohormone dynamics:** Plant hormones are short and long distance signalling compounds acting in a very low concentrations. Myoregulators for plants growth and development, as well as mediate responses to biotic and abiotic stressors. </span>
<span id="cb385-92"><a href="#cb385-92" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**Genetic and epigenetic regulation:** A group of genes related to dormancy<span class="dv">&amp;mdash;</span> regulation of bad dormancy.</span>
<span id="cb385-93"><a href="#cb385-93" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**Dynamics of nonstructural carbohydrates:** Non-structural carbohydrates have three main functions<span class="dv">&amp;dash;</span> energy esterase?, transport and supply, and osmotic regulation and signaling (these varies within and between seasons).</span>
<span id="cb385-94"><a href="#cb385-94" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-95"><a href="#cb385-95" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-96"><a href="#cb385-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-97"><a href="#cb385-97" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;3.2&lt;/span&gt;&amp;nbsp; Dormancy physiology</span></span>
<span id="cb385-98"><a href="#cb385-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-99"><a href="#cb385-99" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-100"><a href="#cb385-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-101"><a href="#cb385-101" aria-hidden="true" tabindex="-1"></a><span class="al">![](./pic/ch3_1.png)</span></span>
<span id="cb385-102"><a href="#cb385-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-103"><a href="#cb385-103" aria-hidden="true" tabindex="-1"></a>Reference: <span class="co">[</span><span class="ot">*A Conceptual Framework for Winter Dormancy in Deciduous Trees (Fadón et al., 2020)*</span><span class="co">](https://www.mdpi.com/2073-4395/10/2/241)</span></span>
<span id="cb385-104"><a href="#cb385-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-105"><a href="#cb385-105" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-106"><a href="#cb385-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-107"><a href="#cb385-107" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;3.3&lt;/span&gt;&amp;nbsp; Experimental and statistical determination of the chilling and forcing periods</span></span>
<span id="cb385-108"><a href="#cb385-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-109"><a href="#cb385-109" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-110"><a href="#cb385-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-111"><a href="#cb385-111" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>High chill accumulation during endodormancy advances flowering dates, but similarly cool temperatures during ecodormancy may cause flowering delays. </span>
<span id="cb385-112"><a href="#cb385-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-113"><a href="#cb385-113" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Endo- and eco- dormancy occur under the same phenological stage, but the temperatures have the opposite effect on flowering according to the dormancy phase. </span>
<span id="cb385-114"><a href="#cb385-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-115"><a href="#cb385-115" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Endo- Vs. Eco- dormancy phase differentiation: </span>
<span id="cb385-116"><a href="#cb385-116" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**Empirically** (See if there is growth after chilling period<span class="dv">&amp;mdash;</span> whether the chill period is overcome to allow forcing period)</span>
<span id="cb385-117"><a href="#cb385-117" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**Statistically** (Long phenological data sets and temperature records<span class="dv">&amp;mdash;</span> estimate the date of chilling fulfillment based on the long series of phenological observations, flowering dates and relating them with previous temperature records)</span>
<span id="cb385-118"><a href="#cb385-118" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-119"><a href="#cb385-119" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-120"><a href="#cb385-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-121"><a href="#cb385-121" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`chillR`</span> package to perform PLS analysis with phenology data and temperature, which gives two outputs:</span>
<span id="cb385-122"><a href="#cb385-122" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**Model coefficients** which indicate the strength and the sense of the influence </span>
<span id="cb385-123"><a href="#cb385-123" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**Variable important in the projections (VIP)**, which points out the significant importance of the model coefficient values<span class="dv">&amp;mdash;</span> values from 0.8 are considered significant??</span>
<span id="cb385-124"><a href="#cb385-124" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb385-125"><a href="#cb385-125" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-126"><a href="#cb385-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-127"><a href="#cb385-127" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;3.4&lt;/span&gt;&amp;nbsp; Phenology record and BBCH scale</span></span>
<span id="cb385-128"><a href="#cb385-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-129"><a href="#cb385-129" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-130"><a href="#cb385-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-131"><a href="#cb385-131" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Phenology** is the study of periodic events in **biological life cycles** (e.g. seasonal changes in trees) and how these are influenced **by seasonal and interannual variations** in climate.</span>
<span id="cb385-132"><a href="#cb385-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-133"><a href="#cb385-133" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Application of phenology in agriculture:</span>
<span id="cb385-134"><a href="#cb385-134" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Select suitable crops and varieties (to organize the cropping schedules, organize the crop rotation)</span>
<span id="cb385-135"><a href="#cb385-135" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Forecasts of plant development and harvest dates (e.g. to evaluate the risk of frost damage)</span>
<span id="cb385-136"><a href="#cb385-136" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Timing of the agricultural practices<span class="dv">&amp;mdash;</span> irrigation, fertilization, crop protection, etc. </span>
<span id="cb385-137"><a href="#cb385-137" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-138"><a href="#cb385-138" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-139"><a href="#cb385-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-140"><a href="#cb385-140" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Trees go through many developmental stages over the course of the year, and these are usually referred to by a two-digit code. &lt;span style="color:grey"&gt;*(Read more [here.](https://www.openagrar.de/servlets/MCRFileNodeServlet/openagrar_derivate_00010428/BBCH-Skala_en.pdf))*&lt;/span&gt;</span>
<span id="cb385-141"><a href="#cb385-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-142"><a href="#cb385-142" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Principal growth stages<span class="dv">&amp;mdash;</span> describe time spans (0-9)</span>
<span id="cb385-143"><a href="#cb385-143" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Secondary growth stages<span class="dv">&amp;mdash;</span> precise steps in plant development (0-9)</span>
<span id="cb385-144"><a href="#cb385-144" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb385-145"><a href="#cb385-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-146"><a href="#cb385-146" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-147"><a href="#cb385-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-148"><a href="#cb385-148" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;3.5&lt;/span&gt;&amp;nbsp; Exercises on tree dormancy</span></span>
<span id="cb385-149"><a href="#cb385-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-150"><a href="#cb385-150" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-151"><a href="#cb385-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-152"><a href="#cb385-152" aria-hidden="true" tabindex="-1"></a>***1. Put yourself in the place of a breeder who wants to calculate the temperature requirements of a newly released cultivar. Which method will you use to calculate the chilling and forcing periods? Please justify your answer.***</span>
<span id="cb385-153"><a href="#cb385-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-154"><a href="#cb385-154" aria-hidden="true" tabindex="-1"></a>As a breeder, I will use the empirical method rather than the statistical method to calculate the chilling and forcing periods in this particular case, for two reasons:</span>
<span id="cb385-155"><a href="#cb385-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-156"><a href="#cb385-156" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It requires little statistical expertise, as many breeders may not have in-depth statistical expertise, and hiring an expert could incur extra costs.</span>
<span id="cb385-157"><a href="#cb385-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-158"><a href="#cb385-158" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The statistical method relies on long phenological data sets and temperature records. Since this cultivar is newly released, such longitudinal data sets and records may not be available for statistical computation.</span>
<span id="cb385-159"><a href="#cb385-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-160"><a href="#cb385-160" aria-hidden="true" tabindex="-1"></a>Anyway, after I looked up the definition of plant breeder, they are scientists, so statistics may not be a problem. In that case, start with empirical first and then combine with statistical method as more data accumulates. 😁</span>
<span id="cb385-161"><a href="#cb385-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-162"><a href="#cb385-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-163"><a href="#cb385-163" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-164"><a href="#cb385-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-165"><a href="#cb385-165" aria-hidden="true" tabindex="-1"></a>***2. Which are the advantages (2) of the BBCH scale compared with earlier scales?***</span>
<span id="cb385-166"><a href="#cb385-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-167"><a href="#cb385-167" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Covers the whole development of the plant, rather than development of only the flower buds as in the traditional scale</span>
<span id="cb385-168"><a href="#cb385-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-169"><a href="#cb385-169" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Provides a general frame for all the species, while the traditional scale is species specific</span>
<span id="cb385-170"><a href="#cb385-170" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb385-171"><a href="#cb385-171" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-172"><a href="#cb385-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-173"><a href="#cb385-173" aria-hidden="true" tabindex="-1"></a>***3. Classify the following phenological stages of sweet cherry according to the BBCH scale:***</span>
<span id="cb385-174"><a href="#cb385-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-175"><a href="#cb385-175" aria-hidden="true" tabindex="-1"></a><span class="al">![***Phenological stages of cherry***](./pic/ch3_2.png)</span></span>
<span id="cb385-176"><a href="#cb385-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-177"><a href="#cb385-177" aria-hidden="true" tabindex="-1"></a>From left to right:</span>
<span id="cb385-178"><a href="#cb385-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-179"><a href="#cb385-179" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>BBCH stage 54 (Inflorescence enclosed by light green scales)</span>
<span id="cb385-180"><a href="#cb385-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-181"><a href="#cb385-181" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>BBCH stage 65 (Full flowering: at least 50% of flowers open, first petals falling)</span>
<span id="cb385-182"><a href="#cb385-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-183"><a href="#cb385-183" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>BBCH stage 89 (Fruit ripe for harvesting for immediate consumption<span class="dv">&amp;mdash;</span> fruit have typical taste and firmness)</span>
<span id="cb385-184"><a href="#cb385-184" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>&lt;span style="color:grey"&gt;*I chose stage 89, rather than the fruit-picking stage 87, due to the cherries' uniform and rich red color. However, further assessment of their firmness, taste, and aroma is required to accurately confirm the stage.*&lt;/span&gt;</span>
<span id="cb385-185"><a href="#cb385-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-186"><a href="#cb385-186" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-187"><a href="#cb385-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-188"><a href="#cb385-188" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 4: Climate change and impact projection</span></span>
<span id="cb385-189"><a href="#cb385-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-190"><a href="#cb385-190" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;4.1&lt;/span&gt;&amp;nbsp; The drivers of climate change</span></span>
<span id="cb385-191"><a href="#cb385-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-192"><a href="#cb385-192" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-193"><a href="#cb385-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-194"><a href="#cb385-194" aria-hidden="true" tabindex="-1"></a>In this lecture, I learned about how the climate changes occurs, as well as the main and long-term drivers of climate change. I also learned about the impact of greenhouse gases on recent global warming<span class="dv">&amp;mdash;</span> particularly CO~2~, CH~4~ and N~2~O in the atmosphere.</span>
<span id="cb385-195"><a href="#cb385-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-196"><a href="#cb385-196" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-197"><a href="#cb385-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-198"><a href="#cb385-198" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;4.2&lt;/span&gt;&amp;nbsp; What we’ve already seen</span></span>
<span id="cb385-199"><a href="#cb385-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-200"><a href="#cb385-200" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-201"><a href="#cb385-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-202"><a href="#cb385-202" aria-hidden="true" tabindex="-1"></a>This lecture taught me about the alarming increase in global temperatures in recent decades due to human activities, and how even a slight rise in temperature can cause significant shifts in the Earth's land areas. The lecture also discussed these trends on a global scale, as well as specifically in Germany. Additionally, there was a brief discussion on precipitation trends in Germany.</span>
<span id="cb385-203"><a href="#cb385-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-204"><a href="#cb385-204" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-205"><a href="#cb385-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-206"><a href="#cb385-206" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;4.3&lt;/span&gt;&amp;nbsp; Future scenarios</span></span>
<span id="cb385-207"><a href="#cb385-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-208"><a href="#cb385-208" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-209"><a href="#cb385-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-210"><a href="#cb385-210" aria-hidden="true" tabindex="-1"></a>I learned a lot about future climate projections and the process to make those projections (RCP, GCM, downscaling, etc) in this lecture. I also learned about the importance of impact models<span class="dv">&amp;mdash;</span> even after we achieved perfect climate projections, there is a need for multiple impact models, as there will still be uncertainty about the biological responses and how we should describe them. There was also a nice discussion on how the changes in the ocean circulation and other tipping points can drive climate change. The lecture also emphasized the importance of being concerned about the future and taking action now to ensure future generations can experience the same world we live in.</span>
<span id="cb385-211"><a href="#cb385-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-212"><a href="#cb385-212" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-213"><a href="#cb385-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-214"><a href="#cb385-214" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;4.4&lt;/span&gt;&amp;nbsp; Impact projection approaches</span></span>
<span id="cb385-215"><a href="#cb385-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-216"><a href="#cb385-216" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-217"><a href="#cb385-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-218"><a href="#cb385-218" aria-hidden="true" tabindex="-1"></a>I learned about different models in making predictions for the future. The lecture compares between the four climate project models, and discussed in details the advantages and the disadvantages of each. There is also a nice instruction on how we should build a model in the beginning<span class="dv">&amp;mdash;</span> we may not want to go into detail for each aspect, but try to cover all aspects in a broader sense. </span>
<span id="cb385-219"><a href="#cb385-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-220"><a href="#cb385-220" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-221"><a href="#cb385-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-222"><a href="#cb385-222" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;4.5&lt;/span&gt;&amp;nbsp; Exercises on climate change</span></span>
<span id="cb385-223"><a href="#cb385-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-224"><a href="#cb385-224" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-225"><a href="#cb385-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-226"><a href="#cb385-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-227"><a href="#cb385-227" aria-hidden="true" tabindex="-1"></a>***1. List the main drivers of climate change at the decade to century scale, and briefly explain the mechanism through which the currently most important driver affects our climate.***</span>
<span id="cb385-228"><a href="#cb385-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-229"><a href="#cb385-229" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Sun</span>
<span id="cb385-230"><a href="#cb385-230" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Aerosols</span>
<span id="cb385-231"><a href="#cb385-231" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Cloud</span>
<span id="cb385-232"><a href="#cb385-232" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Ozone</span>
<span id="cb385-233"><a href="#cb385-233" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Surface albedo</span>
<span id="cb385-234"><a href="#cb385-234" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Greenhouse gases</span>
<span id="cb385-235"><a href="#cb385-235" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Long-term drivers</span>
<span id="cb385-236"><a href="#cb385-236" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Trends in solar activity</span>
<span id="cb385-237"><a href="#cb385-237" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Ocean currents/ continent constellations</span>
<span id="cb385-238"><a href="#cb385-238" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Plant vs. animals (Balance of CO~2~ production and consumption)</span>
<span id="cb385-239"><a href="#cb385-239" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Volcanic and meteroite activity</span>
<span id="cb385-240"><a href="#cb385-240" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Milankovic cycles</span>
<span id="cb385-241"><a href="#cb385-241" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-242"><a href="#cb385-242" aria-hidden="true" tabindex="-1"></a>The current most important driver that affects our climate is the rising concentrations of atmospheric greenhouse gases. Human activities, particularly the burning of fossil fuels, release CO~2~ and other greenhouse gases into the atmosphere. These gases allow the passage of short-wave radiation from the sun, while absorbing the long-wave (infrared) radiation from the Earth. The absorbed infrared radiation is then re-emitted back to the atmosphere and the Earth's surface. This greenhouse effect traps heat in the Earth's atmosphere, causing the planet to warm.</span>
<span id="cb385-243"><a href="#cb385-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-244"><a href="#cb385-244" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-245"><a href="#cb385-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-246"><a href="#cb385-246" aria-hidden="true" tabindex="-1"></a>***2. Explain briefly what is special about temperature dynamics of recent decades, and why we have good reasons to be concerned.***</span>
<span id="cb385-247"><a href="#cb385-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-248"><a href="#cb385-248" aria-hidden="true" tabindex="-1"></a>Temperature dynamics of recent decades is special<span class="dv">&amp;mdash;</span>or perhaps alarming<span class="dv">&amp;mdash;</span>because global temperatures have been rising faster than ever before in human history. This phenomenon was illustrated by Prof. Micheal E. Mann in his book, titled "The Hockey Stick and the Climate Wars."</span>
<span id="cb385-249"><a href="#cb385-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-250"><a href="#cb385-250" aria-hidden="true" tabindex="-1"></a><span class="al">![***An annotated hockey stick***](./pic/ch20_2.png)</span></span>
<span id="cb385-251"><a href="#cb385-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-252"><a href="#cb385-252" aria-hidden="true" tabindex="-1"></a>In the figure, we can clearly see there was little change in temperature in the earlier centuries, showing that nature had a way to balance without human intervention. However, the global temperature increased substantially by 1800s, coinciding with the widespread use of steam engines and industrial revolution. As human are the dominant species on Earth, there is no predator or natural forces that can counter the environmental impacts caused by human. This is evident by the continued rise in global temperature to this decade, such as the  8<span class="dv">&amp;deg;</span>C increase in Siberia's surface temperature in 2020 compared to the 2003-2018 average. </span>
<span id="cb385-253"><a href="#cb385-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-254"><a href="#cb385-254" aria-hidden="true" tabindex="-1"></a>This trend gives us good reasons to be concerned because if left unaddressed, global temperature changes caused by human activities can escalate exponentially. Without proper interventions, future generations may inherit a drastically different<span class="dv">&amp;mdash;</span> and likey worse<span class="dv">&amp;mdash;</span> Earth than the one we experience today. </span>
<span id="cb385-255"><a href="#cb385-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-256"><a href="#cb385-256" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-257"><a href="#cb385-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-258"><a href="#cb385-258" aria-hidden="true" tabindex="-1"></a>***3. What does the abbreviation 'RCP' stand for, how are RCPs defined, and what is their role in projecting future climates?***</span>
<span id="cb385-259"><a href="#cb385-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-260"><a href="#cb385-260" aria-hidden="true" tabindex="-1"></a>The abbreviation 'RCP' stands for the 'Representative Concentration Pathways.'</span>
<span id="cb385-261"><a href="#cb385-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-262"><a href="#cb385-262" aria-hidden="true" tabindex="-1"></a>RCPs are defined by the additional radiative forcing (Wm^-2^) expected by the end of the 21^st^ century (year 2100), representing different levels of greenhouse gas emissions. In the IPCC's Fifth Assessment Reports (AR5), the four main RCPs are defined as follows:</span>
<span id="cb385-263"><a href="#cb385-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-264"><a href="#cb385-264" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**RCP2.6:** Low-emission scenario (~2.6 Wm^-2^)</span>
<span id="cb385-265"><a href="#cb385-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-266"><a href="#cb385-266" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**RCP4.5:** Intermediate scenario (~4.5 Wm^-2^)</span>
<span id="cb385-267"><a href="#cb385-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-268"><a href="#cb385-268" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**RCP6.0:** Moderate-emission scenario (~6.0 Wm^-2^)</span>
<span id="cb385-269"><a href="#cb385-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-270"><a href="#cb385-270" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**RCP8.5:** High-emission scenario (~8.5 Wm^-2^)</span>
<span id="cb385-271"><a href="#cb385-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-272"><a href="#cb385-272" aria-hidden="true" tabindex="-1"></a>RCPs are the climate scenarios fed into climate models. Hence, RCPs serve as inputs for the climate models to make projections of future temperature changes and weather patterns based on varying greenhouse gas emissions. These RCP-based scenarios also allow policymakers to assess different mitigation strategies to counter climate change by exploring different emission pathways and their impacts on the global climate.</span>
<span id="cb385-273"><a href="#cb385-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-274"><a href="#cb385-274" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-275"><a href="#cb385-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-276"><a href="#cb385-276" aria-hidden="true" tabindex="-1"></a>***4. Briefly describe the 4 climate impact projection methods described in the fourth video.***</span>
<span id="cb385-277"><a href="#cb385-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-278"><a href="#cb385-278" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Statistical models:** These models establish relationship between climate parameters and impact measure (e.g. corp yield), and are used to explain past trends and project future climate impacts. However, they have limitations such as overlooking important confounding factors and relying on past trends, which may lead to invalid projections if future climate conditions change significantly.</span>
<span id="cb385-279"><a href="#cb385-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-280"><a href="#cb385-280" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Process-based models:** Also known as mechanistic models, which aim to represent all major system processes through equations. These models try to capture best scientific knowledge of all processes, but the problem is processes are often not sufficiently understood. Hence, process-based models may omit many key defining factors. They can also be unrealistic for most complex systems, often requiring extensive parameterization or assumptions. Another limitation is that they may become valid over time due to non-linear changes in variables, and uncertainties are not always well represented. </span>
<span id="cb385-281"><a href="#cb385-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-282"><a href="#cb385-282" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Species distribution models (SDMs):**They are also known as ecological niche modeling, which establish relationship between different climatic parameters and presence or absence of data for either species or ecosystems. SDMs use these relationships to project future species distributions under changing climate conditions. Results can vary significantly between different algorithms, so ensemble modeling is often used to combine multiple models for more robust predictions.</span>
<span id="cb385-283"><a href="#cb385-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-284"><a href="#cb385-284" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Climate analogue models:**In these models, we identify locations with climates similar to those projected for the area of interest in the future. By examining the climate conditions at these analogue sites, we can get a glimpse potential future scenarios, which allow us to explore different adaptation strategies. However, there are limitations<span class="dv">&amp;mdash;</span> analogue sites may differ from the baseline in important non-climatic factors, leading to confusion about whether observed differences are due to climate or other variables. Furthermore, climate data can be too limited or of poor quality to reliably apply these models<span class="dv">&amp;mdash;</span> error estimates of these models are required as all impact projects are uncertain. </span>
<span id="cb385-285"><a href="#cb385-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-286"><a href="#cb385-286" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-287"><a href="#cb385-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-288"><a href="#cb385-288" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 5: Winter chill projections</span></span>
<span id="cb385-289"><a href="#cb385-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-290"><a href="#cb385-290" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;5.1&lt;/span&gt;&amp;nbsp; Winter chill projections</span></span>
<span id="cb385-291"><a href="#cb385-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-292"><a href="#cb385-292" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;5.1.1&lt;/span&gt;&amp;nbsp; Winter chill in Oman</span></span>
<span id="cb385-293"><a href="#cb385-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-294"><a href="#cb385-294" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-295"><a href="#cb385-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-296"><a href="#cb385-296" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To calculate nutrient budgets for the oases in the Sultanate of Oman, by measuring the yields of the various fruit trees there</span>
<span id="cb385-297"><a href="#cb385-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-298"><a href="#cb385-298" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>But, many of the trees in the oasis system did not produce fruits in the years of analysis</span>
<span id="cb385-299"><a href="#cb385-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-300"><a href="#cb385-300" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A hypothesis for that was "the lack of chilling," due to most of the trees in these high-altitude oases were not the typical species of the Arabian Peninsula, but temperate trees</span>
<span id="cb385-301"><a href="#cb385-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-302"><a href="#cb385-302" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>So, from focusing on nutrient budget to chilling hours</span>
<span id="cb385-303"><a href="#cb385-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-304"><a href="#cb385-304" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Chilling Hours model<span class="dv">&amp;mdash;</span> this model can’t really be trusted, especially in a warm location</span>
<span id="cb385-305"><a href="#cb385-305" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Placed temperature loggers in three oases at different levels of elevation, which allowed studying chill accumulation along an elevation gradient (can't collect meaningful data for a reasonable period of time )</span>
<span id="cb385-306"><a href="#cb385-306" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>So, obtain data from an official long-term weather station is located in the vicinity, near the top of the valley, roughly 1000 m above the lowest oasis<span class="dv">&amp;mdash;</span> data not representative of all the locations along the elevation gradient</span>
<span id="cb385-307"><a href="#cb385-307" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>So, use the records from the oases to define transfer functions that allowed deriving oasis temperatures from long-term data</span>
<span id="cb385-308"><a href="#cb385-308" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Set the transfer functions up (using PLS<span class="dv">&amp;mdash;</span> not a good idea?) to directly calculate hourly temperatures in the oases from the daily records of the official station at Saiq</span>
<span id="cb385-309"><a href="#cb385-309" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Regression between temperature at Saiq and temperature in three oases to calculate winter chill dynamics over the entire time span covered by the official weather station (Hourly data were needed to calculate the number of Chilling Hours)</span>
<span id="cb385-310"><a href="#cb385-310" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-311"><a href="#cb385-311" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-312"><a href="#cb385-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-313"><a href="#cb385-313" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Weather generators to add future climate scenarios</span>
<span id="cb385-314"><a href="#cb385-314" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>*Weather generators are tools that can produce random draws of plausible weather, based on observed weather for a particular location.*</span>
<span id="cb385-315"><a href="#cb385-315" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Fed the LARS-WG weather generator with the data (we had) for the highest-elevation oasis and told it to generate plausible weather for a number of years</span>
<span id="cb385-316"><a href="#cb385-316" aria-hidden="true" tabindex="-1"></a><span class="ss">        - </span>Request the generator to produce the highest-elevation oasis and told it to generate plausible weather for a number of years</span>
<span id="cb385-317"><a href="#cb385-317" aria-hidden="true" tabindex="-1"></a><span class="ss">        - </span>Result: Chill prospects for 1°C and 2°C warming scenarios</span>
<span id="cb385-318"><a href="#cb385-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-319"><a href="#cb385-319" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-320"><a href="#cb385-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-321"><a href="#cb385-321" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-322"><a href="#cb385-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-323"><a href="#cb385-323" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;5.1.2&lt;/span&gt;&amp;nbsp; Chill model sensitivity</span></span>
<span id="cb385-324"><a href="#cb385-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-325"><a href="#cb385-325" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-326"><a href="#cb385-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-327"><a href="#cb385-327" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In projecting climate change impacts on winter chill in the Central Valley, one of the world’s most productive regions for temperate fruit trees, **the choice of chill model matters a lot**</span>
<span id="cb385-328"><a href="#cb385-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-329"><a href="#cb385-329" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Created a bunch of temperature scenarios for multiple locations and calculated how chill accumulation was likely to change in the future, according to multiple chill models</span>
<span id="cb385-330"><a href="#cb385-330" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Looked at what changes the various models predicted for the same locations and the same future scenarios</span>
<span id="cb385-331"><a href="#cb385-331" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>The chill projection results varied considerably across the four models<span class="dv">&amp;mdash;</span> **strong indication that not all models can be right**</span>
<span id="cb385-332"><a href="#cb385-332" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Based on the literature, as well as on another study <span class="co">[</span><span class="ot">(Luedeling et al., 2009d)</span><span class="co">](https://www.sciencedirect.com/science/article/pii/S0168192309001580)</span>, Dynamic Model was concluded to be the most reliable one<span class="dv">&amp;mdash;</span> used mostly in this course</span>
<span id="cb385-333"><a href="#cb385-333" aria-hidden="true" tabindex="-1"></a><span class="ss">          - </span>But, the Dynamic model is too complicated (cumbersome, error-prone and boring)</span>
<span id="cb385-334"><a href="#cb385-334" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb385-335"><a href="#cb385-335" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-336"><a href="#cb385-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-337"><a href="#cb385-337" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;5.1.3&lt;/span&gt;&amp;nbsp; Winter chill in California</span></span>
<span id="cb385-338"><a href="#cb385-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-339"><a href="#cb385-339" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-340"><a href="#cb385-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-341"><a href="#cb385-341" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To produce a winter chill projection for California's fruit and nut growing region<span class="dv">&amp;mdash;</span> the Central Valley</span>
<span id="cb385-342"><a href="#cb385-342" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Multiple scenarios (20 or so) for records of all 100+ weather stations in California (automate processing steps)</span>
<span id="cb385-343"><a href="#cb385-343" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-344"><a href="#cb385-344" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-345"><a href="#cb385-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-346"><a href="#cb385-346" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Result: produce projections for all stations, which consisted of chill accumulation over 100 plausible winter seasons per scenario, generated with a weather generator</span>
<span id="cb385-347"><a href="#cb385-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-348"><a href="#cb385-348" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Summarize the data by defining a metric called ‘Safe Winter Chill’. </span>
<span id="cb385-349"><a href="#cb385-349" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>This is the 10th percentile of the chill distribution, i.e. the amount of chill that is exceeded in 90% of all years, derived from the ‘replicates’ of annual temperature dynamics produced by the weather generator </span>
<span id="cb385-350"><a href="#cb385-350" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Economically, it may be feasible to grow a tree cultivar that requires this much chill. </span>
<span id="cb385-351"><a href="#cb385-351" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-352"><a href="#cb385-352" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-353"><a href="#cb385-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-354"><a href="#cb385-354" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Source: <span class="co">[</span><span class="ot">(Luedeling et al.,2009d)</span><span class="co">](https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0006166)</span></span>
<span id="cb385-355"><a href="#cb385-355" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-356"><a href="#cb385-356" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-357"><a href="#cb385-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-358"><a href="#cb385-358" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;5.1.4&lt;/span&gt;&amp;nbsp; Winter chill ratios</span></span>
<span id="cb385-359"><a href="#cb385-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-360"><a href="#cb385-360" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-361"><a href="#cb385-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-362"><a href="#cb385-362" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To produce a chill projection for the whole planet, using data from the Global Summary of the Day database</span>
<span id="cb385-363"><a href="#cb385-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-364"><a href="#cb385-364" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Processed data for about 5000 globally distributed weather stations, for which multiple chill metrics were calculated</span>
<span id="cb385-365"><a href="#cb385-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-366"><a href="#cb385-366" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To compare chill models, the ratio between various chill metrics was calculated for each weather station in the data set.</span>
<span id="cb385-367"><a href="#cb385-367" aria-hidden="true" tabindex="-1"></a><span class="ss">    -  </span>Had these ratios been largely constant all over the planet (e.g. one Chill Portion always corresponds to 10 Chilling Hours), we would have been fairly safe using any of the chill models.</span>
<span id="cb385-368"><a href="#cb385-368" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Unfortunately, this wasn’t the case, with enormous variation in chill metric ratios around the world.</span>
<span id="cb385-369"><a href="#cb385-369" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-370"><a href="#cb385-370" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-371"><a href="#cb385-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-372"><a href="#cb385-372" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Source: <span class="co">[</span><span class="ot">(Luedeling &amp; Brown, 2011a)</span><span class="co">](https://link.springer.com/article/10.1007/s00484-010-0352-y)</span></span>
<span id="cb385-373"><a href="#cb385-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-374"><a href="#cb385-374" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-375"><a href="#cb385-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-376"><a href="#cb385-376" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;5.1.5&lt;/span&gt;&amp;nbsp; A global pojection of future winter chill</span></span>
<span id="cb385-377"><a href="#cb385-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-378"><a href="#cb385-378" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-379"><a href="#cb385-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-380"><a href="#cb385-380" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Produce a global projection of the likely impacts of climate change on winter chill</span>
<span id="cb385-381"><a href="#cb385-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-382"><a href="#cb385-382" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Projected decline in winter chill<span class="dv">&amp;mdash;</span> it seems unlikely that growers will remain able to grow the tree cultivars they currently rely on with such dramatic chill losses</span>
<span id="cb385-383"><a href="#cb385-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-384"><a href="#cb385-384" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Source: <span class="co">[</span><span class="ot">(Luedeling et al., 2011b)</span><span class="co">](https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0020155)</span></span>
<span id="cb385-385"><a href="#cb385-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-386"><a href="#cb385-386" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-387"><a href="#cb385-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-388"><a href="#cb385-388" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;5.1.6&lt;/span&gt;&amp;nbsp; Winter chill in Germany</span></span>
<span id="cb385-389"><a href="#cb385-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-390"><a href="#cb385-390" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-391"><a href="#cb385-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-392"><a href="#cb385-392" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Germany is not highlighted as particularly vulnerable to chill losses.</span>
<span id="cb385-393"><a href="#cb385-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-394"><a href="#cb385-394" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The reason for this lack of major changes is that current winter temperatures in Germany are right in the middle of what appears to be the most effective temperature range for chill accumulation.</span>
<span id="cb385-395"><a href="#cb385-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-396"><a href="#cb385-396" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Source: <span class="co">[</span><span class="ot">(Luedeling et al., 2009a)</span><span class="co">](https://link.springer.com/article/10.1007/s10341-009-0085-4)</span></span>
<span id="cb385-397"><a href="#cb385-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-398"><a href="#cb385-398" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-399"><a href="#cb385-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-400"><a href="#cb385-400" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;5.1.7&lt;/span&gt;&amp;nbsp; Winter chill in Tunisia</span></span>
<span id="cb385-401"><a href="#cb385-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-402"><a href="#cb385-402" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-403"><a href="#cb385-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-404"><a href="#cb385-404" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Models: SRES, GCMs, RCPs</span>
<span id="cb385-405"><a href="#cb385-405" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>The so-called SRES emissions scenarios (named after the IPCC Special Report on Emissions Scenarios), usually focusing on the three most commonly used scenarios B2, A1B and A2</span>
<span id="cb385-406"><a href="#cb385-406" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>‘General Circulation Models’ (GCMs; many people also use an alternative long form: ‘Global Climate Models’)</span>
<span id="cb385-407"><a href="#cb385-407" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>‘Representative Concentration Pathways’ (RCPs) to replace the SRES scenarios</span>
<span id="cb385-408"><a href="#cb385-408" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-409"><a href="#cb385-409" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-410"><a href="#cb385-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-411"><a href="#cb385-411" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>No way of deciding which of these models, if any, is right<span class="dv">&amp;mdash;</span> should produce *ensemble* forecasts, i.e. project changes using outputs from all the available models (that are considered credible)</span>
<span id="cb385-412"><a href="#cb385-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-413"><a href="#cb385-413" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Produce chill distribution at a particular point in time using a weather generator that is accessed by <span class="in">`chillR`</span>. </span>
<span id="cb385-414"><a href="#cb385-414" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>This weather generator is calibrated with observed weather data and provided with an estimate of how various climate metrics differed from the long-term average climate in 1975, 2000 and 2015.</span>
<span id="cb385-415"><a href="#cb385-415" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>With this information, we can generate a large number of artificial yearly weather records that might have occurred at these points in time.</span>
<span id="cb385-416"><a href="#cb385-416" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-417"><a href="#cb385-417" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-418"><a href="#cb385-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-419"><a href="#cb385-419" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The weather generator was also used to produce future scenarios. </span>
<span id="cb385-420"><a href="#cb385-420" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>In the case of Pistachios in Tunisia, the tool is calibrated with observed data, but the scenarios that were added were not derived from the historic record, but extracted from the AFRICLIM database.</span>
<span id="cb385-421"><a href="#cb385-421" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-422"><a href="#cb385-422" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-423"><a href="#cb385-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-424"><a href="#cb385-424" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;5.1.8&lt;/span&gt;&amp;nbsp; Winter chill in Chile</span></span>
<span id="cb385-425"><a href="#cb385-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-426"><a href="#cb385-426" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-427"><a href="#cb385-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-428"><a href="#cb385-428" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A tool that could quickly access single-location data for weather stations anywhere on the planet: ClimateWizard</span>
<span id="cb385-429"><a href="#cb385-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-430"><a href="#cb385-430" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-431"><a href="#cb385-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-432"><a href="#cb385-432" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;5.1.9&lt;/span&gt;&amp;nbsp; Chill projection for Patagonia</span></span>
<span id="cb385-433"><a href="#cb385-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-434"><a href="#cb385-434" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-435"><a href="#cb385-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-436"><a href="#cb385-436" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Looked into the climatic suitability for fruit and nut trees near agriculture’s southern frontier - in Patagonia, in southern Argentina <span class="co">[</span><span class="ot">(del Barrio et al., 2020)</span><span class="co">](https://rmets.onlinelibrary.wiley.com/doi/pdf/10.1002/joc.6649)</span>.</span>
<span id="cb385-437"><a href="#cb385-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-438"><a href="#cb385-438" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Used the weather station records to calibrate weather generator and downloaded climate projections from the ClimateWizard database. </span>
<span id="cb385-439"><a href="#cb385-439" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>to make past and future temperature scenarios for all stations</span>
<span id="cb385-440"><a href="#cb385-440" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>to compute winter chill and a few other agroclimatic metrics</span>
<span id="cb385-441"><a href="#cb385-441" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-442"><a href="#cb385-442" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-443"><a href="#cb385-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-444"><a href="#cb385-444" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;5.1.10&lt;/span&gt;&amp;nbsp; Chill model comparison</span></span>
<span id="cb385-445"><a href="#cb385-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-446"><a href="#cb385-446" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-447"><a href="#cb385-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-448"><a href="#cb385-448" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Used climate change analysis framework to compare chill models <span class="co">[</span><span class="ot">(Fernandez et al., 2020b)</span><span class="co">](https://www.sciencedirect.com/science/article/pii/S1161030120301106)</span></span>
<span id="cb385-449"><a href="#cb385-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-450"><a href="#cb385-450" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Model choice matters!</span>
<span id="cb385-451"><a href="#cb385-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-452"><a href="#cb385-452" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-453"><a href="#cb385-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-454"><a href="#cb385-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-455"><a href="#cb385-455" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;5.1.11&lt;/span&gt;&amp;nbsp; Chill projection for all of Tunisia</span></span>
<span id="cb385-456"><a href="#cb385-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-457"><a href="#cb385-457" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-458"><a href="#cb385-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-459"><a href="#cb385-459" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Mapped chill accumulation across Tunisia, based on the previous framework</span>
<span id="cb385-460"><a href="#cb385-460" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Applied the analysis framework developed to each of the 20 weather station locations across Tunisia and neighboring countries</span>
<span id="cb385-461"><a href="#cb385-461" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Interpolated results to produce chill maps that track chill availability in Tunisia over the past few decades</span>
<span id="cb385-462"><a href="#cb385-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-463"><a href="#cb385-463" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-464"><a href="#cb385-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-465"><a href="#cb385-465" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>How to interpolate the site-specific results into a map that covers the whole country</span>
<span id="cb385-466"><a href="#cb385-466" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Take the site-specific predictions of Safe Winter Chill and interpolate a surface through them (using the Kriging technique)</span>
<span id="cb385-467"><a href="#cb385-467" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Repeat the same for the elevations of the locations</span>
<span id="cb385-468"><a href="#cb385-468" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Then, fitted a linear model to relate chill accumulation to elevation</span>
<span id="cb385-469"><a href="#cb385-469" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Calculate the difference between the elevation model derived from the weather station elevations and the true elevations of each location of the country, using a Digital Elevation Model (DEM)</span>
<span id="cb385-470"><a href="#cb385-470" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Considering that this difference is not yet accounted for by the chill surface that was derived by interpolating chill data for the weather stations, we used the elevation~chill relationship we determined to correct chill predictions.</span>
<span id="cb385-471"><a href="#cb385-471" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Will only work in places with a linear relationship between elevation and chill availability</span>
<span id="cb385-472"><a href="#cb385-472" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-473"><a href="#cb385-473" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-474"><a href="#cb385-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-475"><a href="#cb385-475" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;5.1.12&lt;/span&gt;&amp;nbsp; Revisiting chill accumulation in Oman</span></span>
<span id="cb385-476"><a href="#cb385-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-477"><a href="#cb385-477" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-478"><a href="#cb385-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-479"><a href="#cb385-479" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Adding some new ideas on how to convert daily into hourly temperatures in a place like the oases of Oman we were interested in, we produced updated assessments of past winter chill and forecasts of future chill for the oases of Al Jabal Al Akhdar. <span class="co">[</span><span class="ot">(Buerkert et al., 2020)</span><span class="co">](https://link.springer.com/article/10.1007/s10584-020-02862-8)</span></span>
<span id="cb385-480"><a href="#cb385-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-481"><a href="#cb385-481" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-482"><a href="#cb385-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-483"><a href="#cb385-483" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;5.2&lt;/span&gt;&amp;nbsp; Exercises on past chill projections</span></span>
<span id="cb385-484"><a href="#cb385-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-485"><a href="#cb385-485" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-486"><a href="#cb385-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-487"><a href="#cb385-487" aria-hidden="true" tabindex="-1"></a>***1. Sketch out three data access and processing challenges that had to be overcome in order to produce chill projections with state-of-the-art methodology.***</span>
<span id="cb385-488"><a href="#cb385-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-489"><a href="#cb385-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-490"><a href="#cb385-490" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The need to automate the process to create multiple climate scenarios for large number of weather stations and to handle large data output of simulation scenarios. For example, challenge in data transfer when replacing old scenarios (SRES) with the new (RCPs). </span>
<span id="cb385-491"><a href="#cb385-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-492"><a href="#cb385-492" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Scarcity of source to find appropriate information/ data on future climates that can easily be used for the purposes of chill modeling. For example, data (e.g. temperature records) available may not be representative of all locations of interest and the need for hourly records to run chill models. </span>
<span id="cb385-493"><a href="#cb385-493" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb385-494"><a href="#cb385-494" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The need to download large datasets when users may only be interested in data for a single location. This problem is overcome by a function that extracts data for single locations from <span class="in">`ClimateWizard`</span> tool. The function is now publicly available through the use of an application programming interface (API) to access outputs from 15 climate models from the RCP scenarios. </span>
<span id="cb385-495"><a href="#cb385-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-496"><a href="#cb385-496" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-497"><a href="#cb385-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-498"><a href="#cb385-498" aria-hidden="true" tabindex="-1"></a>***2. Outline, in your understanding, the basic steps that are necessary to make such projections.***</span>
<span id="cb385-499"><a href="#cb385-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-500"><a href="#cb385-500" aria-hidden="true" tabindex="-1"></a>Based on the information given in Chapter 5, the basic steps necessary to make chill projections are as follows:</span>
<span id="cb385-501"><a href="#cb385-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-502"><a href="#cb385-502" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Set up temperature loggers in the location of interest to collect temperature data (can't provide meaningful long-term data)</span>
<span id="cb385-503"><a href="#cb385-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-504"><a href="#cb385-504" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Obtain long-term data from official weather stations located in the vicinity (these data may not representative of all locations)</span>
<span id="cb385-505"><a href="#cb385-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-506"><a href="#cb385-506" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Using the records obtained from the location of interest, derive meaningful daily temperature data from the long-term data. </span>
<span id="cb385-507"><a href="#cb385-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-508"><a href="#cb385-508" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Calculate hourly temperatures directly from the daily records using methods such as PLS regression, since the chilling hours calculation requires hourly data. </span>
<span id="cb385-509"><a href="#cb385-509" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Now we can calculate estimated chilling hours for the entire time span covered by the official weather station. In other words, we now have chill dynamics for the past period. </span>
<span id="cb385-510"><a href="#cb385-510" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-511"><a href="#cb385-511" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-512"><a href="#cb385-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-513"><a href="#cb385-513" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To add the future climate scenarios, we can input these data into a weather generator, and generate plausible weathers for a specified number of years. Here, we can also generate weather conditions based on historical temperatures or for scenarios where temperatures are a few degrees higher.</span>
<span id="cb385-514"><a href="#cb385-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-515"><a href="#cb385-515" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now, we can make chill projections for the weather generator's scenarios of our location, using chill models. Here the choice of chill model matters as not all chill models are reliable<span class="dv">&amp;mdash;</span> select an appropriate chilling model or an ensembles of models. </span>
<span id="cb385-516"><a href="#cb385-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-517"><a href="#cb385-517" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-518"><a href="#cb385-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-519"><a href="#cb385-519" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 6: Manual chill analysis</span></span>
<span id="cb385-520"><a href="#cb385-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-521"><a href="#cb385-521" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;6.1&lt;/span&gt;&amp;nbsp; Computing Chilling Hours from hourly temperature data</span></span>
<span id="cb385-522"><a href="#cb385-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-523"><a href="#cb385-523" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-524"><a href="#cb385-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-525"><a href="#cb385-525" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Need hourly temperature data to compute Chilling Hours</span>
<span id="cb385-526"><a href="#cb385-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-527"><a href="#cb385-527" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`chillR`</span> offers a few neat tools to make pretty good approximations of hourly temperature data from daily records</span>
<span id="cb385-528"><a href="#cb385-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-529"><a href="#cb385-529" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-530"><a href="#cb385-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-531"><a href="#cb385-531" aria-hidden="true" tabindex="-1"></a><span class="fu">#### *Display the `Winters_hours_gaps` dataset in `chillR` using `kable`* {.unnumbered}</span></span>
<span id="cb385-532"><a href="#cb385-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-533"><a href="#cb385-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-534"><a href="#cb385-534" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 6.1.1}</span></span>
<span id="cb385-535"><a href="#cb385-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-536"><a href="#cb385-536" aria-hidden="true" tabindex="-1"></a><span class="in"># Display the Winters_hours_gaps dataset in chillR using kable</span></span>
<span id="cb385-537"><a href="#cb385-537" aria-hidden="true" tabindex="-1"></a><span class="in">kable(Winters_hours_gaps[1:10,]) %&gt;%</span></span>
<span id="cb385-538"><a href="#cb385-538" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-539"><a href="#cb385-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-540"><a href="#cb385-540" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-541"><a href="#cb385-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-542"><a href="#cb385-542" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-543"><a href="#cb385-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-544"><a href="#cb385-544" aria-hidden="true" tabindex="-1"></a><span class="fu">#### *Remove column `Temp_gaps` and create a new dataset (`hourtemps`)* {.unnumbered}</span></span>
<span id="cb385-545"><a href="#cb385-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-546"><a href="#cb385-546" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 6.1.2}</span></span>
<span id="cb385-547"><a href="#cb385-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-548"><a href="#cb385-548" aria-hidden="true" tabindex="-1"></a><span class="in"># Remove column Temp_gaps and create a new dataset (hourtemps)</span></span>
<span id="cb385-549"><a href="#cb385-549" aria-hidden="true" tabindex="-1"></a><span class="in">hourtemps &lt;- Winters_hours_gaps[,</span></span>
<span id="cb385-550"><a href="#cb385-550" aria-hidden="true" tabindex="-1"></a><span class="in">                                c("Year",</span></span>
<span id="cb385-551"><a href="#cb385-551" aria-hidden="true" tabindex="-1"></a><span class="in">                                  "Month",</span></span>
<span id="cb385-552"><a href="#cb385-552" aria-hidden="true" tabindex="-1"></a><span class="in">                                  "Day",</span></span>
<span id="cb385-553"><a href="#cb385-553" aria-hidden="true" tabindex="-1"></a><span class="in">                                  "Hour",</span></span>
<span id="cb385-554"><a href="#cb385-554" aria-hidden="true" tabindex="-1"></a><span class="in">                                  "Temp")]</span></span>
<span id="cb385-555"><a href="#cb385-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-556"><a href="#cb385-556" aria-hidden="true" tabindex="-1"></a><span class="in">kable(hourtemps[1:10,]) %&gt;%</span></span>
<span id="cb385-557"><a href="#cb385-557" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-558"><a href="#cb385-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-559"><a href="#cb385-559" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-560"><a href="#cb385-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-561"><a href="#cb385-561" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-562"><a href="#cb385-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-563"><a href="#cb385-563" aria-hidden="true" tabindex="-1"></a><span class="fu">#### *Display only the third row with all columns* {.unnumbered}</span></span>
<span id="cb385-564"><a href="#cb385-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-565"><a href="#cb385-565" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 6.1.3}</span></span>
<span id="cb385-566"><a href="#cb385-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-567"><a href="#cb385-567" aria-hidden="true" tabindex="-1"></a><span class="in"># Display only the third row with all columns</span></span>
<span id="cb385-568"><a href="#cb385-568" aria-hidden="true" tabindex="-1"></a><span class="in">hourtemps[3, ]</span></span>
<span id="cb385-569"><a href="#cb385-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-570"><a href="#cb385-570" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-571"><a href="#cb385-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-572"><a href="#cb385-572" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-573"><a href="#cb385-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-574"><a href="#cb385-574" aria-hidden="true" tabindex="-1"></a><span class="fu">#### *Display the `Temp` column of the third row only* {.unnumbered}</span></span>
<span id="cb385-575"><a href="#cb385-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-576"><a href="#cb385-576" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 6.1.4}</span></span>
<span id="cb385-577"><a href="#cb385-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-578"><a href="#cb385-578" aria-hidden="true" tabindex="-1"></a><span class="in"># Display the temp column of the third row only</span></span>
<span id="cb385-579"><a href="#cb385-579" aria-hidden="true" tabindex="-1"></a><span class="in">hourtemps[3, "Temp"]</span></span>
<span id="cb385-580"><a href="#cb385-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-581"><a href="#cb385-581" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-582"><a href="#cb385-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-583"><a href="#cb385-583" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-584"><a href="#cb385-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-585"><a href="#cb385-585" aria-hidden="true" tabindex="-1"></a><span class="fu">#### *Display the first five rows of `Temp` column* {.unnumbered}</span></span>
<span id="cb385-586"><a href="#cb385-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-587"><a href="#cb385-587" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 6.1.5}</span></span>
<span id="cb385-588"><a href="#cb385-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-589"><a href="#cb385-589" aria-hidden="true" tabindex="-1"></a><span class="in"># Display the first five rows of Temp column</span></span>
<span id="cb385-590"><a href="#cb385-590" aria-hidden="true" tabindex="-1"></a><span class="in">hourtemps$Temp[1:5]</span></span>
<span id="cb385-591"><a href="#cb385-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-592"><a href="#cb385-592" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-593"><a href="#cb385-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-594"><a href="#cb385-594" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-595"><a href="#cb385-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-596"><a href="#cb385-596" aria-hidden="true" tabindex="-1"></a><span class="fu">#### *Display the first five rows and all columns of `hourtemps` dataset* {.unnumbered}</span></span>
<span id="cb385-597"><a href="#cb385-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-598"><a href="#cb385-598" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 6.1.6}</span></span>
<span id="cb385-599"><a href="#cb385-599" aria-hidden="true" tabindex="-1"></a><span class="in"># Display the first five rows and all columns of hourtemps dataset</span></span>
<span id="cb385-600"><a href="#cb385-600" aria-hidden="true" tabindex="-1"></a><span class="in">hourtemps[1:5, ]</span></span>
<span id="cb385-601"><a href="#cb385-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-602"><a href="#cb385-602" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-603"><a href="#cb385-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-604"><a href="#cb385-604" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-605"><a href="#cb385-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-606"><a href="#cb385-606" aria-hidden="true" tabindex="-1"></a><span class="fu">#### *Check for temperatures that fall within `Chilling Hours` range* {.unnumbered}</span></span>
<span id="cb385-607"><a href="#cb385-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-608"><a href="#cb385-608" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-609"><a href="#cb385-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-610"><a href="#cb385-610" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Every hour with temperatures above (and including) 0°C and below (and including) 7.2°C is considered a Chilling Hour.</span>
<span id="cb385-611"><a href="#cb385-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-612"><a href="#cb385-612" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Check for every hour whether temperatures fall in this range, using simple comparison commands (<span class="in">`&lt;`</span>, <span class="in">`&lt;=`</span>, <span class="in">`==`</span>, <span class="in">`=&gt;`</span> and <span class="in">`&gt;`</span>) in R</span>
<span id="cb385-613"><a href="#cb385-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-614"><a href="#cb385-614" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-615"><a href="#cb385-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-616"><a href="#cb385-616" aria-hidden="true" tabindex="-1"></a><span class="fu">#####  *Using simple comparison commands* {.unnumbered}</span></span>
<span id="cb385-617"><a href="#cb385-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-618"><a href="#cb385-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-619"><a href="#cb385-619" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 6.1.7.1}</span></span>
<span id="cb385-620"><a href="#cb385-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-621"><a href="#cb385-621" aria-hidden="true" tabindex="-1"></a><span class="in"># Use == command</span></span>
<span id="cb385-622"><a href="#cb385-622" aria-hidden="true" tabindex="-1"></a><span class="in">1 == 2</span></span>
<span id="cb385-623"><a href="#cb385-623" aria-hidden="true" tabindex="-1"></a><span class="in">1 == 1</span></span>
<span id="cb385-624"><a href="#cb385-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-625"><a href="#cb385-625" aria-hidden="true" tabindex="-1"></a><span class="in"># Test &gt; command</span></span>
<span id="cb385-626"><a href="#cb385-626" aria-hidden="true" tabindex="-1"></a><span class="in">c(1, 2, 3) &gt; 2</span></span>
<span id="cb385-627"><a href="#cb385-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-628"><a href="#cb385-628" aria-hidden="true" tabindex="-1"></a><span class="in"># Use &gt;= command</span></span>
<span id="cb385-629"><a href="#cb385-629" aria-hidden="true" tabindex="-1"></a><span class="in">a &lt;- 1</span></span>
<span id="cb385-630"><a href="#cb385-630" aria-hidden="true" tabindex="-1"></a><span class="in">b &lt;- 2</span></span>
<span id="cb385-631"><a href="#cb385-631" aria-hidden="true" tabindex="-1"></a><span class="in">c &lt;- 3</span></span>
<span id="cb385-632"><a href="#cb385-632" aria-hidden="true" tabindex="-1"></a><span class="in">c(a, b, c) &gt;= 2</span></span>
<span id="cb385-633"><a href="#cb385-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-634"><a href="#cb385-634" aria-hidden="true" tabindex="-1"></a><span class="in"># Use &amp; command</span></span>
<span id="cb385-635"><a href="#cb385-635" aria-hidden="true" tabindex="-1"></a><span class="in">c(a, b, c) &gt;= 2 &amp; c(a, b, c) &lt;3</span></span>
<span id="cb385-636"><a href="#cb385-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-637"><a href="#cb385-637" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-638"><a href="#cb385-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-639"><a href="#cb385-639" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-640"><a href="#cb385-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-641"><a href="#cb385-641" aria-hidden="true" tabindex="-1"></a><span class="fu">##### *Check for `Chilling Hours`* {.unnumbered}</span></span>
<span id="cb385-642"><a href="#cb385-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-643"><a href="#cb385-643" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 6.1.7.2}</span></span>
<span id="cb385-644"><a href="#cb385-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-645"><a href="#cb385-645" aria-hidden="true" tabindex="-1"></a><span class="in"># Assign new column Chiling_Hour </span></span>
<span id="cb385-646"><a href="#cb385-646" aria-hidden="true" tabindex="-1"></a><span class="in">hourtemps[,"Chilling_Hour"] &lt;-</span></span>
<span id="cb385-647"><a href="#cb385-647" aria-hidden="true" tabindex="-1"></a><span class="in">  hourtemps$Temp &gt;= 0 &amp; hourtemps$Temp &lt;= 7.2</span></span>
<span id="cb385-648"><a href="#cb385-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-649"><a href="#cb385-649" aria-hidden="true" tabindex="-1"></a><span class="in"># Check if the temperatures fall within Chilling_Hour for row 13 to 20</span></span>
<span id="cb385-650"><a href="#cb385-650" aria-hidden="true" tabindex="-1"></a><span class="in">hourtemps[13:20, ]</span></span>
<span id="cb385-651"><a href="#cb385-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-652"><a href="#cb385-652" aria-hidden="true" tabindex="-1"></a><span class="in"># Find total chilling hour for a particular period by defining rows (3-4 March 2008)</span></span>
<span id="cb385-653"><a href="#cb385-653" aria-hidden="true" tabindex="-1"></a><span class="in">sum(hourtemps$Chilling_Hour[13:20])</span></span>
<span id="cb385-654"><a href="#cb385-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-655"><a href="#cb385-655" aria-hidden="true" tabindex="-1"></a><span class="in"># Use `which` function to set the dates for total chilling hours calculation</span></span>
<span id="cb385-656"><a href="#cb385-656" aria-hidden="true" tabindex="-1"></a><span class="in">Start_Date &lt;- which(hourtemps$Year == 2008 &amp;</span></span>
<span id="cb385-657"><a href="#cb385-657" aria-hidden="true" tabindex="-1"></a><span class="in">                      hourtemps$Month == 10 &amp;</span></span>
<span id="cb385-658"><a href="#cb385-658" aria-hidden="true" tabindex="-1"></a><span class="in">                      hourtemps$Day == 1 &amp;</span></span>
<span id="cb385-659"><a href="#cb385-659" aria-hidden="true" tabindex="-1"></a><span class="in">                      hourtemps$Hour == 12)</span></span>
<span id="cb385-660"><a href="#cb385-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-661"><a href="#cb385-661" aria-hidden="true" tabindex="-1"></a><span class="in">End_Date &lt;- which(hourtemps$Year == 2008 &amp;</span></span>
<span id="cb385-662"><a href="#cb385-662" aria-hidden="true" tabindex="-1"></a><span class="in">                    hourtemps$Month == 10 &amp;</span></span>
<span id="cb385-663"><a href="#cb385-663" aria-hidden="true" tabindex="-1"></a><span class="in">                    hourtemps$Day == 31 &amp;</span></span>
<span id="cb385-664"><a href="#cb385-664" aria-hidden="true" tabindex="-1"></a><span class="in">                    hourtemps$Hour == 12)</span></span>
<span id="cb385-665"><a href="#cb385-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-666"><a href="#cb385-666" aria-hidden="true" tabindex="-1"></a><span class="in">sum(hourtemps$Chilling_Hour[Start_Date:End_Date])</span></span>
<span id="cb385-667"><a href="#cb385-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-668"><a href="#cb385-668" aria-hidden="true" tabindex="-1"></a><span class="in"># So in October of 2008, Winters experienced 28 Chilling Hours.</span></span>
<span id="cb385-669"><a href="#cb385-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-670"><a href="#cb385-670" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-671"><a href="#cb385-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-672"><a href="#cb385-672" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-673"><a href="#cb385-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-674"><a href="#cb385-674" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;6.2&lt;/span&gt;&amp;nbsp; Our first chill function</span></span>
<span id="cb385-675"><a href="#cb385-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-676"><a href="#cb385-676" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-677"><a href="#cb385-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-678"><a href="#cb385-678" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A function consists of a name, some arguments that are passed to the function, and some code that should be executed.</span>
<span id="cb385-679"><a href="#cb385-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-680"><a href="#cb385-680" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We can define is as <span class="in">`OurFunctionName &lt;- function(argument1, argument2, ...) {ourCode}`</span>.</span>
<span id="cb385-681"><a href="#cb385-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-682"><a href="#cb385-682" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>What’s returned is either the last object that’s mentioned in the function code or some content specified by the <span class="in">`return()`</span> function.</span>
<span id="cb385-683"><a href="#cb385-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-684"><a href="#cb385-684" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 6.2}</span></span>
<span id="cb385-685"><a href="#cb385-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-686"><a href="#cb385-686" aria-hidden="true" tabindex="-1"></a><span class="in"># Example function for Chilling_Hour calculation</span></span>
<span id="cb385-687"><a href="#cb385-687" aria-hidden="true" tabindex="-1"></a><span class="in"># Function that adds Chilling_Hour column to dataframe</span></span>
<span id="cb385-688"><a href="#cb385-688" aria-hidden="true" tabindex="-1"></a><span class="in">CH &lt;- function(hourtemps)</span></span>
<span id="cb385-689"><a href="#cb385-689" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb385-690"><a href="#cb385-690" aria-hidden="true" tabindex="-1"></a><span class="in">  hourtemps[, "Chilling_Hour"] &lt;-</span></span>
<span id="cb385-691"><a href="#cb385-691" aria-hidden="true" tabindex="-1"></a><span class="in">    hourtemps$Temp &gt;= 0 &amp; hourtemps$Temp &lt;= 7.2</span></span>
<span id="cb385-692"><a href="#cb385-692" aria-hidden="true" tabindex="-1"></a><span class="in">  return(hourtemps)</span></span>
<span id="cb385-693"><a href="#cb385-693" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-694"><a href="#cb385-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-695"><a href="#cb385-695" aria-hidden="true" tabindex="-1"></a><span class="in"># Check chilling hour `yes or no` for rows 13-20</span></span>
<span id="cb385-696"><a href="#cb385-696" aria-hidden="true" tabindex="-1"></a><span class="in">CH(hourtemps)[13:20, ]</span></span>
<span id="cb385-697"><a href="#cb385-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-698"><a href="#cb385-698" aria-hidden="true" tabindex="-1"></a><span class="in"># Create more complex functions, e.g. to calculate the number of Chilling Hours</span></span>
<span id="cb385-699"><a href="#cb385-699" aria-hidden="true" tabindex="-1"></a><span class="in"># between two dates, which we can specify in the YEARMODA format </span></span>
<span id="cb385-700"><a href="#cb385-700" aria-hidden="true" tabindex="-1"></a><span class="in"># (i.e. year, month and day, combined in one number).</span></span>
<span id="cb385-701"><a href="#cb385-701" aria-hidden="true" tabindex="-1"></a><span class="in">sum_CH &lt;- function(hourtemps,</span></span>
<span id="cb385-702"><a href="#cb385-702" aria-hidden="true" tabindex="-1"></a><span class="in">                   Start_YEARMODA,</span></span>
<span id="cb385-703"><a href="#cb385-703" aria-hidden="true" tabindex="-1"></a><span class="in">                   End_YEARMODA)</span></span>
<span id="cb385-704"><a href="#cb385-704" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb385-705"><a href="#cb385-705" aria-hidden="true" tabindex="-1"></a><span class="in">  Start_Year &lt;- trunc(Start_YEARMODA / 10000) # "trunc" removes all decimals</span></span>
<span id="cb385-706"><a href="#cb385-706" aria-hidden="true" tabindex="-1"></a><span class="in">  Start_Month &lt;-</span></span>
<span id="cb385-707"><a href="#cb385-707" aria-hidden="true" tabindex="-1"></a><span class="in">    trunc((Start_YEARMODA - Start_Year*10000) / 100)</span></span>
<span id="cb385-708"><a href="#cb385-708" aria-hidden="true" tabindex="-1"></a><span class="in">  Start_Day &lt;- </span></span>
<span id="cb385-709"><a href="#cb385-709" aria-hidden="true" tabindex="-1"></a><span class="in">    Start_YEARMODA - Start_Year * 10000 - Start_Month * 100</span></span>
<span id="cb385-710"><a href="#cb385-710" aria-hidden="true" tabindex="-1"></a><span class="in">  Start_Hour &lt;- 12 # This could also be flexible, but let's skip this for now</span></span>
<span id="cb385-711"><a href="#cb385-711" aria-hidden="true" tabindex="-1"></a><span class="in">  End_Year &lt;- trunc(End_YEARMODA / 10000)</span></span>
<span id="cb385-712"><a href="#cb385-712" aria-hidden="true" tabindex="-1"></a><span class="in">  End_Month &lt;- trunc((End_YEARMODA - End_Year * 10000) / 100)</span></span>
<span id="cb385-713"><a href="#cb385-713" aria-hidden="true" tabindex="-1"></a><span class="in">  End_Day &lt;- End_YEARMODA - End_Year * 10000 - End_Month * 100</span></span>
<span id="cb385-714"><a href="#cb385-714" aria-hidden="true" tabindex="-1"></a><span class="in">  End_Hour &lt;- 12 # This could also be flexible, but let's skip this for now</span></span>
<span id="cb385-715"><a href="#cb385-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-716"><a href="#cb385-716" aria-hidden="true" tabindex="-1"></a><span class="in">  Start_Date &lt;- which(hourtemps$Year == Start_Year &amp;</span></span>
<span id="cb385-717"><a href="#cb385-717" aria-hidden="true" tabindex="-1"></a><span class="in">                        hourtemps$Month == Start_Month &amp;</span></span>
<span id="cb385-718"><a href="#cb385-718" aria-hidden="true" tabindex="-1"></a><span class="in">                        hourtemps$Day == Start_Day &amp;</span></span>
<span id="cb385-719"><a href="#cb385-719" aria-hidden="true" tabindex="-1"></a><span class="in">                        hourtemps$Hour == Start_Hour)</span></span>
<span id="cb385-720"><a href="#cb385-720" aria-hidden="true" tabindex="-1"></a><span class="in">  End_Date &lt;- which(hourtemps$Year == End_Year &amp;</span></span>
<span id="cb385-721"><a href="#cb385-721" aria-hidden="true" tabindex="-1"></a><span class="in">                    hourtemps$Month == End_Month &amp;</span></span>
<span id="cb385-722"><a href="#cb385-722" aria-hidden="true" tabindex="-1"></a><span class="in">                    hourtemps$Day == End_Day &amp;</span></span>
<span id="cb385-723"><a href="#cb385-723" aria-hidden="true" tabindex="-1"></a><span class="in">                    hourtemps$Hour == End_Hour)</span></span>
<span id="cb385-724"><a href="#cb385-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-725"><a href="#cb385-725" aria-hidden="true" tabindex="-1"></a><span class="in">  Chill_hours &lt;- CH(hourtemps)</span></span>
<span id="cb385-726"><a href="#cb385-726" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-727"><a href="#cb385-727" aria-hidden="true" tabindex="-1"></a><span class="in">  return(sum(Chill_hours$Chilling_Hour[Start_Date:End_Date]))</span></span>
<span id="cb385-728"><a href="#cb385-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-729"><a href="#cb385-729" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-730"><a href="#cb385-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-731"><a href="#cb385-731" aria-hidden="true" tabindex="-1"></a><span class="in"># Check the total chilling hours from March 1 to October 11, 2008</span></span>
<span id="cb385-732"><a href="#cb385-732" aria-hidden="true" tabindex="-1"></a><span class="in"># Note that the dataset only goes from 3rd March to 11th November 2008, </span></span>
<span id="cb385-733"><a href="#cb385-733" aria-hidden="true" tabindex="-1"></a><span class="in"># so use of any dates outside that range will generate an error message. </span></span>
<span id="cb385-734"><a href="#cb385-734" aria-hidden="true" tabindex="-1"></a><span class="in">sum_CH(hourtemps, 20080401, 20081011)</span></span>
<span id="cb385-735"><a href="#cb385-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-736"><a href="#cb385-736" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-737"><a href="#cb385-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-738"><a href="#cb385-738" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-739"><a href="#cb385-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-740"><a href="#cb385-740" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;6.3&lt;/span&gt;&amp;nbsp; Exercise on basic chill modeling</span></span>
<span id="cb385-741"><a href="#cb385-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-742"><a href="#cb385-742" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-743"><a href="#cb385-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-744"><a href="#cb385-744" aria-hidden="true" tabindex="-1"></a>***1. Write a basic function that calculates warm hours (&gt;25°C)***</span>
<span id="cb385-745"><a href="#cb385-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-746"><a href="#cb385-746" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 6.3.1}</span></span>
<span id="cb385-747"><a href="#cb385-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-748"><a href="#cb385-748" aria-hidden="true" tabindex="-1"></a><span class="in">## Check for warm hours above 25 degree C in Winters_hours_gaps dataset</span></span>
<span id="cb385-749"><a href="#cb385-749" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a dataset without temperature gaps</span></span>
<span id="cb385-750"><a href="#cb385-750" aria-hidden="true" tabindex="-1"></a><span class="in">W_data &lt;- Winters_hours_gaps[,</span></span>
<span id="cb385-751"><a href="#cb385-751" aria-hidden="true" tabindex="-1"></a><span class="in">                             c("Year",</span></span>
<span id="cb385-752"><a href="#cb385-752" aria-hidden="true" tabindex="-1"></a><span class="in">                               "Month",</span></span>
<span id="cb385-753"><a href="#cb385-753" aria-hidden="true" tabindex="-1"></a><span class="in">                               "Day",</span></span>
<span id="cb385-754"><a href="#cb385-754" aria-hidden="true" tabindex="-1"></a><span class="in">                               "Hour",</span></span>
<span id="cb385-755"><a href="#cb385-755" aria-hidden="true" tabindex="-1"></a><span class="in">                               "Temp")]</span></span>
<span id="cb385-756"><a href="#cb385-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-757"><a href="#cb385-757" aria-hidden="true" tabindex="-1"></a><span class="in"># Write function that calculates warm hours above 25 degree C</span></span>
<span id="cb385-758"><a href="#cb385-758" aria-hidden="true" tabindex="-1"></a><span class="in">WH &lt;- function(W_data)</span></span>
<span id="cb385-759"><a href="#cb385-759" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb385-760"><a href="#cb385-760" aria-hidden="true" tabindex="-1"></a><span class="in">  W_data[, "Warm_Hour"] &lt;-</span></span>
<span id="cb385-761"><a href="#cb385-761" aria-hidden="true" tabindex="-1"></a><span class="in">    W_data$Temp &gt; 25</span></span>
<span id="cb385-762"><a href="#cb385-762" aria-hidden="true" tabindex="-1"></a><span class="in">  return(W_data)</span></span>
<span id="cb385-763"><a href="#cb385-763" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-764"><a href="#cb385-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-765"><a href="#cb385-765" aria-hidden="true" tabindex="-1"></a><span class="in"># Show the the first 4 rows</span></span>
<span id="cb385-766"><a href="#cb385-766" aria-hidden="true" tabindex="-1"></a><span class="in">WH(W_data)[1:4, ]</span></span>
<span id="cb385-767"><a href="#cb385-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-768"><a href="#cb385-768" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate total warm hours for the dataset</span></span>
<span id="cb385-769"><a href="#cb385-769" aria-hidden="true" tabindex="-1"></a><span class="in">WH_sum &lt;- WH(W_data)</span></span>
<span id="cb385-770"><a href="#cb385-770" aria-hidden="true" tabindex="-1"></a><span class="in">sum(WH_sum$Warm_Hour)</span></span>
<span id="cb385-771"><a href="#cb385-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-772"><a href="#cb385-772" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-773"><a href="#cb385-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-774"><a href="#cb385-774" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-775"><a href="#cb385-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-776"><a href="#cb385-776" aria-hidden="true" tabindex="-1"></a>***2. Apply this function to the Winters_hours_gaps dataset***</span>
<span id="cb385-777"><a href="#cb385-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-778"><a href="#cb385-778" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 6.3.2}</span></span>
<span id="cb385-779"><a href="#cb385-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-780"><a href="#cb385-780" aria-hidden="true" tabindex="-1"></a><span class="in"># Apply the function to original Winters_hours_gaps dataset</span></span>
<span id="cb385-781"><a href="#cb385-781" aria-hidden="true" tabindex="-1"></a><span class="in">kable(WH(Winters_hours_gaps[961:970, ]), row.names = FALSE) %&gt;%</span></span>
<span id="cb385-782"><a href="#cb385-782" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-783"><a href="#cb385-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-784"><a href="#cb385-784" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-785"><a href="#cb385-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-786"><a href="#cb385-786" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-787"><a href="#cb385-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-788"><a href="#cb385-788" aria-hidden="true" tabindex="-1"></a>***3. Extend this function, so that it can take start and end dates as inputs and sums up warm hours between these dates***</span>
<span id="cb385-789"><a href="#cb385-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-790"><a href="#cb385-790" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 6.3.3}</span></span>
<span id="cb385-791"><a href="#cb385-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-792"><a href="#cb385-792" aria-hidden="true" tabindex="-1"></a><span class="in">sum_WH &lt;- function(W_data,</span></span>
<span id="cb385-793"><a href="#cb385-793" aria-hidden="true" tabindex="-1"></a><span class="in">                   Start_YEARMODA,</span></span>
<span id="cb385-794"><a href="#cb385-794" aria-hidden="true" tabindex="-1"></a><span class="in">                   End_YEARMODA) {</span></span>
<span id="cb385-795"><a href="#cb385-795" aria-hidden="true" tabindex="-1"></a><span class="in">  Start_Year &lt;- trunc(Start_YEARMODA / 10000)</span></span>
<span id="cb385-796"><a href="#cb385-796" aria-hidden="true" tabindex="-1"></a><span class="in">  Start_Month &lt;- trunc((Start_YEARMODA - Start_Year * 10000) / 100)</span></span>
<span id="cb385-797"><a href="#cb385-797" aria-hidden="true" tabindex="-1"></a><span class="in">  Start_Day &lt;- trunc((Start_YEARMODA - Start_Year *10000) - </span></span>
<span id="cb385-798"><a href="#cb385-798" aria-hidden="true" tabindex="-1"></a><span class="in">                         Start_Month * 100)</span></span>
<span id="cb385-799"><a href="#cb385-799" aria-hidden="true" tabindex="-1"></a><span class="in">  Start_Hour &lt;- 12</span></span>
<span id="cb385-800"><a href="#cb385-800" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-801"><a href="#cb385-801" aria-hidden="true" tabindex="-1"></a><span class="in">  End_Year &lt;- trunc(End_YEARMODA / 10000)</span></span>
<span id="cb385-802"><a href="#cb385-802" aria-hidden="true" tabindex="-1"></a><span class="in">  End_Month &lt;- trunc((End_YEARMODA - Start_Year * 10000) / 100)</span></span>
<span id="cb385-803"><a href="#cb385-803" aria-hidden="true" tabindex="-1"></a><span class="in">  End_Day &lt;- trunc((End_YEARMODA - Start_Year *10000) - </span></span>
<span id="cb385-804"><a href="#cb385-804" aria-hidden="true" tabindex="-1"></a><span class="in">                         End_Month * 100)</span></span>
<span id="cb385-805"><a href="#cb385-805" aria-hidden="true" tabindex="-1"></a><span class="in">  End_Hour &lt;- 12</span></span>
<span id="cb385-806"><a href="#cb385-806" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-807"><a href="#cb385-807" aria-hidden="true" tabindex="-1"></a><span class="in">  Start_Date &lt;- which(W_data$Year == Start_Year &amp;</span></span>
<span id="cb385-808"><a href="#cb385-808" aria-hidden="true" tabindex="-1"></a><span class="in">                        W_data$Month == Start_Month &amp;</span></span>
<span id="cb385-809"><a href="#cb385-809" aria-hidden="true" tabindex="-1"></a><span class="in">                        W_data$Day == Start_Day &amp;</span></span>
<span id="cb385-810"><a href="#cb385-810" aria-hidden="true" tabindex="-1"></a><span class="in">                        W_data$Hour == Start_Hour)</span></span>
<span id="cb385-811"><a href="#cb385-811" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-812"><a href="#cb385-812" aria-hidden="true" tabindex="-1"></a><span class="in">  End_Date &lt;- which(W_data$Year == End_Year &amp;</span></span>
<span id="cb385-813"><a href="#cb385-813" aria-hidden="true" tabindex="-1"></a><span class="in">                        W_data$Month == End_Month &amp;</span></span>
<span id="cb385-814"><a href="#cb385-814" aria-hidden="true" tabindex="-1"></a><span class="in">                        W_data$Day == End_Day &amp;</span></span>
<span id="cb385-815"><a href="#cb385-815" aria-hidden="true" tabindex="-1"></a><span class="in">                        W_data$Hour == End_Hour)</span></span>
<span id="cb385-816"><a href="#cb385-816" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-817"><a href="#cb385-817" aria-hidden="true" tabindex="-1"></a><span class="in">  Warm_Hours &lt;- WH(W_data)</span></span>
<span id="cb385-818"><a href="#cb385-818" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-819"><a href="#cb385-819" aria-hidden="true" tabindex="-1"></a><span class="in">  return(sum(Warm_Hours$Warm_Hour[Start_Date:End_Date]))</span></span>
<span id="cb385-820"><a href="#cb385-820" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-821"><a href="#cb385-821" aria-hidden="true" tabindex="-1"></a><span class="in">}  # See in-class script for setting year, month and date with substr </span></span>
<span id="cb385-822"><a href="#cb385-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-823"><a href="#cb385-823" aria-hidden="true" tabindex="-1"></a><span class="in"># Total warm hours for the whole period of dataset </span></span>
<span id="cb385-824"><a href="#cb385-824" aria-hidden="true" tabindex="-1"></a><span class="in">sum_WH(W_data, 20080303, 20081110)</span></span>
<span id="cb385-825"><a href="#cb385-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-826"><a href="#cb385-826" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-827"><a href="#cb385-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-828"><a href="#cb385-828" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-829"><a href="#cb385-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-830"><a href="#cb385-830" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 7: Chill models</span></span>
<span id="cb385-831"><a href="#cb385-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-832"><a href="#cb385-832" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;7.1&lt;/span&gt;&amp;nbsp; Chill models in `chillR`</span></span>
<span id="cb385-833"><a href="#cb385-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-834"><a href="#cb385-834" aria-hidden="true" tabindex="-1"></a><span class="fu">#### *`Chilling_Hours()` function* {.unnumbered}</span></span>
<span id="cb385-835"><a href="#cb385-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-836"><a href="#cb385-836" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-837"><a href="#cb385-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-838"><a href="#cb385-838" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Chilling Hours are great for an entry-level tutorial on chill modeling, but they’re not a particularly credible metric, so I suggest you forget them right away.    </span>
<span id="cb385-839"><a href="#cb385-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-840"><a href="#cb385-840" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-841"><a href="#cb385-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-842"><a href="#cb385-842" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 7.1.1}</span></span>
<span id="cb385-843"><a href="#cb385-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-844"><a href="#cb385-844" aria-hidden="true" tabindex="-1"></a><span class="in"># Chilling_Hours() function in chillR to calculate chilling hours</span></span>
<span id="cb385-845"><a href="#cb385-845" aria-hidden="true" tabindex="-1"></a><span class="in">Chilling_Hours</span></span>
<span id="cb385-846"><a href="#cb385-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-847"><a href="#cb385-847" aria-hidden="true" tabindex="-1"></a><span class="in"># Apply Chilling_Hours() function to Winters_hours_gap dataset</span></span>
<span id="cb385-848"><a href="#cb385-848" aria-hidden="true" tabindex="-1"></a><span class="in">Chilling_Hours(Winters_hours_gaps$Temp)[1:100]</span></span>
<span id="cb385-849"><a href="#cb385-849" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-850"><a href="#cb385-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-851"><a href="#cb385-851" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-852"><a href="#cb385-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-853"><a href="#cb385-853" aria-hidden="true" tabindex="-1"></a><span class="fu">#### *The Utah model* {.unnumbered}</span></span>
<span id="cb385-854"><a href="#cb385-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-855"><a href="#cb385-855" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-856"><a href="#cb385-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-857"><a href="#cb385-857" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`step_model()`</span> function allows you to define your own model, based on temperature thresholds and weights. </span>
<span id="cb385-858"><a href="#cb385-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-859"><a href="#cb385-859" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To implement various variations of the Utah Model that have been developed for different locations</span>
<span id="cb385-860"><a href="#cb385-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-861"><a href="#cb385-861" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 7.1.2}</span></span>
<span id="cb385-862"><a href="#cb385-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-863"><a href="#cb385-863" aria-hidden="true" tabindex="-1"></a><span class="in">Utah_Model</span></span>
<span id="cb385-864"><a href="#cb385-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-865"><a href="#cb385-865" aria-hidden="true" tabindex="-1"></a><span class="in">Utah_Model(Winters_hours_gaps$Temp)[1:100]</span></span>
<span id="cb385-866"><a href="#cb385-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-867"><a href="#cb385-867" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a data.frame for temperatures with weights</span></span>
<span id="cb385-868"><a href="#cb385-868" aria-hidden="true" tabindex="-1"></a><span class="in">df &lt;- data.frame(</span></span>
<span id="cb385-869"><a href="#cb385-869" aria-hidden="true" tabindex="-1"></a><span class="in">  lower  = c(-1000, 1, 2, 3, 4, 5,    6),</span></span>
<span id="cb385-870"><a href="#cb385-870" aria-hidden="true" tabindex="-1"></a><span class="in">  upper  = c(    1, 2, 3, 4, 5, 6, 1000),</span></span>
<span id="cb385-871"><a href="#cb385-871" aria-hidden="true" tabindex="-1"></a><span class="in">  weight = c(    0, 1, 2, 3, 2, 1,    0))</span></span>
<span id="cb385-872"><a href="#cb385-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-873"><a href="#cb385-873" aria-hidden="true" tabindex="-1"></a><span class="in">kable(df) %&gt;%</span></span>
<span id="cb385-874"><a href="#cb385-874" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-875"><a href="#cb385-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-876"><a href="#cb385-876" aria-hidden="true" tabindex="-1"></a><span class="in"># Use custom() function to implement a chill model based on df</span></span>
<span id="cb385-877"><a href="#cb385-877" aria-hidden="true" tabindex="-1"></a><span class="in">custom &lt;- function(x) step_model(x, df)</span></span>
<span id="cb385-878"><a href="#cb385-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-879"><a href="#cb385-879" aria-hidden="true" tabindex="-1"></a><span class="in">custom(Winters_hours_gaps$Temp)[1:100]</span></span>
<span id="cb385-880"><a href="#cb385-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-881"><a href="#cb385-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-882"><a href="#cb385-882" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-883"><a href="#cb385-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-884"><a href="#cb385-884" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-885"><a href="#cb385-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-886"><a href="#cb385-886" aria-hidden="true" tabindex="-1"></a><span class="fu">#### *The dynamic model* {.unnumbered} </span></span>
<span id="cb385-887"><a href="#cb385-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-888"><a href="#cb385-888" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-889"><a href="#cb385-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-890"><a href="#cb385-890" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 7.1.3}</span></span>
<span id="cb385-891"><a href="#cb385-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-892"><a href="#cb385-892" aria-hidden="true" tabindex="-1"></a><span class="in">Dynamic_Model</span></span>
<span id="cb385-893"><a href="#cb385-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-894"><a href="#cb385-894" aria-hidden="true" tabindex="-1"></a><span class="in">Dynamic_Model(Winters_hours_gaps$Temp)[1:100]</span></span>
<span id="cb385-895"><a href="#cb385-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-896"><a href="#cb385-896" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-897"><a href="#cb385-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-898"><a href="#cb385-898" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-899"><a href="#cb385-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-900"><a href="#cb385-900" aria-hidden="true" tabindex="-1"></a><span class="fu">#### *`make_JDay()` and `tempResponse` functions* {.unnumbered}</span></span>
<span id="cb385-901"><a href="#cb385-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-902"><a href="#cb385-902" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-903"><a href="#cb385-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-904"><a href="#cb385-904" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Add the Julian dates (counts the days of the year) to the dataset </span>
<span id="cb385-905"><a href="#cb385-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-906"><a href="#cb385-906" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The <span class="in">`chilling()`</span> function implements the Chilling Hours, Utah and Dynamic Models, and it also calculates Growing Degree Days (GDH); use <span class="in">`tempResponse`</span> function otherwise</span>
<span id="cb385-907"><a href="#cb385-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-908"><a href="#cb385-908" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 7.1.4}</span></span>
<span id="cb385-909"><a href="#cb385-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-910"><a href="#cb385-910" aria-hidden="true" tabindex="-1"></a><span class="in"># Use chilling() function</span></span>
<span id="cb385-911"><a href="#cb385-911" aria-hidden="true" tabindex="-1"></a><span class="in">output &lt;- chilling(make_JDay(Winters_hours_gaps),</span></span>
<span id="cb385-912"><a href="#cb385-912" aria-hidden="true" tabindex="-1"></a><span class="in">                   Start_JDay = 90,</span></span>
<span id="cb385-913"><a href="#cb385-913" aria-hidden="true" tabindex="-1"></a><span class="in">                   End_JDay = 100)</span></span>
<span id="cb385-914"><a href="#cb385-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-915"><a href="#cb385-915" aria-hidden="true" tabindex="-1"></a><span class="in">kable(output) %&gt;%</span></span>
<span id="cb385-916"><a href="#cb385-916" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", </span></span>
<span id="cb385-917"><a href="#cb385-917" aria-hidden="true" tabindex="-1"></a><span class="in">                position = "left",</span></span>
<span id="cb385-918"><a href="#cb385-918" aria-hidden="true" tabindex="-1"></a><span class="in">                font_size = 10)</span></span>
<span id="cb385-919"><a href="#cb385-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-920"><a href="#cb385-920" aria-hidden="true" tabindex="-1"></a><span class="in"># Use tempResponse function</span></span>
<span id="cb385-921"><a href="#cb385-921" aria-hidden="true" tabindex="-1"></a><span class="in">output &lt;- tempResponse(make_JDay(Winters_hours_gaps),</span></span>
<span id="cb385-922"><a href="#cb385-922" aria-hidden="true" tabindex="-1"></a><span class="in">                       Start_JDay = 90,</span></span>
<span id="cb385-923"><a href="#cb385-923" aria-hidden="true" tabindex="-1"></a><span class="in">                       End_JDay = 100,</span></span>
<span id="cb385-924"><a href="#cb385-924" aria-hidden="true" tabindex="-1"></a><span class="in">                       models = list(Chill_Portions = Dynamic_Model,</span></span>
<span id="cb385-925"><a href="#cb385-925" aria-hidden="true" tabindex="-1"></a><span class="in">                                     GDH = GDH))</span></span>
<span id="cb385-926"><a href="#cb385-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-927"><a href="#cb385-927" aria-hidden="true" tabindex="-1"></a><span class="in">kable(output) %&gt;%</span></span>
<span id="cb385-928"><a href="#cb385-928" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped",</span></span>
<span id="cb385-929"><a href="#cb385-929" aria-hidden="true" tabindex="-1"></a><span class="in">                position = "left",</span></span>
<span id="cb385-930"><a href="#cb385-930" aria-hidden="true" tabindex="-1"></a><span class="in">                font_size = 10)</span></span>
<span id="cb385-931"><a href="#cb385-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-932"><a href="#cb385-932" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-933"><a href="#cb385-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-934"><a href="#cb385-934" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-935"><a href="#cb385-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-936"><a href="#cb385-936" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;7.2&lt;/span&gt;&amp;nbsp; Exercise on chill models</span></span>
<span id="cb385-937"><a href="#cb385-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-938"><a href="#cb385-938" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-939"><a href="#cb385-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-940"><a href="#cb385-940" aria-hidden="true" tabindex="-1"></a>***1. Run the `chilling()` function on the `Winters_hours_gap` dataset***</span>
<span id="cb385-941"><a href="#cb385-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-942"><a href="#cb385-942" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 7.2.1}</span></span>
<span id="cb385-943"><a href="#cb385-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-944"><a href="#cb385-944" aria-hidden="true" tabindex="-1"></a><span class="in"># Check JDay for start and end of dataset period</span></span>
<span id="cb385-945"><a href="#cb385-945" aria-hidden="true" tabindex="-1"></a><span class="in">dates &lt;- data.frame(Year = c(2008, 2008),</span></span>
<span id="cb385-946"><a href="#cb385-946" aria-hidden="true" tabindex="-1"></a><span class="in">                    Month = c(3, 11),</span></span>
<span id="cb385-947"><a href="#cb385-947" aria-hidden="true" tabindex="-1"></a><span class="in">                    Day = c(3, 11))</span></span>
<span id="cb385-948"><a href="#cb385-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-949"><a href="#cb385-949" aria-hidden="true" tabindex="-1"></a><span class="in">kable(make_JDay(dates)) %&gt;%</span></span>
<span id="cb385-950"><a href="#cb385-950" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped",</span></span>
<span id="cb385-951"><a href="#cb385-951" aria-hidden="true" tabindex="-1"></a><span class="in">                position = "left",</span></span>
<span id="cb385-952"><a href="#cb385-952" aria-hidden="true" tabindex="-1"></a><span class="in">                font_size = 10)</span></span>
<span id="cb385-953"><a href="#cb385-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-954"><a href="#cb385-954" aria-hidden="true" tabindex="-1"></a><span class="in"># Apply chilling() function on Winters_hours_gap dataset</span></span>
<span id="cb385-955"><a href="#cb385-955" aria-hidden="true" tabindex="-1"></a><span class="in">c_output &lt;- chilling(make_JDay(Winters_hours_gaps),</span></span>
<span id="cb385-956"><a href="#cb385-956" aria-hidden="true" tabindex="-1"></a><span class="in">                     Start_JDay = 63,</span></span>
<span id="cb385-957"><a href="#cb385-957" aria-hidden="true" tabindex="-1"></a><span class="in">                     End_JDay = 316)</span></span>
<span id="cb385-958"><a href="#cb385-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-959"><a href="#cb385-959" aria-hidden="true" tabindex="-1"></a><span class="in">kable(c_output) %&gt;%</span></span>
<span id="cb385-960"><a href="#cb385-960" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped",</span></span>
<span id="cb385-961"><a href="#cb385-961" aria-hidden="true" tabindex="-1"></a><span class="in">                position = "left",</span></span>
<span id="cb385-962"><a href="#cb385-962" aria-hidden="true" tabindex="-1"></a><span class="in">                font_size = 10)</span></span>
<span id="cb385-963"><a href="#cb385-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-964"><a href="#cb385-964" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-965"><a href="#cb385-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-966"><a href="#cb385-966" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-967"><a href="#cb385-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-968"><a href="#cb385-968" aria-hidden="true" tabindex="-1"></a>***2. Create your own temperature-weighting chill model using the `step_model()` function***</span>
<span id="cb385-969"><a href="#cb385-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-970"><a href="#cb385-970" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 7.2.2}</span></span>
<span id="cb385-971"><a href="#cb385-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-972"><a href="#cb385-972" aria-hidden="true" tabindex="-1"></a><span class="in">t_data &lt;- data.frame(</span></span>
<span id="cb385-973"><a href="#cb385-973" aria-hidden="true" tabindex="-1"></a><span class="in">  lower  = c(-1000, 2, 8, 12, 15, 18, 20, 25),</span></span>
<span id="cb385-974"><a href="#cb385-974" aria-hidden="true" tabindex="-1"></a><span class="in">  upper  = c(2, 8, 12, 15, 18, 20, 25, 1000),</span></span>
<span id="cb385-975"><a href="#cb385-975" aria-hidden="true" tabindex="-1"></a><span class="in">  weight = c(0, 0.5, 1, 2, 0.5, -0.5, -1, -2)</span></span>
<span id="cb385-976"><a href="#cb385-976" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb385-977"><a href="#cb385-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-978"><a href="#cb385-978" aria-hidden="true" tabindex="-1"></a><span class="in">kable(t_data) %&gt;%</span></span>
<span id="cb385-979"><a href="#cb385-979" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-980"><a href="#cb385-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-981"><a href="#cb385-981" aria-hidden="true" tabindex="-1"></a><span class="in">custom &lt;- function(x) step_model(x, t_data)</span></span>
<span id="cb385-982"><a href="#cb385-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-983"><a href="#cb385-983" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-984"><a href="#cb385-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-985"><a href="#cb385-985" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-986"><a href="#cb385-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-987"><a href="#cb385-987" aria-hidden="true" tabindex="-1"></a>***3. Run this model on the `Winters_hours_gaps` dataset using the `tempResponse()` function.***</span>
<span id="cb385-988"><a href="#cb385-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-989"><a href="#cb385-989" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 7.2.3}</span></span>
<span id="cb385-990"><a href="#cb385-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-991"><a href="#cb385-991" aria-hidden="true" tabindex="-1"></a><span class="in">t_output &lt;- tempResponse(make_JDay(Winters_hours_gaps),</span></span>
<span id="cb385-992"><a href="#cb385-992" aria-hidden="true" tabindex="-1"></a><span class="in">                         Start_JDay = 63,</span></span>
<span id="cb385-993"><a href="#cb385-993" aria-hidden="true" tabindex="-1"></a><span class="in">                         End_JDay = 316,</span></span>
<span id="cb385-994"><a href="#cb385-994" aria-hidden="true" tabindex="-1"></a><span class="in">                         models = list (Cumulative_Temp = custom,</span></span>
<span id="cb385-995"><a href="#cb385-995" aria-hidden="true" tabindex="-1"></a><span class="in">                                        Chilling_Hours = Chilling_Hours,</span></span>
<span id="cb385-996"><a href="#cb385-996" aria-hidden="true" tabindex="-1"></a><span class="in">                                        Chill_Portions = Dynamic_Model,</span></span>
<span id="cb385-997"><a href="#cb385-997" aria-hidden="true" tabindex="-1"></a><span class="in">                                        Utah_Model = Utah_Model,</span></span>
<span id="cb385-998"><a href="#cb385-998" aria-hidden="true" tabindex="-1"></a><span class="in">                                        GDH = GDH))</span></span>
<span id="cb385-999"><a href="#cb385-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1000"><a href="#cb385-1000" aria-hidden="true" tabindex="-1"></a><span class="in">kable(t_output) %&gt;%</span></span>
<span id="cb385-1001"><a href="#cb385-1001" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-1002"><a href="#cb385-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1003"><a href="#cb385-1003" aria-hidden="true" tabindex="-1"></a><span class="in"># Here we see a big difference between the outputs of various models, </span></span>
<span id="cb385-1004"><a href="#cb385-1004" aria-hidden="true" tabindex="-1"></a><span class="in"># due to the different parameters chosen? </span></span>
<span id="cb385-1005"><a href="#cb385-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1006"><a href="#cb385-1006" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1007"><a href="#cb385-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1008"><a href="#cb385-1008" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1009"><a href="#cb385-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1010"><a href="#cb385-1010" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 8: Making hourly temperatures</span></span>
<span id="cb385-1011"><a href="#cb385-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1012"><a href="#cb385-1012" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;8.1&lt;/span&gt;&amp;nbsp; Generating hourly temperatures</span></span>
<span id="cb385-1013"><a href="#cb385-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1014"><a href="#cb385-1014" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1015"><a href="#cb385-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1016"><a href="#cb385-1016" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Most sources only provide daily data, usually including minimum and maximum temperature of the day, from which we can’t directly calculate Chilling Hours.</span>
<span id="cb385-1017"><a href="#cb385-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1018"><a href="#cb385-1018" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The rate of temperature increase in the morning is not the same as the rate of decrease in the evening. Besides, in particular the time of the lowest daily temperature varies considerably throughout the year (unless you’re close to the equator), and it would be good to consider this.</span>
<span id="cb385-1019"><a href="#cb385-1019" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>'Triangular' daily temperature pattern, achieved by interpolating linearly for hours between daily minimum temperature recorded at a certain time of day, and the maximum temperature at another time, is not realistic. </span>
<span id="cb385-1020"><a href="#cb385-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1021"><a href="#cb385-1021" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1022"><a href="#cb385-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1023"><a href="#cb385-1023" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;8.1.1&lt;/span&gt;&amp;nbsp; Idealized daily temperature curves</span></span>
<span id="cb385-1024"><a href="#cb385-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1025"><a href="#cb385-1025" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1026"><a href="#cb385-1026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1027"><a href="#cb385-1027" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">(Linvill, 1990)</span><span class="co">](https://journals.ashs.org/hortsci/view/journals/hortsci/25/1/article-p14.xml)</span> described the daily temperature curve using a combination of two mathematical equations: a sine curve to describe daytime warming, and a logarithmic decay function for nighttime cooling.</span>
<span id="cb385-1028"><a href="#cb385-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1029"><a href="#cb385-1029" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The transition points between the two parts were determined by sunrise and sunset, and the duration of the parts was related to daylength.</span>
<span id="cb385-1030"><a href="#cb385-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1031"><a href="#cb385-1031" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>One aspect that made Linvill’s equations hard to use across different locations was the dependency on sunrise and sunset times.</span>
<span id="cb385-1032"><a href="#cb385-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1033"><a href="#cb385-1033" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Fortunately, at least for locations without major topographic features, sunrise and sunset times can be calculated based on what we know about the geometry of our solar system.</span>
<span id="cb385-1034"><a href="#cb385-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1035"><a href="#cb385-1035" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use <span class="in">`daylength`</span> function to produce daily temperature curves.</span>
<span id="cb385-1036"><a href="#cb385-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1037"><a href="#cb385-1037" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>January 1st ist JDay 1, and December 31st either JDay 365 (in normal years) or JDay 366 (in leap years).</span>
<span id="cb385-1038"><a href="#cb385-1038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1039"><a href="#cb385-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1040"><a href="#cb385-1040" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 8.1.1}</span></span>
<span id="cb385-1041"><a href="#cb385-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1042"><a href="#cb385-1042" aria-hidden="true" tabindex="-1"></a><span class="in"># Make plots of the sunrise time, sunset time and daylength </span></span>
<span id="cb385-1043"><a href="#cb385-1043" aria-hidden="true" tabindex="-1"></a><span class="in"># at Klein-Altendorf (Latitude: 50.4°N) over the course of the year</span></span>
<span id="cb385-1044"><a href="#cb385-1044" aria-hidden="true" tabindex="-1"></a><span class="in">Days &lt;- daylength(latitude = 50.4, JDay = 1:365)</span></span>
<span id="cb385-1045"><a href="#cb385-1045" aria-hidden="true" tabindex="-1"></a><span class="in">Days_df &lt;- </span></span>
<span id="cb385-1046"><a href="#cb385-1046" aria-hidden="true" tabindex="-1"></a><span class="in">  data.frame(</span></span>
<span id="cb385-1047"><a href="#cb385-1047" aria-hidden="true" tabindex="-1"></a><span class="in">    JDay = 1:365,</span></span>
<span id="cb385-1048"><a href="#cb385-1048" aria-hidden="true" tabindex="-1"></a><span class="in">    Sunrise = Days$Sunrise,</span></span>
<span id="cb385-1049"><a href="#cb385-1049" aria-hidden="true" tabindex="-1"></a><span class="in">    Sunset = Days$Sunset,</span></span>
<span id="cb385-1050"><a href="#cb385-1050" aria-hidden="true" tabindex="-1"></a><span class="in">    Daylength = Days$Daylength</span></span>
<span id="cb385-1051"><a href="#cb385-1051" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb385-1052"><a href="#cb385-1052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1053"><a href="#cb385-1053" aria-hidden="true" tabindex="-1"></a><span class="in"># Use pivot_longer from tidyr to convert the data.frame, </span></span>
<span id="cb385-1054"><a href="#cb385-1054" aria-hidden="true" tabindex="-1"></a><span class="in"># so that the three time series (Sunrise, Sunset and Daylength) </span></span>
<span id="cb385-1055"><a href="#cb385-1055" aria-hidden="true" tabindex="-1"></a><span class="in"># were stacked on top of each other.</span></span>
<span id="cb385-1056"><a href="#cb385-1056" aria-hidden="true" tabindex="-1"></a><span class="in">Days_df &lt;- pivot_longer(Days_df, cols = c(Sunrise:Daylength))</span></span>
<span id="cb385-1057"><a href="#cb385-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1058"><a href="#cb385-1058" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(Days_df, aes(JDay, value)) +</span></span>
<span id="cb385-1059"><a href="#cb385-1059" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(lwd = 1.5) +</span></span>
<span id="cb385-1060"><a href="#cb385-1060" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(cols = vars(name)) +</span></span>
<span id="cb385-1061"><a href="#cb385-1061" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Time of Day / Daylength (Hours)") +</span></span>
<span id="cb385-1062"><a href="#cb385-1062" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 20)</span></span>
<span id="cb385-1063"><a href="#cb385-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1064"><a href="#cb385-1064" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1065"><a href="#cb385-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1066"><a href="#cb385-1066" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1067"><a href="#cb385-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1068"><a href="#cb385-1068" aria-hidden="true" tabindex="-1"></a><span class="fu">##### *Calculate hourly temperatures* {.unnumbered} </span></span>
<span id="cb385-1069"><a href="#cb385-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1070"><a href="#cb385-1070" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1071"><a href="#cb385-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1072"><a href="#cb385-1072" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`stack_hourly_temps()`</span> function takes as input a dataset of daily minimum and maximum temperatures</span>
<span id="cb385-1073"><a href="#cb385-1073" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Columns: <span class="in">`Tmin`</span>, <span class="in">`Tmax`</span>, <span class="in">`Year`</span>, <span class="in">`Month`</span>, <span class="in">`Day`</span></span>
<span id="cb385-1074"><a href="#cb385-1074" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Need the latitude of the place of interest</span>
<span id="cb385-1075"><a href="#cb385-1075" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Can also output the sunrise and sunset times</span>
<span id="cb385-1076"><a href="#cb385-1076" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-1077"><a href="#cb385-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1078"><a href="#cb385-1078" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 8.1.1a}</span></span>
<span id="cb385-1079"><a href="#cb385-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1080"><a href="#cb385-1080" aria-hidden="true" tabindex="-1"></a><span class="in"># Use KA_weather dataset to demonstrate stack_hourly_temps() function</span></span>
<span id="cb385-1081"><a href="#cb385-1081" aria-hidden="true" tabindex="-1"></a><span class="in">kable(chillR:: KA_weather[1:10, ]) %&gt;%</span></span>
<span id="cb385-1082"><a href="#cb385-1082" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-1083"><a href="#cb385-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1084"><a href="#cb385-1084" aria-hidden="true" tabindex="-1"></a><span class="in">## Adrian's codes </span></span>
<span id="cb385-1085"><a href="#cb385-1085" aria-hidden="true" tabindex="-1"></a><span class="in"># i recommend getting the prior day as well - because it will affect </span></span>
<span id="cb385-1086"><a href="#cb385-1086" aria-hidden="true" tabindex="-1"></a><span class="in"># the idealized curve pattern </span></span>
<span id="cb385-1087"><a href="#cb385-1087" aria-hidden="true" tabindex="-1"></a><span class="in">KA_weather_subset &lt;- </span></span>
<span id="cb385-1088"><a href="#cb385-1088" aria-hidden="true" tabindex="-1"></a><span class="in">  KA_weather %&gt;% </span></span>
<span id="cb385-1089"><a href="#cb385-1089" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Year == 1998) %&gt;% </span></span>
<span id="cb385-1090"><a href="#cb385-1090" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Month == 1) %&gt;% </span></span>
<span id="cb385-1091"><a href="#cb385-1091" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Day == 4</span></span>
<span id="cb385-1092"><a href="#cb385-1092" aria-hidden="true" tabindex="-1"></a><span class="in">         | Day == 5</span></span>
<span id="cb385-1093"><a href="#cb385-1093" aria-hidden="true" tabindex="-1"></a><span class="in">         | Day == 6</span></span>
<span id="cb385-1094"><a href="#cb385-1094" aria-hidden="true" tabindex="-1"></a><span class="in">         )</span></span>
<span id="cb385-1095"><a href="#cb385-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1096"><a href="#cb385-1096" aria-hidden="true" tabindex="-1"></a><span class="in">sh_data &lt;- stack_hourly_temps(KA_weather_subset, latitude = 50.4)</span></span>
<span id="cb385-1097"><a href="#cb385-1097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1098"><a href="#cb385-1098" aria-hidden="true" tabindex="-1"></a><span class="in"># stack_hourly_temps produces a list with 2 elements - the data and </span></span>
<span id="cb385-1099"><a href="#cb385-1099" aria-hidden="true" tabindex="-1"></a><span class="in"># a quality control table - select the hourtemps element to get the actual data</span></span>
<span id="cb385-1100"><a href="#cb385-1100" aria-hidden="true" tabindex="-1"></a><span class="in">sh_data &lt;- sh_data[["hourtemps"]]</span></span>
<span id="cb385-1101"><a href="#cb385-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1102"><a href="#cb385-1102" aria-hidden="true" tabindex="-1"></a><span class="in"># filter by day if you want to</span></span>
<span id="cb385-1103"><a href="#cb385-1103" aria-hidden="true" tabindex="-1"></a><span class="in">kable(sh_data %&gt;% filter(Day == 5)) %&gt;%</span></span>
<span id="cb385-1104"><a href="#cb385-1104" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-1105"><a href="#cb385-1105" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-1106"><a href="#cb385-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1107"><a href="#cb385-1107" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1108"><a href="#cb385-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1109"><a href="#cb385-1109" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1110"><a href="#cb385-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1111"><a href="#cb385-1111" aria-hidden="true" tabindex="-1"></a>Here, I will try to recreate the line graph shown in the coursebook.</span>
<span id="cb385-1112"><a href="#cb385-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1113"><a href="#cb385-1113" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 8.1.1b}</span></span>
<span id="cb385-1114"><a href="#cb385-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1115"><a href="#cb385-1115" aria-hidden="true" tabindex="-1"></a><span class="in"># Here I select from day 1 to 6 because the graph in the coursebook starts from</span></span>
<span id="cb385-1116"><a href="#cb385-1116" aria-hidden="true" tabindex="-1"></a><span class="in"># day 2. I found the graph lies flat if I started from day 2, so need to select</span></span>
<span id="cb385-1117"><a href="#cb385-1117" aria-hidden="true" tabindex="-1"></a><span class="in"># one day before and one day after to show the direction of the graph better</span></span>
<span id="cb385-1118"><a href="#cb385-1118" aria-hidden="true" tabindex="-1"></a><span class="in">KA_weather_subset &lt;- </span></span>
<span id="cb385-1119"><a href="#cb385-1119" aria-hidden="true" tabindex="-1"></a><span class="in">  KA_weather %&gt;% </span></span>
<span id="cb385-1120"><a href="#cb385-1120" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Year == 1998) %&gt;% </span></span>
<span id="cb385-1121"><a href="#cb385-1121" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Month == 1) %&gt;% </span></span>
<span id="cb385-1122"><a href="#cb385-1122" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Day == 1</span></span>
<span id="cb385-1123"><a href="#cb385-1123" aria-hidden="true" tabindex="-1"></a><span class="in">         | Day == 2</span></span>
<span id="cb385-1124"><a href="#cb385-1124" aria-hidden="true" tabindex="-1"></a><span class="in">         | Day == 3</span></span>
<span id="cb385-1125"><a href="#cb385-1125" aria-hidden="true" tabindex="-1"></a><span class="in">         | Day == 4</span></span>
<span id="cb385-1126"><a href="#cb385-1126" aria-hidden="true" tabindex="-1"></a><span class="in">         | Day == 5</span></span>
<span id="cb385-1127"><a href="#cb385-1127" aria-hidden="true" tabindex="-1"></a><span class="in">         | Day == 6</span></span>
<span id="cb385-1128"><a href="#cb385-1128" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb385-1129"><a href="#cb385-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1130"><a href="#cb385-1130" aria-hidden="true" tabindex="-1"></a><span class="in">sh_data &lt;- stack_hourly_temps(KA_weather_subset, latitude = 50.4)</span></span>
<span id="cb385-1131"><a href="#cb385-1131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1132"><a href="#cb385-1132" aria-hidden="true" tabindex="-1"></a><span class="in">sh_data &lt;- sh_data[["hourtemps"]]</span></span>
<span id="cb385-1133"><a href="#cb385-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1134"><a href="#cb385-1134" aria-hidden="true" tabindex="-1"></a><span class="in"># Choose from day 1 to 5 to show x-axis from day 2 to 5</span></span>
<span id="cb385-1135"><a href="#cb385-1135" aria-hidden="true" tabindex="-1"></a><span class="in">sh_data_plot &lt;- sh_data %&gt;%</span></span>
<span id="cb385-1136"><a href="#cb385-1136" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Day &gt;= 1 &amp; Day &lt;= 5) %&gt;%</span></span>
<span id="cb385-1137"><a href="#cb385-1137" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(DateTime = ymd_h(paste(Year, Month, Day, Hour, sep = "-")))</span></span>
<span id="cb385-1138"><a href="#cb385-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1139"><a href="#cb385-1139" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data with DateTime on the x-axis for continuous plotting and use</span></span>
<span id="cb385-1140"><a href="#cb385-1140" aria-hidden="true" tabindex="-1"></a><span class="in"># POSIXct to extend the curve a bit before day 2 and beyond day 5 like the graph</span></span>
<span id="cb385-1141"><a href="#cb385-1141" aria-hidden="true" tabindex="-1"></a><span class="in"># in the coursebook </span></span>
<span id="cb385-1142"><a href="#cb385-1142" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(sh_data_plot, aes(x = DateTime, y = Temp)) +</span></span>
<span id="cb385-1143"><a href="#cb385-1143" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(lwd = 1.5) +</span></span>
<span id="cb385-1144"><a href="#cb385-1144" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_datetime(limits = c(as.POSIXct("1998-01-01 20:00:00"), </span></span>
<span id="cb385-1145"><a href="#cb385-1145" aria-hidden="true" tabindex="-1"></a><span class="in">                              as.POSIXct("1998-01-05 07:00:00"))) +</span></span>
<span id="cb385-1146"><a href="#cb385-1146" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Date", y = "Temperature (°C)") +</span></span>
<span id="cb385-1147"><a href="#cb385-1147" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 10) </span></span>
<span id="cb385-1148"><a href="#cb385-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1149"><a href="#cb385-1149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1150"><a href="#cb385-1150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1151"><a href="#cb385-1151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1152"><a href="#cb385-1152" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1153"><a href="#cb385-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1154"><a href="#cb385-1154" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;8.1.2&lt;/span&gt;&amp;nbsp; Empirical daily temperature curves</span></span>
<span id="cb385-1155"><a href="#cb385-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1156"><a href="#cb385-1156" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1157"><a href="#cb385-1157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1158"><a href="#cb385-1158" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There are some locations where idealized daily temperature curves don’t work, e.g., rugged topography<span class="dv">&amp;mdash;</span> trees maybe shaded for part of the day.</span>
<span id="cb385-1159"><a href="#cb385-1159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1160"><a href="#cb385-1160" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Also the temperature curve in an orchard, which may feature its own microclimate, with shaded and sunny spots, with dew-covered grass or bare ground etc., may not closely resemble the curve drawn up by <span class="co">[</span><span class="ot">Linvill (1990)</span><span class="co">](https://journals.ashs.org/hortsci/view/journals/hortsci/25/1/article-p14.xml)</span></span>
<span id="cb385-1161"><a href="#cb385-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1162"><a href="#cb385-1162" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Addressing the issue with <span class="co">[</span><span class="ot">(Buerkert et al., 2020)</span><span class="co">](https://link.springer.com/article/10.1007/s10584-020-02862-8)</span></span>
<span id="cb385-1163"><a href="#cb385-1163" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Obtain a dataset of hourly temperature data for the location interest (at least a full year, ideally multiple years)</span>
<span id="cb385-1164"><a href="#cb385-1164" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Then, use <span class="in">`Empirical_daily_temperature_curve()`</span>  function to determine the typical pattern of hourly temperatures at this location<span class="dv">&amp;mdash;</span> done separately for each month of the year (could be continuous?)</span>
<span id="cb385-1165"><a href="#cb385-1165" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Then, apply the obtained set of coefficients to a daily dataset from the same location to get a reasonable hourly temperature record. Use <span class="in">`Empirical_hourly_temperatures`</span> function which requires as inputs a set of hourly coefficients, and a daily temperature record (which includes <span class="in">`Tmin`</span> and <span class="in">`Tmax`</span> columns).</span>
<span id="cb385-1166"><a href="#cb385-1166" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-1167"><a href="#cb385-1167" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-1168"><a href="#cb385-1168" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 8.1.2}</span></span>
<span id="cb385-1169"><a href="#cb385-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1170"><a href="#cb385-1170" aria-hidden="true" tabindex="-1"></a><span class="in">empi_curve &lt;- Empirical_daily_temperature_curve(Winters_hours_gaps)</span></span>
<span id="cb385-1171"><a href="#cb385-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1172"><a href="#cb385-1172" aria-hidden="true" tabindex="-1"></a><span class="in"># Show results in a table </span></span>
<span id="cb385-1173"><a href="#cb385-1173" aria-hidden="true" tabindex="-1"></a><span class="in">kable(empi_curve[1:48, ]) %&gt;%</span></span>
<span id="cb385-1174"><a href="#cb385-1174" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-1175"><a href="#cb385-1175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1176"><a href="#cb385-1176" aria-hidden="true" tabindex="-1"></a><span class="in"># Show results in a figure</span></span>
<span id="cb385-1177"><a href="#cb385-1177" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = empi_curve[1:96, ],</span></span>
<span id="cb385-1178"><a href="#cb385-1178" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(Hour, Prediction_coefficient)) +</span></span>
<span id="cb385-1179"><a href="#cb385-1179" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(lwd = 1.3,</span></span>
<span id="cb385-1180"><a href="#cb385-1180" aria-hidden="true" tabindex="-1"></a><span class="in">            col = "red") +</span></span>
<span id="cb385-1181"><a href="#cb385-1181" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(rows = vars(Month)) +</span></span>
<span id="cb385-1182"><a href="#cb385-1182" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Hour of the day") +</span></span>
<span id="cb385-1183"><a href="#cb385-1183" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Prediction coefficient") + # hourly coefficients needed as inputs for step 3</span></span>
<span id="cb385-1184"><a href="#cb385-1184" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 20)</span></span>
<span id="cb385-1185"><a href="#cb385-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1186"><a href="#cb385-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1187"><a href="#cb385-1187" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1188"><a href="#cb385-1188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1189"><a href="#cb385-1189" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1190"><a href="#cb385-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1191"><a href="#cb385-1191" aria-hidden="true" tabindex="-1"></a><span class="fu">##### *`make_all_day_table` function* {.unnumbered}</span></span>
<span id="cb385-1192"><a href="#cb385-1192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1193"><a href="#cb385-1193" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1194"><a href="#cb385-1194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1195"><a href="#cb385-1195" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Fill gaps in daily or hourly temperature records</span>
<span id="cb385-1196"><a href="#cb385-1196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1197"><a href="#cb385-1197" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Summarize hourly records into daily minimum and maximum temperatures</span>
<span id="cb385-1198"><a href="#cb385-1198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1199"><a href="#cb385-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1200"><a href="#cb385-1200" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 8.1.2a}</span></span>
<span id="cb385-1201"><a href="#cb385-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1202"><a href="#cb385-1202" aria-hidden="true" tabindex="-1"></a><span class="in"># Summarize hourly records into daily minimum and maximum temperatures</span></span>
<span id="cb385-1203"><a href="#cb385-1203" aria-hidden="true" tabindex="-1"></a><span class="in">coeffs &lt;- Empirical_daily_temperature_curve(Winters_hours_gaps)</span></span>
<span id="cb385-1204"><a href="#cb385-1204" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_daily &lt;- </span></span>
<span id="cb385-1205"><a href="#cb385-1205" aria-hidden="true" tabindex="-1"></a><span class="in">  make_all_day_table(Winters_hours_gaps, input_timestep = "hour")</span></span>
<span id="cb385-1206"><a href="#cb385-1206" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_hours &lt;- Empirical_hourly_temperatures(Winters_daily, coeffs)</span></span>
<span id="cb385-1207"><a href="#cb385-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1208"><a href="#cb385-1208" aria-hidden="true" tabindex="-1"></a><span class="in"># Simplify data a bit to make it easier to use</span></span>
<span id="cb385-1209"><a href="#cb385-1209" aria-hidden="true" tabindex="-1"></a><span class="in"># require(reshape2)</span></span>
<span id="cb385-1210"><a href="#cb385-1210" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_hours &lt;- Winters_hours[, c("Year", "Month", "Day", "Hour", "Temp")]</span></span>
<span id="cb385-1211"><a href="#cb385-1211" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(Winters_hours)[ncol(Winters_hours)] &lt;- "Temp_empirical"</span></span>
<span id="cb385-1212"><a href="#cb385-1212" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_ideal &lt;-</span></span>
<span id="cb385-1213"><a href="#cb385-1213" aria-hidden="true" tabindex="-1"></a><span class="in">  stack_hourly_temps(Winters_daily, latitude = 38.5)$hourtemps</span></span>
<span id="cb385-1214"><a href="#cb385-1214" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_ideal &lt;- Winters_ideal[, c("Year", "Month", "Day", "Hour", "Temp")]</span></span>
<span id="cb385-1215"><a href="#cb385-1215" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(Winters_ideal)[ncol(Winters_ideal)] &lt;- "Temp_ideal"</span></span>
<span id="cb385-1216"><a href="#cb385-1216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1217"><a href="#cb385-1217" aria-hidden="true" tabindex="-1"></a><span class="in"># Make triangular dataset to understand how it works</span></span>
<span id="cb385-1218"><a href="#cb385-1218" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_triangle &lt;- Winters_daily</span></span>
<span id="cb385-1219"><a href="#cb385-1219" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_triangle[, "Hour"] &lt;- 0</span></span>
<span id="cb385-1220"><a href="#cb385-1220" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_triangle$Hour[nrow(Winters_triangle)] &lt;- 23</span></span>
<span id="cb385-1221"><a href="#cb385-1221" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_triangle[, "Temp"] &lt;- 0</span></span>
<span id="cb385-1222"><a href="#cb385-1222" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_triangle &lt;-</span></span>
<span id="cb385-1223"><a href="#cb385-1223" aria-hidden="true" tabindex="-1"></a><span class="in">  make_all_day_table(Winters_triangle, timestep = "hour")</span></span>
<span id="cb385-1224"><a href="#cb385-1224" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(Winters_triangle)[ncol(Winters_triangle)] &lt;-</span></span>
<span id="cb385-1225"><a href="#cb385-1225" aria-hidden="true" tabindex="-1"></a><span class="in">  "Temp_triangular"</span></span>
<span id="cb385-1226"><a href="#cb385-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1227"><a href="#cb385-1227" aria-hidden="true" tabindex="-1"></a><span class="in"># with the following loop, we fill in the daily Tmin and Tmax values for every</span></span>
<span id="cb385-1228"><a href="#cb385-1228" aria-hidden="true" tabindex="-1"></a><span class="in"># hour of the dataset</span></span>
<span id="cb385-1229"><a href="#cb385-1229" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 2:nrow(Winters_triangle))</span></span>
<span id="cb385-1230"><a href="#cb385-1230" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb385-1231"><a href="#cb385-1231" aria-hidden="true" tabindex="-1"></a><span class="in">  if (is.na(Winters_triangle$Tmin[i]))</span></span>
<span id="cb385-1232"><a href="#cb385-1232" aria-hidden="true" tabindex="-1"></a><span class="in">    Winters_triangle$Tmin[i] &lt;- Winters_triangle$Tmin[i - 1]</span></span>
<span id="cb385-1233"><a href="#cb385-1233" aria-hidden="true" tabindex="-1"></a><span class="in">  if (is.na(Winters_triangle$Tmax[i]))</span></span>
<span id="cb385-1234"><a href="#cb385-1234" aria-hidden="true" tabindex="-1"></a><span class="in">    Winters_triangle$Tmax[i] &lt;- Winters_triangle$Tmax[i - 1]</span></span>
<span id="cb385-1235"><a href="#cb385-1235" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-1236"><a href="#cb385-1236" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_triangle$Temp_triangular &lt;- NA</span></span>
<span id="cb385-1237"><a href="#cb385-1237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1238"><a href="#cb385-1238" aria-hidden="true" tabindex="-1"></a><span class="in"># now we assign the daily Tmin value to the 6th hour of every day</span></span>
<span id="cb385-1239"><a href="#cb385-1239" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_triangle$Temp_triangular[which(Winters_triangle$Hour == 6)] &lt;-</span></span>
<span id="cb385-1240"><a href="#cb385-1240" aria-hidden="true" tabindex="-1"></a><span class="in">  Winters_triangle$Tmin[which(Winters_triangle$Hour == 6)]</span></span>
<span id="cb385-1241"><a href="#cb385-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1242"><a href="#cb385-1242" aria-hidden="true" tabindex="-1"></a><span class="in"># we also assign the daily Tmax value to the 18th hour of every day</span></span>
<span id="cb385-1243"><a href="#cb385-1243" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_triangle$Temp_triangular[which(Winters_triangle$Hour == 18)] &lt;-</span></span>
<span id="cb385-1244"><a href="#cb385-1244" aria-hidden="true" tabindex="-1"></a><span class="in">  Winters_triangle$Tmax[which(Winters_triangle$Hour == 18)]</span></span>
<span id="cb385-1245"><a href="#cb385-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1246"><a href="#cb385-1246" aria-hidden="true" tabindex="-1"></a><span class="in"># in the following step, we use the chillR function "interpolate_gaps"</span></span>
<span id="cb385-1247"><a href="#cb385-1247" aria-hidden="true" tabindex="-1"></a><span class="in"># to fill in all the gaps in the hourly record with straight lines</span></span>
<span id="cb385-1248"><a href="#cb385-1248" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_triangle$Temp_triangular &lt;-</span></span>
<span id="cb385-1249"><a href="#cb385-1249" aria-hidden="true" tabindex="-1"></a><span class="in">  interpolate_gaps(Winters_triangle$Temp_triangular)$interp</span></span>
<span id="cb385-1250"><a href="#cb385-1250" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_triangle &lt;-</span></span>
<span id="cb385-1251"><a href="#cb385-1251" aria-hidden="true" tabindex="-1"></a><span class="in">  Winters_triangle[, c("Year", "Month", "Day", "Hour", "Temp_triangular")]</span></span>
<span id="cb385-1252"><a href="#cb385-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1253"><a href="#cb385-1253" aria-hidden="true" tabindex="-1"></a><span class="in"># Now, merge all these into data.frames to display them easily</span></span>
<span id="cb385-1254"><a href="#cb385-1254" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_temps &lt;-</span></span>
<span id="cb385-1255"><a href="#cb385-1255" aria-hidden="true" tabindex="-1"></a><span class="in">  merge(Winters_hours_gaps,</span></span>
<span id="cb385-1256"><a href="#cb385-1256" aria-hidden="true" tabindex="-1"></a><span class="in">        Winters_hours,</span></span>
<span id="cb385-1257"><a href="#cb385-1257" aria-hidden="true" tabindex="-1"></a><span class="in">        by = c("Year", "Month", "Day", "Hour"))</span></span>
<span id="cb385-1258"><a href="#cb385-1258" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_temps &lt;-</span></span>
<span id="cb385-1259"><a href="#cb385-1259" aria-hidden="true" tabindex="-1"></a><span class="in">  merge(Winters_temps,</span></span>
<span id="cb385-1260"><a href="#cb385-1260" aria-hidden="true" tabindex="-1"></a><span class="in">        Winters_triangle,</span></span>
<span id="cb385-1261"><a href="#cb385-1261" aria-hidden="true" tabindex="-1"></a><span class="in">        by = c("Year", "Month", "Day", "Hour"))</span></span>
<span id="cb385-1262"><a href="#cb385-1262" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_temps &lt;-</span></span>
<span id="cb385-1263"><a href="#cb385-1263" aria-hidden="true" tabindex="-1"></a><span class="in">  merge(Winters_temps,</span></span>
<span id="cb385-1264"><a href="#cb385-1264" aria-hidden="true" tabindex="-1"></a><span class="in">        Winters_ideal,</span></span>
<span id="cb385-1265"><a href="#cb385-1265" aria-hidden="true" tabindex="-1"></a><span class="in">        by = c("Year", "Month", "Day", "Hour"))</span></span>
<span id="cb385-1266"><a href="#cb385-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1267"><a href="#cb385-1267" aria-hidden="true" tabindex="-1"></a><span class="in"># Now we have a dataset with the observed temperatures and the three </span></span>
<span id="cb385-1268"><a href="#cb385-1268" aria-hidden="true" tabindex="-1"></a><span class="in"># approximations (triangular, idealized curve and empirical curve). </span></span>
<span id="cb385-1269"><a href="#cb385-1269" aria-hidden="true" tabindex="-1"></a><span class="in"># To plot this effectively, let’s convert the Year, Month, Day and Hour columns </span></span>
<span id="cb385-1270"><a href="#cb385-1270" aria-hidden="true" tabindex="-1"></a><span class="in"># into R’s date format (using ISOdate) and reorganize the data.frame a bit.</span></span>
<span id="cb385-1271"><a href="#cb385-1271" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_temps[, "DATE"] &lt;-</span></span>
<span id="cb385-1272"><a href="#cb385-1272" aria-hidden="true" tabindex="-1"></a><span class="in">  ISOdate(Winters_temps$Year,</span></span>
<span id="cb385-1273"><a href="#cb385-1273" aria-hidden="true" tabindex="-1"></a><span class="in">          Winters_temps$Month,</span></span>
<span id="cb385-1274"><a href="#cb385-1274" aria-hidden="true" tabindex="-1"></a><span class="in">          Winters_temps$Day,</span></span>
<span id="cb385-1275"><a href="#cb385-1275" aria-hidden="true" tabindex="-1"></a><span class="in">          Winters_temps$Hour)</span></span>
<span id="cb385-1276"><a href="#cb385-1276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1277"><a href="#cb385-1277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1278"><a href="#cb385-1278" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_temps_to_plot &lt;-</span></span>
<span id="cb385-1279"><a href="#cb385-1279" aria-hidden="true" tabindex="-1"></a><span class="in">  Winters_temps[, c("DATE",</span></span>
<span id="cb385-1280"><a href="#cb385-1280" aria-hidden="true" tabindex="-1"></a><span class="in">                    "Temp",</span></span>
<span id="cb385-1281"><a href="#cb385-1281" aria-hidden="true" tabindex="-1"></a><span class="in">                    "Temp_empirical",</span></span>
<span id="cb385-1282"><a href="#cb385-1282" aria-hidden="true" tabindex="-1"></a><span class="in">                    "Temp_triangular",</span></span>
<span id="cb385-1283"><a href="#cb385-1283" aria-hidden="true" tabindex="-1"></a><span class="in">                    "Temp_ideal")]</span></span>
<span id="cb385-1284"><a href="#cb385-1284" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_temps_to_plot &lt;- Winters_temps_to_plot[100:200, ]</span></span>
<span id="cb385-1285"><a href="#cb385-1285" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_temps_to_plot &lt;- pivot_longer(Winters_temps_to_plot, cols=Temp:Temp_ideal)</span></span>
<span id="cb385-1286"><a href="#cb385-1286" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(Winters_temps_to_plot) &lt;- c("DATE", "Method", "Temperature")</span></span>
<span id="cb385-1287"><a href="#cb385-1287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1288"><a href="#cb385-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1289"><a href="#cb385-1289" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = Winters_temps_to_plot, aes(DATE, Temperature, colour = Method)) +</span></span>
<span id="cb385-1290"><a href="#cb385-1290" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(lwd = 1.3) + ylab("Temperature (°C)") + xlab("Date")</span></span>
<span id="cb385-1291"><a href="#cb385-1291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1292"><a href="#cb385-1292" aria-hidden="true" tabindex="-1"></a><span class="in"># This plots shows that the triangular curve is quite far off the mark. </span></span>
<span id="cb385-1293"><a href="#cb385-1293" aria-hidden="true" tabindex="-1"></a><span class="in"># Temp_empirical and Temp_ideal look pretty similar and are hard to distinguish.</span></span>
<span id="cb385-1294"><a href="#cb385-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1295"><a href="#cb385-1295" aria-hidden="true" tabindex="-1"></a><span class="in"># Use the `Root Mean Square Error` function-- useful for quantifying the </span></span>
<span id="cb385-1296"><a href="#cb385-1296" aria-hidden="true" tabindex="-1"></a><span class="in"># correspondence between predicted and observed values-- to compare these curves</span></span>
<span id="cb385-1297"><a href="#cb385-1297" aria-hidden="true" tabindex="-1"></a><span class="in"># a bit more thoroughly by computing</span></span>
<span id="cb385-1298"><a href="#cb385-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1299"><a href="#cb385-1299" aria-hidden="true" tabindex="-1"></a><span class="in"># here's the RMSE for the triangular method:</span></span>
<span id="cb385-1300"><a href="#cb385-1300" aria-hidden="true" tabindex="-1"></a><span class="in">chillR::RMSEP(Winters_temps$Temp_triangular, Winters_temps$Temp)</span></span>
<span id="cb385-1301"><a href="#cb385-1301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1302"><a href="#cb385-1302" aria-hidden="true" tabindex="-1"></a><span class="in"># here's the RMSE for the idealized-curve method:</span></span>
<span id="cb385-1303"><a href="#cb385-1303" aria-hidden="true" tabindex="-1"></a><span class="in">chillR::RMSEP(Winters_temps$Temp_ideal, Winters_temps$Temp)</span></span>
<span id="cb385-1304"><a href="#cb385-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1305"><a href="#cb385-1305" aria-hidden="true" tabindex="-1"></a><span class="in"># and here's the RMSE for the empirical-curve method:</span></span>
<span id="cb385-1306"><a href="#cb385-1306" aria-hidden="true" tabindex="-1"></a><span class="in">chillR::RMSEP(Winters_temps$Temp_empirical, Winters_temps$Temp)</span></span>
<span id="cb385-1307"><a href="#cb385-1307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1308"><a href="#cb385-1308" aria-hidden="true" tabindex="-1"></a><span class="in"># RMSE of 4.7 for the triangular method, an RMSE of 1.63 for the </span></span>
<span id="cb385-1309"><a href="#cb385-1309" aria-hidden="true" tabindex="-1"></a><span class="in"># idealized-curve method, and an RMSE of 1.41 for the empirical-curve method.</span></span>
<span id="cb385-1310"><a href="#cb385-1310" aria-hidden="true" tabindex="-1"></a><span class="in"># Since this metric should be low, we see that calibrating the prediction </span></span>
<span id="cb385-1311"><a href="#cb385-1311" aria-hidden="true" tabindex="-1"></a><span class="in"># function with observed hourly data brought some advantages, in particular </span></span>
<span id="cb385-1312"><a href="#cb385-1312" aria-hidden="true" tabindex="-1"></a><span class="in"># when compared with the triangular method.</span></span>
<span id="cb385-1313"><a href="#cb385-1313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1314"><a href="#cb385-1314" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1315"><a href="#cb385-1315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1316"><a href="#cb385-1316" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1317"><a href="#cb385-1317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1318"><a href="#cb385-1318" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;8.2&lt;/span&gt;&amp;nbsp; Exercise on hourly temperatures</span></span>
<span id="cb385-1319"><a href="#cb385-1319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1320"><a href="#cb385-1320" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1321"><a href="#cb385-1321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1322"><a href="#cb385-1322" aria-hidden="true" tabindex="-1"></a>***1. Choose a location of interest, find out its latitude and produce plots of daily sunrise, sunset and daylength.***</span>
<span id="cb385-1323"><a href="#cb385-1323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1324"><a href="#cb385-1324" aria-hidden="true" tabindex="-1"></a>My location of interest is M<span class="dv">&amp;ouml;</span>ssigen, an orchard town in Baden-W<span class="dv">&amp;uuml;</span>rttemberg, which is a state that ranks highest among regions for cultivation of top fruits, according to the <span class="co">[</span><span class="ot">report</span><span class="co">](https://www.destatis.de/EN/Themes/Economic-Sectors-Enterprises/Agriculture-Forestry-Fisheries/Fruit-Vegetables-Horticulture/Tables/2-2-area-of-tree-fruits-laender.html)</span> by Statistisches Bundesmat. The GPS coordinates of M<span class="dv">&amp;ouml;</span>ssigen are 48.40567° N latitude, and 9.05419° E longitude, as stated in <span class="co">[</span><span class="ot">database.earth</span><span class="co">](https://database.earth/countries/germany/regions/baden-wurttemberg/cities/mossingen)</span>.</span>
<span id="cb385-1325"><a href="#cb385-1325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1326"><a href="#cb385-1326" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 8.2.1}</span></span>
<span id="cb385-1327"><a href="#cb385-1327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1328"><a href="#cb385-1328" aria-hidden="true" tabindex="-1"></a><span class="in"># Compute daylength</span></span>
<span id="cb385-1329"><a href="#cb385-1329" aria-hidden="true" tabindex="-1"></a><span class="in">MS_days &lt;- daylength(latitude = 48.4, JDay = 1:365)</span></span>
<span id="cb385-1330"><a href="#cb385-1330" aria-hidden="true" tabindex="-1"></a><span class="in">MS_days_df &lt;- </span></span>
<span id="cb385-1331"><a href="#cb385-1331" aria-hidden="true" tabindex="-1"></a><span class="in">  data.frame(</span></span>
<span id="cb385-1332"><a href="#cb385-1332" aria-hidden="true" tabindex="-1"></a><span class="in">    JDay = 1:365,</span></span>
<span id="cb385-1333"><a href="#cb385-1333" aria-hidden="true" tabindex="-1"></a><span class="in">    Sunrise = MS_days$Sunrise,</span></span>
<span id="cb385-1334"><a href="#cb385-1334" aria-hidden="true" tabindex="-1"></a><span class="in">    Sunset = MS_days$Sunset,</span></span>
<span id="cb385-1335"><a href="#cb385-1335" aria-hidden="true" tabindex="-1"></a><span class="in">    Daylength = MS_days$Daylength</span></span>
<span id="cb385-1336"><a href="#cb385-1336" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb385-1337"><a href="#cb385-1337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1338"><a href="#cb385-1338" aria-hidden="true" tabindex="-1"></a><span class="in"># Convert data.frame for ggplot</span></span>
<span id="cb385-1339"><a href="#cb385-1339" aria-hidden="true" tabindex="-1"></a><span class="in">MS_days_df &lt;- pivot_longer(MS_days_df, cols = c(Sunrise:Daylength))</span></span>
<span id="cb385-1340"><a href="#cb385-1340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1341"><a href="#cb385-1341" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(MS_days_df, aes(JDay, value)) +</span></span>
<span id="cb385-1342"><a href="#cb385-1342" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(lwd = 1.5) +</span></span>
<span id="cb385-1343"><a href="#cb385-1343" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(cols = vars(name)) +</span></span>
<span id="cb385-1344"><a href="#cb385-1344" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Time of Day / Daylength (Hours)") +</span></span>
<span id="cb385-1345"><a href="#cb385-1345" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 20)</span></span>
<span id="cb385-1346"><a href="#cb385-1346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1347"><a href="#cb385-1347" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1348"><a href="#cb385-1348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1349"><a href="#cb385-1349" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1350"><a href="#cb385-1350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1351"><a href="#cb385-1351" aria-hidden="true" tabindex="-1"></a>***2. Produce an hourly dataset, based on idealized daily curves, for the `KA_weather` dataset (included in `chillR`)***</span>
<span id="cb385-1352"><a href="#cb385-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1353"><a href="#cb385-1353" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 8.2.2}</span></span>
<span id="cb385-1354"><a href="#cb385-1354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1355"><a href="#cb385-1355" aria-hidden="true" tabindex="-1"></a><span class="in"># I want to produce an hourly dataset for 4 October 1998</span></span>
<span id="cb385-1356"><a href="#cb385-1356" aria-hidden="true" tabindex="-1"></a><span class="in"># Chose values for one day before and one day after as they can impact the curve</span></span>
<span id="cb385-1357"><a href="#cb385-1357" aria-hidden="true" tabindex="-1"></a><span class="in">KA_weather_subset &lt;- </span></span>
<span id="cb385-1358"><a href="#cb385-1358" aria-hidden="true" tabindex="-1"></a><span class="in">  KA_weather %&gt;% </span></span>
<span id="cb385-1359"><a href="#cb385-1359" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Year == 1998) %&gt;% </span></span>
<span id="cb385-1360"><a href="#cb385-1360" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Month == 10) %&gt;% </span></span>
<span id="cb385-1361"><a href="#cb385-1361" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Day == 3</span></span>
<span id="cb385-1362"><a href="#cb385-1362" aria-hidden="true" tabindex="-1"></a><span class="in">         | Day == 4</span></span>
<span id="cb385-1363"><a href="#cb385-1363" aria-hidden="true" tabindex="-1"></a><span class="in">         | Day == 5</span></span>
<span id="cb385-1364"><a href="#cb385-1364" aria-hidden="true" tabindex="-1"></a><span class="in">         )</span></span>
<span id="cb385-1365"><a href="#cb385-1365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1366"><a href="#cb385-1366" aria-hidden="true" tabindex="-1"></a><span class="in"># Produce hourly dataset</span></span>
<span id="cb385-1367"><a href="#cb385-1367" aria-hidden="true" tabindex="-1"></a><span class="in">MS_sh_data &lt;- stack_hourly_temps(KA_weather_subset, latitude = 48.4)</span></span>
<span id="cb385-1368"><a href="#cb385-1368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1369"><a href="#cb385-1369" aria-hidden="true" tabindex="-1"></a><span class="in"># Select the hourtemps output only </span></span>
<span id="cb385-1370"><a href="#cb385-1370" aria-hidden="true" tabindex="-1"></a><span class="in">MS_sh_data &lt;- MS_sh_data[["hourtemps"]]</span></span>
<span id="cb385-1371"><a href="#cb385-1371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1372"><a href="#cb385-1372" aria-hidden="true" tabindex="-1"></a><span class="in"># Filter for day 4</span></span>
<span id="cb385-1373"><a href="#cb385-1373" aria-hidden="true" tabindex="-1"></a><span class="in">kable(MS_sh_data %&gt;% filter(Day == 4)) %&gt;%</span></span>
<span id="cb385-1374"><a href="#cb385-1374" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-1375"><a href="#cb385-1375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1376"><a href="#cb385-1376" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1377"><a href="#cb385-1377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1378"><a href="#cb385-1378" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1379"><a href="#cb385-1379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1380"><a href="#cb385-1380" aria-hidden="true" tabindex="-1"></a>***3. Produce empirical temperature curve parameters for the `Winters_hours_gaps` dataset, and use them to predict hourly values from daily temperatures (this is very similar to the example above, but please make sure you understand what’s going on)***</span>
<span id="cb385-1381"><a href="#cb385-1381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1382"><a href="#cb385-1382" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 8.2.3}</span></span>
<span id="cb385-1383"><a href="#cb385-1383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1384"><a href="#cb385-1384" aria-hidden="true" tabindex="-1"></a><span class="in"># Produce empirical daily temperature coefficients from observed hourly data</span></span>
<span id="cb385-1385"><a href="#cb385-1385" aria-hidden="true" tabindex="-1"></a><span class="in">WH_empi_temp_coeff &lt;- Empirical_daily_temperature_curve(Winters_hours_gaps)</span></span>
<span id="cb385-1386"><a href="#cb385-1386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1387"><a href="#cb385-1387" aria-hidden="true" tabindex="-1"></a><span class="in"># Fill the missing gaps in hourly data of daily records</span></span>
<span id="cb385-1388"><a href="#cb385-1388" aria-hidden="true" tabindex="-1"></a><span class="in">WH_daily &lt;- make_all_day_table(Winters_hours_gaps, input_timestep = "hour")</span></span>
<span id="cb385-1389"><a href="#cb385-1389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1390"><a href="#cb385-1390" aria-hidden="true" tabindex="-1"></a><span class="in"># Predict hourly temperatures from daily dataset using the obtained coefficients</span></span>
<span id="cb385-1391"><a href="#cb385-1391" aria-hidden="true" tabindex="-1"></a><span class="in">WH_hours &lt;- Empirical_hourly_temperatures(WH_daily, WH_empi_temp_coeff)</span></span>
<span id="cb385-1392"><a href="#cb385-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1393"><a href="#cb385-1393" aria-hidden="true" tabindex="-1"></a><span class="in"># Select necessary columns from WH_hours dataset</span></span>
<span id="cb385-1394"><a href="#cb385-1394" aria-hidden="true" tabindex="-1"></a><span class="in">WH_hours &lt;- WH_hours[, c("Year", "Month", "Day", "Hour", "Temp")]</span></span>
<span id="cb385-1395"><a href="#cb385-1395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1396"><a href="#cb385-1396" aria-hidden="true" tabindex="-1"></a><span class="in"># Rename the last column "Temp" to "Temp_empirical"</span></span>
<span id="cb385-1397"><a href="#cb385-1397" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(WH_hours)[ncol(WH_hours)] &lt;- "Temp_empirical"</span></span>
<span id="cb385-1398"><a href="#cb385-1398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1399"><a href="#cb385-1399" aria-hidden="true" tabindex="-1"></a><span class="in"># Merge predicted WH_hours with Winter_hours_gaps dataset to display</span></span>
<span id="cb385-1400"><a href="#cb385-1400" aria-hidden="true" tabindex="-1"></a><span class="in"># observed vs. approximated temperatures</span></span>
<span id="cb385-1401"><a href="#cb385-1401" aria-hidden="true" tabindex="-1"></a><span class="in">WH_temps &lt;- merge(Winters_hours_gaps,</span></span>
<span id="cb385-1402"><a href="#cb385-1402" aria-hidden="true" tabindex="-1"></a><span class="in">                  WH_hours,</span></span>
<span id="cb385-1403"><a href="#cb385-1403" aria-hidden="true" tabindex="-1"></a><span class="in">                  by = c("Year", "Month", "Day", "Hour"))</span></span>
<span id="cb385-1404"><a href="#cb385-1404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1405"><a href="#cb385-1405" aria-hidden="true" tabindex="-1"></a><span class="in"># Add a new "DATE" column with R's date format for plotting purpose</span></span>
<span id="cb385-1406"><a href="#cb385-1406" aria-hidden="true" tabindex="-1"></a><span class="in">WH_temps[, "DATE"] &lt;- ISOdate(WH_temps$Year,</span></span>
<span id="cb385-1407"><a href="#cb385-1407" aria-hidden="true" tabindex="-1"></a><span class="in">                              WH_temps$Month,</span></span>
<span id="cb385-1408"><a href="#cb385-1408" aria-hidden="true" tabindex="-1"></a><span class="in">                              WH_temps$Day,</span></span>
<span id="cb385-1409"><a href="#cb385-1409" aria-hidden="true" tabindex="-1"></a><span class="in">                              WH_temps$Hour)</span></span>
<span id="cb385-1410"><a href="#cb385-1410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1411"><a href="#cb385-1411" aria-hidden="true" tabindex="-1"></a><span class="in"># Select the necessary columns and add into a new data.frame</span></span>
<span id="cb385-1412"><a href="#cb385-1412" aria-hidden="true" tabindex="-1"></a><span class="in">WH_temps_to_plot &lt;- WH_temps[, c("DATE",</span></span>
<span id="cb385-1413"><a href="#cb385-1413" aria-hidden="true" tabindex="-1"></a><span class="in">                                 "Temp",</span></span>
<span id="cb385-1414"><a href="#cb385-1414" aria-hidden="true" tabindex="-1"></a><span class="in">                                 "Temp_empirical")]</span></span>
<span id="cb385-1415"><a href="#cb385-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1416"><a href="#cb385-1416" aria-hidden="true" tabindex="-1"></a><span class="in"># Specify rows 300-400 (October 20-25) to plot</span></span>
<span id="cb385-1417"><a href="#cb385-1417" aria-hidden="true" tabindex="-1"></a><span class="in">WH_temps_to_plot &lt;- WH_temps_to_plot[300:400, ]</span></span>
<span id="cb385-1418"><a href="#cb385-1418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1419"><a href="#cb385-1419" aria-hidden="true" tabindex="-1"></a><span class="in"># Stack columns into rows for plotting</span></span>
<span id="cb385-1420"><a href="#cb385-1420" aria-hidden="true" tabindex="-1"></a><span class="in">WH_temps_to_plot &lt;- pivot_longer(WH_temps_to_plot, cols = Temp:Temp_empirical)</span></span>
<span id="cb385-1421"><a href="#cb385-1421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1422"><a href="#cb385-1422" aria-hidden="true" tabindex="-1"></a><span class="in"># Rename columns for graph display </span></span>
<span id="cb385-1423"><a href="#cb385-1423" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(WH_temps_to_plot) &lt;- c("DATE", "Method", "Temperature")</span></span>
<span id="cb385-1424"><a href="#cb385-1424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1425"><a href="#cb385-1425" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate plot</span></span>
<span id="cb385-1426"><a href="#cb385-1426" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = WH_temps_to_plot, aes(DATE, Temperature, colour = Method)) +</span></span>
<span id="cb385-1427"><a href="#cb385-1427" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(lwd = 1.3) + ylab("Temperature (°C)") + xlab("Date")</span></span>
<span id="cb385-1428"><a href="#cb385-1428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1429"><a href="#cb385-1429" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1430"><a href="#cb385-1430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1431"><a href="#cb385-1431" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1432"><a href="#cb385-1432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1433"><a href="#cb385-1433" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 9: Some useful tools in R</span></span>
<span id="cb385-1434"><a href="#cb385-1434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1435"><a href="#cb385-1435" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;9.1&lt;/span&gt;&amp;nbsp; An evolving language&amp;mdash; and a lifelong learning process</span></span>
<span id="cb385-1436"><a href="#cb385-1436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1437"><a href="#cb385-1437" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1438"><a href="#cb385-1438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1439"><a href="#cb385-1439" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Possible to solve most problems with <span class="in">`base R`</span> functions</span>
<span id="cb385-1440"><a href="#cb385-1440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1441"><a href="#cb385-1441" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1442"><a href="#cb385-1442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1443"><a href="#cb385-1443" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;9.2&lt;/span&gt;&amp;nbsp; The `tidyverse`</span></span>
<span id="cb385-1444"><a href="#cb385-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1445"><a href="#cb385-1445" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1446"><a href="#cb385-1446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1447"><a href="#cb385-1447" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Access the whole collection of the <span class="in">`tidyverse`</span> package <span class="co">[</span><span class="ot">here.</span><span class="co">](https://www.tidyverse.org/)</span></span>
<span id="cb385-1448"><a href="#cb385-1448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1449"><a href="#cb385-1449" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Load <span class="in">`library(tidyverse)`</span> to access the package</span>
<span id="cb385-1450"><a href="#cb385-1450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1451"><a href="#cb385-1451" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1452"><a href="#cb385-1452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1453"><a href="#cb385-1453" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;9.3&lt;/span&gt;&amp;nbsp; The `ggplot2` package</span></span>
<span id="cb385-1454"><a href="#cb385-1454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1455"><a href="#cb385-1455" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1456"><a href="#cb385-1456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1457"><a href="#cb385-1457" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A great introduction to ggplot2 and links to various tutorials etc. can be accessed <span class="co">[</span><span class="ot">here.</span><span class="co">](https://ggplot2.tidyverse.org/)</span></span>
<span id="cb385-1458"><a href="#cb385-1458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1459"><a href="#cb385-1459" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1460"><a href="#cb385-1460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1461"><a href="#cb385-1461" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;9.3&lt;/span&gt;&amp;nbsp; The `tibble` package</span></span>
<span id="cb385-1462"><a href="#cb385-1462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1463"><a href="#cb385-1463" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1464"><a href="#cb385-1464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1465"><a href="#cb385-1465" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A <span class="in">`tibble`</span> is an advanced version of a <span class="in">`data.frame`</span>, which includes several improvements.</span>
<span id="cb385-1466"><a href="#cb385-1466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1467"><a href="#cb385-1467" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A <span class="in">`tibble`</span> doesn’t follow the classic <span class="in">`data.frame`</span> habit of converting strings to factors at times when you don’t expect it.</span>
<span id="cb385-1468"><a href="#cb385-1468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1469"><a href="#cb385-1469" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Read more <span class="co">[</span><span class="ot">here.</span><span class="co">](https://tibble.tidyverse.org/)</span></span>
<span id="cb385-1470"><a href="#cb385-1470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1471"><a href="#cb385-1471" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.3}</span></span>
<span id="cb385-1472"><a href="#cb385-1472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1473"><a href="#cb385-1473" aria-hidden="true" tabindex="-1"></a><span class="in"># Use as_tibble command to create a normal data.frame (or a similar structure)</span></span>
<span id="cb385-1474"><a href="#cb385-1474" aria-hidden="true" tabindex="-1"></a><span class="in">dat &lt;- data.frame(a = c(1, 2, 3),</span></span>
<span id="cb385-1475"><a href="#cb385-1475" aria-hidden="true" tabindex="-1"></a><span class="in">                  b = c(4, 5, 6))</span></span>
<span id="cb385-1476"><a href="#cb385-1476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1477"><a href="#cb385-1477" aria-hidden="true" tabindex="-1"></a><span class="in">d &lt;- as_tibble(dat)</span></span>
<span id="cb385-1478"><a href="#cb385-1478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1479"><a href="#cb385-1479" aria-hidden="true" tabindex="-1"></a><span class="in">d</span></span>
<span id="cb385-1480"><a href="#cb385-1480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1481"><a href="#cb385-1481" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1482"><a href="#cb385-1482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1483"><a href="#cb385-1483" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1484"><a href="#cb385-1484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1485"><a href="#cb385-1485" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;9.5&lt;/span&gt;&amp;nbsp; The `magrittr` package&amp;mdash; pipes</span></span>
<span id="cb385-1486"><a href="#cb385-1486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1487"><a href="#cb385-1487" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1488"><a href="#cb385-1488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1489"><a href="#cb385-1489" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The main thing <span class="in">`magrittr`</span> adds is a structure to organize workflows that are applied to the same dataset. </span>
<span id="cb385-1490"><a href="#cb385-1490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1491"><a href="#cb385-1491" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A data structure such as a <span class="in">`tibble`</span> can be subjected to one or multiple operations organized in a pipe<span class="dv">&amp;mdash;</span> <span class="in">`%&gt;%`</span></span>
<span id="cb385-1492"><a href="#cb385-1492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1493"><a href="#cb385-1493" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>After a pipe, the following function always assumes that the first input to the function is the product received through the pipe.</span>
<span id="cb385-1494"><a href="#cb385-1494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1495"><a href="#cb385-1495" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.5}</span></span>
<span id="cb385-1496"><a href="#cb385-1496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1497"><a href="#cb385-1497" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the sum of all numbers in the tibble "d" created above</span></span>
<span id="cb385-1498"><a href="#cb385-1498" aria-hidden="true" tabindex="-1"></a><span class="in">d %&gt;% sum()</span></span>
<span id="cb385-1499"><a href="#cb385-1499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1500"><a href="#cb385-1500" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1501"><a href="#cb385-1501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1502"><a href="#cb385-1502" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1503"><a href="#cb385-1503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1504"><a href="#cb385-1504" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;9.6&lt;/span&gt;&amp;nbsp; The `tidyr` package</span></span>
<span id="cb385-1505"><a href="#cb385-1505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1506"><a href="#cb385-1506" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1507"><a href="#cb385-1507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1508"><a href="#cb385-1508" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Provides useful functions for organizing data.</span>
<span id="cb385-1509"><a href="#cb385-1509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1510"><a href="#cb385-1510" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.6}</span></span>
<span id="cb385-1511"><a href="#cb385-1511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1512"><a href="#cb385-1512" aria-hidden="true" tabindex="-1"></a><span class="in"># Use KA_weather dataset to see how it works</span></span>
<span id="cb385-1513"><a href="#cb385-1513" aria-hidden="true" tabindex="-1"></a><span class="in">KAw &lt;- as_tibble(KA_weather[1:10, ])</span></span>
<span id="cb385-1514"><a href="#cb385-1514" aria-hidden="true" tabindex="-1"></a><span class="in">KAw</span></span>
<span id="cb385-1515"><a href="#cb385-1515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1516"><a href="#cb385-1516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1517"><a href="#cb385-1517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1518"><a href="#cb385-1518" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1519"><a href="#cb385-1519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1520"><a href="#cb385-1520" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;9.6.1&lt;/span&gt;&amp;nbsp; `pivot_longer`</span></span>
<span id="cb385-1521"><a href="#cb385-1521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1522"><a href="#cb385-1522" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1523"><a href="#cb385-1523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1524"><a href="#cb385-1524" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use <span class="in">`pivot_longer`</span> to transfer data from separate columns into distinct rows.</span>
<span id="cb385-1525"><a href="#cb385-1525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1526"><a href="#cb385-1526" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Stack one row of a column over another row of another column<span class="dv">&amp;mdash;</span> often necessary, for instance, when using <span class="in">`ggplot2`</span> package for plotting data. </span>
<span id="cb385-1527"><a href="#cb385-1527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1528"><a href="#cb385-1528" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`pivot_longer`</span> fulfills a similar function to the <span class="in">`melt`</span> function of the <span class="in">`reshape2`</span> package</span>
<span id="cb385-1529"><a href="#cb385-1529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1530"><a href="#cb385-1530" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.6.1}</span></span>
<span id="cb385-1531"><a href="#cb385-1531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1532"><a href="#cb385-1532" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate a table with one row containing Tmin and one row for Tmax for </span></span>
<span id="cb385-1533"><a href="#cb385-1533" aria-hidden="true" tabindex="-1"></a><span class="in"># each day of the record (with a pipe)</span></span>
<span id="cb385-1534"><a href="#cb385-1534" aria-hidden="true" tabindex="-1"></a><span class="in">KAwlong &lt;- KAw %&gt;% pivot_longer(cols = Tmax:Tmin) # specify column we want to stack up </span></span>
<span id="cb385-1535"><a href="#cb385-1535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1536"><a href="#cb385-1536" aria-hidden="true" tabindex="-1"></a><span class="in">KAwlong</span></span>
<span id="cb385-1537"><a href="#cb385-1537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1538"><a href="#cb385-1538" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1539"><a href="#cb385-1539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1540"><a href="#cb385-1540" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1541"><a href="#cb385-1541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1542"><a href="#cb385-1542" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;9.6.2&lt;/span&gt;&amp;nbsp; `pivot_wider`</span></span>
<span id="cb385-1543"><a href="#cb385-1543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1544"><a href="#cb385-1544" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1545"><a href="#cb385-1545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1546"><a href="#cb385-1546" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We can also do an opposite conversion to the one implemented by <span class="in">`pivot_longer`</span> by using the <span class="in">`pivot_wider`</span> command.</span>
<span id="cb385-1547"><a href="#cb385-1547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1548"><a href="#cb385-1548" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.6.2}</span></span>
<span id="cb385-1549"><a href="#cb385-1549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1550"><a href="#cb385-1550" aria-hidden="true" tabindex="-1"></a><span class="in">KAwwide &lt;- KAwlong %&gt;% pivot_wider(names_from = name) #can work without () `here`</span></span>
<span id="cb385-1551"><a href="#cb385-1551" aria-hidden="true" tabindex="-1"></a><span class="in"># name_from specifies the column that contains new column header</span></span>
<span id="cb385-1552"><a href="#cb385-1552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1553"><a href="#cb385-1553" aria-hidden="true" tabindex="-1"></a><span class="in">KAwwide</span></span>
<span id="cb385-1554"><a href="#cb385-1554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1555"><a href="#cb385-1555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1556"><a href="#cb385-1556" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1557"><a href="#cb385-1557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1558"><a href="#cb385-1558" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1559"><a href="#cb385-1559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1560"><a href="#cb385-1560" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;9.6.3&lt;/span&gt;&amp;nbsp; `select`</span></span>
<span id="cb385-1561"><a href="#cb385-1561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1562"><a href="#cb385-1562" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1563"><a href="#cb385-1563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1564"><a href="#cb385-1564" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`select`</span> function picks out a subset of the columns of a <span class="in">`data.frame`</span> or <span class="in">`tibble`</span>. </span>
<span id="cb385-1565"><a href="#cb385-1565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1566"><a href="#cb385-1566" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.6.3}</span></span>
<span id="cb385-1567"><a href="#cb385-1567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1568"><a href="#cb385-1568" aria-hidden="true" tabindex="-1"></a><span class="in">KAw %&gt;% select(c(Month, Day, Tmax))</span></span>
<span id="cb385-1569"><a href="#cb385-1569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1570"><a href="#cb385-1570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1571"><a href="#cb385-1571" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1572"><a href="#cb385-1572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1573"><a href="#cb385-1573" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1574"><a href="#cb385-1574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1575"><a href="#cb385-1575" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;9.6.4&lt;/span&gt;&amp;nbsp; `filter`</span></span>
<span id="cb385-1576"><a href="#cb385-1576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1577"><a href="#cb385-1577" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1578"><a href="#cb385-1578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1579"><a href="#cb385-1579" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The <span class="in">`filter`</span> function reduces a <span class="in">`data.frame`</span> or <span class="in">`tibble`</span> to just the rows that fulfill certain conditions. </span>
<span id="cb385-1580"><a href="#cb385-1580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1581"><a href="#cb385-1581" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.6.4}</span></span>
<span id="cb385-1582"><a href="#cb385-1582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1583"><a href="#cb385-1583" aria-hidden="true" tabindex="-1"></a><span class="in">KAw %&gt;% filter(Tmax &gt; 10)</span></span>
<span id="cb385-1584"><a href="#cb385-1584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1585"><a href="#cb385-1585" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1586"><a href="#cb385-1586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1587"><a href="#cb385-1587" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1588"><a href="#cb385-1588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1589"><a href="#cb385-1589" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;9.6.5&lt;/span&gt;&amp;nbsp; `mutate`</span></span>
<span id="cb385-1590"><a href="#cb385-1590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1591"><a href="#cb385-1591" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1592"><a href="#cb385-1592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1593"><a href="#cb385-1593" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The <span class="in">`mutate`</span> function creates, modifies, and deletes columns from a <span class="in">`data.frame`</span> or <span class="in">`tibble`</span>. </span>
<span id="cb385-1594"><a href="#cb385-1594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1595"><a href="#cb385-1595" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Check out <span class="co">[</span><span class="ot">help file</span><span class="co">](https://dplyr.tidyverse.org/reference/mutate.html)</span> for more options that can be done with <span class="in">`mutate`</span>. </span>
<span id="cb385-1596"><a href="#cb385-1596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1597"><a href="#cb385-1597" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.6.5}</span></span>
<span id="cb385-1598"><a href="#cb385-1598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1599"><a href="#cb385-1599" aria-hidden="true" tabindex="-1"></a><span class="in"># Create two new columns that contain Tmin and Tmax in Kelvin </span></span>
<span id="cb385-1600"><a href="#cb385-1600" aria-hidden="true" tabindex="-1"></a><span class="in">KAw_K &lt;- KAw %&gt;% mutate(Tmax_K = Tmax + 273.5, Tmin_K = Tmin + 273.15)</span></span>
<span id="cb385-1601"><a href="#cb385-1601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1602"><a href="#cb385-1602" aria-hidden="true" tabindex="-1"></a><span class="in">KAw_K</span></span>
<span id="cb385-1603"><a href="#cb385-1603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1604"><a href="#cb385-1604" aria-hidden="true" tabindex="-1"></a><span class="in"># Delete these columns again, by setting them to NULL</span></span>
<span id="cb385-1605"><a href="#cb385-1605" aria-hidden="true" tabindex="-1"></a><span class="in">KAw_K %&gt;% mutate(Tmin_K = NULL, Tmax_K = NULL)</span></span>
<span id="cb385-1606"><a href="#cb385-1606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1607"><a href="#cb385-1607" aria-hidden="true" tabindex="-1"></a><span class="in"># Replace the original temperature values directly with the Kelvin values.</span></span>
<span id="cb385-1608"><a href="#cb385-1608" aria-hidden="true" tabindex="-1"></a><span class="in">KAw %&gt;% mutate(Tmin = Tmin + 273.15, Tmax = Tmax + 273.15)</span></span>
<span id="cb385-1609"><a href="#cb385-1609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1610"><a href="#cb385-1610" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1611"><a href="#cb385-1611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1612"><a href="#cb385-1612" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1613"><a href="#cb385-1613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1614"><a href="#cb385-1614" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;9.6.6&lt;/span&gt;&amp;nbsp; `arrange`</span></span>
<span id="cb385-1615"><a href="#cb385-1615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1616"><a href="#cb385-1616" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1617"><a href="#cb385-1617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1618"><a href="#cb385-1618" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`arrange`</span> is a function to sort data in <span class="in">`data.frames`</span> or <span class="in">`tibbles`</span>. </span>
<span id="cb385-1619"><a href="#cb385-1619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1620"><a href="#cb385-1620" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.6.6}</span></span>
<span id="cb385-1621"><a href="#cb385-1621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1622"><a href="#cb385-1622" aria-hidden="true" tabindex="-1"></a><span class="in">KAw %&gt;% arrange(Tmax, Tmin)</span></span>
<span id="cb385-1623"><a href="#cb385-1623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1624"><a href="#cb385-1624" aria-hidden="true" tabindex="-1"></a><span class="in"># Sort in descending order</span></span>
<span id="cb385-1625"><a href="#cb385-1625" aria-hidden="true" tabindex="-1"></a><span class="in">KAw %&gt;% arrange(desc(Tmax), Tmin)</span></span>
<span id="cb385-1626"><a href="#cb385-1626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1627"><a href="#cb385-1627" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1628"><a href="#cb385-1628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1629"><a href="#cb385-1629" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1630"><a href="#cb385-1630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1631"><a href="#cb385-1631" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;9.7&lt;/span&gt;&amp;nbsp; Loops</span></span>
<span id="cb385-1632"><a href="#cb385-1632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1633"><a href="#cb385-1633" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1634"><a href="#cb385-1634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1635"><a href="#cb385-1635" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A loop repeats the same operation many times without having to explicitly retype (or copy and paste) the code. </span>
<span id="cb385-1636"><a href="#cb385-1636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1637"><a href="#cb385-1637" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>More importantly, it also runs the same code while introducing certain modifications in every run.</span>
<span id="cb385-1638"><a href="#cb385-1638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1639"><a href="#cb385-1639" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Two basic types of loops: <span class="in">`for`</span> loops and <span class="in">`while`</span> loops<span class="dv">&amp;mdash;</span> both functions need instructions that regulate the number of runs, as well as instructions on what to do in each of the runs.</span>
<span id="cb385-1640"><a href="#cb385-1640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1641"><a href="#cb385-1641" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Read detailed explanations on loops <span class="co">[</span><span class="ot">here.</span><span class="co">](https://intro2r.com/loops.html)</span></span>
<span id="cb385-1642"><a href="#cb385-1642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1643"><a href="#cb385-1643" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1644"><a href="#cb385-1644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1645"><a href="#cb385-1645" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;9.7.1&lt;/span&gt;&amp;nbsp; `for` loops</span></span>
<span id="cb385-1646"><a href="#cb385-1646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1647"><a href="#cb385-1647" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1648"><a href="#cb385-1648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1649"><a href="#cb385-1649" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A <span class="in">`for`</span> loop requires explicit instructions on how many times the code within the loop should be run. </span>
<span id="cb385-1650"><a href="#cb385-1650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1651"><a href="#cb385-1651" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This is usually specified by providing a vector or list of elements and instructing R to run the code for each of these elements. </span>
<span id="cb385-1652"><a href="#cb385-1652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1653"><a href="#cb385-1653" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This means that the number of times the code is run equals the number of elements in the vector or list.</span>
<span id="cb385-1654"><a href="#cb385-1654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1655"><a href="#cb385-1655" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We need a *counter* (often called <span class="in">`i`</span> but can also be any other variable name) to keep track of which run we’re in.</span>
<span id="cb385-1656"><a href="#cb385-1656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1657"><a href="#cb385-1657" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The *counter* doesn’t have to be numeric, but it can assume many other shapes, e.g. that of a string. </span>
<span id="cb385-1658"><a href="#cb385-1658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1659"><a href="#cb385-1659" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.7.1}</span></span>
<span id="cb385-1660"><a href="#cb385-1660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1661"><a href="#cb385-1661" aria-hidden="true" tabindex="-1"></a><span class="in"># Run the code three times with for command</span></span>
<span id="cb385-1662"><a href="#cb385-1662" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:3) print("Hello")</span></span>
<span id="cb385-1663"><a href="#cb385-1663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1664"><a href="#cb385-1664" aria-hidden="true" tabindex="-1"></a><span class="in"># Make the structure more complex by providing multiple lines of code within</span></span>
<span id="cb385-1665"><a href="#cb385-1665" aria-hidden="true" tabindex="-1"></a><span class="in"># winged brackets</span></span>
<span id="cb385-1666"><a href="#cb385-1666" aria-hidden="true" tabindex="-1"></a><span class="in">addition &lt;- 1</span></span>
<span id="cb385-1667"><a href="#cb385-1667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1668"><a href="#cb385-1668" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:3) # operation is embedded in a loop</span></span>
<span id="cb385-1669"><a href="#cb385-1669" aria-hidden="true" tabindex="-1"></a><span class="in">{ </span></span>
<span id="cb385-1670"><a href="#cb385-1670" aria-hidden="true" tabindex="-1"></a><span class="in">  addition &lt;- addition + 1</span></span>
<span id="cb385-1671"><a href="#cb385-1671" aria-hidden="true" tabindex="-1"></a><span class="in">  print(addition) # need to instruct R to print value</span></span>
<span id="cb385-1672"><a href="#cb385-1672" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-1673"><a href="#cb385-1673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1674"><a href="#cb385-1674" aria-hidden="true" tabindex="-1"></a><span class="in"># Use i in more creative ways</span></span>
<span id="cb385-1675"><a href="#cb385-1675" aria-hidden="true" tabindex="-1"></a><span class="in">names &lt;- c("Paul", "Mary", "John")</span></span>
<span id="cb385-1676"><a href="#cb385-1676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1677"><a href="#cb385-1677" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:3)</span></span>
<span id="cb385-1678"><a href="#cb385-1678" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb385-1679"><a href="#cb385-1679" aria-hidden="true" tabindex="-1"></a><span class="in">  print(paste("Hello", names[i]))</span></span>
<span id="cb385-1680"><a href="#cb385-1680" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-1681"><a href="#cb385-1681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1682"><a href="#cb385-1682" aria-hidden="true" tabindex="-1"></a><span class="in"># Non-numerical counter</span></span>
<span id="cb385-1683"><a href="#cb385-1683" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in c("Paul", "Mary", "John"))</span></span>
<span id="cb385-1684"><a href="#cb385-1684" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb385-1685"><a href="#cb385-1685" aria-hidden="true" tabindex="-1"></a><span class="in">  print(paste("Hello", i))</span></span>
<span id="cb385-1686"><a href="#cb385-1686" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-1687"><a href="#cb385-1687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1688"><a href="#cb385-1688" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1689"><a href="#cb385-1689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1690"><a href="#cb385-1690" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1691"><a href="#cb385-1691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1692"><a href="#cb385-1692" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;9.7.2&lt;/span&gt;&amp;nbsp; `while` loops</span></span>
<span id="cb385-1693"><a href="#cb385-1693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1694"><a href="#cb385-1694" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1695"><a href="#cb385-1695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1696"><a href="#cb385-1696" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A loop with a <span class="in">`while`</span> statement will run, until the specified condition is no longer fulfilled.</span>
<span id="cb385-1697"><a href="#cb385-1697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1698"><a href="#cb385-1698" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This only makes sense, of course, if the condition can change as a result of what happens inside the loop.</span>
<span id="cb385-1699"><a href="#cb385-1699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1700"><a href="#cb385-1700" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Note that <span class="in">`while`</span> loops can easily cause problems if the condition remains fulfilled regardless of what happens in the code block. Your code will then get hung up and needs to be cancelled manually.</span>
<span id="cb385-1701"><a href="#cb385-1701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1702"><a href="#cb385-1702" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.7.2}</span></span>
<span id="cb385-1703"><a href="#cb385-1703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1704"><a href="#cb385-1704" aria-hidden="true" tabindex="-1"></a><span class="in"># Run the `while` loop till the condition is met--</span></span>
<span id="cb385-1705"><a href="#cb385-1705" aria-hidden="true" tabindex="-1"></a><span class="in"># stop running when cond reaches 0 (no longer fulfilled)</span></span>
<span id="cb385-1706"><a href="#cb385-1706" aria-hidden="true" tabindex="-1"></a><span class="in">cond &lt;- 5</span></span>
<span id="cb385-1707"><a href="#cb385-1707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1708"><a href="#cb385-1708" aria-hidden="true" tabindex="-1"></a><span class="in">while (cond &gt; 0) </span></span>
<span id="cb385-1709"><a href="#cb385-1709" aria-hidden="true" tabindex="-1"></a><span class="in">  {</span></span>
<span id="cb385-1710"><a href="#cb385-1710" aria-hidden="true" tabindex="-1"></a><span class="in">    print(cond)</span></span>
<span id="cb385-1711"><a href="#cb385-1711" aria-hidden="true" tabindex="-1"></a><span class="in">  cond &lt;- cond - 1</span></span>
<span id="cb385-1712"><a href="#cb385-1712" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-1713"><a href="#cb385-1713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1714"><a href="#cb385-1714" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1715"><a href="#cb385-1715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1716"><a href="#cb385-1716" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1717"><a href="#cb385-1717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1718"><a href="#cb385-1718" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;9.8&lt;/span&gt;&amp;nbsp; `apply` functions</span></span>
<span id="cb385-1719"><a href="#cb385-1719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1720"><a href="#cb385-1720" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1721"><a href="#cb385-1721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1722"><a href="#cb385-1722" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The functions from the <span class="in">`apply`</span> family<span class="dv">&amp;mdash;</span> <span class="in">`apply`</span>, <span class="in">`lapply`</span> and <span class="in">`sapply`</span><span class="dv">&amp;mdash;</span> are often a much faster way to apply certain operations to multiple elements at the same time. </span>
<span id="cb385-1723"><a href="#cb385-1723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1724"><a href="#cb385-1724" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The two central arguments that need to be provided to these functions are the list of items to apply the operation to, and the operation itself.</span>
<span id="cb385-1725"><a href="#cb385-1725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1726"><a href="#cb385-1726" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1727"><a href="#cb385-1727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1728"><a href="#cb385-1728" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;9.8.1&lt;/span&gt;&amp;nbsp; `sapply` </span></span>
<span id="cb385-1729"><a href="#cb385-1729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1730"><a href="#cb385-1730" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1731"><a href="#cb385-1731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1732"><a href="#cb385-1732" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The easiest function to apply an operation to a vector of elements is <span class="in">`sapply`</span>. </span>
<span id="cb385-1733"><a href="#cb385-1733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1734"><a href="#cb385-1734" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It only needs two arguments: the vector (<span class="in">`X`</span>), and the function to be applied (<span class="in">`FUN`</span>). </span>
<span id="cb385-1735"><a href="#cb385-1735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1736"><a href="#cb385-1736" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.8.1}</span></span>
<span id="cb385-1737"><a href="#cb385-1737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1738"><a href="#cb385-1738" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a simple function `func` which just adds 1 to an object</span></span>
<span id="cb385-1739"><a href="#cb385-1739" aria-hidden="true" tabindex="-1"></a><span class="in">func &lt;- function(x)</span></span>
<span id="cb385-1740"><a href="#cb385-1740" aria-hidden="true" tabindex="-1"></a><span class="in">  x + 1</span></span>
<span id="cb385-1741"><a href="#cb385-1741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1742"><a href="#cb385-1742" aria-hidden="true" tabindex="-1"></a><span class="in">sapply(1:5, func)</span></span>
<span id="cb385-1743"><a href="#cb385-1743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1744"><a href="#cb385-1744" aria-hidden="true" tabindex="-1"></a><span class="in"># If we apply this function to a list of numbers, the output is a matrix </span></span>
<span id="cb385-1745"><a href="#cb385-1745" aria-hidden="true" tabindex="-1"></a><span class="in"># (but the values are the same).</span></span>
<span id="cb385-1746"><a href="#cb385-1746" aria-hidden="true" tabindex="-1"></a><span class="in">sapply(list(1:5), func)</span></span>
<span id="cb385-1747"><a href="#cb385-1747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1748"><a href="#cb385-1748" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1749"><a href="#cb385-1749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1750"><a href="#cb385-1750" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1751"><a href="#cb385-1751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1752"><a href="#cb385-1752" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;9.8.2&lt;/span&gt;&amp;nbsp; `lapply` </span></span>
<span id="cb385-1753"><a href="#cb385-1753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1754"><a href="#cb385-1754" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1755"><a href="#cb385-1755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1756"><a href="#cb385-1756" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`lapply`</span> function produces output as a list.</span>
<span id="cb385-1757"><a href="#cb385-1757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1758"><a href="#cb385-1758" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It interprets the input element <span class="in">`X`</span> as a list and returns a list with as many elements as were provided in that list, with each one containing the output of applying <span class="in">`FUN`</span> to the respective element.</span>
<span id="cb385-1759"><a href="#cb385-1759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1760"><a href="#cb385-1760" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.8.2}</span></span>
<span id="cb385-1761"><a href="#cb385-1761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1762"><a href="#cb385-1762" aria-hidden="true" tabindex="-1"></a><span class="in">lapply(1:5, func)</span></span>
<span id="cb385-1763"><a href="#cb385-1763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1764"><a href="#cb385-1764" aria-hidden="true" tabindex="-1"></a><span class="in"># Note that if the input element X is itself a list, this list is treated as </span></span>
<span id="cb385-1765"><a href="#cb385-1765" aria-hidden="true" tabindex="-1"></a><span class="in"># one input element, with FUN applied to the entire list and the result returned</span></span>
<span id="cb385-1766"><a href="#cb385-1766" aria-hidden="true" tabindex="-1"></a><span class="in"># as a single list element.</span></span>
<span id="cb385-1767"><a href="#cb385-1767" aria-hidden="true" tabindex="-1"></a><span class="in">lapply(list(1:5), func) # example to understand how it works</span></span>
<span id="cb385-1768"><a href="#cb385-1768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1769"><a href="#cb385-1769" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1770"><a href="#cb385-1770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1771"><a href="#cb385-1771" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1772"><a href="#cb385-1772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1773"><a href="#cb385-1773" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;9.8.3&lt;/span&gt;&amp;nbsp; `apply` </span></span>
<span id="cb385-1774"><a href="#cb385-1774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1775"><a href="#cb385-1775" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1776"><a href="#cb385-1776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1777"><a href="#cb385-1777" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The basic <span class="in">`apply`</span> function is for applying functions to arrays, where we can operate either on the rows (<span class="in">`MARGIN = 1`</span>) or on the columns (<span class="in">`MARGIN = 1`</span>) of the array. *(Not use much)*</span>
<span id="cb385-1778"><a href="#cb385-1778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1779"><a href="#cb385-1779" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.8.3}</span></span>
<span id="cb385-1780"><a href="#cb385-1780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1781"><a href="#cb385-1781" aria-hidden="true" tabindex="-1"></a><span class="in">mat &lt;- matrix(c(1, 1, 1, 2, 2, 2, 3, 3, 3), c(3, 3))</span></span>
<span id="cb385-1782"><a href="#cb385-1782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1783"><a href="#cb385-1783" aria-hidden="true" tabindex="-1"></a><span class="in">mat</span></span>
<span id="cb385-1784"><a href="#cb385-1784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1785"><a href="#cb385-1785" aria-hidden="true" tabindex="-1"></a><span class="in">apply(mat, MARGIN = 1, sum) # adding up all the data in each row</span></span>
<span id="cb385-1786"><a href="#cb385-1786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1787"><a href="#cb385-1787" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1788"><a href="#cb385-1788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1789"><a href="#cb385-1789" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1790"><a href="#cb385-1790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1791"><a href="#cb385-1791" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;9.9&lt;/span&gt;&amp;nbsp; Exercise on useful R tools</span></span>
<span id="cb385-1792"><a href="#cb385-1792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1793"><a href="#cb385-1793" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1794"><a href="#cb385-1794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1795"><a href="#cb385-1795" aria-hidden="true" tabindex="-1"></a>***1. Based on the `Winters_hours_gaps` dataset, use `magrittr` pipes and functions of the `tidyverse` to accomplish the following:***</span>
<span id="cb385-1796"><a href="#cb385-1796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1797"><a href="#cb385-1797" aria-hidden="true" tabindex="-1"></a>**a. Convert the dataset into a `tibble`.**</span>
<span id="cb385-1798"><a href="#cb385-1798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1799"><a href="#cb385-1799" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.9.1a}</span></span>
<span id="cb385-1800"><a href="#cb385-1800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1801"><a href="#cb385-1801" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_tibble &lt;- as_tibble(Winters_hours_gaps)</span></span>
<span id="cb385-1802"><a href="#cb385-1802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1803"><a href="#cb385-1803" aria-hidden="true" tabindex="-1"></a><span class="in">print(WHG_tibble[1:5, ])</span></span>
<span id="cb385-1804"><a href="#cb385-1804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1805"><a href="#cb385-1805" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1806"><a href="#cb385-1806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1807"><a href="#cb385-1807" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1808"><a href="#cb385-1808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1809"><a href="#cb385-1809" aria-hidden="true" tabindex="-1"></a>**b. Select only the top 10 rows of the dataset**</span>
<span id="cb385-1810"><a href="#cb385-1810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1811"><a href="#cb385-1811" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.9.1b}</span></span>
<span id="cb385-1812"><a href="#cb385-1812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1813"><a href="#cb385-1813" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_data &lt;- as_tibble(Winters_hours_gaps[1:10, ])</span></span>
<span id="cb385-1814"><a href="#cb385-1814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1815"><a href="#cb385-1815" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_data</span></span>
<span id="cb385-1816"><a href="#cb385-1816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1817"><a href="#cb385-1817" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1818"><a href="#cb385-1818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1819"><a href="#cb385-1819" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1820"><a href="#cb385-1820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1821"><a href="#cb385-1821" aria-hidden="true" tabindex="-1"></a>**c. Convert the `tibble` to a `long` format, with separate rows for `Temp_gaps` and `Temp`**</span>
<span id="cb385-1822"><a href="#cb385-1822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1823"><a href="#cb385-1823" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.9.1c}</span></span>
<span id="cb385-1824"><a href="#cb385-1824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1825"><a href="#cb385-1825" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_data_long &lt;- WHG_tibble %&gt;% pivot_longer(cols = Temp_gaps:Temp)</span></span>
<span id="cb385-1826"><a href="#cb385-1826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1827"><a href="#cb385-1827" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_data_long[1:20, ]</span></span>
<span id="cb385-1828"><a href="#cb385-1828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1829"><a href="#cb385-1829" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1830"><a href="#cb385-1830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1831"><a href="#cb385-1831" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1832"><a href="#cb385-1832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1833"><a href="#cb385-1833" aria-hidden="true" tabindex="-1"></a>**d. Use `ggplot2` to plot `Temp_gaps` and `Temp` as facets (point or line plot)**</span>
<span id="cb385-1834"><a href="#cb385-1834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1835"><a href="#cb385-1835" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.9.1d}</span></span>
<span id="cb385-1836"><a href="#cb385-1836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1837"><a href="#cb385-1837" aria-hidden="true" tabindex="-1"></a><span class="in">## Point plot</span></span>
<span id="cb385-1838"><a href="#cb385-1838" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(WHG_data_long[1:28, ], aes(Hour, value, colour = name)) +</span></span>
<span id="cb385-1839"><a href="#cb385-1839" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_point() +</span></span>
<span id="cb385-1840"><a href="#cb385-1840" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(cols = vars(name)) +</span></span>
<span id="cb385-1841"><a href="#cb385-1841" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Hour (JDay 63)") +</span></span>
<span id="cb385-1842"><a href="#cb385-1842" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Temperature (°C)") +</span></span>
<span id="cb385-1843"><a href="#cb385-1843" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 20) +</span></span>
<span id="cb385-1844"><a href="#cb385-1844" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(colour = NULL) +</span></span>
<span id="cb385-1845"><a href="#cb385-1845" aria-hidden="true" tabindex="-1"></a><span class="in">  ggtitle("Point plot")</span></span>
<span id="cb385-1846"><a href="#cb385-1846" aria-hidden="true" tabindex="-1"></a><span class="in"># The first 28 rows is for JDay 63 and there is no missing data in Temp_gaps</span></span>
<span id="cb385-1847"><a href="#cb385-1847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1848"><a href="#cb385-1848" aria-hidden="true" tabindex="-1"></a><span class="in">## Line plot</span></span>
<span id="cb385-1849"><a href="#cb385-1849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1850"><a href="#cb385-1850" aria-hidden="true" tabindex="-1"></a><span class="in"># So, for the line plot I will choose the JDay with gaps in temperature</span></span>
<span id="cb385-1851"><a href="#cb385-1851" aria-hidden="true" tabindex="-1"></a><span class="in"># After checking the dataset, I found JDay 78 has some missing Temp_gaps values</span></span>
<span id="cb385-1852"><a href="#cb385-1852" aria-hidden="true" tabindex="-1"></a><span class="in"># JDay 78 (18 MAR 2008) is rows 701:748</span></span>
<span id="cb385-1853"><a href="#cb385-1853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1854"><a href="#cb385-1854" aria-hidden="true" tabindex="-1"></a><span class="in"># Line plot of Temp and Temp_gaps for JDay 78</span></span>
<span id="cb385-1855"><a href="#cb385-1855" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(WHG_data_long[701:748, ], aes(Hour, value, colour = name)) +</span></span>
<span id="cb385-1856"><a href="#cb385-1856" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_line(lwd = 1.5) +</span></span>
<span id="cb385-1857"><a href="#cb385-1857" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(cols = vars(name)) +</span></span>
<span id="cb385-1858"><a href="#cb385-1858" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Hour (JDay 78)") +</span></span>
<span id="cb385-1859"><a href="#cb385-1859" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Temperature (°C)") +</span></span>
<span id="cb385-1860"><a href="#cb385-1860" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 20) +</span></span>
<span id="cb385-1861"><a href="#cb385-1861" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(colour = NULL) +</span></span>
<span id="cb385-1862"><a href="#cb385-1862" aria-hidden="true" tabindex="-1"></a><span class="in">  ggtitle("Line plot")</span></span>
<span id="cb385-1863"><a href="#cb385-1863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1864"><a href="#cb385-1864" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1865"><a href="#cb385-1865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1866"><a href="#cb385-1866" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1867"><a href="#cb385-1867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1868"><a href="#cb385-1868" aria-hidden="true" tabindex="-1"></a>**e. Convert the dataset back to the `wide` format**</span>
<span id="cb385-1869"><a href="#cb385-1869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1870"><a href="#cb385-1870" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.9.1e}</span></span>
<span id="cb385-1871"><a href="#cb385-1871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1872"><a href="#cb385-1872" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_data_wide &lt;- WHG_data_long %&gt;% pivot_wider()</span></span>
<span id="cb385-1873"><a href="#cb385-1873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1874"><a href="#cb385-1874" aria-hidden="true" tabindex="-1"></a><span class="in"># Display for JDay 78</span></span>
<span id="cb385-1875"><a href="#cb385-1875" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_data_wide[351:374, ]</span></span>
<span id="cb385-1876"><a href="#cb385-1876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1877"><a href="#cb385-1877" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1878"><a href="#cb385-1878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1879"><a href="#cb385-1879" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1880"><a href="#cb385-1880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1881"><a href="#cb385-1881" aria-hidden="true" tabindex="-1"></a>**f. Select only the following columns: `Year`, `Month`, `Day` and `Temp`**</span>
<span id="cb385-1882"><a href="#cb385-1882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1883"><a href="#cb385-1883" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.9.1f}</span></span>
<span id="cb385-1884"><a href="#cb385-1884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1885"><a href="#cb385-1885" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_data_wide[351:374, ] %&gt;% select(c(Year, Month, Day, Temp))</span></span>
<span id="cb385-1886"><a href="#cb385-1886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1887"><a href="#cb385-1887" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1888"><a href="#cb385-1888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1889"><a href="#cb385-1889" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1890"><a href="#cb385-1890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1891"><a href="#cb385-1891" aria-hidden="true" tabindex="-1"></a>**g. Sort the dataset by the `Temp` column, in descending order**</span>
<span id="cb385-1892"><a href="#cb385-1892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1893"><a href="#cb385-1893" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.9.1g}</span></span>
<span id="cb385-1894"><a href="#cb385-1894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1895"><a href="#cb385-1895" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_data_wide[351:374, ] %&gt;% arrange(desc(Temp))</span></span>
<span id="cb385-1896"><a href="#cb385-1896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1897"><a href="#cb385-1897" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1898"><a href="#cb385-1898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1899"><a href="#cb385-1899" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1900"><a href="#cb385-1900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1901"><a href="#cb385-1901" aria-hidden="true" tabindex="-1"></a>***2. For the `Winter_hours_gaps` dataset, write a `for` loop to convert all temperatures (Temp column) to degrees Fahrenheit***</span>
<span id="cb385-1902"><a href="#cb385-1902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1903"><a href="#cb385-1903" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.9.2}</span></span>
<span id="cb385-1904"><a href="#cb385-1904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1905"><a href="#cb385-1905" aria-hidden="true" tabindex="-1"></a><span class="in"># I want this output to match the output from 1.g</span></span>
<span id="cb385-1906"><a href="#cb385-1906" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_JDay78 &lt;- WHG_data_wide[351:374, ] %&gt;% arrange(desc(Temp))</span></span>
<span id="cb385-1907"><a href="#cb385-1907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1908"><a href="#cb385-1908" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in seq_len(nrow(WHG_JDay78))) </span></span>
<span id="cb385-1909"><a href="#cb385-1909" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb385-1910"><a href="#cb385-1910" aria-hidden="true" tabindex="-1"></a><span class="in">  WHG_JDay78$Temp[i] &lt;- WHG_JDay78$Temp[i] * 1.8 + 32</span></span>
<span id="cb385-1911"><a href="#cb385-1911" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-1912"><a href="#cb385-1912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1913"><a href="#cb385-1913" aria-hidden="true" tabindex="-1"></a><span class="in">print(WHG_JDay78)</span></span>
<span id="cb385-1914"><a href="#cb385-1914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1915"><a href="#cb385-1915" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1916"><a href="#cb385-1916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1917"><a href="#cb385-1917" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1918"><a href="#cb385-1918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1919"><a href="#cb385-1919" aria-hidden="true" tabindex="-1"></a>***3. Execute the same operation with a function from the `apply` family***</span>
<span id="cb385-1920"><a href="#cb385-1920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1921"><a href="#cb385-1921" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.9.3}</span></span>
<span id="cb385-1922"><a href="#cb385-1922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1923"><a href="#cb385-1923" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_JDay78_function &lt;- function(x)</span></span>
<span id="cb385-1924"><a href="#cb385-1924" aria-hidden="true" tabindex="-1"></a><span class="in"> x * 1.8 + 32</span></span>
<span id="cb385-1925"><a href="#cb385-1925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1926"><a href="#cb385-1926" aria-hidden="true" tabindex="-1"></a><span class="in"># Apply function to Temp column only</span></span>
<span id="cb385-1927"><a href="#cb385-1927" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_data_wide$Temp &lt;- sapply(WHG_data_wide$Temp, WHG_JDay78_function)</span></span>
<span id="cb385-1928"><a href="#cb385-1928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1929"><a href="#cb385-1929" aria-hidden="true" tabindex="-1"></a><span class="in"># Print in descending order</span></span>
<span id="cb385-1930"><a href="#cb385-1930" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_data_wide[351:374, ] %&gt;% arrange(desc(Temp))</span></span>
<span id="cb385-1931"><a href="#cb385-1931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1932"><a href="#cb385-1932" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1933"><a href="#cb385-1933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1934"><a href="#cb385-1934" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1935"><a href="#cb385-1935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1936"><a href="#cb385-1936" aria-hidden="true" tabindex="-1"></a>***4. Now use the `tidyverse` function `mutate` to achieve the same outcome***</span>
<span id="cb385-1937"><a href="#cb385-1937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1938"><a href="#cb385-1938" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.9.4}</span></span>
<span id="cb385-1939"><a href="#cb385-1939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1940"><a href="#cb385-1940" aria-hidden="true" tabindex="-1"></a><span class="in"># Call the WHG_data_wide again to run the original values</span></span>
<span id="cb385-1941"><a href="#cb385-1941" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_data_wide &lt;- WHG_data_long %&gt;% pivot_wider()</span></span>
<span id="cb385-1942"><a href="#cb385-1942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1943"><a href="#cb385-1943" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_mutate &lt;- WHG_data_wide[351:374, ] %&gt;% </span></span>
<span id="cb385-1944"><a href="#cb385-1944" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Temp_C = Temp, Temp_F = Temp * 1.8 + 32, Temp = NULL)</span></span>
<span id="cb385-1945"><a href="#cb385-1945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1946"><a href="#cb385-1946" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_mutate &lt;- WHG_mutate %&gt;% </span></span>
<span id="cb385-1947"><a href="#cb385-1947" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(desc(Temp_F))</span></span>
<span id="cb385-1948"><a href="#cb385-1948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1949"><a href="#cb385-1949" aria-hidden="true" tabindex="-1"></a><span class="in">print(WHG_mutate)</span></span>
<span id="cb385-1950"><a href="#cb385-1950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1951"><a href="#cb385-1951" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-1952"><a href="#cb385-1952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1953"><a href="#cb385-1953" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1954"><a href="#cb385-1954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1955"><a href="#cb385-1955" aria-hidden="true" tabindex="-1"></a>***5. Voluntary: consider taking a look at the instruction materials on all these functions, which I linked above, as well as at other sources on the internet. There’s a lot more to discover here, with lots of potential for making your coding more elegant and easier - and possibly even more fun!***</span>
<span id="cb385-1956"><a href="#cb385-1956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1957"><a href="#cb385-1957" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1958"><a href="#cb385-1958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1959"><a href="#cb385-1959" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 10: Getting temperature data</span></span>
<span id="cb385-1960"><a href="#cb385-1960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1961"><a href="#cb385-1961" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;10.1&lt;/span&gt;&amp;nbsp; Temperature data needs</span></span>
<span id="cb385-1962"><a href="#cb385-1962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1963"><a href="#cb385-1963" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1964"><a href="#cb385-1964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1965"><a href="#cb385-1965" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It is preferable to have a high-quality dataset collected in the exact place that you want to analyze.</span>
<span id="cb385-1966"><a href="#cb385-1966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1967"><a href="#cb385-1967" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If we don’t have such data, however, there are a few databases out there that we can draw on as an alternative option<span class="dv">&amp;mdash;</span> <span class="in">`chillR`</span> has access to one global database and one for California.</span>
<span id="cb385-1968"><a href="#cb385-1968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1969"><a href="#cb385-1969" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1970"><a href="#cb385-1970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1971"><a href="#cb385-1971" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;10.2&lt;/span&gt;&amp;nbsp; The Global Summary of the Day database</span></span>
<span id="cb385-1972"><a href="#cb385-1972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1973"><a href="#cb385-1973" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1974"><a href="#cb385-1974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1975"><a href="#cb385-1975" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>An invaluable source of temperature data: <span class="co">[</span><span class="ot">Global Summary of the Day (GSOD) database</span><span class="co">](https://www.geoplatform.gov/metadata/89cd9f7c-c14a-4ec2-a51d-7f69dc46ea41)</span> by the <span class="co">[</span><span class="ot">National Centers for Environmental Information (NCEI), formerly the National Climatic Data Center (NCDC)</span><span class="co">](https://www.ncei.noaa.gov/)</span> of the <span class="co">[</span><span class="ot"> United States National Oceanic and Atmospheric Administration (NOAA)</span><span class="co">](https://www.noaa.gov/)</span><span class="dv">&amp;mdash;</span> direct access to the weather data <span class="co">[</span><span class="ot">here.</span><span class="co">](https://www.ncei.noaa.gov/data/global-summary-of-the-day/access/)</span></span>
<span id="cb385-1976"><a href="#cb385-1976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1977"><a href="#cb385-1977" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`chillR`</span> automates the tedious data download and assembling process </span>
<span id="cb385-1978"><a href="#cb385-1978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1979"><a href="#cb385-1979" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`handle_gsod()`</span> can take care of all data retrieval steps by telling the function's <span class="in">`action`</span> parameter on what to do, since there are multiple steps involved.</span>
<span id="cb385-1980"><a href="#cb385-1980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1981"><a href="#cb385-1981" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-1982"><a href="#cb385-1982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1983"><a href="#cb385-1983" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;10.2.1&lt;/span&gt;&amp;nbsp; `action=list_stations`</span></span>
<span id="cb385-1984"><a href="#cb385-1984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1985"><a href="#cb385-1985" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-1986"><a href="#cb385-1986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1987"><a href="#cb385-1987" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`handle_gsod()`</span> retrieves the station list and sorts the station based on their proximity to a set of coordinates we specify. </span>
<span id="cb385-1988"><a href="#cb385-1988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1989"><a href="#cb385-1989" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 10.2.1}</span></span>
<span id="cb385-1990"><a href="#cb385-1990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1991"><a href="#cb385-1991" aria-hidden="true" tabindex="-1"></a><span class="in"># Search for stations near Bonn (Latitude: 50.73, Longitude: 7.10)</span></span>
<span id="cb385-1992"><a href="#cb385-1992" aria-hidden="true" tabindex="-1"></a><span class="in">station_list &lt;- handle_gsod(action = "list_stations",</span></span>
<span id="cb385-1993"><a href="#cb385-1993" aria-hidden="true" tabindex="-1"></a><span class="in">                            location = c(long = 7.10, lat = 50.73),</span></span>
<span id="cb385-1994"><a href="#cb385-1994" aria-hidden="true" tabindex="-1"></a><span class="in">                            time_interval = c(1990, 2020)) # limit search data</span></span>
<span id="cb385-1995"><a href="#cb385-1995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1996"><a href="#cb385-1996" aria-hidden="true" tabindex="-1"></a><span class="in">kable(station_list) %&gt;%</span></span>
<span id="cb385-1997"><a href="#cb385-1997" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 5)</span></span>
<span id="cb385-1998"><a href="#cb385-1998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-1999"><a href="#cb385-1999" aria-hidden="true" tabindex="-1"></a><span class="in">#  25 closest stations to the location set, ordered by their </span></span>
<span id="cb385-2000"><a href="#cb385-2000" aria-hidden="true" tabindex="-1"></a><span class="in"># distance to the target coordinates</span></span>
<span id="cb385-2001"><a href="#cb385-2001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2002"><a href="#cb385-2002" aria-hidden="true" tabindex="-1"></a><span class="in"># Overlap_years column: the number of years that are available</span></span>
<span id="cb385-2003"><a href="#cb385-2003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2004"><a href="#cb385-2004" aria-hidden="true" tabindex="-1"></a><span class="in"># Perc_interval_covered column: the percentage of the target interval </span></span>
<span id="cb385-2005"><a href="#cb385-2005" aria-hidden="true" tabindex="-1"></a><span class="in"># that is covered based on BEGIN and END dates in the table - </span></span>
<span id="cb385-2006"><a href="#cb385-2006" aria-hidden="true" tabindex="-1"></a><span class="in"># it’s quite possible (and usually the case) that the dataset contains gaps, </span></span>
<span id="cb385-2007"><a href="#cb385-2007" aria-hidden="true" tabindex="-1"></a><span class="in"># which sometimes cover almost the entire record.</span></span>
<span id="cb385-2008"><a href="#cb385-2008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2009"><a href="#cb385-2009" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2010"><a href="#cb385-2010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2011"><a href="#cb385-2011" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-2012"><a href="#cb385-2012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2013"><a href="#cb385-2013" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;10.2.2&lt;/span&gt;&amp;nbsp; `action="download_weather"`</span></span>
<span id="cb385-2014"><a href="#cb385-2014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2015"><a href="#cb385-2015" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-2016"><a href="#cb385-2016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2017"><a href="#cb385-2017" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When used with this option, the <span class="in">`handle_gsod()`</span> function downloads the weather data for a particular station, based on a station-specific <span class="in">`chillR_code`</span>.</span>
<span id="cb385-2018"><a href="#cb385-2018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2019"><a href="#cb385-2019" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Rather than typing the code manually, we can refer to the code in the station_list.</span>
<span id="cb385-2020"><a href="#cb385-2020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2021"><a href="#cb385-2021" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 10.2.2}</span></span>
<span id="cb385-2022"><a href="#cb385-2022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2023"><a href="#cb385-2023" aria-hidden="true" tabindex="-1"></a><span class="in"># Download for the 4th entry in the list, which covers most of our period of interest</span></span>
<span id="cb385-2024"><a href="#cb385-2024" aria-hidden="true" tabindex="-1"></a><span class="in">  weather &lt;- handle_gsod(action = "download_weather",</span></span>
<span id="cb385-2025"><a href="#cb385-2025" aria-hidden="true" tabindex="-1"></a><span class="in">                       location = station_list$chillR_code[4], #Koln_bonn airport</span></span>
<span id="cb385-2026"><a href="#cb385-2026" aria-hidden="true" tabindex="-1"></a><span class="in">                       time_interval = c(1990, 2020))</span></span>
<span id="cb385-2027"><a href="#cb385-2027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2028"><a href="#cb385-2028" aria-hidden="true" tabindex="-1"></a><span class="in"># Result is a list of two elements:</span></span>
<span id="cb385-2029"><a href="#cb385-2029" aria-hidden="true" tabindex="-1"></a><span class="in"># Element 1 (weather[[1]]) - an indication of the database the data come from</span></span>
<span id="cb385-2030"><a href="#cb385-2030" aria-hidden="true" tabindex="-1"></a><span class="in"># Element 2 (weather[[2]]) - the actual dataset</span></span>
<span id="cb385-2031"><a href="#cb385-2031" aria-hidden="true" tabindex="-1"></a><span class="in">kable(weather[[1]][1:20, ]) %&gt;%</span></span>
<span id="cb385-2032"><a href="#cb385-2032" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 5)</span></span>
<span id="cb385-2033"><a href="#cb385-2033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2034"><a href="#cb385-2034" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2035"><a href="#cb385-2035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2036"><a href="#cb385-2036" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-2037"><a href="#cb385-2037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2038"><a href="#cb385-2038" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The output looks pretty complicated, and it contains a lot of information we don't need.</span>
<span id="cb385-2039"><a href="#cb385-2039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2040"><a href="#cb385-2040" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`chillR`</span> has a function to simplify this record. But,</span>
<span id="cb385-2041"><a href="#cb385-2041" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>This removes a lot of variables you may be interested in.</span>
<span id="cb385-2042"><a href="#cb385-2042" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>More importantly, this also removes quality flags, which may indicate that particular records aren’t reliable.</span>
<span id="cb385-2043"><a href="#cb385-2043" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-2044"><a href="#cb385-2044" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-2045"><a href="#cb385-2045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2046"><a href="#cb385-2046" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;10.2.3&lt;/span&gt;&amp;nbsp; downloaded weather as `action` argument</span></span>
<span id="cb385-2047"><a href="#cb385-2047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2048"><a href="#cb385-2048" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-2049"><a href="#cb385-2049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2050"><a href="#cb385-2050" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This way of calling <span class="in">`handle_gsod()`</span> serves to clean the dataset and convert it into a format that <span class="in">`chillR`</span> can easily handle</span>
<span id="cb385-2051"><a href="#cb385-2051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2052"><a href="#cb385-2052" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 10.2.3}</span></span>
<span id="cb385-2053"><a href="#cb385-2053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2054"><a href="#cb385-2054" aria-hidden="true" tabindex="-1"></a><span class="in"># Clean dataset</span></span>
<span id="cb385-2055"><a href="#cb385-2055" aria-hidden="true" tabindex="-1"></a><span class="in">cleaned_weather &lt;- handle_gsod(weather)</span></span>
<span id="cb385-2056"><a href="#cb385-2056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2057"><a href="#cb385-2057" aria-hidden="true" tabindex="-1"></a><span class="in">kable(cleaned_weather[[1]][1:20, ]) %&gt;%</span></span>
<span id="cb385-2058"><a href="#cb385-2058" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 5)</span></span>
<span id="cb385-2059"><a href="#cb385-2059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2060"><a href="#cb385-2060" aria-hidden="true" tabindex="-1"></a><span class="in"># Save the output files generated, so that we can use in the next chapters</span></span>
<span id="cb385-2061"><a href="#cb385-2061" aria-hidden="true" tabindex="-1"></a><span class="in">dir.create("data/Bonn")</span></span>
<span id="cb385-2062"><a href="#cb385-2062" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(station_list,"data/Bonn/station_list.csv",row.names=FALSE)</span></span>
<span id="cb385-2063"><a href="#cb385-2063" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(weather[[1]],"data/Bonn/Bonn_raw_weather.csv",row.names=FALSE)</span></span>
<span id="cb385-2064"><a href="#cb385-2064" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(cleaned_weather[[1]],"data/Bonn/Bonn_chillR_weather.csv",row.names=FALSE)</span></span>
<span id="cb385-2065"><a href="#cb385-2065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2066"><a href="#cb385-2066" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2067"><a href="#cb385-2067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2068"><a href="#cb385-2068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2069"><a href="#cb385-2069" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-2070"><a href="#cb385-2070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2071"><a href="#cb385-2071" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The output record contains many strange numbers<span class="dv">&amp;mdash;</span> degrees Fahrenheit values in origianl database are converted to degrees Celsius </span>
<span id="cb385-2072"><a href="#cb385-2072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2073"><a href="#cb385-2073" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$Temperature<span class="ot">[^\circ C]</span> = (Temperature<span class="ot">[^\circ F]</span> - 32) . \frac{5}{9}$</span>
<span id="cb385-2074"><a href="#cb385-2074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2075"><a href="#cb385-2075" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The dataset still has pretty substantial gaps, including several entire years of missing data<span class="dv">&amp;mdash;</span> Filling gaps in temperature records</span>
<span id="cb385-2076"><a href="#cb385-2076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2077"><a href="#cb385-2077" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`chillR`</span> has a pretty similar function to download data from the <span class="co">[</span><span class="ot">California Irrigation Management Information System (CIMIS).</span><span class="co">](https://cimis.water.ca.gov/)</span></span>
<span id="cb385-2078"><a href="#cb385-2078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2079"><a href="#cb385-2079" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-2080"><a href="#cb385-2080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2081"><a href="#cb385-2081" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;10.3&lt;/span&gt;&amp;nbsp; Exercises on getting temperature data</span></span>
<span id="cb385-2082"><a href="#cb385-2082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2083"><a href="#cb385-2083" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-2084"><a href="#cb385-2084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2085"><a href="#cb385-2085" aria-hidden="true" tabindex="-1"></a>***1. Choose a location of interest and find the 25 closest weather stations using the `handle_gsod` function***</span>
<span id="cb385-2086"><a href="#cb385-2086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2087"><a href="#cb385-2087" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 10.3.1}</span></span>
<span id="cb385-2088"><a href="#cb385-2088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2089"><a href="#cb385-2089" aria-hidden="true" tabindex="-1"></a><span class="in"># Look for stations near M&amp;ouml;ssigen (48.40567° N, 9.05419° E)</span></span>
<span id="cb385-2090"><a href="#cb385-2090" aria-hidden="true" tabindex="-1"></a><span class="in">MS_station_list &lt;- handle_gsod(action = "list_stations",</span></span>
<span id="cb385-2091"><a href="#cb385-2091" aria-hidden="true" tabindex="-1"></a><span class="in">                               location = c(long = 9.05, lat = 48.40),</span></span>
<span id="cb385-2092"><a href="#cb385-2092" aria-hidden="true" tabindex="-1"></a><span class="in">                               time_interval = c(1990, 2020))</span></span>
<span id="cb385-2093"><a href="#cb385-2093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2094"><a href="#cb385-2094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2095"><a href="#cb385-2095" aria-hidden="true" tabindex="-1"></a><span class="in">kable(MS_station_list) %&gt;%</span></span>
<span id="cb385-2096"><a href="#cb385-2096" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-2097"><a href="#cb385-2097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2098"><a href="#cb385-2098" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2099"><a href="#cb385-2099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2100"><a href="#cb385-2100" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-2101"><a href="#cb385-2101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2102"><a href="#cb385-2102" aria-hidden="true" tabindex="-1"></a>***2. Download weather data for the most promising station on the list***</span>
<span id="cb385-2103"><a href="#cb385-2103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2104"><a href="#cb385-2104" aria-hidden="true" tabindex="-1"></a>The most promising station in my case is the STUTTGART (airport) weather station (<span class="in">`chillR_code`</span>: 10738099999), which is 34.68 km away from our location of interest. </span>
<span id="cb385-2105"><a href="#cb385-2105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2106"><a href="#cb385-2106" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 10.3.2}</span></span>
<span id="cb385-2107"><a href="#cb385-2107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2108"><a href="#cb385-2108" aria-hidden="true" tabindex="-1"></a><span class="in"># Download weather data for STUTTGART</span></span>
<span id="cb385-2109"><a href="#cb385-2109" aria-hidden="true" tabindex="-1"></a><span class="in">STG_weather &lt;- handle_gsod(action = "download_weather",</span></span>
<span id="cb385-2110"><a href="#cb385-2110" aria-hidden="true" tabindex="-1"></a><span class="in">                           location = MS_station_list$chillR_code[3],</span></span>
<span id="cb385-2111"><a href="#cb385-2111" aria-hidden="true" tabindex="-1"></a><span class="in">                           time_interval = c(1990, 2020))</span></span>
<span id="cb385-2112"><a href="#cb385-2112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2113"><a href="#cb385-2113" aria-hidden="true" tabindex="-1"></a><span class="in"># Show output in table</span></span>
<span id="cb385-2114"><a href="#cb385-2114" aria-hidden="true" tabindex="-1"></a><span class="in">kable(STG_weather[[1]][1:20, ]) %&gt;%</span></span>
<span id="cb385-2115"><a href="#cb385-2115" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 5)</span></span>
<span id="cb385-2116"><a href="#cb385-2116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2117"><a href="#cb385-2117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2118"><a href="#cb385-2118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2119"><a href="#cb385-2119" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-2120"><a href="#cb385-2120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2121"><a href="#cb385-2121" aria-hidden="true" tabindex="-1"></a>***3. Convert the weather data into `chillR` format***</span>
<span id="cb385-2122"><a href="#cb385-2122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2123"><a href="#cb385-2123" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 10.3.3}</span></span>
<span id="cb385-2124"><a href="#cb385-2124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2125"><a href="#cb385-2125" aria-hidden="true" tabindex="-1"></a><span class="in"># Clean the dataset and convert to chillR format</span></span>
<span id="cb385-2126"><a href="#cb385-2126" aria-hidden="true" tabindex="-1"></a><span class="in">STG_cleaned_weather &lt;- handle_gsod(STG_weather)</span></span>
<span id="cb385-2127"><a href="#cb385-2127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2128"><a href="#cb385-2128" aria-hidden="true" tabindex="-1"></a><span class="in">kable(STG_cleaned_weather[[1]][1:20, ]) %&gt;%</span></span>
<span id="cb385-2129"><a href="#cb385-2129" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 5)</span></span>
<span id="cb385-2130"><a href="#cb385-2130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2131"><a href="#cb385-2131" aria-hidden="true" tabindex="-1"></a><span class="in"># Save the output </span></span>
<span id="cb385-2132"><a href="#cb385-2132" aria-hidden="true" tabindex="-1"></a><span class="in">dir.create("data/MS")</span></span>
<span id="cb385-2133"><a href="#cb385-2133" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(MS_station_list,"data/MS/MS_station_list.csv",row.names=FALSE)</span></span>
<span id="cb385-2134"><a href="#cb385-2134" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(STG_weather[[1]],"data/MS/STG_raw_weather.csv",row.names=FALSE)</span></span>
<span id="cb385-2135"><a href="#cb385-2135" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(STG_cleaned_weather[[1]],"data/MS/STG_chillR_weather.csv",row.names=FALSE)</span></span>
<span id="cb385-2136"><a href="#cb385-2136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2137"><a href="#cb385-2137" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2138"><a href="#cb385-2138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2139"><a href="#cb385-2139" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-2140"><a href="#cb385-2140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2141"><a href="#cb385-2141" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 11: Filling gaps in temperature records</span></span>
<span id="cb385-2142"><a href="#cb385-2142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2143"><a href="#cb385-2143" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;11.1&lt;/span&gt;&amp;nbsp; Gaps</span></span>
<span id="cb385-2144"><a href="#cb385-2144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2145"><a href="#cb385-2145" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-2146"><a href="#cb385-2146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2147"><a href="#cb385-2147" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Lots of things can go wrong when recording temperature data, including malfunctioning equipment, flat batteries, power cuts or lack of maintenance. Data archiving, transmission and storage in a database presents the next hurdle. </span>
<span id="cb385-2148"><a href="#cb385-2148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2149"><a href="#cb385-2149" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Many datasets therefore have gaps<span class="dv">&amp;mdash;</span> many scientific methods don’t deal very well with missing data, so we need ways of filling such gaps.</span>
<span id="cb385-2150"><a href="#cb385-2150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2151"><a href="#cb385-2151" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-2152"><a href="#cb385-2152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2153"><a href="#cb385-2153" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;11.2&lt;/span&gt;&amp;nbsp; Filling short gaps in daily records</span></span>
<span id="cb385-2154"><a href="#cb385-2154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2155"><a href="#cb385-2155" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-2156"><a href="#cb385-2156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2157"><a href="#cb385-2157" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Simple linear interpolation is good enough for largely complete weather records, except for isolated incidences of missing daily minimum or maximum temperatures.</span>
<span id="cb385-2158"><a href="#cb385-2158" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Take the last recorded value before a gaps and the first after the gap and compute the average</span>
<span id="cb385-2159"><a href="#cb385-2159" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Also use for slightly longer gaps (e.g. 2-3 days) or maybe a few days more, but it will be dubious</span>
<span id="cb385-2160"><a href="#cb385-2160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2161"><a href="#cb385-2161" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In case gaps extend to several weeks or even months, linear interpolation, which simply connects the start and end points of the gap by a straight line, may miss important features of the local temperature dynamics. </span>
<span id="cb385-2162"><a href="#cb385-2162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2163"><a href="#cb385-2163" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In the extreme case, where we’re missing an entire year of data, such linear interpolation would miss entire seasons, producing unacceptable errors.</span>
<span id="cb385-2164"><a href="#cb385-2164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2165"><a href="#cb385-2165" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Other options:</span>
<span id="cb385-2166"><a href="#cb385-2166" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`fix_weather()`</span> function, without additional argument, linearly interpolates all gaps in the Tmin and Tmax columns</span>
<span id="cb385-2167"><a href="#cb385-2167" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`make_all_day_table()`</span> function adds news lines for the entire days missing in the records</span>
<span id="cb385-2168"><a href="#cb385-2168" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`start_year`</span> and <span class="in">`end_year`</span> to specify the range of years to apply this procedure for; <span class="in">`start_date`</span> and <span class="in">`end_date`</span> in Julian days for the dates to work on; and names of the columns to work on if these are different from <span class="in">`Tmin`</span> and <span class="in">`Tmax`</span> </span>
<span id="cb385-2169"><a href="#cb385-2169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2170"><a href="#cb385-2170" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-2171"><a href="#cb385-2171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2172"><a href="#cb385-2172" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.2}</span></span>
<span id="cb385-2173"><a href="#cb385-2173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2174"><a href="#cb385-2174" aria-hidden="true" tabindex="-1"></a><span class="in"># This add DATE column in R format</span></span>
<span id="cb385-2175"><a href="#cb385-2175" aria-hidden="true" tabindex="-1"></a><span class="in">weather &lt;- KA_weather %&gt;% make_all_day_table()</span></span>
<span id="cb385-2176"><a href="#cb385-2176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2177"><a href="#cb385-2177" aria-hidden="true" tabindex="-1"></a><span class="in"># Interpolate the gaps for Tmin (output: interp- numeric vector with all gaps </span></span>
<span id="cb385-2178"><a href="#cb385-2178" aria-hidden="true" tabindex="-1"></a><span class="in"># linearly interpolated and </span></span>
<span id="cb385-2179"><a href="#cb385-2179" aria-hidden="true" tabindex="-1"></a><span class="in"># missing- boolean vector, either TRUE (gap) or FALSE (no gap))</span></span>
<span id="cb385-2180"><a href="#cb385-2180" aria-hidden="true" tabindex="-1"></a><span class="in">Tmin_int &lt;- interpolate_gaps(weather[,"Tmin"])</span></span>
<span id="cb385-2181"><a href="#cb385-2181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2182"><a href="#cb385-2182" aria-hidden="true" tabindex="-1"></a><span class="in"># Add Tmin and Tmin_interpolated to weather dataset</span></span>
<span id="cb385-2183"><a href="#cb385-2183" aria-hidden="true" tabindex="-1"></a><span class="in">weather &lt;- weather %&gt;% mutate(Tmin = Tmin_int$interp,</span></span>
<span id="cb385-2184"><a href="#cb385-2184" aria-hidden="true" tabindex="-1"></a><span class="in">                              Tmin_interpolated = Tmin_int$missing)</span></span>
<span id="cb385-2185"><a href="#cb385-2185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2186"><a href="#cb385-2186" aria-hidden="true" tabindex="-1"></a><span class="in"># Interpolate the gaps for Tmax</span></span>
<span id="cb385-2187"><a href="#cb385-2187" aria-hidden="true" tabindex="-1"></a><span class="in">Tmax_int &lt;- interpolate_gaps(weather[,"Tmax"])</span></span>
<span id="cb385-2188"><a href="#cb385-2188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2189"><a href="#cb385-2189" aria-hidden="true" tabindex="-1"></a><span class="in"># Add Tmax and Tmax_interpolated to weather dataset</span></span>
<span id="cb385-2190"><a href="#cb385-2190" aria-hidden="true" tabindex="-1"></a><span class="in">weather &lt;- weather %&gt;% mutate(Tmax = Tmax_int$interp,</span></span>
<span id="cb385-2191"><a href="#cb385-2191" aria-hidden="true" tabindex="-1"></a><span class="in">                              Tmax_interpolated = Tmax_int$missing)</span></span>
<span id="cb385-2192"><a href="#cb385-2192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2193"><a href="#cb385-2193" aria-hidden="true" tabindex="-1"></a><span class="in"># add an extra day to the KA_weather dataset that is not connected to </span></span>
<span id="cb385-2194"><a href="#cb385-2194" aria-hidden="true" tabindex="-1"></a><span class="in"># the days that are already there.</span></span>
<span id="cb385-2195"><a href="#cb385-2195" aria-hidden="true" tabindex="-1"></a><span class="in"># this creates a large gap, which we can then interpolate</span></span>
<span id="cb385-2196"><a href="#cb385-2196" aria-hidden="true" tabindex="-1"></a><span class="in">KA_weather_gap &lt;- rbind(KA_weather, c(Year = 2011,</span></span>
<span id="cb385-2197"><a href="#cb385-2197" aria-hidden="true" tabindex="-1"></a><span class="in">                                      Month = 3,</span></span>
<span id="cb385-2198"><a href="#cb385-2198" aria-hidden="true" tabindex="-1"></a><span class="in">                                      Day = 3,</span></span>
<span id="cb385-2199"><a href="#cb385-2199" aria-hidden="true" tabindex="-1"></a><span class="in">                                      Tmax = 26,</span></span>
<span id="cb385-2200"><a href="#cb385-2200" aria-hidden="true" tabindex="-1"></a><span class="in">                                      Tmin = 14)) </span></span>
<span id="cb385-2201"><a href="#cb385-2201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2202"><a href="#cb385-2202" aria-hidden="true" tabindex="-1"></a><span class="in"># fill in the gaps between Julian date 300 (late October) and 100 (early April), </span></span>
<span id="cb385-2203"><a href="#cb385-2203" aria-hidden="true" tabindex="-1"></a><span class="in"># only returning data between 2000 and 2011</span></span>
<span id="cb385-2204"><a href="#cb385-2204" aria-hidden="true" tabindex="-1"></a><span class="in">fixed_winter_days &lt;- KA_weather_gap %&gt;% fix_weather(start_year = 2000,</span></span>
<span id="cb385-2205"><a href="#cb385-2205" aria-hidden="true" tabindex="-1"></a><span class="in">                                                    end_year = 2011,</span></span>
<span id="cb385-2206"><a href="#cb385-2206" aria-hidden="true" tabindex="-1"></a><span class="in">                                                    start_date = 300,</span></span>
<span id="cb385-2207"><a href="#cb385-2207" aria-hidden="true" tabindex="-1"></a><span class="in">                                                    end_date = 100)</span></span>
<span id="cb385-2208"><a href="#cb385-2208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2209"><a href="#cb385-2209" aria-hidden="true" tabindex="-1"></a><span class="in"># fill in all gaps</span></span>
<span id="cb385-2210"><a href="#cb385-2210" aria-hidden="true" tabindex="-1"></a><span class="in">fixed_all_days &lt;- KA_weather_gap %&gt;% fix_weather()</span></span>
<span id="cb385-2211"><a href="#cb385-2211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2212"><a href="#cb385-2212" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2213"><a href="#cb385-2213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2214"><a href="#cb385-2214" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-2215"><a href="#cb385-2215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2216"><a href="#cb385-2216" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`fix_weather()`</span> function produces a list of two outputs:</span>
<span id="cb385-2217"><a href="#cb385-2217" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`weather`</span>: a <span class="in">`data.frame`</span> with the interpolated weather data, now including columns <span class="in">`no_Tmin`</span> and <span class="in">`no_Tmax`</span>, which contain <span class="in">`TRUE`</span> for rows where the respective values were originally missing (<span class="in">`FALSE`</span> otherwise).</span>
<span id="cb385-2218"><a href="#cb385-2218" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`QC`</span>: a quality control object that summarizes how many values were interpolated for each season.</span>
<span id="cb385-2219"><a href="#cb385-2219" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-2220"><a href="#cb385-2220" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-2221"><a href="#cb385-2221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2222"><a href="#cb385-2222" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.2a}</span></span>
<span id="cb385-2223"><a href="#cb385-2223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2224"><a href="#cb385-2224" aria-hidden="true" tabindex="-1"></a><span class="in"># QC elements for interpolated fixed_winter_days dataset</span></span>
<span id="cb385-2225"><a href="#cb385-2225" aria-hidden="true" tabindex="-1"></a><span class="in">kable(fixed_winter_days$QC, </span></span>
<span id="cb385-2226"><a href="#cb385-2226" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = </span></span>
<span id="cb385-2227"><a href="#cb385-2227" aria-hidden="true" tabindex="-1"></a><span class="in">      "Table 11.2a: Quality control summary produced by fixed_weather(), with</span></span>
<span id="cb385-2228"><a href="#cb385-2228" aria-hidden="true" tabindex="-1"></a><span class="in">      only winter days interpolated") %&gt;%</span></span>
<span id="cb385-2229"><a href="#cb385-2229" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-2230"><a href="#cb385-2230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2231"><a href="#cb385-2231" aria-hidden="true" tabindex="-1"></a><span class="in"># QC elements for interpolated fixed_all_days dataset</span></span>
<span id="cb385-2232"><a href="#cb385-2232" aria-hidden="true" tabindex="-1"></a><span class="in">kable(fixed_all_days$QC,</span></span>
<span id="cb385-2233"><a href="#cb385-2233" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = </span></span>
<span id="cb385-2234"><a href="#cb385-2234" aria-hidden="true" tabindex="-1"></a><span class="in">      "Table 11.2b: Quality control summary produced by fix_weather(),</span></span>
<span id="cb385-2235"><a href="#cb385-2235" aria-hidden="true" tabindex="-1"></a><span class="in">      with all days interpolated") %&gt;%</span></span>
<span id="cb385-2236"><a href="#cb385-2236" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-2237"><a href="#cb385-2237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2238"><a href="#cb385-2238" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2239"><a href="#cb385-2239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2240"><a href="#cb385-2240" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-2241"><a href="#cb385-2241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2242"><a href="#cb385-2242" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Linear interpolation is usually acceptable for short gaps in the records, but it gets increasingly less convincing, when the gaps are longer. Here’s a quick demonstration of this:</span>
<span id="cb385-2243"><a href="#cb385-2243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2244"><a href="#cb385-2244" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.2b}</span></span>
<span id="cb385-2245"><a href="#cb385-2245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2246"><a href="#cb385-2246" aria-hidden="true" tabindex="-1"></a><span class="in"># Create gap_weather dataset with rows 200:305 of KA_weather dataset</span></span>
<span id="cb385-2247"><a href="#cb385-2247" aria-hidden="true" tabindex="-1"></a><span class="in">gap_weather &lt;- KA_weather[200:305,]</span></span>
<span id="cb385-2248"><a href="#cb385-2248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2249"><a href="#cb385-2249" aria-hidden="true" tabindex="-1"></a><span class="in"># Add a new Tmin_observed column which copies Tmin values</span></span>
<span id="cb385-2250"><a href="#cb385-2250" aria-hidden="true" tabindex="-1"></a><span class="in">gap_weather[,"Tmin_observed"] &lt;- gap_weather$Tmin</span></span>
<span id="cb385-2251"><a href="#cb385-2251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2252"><a href="#cb385-2252" aria-hidden="true" tabindex="-1"></a><span class="in"># Replace with NA for Tmin values in selected rows (Create gaps)</span></span>
<span id="cb385-2253"><a href="#cb385-2253" aria-hidden="true" tabindex="-1"></a><span class="in">gap_weather$Tmin[c(2,4:5,7:9,11:14,16:20,22:27,29:35,</span></span>
<span id="cb385-2254"><a href="#cb385-2254" aria-hidden="true" tabindex="-1"></a><span class="in">                   37:44,46:54,56:65,67:77,79:90,92:104)] &lt;- NA</span></span>
<span id="cb385-2255"><a href="#cb385-2255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2256"><a href="#cb385-2256" aria-hidden="true" tabindex="-1"></a><span class="in"># Interpolate the gaps with fix_weather function</span></span>
<span id="cb385-2257"><a href="#cb385-2257" aria-hidden="true" tabindex="-1"></a><span class="in">fixed_gaps &lt;- fix_weather(gap_weather)$weather # only select weather output</span></span>
<span id="cb385-2258"><a href="#cb385-2258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2259"><a href="#cb385-2259" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the result</span></span>
<span id="cb385-2260"><a href="#cb385-2260" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = fixed_gaps, aes(DATE)) +</span></span>
<span id="cb385-2261"><a href="#cb385-2261" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(aes(y = Tmin_observed, color = "Tmin Observed"), lwd = 1.3) +</span></span>
<span id="cb385-2262"><a href="#cb385-2262" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(aes(y = Tmin, color = "Tmin Interpolated"), lwd = 1.3) +</span></span>
<span id="cb385-2263"><a href="#cb385-2263" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(</span></span>
<span id="cb385-2264"><a href="#cb385-2264" aria-hidden="true" tabindex="-1"></a><span class="in">    values = c("Tmin Observed" = "black", "Tmin Interpolated" = "red"),</span></span>
<span id="cb385-2265"><a href="#cb385-2265" aria-hidden="true" tabindex="-1"></a><span class="in">    name = "Legend"</span></span>
<span id="cb385-2266"><a href="#cb385-2266" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb385-2267"><a href="#cb385-2267" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Date") +</span></span>
<span id="cb385-2268"><a href="#cb385-2268" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Daily minimum temperature (°C)")</span></span>
<span id="cb385-2269"><a href="#cb385-2269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2270"><a href="#cb385-2270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2271"><a href="#cb385-2271" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2272"><a href="#cb385-2272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2273"><a href="#cb385-2273" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-2274"><a href="#cb385-2274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2275"><a href="#cb385-2275" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.2c}</span></span>
<span id="cb385-2276"><a href="#cb385-2276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2277"><a href="#cb385-2277" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate absolute difference between Tmin_iterpolated and Tmin_observed</span></span>
<span id="cb385-2278"><a href="#cb385-2278" aria-hidden="true" tabindex="-1"></a><span class="in">fixed_gaps[,"error"] &lt;- abs(fixed_gaps$Tmin - fixed_gaps$Tmin_observed)</span></span>
<span id="cb385-2279"><a href="#cb385-2279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2280"><a href="#cb385-2280" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data=fixed_gaps,</span></span>
<span id="cb385-2281"><a href="#cb385-2281" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(DATE,error)) +</span></span>
<span id="cb385-2282"><a href="#cb385-2282" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(lwd=1.3) +</span></span>
<span id="cb385-2283"><a href="#cb385-2283" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Date") +</span></span>
<span id="cb385-2284"><a href="#cb385-2284" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Error introduced by interpolation (°C)") +</span></span>
<span id="cb385-2285"><a href="#cb385-2285" aria-hidden="true" tabindex="-1"></a><span class="in">  # Show in cex=3 size dots the dates where observed Tmin is available</span></span>
<span id="cb385-2286"><a href="#cb385-2286" aria-hidden="true" tabindex="-1"></a><span class="in">  # Only include rows where no_Tmin is FALSE</span></span>
<span id="cb385-2287"><a href="#cb385-2287" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data=fixed_gaps[which(!fixed_gaps$no_Tmin),],</span></span>
<span id="cb385-2288"><a href="#cb385-2288" aria-hidden="true" tabindex="-1"></a><span class="in">             aes(DATE,error),col="red",cex=3)</span></span>
<span id="cb385-2289"><a href="#cb385-2289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2290"><a href="#cb385-2290" aria-hidden="true" tabindex="-1"></a><span class="in"># Gaps of length == 1 only on the left, and gaps of length == 13 on the right -</span></span>
<span id="cb385-2291"><a href="#cb385-2291" aria-hidden="true" tabindex="-1"></a><span class="in"># temperature dynamics are captured quite well on the left, but </span></span>
<span id="cb385-2292"><a href="#cb385-2292" aria-hidden="true" tabindex="-1"></a><span class="in"># no longer very well on the right. </span></span>
<span id="cb385-2293"><a href="#cb385-2293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2294"><a href="#cb385-2294" aria-hidden="true" tabindex="-1"></a><span class="in"># How big the errors get obviously depends on the nature of the dataset - </span></span>
<span id="cb385-2295"><a href="#cb385-2295" aria-hidden="true" tabindex="-1"></a><span class="in"># was there a lot of variation during the period of interest, or not? </span></span>
<span id="cb385-2296"><a href="#cb385-2296" aria-hidden="true" tabindex="-1"></a><span class="in"># Yet we see a tendency here of errors getting bigger and bigger with </span></span>
<span id="cb385-2297"><a href="#cb385-2297" aria-hidden="true" tabindex="-1"></a><span class="in"># increasing gap sizes. Of course for the non-gap points (shown in red in </span></span>
<span id="cb385-2298"><a href="#cb385-2298" aria-hidden="true" tabindex="-1"></a><span class="in"># the plot), the error is zero, but especially in the middle of the larger gaps, </span></span>
<span id="cb385-2299"><a href="#cb385-2299" aria-hidden="true" tabindex="-1"></a><span class="in"># we can be quite far off from what actually happened.</span></span>
<span id="cb385-2300"><a href="#cb385-2300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2301"><a href="#cb385-2301" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2302"><a href="#cb385-2302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2303"><a href="#cb385-2303" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-2304"><a href="#cb385-2304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2305"><a href="#cb385-2305" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;11.3&lt;/span&gt;&amp;nbsp; Filling long gaps in daily records</span></span>
<span id="cb385-2306"><a href="#cb385-2306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2307"><a href="#cb385-2307" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-2308"><a href="#cb385-2308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2309"><a href="#cb385-2309" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For longer gaps, we can experiment with more complex interpolation algorithms, or try to look for additional data<span class="dv">&amp;mdash;</span> find another weather station that is close enough to be in a climatically comparable setting and use the data from there to fill gaps for the site of interest.</span>
<span id="cb385-2310"><a href="#cb385-2310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2311"><a href="#cb385-2311" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This may work ok, if the auxiliary station is in a very similar climatic setting, but it will already introduce an error if we’re dealing with some elevation differences, or with other landscape features that have climatic effects (e.g. lakes, sea, forest). </span>
<span id="cb385-2312"><a href="#cb385-2312" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Such features, as well as topography, can modulate temperatures at a particular place in a way that makes them poor proxies of temperatures in another location.</span>
<span id="cb385-2313"><a href="#cb385-2313" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-2314"><a href="#cb385-2314" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-2315"><a href="#cb385-2315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2316"><a href="#cb385-2316" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`patch_weather()`</span> function can fill gaps in a weather record based on a list of weather datasets from auxiliary stations.</span>
<span id="cb385-2317"><a href="#cb385-2317" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>The function can also test for (some) biases, correct data for bias in mean temperatures, and use the result to fill gaps in the record for the location of interest.</span>
<span id="cb385-2318"><a href="#cb385-2318" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-2319"><a href="#cb385-2319" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.3a}</span></span>
<span id="cb385-2320"><a href="#cb385-2320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2321"><a href="#cb385-2321" aria-hidden="true" tabindex="-1"></a><span class="in"># Fill gaps in dataset for Bonn that was downloaded in Ch. 10</span></span>
<span id="cb385-2322"><a href="#cb385-2322" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn &lt;- read.csv("data/Bonn/Bonn_chillR_weather.csv")</span></span>
<span id="cb385-2323"><a href="#cb385-2323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2324"><a href="#cb385-2324" aria-hidden="true" tabindex="-1"></a><span class="in"># Check the quality control summary with fix_weather()</span></span>
<span id="cb385-2325"><a href="#cb385-2325" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_QC &lt;- fix_weather(Bonn)$QC</span></span>
<span id="cb385-2326"><a href="#cb385-2326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2327"><a href="#cb385-2327" aria-hidden="true" tabindex="-1"></a><span class="in"># Display the QC summary</span></span>
<span id="cb385-2328"><a href="#cb385-2328" aria-hidden="true" tabindex="-1"></a><span class="in">kable(Bonn_QC,</span></span>
<span id="cb385-2329"><a href="#cb385-2329" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Table 11.3a: Quality control summary produced by fix_weather()",) %&gt;%</span></span>
<span id="cb385-2330"><a href="#cb385-2330" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-2331"><a href="#cb385-2331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2332"><a href="#cb385-2332" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2333"><a href="#cb385-2333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2334"><a href="#cb385-2334" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-2335"><a href="#cb385-2335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2336"><a href="#cb385-2336" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The dataset has substantial gaps between 1998 and 2004 and in 2008 (almost all values missing), and some shorter gaps in 2015, 2018 and 2020.</span>
<span id="cb385-2337"><a href="#cb385-2337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2338"><a href="#cb385-2338" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We will use data from neighbouring weather stations to patch the dataset.</span>
<span id="cb385-2339"><a href="#cb385-2339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2340"><a href="#cb385-2340" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.3b}</span></span>
<span id="cb385-2341"><a href="#cb385-2341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2342"><a href="#cb385-2342" aria-hidden="true" tabindex="-1"></a><span class="in"># Find nearby weather stations using handle_gsod()</span></span>
<span id="cb385-2343"><a href="#cb385-2343" aria-hidden="true" tabindex="-1"></a><span class="in">station_list &lt;- handle_gsod(action = "list_stations",</span></span>
<span id="cb385-2344"><a href="#cb385-2344" aria-hidden="true" tabindex="-1"></a><span class="in">                            location = c(7.10, 50.73),</span></span>
<span id="cb385-2345"><a href="#cb385-2345" aria-hidden="true" tabindex="-1"></a><span class="in">                            time_interval = c(1990, 2020))</span></span>
<span id="cb385-2346"><a href="#cb385-2346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2347"><a href="#cb385-2347" aria-hidden="true" tabindex="-1"></a><span class="in">kable(station_list,</span></span>
<span id="cb385-2348"><a href="#cb385-2348" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Table 11.3b: List of GSOD weather stations close to Bonn") %&gt;%</span></span>
<span id="cb385-2349"><a href="#cb385-2349" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-2350"><a href="#cb385-2350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2351"><a href="#cb385-2351" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2352"><a href="#cb385-2352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2353"><a href="#cb385-2353" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-2354"><a href="#cb385-2354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2355"><a href="#cb385-2355" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Many of these stations are not very useful because they only overlap with the record we already have for a few years, in some cases not at all.</span>
<span id="cb385-2356"><a href="#cb385-2356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2357"><a href="#cb385-2357" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Maybe we can combine data from multiple auxiliary stations to close all the gaps.</span>
<span id="cb385-2358"><a href="#cb385-2358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2359"><a href="#cb385-2359" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Stations that look promising are BONN-HARDTHOEHE, BONN-ROLEBER, and NORVENICH.</span>
<span id="cb385-2360"><a href="#cb385-2360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2361"><a href="#cb385-2361" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.3c}</span></span>
<span id="cb385-2362"><a href="#cb385-2362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2363"><a href="#cb385-2363" aria-hidden="true" tabindex="-1"></a><span class="in"># Download data for promising stations (position 2, 3, 6 in station_list) </span></span>
<span id="cb385-2364"><a href="#cb385-2364" aria-hidden="true" tabindex="-1"></a><span class="in"># and store them in a list.</span></span>
<span id="cb385-2365"><a href="#cb385-2365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2366"><a href="#cb385-2366" aria-hidden="true" tabindex="-1"></a><span class="in"># The handle_gsod function can download multiple files at ones, returning </span></span>
<span id="cb385-2367"><a href="#cb385-2367" aria-hidden="true" tabindex="-1"></a><span class="in"># a named list of station records.</span></span>
<span id="cb385-2368"><a href="#cb385-2368" aria-hidden="true" tabindex="-1"></a><span class="in">patch_weather &lt;- </span></span>
<span id="cb385-2369"><a href="#cb385-2369" aria-hidden="true" tabindex="-1"></a><span class="in">  handle_gsod(action = "download_weather",</span></span>
<span id="cb385-2370"><a href="#cb385-2370" aria-hidden="true" tabindex="-1"></a><span class="in">              location = as.character(station_list$chillR_code[c(2, 3, 6)]),</span></span>
<span id="cb385-2371"><a href="#cb385-2371" aria-hidden="true" tabindex="-1"></a><span class="in">              time_interval = c(1990, 2020)) %&gt;%</span></span>
<span id="cb385-2372"><a href="#cb385-2372" aria-hidden="true" tabindex="-1"></a><span class="in">  handle_gsod() # clean the downloaded data ?</span></span>
<span id="cb385-2373"><a href="#cb385-2373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2374"><a href="#cb385-2374" aria-hidden="true" tabindex="-1"></a><span class="in"># Use the list of dowloaded weather records to fill gaps in record for Bonn</span></span>
<span id="cb385-2375"><a href="#cb385-2375" aria-hidden="true" tabindex="-1"></a><span class="in">patched &lt;- patch_daily_temperatures(weather = Bonn,</span></span>
<span id="cb385-2376"><a href="#cb385-2376" aria-hidden="true" tabindex="-1"></a><span class="in">                                    patch_weather = patch_weather)</span></span>
<span id="cb385-2377"><a href="#cb385-2377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2378"><a href="#cb385-2378" aria-hidden="true" tabindex="-1"></a><span class="in"># Look at what happened by looking at `statistics` of the `patched` object</span></span>
<span id="cb385-2379"><a href="#cb385-2379" aria-hidden="true" tabindex="-1"></a><span class="in">kable(patched$statistics[[1]], </span></span>
<span id="cb385-2380"><a href="#cb385-2380" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Table 11.3c: Patch statistics for NORVENICH") %&gt;%</span></span>
<span id="cb385-2381"><a href="#cb385-2381" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-2382"><a href="#cb385-2382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2383"><a href="#cb385-2383" aria-hidden="true" tabindex="-1"></a><span class="in">kable(patched$statistics[[2]], </span></span>
<span id="cb385-2384"><a href="#cb385-2384" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Table 11.3d: Patch statistics for BONN-HARDTHOEHE") %&gt;%</span></span>
<span id="cb385-2385"><a href="#cb385-2385" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-2386"><a href="#cb385-2386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2387"><a href="#cb385-2387" aria-hidden="true" tabindex="-1"></a><span class="in">kable(patched$statistics[[3]], </span></span>
<span id="cb385-2388"><a href="#cb385-2388" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Table 11.3e: Patch statistics for BONN-ROLEBER") %&gt;%</span></span>
<span id="cb385-2389"><a href="#cb385-2389" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-2390"><a href="#cb385-2390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2391"><a href="#cb385-2391" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2392"><a href="#cb385-2392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2393"><a href="#cb385-2393" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-2394"><a href="#cb385-2394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2395"><a href="#cb385-2395" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Here we see an analysis of how similar the temperature records (separately for Tmin and Tmax) were between each auxiliary station and our station of interest in Bonn, based on days for which both stations had data.</span>
<span id="cb385-2396"><a href="#cb385-2396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2397"><a href="#cb385-2397" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Besides the number of days for which information was taken from each auxiliary station (<span class="in">`filled`</span>) and the number of gaps that remained afterwards (<span class="in">`gaps_remain`</span>), we see two quality statistics:</span>
<span id="cb385-2398"><a href="#cb385-2398" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>the mean bias (<span class="in">`mean_bias`</span>), i.e. the mean temperature difference<span class="dv">&amp;mdash;</span> easy to address by setting threshold</span>
<span id="cb385-2399"><a href="#cb385-2399" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>the standard deviation of the daily differences (<span class="in">`stdev_bias`</span>)<span class="dv">&amp;mdash;</span> more problematic as this indicates the extent of additional (possibly unsystematic) differences between stations (not sure this can be adjusted or not); so for now we should treat this as an exclusion criterion (i.e. if stdev_bias is above a certain value, we reject the station)</span>
<span id="cb385-2400"><a href="#cb385-2400" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-2401"><a href="#cb385-2401" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-2402"><a href="#cb385-2402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2403"><a href="#cb385-2403" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Let’s set some limits for both metrics, which we can pass as arguments to <span class="in">`patch_daily_temperatures()`</span> (using the max_mean_bias and max_stdev_bias parameters). </span>
<span id="cb385-2404"><a href="#cb385-2404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2405"><a href="#cb385-2405" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Let’s cap the <span class="in">`mean_bias`</span> at 1 °C and the <span class="in">`stdev_bias`</span> at 2°C, and then look at the statistics again.</span>
<span id="cb385-2406"><a href="#cb385-2406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2407"><a href="#cb385-2407" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.3d}</span></span>
<span id="cb385-2408"><a href="#cb385-2408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2409"><a href="#cb385-2409" aria-hidden="true" tabindex="-1"></a><span class="in">patched &lt;- patch_daily_temperatures(weather = Bonn,</span></span>
<span id="cb385-2410"><a href="#cb385-2410" aria-hidden="true" tabindex="-1"></a><span class="in">                                    patch_weather = patch_weather,</span></span>
<span id="cb385-2411"><a href="#cb385-2411" aria-hidden="true" tabindex="-1"></a><span class="in">                                    max_mean_bias = 1,</span></span>
<span id="cb385-2412"><a href="#cb385-2412" aria-hidden="true" tabindex="-1"></a><span class="in">                                    max_stdev_bias = 2)</span></span>
<span id="cb385-2413"><a href="#cb385-2413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2414"><a href="#cb385-2414" aria-hidden="true" tabindex="-1"></a><span class="in">kable(patched$statistics[[1]], </span></span>
<span id="cb385-2415"><a href="#cb385-2415" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Table 11.3f: Patch statistics for NORVENICH") %&gt;%</span></span>
<span id="cb385-2416"><a href="#cb385-2416" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-2417"><a href="#cb385-2417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2418"><a href="#cb385-2418" aria-hidden="true" tabindex="-1"></a><span class="in">kable(patched$statistics[[2]], </span></span>
<span id="cb385-2419"><a href="#cb385-2419" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Table 11.3g: Patch statistics for BONN-HARDTHOEHE") %&gt;%</span></span>
<span id="cb385-2420"><a href="#cb385-2420" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-2421"><a href="#cb385-2421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2422"><a href="#cb385-2422" aria-hidden="true" tabindex="-1"></a><span class="in">kable(patched$statistics[[3]], </span></span>
<span id="cb385-2423"><a href="#cb385-2423" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Table 11.3h: Patch statistics for BONN-ROLEBER") %&gt;%</span></span>
<span id="cb385-2424"><a href="#cb385-2424" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-2425"><a href="#cb385-2425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2426"><a href="#cb385-2426" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2427"><a href="#cb385-2427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2428"><a href="#cb385-2428" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-2429"><a href="#cb385-2429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2430"><a href="#cb385-2430" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>All records from BONN-HARDTHOEHE, as well as the <span class="in">`Tmax`</span> records from BONN-ROLEBER were rejected, because they didn’t pass the <span class="in">`mean_bias`</span> filter.</span>
<span id="cb385-2431"><a href="#cb385-2431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2432"><a href="#cb385-2432" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Data from NORVENICH are pretty good<span class="dv">&amp;mdash;</span> fill 2146 gaps for <span class="in">`Tmin`</span> and 2146 for <span class="in">`Tmax`</span>. Only 1 and 1 gaps remain for Tmin and Tmax, respectively.</span>
<span id="cb385-2433"><a href="#cb385-2433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2434"><a href="#cb385-2434" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use <span class="in">`fix_weather()`</span> function to take a look at where the remaining gaps are:</span>
<span id="cb385-2435"><a href="#cb385-2435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2436"><a href="#cb385-2436" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.3e}</span></span>
<span id="cb385-2437"><a href="#cb385-2437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2438"><a href="#cb385-2438" aria-hidden="true" tabindex="-1"></a><span class="in">post_patch_stats &lt;- fix_weather(patched)$QC</span></span>
<span id="cb385-2439"><a href="#cb385-2439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2440"><a href="#cb385-2440" aria-hidden="true" tabindex="-1"></a><span class="in">kable(post_patch_stats, </span></span>
<span id="cb385-2441"><a href="#cb385-2441" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Table 11.3i: Data completeness table for the weather record </span></span>
<span id="cb385-2442"><a href="#cb385-2442" aria-hidden="true" tabindex="-1"></a><span class="in">      from Bonn, after applying the patch procedure") %&gt;%</span></span>
<span id="cb385-2443"><a href="#cb385-2443" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-2444"><a href="#cb385-2444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2445"><a href="#cb385-2445" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2446"><a href="#cb385-2446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2447"><a href="#cb385-2447" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-2448"><a href="#cb385-2448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2449"><a href="#cb385-2449" aria-hidden="true" tabindex="-1"></a><span class="ss">-  </span>Almost all gaps are filled, with only data for 1 day missing after the patching. It seems safe to use linear interpolation for such a short gap, by applying the <span class="in">`fix_weather()`</span> function.</span>
<span id="cb385-2450"><a href="#cb385-2450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2451"><a href="#cb385-2451" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.3f}</span></span>
<span id="cb385-2452"><a href="#cb385-2452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2453"><a href="#cb385-2453" aria-hidden="true" tabindex="-1"></a><span class="in"># Linear interpoloation to fix a short gap of one day</span></span>
<span id="cb385-2454"><a href="#cb385-2454" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_weather &lt;- fix_weather(patched)</span></span>
<span id="cb385-2455"><a href="#cb385-2455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2456"><a href="#cb385-2456" aria-hidden="true" tabindex="-1"></a><span class="in">post_patch_stats_2 &lt;- fix_weather(Bonn_weather)$QC</span></span>
<span id="cb385-2457"><a href="#cb385-2457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2458"><a href="#cb385-2458" aria-hidden="true" tabindex="-1"></a><span class="in">kable(post_patch_stats_2, </span></span>
<span id="cb385-2459"><a href="#cb385-2459" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Table 11.3j: Data completeness table for the weather record </span></span>
<span id="cb385-2460"><a href="#cb385-2460" aria-hidden="true" tabindex="-1"></a><span class="in">      from Bonn, after applying the linear interpolation") %&gt;%</span></span>
<span id="cb385-2461"><a href="#cb385-2461" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-2462"><a href="#cb385-2462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2463"><a href="#cb385-2463" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2464"><a href="#cb385-2464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2465"><a href="#cb385-2465" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-2466"><a href="#cb385-2466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2467"><a href="#cb385-2467" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;11.3.1&lt;/span&gt;&amp;nbsp; Bias-correction for shorter intervals</span></span>
<span id="cb385-2468"><a href="#cb385-2468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2469"><a href="#cb385-2469" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-2470"><a href="#cb385-2470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2471"><a href="#cb385-2471" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In the <span class="in">`patch_daily_temperatures`</span> function, the bias correction is based on the average difference between the temperatures of a pair of weather stations over the entire year.</span>
<span id="cb385-2472"><a href="#cb385-2472" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>The between-station bias can varies throughout the year. </span>
<span id="cb385-2473"><a href="#cb385-2473" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>A particular station is useful data source for temperatures in certain seasons but not in others.</span>
<span id="cb385-2474"><a href="#cb385-2474" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>So, different bias corrections during different parts of the year give better approximations (smaller biases) than the bias correction for the entire year<span class="dv">&amp;mdash;</span> use <span class="in">`patch_daily_temps`</span> (not <span class="in">`patch_daily_temperatures`</span>)</span>
<span id="cb385-2475"><a href="#cb385-2475" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-2476"><a href="#cb385-2476" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-2477"><a href="#cb385-2477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2478"><a href="#cb385-2478" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The <span class="in">`patch_daily_temps`</span> function, as a default, evaluates temperature records on a monthly basis, i.e. it makes separate between-station comparisons for the temperatures of each calendar month.</span>
<span id="cb385-2479"><a href="#cb385-2479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2480"><a href="#cb385-2480" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It can then take separate decisions on whether a potential auxiliary station is a useful proxy for temperatures in this monthly interval, and it can apply month-specific bias correction.</span>
<span id="cb385-2481"><a href="#cb385-2481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2482"><a href="#cb385-2482" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.3.1a}</span></span>
<span id="cb385-2483"><a href="#cb385-2483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2484"><a href="#cb385-2484" aria-hidden="true" tabindex="-1"></a><span class="in">patched_monthly &lt;- patch_daily_temps(weather = Bonn,</span></span>
<span id="cb385-2485"><a href="#cb385-2485" aria-hidden="true" tabindex="-1"></a><span class="in">                                     patch_weather = patch_weather,</span></span>
<span id="cb385-2486"><a href="#cb385-2486" aria-hidden="true" tabindex="-1"></a><span class="in">                                     max_mean_bias = 1,</span></span>
<span id="cb385-2487"><a href="#cb385-2487" aria-hidden="true" tabindex="-1"></a><span class="in">                                     max_stdev_bias = 2,</span></span>
<span id="cb385-2488"><a href="#cb385-2488" aria-hidden="true" tabindex="-1"></a><span class="in">                                     time_interval = "month")</span></span>
<span id="cb385-2489"><a href="#cb385-2489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2490"><a href="#cb385-2490" aria-hidden="true" tabindex="-1"></a><span class="in"># Finding for minimum temperatures for the NORVENICH station</span></span>
<span id="cb385-2491"><a href="#cb385-2491" aria-hidden="true" tabindex="-1"></a><span class="in">kable(patched_monthly$statistics$Tmin$NORVENICH,</span></span>
<span id="cb385-2492"><a href="#cb385-2492" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Table 11.3.1a: Bias analysis table for the first station in the</span></span>
<span id="cb385-2493"><a href="#cb385-2493" aria-hidden="true" tabindex="-1"></a><span class="in">      proxy station list, showing biases on a monthly level") %&gt;%</span></span>
<span id="cb385-2494"><a href="#cb385-2494" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-2495"><a href="#cb385-2495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2496"><a href="#cb385-2496" aria-hidden="true" tabindex="-1"></a><span class="in"># The mean bias really varies quite a bit here- probably benefit from a </span></span>
<span id="cb385-2497"><a href="#cb385-2497" aria-hidden="true" tabindex="-1"></a><span class="in"># month-specific bias correction. </span></span>
<span id="cb385-2498"><a href="#cb385-2498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2499"><a href="#cb385-2499" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2500"><a href="#cb385-2500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2501"><a href="#cb385-2501" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-2502"><a href="#cb385-2502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2503"><a href="#cb385-2503" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The <span class="in">`time_interval`</span> parameter of the <span class="in">`patch_daily_temps`</span> function allows us to specify the interval, i.e. either month or week or multiple of these, such as <span class="in">`10 days`</span> or <span class="in">`2 weeks`</span>.</span>
<span id="cb385-2504"><a href="#cb385-2504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2505"><a href="#cb385-2505" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Note that the function starts counting these intervals on 1^st^ January in each year<span class="dv">&amp;mdash;</span> lead to intervals at the end of the year that are smaller than the interval you selected ***(this generates warnings, as you can see below).***</span>
<span id="cb385-2506"><a href="#cb385-2506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2507"><a href="#cb385-2507" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Note also that the smaller these intervals get, the less data can be used for determining the bias. Especially for short time series, a very short interval may therefore not be desirable.</span>
<span id="cb385-2508"><a href="#cb385-2508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2509"><a href="#cb385-2509" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.3.1b, warning=TRUE}</span></span>
<span id="cb385-2510"><a href="#cb385-2510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2511"><a href="#cb385-2511" aria-hidden="true" tabindex="-1"></a><span class="in"># Warning for very short interval (shorter than specified)</span></span>
<span id="cb385-2512"><a href="#cb385-2512" aria-hidden="true" tabindex="-1"></a><span class="in">patch_2weeks &lt;- patch_daily_temps(weather = Bonn,</span></span>
<span id="cb385-2513"><a href="#cb385-2513" aria-hidden="true" tabindex="-1"></a><span class="in">                                  patch_weather = patch_weather,</span></span>
<span id="cb385-2514"><a href="#cb385-2514" aria-hidden="true" tabindex="-1"></a><span class="in">                                  max_mean_bias = 1,</span></span>
<span id="cb385-2515"><a href="#cb385-2515" aria-hidden="true" tabindex="-1"></a><span class="in">                                  max_stdev_bias = 2,</span></span>
<span id="cb385-2516"><a href="#cb385-2516" aria-hidden="true" tabindex="-1"></a><span class="in">                                  time_interval = "2 weeks")</span></span>
<span id="cb385-2517"><a href="#cb385-2517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2518"><a href="#cb385-2518" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2519"><a href="#cb385-2519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2520"><a href="#cb385-2520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2521"><a href="#cb385-2521" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-2522"><a href="#cb385-2522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2523"><a href="#cb385-2523" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To illustrate the effects of this, let’s create 5000 gaps in the Bonn weather record and fill them with proxy data using annual, monthly and bi-weekly intervals for the bias evaluation. </span>
<span id="cb385-2524"><a href="#cb385-2524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2525"><a href="#cb385-2525" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.3.1c}</span></span>
<span id="cb385-2526"><a href="#cb385-2526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2527"><a href="#cb385-2527" aria-hidden="true" tabindex="-1"></a><span class="in">Gaps &lt;- sample(seq(1:nrow(Bonn)), size = 5000, replace = FALSE) # no duplicate indices</span></span>
<span id="cb385-2528"><a href="#cb385-2528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2529"><a href="#cb385-2529" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_gaps &lt;- Bonn %&gt;% mutate(obs_Tmin = Tmin,</span></span>
<span id="cb385-2530"><a href="#cb385-2530" aria-hidden="true" tabindex="-1"></a><span class="in">                             obs_Tmax = Tmax)</span></span>
<span id="cb385-2531"><a href="#cb385-2531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2532"><a href="#cb385-2532" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_gaps$Tmin[Gaps] &lt;- NA</span></span>
<span id="cb385-2533"><a href="#cb385-2533" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_gaps$Tmax[Gaps] &lt;- NA</span></span>
<span id="cb385-2534"><a href="#cb385-2534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2535"><a href="#cb385-2535" aria-hidden="true" tabindex="-1"></a><span class="in">patch_annual &lt;- patch_daily_temps(weather = Bonn_gaps,</span></span>
<span id="cb385-2536"><a href="#cb385-2536" aria-hidden="true" tabindex="-1"></a><span class="in">                                  patch_weather = patch_weather,</span></span>
<span id="cb385-2537"><a href="#cb385-2537" aria-hidden="true" tabindex="-1"></a><span class="in">                                  max_mean_bias = 1,</span></span>
<span id="cb385-2538"><a href="#cb385-2538" aria-hidden="true" tabindex="-1"></a><span class="in">                                  max_stdev_bias = 2,</span></span>
<span id="cb385-2539"><a href="#cb385-2539" aria-hidden="true" tabindex="-1"></a><span class="in">                                  time_interval = "year")</span></span>
<span id="cb385-2540"><a href="#cb385-2540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2541"><a href="#cb385-2541" aria-hidden="true" tabindex="-1"></a><span class="in">patch_month &lt;- patch_daily_temps(weather = Bonn_gaps,</span></span>
<span id="cb385-2542"><a href="#cb385-2542" aria-hidden="true" tabindex="-1"></a><span class="in">                                 patch_weather = patch_weather,</span></span>
<span id="cb385-2543"><a href="#cb385-2543" aria-hidden="true" tabindex="-1"></a><span class="in">                                 max_mean_bias = 1,</span></span>
<span id="cb385-2544"><a href="#cb385-2544" aria-hidden="true" tabindex="-1"></a><span class="in">                                 max_stdev_bias = 2,</span></span>
<span id="cb385-2545"><a href="#cb385-2545" aria-hidden="true" tabindex="-1"></a><span class="in">                                 time_interval = "month")</span></span>
<span id="cb385-2546"><a href="#cb385-2546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2547"><a href="#cb385-2547" aria-hidden="true" tabindex="-1"></a><span class="in">patch_2weeks &lt;- patch_daily_temps(weather = Bonn_gaps,</span></span>
<span id="cb385-2548"><a href="#cb385-2548" aria-hidden="true" tabindex="-1"></a><span class="in">                                  patch_weather = patch_weather,</span></span>
<span id="cb385-2549"><a href="#cb385-2549" aria-hidden="true" tabindex="-1"></a><span class="in">                                  max_mean_bias = 1,</span></span>
<span id="cb385-2550"><a href="#cb385-2550" aria-hidden="true" tabindex="-1"></a><span class="in">                                  max_stdev_bias = 2,</span></span>
<span id="cb385-2551"><a href="#cb385-2551" aria-hidden="true" tabindex="-1"></a><span class="in">                                  time_interval = "2 weeks")</span></span>
<span id="cb385-2552"><a href="#cb385-2552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2553"><a href="#cb385-2553" aria-hidden="true" tabindex="-1"></a><span class="in"># Add new column values of difference between observed and patched values</span></span>
<span id="cb385-2554"><a href="#cb385-2554" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_gaps[,"Tmin_annual"] &lt;- Bonn_gaps$obs_Tmin - patch_annual$weather$Tmin</span></span>
<span id="cb385-2555"><a href="#cb385-2555" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_gaps[,"Tmax_annual"] &lt;- Bonn_gaps$obs_Tmax - patch_annual$weather$Tmax</span></span>
<span id="cb385-2556"><a href="#cb385-2556" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_gaps[,"Tmin_month"] &lt;- Bonn_gaps$obs_Tmin - patch_month$weather$Tmin</span></span>
<span id="cb385-2557"><a href="#cb385-2557" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_gaps[,"Tmax_month"] &lt;- Bonn_gaps$obs_Tmax - patch_month$weather$Tmax</span></span>
<span id="cb385-2558"><a href="#cb385-2558" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_gaps[,"Tmin_2weeks"] &lt;- Bonn_gaps$obs_Tmin - patch_2weeks$weather$Tmin</span></span>
<span id="cb385-2559"><a href="#cb385-2559" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_gaps[,"Tmax_2weeks"] &lt;- Bonn_gaps$obs_Tmax - patch_2weeks$weather$Tmax</span></span>
<span id="cb385-2560"><a href="#cb385-2560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2561"><a href="#cb385-2561" aria-hidden="true" tabindex="-1"></a><span class="in"># Modify data for ggplotting</span></span>
<span id="cb385-2562"><a href="#cb385-2562" aria-hidden="true" tabindex="-1"></a><span class="in">Interval_eval &lt;- Bonn_gaps %&gt;%</span></span>
<span id="cb385-2563"><a href="#cb385-2563" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(is.na(Tmin)) %&gt;% # only choose when Tmin is NA</span></span>
<span id="cb385-2564"><a href="#cb385-2564" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_longer(Tmin_annual:Tmax_2weeks) %&gt;% # stack columns into rows under name</span></span>
<span id="cb385-2565"><a href="#cb385-2565" aria-hidden="true" tabindex="-1"></a><span class="in">    # create a new Type column as a factor to have specific order for plotting,</span></span>
<span id="cb385-2566"><a href="#cb385-2566" aria-hidden="true" tabindex="-1"></a><span class="in">    # rather than default alphabetical sorting</span></span>
<span id="cb385-2567"><a href="#cb385-2567" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Type=factor(name,</span></span>
<span id="cb385-2568"><a href="#cb385-2568" aria-hidden="true" tabindex="-1"></a><span class="in">                     levels = c("Tmin_annual",</span></span>
<span id="cb385-2569"><a href="#cb385-2569" aria-hidden="true" tabindex="-1"></a><span class="in">                                "Tmin_month",</span></span>
<span id="cb385-2570"><a href="#cb385-2570" aria-hidden="true" tabindex="-1"></a><span class="in">                                "Tmin_2weeks",</span></span>
<span id="cb385-2571"><a href="#cb385-2571" aria-hidden="true" tabindex="-1"></a><span class="in">                                "Tmax_annual",</span></span>
<span id="cb385-2572"><a href="#cb385-2572" aria-hidden="true" tabindex="-1"></a><span class="in">                                "Tmax_month",</span></span>
<span id="cb385-2573"><a href="#cb385-2573" aria-hidden="true" tabindex="-1"></a><span class="in">                                "Tmax_2weeks")) )</span></span>
<span id="cb385-2574"><a href="#cb385-2574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2575"><a href="#cb385-2575" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the resulting errors with ggplot2 using a violin plot</span></span>
<span id="cb385-2576"><a href="#cb385-2576" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(Interval_eval,</span></span>
<span id="cb385-2577"><a href="#cb385-2577" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(Type, value)) +</span></span>
<span id="cb385-2578"><a href="#cb385-2578" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_violin(draw_quantiles = c(0.25, 0.5, 0.75)) +</span></span>
<span id="cb385-2579"><a href="#cb385-2579" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Variable and bias evaluation interval") +</span></span>
<span id="cb385-2580"><a href="#cb385-2580" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Prediction error")</span></span>
<span id="cb385-2581"><a href="#cb385-2581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2582"><a href="#cb385-2582" aria-hidden="true" tabindex="-1"></a><span class="in"># Also evaluate the mean daily error</span></span>
<span id="cb385-2583"><a href="#cb385-2583" aria-hidden="true" tabindex="-1"></a><span class="in">error_eval &lt;- </span></span>
<span id="cb385-2584"><a href="#cb385-2584" aria-hidden="true" tabindex="-1"></a><span class="in">  data.frame(Variable = c(rep("Tmin", 3), rep("Tmax", 3)),</span></span>
<span id="cb385-2585"><a href="#cb385-2585" aria-hidden="true" tabindex="-1"></a><span class="in">             Interval = rep(c("Year", "Month", "Two weeks"), 2),</span></span>
<span id="cb385-2586"><a href="#cb385-2586" aria-hidden="true" tabindex="-1"></a><span class="in">             Error = c(</span></span>
<span id="cb385-2587"><a href="#cb385-2587" aria-hidden="true" tabindex="-1"></a><span class="in">  # Get absolute mean of temps differences for rows with missing values in Tmin/max</span></span>
<span id="cb385-2588"><a href="#cb385-2588" aria-hidden="true" tabindex="-1"></a><span class="in">               # na.rm set to TRUE to ignore any NA values in the vector</span></span>
<span id="cb385-2589"><a href="#cb385-2589" aria-hidden="true" tabindex="-1"></a><span class="in">               # na.rm set to FALSE will return NA if there are NA values in data</span></span>
<span id="cb385-2590"><a href="#cb385-2590" aria-hidden="true" tabindex="-1"></a><span class="in">               mean(abs(Bonn_gaps$Tmin_annual[is.na(Bonn_gaps$Tmin)]), na.rm = TRUE),</span></span>
<span id="cb385-2591"><a href="#cb385-2591" aria-hidden="true" tabindex="-1"></a><span class="in">               mean(abs(Bonn_gaps$Tmin_month[is.na(Bonn_gaps$Tmin)]), na.rm = TRUE),</span></span>
<span id="cb385-2592"><a href="#cb385-2592" aria-hidden="true" tabindex="-1"></a><span class="in">               mean(abs(Bonn_gaps$Tmin_2weeks[is.na(Bonn_gaps$Tmin)]),na.rm=TRUE),</span></span>
<span id="cb385-2593"><a href="#cb385-2593" aria-hidden="true" tabindex="-1"></a><span class="in">               mean(abs(Bonn_gaps$Tmax_annual[is.na(Bonn_gaps$Tmin)]),na.rm=TRUE),</span></span>
<span id="cb385-2594"><a href="#cb385-2594" aria-hidden="true" tabindex="-1"></a><span class="in">               mean(abs(Bonn_gaps$Tmax_month[is.na(Bonn_gaps$Tmin)]),na.rm=TRUE),</span></span>
<span id="cb385-2595"><a href="#cb385-2595" aria-hidden="true" tabindex="-1"></a><span class="in">               mean(abs(Bonn_gaps$Tmax_2weeks[is.na(Bonn_gaps$Tmin)]),na.rm=TRUE))</span></span>
<span id="cb385-2596"><a href="#cb385-2596" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb385-2597"><a href="#cb385-2597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2598"><a href="#cb385-2598" aria-hidden="true" tabindex="-1"></a><span class="in">kable(error_eval, </span></span>
<span id="cb385-2599"><a href="#cb385-2599" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Table 11.3.1b: Mean absolute prediction error for minimun and </span></span>
<span id="cb385-2600"><a href="#cb385-2600" aria-hidden="true" tabindex="-1"></a><span class="in">      maximum temperature when using different time intervals as a basis for</span></span>
<span id="cb385-2601"><a href="#cb385-2601" aria-hidden="true" tabindex="-1"></a><span class="in">      correcting for between-station biases") %&gt;%</span></span>
<span id="cb385-2602"><a href="#cb385-2602" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-2603"><a href="#cb385-2603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2604"><a href="#cb385-2604" aria-hidden="true" tabindex="-1"></a><span class="in"># The improvement isn't very impressive here, possibly because the stations used</span></span>
<span id="cb385-2605"><a href="#cb385-2605" aria-hidden="true" tabindex="-1"></a><span class="in"># are quite close to each other and the weather doesn't differ much between them.</span></span>
<span id="cb385-2606"><a href="#cb385-2606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2607"><a href="#cb385-2607" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2608"><a href="#cb385-2608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2609"><a href="#cb385-2609" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-2610"><a href="#cb385-2610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2611"><a href="#cb385-2611" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;11.3.2&lt;/span&gt;&amp;nbsp; Saving the data for later</span></span>
<span id="cb385-2612"><a href="#cb385-2612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2613"><a href="#cb385-2613" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-2614"><a href="#cb385-2614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2615"><a href="#cb385-2615" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Save for later the fairly convincing long-term record (from 1990 to 2020) for Bonn, with no remaining gaps.</span>
<span id="cb385-2616"><a href="#cb385-2616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2617"><a href="#cb385-2617" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.3.2}</span></span>
<span id="cb385-2618"><a href="#cb385-2618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2619"><a href="#cb385-2619" aria-hidden="true" tabindex="-1"></a><span class="in"># Choose the dataset with bias correction on monthly intervals-</span></span>
<span id="cb385-2620"><a href="#cb385-2620" aria-hidden="true" tabindex="-1"></a><span class="in"># still need to interpolate the one missing day, before saving the record</span></span>
<span id="cb385-2621"><a href="#cb385-2621" aria-hidden="true" tabindex="-1"></a><span class="in">monthly_bias_fixed &lt;- fix_weather(patched_monthly)</span></span>
<span id="cb385-2622"><a href="#cb385-2622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2623"><a href="#cb385-2623" aria-hidden="true" tabindex="-1"></a><span class="in"># Save the record for weather element only- the data.frame that can easily be</span></span>
<span id="cb385-2624"><a href="#cb385-2624" aria-hidden="true" tabindex="-1"></a><span class="in"># saved as a spreadsheet table (.csv file).</span></span>
<span id="cb385-2625"><a href="#cb385-2625" aria-hidden="true" tabindex="-1"></a><span class="in"># We can also save list (including the QC element) but it is a bit more</span></span>
<span id="cb385-2626"><a href="#cb385-2626" aria-hidden="true" tabindex="-1"></a><span class="in"># complicated- save it for later.</span></span>
<span id="cb385-2627"><a href="#cb385-2627" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(monthly_bias_fixed$weather,</span></span>
<span id="cb385-2628"><a href="#cb385-2628" aria-hidden="true" tabindex="-1"></a><span class="in">          "data/Bonn/Bonn_weather.csv")</span></span>
<span id="cb385-2629"><a href="#cb385-2629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2630"><a href="#cb385-2630" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2631"><a href="#cb385-2631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2632"><a href="#cb385-2632" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-2633"><a href="#cb385-2633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2634"><a href="#cb385-2634" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;11.4&lt;/span&gt;&amp;nbsp; Filling gaps in hourly records</span></span>
<span id="cb385-2635"><a href="#cb385-2635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2636"><a href="#cb385-2636" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-2637"><a href="#cb385-2637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2638"><a href="#cb385-2638" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Gaps in hourly records are a lot harder to handle, because linear interpolation usually isn't an option.</span>
<span id="cb385-2639"><a href="#cb385-2639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2640"><a href="#cb385-2640" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This works for very short gaps only, but it’s probably quite obvious that for gaps that extend over multiple days, you can’t just connect the start and end points with a straight line<span class="dv">&amp;mdash;</span> makes it hard to use hourly records, even when they are available.</span>
<span id="cb385-2641"><a href="#cb385-2641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2642"><a href="#cb385-2642" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">(Luedeling, 2018)</span><span class="co">](https://link.springer.com/article/10.1007/s00484-018-1582-7)</span> found a solution to make use of hourly data in such cases.</span>
<span id="cb385-2643"><a href="#cb385-2643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2644"><a href="#cb385-2644" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In principle, having an actual record of hourly temperatures is preferable to deriving hourly data from daily records, but it may cause problems when the record isn't complete, e.g. <span class="in">`Winters_hours_gaps`</span> dataset.</span>
<span id="cb385-2645"><a href="#cb385-2645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2646"><a href="#cb385-2646" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Such situations arise quite often, because temperature loggers can temporarily fail for many reasons.</span>
<span id="cb385-2647"><a href="#cb385-2647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2648"><a href="#cb385-2648" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.4}</span></span>
<span id="cb385-2649"><a href="#cb385-2649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2650"><a href="#cb385-2650" aria-hidden="true" tabindex="-1"></a><span class="in"># See what happens when we use linear interpolation for Winters_hours_gaps</span></span>
<span id="cb385-2651"><a href="#cb385-2651" aria-hidden="true" tabindex="-1"></a><span class="in"># Select rows to match the chart in coursebook</span></span>
<span id="cb385-2652"><a href="#cb385-2652" aria-hidden="true" tabindex="-1"></a><span class="in">gap_Winters &lt;- Winters_hours_gaps[39:350, ]</span></span>
<span id="cb385-2653"><a href="#cb385-2653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2654"><a href="#cb385-2654" aria-hidden="true" tabindex="-1"></a><span class="in"># Add date in chillR format (for plotting)</span></span>
<span id="cb385-2655"><a href="#cb385-2655" aria-hidden="true" tabindex="-1"></a><span class="in">gap_Winters &lt;- add_date(gap_Winters)</span></span>
<span id="cb385-2656"><a href="#cb385-2656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2657"><a href="#cb385-2657" aria-hidden="true" tabindex="-1"></a><span class="in"># View(gap_Winters)</span></span>
<span id="cb385-2658"><a href="#cb385-2658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2659"><a href="#cb385-2659" aria-hidden="true" tabindex="-1"></a><span class="in"># Create Tmin and Tmax columns to comply with chillR data format</span></span>
<span id="cb385-2660"><a href="#cb385-2660" aria-hidden="true" tabindex="-1"></a><span class="in">gap_Winters[, "Tmin"] &lt;- gap_Winters$Temp_gaps</span></span>
<span id="cb385-2661"><a href="#cb385-2661" aria-hidden="true" tabindex="-1"></a><span class="in">gap_Winters[, "Tmin_observed"] &lt;- gap_Winters$Temp</span></span>
<span id="cb385-2662"><a href="#cb385-2662" aria-hidden="true" tabindex="-1"></a><span class="in">gap_Winters[, "Tmax"] &lt;- gap_Winters$Temp # just placeholder</span></span>
<span id="cb385-2663"><a href="#cb385-2663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2664"><a href="#cb385-2664" aria-hidden="true" tabindex="-1"></a><span class="in"># View(gap_Winters)</span></span>
<span id="cb385-2665"><a href="#cb385-2665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2666"><a href="#cb385-2666" aria-hidden="true" tabindex="-1"></a><span class="in"># Interpolate the gaps in Temp_gaps</span></span>
<span id="cb385-2667"><a href="#cb385-2667" aria-hidden="true" tabindex="-1"></a><span class="in">Temp_int &lt;- interpolate_gaps(gap_Winters[, "Tmin"])</span></span>
<span id="cb385-2668"><a href="#cb385-2668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2669"><a href="#cb385-2669" aria-hidden="true" tabindex="-1"></a><span class="in"># Add interpolated Temp to the dataset</span></span>
<span id="cb385-2670"><a href="#cb385-2670" aria-hidden="true" tabindex="-1"></a><span class="in">weather_Winters &lt;- gap_Winters %&gt;% </span></span>
<span id="cb385-2671"><a href="#cb385-2671" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Temp_interpolated = Temp_int$interp,</span></span>
<span id="cb385-2672"><a href="#cb385-2672" aria-hidden="true" tabindex="-1"></a><span class="in">         Temps_interpolated = Temp_int$missing)</span></span>
<span id="cb385-2673"><a href="#cb385-2673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2674"><a href="#cb385-2674" aria-hidden="true" tabindex="-1"></a><span class="in"># View(weather_Winters)</span></span>
<span id="cb385-2675"><a href="#cb385-2675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2676"><a href="#cb385-2676" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the result</span></span>
<span id="cb385-2677"><a href="#cb385-2677" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = weather_Winters[4:260, ], aes(Date)) +</span></span>
<span id="cb385-2678"><a href="#cb385-2678" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(aes(y = Tmin_observed, color = "Temp Observed"), lwd = 1.3) +</span></span>
<span id="cb385-2679"><a href="#cb385-2679" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(aes(y = Temp_interpolated, color = "Temp Interpolated"), lwd = 1.3) +</span></span>
<span id="cb385-2680"><a href="#cb385-2680" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(</span></span>
<span id="cb385-2681"><a href="#cb385-2681" aria-hidden="true" tabindex="-1"></a><span class="in">    values = c("Temp Observed" = "black", "Temp Interpolated" = "red"),</span></span>
<span id="cb385-2682"><a href="#cb385-2682" aria-hidden="true" tabindex="-1"></a><span class="in">    name = "Legend"</span></span>
<span id="cb385-2683"><a href="#cb385-2683" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb385-2684"><a href="#cb385-2684" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Date") +</span></span>
<span id="cb385-2685"><a href="#cb385-2685" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Temperature (°C)")</span></span>
<span id="cb385-2686"><a href="#cb385-2686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2687"><a href="#cb385-2687" aria-hidden="true" tabindex="-1"></a><span class="in"># In this interpolation, some daytime or nighttime cycles were missed entirely, </span></span>
<span id="cb385-2688"><a href="#cb385-2688" aria-hidden="true" tabindex="-1"></a><span class="in"># which can lead to substantial errors when calculating agroclimatic metrics, </span></span>
<span id="cb385-2689"><a href="#cb385-2689" aria-hidden="true" tabindex="-1"></a><span class="in"># such as chill or heat stress, that are of particular concern during the </span></span>
<span id="cb385-2690"><a href="#cb385-2690" aria-hidden="true" tabindex="-1"></a><span class="in"># warmest and coolest parts of the day.</span></span>
<span id="cb385-2691"><a href="#cb385-2691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2692"><a href="#cb385-2692" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2693"><a href="#cb385-2693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2694"><a href="#cb385-2694" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-2695"><a href="#cb385-2695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2696"><a href="#cb385-2696" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`interpolate_gaps_hourly()`</span> can produce credible and continuous hourly records from a patchy dataset. It can also derive daily temperature extremes from hourly data that were recorded. Rough mode of operation:</span>
<span id="cb385-2697"><a href="#cb385-2697" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Express temperatures for each hour as a function of daily temperature extremes using the functions of <span class="co">[</span><span class="ot">Linvill (1990).</span><span class="co">](https://journals.ashs.org/hortsci/view/journals/hortsci/25/1/article-p14.xml)</span> According to this idealized curve, all hourly temperatures can be expressed as a function of <span class="in">`Tmin`</span> and <span class="in">`Tmax`</span> on the previous, same or next day of the temperature record (depending on which hour is of interest). For a day with a complete record, 24 equations can be set up.</span>
<span id="cb385-2698"><a href="#cb385-2698" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>For each daily temperature extreme, empirically solve the system of all equations that contain the respective <span class="in">`Tmin`</span> or <span class="in">`Tmax`</span> variable (this is only attempted, when a minimum of 5 equations are available, to avoid spurious results).</span>
<span id="cb385-2699"><a href="#cb385-2699" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Close gaps in the resulting dataset of daily Tmin and Tmax using data from proxy stations or, as a last resort, linear interpolation.</span>
<span id="cb385-2700"><a href="#cb385-2700" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Compute idealized temperature curves from the now continuous record of daily <span class="in">`Tmin`</span> and <span class="in">`Tmax`</span> values.</span>
<span id="cb385-2701"><a href="#cb385-2701" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Calculate the difference between recorded temperatures and this idealized curve.</span>
<span id="cb385-2702"><a href="#cb385-2702" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Linearly interpolate this difference and add then result to the idealized temperature curve.</span>
<span id="cb385-2703"><a href="#cb385-2703" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-2704"><a href="#cb385-2704" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-2705"><a href="#cb385-2705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2706"><a href="#cb385-2706" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.4a, eval=FALSE}</span></span>
<span id="cb385-2707"><a href="#cb385-2707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2708"><a href="#cb385-2708" aria-hidden="true" tabindex="-1"></a><span class="in"># See how this function works on the Winters dataset, using daily data from </span></span>
<span id="cb385-2709"><a href="#cb385-2709" aria-hidden="true" tabindex="-1"></a><span class="in"># a nearby station of the California Irrigation Management Information System </span></span>
<span id="cb385-2710"><a href="#cb385-2710" aria-hidden="true" tabindex="-1"></a><span class="in"># (CIMIS) as a proxy.  </span></span>
<span id="cb385-2711"><a href="#cb385-2711" aria-hidden="true" tabindex="-1"></a><span class="in"># Usually can't download coz of server fails to connect</span></span>
<span id="cb385-2712"><a href="#cb385-2712" aria-hidden="true" tabindex="-1"></a><span class="in">stations &lt;- handle_cimis("list_stations", # handle_cimis is similar to handle_gsod</span></span>
<span id="cb385-2713"><a href="#cb385-2713" aria-hidden="true" tabindex="-1"></a><span class="in">                         location = c(-122,38.5))</span></span>
<span id="cb385-2714"><a href="#cb385-2714" aria-hidden="true" tabindex="-1"></a><span class="in">downloaded_winters &lt;- handle_cimis("download_weather",</span></span>
<span id="cb385-2715"><a href="#cb385-2715" aria-hidden="true" tabindex="-1"></a><span class="in">                                   stations$chillR_code[2],</span></span>
<span id="cb385-2716"><a href="#cb385-2716" aria-hidden="true" tabindex="-1"></a><span class="in">                                   time_interval = c(2008,2008))</span></span>
<span id="cb385-2717"><a href="#cb385-2717" aria-hidden="true" tabindex="-1"></a><span class="in">winters_daily &lt;- handle_cimis(downloaded_winters)$weather</span></span>
<span id="cb385-2718"><a href="#cb385-2718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2719"><a href="#cb385-2719" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2720"><a href="#cb385-2720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2721"><a href="#cb385-2721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2722"><a href="#cb385-2722" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We will use a provided dataset instead. </span>
<span id="cb385-2723"><a href="#cb385-2723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2724"><a href="#cb385-2724" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.4b}</span></span>
<span id="cb385-2725"><a href="#cb385-2725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2726"><a href="#cb385-2726" aria-hidden="true" tabindex="-1"></a><span class="in"># So, we use a ready-made dataset</span></span>
<span id="cb385-2727"><a href="#cb385-2727" aria-hidden="true" tabindex="-1"></a><span class="in">winters_daily &lt;- read.csv("data/OT/winters_daily.csv")</span></span>
<span id="cb385-2728"><a href="#cb385-2728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2729"><a href="#cb385-2729" aria-hidden="true" tabindex="-1"></a><span class="in"># View the dataset</span></span>
<span id="cb385-2730"><a href="#cb385-2730" aria-hidden="true" tabindex="-1"></a><span class="in">kable(winters_daily[1:5,]) %&gt;%</span></span>
<span id="cb385-2731"><a href="#cb385-2731" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-2732"><a href="#cb385-2732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2733"><a href="#cb385-2733" aria-hidden="true" tabindex="-1"></a><span class="in">## Use interpolate_gaps_hourly() function to patch</span></span>
<span id="cb385-2734"><a href="#cb385-2734" aria-hidden="true" tabindex="-1"></a><span class="in"># Call dataset to patch</span></span>
<span id="cb385-2735"><a href="#cb385-2735" aria-hidden="true" tabindex="-1"></a><span class="in">to_interp &lt;- Winters_hours_gaps</span></span>
<span id="cb385-2736"><a href="#cb385-2736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2737"><a href="#cb385-2737" aria-hidden="true" tabindex="-1"></a><span class="in"># Add Temp data to new Temp_recorded column</span></span>
<span id="cb385-2738"><a href="#cb385-2738" aria-hidden="true" tabindex="-1"></a><span class="in">to_interp[, "Temp_recorded"] &lt;- to_interp[, "Temp"]</span></span>
<span id="cb385-2739"><a href="#cb385-2739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2740"><a href="#cb385-2740" aria-hidden="true" tabindex="-1"></a><span class="in"># Add Temp_gaps data to the Temp column</span></span>
<span id="cb385-2741"><a href="#cb385-2741" aria-hidden="true" tabindex="-1"></a><span class="in">to_interp[, "Temp"] &lt;- to_interp[, "Temp_gaps"]</span></span>
<span id="cb385-2742"><a href="#cb385-2742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2743"><a href="#cb385-2743" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate continous hourly records</span></span>
<span id="cb385-2744"><a href="#cb385-2744" aria-hidden="true" tabindex="-1"></a><span class="in">interp &lt;- interpolate_gaps_hourly(hourtemps = to_interp, </span></span>
<span id="cb385-2745"><a href="#cb385-2745" aria-hidden="true" tabindex="-1"></a><span class="in">                                  latitude = 38.5,</span></span>
<span id="cb385-2746"><a href="#cb385-2746" aria-hidden="true" tabindex="-1"></a><span class="in">                                  daily_temps = list(Winters = winters_daily))</span></span>
<span id="cb385-2747"><a href="#cb385-2747" aria-hidden="true" tabindex="-1"></a><span class="in"># hourtemps: data.frame containing hourly temperatures. </span></span>
<span id="cb385-2748"><a href="#cb385-2748" aria-hidden="true" tabindex="-1"></a><span class="in">  # This has to contain columns c("Year","Month","Day","Hour","Temp").</span></span>
<span id="cb385-2749"><a href="#cb385-2749" aria-hidden="true" tabindex="-1"></a><span class="in"># latitude: location of interest</span></span>
<span id="cb385-2750"><a href="#cb385-2750" aria-hidden="true" tabindex="-1"></a><span class="in"># daily_temps: list of (chillR compliant) daily temperature data sets </span></span>
<span id="cb385-2751"><a href="#cb385-2751" aria-hidden="true" tabindex="-1"></a><span class="in">  # for patching gaps in the record.</span></span>
<span id="cb385-2752"><a href="#cb385-2752" aria-hidden="true" tabindex="-1"></a><span class="in"># Winters = : give name to the station, otherwise report as station_x in result</span></span>
<span id="cb385-2753"><a href="#cb385-2753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2754"><a href="#cb385-2754" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2755"><a href="#cb385-2755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2756"><a href="#cb385-2756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2757"><a href="#cb385-2757" aria-hidden="true" tabindex="-1"></a>The resulting dataset has two elements: $weather and daily_patch_report. Let’s first look at the <span class="in">`daily_patch_report`</span> element.</span>
<span id="cb385-2758"><a href="#cb385-2758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2759"><a href="#cb385-2759" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The resulting table of the <span class="in">`daily_patch_report`</span> element contains information on </span>
<span id="cb385-2760"><a href="#cb385-2760" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>how many gaps in the daily record were filled by solving the system of hourly equations (‘solved’), </span>
<span id="cb385-2761"><a href="#cb385-2761" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>how many <span class="in">`Tmin`</span> and <span class="in">`Tmax`</span> values were derived from proxy stations (listed by name, if names were provided in the call to <span class="in">`interpolate_gaps_hourly`</span>; otherwise as station_x), </span>
<span id="cb385-2762"><a href="#cb385-2762" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>how many were filled by linear interpolation (this option can be turned off using the <span class="in">`interpolate_remaining`</span> parameter). </span>
<span id="cb385-2763"><a href="#cb385-2763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2764"><a href="#cb385-2764" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-2765"><a href="#cb385-2765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2766"><a href="#cb385-2766" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For proxy stations, it also provides the bias in mean Tmin and Tmax, which has been corrected, as well as the bias in the standard deviation of Tmin and Tmax (which was not corrected).</span>
<span id="cb385-2767"><a href="#cb385-2767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2768"><a href="#cb385-2768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2769"><a href="#cb385-2769" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.4c}</span></span>
<span id="cb385-2770"><a href="#cb385-2770" aria-hidden="true" tabindex="-1"></a><span class="in">kable(interp$daily_patch_report,</span></span>
<span id="cb385-2771"><a href="#cb385-2771" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "The element of `daily_patch_report`") %&gt;%</span></span>
<span id="cb385-2772"><a href="#cb385-2772" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-2773"><a href="#cb385-2773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2774"><a href="#cb385-2774" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2775"><a href="#cb385-2775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2776"><a href="#cb385-2776" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-2777"><a href="#cb385-2777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2778"><a href="#cb385-2778" aria-hidden="true" tabindex="-1"></a>The <span class="in">`$weather`</span> element of the interpolation result contains the table of interpolated temperatures.</span>
<span id="cb385-2779"><a href="#cb385-2779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2780"><a href="#cb385-2780" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.4d}</span></span>
<span id="cb385-2781"><a href="#cb385-2781" aria-hidden="true" tabindex="-1"></a><span class="in"># Show only Day 6 of the dataset </span></span>
<span id="cb385-2782"><a href="#cb385-2782" aria-hidden="true" tabindex="-1"></a><span class="in">kable(interp$weather[63:86, ],</span></span>
<span id="cb385-2783"><a href="#cb385-2783" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "The element of `weather`") %&gt;%</span></span>
<span id="cb385-2784"><a href="#cb385-2784" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-2785"><a href="#cb385-2785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2786"><a href="#cb385-2786" aria-hidden="true" tabindex="-1"></a><span class="in">```</span> </span>
<span id="cb385-2787"><a href="#cb385-2787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2788"><a href="#cb385-2788" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-2789"><a href="#cb385-2789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2790"><a href="#cb385-2790" aria-hidden="true" tabindex="-1"></a>Here I will try to plot the result like in the coursebook. </span>
<span id="cb385-2791"><a href="#cb385-2791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2792"><a href="#cb385-2792" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This illustration shows that the <span class="in">`interpolate_gaps_hourly()`</span> function produced a pretty good approximation (red lines) to the actual temperatures (gray line).</span>
<span id="cb385-2793"><a href="#cb385-2793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2794"><a href="#cb385-2794" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.4e}</span></span>
<span id="cb385-2795"><a href="#cb385-2795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2796"><a href="#cb385-2796" aria-hidden="true" tabindex="-1"></a><span class="in"># Add date in chillR format</span></span>
<span id="cb385-2797"><a href="#cb385-2797" aria-hidden="true" tabindex="-1"></a><span class="in">interp_plot &lt;- add_date(interp$weather)</span></span>
<span id="cb385-2798"><a href="#cb385-2798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2799"><a href="#cb385-2799" aria-hidden="true" tabindex="-1"></a><span class="in">## Use codes from package example</span></span>
<span id="cb385-2800"><a href="#cb385-2800" aria-hidden="true" tabindex="-1"></a><span class="in"># Interpolated temperatures are shown in red, measured temperatures in black.</span></span>
<span id="cb385-2801"><a href="#cb385-2801" aria-hidden="true" tabindex="-1"></a><span class="in"># plot(interp_plot$Temp[45:320]~c(interp_plot$Date[45:320]),type="l",</span></span>
<span id="cb385-2802"><a href="#cb385-2802" aria-hidden="true" tabindex="-1"></a><span class="in">#   col="RED",lwd=2,xlab="Date",ylab="Temperature")</span></span>
<span id="cb385-2803"><a href="#cb385-2803" aria-hidden="true" tabindex="-1"></a><span class="in"># lines(interp_plot$Temp_measured[45:320]~c(interp_plot$Date[45:320]),lwd=2)</span></span>
<span id="cb385-2804"><a href="#cb385-2804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2805"><a href="#cb385-2805" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a subset of the data for the range between March 6-16</span></span>
<span id="cb385-2806"><a href="#cb385-2806" aria-hidden="true" tabindex="-1"></a><span class="in">interp_subset &lt;- interp_plot[45:320, ]</span></span>
<span id="cb385-2807"><a href="#cb385-2807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2808"><a href="#cb385-2808" aria-hidden="true" tabindex="-1"></a><span class="in"># Use ggplot </span></span>
<span id="cb385-2809"><a href="#cb385-2809" aria-hidden="true" tabindex="-1"></a><span class="in"># Add the fist line for recorded temperatures as a gray line</span></span>
<span id="cb385-2810"><a href="#cb385-2810" aria-hidden="true" tabindex="-1"></a><span class="in"># Add the second line for interpolated temperatures as a red line</span></span>
<span id="cb385-2811"><a href="#cb385-2811" aria-hidden="true" tabindex="-1"></a><span class="in"># Add the third line for measured temperatures as a black line (this is choppy)</span></span>
<span id="cb385-2812"><a href="#cb385-2812" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(interp_subset, aes(x = Date)) +</span></span>
<span id="cb385-2813"><a href="#cb385-2813" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(aes(y = Temp_recorded, color = "Temp Recorded"), size = 1.2) +</span></span>
<span id="cb385-2814"><a href="#cb385-2814" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(aes(y = Temp, color = "Temp Interpolated"), size = 1.2) +</span></span>
<span id="cb385-2815"><a href="#cb385-2815" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(aes(y = Temp_measured, color = "Temp Measured"), size = 1.2) +</span></span>
<span id="cb385-2816"><a href="#cb385-2816" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(</span></span>
<span id="cb385-2817"><a href="#cb385-2817" aria-hidden="true" tabindex="-1"></a><span class="in">    values = c(</span></span>
<span id="cb385-2818"><a href="#cb385-2818" aria-hidden="true" tabindex="-1"></a><span class="in">      'Temp Interpolated' = "red",</span></span>
<span id="cb385-2819"><a href="#cb385-2819" aria-hidden="true" tabindex="-1"></a><span class="in">      'Temp Measured' = "black",</span></span>
<span id="cb385-2820"><a href="#cb385-2820" aria-hidden="true" tabindex="-1"></a><span class="in">      'Temp Recorded' = "grey"),</span></span>
<span id="cb385-2821"><a href="#cb385-2821" aria-hidden="true" tabindex="-1"></a><span class="in">    name = "Legend" </span></span>
<span id="cb385-2822"><a href="#cb385-2822" aria-hidden="true" tabindex="-1"></a><span class="in">  ) + labs(x = "Date", y = "Temperature (°C)") </span></span>
<span id="cb385-2823"><a href="#cb385-2823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2824"><a href="#cb385-2824" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2825"><a href="#cb385-2825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2826"><a href="#cb385-2826" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-2827"><a href="#cb385-2827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2828"><a href="#cb385-2828" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;11.4.1&lt;/span&gt;&amp;nbsp; Accuracy assessment</span></span>
<span id="cb385-2829"><a href="#cb385-2829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2830"><a href="#cb385-2830" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-2831"><a href="#cb385-2831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2832"><a href="#cb385-2832" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Since the actual hourly temperatures are known, the accuracy of the predictions produced by the various interpolation methods can be evaluated. </span>
<span id="cb385-2833"><a href="#cb385-2833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2834"><a href="#cb385-2834" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A common measure for validating predictions is the Root Mean Square Error of the Prediction (RMSEP).</span>
<span id="cb385-2835"><a href="#cb385-2835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2836"><a href="#cb385-2836" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-2837"><a href="#cb385-2837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2838"><a href="#cb385-2838" aria-hidden="true" tabindex="-1"></a><span class="fu">##### *Root Mean Square Error of the Prediction (RMSEP)* {.unnumbered}</span></span>
<span id="cb385-2839"><a href="#cb385-2839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2840"><a href="#cb385-2840" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-2841"><a href="#cb385-2841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2842"><a href="#cb385-2842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2843"><a href="#cb385-2843" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb385-2844"><a href="#cb385-2844" aria-hidden="true" tabindex="-1"></a>RMSEP = \sqrt{\frac{1}{n} \sum_{i=1}^{n} (y_i - \hat{y}_i)^2}</span>
<span id="cb385-2845"><a href="#cb385-2845" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb385-2846"><a href="#cb385-2846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2847"><a href="#cb385-2847" aria-hidden="true" tabindex="-1"></a>, with $\hat{y}_i$ being the observed values, $y_i$ the predicted values, and $n$ the number of values.</span>
<span id="cb385-2848"><a href="#cb385-2848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2849"><a href="#cb385-2849" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The RMSEP provides an indication of how far each predicted value deviates, on average, from the actual values.</span>
<span id="cb385-2850"><a href="#cb385-2850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2851"><a href="#cb385-2851" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It is, however, quite difficult to interpret RMSEP values alone, because whether they indicate a good or poor model fit depends on how variable the actual values are.</span>
<span id="cb385-2852"><a href="#cb385-2852" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>For instance, an RMSEP of 5 days for a phenology model (which is close to, but not quite the same as a mean error of 5 days), could indicate a very good model, if observed dates vary by several weeks or months (e.g. for bloom dates of deciduous trees), but a terrible model, if the phenological stage of interest occurs on the same day every year (e.g. the ‘phenological’ event of candles lighting up on ‘festive indoor conifers’).</span>
<span id="cb385-2853"><a href="#cb385-2853" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-2854"><a href="#cb385-2854" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-2855"><a href="#cb385-2855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2856"><a href="#cb385-2856" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This is why it makes sense to include in such accuracy assessment the variation in observed values. </span>
<span id="cb385-2857"><a href="#cb385-2857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2858"><a href="#cb385-2858" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This can be achieved by dividing the standard deviation of the observed data by the RMSEP to calculate the Residual Prediction Deviation (RPD).</span>
<span id="cb385-2859"><a href="#cb385-2859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2860"><a href="#cb385-2860" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-2861"><a href="#cb385-2861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2862"><a href="#cb385-2862" aria-hidden="true" tabindex="-1"></a><span class="fu">##### *Residual Prediction Deviation (RPD)* {.unnumbered}</span></span>
<span id="cb385-2863"><a href="#cb385-2863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2864"><a href="#cb385-2864" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-2865"><a href="#cb385-2865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2866"><a href="#cb385-2866" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb385-2867"><a href="#cb385-2867" aria-hidden="true" tabindex="-1"></a>RPD = \frac{sd_y}{RMSEP}</span>
<span id="cb385-2868"><a href="#cb385-2868" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb385-2869"><a href="#cb385-2869" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-2870"><a href="#cb385-2870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2871"><a href="#cb385-2871" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This equation contains the RMSEP as computed above as well as the standard deviation of the observed values from their mean, defined as:</span>
<span id="cb385-2872"><a href="#cb385-2872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2873"><a href="#cb385-2873" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb385-2874"><a href="#cb385-2874" aria-hidden="true" tabindex="-1"></a>sd_y = \sqrt{\frac{\sum_{i=1}^n (y_i - \bar{y})^2}{n-1}}</span>
<span id="cb385-2875"><a href="#cb385-2875" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb385-2876"><a href="#cb385-2876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2877"><a href="#cb385-2877" aria-hidden="true" tabindex="-1"></a>, with $\bar{y}$ being the mean over all observations.</span>
<span id="cb385-2878"><a href="#cb385-2878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2879"><a href="#cb385-2879" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The RPD is more useful than the RMSEP, but its use of the standard deviation can be a problem, when actual values of $y$ aren’t normally distributed (then the standard deviation can be a poor measure of variation).</span>
<span id="cb385-2880"><a href="#cb385-2880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2881"><a href="#cb385-2881" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A more robust approach is use the interquartile range instead of the standard deviation. This metric is called the Ratio of Performance to InterQuartile distance (RPIQ).</span>
<span id="cb385-2882"><a href="#cb385-2882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2883"><a href="#cb385-2883" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-2884"><a href="#cb385-2884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2885"><a href="#cb385-2885" aria-hidden="true" tabindex="-1"></a><span class="fu">##### *Ratio of Performance to InterQuartile distance (RPIQ)* {.unnumbered}</span></span>
<span id="cb385-2886"><a href="#cb385-2886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2887"><a href="#cb385-2887" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-2888"><a href="#cb385-2888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2889"><a href="#cb385-2889" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb385-2890"><a href="#cb385-2890" aria-hidden="true" tabindex="-1"></a>RPIQ = \frac{IQ}{RMSEP}</span>
<span id="cb385-2891"><a href="#cb385-2891" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb385-2892"><a href="#cb385-2892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2893"><a href="#cb385-2893" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-2894"><a href="#cb385-2894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2895"><a href="#cb385-2895" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>IQ is calculated by subtracting the 75^th^ percentile of the distribution of all $y$ from the 25^th^ percentile.</span>
<span id="cb385-2896"><a href="#cb385-2896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2897"><a href="#cb385-2897" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.4.1a}</span></span>
<span id="cb385-2898"><a href="#cb385-2898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2899"><a href="#cb385-2899" aria-hidden="true" tabindex="-1"></a><span class="in"># require(stats)</span></span>
<span id="cb385-2900"><a href="#cb385-2900" aria-hidden="true" tabindex="-1"></a><span class="in">y &lt;- rnorm(100)</span></span>
<span id="cb385-2901"><a href="#cb385-2901" aria-hidden="true" tabindex="-1"></a><span class="in">IQ &lt;- quantile(y)[4] - quantile(y)[2]</span></span>
<span id="cb385-2902"><a href="#cb385-2902" aria-hidden="true" tabindex="-1"></a><span class="in">IQ</span></span>
<span id="cb385-2903"><a href="#cb385-2903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2904"><a href="#cb385-2904" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2905"><a href="#cb385-2905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2906"><a href="#cb385-2906" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-2907"><a href="#cb385-2907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2908"><a href="#cb385-2908" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The RPIQ score is a bit harder to evaluate than the RMSEP, with different quality thresholds in use and a very high context dependency.</span>
<span id="cb385-2909"><a href="#cb385-2909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2910"><a href="#cb385-2910" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Quite commonly, values above 2 are considered ‘good’ or even ‘excellent’, though some studies use substantially higher thresholds (up to 8 for excellence).</span>
<span id="cb385-2911"><a href="#cb385-2911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2912"><a href="#cb385-2912" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Since the RPIQ makes no assumption about the distribution of $y$, let’s use this for assessing the accuracy of the various interpolation methods. We have a total of four methods to evaluate:</span>
<span id="cb385-2913"><a href="#cb385-2913" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**idealized** temperature curves from **daily** records of `Tmin` and `Tmax`, based on records from a **nearby weather station**</span>
<span id="cb385-2914"><a href="#cb385-2914" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**idealized** temperature curves from **daily** records of `Tmin` and `Tmax`, based on records from **the same location**</span>
<span id="cb385-2915"><a href="#cb385-2915" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**linear** interpolation of **hourly** temperatures</span>
<span id="cb385-2916"><a href="#cb385-2916" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>interpolation of **hourly** temperatures with <span class="in">`interpolate_gaps_hourly`</span></span>
<span id="cb385-2917"><a href="#cb385-2917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2918"><a href="#cb385-2918" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-2919"><a href="#cb385-2919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2920"><a href="#cb385-2920" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use the <span class="in">`make_all_day_table()`</span> function to generate a dataset of daily minimum and maximum temperatures from the hourly records for option 2. </span>
<span id="cb385-2921"><a href="#cb385-2921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2922"><a href="#cb385-2922" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.4.1b}</span></span>
<span id="cb385-2923"><a href="#cb385-2923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2924"><a href="#cb385-2924" aria-hidden="true" tabindex="-1"></a><span class="in"># Call dataset</span></span>
<span id="cb385-2925"><a href="#cb385-2925" aria-hidden="true" tabindex="-1"></a><span class="in">inter &lt;- interp$weather</span></span>
<span id="cb385-2926"><a href="#cb385-2926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2927"><a href="#cb385-2927" aria-hidden="true" tabindex="-1"></a><span class="in"># Add date column in chillR format</span></span>
<span id="cb385-2928"><a href="#cb385-2928" aria-hidden="true" tabindex="-1"></a><span class="in">inter[, "DATE"] &lt;- ISOdate(inter$Year,</span></span>
<span id="cb385-2929"><a href="#cb385-2929" aria-hidden="true" tabindex="-1"></a><span class="in">                           inter$Month,</span></span>
<span id="cb385-2930"><a href="#cb385-2930" aria-hidden="true" tabindex="-1"></a><span class="in">                           inter$Day,</span></span>
<span id="cb385-2931"><a href="#cb385-2931" aria-hidden="true" tabindex="-1"></a><span class="in">                           inter$Hour)</span></span>
<span id="cb385-2932"><a href="#cb385-2932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2933"><a href="#cb385-2933" aria-hidden="true" tabindex="-1"></a><span class="in"># Aggregate hourly records to daily Tmin, Tmean and Tmax </span></span>
<span id="cb385-2934"><a href="#cb385-2934" aria-hidden="true" tabindex="-1"></a><span class="in">orchard_extremes &lt;- make_all_day_table(inter,</span></span>
<span id="cb385-2935"><a href="#cb385-2935" aria-hidden="true" tabindex="-1"></a><span class="in">                                       timestep = "day",</span></span>
<span id="cb385-2936"><a href="#cb385-2936" aria-hidden="true" tabindex="-1"></a><span class="in">                                       input_timestep = "hour")</span></span>
<span id="cb385-2937"><a href="#cb385-2937" aria-hidden="true" tabindex="-1"></a><span class="in">kable(orchard_extremes[1:10, ]) %&gt;%</span></span>
<span id="cb385-2938"><a href="#cb385-2938" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-2939"><a href="#cb385-2939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2940"><a href="#cb385-2940" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-2941"><a href="#cb385-2941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2942"><a href="#cb385-2942" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-2943"><a href="#cb385-2943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2944"><a href="#cb385-2944" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Let’s first look at the performance of the four methods for the periods that were missing in the hourly temperature record:</span>
<span id="cb385-2945"><a href="#cb385-2945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2946"><a href="#cb385-2946" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.4.1c}</span></span>
<span id="cb385-2947"><a href="#cb385-2947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2948"><a href="#cb385-2948" aria-hidden="true" tabindex="-1"></a><span class="in"># Interpolate gaps in daily records and generate hourly temperatures</span></span>
<span id="cb385-2949"><a href="#cb385-2949" aria-hidden="true" tabindex="-1"></a><span class="in">winters_hours &lt;- stack_hourly_temps(fix_weather(winters_daily),</span></span>
<span id="cb385-2950"><a href="#cb385-2950" aria-hidden="true" tabindex="-1"></a><span class="in">                                    latitude = 38)$hourtemps</span></span>
<span id="cb385-2951"><a href="#cb385-2951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2952"><a href="#cb385-2952" aria-hidden="true" tabindex="-1"></a><span class="in"># Identify the date in winters_hours correspond to the first date of </span></span>
<span id="cb385-2953"><a href="#cb385-2953" aria-hidden="true" tabindex="-1"></a><span class="in"># missing period in inter dataset? </span></span>
<span id="cb385-2954"><a href="#cb385-2954" aria-hidden="true" tabindex="-1"></a><span class="in"># The output is 1499- row in the dataset???</span></span>
<span id="cb385-2955"><a href="#cb385-2955" aria-hidden="true" tabindex="-1"></a><span class="in">start_hour_winters &lt;- which(winters_hours$Year == head(inter$Year,1)&amp;</span></span>
<span id="cb385-2956"><a href="#cb385-2956" aria-hidden="true" tabindex="-1"></a><span class="in">                              winters_hours$Month == head(inter$Month,1)&amp;</span></span>
<span id="cb385-2957"><a href="#cb385-2957" aria-hidden="true" tabindex="-1"></a><span class="in">                              winters_hours$Day == head(inter$Day,1)&amp;</span></span>
<span id="cb385-2958"><a href="#cb385-2958" aria-hidden="true" tabindex="-1"></a><span class="in">                              winters_hours$Hour == head(inter$Hour,1))</span></span>
<span id="cb385-2959"><a href="#cb385-2959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2960"><a href="#cb385-2960" aria-hidden="true" tabindex="-1"></a><span class="in"># Identify the date in winters_hours correspond to the end date of </span></span>
<span id="cb385-2961"><a href="#cb385-2961" aria-hidden="true" tabindex="-1"></a><span class="in"># missing period in inter dataset? </span></span>
<span id="cb385-2962"><a href="#cb385-2962" aria-hidden="true" tabindex="-1"></a><span class="in"># The output is 7572- row in the dataset???</span></span>
<span id="cb385-2963"><a href="#cb385-2963" aria-hidden="true" tabindex="-1"></a><span class="in">end_hour_winters &lt;- which(winters_hours$Year == tail(inter$Year,1)&amp;</span></span>
<span id="cb385-2964"><a href="#cb385-2964" aria-hidden="true" tabindex="-1"></a><span class="in">                            winters_hours$Month == tail(inter$Month,1)&amp;</span></span>
<span id="cb385-2965"><a href="#cb385-2965" aria-hidden="true" tabindex="-1"></a><span class="in">                            winters_hours$Day == tail(inter$Day,1)&amp;</span></span>
<span id="cb385-2966"><a href="#cb385-2966" aria-hidden="true" tabindex="-1"></a><span class="in">                            winters_hours$Hour == tail(inter$Hour,1))</span></span>
<span id="cb385-2967"><a href="#cb385-2967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2968"><a href="#cb385-2968" aria-hidden="true" tabindex="-1"></a><span class="in"># Follow same process for orchard dataset?</span></span>
<span id="cb385-2969"><a href="#cb385-2969" aria-hidden="true" tabindex="-1"></a><span class="in">orchard_hours &lt;- stack_hourly_temps(orchard_extremes,</span></span>
<span id="cb385-2970"><a href="#cb385-2970" aria-hidden="true" tabindex="-1"></a><span class="in">                                    latitude = 38)$hourtemps</span></span>
<span id="cb385-2971"><a href="#cb385-2971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2972"><a href="#cb385-2972" aria-hidden="true" tabindex="-1"></a><span class="in">start_hour_orchard &lt;- which(orchard_hours$Year == head(inter$Year,1)&amp;</span></span>
<span id="cb385-2973"><a href="#cb385-2973" aria-hidden="true" tabindex="-1"></a><span class="in">                              orchard_hours$Month == head(inter$Month,1)&amp;</span></span>
<span id="cb385-2974"><a href="#cb385-2974" aria-hidden="true" tabindex="-1"></a><span class="in">                              orchard_hours$Day == head(inter$Day,1)&amp;</span></span>
<span id="cb385-2975"><a href="#cb385-2975" aria-hidden="true" tabindex="-1"></a><span class="in">                              orchard_hours$Hour == head(inter$Hour,1))</span></span>
<span id="cb385-2976"><a href="#cb385-2976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2977"><a href="#cb385-2977" aria-hidden="true" tabindex="-1"></a><span class="in">end_hour_orchard &lt;- which(orchard_hours$Year == tail(inter$Year,1)&amp;</span></span>
<span id="cb385-2978"><a href="#cb385-2978" aria-hidden="true" tabindex="-1"></a><span class="in">                            orchard_hours$Month == tail(inter$Month,1)&amp;</span></span>
<span id="cb385-2979"><a href="#cb385-2979" aria-hidden="true" tabindex="-1"></a><span class="in">                            orchard_hours$Day == tail(inter$Day,1)&amp;</span></span>
<span id="cb385-2980"><a href="#cb385-2980" aria-hidden="true" tabindex="-1"></a><span class="in">                            orchard_hours$Hour == tail(inter$Hour,1))</span></span>
<span id="cb385-2981"><a href="#cb385-2981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2982"><a href="#cb385-2982" aria-hidden="true" tabindex="-1"></a><span class="in">## Extract data for each option</span></span>
<span id="cb385-2983"><a href="#cb385-2983" aria-hidden="true" tabindex="-1"></a><span class="in"># Actual temp?</span></span>
<span id="cb385-2984"><a href="#cb385-2984" aria-hidden="true" tabindex="-1"></a><span class="in">observed &lt;- inter$Temp_recorded</span></span>
<span id="cb385-2985"><a href="#cb385-2985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2986"><a href="#cb385-2986" aria-hidden="true" tabindex="-1"></a><span class="in"># Use proxy data "winters"</span></span>
<span id="cb385-2987"><a href="#cb385-2987" aria-hidden="true" tabindex="-1"></a><span class="in">option1 &lt;- winters_hours$Temp[start_hour_winters:end_hour_winters]</span></span>
<span id="cb385-2988"><a href="#cb385-2988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2989"><a href="#cb385-2989" aria-hidden="true" tabindex="-1"></a><span class="in"># Use orchard_extremes data (same location)</span></span>
<span id="cb385-2990"><a href="#cb385-2990" aria-hidden="true" tabindex="-1"></a><span class="in">option2 &lt;- orchard_hours$Temp[start_hour_orchard:end_hour_orchard]</span></span>
<span id="cb385-2991"><a href="#cb385-2991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2992"><a href="#cb385-2992" aria-hidden="true" tabindex="-1"></a><span class="in"># Use liner interpolation</span></span>
<span id="cb385-2993"><a href="#cb385-2993" aria-hidden="true" tabindex="-1"></a><span class="in">option3 &lt;- interpolate_gaps(inter$Temp_gaps)$interp</span></span>
<span id="cb385-2994"><a href="#cb385-2994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2995"><a href="#cb385-2995" aria-hidden="true" tabindex="-1"></a><span class="in"># Use interpolate_gap_hourly() function</span></span>
<span id="cb385-2996"><a href="#cb385-2996" aria-hidden="true" tabindex="-1"></a><span class="in">option4 &lt;- inter$Temp</span></span>
<span id="cb385-2997"><a href="#cb385-2997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-2998"><a href="#cb385-2998" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a data.frame for output, under two names of dataset</span></span>
<span id="cb385-2999"><a href="#cb385-2999" aria-hidden="true" tabindex="-1"></a><span class="in">eval_table &lt;- # This line might not be needed as eval_table is set again below?</span></span>
<span id="cb385-3000"><a href="#cb385-3000" aria-hidden="true" tabindex="-1"></a><span class="in">  eval_table_gaps &lt;-</span></span>
<span id="cb385-3001"><a href="#cb385-3001" aria-hidden="true" tabindex="-1"></a><span class="in">  data.frame(Option = 1:4,</span></span>
<span id="cb385-3002"><a href="#cb385-3002" aria-hidden="true" tabindex="-1"></a><span class="in">             Input_data = c("daily","daily","hourly","hourly"),</span></span>
<span id="cb385-3003"><a href="#cb385-3003" aria-hidden="true" tabindex="-1"></a><span class="in">             Interpolation_method = c("from proxy","local extremes",</span></span>
<span id="cb385-3004"><a href="#cb385-3004" aria-hidden="true" tabindex="-1"></a><span class="in">                                      "linear","hourly interpolation"),</span></span>
<span id="cb385-3005"><a href="#cb385-3005" aria-hidden="true" tabindex="-1"></a><span class="in">             RMSEP = NA,</span></span>
<span id="cb385-3006"><a href="#cb385-3006" aria-hidden="true" tabindex="-1"></a><span class="in">             RPIQ = NA)</span></span>
<span id="cb385-3007"><a href="#cb385-3007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3008"><a href="#cb385-3008" aria-hidden="true" tabindex="-1"></a><span class="in"># Extract the values in each option that correspond with the missing gaps</span></span>
<span id="cb385-3009"><a href="#cb385-3009" aria-hidden="true" tabindex="-1"></a><span class="in">observed_gaps &lt;- observed[which(is.na(inter$Temp_gaps))]</span></span>
<span id="cb385-3010"><a href="#cb385-3010" aria-hidden="true" tabindex="-1"></a><span class="in">option1_gaps &lt;- option1[which(is.na(inter$Temp_gaps))]</span></span>
<span id="cb385-3011"><a href="#cb385-3011" aria-hidden="true" tabindex="-1"></a><span class="in">option2_gaps &lt;- option2[which(is.na(inter$Temp_gaps))]</span></span>
<span id="cb385-3012"><a href="#cb385-3012" aria-hidden="true" tabindex="-1"></a><span class="in">option3_gaps &lt;- option3[which(is.na(inter$Temp_gaps))]</span></span>
<span id="cb385-3013"><a href="#cb385-3013" aria-hidden="true" tabindex="-1"></a><span class="in">option4_gaps &lt;- option4[which(is.na(inter$Temp_gaps))]</span></span>
<span id="cb385-3014"><a href="#cb385-3014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3015"><a href="#cb385-3015" aria-hidden="true" tabindex="-1"></a><span class="in"># Add result for RMSEP in the output table created above</span></span>
<span id="cb385-3016"><a href="#cb385-3016" aria-hidden="true" tabindex="-1"></a><span class="in"># Comparison between data from each option and the recorded data</span></span>
<span id="cb385-3017"><a href="#cb385-3017" aria-hidden="true" tabindex="-1"></a><span class="in">eval_table_gaps[,"RMSEP"] &lt;- round(c(chillR::RMSEP(option1_gaps, observed_gaps),</span></span>
<span id="cb385-3018"><a href="#cb385-3018" aria-hidden="true" tabindex="-1"></a><span class="in">                                     chillR::RMSEP(option2_gaps, observed_gaps),</span></span>
<span id="cb385-3019"><a href="#cb385-3019" aria-hidden="true" tabindex="-1"></a><span class="in">                                     chillR::RMSEP(option3_gaps, observed_gaps),</span></span>
<span id="cb385-3020"><a href="#cb385-3020" aria-hidden="true" tabindex="-1"></a><span class="in">                                     chillR::RMSEP(option4_gaps, observed_gaps)),</span></span>
<span id="cb385-3021"><a href="#cb385-3021" aria-hidden="true" tabindex="-1"></a><span class="in">                                   1) # round to 1 decimal point</span></span>
<span id="cb385-3022"><a href="#cb385-3022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3023"><a href="#cb385-3023" aria-hidden="true" tabindex="-1"></a><span class="in"># Add result for RPIQ in the output table created above</span></span>
<span id="cb385-3024"><a href="#cb385-3024" aria-hidden="true" tabindex="-1"></a><span class="in">eval_table_gaps[,"RPIQ"] &lt;- round(c(chillR::RPIQ(option1_gaps, observed_gaps),</span></span>
<span id="cb385-3025"><a href="#cb385-3025" aria-hidden="true" tabindex="-1"></a><span class="in">                                    chillR::RPIQ(option2_gaps, observed_gaps),</span></span>
<span id="cb385-3026"><a href="#cb385-3026" aria-hidden="true" tabindex="-1"></a><span class="in">                                    chillR::RPIQ(option3_gaps, observed_gaps),</span></span>
<span id="cb385-3027"><a href="#cb385-3027" aria-hidden="true" tabindex="-1"></a><span class="in">                                    chillR::RPIQ(option4_gaps, observed_gaps)),</span></span>
<span id="cb385-3028"><a href="#cb385-3028" aria-hidden="true" tabindex="-1"></a><span class="in">                                  1) # round to 1 decimal point</span></span>
<span id="cb385-3029"><a href="#cb385-3029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3030"><a href="#cb385-3030" aria-hidden="true" tabindex="-1"></a><span class="in"># Display the output table</span></span>
<span id="cb385-3031"><a href="#cb385-3031" aria-hidden="true" tabindex="-1"></a><span class="in">kable(eval_table_gaps) %&gt;%</span></span>
<span id="cb385-3032"><a href="#cb385-3032" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-3033"><a href="#cb385-3033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3034"><a href="#cb385-3034" aria-hidden="true" tabindex="-1"></a><span class="in"># This table shows that the interpolate_gaps_hourly function produced the </span></span>
<span id="cb385-3035"><a href="#cb385-3035" aria-hidden="true" tabindex="-1"></a><span class="in"># best results, with an RMSEP of 2 and an RPIQ of 5.4.</span></span>
<span id="cb385-3036"><a href="#cb385-3036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3037"><a href="#cb385-3037" aria-hidden="true" tabindex="-1"></a><span class="in"># Option 3, where hourly records collected in the orchard were interpolated </span></span>
<span id="cb385-3038"><a href="#cb385-3038" aria-hidden="true" tabindex="-1"></a><span class="in"># linearly, produced the worst fit. </span></span>
<span id="cb385-3039"><a href="#cb385-3039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3040"><a href="#cb385-3040" aria-hidden="true" tabindex="-1"></a><span class="in"># This highlights that, at least in this case, using an idealized temperature </span></span>
<span id="cb385-3041"><a href="#cb385-3041" aria-hidden="true" tabindex="-1"></a><span class="in"># curve to close gaps in daily temperatures from the orchard (option 2) </span></span>
<span id="cb385-3042"><a href="#cb385-3042" aria-hidden="true" tabindex="-1"></a><span class="in"># and even from the proxy station (option 1) produced more accurate results.</span></span>
<span id="cb385-3043"><a href="#cb385-3043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3044"><a href="#cb385-3044" aria-hidden="true" tabindex="-1"></a><span class="in"># The quality of option 1 will depend on the similarity between weather at the </span></span>
<span id="cb385-3045"><a href="#cb385-3045" aria-hidden="true" tabindex="-1"></a><span class="in"># proxy station and in the orchard (in this case, this should be quite similar).</span></span>
<span id="cb385-3046"><a href="#cb385-3046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3047"><a href="#cb385-3047" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-3048"><a href="#cb385-3048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3049"><a href="#cb385-3049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3050"><a href="#cb385-3050" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Restricting the comparison to only the gaps in the record is a bit unfair, because of course records produced by option 3 (linear interpolation of hourly records from the orchard) are completely accurate for hours, when temperatures were recorded.</span>
<span id="cb385-3051"><a href="#cb385-3051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3052"><a href="#cb385-3052" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>So let’s also compare the relative performance of the four methods across all hours of the record.</span>
<span id="cb385-3053"><a href="#cb385-3053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3054"><a href="#cb385-3054" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.4.1d}</span></span>
<span id="cb385-3055"><a href="#cb385-3055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3056"><a href="#cb385-3056" aria-hidden="true" tabindex="-1"></a><span class="in"># Create data.frame for output table again</span></span>
<span id="cb385-3057"><a href="#cb385-3057" aria-hidden="true" tabindex="-1"></a><span class="in">eval_table &lt;-</span></span>
<span id="cb385-3058"><a href="#cb385-3058" aria-hidden="true" tabindex="-1"></a><span class="in">  data.frame(Option = 1:4,</span></span>
<span id="cb385-3059"><a href="#cb385-3059" aria-hidden="true" tabindex="-1"></a><span class="in">             Input_data = c("daily","daily","hourly","hourly"),</span></span>
<span id="cb385-3060"><a href="#cb385-3060" aria-hidden="true" tabindex="-1"></a><span class="in">             Interpolation_method = c("from proxy","local extremes",</span></span>
<span id="cb385-3061"><a href="#cb385-3061" aria-hidden="true" tabindex="-1"></a><span class="in">                                      "linear","hourly interpolation"),</span></span>
<span id="cb385-3062"><a href="#cb385-3062" aria-hidden="true" tabindex="-1"></a><span class="in">             RMSEP = NA,</span></span>
<span id="cb385-3063"><a href="#cb385-3063" aria-hidden="true" tabindex="-1"></a><span class="in">             RPIQ = NA)</span></span>
<span id="cb385-3064"><a href="#cb385-3064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3065"><a href="#cb385-3065" aria-hidden="true" tabindex="-1"></a><span class="in">## Comparison between whole datasets- not just the gaps</span></span>
<span id="cb385-3066"><a href="#cb385-3066" aria-hidden="true" tabindex="-1"></a><span class="in"># Add values for RMSEP </span></span>
<span id="cb385-3067"><a href="#cb385-3067" aria-hidden="true" tabindex="-1"></a><span class="in">eval_table[,"RMSEP"] &lt;- round(c(chillR::RMSEP(option1, observed),</span></span>
<span id="cb385-3068"><a href="#cb385-3068" aria-hidden="true" tabindex="-1"></a><span class="in">                                chillR::RMSEP(option2, observed),</span></span>
<span id="cb385-3069"><a href="#cb385-3069" aria-hidden="true" tabindex="-1"></a><span class="in">                                chillR::RMSEP(option3, observed),</span></span>
<span id="cb385-3070"><a href="#cb385-3070" aria-hidden="true" tabindex="-1"></a><span class="in">                                chillR::RMSEP(option4, observed)),</span></span>
<span id="cb385-3071"><a href="#cb385-3071" aria-hidden="true" tabindex="-1"></a><span class="in">                              1)</span></span>
<span id="cb385-3072"><a href="#cb385-3072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3073"><a href="#cb385-3073" aria-hidden="true" tabindex="-1"></a><span class="in"># Add values for RPIQ</span></span>
<span id="cb385-3074"><a href="#cb385-3074" aria-hidden="true" tabindex="-1"></a><span class="in">eval_table[,"RPIQ"] &lt;- round(c(chillR::RPIQ(option1, observed),</span></span>
<span id="cb385-3075"><a href="#cb385-3075" aria-hidden="true" tabindex="-1"></a><span class="in">                               chillR::RPIQ(option2, observed),</span></span>
<span id="cb385-3076"><a href="#cb385-3076" aria-hidden="true" tabindex="-1"></a><span class="in">                               chillR::RPIQ(option3, observed),</span></span>
<span id="cb385-3077"><a href="#cb385-3077" aria-hidden="true" tabindex="-1"></a><span class="in">                               chillR::RPIQ(option4, observed)),</span></span>
<span id="cb385-3078"><a href="#cb385-3078" aria-hidden="true" tabindex="-1"></a><span class="in">                             1)</span></span>
<span id="cb385-3079"><a href="#cb385-3079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3080"><a href="#cb385-3080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3081"><a href="#cb385-3081" aria-hidden="true" tabindex="-1"></a><span class="in"># Display output</span></span>
<span id="cb385-3082"><a href="#cb385-3082" aria-hidden="true" tabindex="-1"></a><span class="in">kable(eval_table) %&gt;%</span></span>
<span id="cb385-3083"><a href="#cb385-3083" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-3084"><a href="#cb385-3084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3085"><a href="#cb385-3085" aria-hidden="true" tabindex="-1"></a><span class="in"># The quality of the proxy-based idealized temperature curves went down </span></span>
<span id="cb385-3086"><a href="#cb385-3086" aria-hidden="true" tabindex="-1"></a><span class="in"># slightly, while all other approaches saw improvements in quality </span></span>
<span id="cb385-3087"><a href="#cb385-3087" aria-hidden="true" tabindex="-1"></a><span class="in"># (lower RMSEP and higher RPIQ).</span></span>
<span id="cb385-3088"><a href="#cb385-3088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3089"><a href="#cb385-3089" aria-hidden="true" tabindex="-1"></a><span class="in"># The RPIQ values for the two interpolations that were based on local data </span></span>
<span id="cb385-3090"><a href="#cb385-3090" aria-hidden="true" tabindex="-1"></a><span class="in"># (options 2 and 4) are very high, especially for option 4, which used the </span></span>
<span id="cb385-3091"><a href="#cb385-3091" aria-hidden="true" tabindex="-1"></a><span class="in"># interpolate_gaps_hourly function.</span></span>
<span id="cb385-3092"><a href="#cb385-3092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3093"><a href="#cb385-3093" aria-hidden="true" tabindex="-1"></a><span class="in"># The RPIQ score for option 4 almost exceeds the ‘excellence’ threshold for </span></span>
<span id="cb385-3094"><a href="#cb385-3094" aria-hidden="true" tabindex="-1"></a><span class="in"># the most conservative RPIQ evaluation scheme (threshold of 8). This is quite </span></span>
<span id="cb385-3095"><a href="#cb385-3095" aria-hidden="true" tabindex="-1"></a><span class="in"># remarkable, given the variable nature of daily temperature fluctuations and </span></span>
<span id="cb385-3096"><a href="#cb385-3096" aria-hidden="true" tabindex="-1"></a><span class="in"># the fact that about half of the actually recorded values were removed before </span></span>
<span id="cb385-3097"><a href="#cb385-3097" aria-hidden="true" tabindex="-1"></a><span class="in"># running the interpolation.</span></span>
<span id="cb385-3098"><a href="#cb385-3098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3099"><a href="#cb385-3099" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-3100"><a href="#cb385-3100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3101"><a href="#cb385-3101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3102"><a href="#cb385-3102" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>***In conclusion, the `interpolate_gaps_hourly` function provided a very good approximation of hourly temperatures for times when no values were recorded.***</span>
<span id="cb385-3103"><a href="#cb385-3103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3104"><a href="#cb385-3104" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3105"><a href="#cb385-3105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3106"><a href="#cb385-3106" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;11.4.2&lt;/span&gt;&amp;nbsp; Computing agroclimatic metrics</span></span>
<span id="cb385-3107"><a href="#cb385-3107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3108"><a href="#cb385-3108" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-3109"><a href="#cb385-3109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3110"><a href="#cb385-3110" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Finally, let’s look at the implication of the choice of interpolation method on chill and heat estimates.</span>
<span id="cb385-3111"><a href="#cb385-3111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3112"><a href="#cb385-3112" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If we’re interested in using the Dynamic Model for winter chill or the Growing Degree Hours model for heat, we can simply calculate this using the <span class="in">`Dynamic_Model`</span> and <span class="in">`GDH()`</span> functions in <span class="in">`chillR`</span>.</span>
<span id="cb385-3113"><a href="#cb385-3113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3114"><a href="#cb385-3114" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For more functionality, see the <span class="in">`chilling()`</span> and particularly the <span class="in">`tempResponse()`</span> functions.</span>
<span id="cb385-3115"><a href="#cb385-3115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3116"><a href="#cb385-3116" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>First, look at the implications of method choice on chill accumulation:</span>
<span id="cb385-3117"><a href="#cb385-3117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3118"><a href="#cb385-3118" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.4.2a}</span></span>
<span id="cb385-3119"><a href="#cb385-3119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3120"><a href="#cb385-3120" aria-hidden="true" tabindex="-1"></a><span class="in"># Recall the dataset (just to make sure good knitting)</span></span>
<span id="cb385-3121"><a href="#cb385-3121" aria-hidden="true" tabindex="-1"></a><span class="in">observed &lt;- inter$Temp_recorded</span></span>
<span id="cb385-3122"><a href="#cb385-3122" aria-hidden="true" tabindex="-1"></a><span class="in">option1 &lt;- winters_hours$Temp[start_hour_winters:end_hour_winters]</span></span>
<span id="cb385-3123"><a href="#cb385-3123" aria-hidden="true" tabindex="-1"></a><span class="in">option2 &lt;- orchard_hours$Temp[start_hour_orchard:end_hour_orchard]</span></span>
<span id="cb385-3124"><a href="#cb385-3124" aria-hidden="true" tabindex="-1"></a><span class="in">option3 &lt;- interpolate_gaps(inter$Temp_gaps)$interp</span></span>
<span id="cb385-3125"><a href="#cb385-3125" aria-hidden="true" tabindex="-1"></a><span class="in">option4 &lt;- inter$Temp</span></span>
<span id="cb385-3126"><a href="#cb385-3126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3127"><a href="#cb385-3127" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a data.frame with results for each option</span></span>
<span id="cb385-3128"><a href="#cb385-3128" aria-hidden="true" tabindex="-1"></a><span class="in">all_chill &lt;- data.frame(DATE = inter$DATE,</span></span>
<span id="cb385-3129"><a href="#cb385-3129" aria-hidden="true" tabindex="-1"></a><span class="in">                        "Obs" = Dynamic_Model(observed),</span></span>
<span id="cb385-3130"><a href="#cb385-3130" aria-hidden="true" tabindex="-1"></a><span class="in">                        "Opt1" = Dynamic_Model(option1),</span></span>
<span id="cb385-3131"><a href="#cb385-3131" aria-hidden="true" tabindex="-1"></a><span class="in">                        "Opt2" = Dynamic_Model(option2),</span></span>
<span id="cb385-3132"><a href="#cb385-3132" aria-hidden="true" tabindex="-1"></a><span class="in">                        "Opt3" = Dynamic_Model(option3),</span></span>
<span id="cb385-3133"><a href="#cb385-3133" aria-hidden="true" tabindex="-1"></a><span class="in">                        "Opt4" = Dynamic_Model(option4))</span></span>
<span id="cb385-3134"><a href="#cb385-3134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3135"><a href="#cb385-3135" aria-hidden="true" tabindex="-1"></a><span class="in"># Collapse columns into rows</span></span>
<span id="cb385-3136"><a href="#cb385-3136" aria-hidden="true" tabindex="-1"></a><span class="in">all_chill &lt;- pivot_longer(all_chill, Obs:Opt4)</span></span>
<span id="cb385-3137"><a href="#cb385-3137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3138"><a href="#cb385-3138" aria-hidden="true" tabindex="-1"></a><span class="in"># Add a method column with legend names for each option</span></span>
<span id="cb385-3139"><a href="#cb385-3139" aria-hidden="true" tabindex="-1"></a><span class="in">all_chill[which(all_chill$name == "Obs"),"Method"] &lt;-</span></span>
<span id="cb385-3140"><a href="#cb385-3140" aria-hidden="true" tabindex="-1"></a><span class="in">  "Observed temperatures"</span></span>
<span id="cb385-3141"><a href="#cb385-3141" aria-hidden="true" tabindex="-1"></a><span class="in">all_chill[which(all_chill$name == "Opt1"),"Method"] &lt;-</span></span>
<span id="cb385-3142"><a href="#cb385-3142" aria-hidden="true" tabindex="-1"></a><span class="in">  "Option 1 - idealized record from proxy data"</span></span>
<span id="cb385-3143"><a href="#cb385-3143" aria-hidden="true" tabindex="-1"></a><span class="in">all_chill[which(all_chill$name == "Opt2"),"Method"] &lt;-</span></span>
<span id="cb385-3144"><a href="#cb385-3144" aria-hidden="true" tabindex="-1"></a><span class="in">  "Option 2 - idealized record from daily orchard data"</span></span>
<span id="cb385-3145"><a href="#cb385-3145" aria-hidden="true" tabindex="-1"></a><span class="in">all_chill[which(all_chill$name == "Opt3"),"Method"] &lt;-</span></span>
<span id="cb385-3146"><a href="#cb385-3146" aria-hidden="true" tabindex="-1"></a><span class="in">  "Option 3 - linear interpolation of hourly data"</span></span>
<span id="cb385-3147"><a href="#cb385-3147" aria-hidden="true" tabindex="-1"></a><span class="in">all_chill[which(all_chill$name == "Opt4"),"Method"] &lt;-</span></span>
<span id="cb385-3148"><a href="#cb385-3148" aria-hidden="true" tabindex="-1"></a><span class="in">  "Option 4 - use of interpolate_gaps_hourly"</span></span>
<span id="cb385-3149"><a href="#cb385-3149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3150"><a href="#cb385-3150" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data</span></span>
<span id="cb385-3151"><a href="#cb385-3151" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(all_chill, aes(x = DATE, y = value, colour = Method)) +</span></span>
<span id="cb385-3152"><a href="#cb385-3152" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(size = 1.2) +</span></span>
<span id="cb385-3153"><a href="#cb385-3153" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Date", y = "Chill accumulation (Chill Portions)") +</span></span>
<span id="cb385-3154"><a href="#cb385-3154" aria-hidden="true" tabindex="-1"></a><span class="in">theme(</span></span>
<span id="cb385-3155"><a href="#cb385-3155" aria-hidden="true" tabindex="-1"></a><span class="in">  legend.position = c(0.4, 0.85), </span></span>
<span id="cb385-3156"><a href="#cb385-3156" aria-hidden="true" tabindex="-1"></a><span class="in">  legend.background = element_rect(fill = "white", size = 0.2),</span></span>
<span id="cb385-3157"><a href="#cb385-3157" aria-hidden="true" tabindex="-1"></a><span class="in">  legend.text = element_text(size = 12),</span></span>
<span id="cb385-3158"><a href="#cb385-3158" aria-hidden="true" tabindex="-1"></a><span class="in">  legend.title = element_text(size = 14),</span></span>
<span id="cb385-3159"><a href="#cb385-3159" aria-hidden="true" tabindex="-1"></a><span class="in">  legend.key.size = unit(1.2, "lines")</span></span>
<span id="cb385-3160"><a href="#cb385-3160" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb385-3161"><a href="#cb385-3161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3162"><a href="#cb385-3162" aria-hidden="true" tabindex="-1"></a><span class="in">## I found another way to plot.</span></span>
<span id="cb385-3163"><a href="#cb385-3163" aria-hidden="true" tabindex="-1"></a><span class="in">## This is quite a roundabout but I will just save it here anyway.</span></span>
<span id="cb385-3164"><a href="#cb385-3164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3165"><a href="#cb385-3165" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a data.frame with results for each option</span></span>
<span id="cb385-3166"><a href="#cb385-3166" aria-hidden="true" tabindex="-1"></a><span class="in"># all_chill &lt;- data.frame(DATE = inter$DATE,</span></span>
<span id="cb385-3167"><a href="#cb385-3167" aria-hidden="true" tabindex="-1"></a><span class="in">#                         "Obs" = Dynamic_Model(observed),</span></span>
<span id="cb385-3168"><a href="#cb385-3168" aria-hidden="true" tabindex="-1"></a><span class="in">#                         "Opt1" = Dynamic_Model(option1),</span></span>
<span id="cb385-3169"><a href="#cb385-3169" aria-hidden="true" tabindex="-1"></a><span class="in">#                         "Opt2" = Dynamic_Model(option2),</span></span>
<span id="cb385-3170"><a href="#cb385-3170" aria-hidden="true" tabindex="-1"></a><span class="in">#                         "Opt3" = Dynamic_Model(option3),</span></span>
<span id="cb385-3171"><a href="#cb385-3171" aria-hidden="true" tabindex="-1"></a><span class="in">#                         "Opt4" = Dynamic_Model(option4))</span></span>
<span id="cb385-3172"><a href="#cb385-3172" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb385-3173"><a href="#cb385-3173" aria-hidden="true" tabindex="-1"></a><span class="in"># The latter is not necessary but I just found out how to change names of column </span></span>
<span id="cb385-3174"><a href="#cb385-3174" aria-hidden="true" tabindex="-1"></a><span class="in"># all_chill_long &lt;- pivot_longer(all_chill, cols = Obs:Opt4, names_to = </span></span>
<span id="cb385-3175"><a href="#cb385-3175" aria-hidden="true" tabindex="-1"></a><span class="in">#                                  "Method", values_to = "Chill_Portion")</span></span>
<span id="cb385-3176"><a href="#cb385-3176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3177"><a href="#cb385-3177" aria-hidden="true" tabindex="-1"></a><span class="in"># Fill missing values for each method (ggplot gives blank plot with NA values)</span></span>
<span id="cb385-3178"><a href="#cb385-3178" aria-hidden="true" tabindex="-1"></a><span class="in"># When I first run the coursebook codes, there were NA values and I couldn't plot</span></span>
<span id="cb385-3179"><a href="#cb385-3179" aria-hidden="true" tabindex="-1"></a><span class="in"># After I filled the missing values using tidyr, I tried running the original</span></span>
<span id="cb385-3180"><a href="#cb385-3180" aria-hidden="true" tabindex="-1"></a><span class="in"># codes again and there were no NA. Don't know why but maybe this filling step</span></span>
<span id="cb385-3181"><a href="#cb385-3181" aria-hidden="true" tabindex="-1"></a><span class="in"># is not necessary. </span></span>
<span id="cb385-3182"><a href="#cb385-3182" aria-hidden="true" tabindex="-1"></a><span class="in"># all_chill_long &lt;- all_chill_long %&gt;%</span></span>
<span id="cb385-3183"><a href="#cb385-3183" aria-hidden="true" tabindex="-1"></a><span class="in">#   group_by(Method) %&gt;% # group_by to fill values separately for each method</span></span>
<span id="cb385-3184"><a href="#cb385-3184" aria-hidden="true" tabindex="-1"></a><span class="in">  # fill values in Chill_Portion using downup direction</span></span>
<span id="cb385-3185"><a href="#cb385-3185" aria-hidden="true" tabindex="-1"></a><span class="in">  # for values missing above and below within a group</span></span>
<span id="cb385-3186"><a href="#cb385-3186" aria-hidden="true" tabindex="-1"></a><span class="in">  # tidyr::fill(Chill_Portion, .direction = "downup") %&gt;%</span></span>
<span id="cb385-3187"><a href="#cb385-3187" aria-hidden="true" tabindex="-1"></a><span class="in">  # ungroup() # ungroup to return data to original data.frame</span></span>
<span id="cb385-3188"><a href="#cb385-3188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3189"><a href="#cb385-3189" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the results</span></span>
<span id="cb385-3190"><a href="#cb385-3190" aria-hidden="true" tabindex="-1"></a><span class="in"># ggplot(all_chill_long, aes(x = DATE, y = Chill_Portion, colour = Method)) +</span></span>
<span id="cb385-3191"><a href="#cb385-3191" aria-hidden="true" tabindex="-1"></a><span class="in">#   geom_line(size = 1.2) +</span></span>
<span id="cb385-3192"><a href="#cb385-3192" aria-hidden="true" tabindex="-1"></a><span class="in">#   labs(x = "Date", y = "Chill accumulation (Chill Portions)") +</span></span>
<span id="cb385-3193"><a href="#cb385-3193" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb385-3194"><a href="#cb385-3194" aria-hidden="true" tabindex="-1"></a><span class="in">#   scale_color_discrete(name = "Method", labels = </span></span>
<span id="cb385-3195"><a href="#cb385-3195" aria-hidden="true" tabindex="-1"></a><span class="in">#                            c("Observed temperatures",</span></span>
<span id="cb385-3196"><a href="#cb385-3196" aria-hidden="true" tabindex="-1"></a><span class="in">#                              "Option 1 - idealized record from proxy data", </span></span>
<span id="cb385-3197"><a href="#cb385-3197" aria-hidden="true" tabindex="-1"></a><span class="in">#                              "Option 2 - idealized record from daily orchard data",</span></span>
<span id="cb385-3198"><a href="#cb385-3198" aria-hidden="true" tabindex="-1"></a><span class="in">#                              "Option 3 - linear interpolation of hourly data",</span></span>
<span id="cb385-3199"><a href="#cb385-3199" aria-hidden="true" tabindex="-1"></a><span class="in">#                              "Option 4 - use of interpolate_gaps_hourly")) +</span></span>
<span id="cb385-3200"><a href="#cb385-3200" aria-hidden="true" tabindex="-1"></a><span class="in">#   theme(</span></span>
<span id="cb385-3201"><a href="#cb385-3201" aria-hidden="true" tabindex="-1"></a><span class="in">#     legend.position = c(0.25, 0.85), </span></span>
<span id="cb385-3202"><a href="#cb385-3202" aria-hidden="true" tabindex="-1"></a><span class="in">#     legend.background = element_rect(fill = "white", size = 0.2),</span></span>
<span id="cb385-3203"><a href="#cb385-3203" aria-hidden="true" tabindex="-1"></a><span class="in">#     legend.text = element_text(size = 18),</span></span>
<span id="cb385-3204"><a href="#cb385-3204" aria-hidden="true" tabindex="-1"></a><span class="in">#     legend.title = element_text(size = 20),</span></span>
<span id="cb385-3205"><a href="#cb385-3205" aria-hidden="true" tabindex="-1"></a><span class="in">#     legend.key.size = unit(1.2, "lines")</span></span>
<span id="cb385-3206"><a href="#cb385-3206" aria-hidden="true" tabindex="-1"></a><span class="in">#   )</span></span>
<span id="cb385-3207"><a href="#cb385-3207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3208"><a href="#cb385-3208" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-3209"><a href="#cb385-3209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3210"><a href="#cb385-3210" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This figure shows that chill accumulation differed substantially between the options. Both the use of proxy data and the use of linear interpolation of hourly temperatures led to considerable overestimation of chill accumulation.</span>
<span id="cb385-3211"><a href="#cb385-3211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3212"><a href="#cb385-3212" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Do the same assessment for heat:</span>
<span id="cb385-3213"><a href="#cb385-3213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3214"><a href="#cb385-3214" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.4.2b}</span></span>
<span id="cb385-3215"><a href="#cb385-3215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3216"><a href="#cb385-3216" aria-hidden="true" tabindex="-1"></a><span class="in">all_heat &lt;- data.frame(DATE = inter$DATE,</span></span>
<span id="cb385-3217"><a href="#cb385-3217" aria-hidden="true" tabindex="-1"></a><span class="in">                       "Obs" = GDH(observed),</span></span>
<span id="cb385-3218"><a href="#cb385-3218" aria-hidden="true" tabindex="-1"></a><span class="in">                       "Opt1" = GDH(option1),</span></span>
<span id="cb385-3219"><a href="#cb385-3219" aria-hidden="true" tabindex="-1"></a><span class="in">                       "Opt2" = GDH(option2),</span></span>
<span id="cb385-3220"><a href="#cb385-3220" aria-hidden="true" tabindex="-1"></a><span class="in">                       "Opt3" = GDH(option3),</span></span>
<span id="cb385-3221"><a href="#cb385-3221" aria-hidden="true" tabindex="-1"></a><span class="in">                       "Opt4" = GDH(option4))</span></span>
<span id="cb385-3222"><a href="#cb385-3222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3223"><a href="#cb385-3223" aria-hidden="true" tabindex="-1"></a><span class="in">all_heat &lt;- pivot_longer(all_heat, Obs:Opt4)</span></span>
<span id="cb385-3224"><a href="#cb385-3224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3225"><a href="#cb385-3225" aria-hidden="true" tabindex="-1"></a><span class="in">all_heat[which(all_heat$name == "Obs"),"Method"] &lt;-</span></span>
<span id="cb385-3226"><a href="#cb385-3226" aria-hidden="true" tabindex="-1"></a><span class="in">  "Observed temperatures"</span></span>
<span id="cb385-3227"><a href="#cb385-3227" aria-hidden="true" tabindex="-1"></a><span class="in">all_heat[which(all_heat$name == "Opt1"),"Method"] &lt;-</span></span>
<span id="cb385-3228"><a href="#cb385-3228" aria-hidden="true" tabindex="-1"></a><span class="in">  "Option 1 - idealized record from proxy data"</span></span>
<span id="cb385-3229"><a href="#cb385-3229" aria-hidden="true" tabindex="-1"></a><span class="in">all_heat[which(all_heat$name == "Opt2"),"Method"] &lt;-</span></span>
<span id="cb385-3230"><a href="#cb385-3230" aria-hidden="true" tabindex="-1"></a><span class="in">  "Option 2 - idealized record from daily orchard data"</span></span>
<span id="cb385-3231"><a href="#cb385-3231" aria-hidden="true" tabindex="-1"></a><span class="in">all_heat[which(all_heat$name == "Opt3"),"Method"] &lt;-</span></span>
<span id="cb385-3232"><a href="#cb385-3232" aria-hidden="true" tabindex="-1"></a><span class="in">  "Option 3 - linear interpolation of hourly data"</span></span>
<span id="cb385-3233"><a href="#cb385-3233" aria-hidden="true" tabindex="-1"></a><span class="in">all_heat[which(all_heat$name == "Opt4"),"Method"] &lt;-</span></span>
<span id="cb385-3234"><a href="#cb385-3234" aria-hidden="true" tabindex="-1"></a><span class="in">  "Option 4 - use of interpolate_gaps_hourly"</span></span>
<span id="cb385-3235"><a href="#cb385-3235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3236"><a href="#cb385-3236" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data</span></span>
<span id="cb385-3237"><a href="#cb385-3237" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(all_heat, aes(x = DATE, y = value, colour = Method)) +</span></span>
<span id="cb385-3238"><a href="#cb385-3238" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(size = 1.2) +</span></span>
<span id="cb385-3239"><a href="#cb385-3239" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Date", y = "Heat accumulation (Growing Degree Hours)") +</span></span>
<span id="cb385-3240"><a href="#cb385-3240" aria-hidden="true" tabindex="-1"></a><span class="in">theme(</span></span>
<span id="cb385-3241"><a href="#cb385-3241" aria-hidden="true" tabindex="-1"></a><span class="in">  legend.position = c(0.4, 0.85), </span></span>
<span id="cb385-3242"><a href="#cb385-3242" aria-hidden="true" tabindex="-1"></a><span class="in">  legend.background = element_rect(fill = "white", size = 0.2),</span></span>
<span id="cb385-3243"><a href="#cb385-3243" aria-hidden="true" tabindex="-1"></a><span class="in">  legend.text = element_text(size = 12),</span></span>
<span id="cb385-3244"><a href="#cb385-3244" aria-hidden="true" tabindex="-1"></a><span class="in">  legend.title = element_text(size = 14),</span></span>
<span id="cb385-3245"><a href="#cb385-3245" aria-hidden="true" tabindex="-1"></a><span class="in">  legend.key.size = unit(1.2, "lines")</span></span>
<span id="cb385-3246"><a href="#cb385-3246" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb385-3247"><a href="#cb385-3247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3248"><a href="#cb385-3248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3249"><a href="#cb385-3249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3250"><a href="#cb385-3250" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-3251"><a href="#cb385-3251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3252"><a href="#cb385-3252" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3253"><a href="#cb385-3253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3254"><a href="#cb385-3254" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This comparison doesn’t look quite as bad as for chill accumulation, but also here, option 4 clearly provided the most accurate estimate (it almost coincides with the red line, making the difference hard to see).</span>
<span id="cb385-3255"><a href="#cb385-3255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3256"><a href="#cb385-3256" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This dataset didn’t cover the winter season, so the chill numbers aren’t too meaningful, but it is nevertheless instructive to compare the total accumulation of chill and heat over the whole temperature record:</span>
<span id="cb385-3257"><a href="#cb385-3257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3258"><a href="#cb385-3258" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.4.2c}</span></span>
<span id="cb385-3259"><a href="#cb385-3259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3260"><a href="#cb385-3260" aria-hidden="true" tabindex="-1"></a><span class="in">CH_table &lt;-</span></span>
<span id="cb385-3261"><a href="#cb385-3261" aria-hidden="true" tabindex="-1"></a><span class="in">  data.frame(Option = 0:4,</span></span>
<span id="cb385-3262"><a href="#cb385-3262" aria-hidden="true" tabindex="-1"></a><span class="in">             Input_data = c("observed","daily","daily","hourly", "hourly"),</span></span>
<span id="cb385-3263"><a href="#cb385-3263" aria-hidden="true" tabindex="-1"></a><span class="in">             Interpolation_method = c("none", "from proxy","local extremes",</span></span>
<span id="cb385-3264"><a href="#cb385-3264" aria-hidden="true" tabindex="-1"></a><span class="in">                                      "linear","hourly interpolation"),</span></span>
<span id="cb385-3265"><a href="#cb385-3265" aria-hidden="true" tabindex="-1"></a><span class="in">             Chill_Portions = NA,</span></span>
<span id="cb385-3266"><a href="#cb385-3266" aria-hidden="true" tabindex="-1"></a><span class="in">             Growing_Degree_Hours= NA)</span></span>
<span id="cb385-3267"><a href="#cb385-3267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3268"><a href="#cb385-3268" aria-hidden="true" tabindex="-1"></a><span class="in">CH_table$Chill_Portions &lt;- (all_chill %&gt;% </span></span>
<span id="cb385-3269"><a href="#cb385-3269" aria-hidden="true" tabindex="-1"></a><span class="in">                          group_by(name) %&gt;%</span></span>
<span id="cb385-3270"><a href="#cb385-3270" aria-hidden="true" tabindex="-1"></a><span class="in">                         summarise(total_value = sum(value, na.rm = TRUE)) %&gt;%</span></span>
<span id="cb385-3271"><a href="#cb385-3271" aria-hidden="true" tabindex="-1"></a><span class="in">                         ungroup())$ total_value </span></span>
<span id="cb385-3272"><a href="#cb385-3272" aria-hidden="true" tabindex="-1"></a><span class="in">                              </span></span>
<span id="cb385-3273"><a href="#cb385-3273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3274"><a href="#cb385-3274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3275"><a href="#cb385-3275" aria-hidden="true" tabindex="-1"></a><span class="in">CH_table$Growing_Degree_Hours &lt;- (all_heat %&gt;% </span></span>
<span id="cb385-3276"><a href="#cb385-3276" aria-hidden="true" tabindex="-1"></a><span class="in">                          group_by(name) %&gt;%</span></span>
<span id="cb385-3277"><a href="#cb385-3277" aria-hidden="true" tabindex="-1"></a><span class="in">                         summarise(total_value = sum(value, na.rm = TRUE)) %&gt;%</span></span>
<span id="cb385-3278"><a href="#cb385-3278" aria-hidden="true" tabindex="-1"></a><span class="in">                         ungroup())$ total_value</span></span>
<span id="cb385-3279"><a href="#cb385-3279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3280"><a href="#cb385-3280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3281"><a href="#cb385-3281" aria-hidden="true" tabindex="-1"></a><span class="in">kable(CH_table) %&gt;%</span></span>
<span id="cb385-3282"><a href="#cb385-3282" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-3283"><a href="#cb385-3283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3284"><a href="#cb385-3284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3285"><a href="#cb385-3285" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-3286"><a href="#cb385-3286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3287"><a href="#cb385-3287" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3288"><a href="#cb385-3288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3289"><a href="#cb385-3289" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This comparison shows that the choice of interpolation method can have substantial impact on our impression of accumulated chill and heat. </span>
<span id="cb385-3290"><a href="#cb385-3290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3291"><a href="#cb385-3291" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The <span class="in">`interpolate_gaps_hourly()`</span> function in <span class="in">`chillR`</span> outperformed all other methods evaluated here.</span>
<span id="cb385-3292"><a href="#cb385-3292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3293"><a href="#cb385-3293" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3294"><a href="#cb385-3294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3295"><a href="#cb385-3295" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;11.5&lt;/span&gt;&amp;nbsp; Exercises on filling gaps</span></span>
<span id="cb385-3296"><a href="#cb385-3296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3297"><a href="#cb385-3297" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-3298"><a href="#cb385-3298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3299"><a href="#cb385-3299" aria-hidden="true" tabindex="-1"></a>*You already downloaded some weather data in the exercises for the Getting temperatures lesson. You can keep working with this.*</span>
<span id="cb385-3300"><a href="#cb385-3300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3301"><a href="#cb385-3301" aria-hidden="true" tabindex="-1"></a>***1. Use `chillR` functions to find out how many gaps you have in this dataset (even if you have none, please still follow all further steps)*** </span>
<span id="cb385-3302"><a href="#cb385-3302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3303"><a href="#cb385-3303" aria-hidden="true" tabindex="-1"></a>There are large gaps in the dataset, particularly missing data for whole years between 1992 and 2002. </span>
<span id="cb385-3304"><a href="#cb385-3304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3305"><a href="#cb385-3305" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.5.1}</span></span>
<span id="cb385-3306"><a href="#cb385-3306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3307"><a href="#cb385-3307" aria-hidden="true" tabindex="-1"></a><span class="in">MS_weather &lt;- read.csv("data/MS/STG_chillR_weather.csv")</span></span>
<span id="cb385-3308"><a href="#cb385-3308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3309"><a href="#cb385-3309" aria-hidden="true" tabindex="-1"></a><span class="in">MS_weather_gap_check &lt;- fix_weather(MS_weather)$QC</span></span>
<span id="cb385-3310"><a href="#cb385-3310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3311"><a href="#cb385-3311" aria-hidden="true" tabindex="-1"></a><span class="in">kable(MS_weather_gap_check) %&gt;%</span></span>
<span id="cb385-3312"><a href="#cb385-3312" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-3313"><a href="#cb385-3313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3314"><a href="#cb385-3314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3315"><a href="#cb385-3315" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-3316"><a href="#cb385-3316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3317"><a href="#cb385-3317" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3318"><a href="#cb385-3318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3319"><a href="#cb385-3319" aria-hidden="true" tabindex="-1"></a>***2. Create a list of the 25 closest weather stations using the `handle_gsod` function***</span>
<span id="cb385-3320"><a href="#cb385-3320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3321"><a href="#cb385-3321" aria-hidden="true" tabindex="-1"></a>List of stations from GSOD database:</span>
<span id="cb385-3322"><a href="#cb385-3322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3323"><a href="#cb385-3323" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.5.2}</span></span>
<span id="cb385-3324"><a href="#cb385-3324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3325"><a href="#cb385-3325" aria-hidden="true" tabindex="-1"></a><span class="in"># Look for stations near M&amp;ouml;ssigen (48.40567° N, 9.05419° E)</span></span>
<span id="cb385-3326"><a href="#cb385-3326" aria-hidden="true" tabindex="-1"></a><span class="in">MS_station_list &lt;- handle_gsod(action = "list_stations",</span></span>
<span id="cb385-3327"><a href="#cb385-3327" aria-hidden="true" tabindex="-1"></a><span class="in">                               location = c(long = 9.05, lat = 48.40),</span></span>
<span id="cb385-3328"><a href="#cb385-3328" aria-hidden="true" tabindex="-1"></a><span class="in">                               time_interval = c(1990, 2020))</span></span>
<span id="cb385-3329"><a href="#cb385-3329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3330"><a href="#cb385-3330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3331"><a href="#cb385-3331" aria-hidden="true" tabindex="-1"></a><span class="in">kable(MS_station_list, </span></span>
<span id="cb385-3332"><a href="#cb385-3332" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "The 25 closet weather stations to Mössigen") %&gt;%</span></span>
<span id="cb385-3333"><a href="#cb385-3333" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-3334"><a href="#cb385-3334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3335"><a href="#cb385-3335" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-3336"><a href="#cb385-3336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3337"><a href="#cb385-3337" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3338"><a href="#cb385-3338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3339"><a href="#cb385-3339" aria-hidden="true" tabindex="-1"></a>I tried to patch data with stations from GSOD database, using the <span class="in">`handle_gsod()`</span> function, but I could not patch the data. I think it could be problems with distance and the few overlap years<span class="dv">&amp;mdash;</span> it didn't work even when I used all stations in the list. </span>
<span id="cb385-3340"><a href="#cb385-3340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3341"><a href="#cb385-3341" aria-hidden="true" tabindex="-1"></a>So, I looked around a bit and found <span class="in">`handle_dwd()`</span> function, which draws data from the Deutscher Wetterdienst database. Since my location is in Germany, I decided to try it and it worked well. </span>
<span id="cb385-3342"><a href="#cb385-3342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3343"><a href="#cb385-3343" aria-hidden="true" tabindex="-1"></a>Here is the list of 25 closest stations using <span class="in">`handle_dwd()`</span></span>
<span id="cb385-3344"><a href="#cb385-3344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3345"><a href="#cb385-3345" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.5.2a}</span></span>
<span id="cb385-3346"><a href="#cb385-3346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3347"><a href="#cb385-3347" aria-hidden="true" tabindex="-1"></a><span class="in">MS_station_list_dwd&lt;-handle_dwd(action="list_stations",</span></span>
<span id="cb385-3348"><a href="#cb385-3348" aria-hidden="true" tabindex="-1"></a><span class="in">                                location=c(9.05, 48.40),</span></span>
<span id="cb385-3349"><a href="#cb385-3349" aria-hidden="true" tabindex="-1"></a><span class="in">                             time_interval=c(19900101,20201231))</span></span>
<span id="cb385-3350"><a href="#cb385-3350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3351"><a href="#cb385-3351" aria-hidden="true" tabindex="-1"></a><span class="in">kable(MS_station_list_dwd) %&gt;%</span></span>
<span id="cb385-3352"><a href="#cb385-3352" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-3353"><a href="#cb385-3353" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-3354"><a href="#cb385-3354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3355"><a href="#cb385-3355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3356"><a href="#cb385-3356" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3357"><a href="#cb385-3357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3358"><a href="#cb385-3358" aria-hidden="true" tabindex="-1"></a>***3. Identify suitable weather stations for patching gaps***</span>
<span id="cb385-3359"><a href="#cb385-3359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3360"><a href="#cb385-3360" aria-hidden="true" tabindex="-1"></a>I chose the suitable weather stations based on the distance and start/end years. Here are the list of stations I chose for patching weather data:</span>
<span id="cb385-3361"><a href="#cb385-3361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3362"><a href="#cb385-3362" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.5.3}</span></span>
<span id="cb385-3363"><a href="#cb385-3363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3364"><a href="#cb385-3364" aria-hidden="true" tabindex="-1"></a><span class="in">kable(MS_station_list_dwd[c(1, 2, 4, 7),],</span></span>
<span id="cb385-3365"><a href="#cb385-3365" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "List of suitable weather stations for patching weather data") %&gt;%</span></span>
<span id="cb385-3366"><a href="#cb385-3366" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 5)</span></span>
<span id="cb385-3367"><a href="#cb385-3367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3368"><a href="#cb385-3368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3369"><a href="#cb385-3369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3370"><a href="#cb385-3370" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-3371"><a href="#cb385-3371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3372"><a href="#cb385-3372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3373"><a href="#cb385-3373" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3374"><a href="#cb385-3374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3375"><a href="#cb385-3375" aria-hidden="true" tabindex="-1"></a>***4. Download weather data for promising stations, convert them to `chillR` format and compile them in a list***</span>
<span id="cb385-3376"><a href="#cb385-3376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3377"><a href="#cb385-3377" aria-hidden="true" tabindex="-1"></a>Unlike the <span class="in">`handle_gsod()`</span> function, there is no need to convert to <span class="in">`chillR`</span> format with an additional line of code with the <span class="in">`handle_dwd()`</span> function, as seen in the table below. </span>
<span id="cb385-3378"><a href="#cb385-3378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3379"><a href="#cb385-3379" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.5.3a}</span></span>
<span id="cb385-3380"><a href="#cb385-3380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3381"><a href="#cb385-3381" aria-hidden="true" tabindex="-1"></a><span class="in"># Download weather data for promising stations</span></span>
<span id="cb385-3382"><a href="#cb385-3382" aria-hidden="true" tabindex="-1"></a><span class="in">MS_patch_weather &lt;- handle_dwd(action = "download_weather",</span></span>
<span id="cb385-3383"><a href="#cb385-3383" aria-hidden="true" tabindex="-1"></a><span class="in">                            location = MS_station_list_dwd$Station_ID[c(2,4,7,1)])</span></span>
<span id="cb385-3384"><a href="#cb385-3384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3385"><a href="#cb385-3385" aria-hidden="true" tabindex="-1"></a><span class="in">kable(MS_patch_weather[[4]] [1:10, ]) %&gt;%</span></span>
<span id="cb385-3386"><a href="#cb385-3386" aria-hidden="true" tabindex="-1"></a><span class="in">    kable_styling("striped", position = "left", font_size = 5)</span></span>
<span id="cb385-3387"><a href="#cb385-3387" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-3388"><a href="#cb385-3388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3389"><a href="#cb385-3389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3390"><a href="#cb385-3390" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3391"><a href="#cb385-3391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3392"><a href="#cb385-3392" aria-hidden="true" tabindex="-1"></a>***5. Use the `patch_daily_temperatures` function to fill gaps***</span>
<span id="cb385-3393"><a href="#cb385-3393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3394"><a href="#cb385-3394" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.5.5}</span></span>
<span id="cb385-3395"><a href="#cb385-3395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3396"><a href="#cb385-3396" aria-hidden="true" tabindex="-1"></a><span class="in">MS_weather &lt;- read.csv("data/MS/STG_chillR_weather.csv")</span></span>
<span id="cb385-3397"><a href="#cb385-3397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3398"><a href="#cb385-3398" aria-hidden="true" tabindex="-1"></a><span class="in">MS_patched &lt;- patch_daily_temperatures(weather = MS_weather,</span></span>
<span id="cb385-3399"><a href="#cb385-3399" aria-hidden="true" tabindex="-1"></a><span class="in">                                    patch_weather = MS_patch_weather,</span></span>
<span id="cb385-3400"><a href="#cb385-3400" aria-hidden="true" tabindex="-1"></a><span class="in">                                    max_mean_bias = 1,</span></span>
<span id="cb385-3401"><a href="#cb385-3401" aria-hidden="true" tabindex="-1"></a><span class="in">                                    max_stdev_bias = 2)</span></span>
<span id="cb385-3402"><a href="#cb385-3402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3403"><a href="#cb385-3403" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine list elements into a data.frame to display patched statistics</span></span>
<span id="cb385-3404"><a href="#cb385-3404" aria-hidden="true" tabindex="-1"></a><span class="in">patched_stats &lt;- do.call(rbind, MS_patched$statistics)  </span></span>
<span id="cb385-3405"><a href="#cb385-3405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3406"><a href="#cb385-3406" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(patched_stats, "data/MS/patched_stats.csv")</span></span>
<span id="cb385-3407"><a href="#cb385-3407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3408"><a href="#cb385-3408" aria-hidden="true" tabindex="-1"></a><span class="in">MS_patched_stats &lt;- read.csv("data/MS/patched_stats.csv")</span></span>
<span id="cb385-3409"><a href="#cb385-3409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3410"><a href="#cb385-3410" aria-hidden="true" tabindex="-1"></a><span class="in">kable(MS_patched_stats, caption = "Patched Statistics for Mössigen") %&gt;%</span></span>
<span id="cb385-3411"><a href="#cb385-3411" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-3412"><a href="#cb385-3412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3413"><a href="#cb385-3413" aria-hidden="true" tabindex="-1"></a><span class="in"># Save for later use</span></span>
<span id="cb385-3414"><a href="#cb385-3414" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(MS_patched$weather, "data/MS/MS_patched_weather.csv")</span></span>
<span id="cb385-3415"><a href="#cb385-3415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3416"><a href="#cb385-3416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3417"><a href="#cb385-3417" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-3418"><a href="#cb385-3418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3419"><a href="#cb385-3419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3420"><a href="#cb385-3420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3421"><a href="#cb385-3421" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3422"><a href="#cb385-3422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3423"><a href="#cb385-3423" aria-hidden="true" tabindex="-1"></a>***6. Investigate the results&amp;mdash; have all gaps been filled?***</span>
<span id="cb385-3424"><a href="#cb385-3424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3425"><a href="#cb385-3425" aria-hidden="true" tabindex="-1"></a>All gaps have been filled as shown in the table. </span>
<span id="cb385-3426"><a href="#cb385-3426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3427"><a href="#cb385-3427" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.5.6}</span></span>
<span id="cb385-3428"><a href="#cb385-3428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3429"><a href="#cb385-3429" aria-hidden="true" tabindex="-1"></a><span class="in">MS_QC &lt;- fix_weather(MS_patched)$QC</span></span>
<span id="cb385-3430"><a href="#cb385-3430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3431"><a href="#cb385-3431" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(MS_QC,"data/MS/MS_QC.csv")</span></span>
<span id="cb385-3432"><a href="#cb385-3432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3433"><a href="#cb385-3433" aria-hidden="true" tabindex="-1"></a><span class="in">MS_patched_QC &lt;- read.csv("data/MS/MS_QC.csv")</span></span>
<span id="cb385-3434"><a href="#cb385-3434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3435"><a href="#cb385-3435" aria-hidden="true" tabindex="-1"></a><span class="in">kable(MS_patched_QC,</span></span>
<span id="cb385-3436"><a href="#cb385-3436" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Check gaps on patched weather dataset for Mössigen") %&gt;%</span></span>
<span id="cb385-3437"><a href="#cb385-3437" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-3438"><a href="#cb385-3438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3439"><a href="#cb385-3439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3440"><a href="#cb385-3440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-3441"><a href="#cb385-3441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3442"><a href="#cb385-3442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3443"><a href="#cb385-3443" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3444"><a href="#cb385-3444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3445"><a href="#cb385-3445" aria-hidden="true" tabindex="-1"></a>***7. If necessary, repeat until you have a dataset you can work with in further analyses***</span>
<span id="cb385-3446"><a href="#cb385-3446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3447"><a href="#cb385-3447" aria-hidden="true" tabindex="-1"></a>I did repeat the process till I got the most suitable stations (in my opinion). The <span class="in">`handle_dwd()`</span> ran faster than the <span class="in">`handle_gsod()`</span>, so I could download all 25 stations within a few seconds. I downloaded all and check the statistics afterwards to see which stations filled the gaps. I initially chose the stations based on distance and overlap years, but then, I thought why not try all and see how it went?</span>
<span id="cb385-3448"><a href="#cb385-3448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3449"><a href="#cb385-3449" aria-hidden="true" tabindex="-1"></a>This is what I found:</span>
<span id="cb385-3450"><a href="#cb385-3450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3451"><a href="#cb385-3451" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The order to download the stations matters.</span>
<span id="cb385-3452"><a href="#cb385-3452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3453"><a href="#cb385-3453" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>At first, I found station 1 is the best choice<span class="dv">&amp;mdash;</span> closest in distance and it filled all the gaps if I didn't set threshold for <span class="in">`max_mean_bias`</span> and <span class="in">`max_stdev_bias`</span>. So, only one station would have been needed to patch all the gaps if I didn't mind <span class="in">`max_mean_bias`</span> values of a few decimal points above 1. (Why one though?) </span>
<span id="cb385-3454"><a href="#cb385-3454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3455"><a href="#cb385-3455" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When I set those bias values, the station 1 could fill all gaps for <span class="in">`Tmin`</span> but fill none for <span class="in">`Tmax`</span>. Since it filled all gaps in <span class="in">`Tmin`</span>, I think the program assumed that all gaps were filled (maybe the program consider <span class="in">`Tmin`</span> and <span class="in">`Tmax`</span> together?) and it would give <span class="in">`NA`</span> values for all remaining stations I downloaded. </span>
<span id="cb385-3456"><a href="#cb385-3456" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb385-3457"><a href="#cb385-3457" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Since I want the dataset to be patched with values below the bias thresholds, I downloaded the station 1 last (<span class="in">`MS_station_list_dwd$Station_ID[c(2,4,7,1)]`</span>), and it worked perfectly! </span>
<span id="cb385-3458"><a href="#cb385-3458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3459"><a href="#cb385-3459" aria-hidden="true" tabindex="-1"></a>Another thing I want to add here is I selected the best station from the list generated from the GSOD database, and patched that station with data from DWD database. Practically, I should have chosen the station 1 from the DWD list<span class="dv">&amp;mdash;</span> I wouldn't have any gaps and it would have been a better choice in terms of data quality. But, for the sake of doing the following exercises, I must either create gaps or use the station I chose from GSOD database. I chose the latter option because there might be times I could not go back to the past and redo everything<span class="dv">&amp;mdash;</span> I guess it is a better practice to adapt and keep going.</span>
<span id="cb385-3460"><a href="#cb385-3460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3461"><a href="#cb385-3461" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3462"><a href="#cb385-3462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3463"><a href="#cb385-3463" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 12: Generating temperature scenarios</span></span>
<span id="cb385-3464"><a href="#cb385-3464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3465"><a href="#cb385-3465" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;12.1&lt;/span&gt;&amp;nbsp; Chill scenarios</span></span>
<span id="cb385-3466"><a href="#cb385-3466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3467"><a href="#cb385-3467" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-3468"><a href="#cb385-3468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3469"><a href="#cb385-3469" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Information on chill availability (or other agroclimatic conditions) at a given site is crucial for orchard managers selecting tree species and cultivars for their orchards.</span>
<span id="cb385-3470"><a href="#cb385-3470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3471"><a href="#cb385-3471" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Looking at the historic record has already given us a lot of useful information, but this isn’t yet exactly the information that a grower making planting decisions needs. </span>
<span id="cb385-3472"><a href="#cb385-3472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3473"><a href="#cb385-3473" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>What is really needed is a site-specific agroclimatic characterization that provides an impression of the range of conditions that we can reasonably expect at this location, i.e. how likely it is for the orchard to experience certain levels of chill, heat or whatever other metric we are interested in.</span>
<span id="cb385-3474"><a href="#cb385-3474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3475"><a href="#cb385-3475" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3476"><a href="#cb385-3476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3477"><a href="#cb385-3477" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;12.2&lt;/span&gt;&amp;nbsp; Risk assessment in orchard planning</span></span>
<span id="cb385-3478"><a href="#cb385-3478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3479"><a href="#cb385-3479" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-3480"><a href="#cb385-3480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3481"><a href="#cb385-3481" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Since trees live and are (hopefully) productive for many years, they experience many different temperature dynamics during their productive lifetime.</span>
<span id="cb385-3482"><a href="#cb385-3482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3483"><a href="#cb385-3483" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For optimal production, trees should fulfill their climatic needs in all of these years.</span>
<span id="cb385-3484"><a href="#cb385-3484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3485"><a href="#cb385-3485" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This is why, when we select trees for planting, we need information on the plausible range of ‘weathers’ we can expect. </span>
<span id="cb385-3486"><a href="#cb385-3486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3487"><a href="#cb385-3487" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Based on this, we would be able to select trees that safely fulfill their chilling requirements in all plausible weather situations, or we could choose trees that strike a balance between early flowering and the risk of spring frost. </span>
<span id="cb385-3488"><a href="#cb385-3488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3489"><a href="#cb385-3489" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>All such decisions require information on how likely it is for our orchard to experience certain conditions.</span>
<span id="cb385-3490"><a href="#cb385-3490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3491"><a href="#cb385-3491" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The plausible range of ‘weathers’ we can expect is defined by the local climate, which is the long-term average of the annually observed weather. </span>
<span id="cb385-3492"><a href="#cb385-3492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3493"><a href="#cb385-3493" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We can interpret this ‘climate’ as a virtual collection of all possible weather situations for a given location, from which we receive one random draw each year.</span>
<span id="cb385-3494"><a href="#cb385-3494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3495"><a href="#cb385-3495" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Annual weather can be interpreted as a random draw from the plausible distribution of all possible ‘weathers’.</span>
<span id="cb385-3496"><a href="#cb385-3496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3497"><a href="#cb385-3497" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For planning purposes, it would be much more useful to know this virtual distribution of possible ‘weathers’ than just looking at the random samples that happened to be drawn.</span>
<span id="cb385-3498"><a href="#cb385-3498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3499"><a href="#cb385-3499" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>So far, we’ve only been able to get these samples - that was the historic analysis of observed chill.</span>
<span id="cb385-3500"><a href="#cb385-3500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3501"><a href="#cb385-3501" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We’ll try to get to the actual climate, and from there to ways to use this knowledge for producing temperature profiles for locations of interest that facilitate orchard planning.</span>
<span id="cb385-3502"><a href="#cb385-3502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3503"><a href="#cb385-3503" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3504"><a href="#cb385-3504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3505"><a href="#cb385-3505" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;12.3&lt;/span&gt;&amp;nbsp; Weather generators</span></span>
<span id="cb385-3506"><a href="#cb385-3506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3507"><a href="#cb385-3507" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-3508"><a href="#cb385-3508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3509"><a href="#cb385-3509" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The best source of information for characterizing the climate of a given location consists in long-term weather records collected there.</span>
<span id="cb385-3510"><a href="#cb385-3510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3511"><a href="#cb385-3511" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Long-term weather records can be used to easily calculate means of monthly temperatures, rainfall extremes, the frequency of frost events and various other metrics.</span>
<span id="cb385-3512"><a href="#cb385-3512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3513"><a href="#cb385-3513" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Weather generators vary widely in the way they characterize climatic settings.</span>
<span id="cb385-3514"><a href="#cb385-3514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3515"><a href="#cb385-3515" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The <span class="co">[</span><span class="ot">RMAWGEN</span><span class="co">](https://cran.r-project.org/web/packages/RMAWGEN/index.html)</span> package is the only weather generator that is compatible <span class="in">`chillR`</span> structure.</span>
<span id="cb385-3516"><a href="#cb385-3516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3517"><a href="#cb385-3517" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">LARS-WG</span><span class="co">](https://sites.google.com/view/lars-wg/)</span> is another weather generator that uses both temperature and rainfall data, identifying the typical length of dry and wet spells and producing distinct temperature profiles for each of these weather situations. (Luedeling et al., <span class="co">[</span><span class="ot">2011a</span><span class="co">](https://link.springer.com/article/10.1007/s00484-010-0352-y)</span>, <span class="co">[</span><span class="ot">2011b</span><span class="co">](https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0020155)</span>)</span>
<span id="cb385-3518"><a href="#cb385-3518" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>The tool <span class="in">`chillR`</span> currently uses doesn’t do that<span class="dv">&amp;mdash;</span> it doesn’t even need precipitation data<span class="dv">&amp;mdash;</span> but it also seems to be doing a good job. </span>
<span id="cb385-3519"><a href="#cb385-3519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3520"><a href="#cb385-3520" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-3521"><a href="#cb385-3521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3522"><a href="#cb385-3522" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It is somewhat difficult to assess the performance of these tools, so there is probably still room for improvement here.</span>
<span id="cb385-3523"><a href="#cb385-3523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3524"><a href="#cb385-3524" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3525"><a href="#cb385-3525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3526"><a href="#cb385-3526" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;12.4&lt;/span&gt;&amp;nbsp; Weather generation in `chillR`</span></span>
<span id="cb385-3527"><a href="#cb385-3527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3528"><a href="#cb385-3528" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-3529"><a href="#cb385-3529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3530"><a href="#cb385-3530" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`chillR`</span> currently can’t generate weather in a comprehensive way, but only focuses on temperature.</span>
<span id="cb385-3531"><a href="#cb385-3531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3532"><a href="#cb385-3532" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The <span class="in">`temperature_generation`</span> function in <span class="in">`chillR`</span> first needs to be calibrated with observed weather data, in our case long-term temperature data provided in the <span class="in">`chillR`</span> format.</span>
<span id="cb385-3533"><a href="#cb385-3533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3534"><a href="#cb385-3534" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Based on this, it internally calculates parameters that characterize the local climate, which are then used to simulate a user-specified number or years of synthetic temperature data.</span>
<span id="cb385-3535"><a href="#cb385-3535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3536"><a href="#cb385-3536" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Besides the temperature data, for which all years have to be complete, the <span class="in">`temperature_generation`</span> function needs a bit of additional information:</span>
<span id="cb385-3537"><a href="#cb385-3537" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**years:** a vector specifying the years within the observed record that we want to use for climate characterization</span>
<span id="cb385-3538"><a href="#cb385-3538" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**sim_years:** the years we want to simulate. Note that we’re not really simulating weather for the specific years we indicate here<span class="dv">&amp;mdash;</span> this is just for the way years are labeled in the output dataset</span>
<span id="cb385-3539"><a href="#cb385-3539" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>A few optional elements, e.g. <span class="in">`temperature_scenario`</span><span class="dv">&amp;mdash;</span> if we use the default value, which consists of a lot of zeros, it will generate a warning message. </span>
<span id="cb385-3540"><a href="#cb385-3540" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-3541"><a href="#cb385-3541" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-3542"><a href="#cb385-3542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3543"><a href="#cb385-3543" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Here is how to use the weather generator (just the first line of the code chunk) on the Klein-Altendorf dataset (<span class="in">`KA_weather`</span>), and to get an impression of how the generated data compare with the observed records.</span>
<span id="cb385-3544"><a href="#cb385-3544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3545"><a href="#cb385-3545" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 12.4a}</span></span>
<span id="cb385-3546"><a href="#cb385-3546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3547"><a href="#cb385-3547" aria-hidden="true" tabindex="-1"></a><span class="in"># Use weather generator on real weather data to generate simulated temp dataset</span></span>
<span id="cb385-3548"><a href="#cb385-3548" aria-hidden="true" tabindex="-1"></a><span class="in">Temp &lt;- KA_weather %&gt;% </span></span>
<span id="cb385-3549"><a href="#cb385-3549" aria-hidden="true" tabindex="-1"></a><span class="in">  temperature_generation(years=c(1998,2005),</span></span>
<span id="cb385-3550"><a href="#cb385-3550" aria-hidden="true" tabindex="-1"></a><span class="in">                         sim_years = c(2001,2100))</span></span>
<span id="cb385-3551"><a href="#cb385-3551" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb385-3552"><a href="#cb385-3552" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a new dataset by combining observed and simulated data</span></span>
<span id="cb385-3553"><a href="#cb385-3553" aria-hidden="true" tabindex="-1"></a><span class="in">                              # filter only data between these years</span></span>
<span id="cb385-3554"><a href="#cb385-3554" aria-hidden="true" tabindex="-1"></a><span class="in">Temperatures &lt;- KA_weather %&gt;% filter(Year %in% 1998:2005) %&gt;% </span></span>
<span id="cb385-3555"><a href="#cb385-3555" aria-hidden="true" tabindex="-1"></a><span class="in">  # only take observed data and add observe note as new Data_source column </span></span>
<span id="cb385-3556"><a href="#cb385-3556" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind(Data_source="observed") %&gt;% </span></span>
<span id="cb385-3557"><a href="#cb385-3557" aria-hidden="true" tabindex="-1"></a><span class="in">  rbind(# Only select those columns from the list 1 of Temp (it has only one list)</span></span>
<span id="cb385-3558"><a href="#cb385-3558" aria-hidden="true" tabindex="-1"></a><span class="in">    Temp[[1]] %&gt;% select(c(Year,Month,Day,Tmin,Tmax)) %&gt;% </span></span>
<span id="cb385-3559"><a href="#cb385-3559" aria-hidden="true" tabindex="-1"></a><span class="in"># only take simulated data and bind it- stack the observed and simulated rows</span></span>
<span id="cb385-3560"><a href="#cb385-3560" aria-hidden="true" tabindex="-1"></a><span class="in">      cbind(Data_source="simulated")</span></span>
<span id="cb385-3561"><a href="#cb385-3561" aria-hidden="true" tabindex="-1"></a><span class="in">    ) %&gt;%</span></span>
<span id="cb385-3562"><a href="#cb385-3562" aria-hidden="true" tabindex="-1"></a><span class="in">  # add Date column in chillR format</span></span>
<span id="cb385-3563"><a href="#cb385-3563" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Date=as.Date(ISOdate(2000,Month,Day)))</span></span>
<span id="cb385-3564"><a href="#cb385-3564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3565"><a href="#cb385-3565" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data for Tmin</span></span>
<span id="cb385-3566"><a href="#cb385-3566" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data=Temperatures,</span></span>
<span id="cb385-3567"><a href="#cb385-3567" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(Date,Tmin)) +</span></span>
<span id="cb385-3568"><a href="#cb385-3568" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(aes(colour = factor(Year))) + # different colors for each year</span></span>
<span id="cb385-3569"><a href="#cb385-3569" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(Data_source)) +</span></span>
<span id="cb385-3570"><a href="#cb385-3570" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 20) +</span></span>
<span id="cb385-3571"><a href="#cb385-3571" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "none") + # hides legend</span></span>
<span id="cb385-3572"><a href="#cb385-3572" aria-hidden="true" tabindex="-1"></a><span class="in">  # customize x-axis labels:</span></span>
<span id="cb385-3573"><a href="#cb385-3573" aria-hidden="true" tabindex="-1"></a><span class="in">  # %b:abbreviated month name, %B:full month name, %Y:year, %d:day of month,</span></span>
<span id="cb385-3574"><a href="#cb385-3574" aria-hidden="true" tabindex="-1"></a><span class="in">  # %b %Y:Abbreviated month followed by year</span></span>
<span id="cb385-3575"><a href="#cb385-3575" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_date(date_labels = "%b")</span></span>
<span id="cb385-3576"><a href="#cb385-3576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3577"><a href="#cb385-3577" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data for Tmax</span></span>
<span id="cb385-3578"><a href="#cb385-3578" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data=Temperatures,</span></span>
<span id="cb385-3579"><a href="#cb385-3579" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(Date,Tmax)) +</span></span>
<span id="cb385-3580"><a href="#cb385-3580" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(aes(colour = factor(Year))) +</span></span>
<span id="cb385-3581"><a href="#cb385-3581" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(Data_source)) +</span></span>
<span id="cb385-3582"><a href="#cb385-3582" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 20) +</span></span>
<span id="cb385-3583"><a href="#cb385-3583" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "none") +</span></span>
<span id="cb385-3584"><a href="#cb385-3584" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_date(date_labels = "%b")</span></span>
<span id="cb385-3585"><a href="#cb385-3585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3586"><a href="#cb385-3586" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-3587"><a href="#cb385-3587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3588"><a href="#cb385-3588" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3589"><a href="#cb385-3589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3590"><a href="#cb385-3590" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The <span class="in">`geom_smooth`</span> function of ggplot removed much of the noise in the dataset, which would otherwise have made this figure hard to read.</span>
<span id="cb385-3591"><a href="#cb385-3591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3592"><a href="#cb385-3592" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The overall temperature dynamics were represented quite well, though it is certainly possible that some nuances of the local weather were missed.</span>
<span id="cb385-3593"><a href="#cb385-3593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3594"><a href="#cb385-3594" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In the simulated dataset, we now have 100 years of data, even though we only used 8 years for calibration.</span>
<span id="cb385-3595"><a href="#cb385-3595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3596"><a href="#cb385-3596" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Based on these 100 years, we can now get a pretty good idea of the frequency of particular temperature-related events.</span>
<span id="cb385-3597"><a href="#cb385-3597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3598"><a href="#cb385-3598" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Let’s look at the distribution of winter chill for Klein-Altendorf based on this analysis:</span>
<span id="cb385-3599"><a href="#cb385-3599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3600"><a href="#cb385-3600" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 12.4b}</span></span>
<span id="cb385-3601"><a href="#cb385-3601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3602"><a href="#cb385-3602" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate hourly temps for observed data</span></span>
<span id="cb385-3603"><a href="#cb385-3603" aria-hidden="true" tabindex="-1"></a><span class="in">chill_observed &lt;- Temperatures %&gt;%</span></span>
<span id="cb385-3604"><a href="#cb385-3604" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Data_source == "observed") %&gt;%</span></span>
<span id="cb385-3605"><a href="#cb385-3605" aria-hidden="true" tabindex="-1"></a><span class="in">  stack_hourly_temps(latitude = 50.4) %&gt;% </span></span>
<span id="cb385-3606"><a href="#cb385-3606" aria-hidden="true" tabindex="-1"></a><span class="in">  chilling(Start_JDay = 305,</span></span>
<span id="cb385-3607"><a href="#cb385-3607" aria-hidden="true" tabindex="-1"></a><span class="in">           End_JDay = 59)</span></span>
<span id="cb385-3608"><a href="#cb385-3608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3609"><a href="#cb385-3609" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate hourly temps for simulated data </span></span>
<span id="cb385-3610"><a href="#cb385-3610" aria-hidden="true" tabindex="-1"></a><span class="in">chill_simulated &lt;- Temperatures %&gt;%</span></span>
<span id="cb385-3611"><a href="#cb385-3611" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Data_source == "simulated") %&gt;%</span></span>
<span id="cb385-3612"><a href="#cb385-3612" aria-hidden="true" tabindex="-1"></a><span class="in">  stack_hourly_temps(latitude = 50.4) %&gt;%</span></span>
<span id="cb385-3613"><a href="#cb385-3613" aria-hidden="true" tabindex="-1"></a><span class="in">  chilling(Start_JDay = 305,</span></span>
<span id="cb385-3614"><a href="#cb385-3614" aria-hidden="true" tabindex="-1"></a><span class="in">           End_JDay = 59)</span></span>
<span id="cb385-3615"><a href="#cb385-3615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3616"><a href="#cb385-3616" aria-hidden="true" tabindex="-1"></a><span class="in"># Bind observed and simulated data (stacked rows)</span></span>
<span id="cb385-3617"><a href="#cb385-3617" aria-hidden="true" tabindex="-1"></a><span class="in">chill_comparison &lt;-</span></span>
<span id="cb385-3618"><a href="#cb385-3618" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind(chill_observed,</span></span>
<span id="cb385-3619"><a href="#cb385-3619" aria-hidden="true" tabindex="-1"></a><span class="in">        Data_source = "observed") %&gt;%</span></span>
<span id="cb385-3620"><a href="#cb385-3620" aria-hidden="true" tabindex="-1"></a><span class="in">  rbind(cbind(chill_simulated,</span></span>
<span id="cb385-3621"><a href="#cb385-3621" aria-hidden="true" tabindex="-1"></a><span class="in">              Data_source = "simulated"))</span></span>
<span id="cb385-3622"><a href="#cb385-3622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3623"><a href="#cb385-3623" aria-hidden="true" tabindex="-1"></a><span class="in"># Remove years with incomplete data days</span></span>
<span id="cb385-3624"><a href="#cb385-3624" aria-hidden="true" tabindex="-1"></a><span class="in">chill_comparison_full_seasons &lt;- </span></span>
<span id="cb385-3625"><a href="#cb385-3625" aria-hidden="true" tabindex="-1"></a><span class="in">  chill_comparison %&gt;%</span></span>
<span id="cb385-3626"><a href="#cb385-3626" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Perc_complete == 100)</span></span>
<span id="cb385-3627"><a href="#cb385-3627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3628"><a href="#cb385-3628" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data</span></span>
<span id="cb385-3629"><a href="#cb385-3629" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(chill_comparison_full_seasons,</span></span>
<span id="cb385-3630"><a href="#cb385-3630" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(x=Chill_portions)) + </span></span>
<span id="cb385-3631"><a href="#cb385-3631" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram(binwidth = 1,</span></span>
<span id="cb385-3632"><a href="#cb385-3632" aria-hidden="true" tabindex="-1"></a><span class="in">                 aes(fill = factor(Data_source))) +</span></span>
<span id="cb385-3633"><a href="#cb385-3633" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 20) +</span></span>
<span id="cb385-3634"><a href="#cb385-3634" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(fill = "Data source") +</span></span>
<span id="cb385-3635"><a href="#cb385-3635" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Chill accumulation (Chill Portions)") +</span></span>
<span id="cb385-3636"><a href="#cb385-3636" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Frequency")</span></span>
<span id="cb385-3637"><a href="#cb385-3637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3638"><a href="#cb385-3638" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-3639"><a href="#cb385-3639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3640"><a href="#cb385-3640" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3641"><a href="#cb385-3641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3642"><a href="#cb385-3642" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Note that in the code chunk above, we had to manually remove all incomplete winter seasons. </span>
<span id="cb385-3643"><a href="#cb385-3643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3644"><a href="#cb385-3644" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now we have a histogram showing the distribution of chill that it would have been reasonable to expect in Klein-Altendorf betwen 1998 and 2005, and these distributions get better with more observations.</span>
<span id="cb385-3645"><a href="#cb385-3645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3646"><a href="#cb385-3646" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We can also plot these data as a cumulative distribution function, which makes it easy to extract the risk of falling below a particular level of chill accumulation.</span>
<span id="cb385-3647"><a href="#cb385-3647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3648"><a href="#cb385-3648" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 12.4c}</span></span>
<span id="cb385-3649"><a href="#cb385-3649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3650"><a href="#cb385-3650" aria-hidden="true" tabindex="-1"></a><span class="in"># Filter only the simulated data</span></span>
<span id="cb385-3651"><a href="#cb385-3651" aria-hidden="true" tabindex="-1"></a><span class="in">chill_simulations &lt;-</span></span>
<span id="cb385-3652"><a href="#cb385-3652" aria-hidden="true" tabindex="-1"></a><span class="in">  chill_comparison_full_seasons %&gt;%</span></span>
<span id="cb385-3653"><a href="#cb385-3653" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Data_source == "simulated")</span></span>
<span id="cb385-3654"><a href="#cb385-3654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3655"><a href="#cb385-3655" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the chill portions of the data</span></span>
<span id="cb385-3656"><a href="#cb385-3656" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(chill_simulations,</span></span>
<span id="cb385-3657"><a href="#cb385-3657" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(x = Chill_portions)) +</span></span>
<span id="cb385-3658"><a href="#cb385-3658" aria-hidden="true" tabindex="-1"></a><span class="in">  # Compute empirical cumulative distribution</span></span>
<span id="cb385-3659"><a href="#cb385-3659" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_ecdf(geom = "step", # a step plot</span></span>
<span id="cb385-3660"><a href="#cb385-3660" aria-hidden="true" tabindex="-1"></a><span class="in">            lwd = 1.5,</span></span>
<span id="cb385-3661"><a href="#cb385-3661" aria-hidden="true" tabindex="-1"></a><span class="in">            col = "blue") +</span></span>
<span id="cb385-3662"><a href="#cb385-3662" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Cumulative probability") +</span></span>
<span id="cb385-3663"><a href="#cb385-3663" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Chill accumulation (in Chill Portions)") +</span></span>
<span id="cb385-3664"><a href="#cb385-3664" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 20)</span></span>
<span id="cb385-3665"><a href="#cb385-3665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3666"><a href="#cb385-3666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3667"><a href="#cb385-3667" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-3668"><a href="#cb385-3668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3669"><a href="#cb385-3669" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3670"><a href="#cb385-3670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3671"><a href="#cb385-3671" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We can also directly compute this using the <span class="in">`quantile`</span> function.</span>
<span id="cb385-3672"><a href="#cb385-3672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3673"><a href="#cb385-3673" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 12.4d}</span></span>
<span id="cb385-3674"><a href="#cb385-3674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3675"><a href="#cb385-3675" aria-hidden="true" tabindex="-1"></a><span class="in"># Here's the amount of chill that is exceeded in 90% of all years.</span></span>
<span id="cb385-3676"><a href="#cb385-3676" aria-hidden="true" tabindex="-1"></a><span class="in">quantile(chill_simulations$Chill_portions,0.1)</span></span>
<span id="cb385-3677"><a href="#cb385-3677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3678"><a href="#cb385-3678" aria-hidden="true" tabindex="-1"></a><span class="in"># and here's the 50% confidence interval (25th to 75th percentile)</span></span>
<span id="cb385-3679"><a href="#cb385-3679" aria-hidden="true" tabindex="-1"></a><span class="in">quantile(chill_simulations$Chill_portions, c(0.25,0.75))</span></span>
<span id="cb385-3680"><a href="#cb385-3680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3681"><a href="#cb385-3681" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-3682"><a href="#cb385-3682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3683"><a href="#cb385-3683" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3684"><a href="#cb385-3684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3685"><a href="#cb385-3685" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Note that the 10% quantile calculated above is equivalent to ‘Safe Winter Chill’. </span>
<span id="cb385-3686"><a href="#cb385-3686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3687"><a href="#cb385-3687" aria-hidden="true" tabindex="-1"></a>!<span class="co">[</span><span class="ot">Illustration of the concept of Safe Winter Chill, which is defined as the 10% quantile of the typical distribution of chill at a particular location and best calculated by using a weather generator. ([Luedeling et al., 2009d](https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0006166))</span><span class="co">](./pic/ch12_1.png)</span></span>
<span id="cb385-3688"><a href="#cb385-3688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3689"><a href="#cb385-3689" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3690"><a href="#cb385-3690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3691"><a href="#cb385-3691" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The idea behind Safe Winter Chill is that a grower might be able to tolerate a small risk of not meeting a tree’s chilling requirement.</span>
<span id="cb385-3692"><a href="#cb385-3692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3693"><a href="#cb385-3693" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If we grow a tree with a chilling requirement that corresponds exactly to the Safe Winter Chill of the site, we should expect chill-related problems in about one out of ten years<span class="dv">&amp;mdash;</span> may or may not be an okay threshold based on the grower's risk tolerance, but it is still a reasonable threshold to use. </span>
<span id="cb385-3694"><a href="#cb385-3694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3695"><a href="#cb385-3695" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A similar metric can be calculated for a grower with a different level of risk tolerance. </span>
<span id="cb385-3696"><a href="#cb385-3696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3697"><a href="#cb385-3697" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3698"><a href="#cb385-3698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3699"><a href="#cb385-3699" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;12.5&lt;/span&gt;&amp;nbsp; Exercises on temperature generation</span></span>
<span id="cb385-3700"><a href="#cb385-3700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3701"><a href="#cb385-3701" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-3702"><a href="#cb385-3702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3703"><a href="#cb385-3703" aria-hidden="true" tabindex="-1"></a>***1. For the location you chose for your earlier analyses, use `chillR`’s weather generator to produce 100 years of synthetic temperature data.***</span>
<span id="cb385-3704"><a href="#cb385-3704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3705"><a href="#cb385-3705" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 12.5.1, , fig.width=10, fig.height=8}</span></span>
<span id="cb385-3706"><a href="#cb385-3706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3707"><a href="#cb385-3707" aria-hidden="true" tabindex="-1"></a><span class="in">MS_patched_weather &lt;- read.csv("data/MS/MS_patched_weather.csv")</span></span>
<span id="cb385-3708"><a href="#cb385-3708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3709"><a href="#cb385-3709" aria-hidden="true" tabindex="-1"></a><span class="in">MS_temp &lt;- MS_patched_weather %&gt;% </span></span>
<span id="cb385-3710"><a href="#cb385-3710" aria-hidden="true" tabindex="-1"></a><span class="in">  temperature_generation(years=c(1990,2020),</span></span>
<span id="cb385-3711"><a href="#cb385-3711" aria-hidden="true" tabindex="-1"></a><span class="in">                         sim_years = c(2001,2100))</span></span>
<span id="cb385-3712"><a href="#cb385-3712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3713"><a href="#cb385-3713" aria-hidden="true" tabindex="-1"></a><span class="in"># Modify the MS_patched_weather dataset to have same column structures as MS_temp</span></span>
<span id="cb385-3714"><a href="#cb385-3714" aria-hidden="true" tabindex="-1"></a><span class="in">MS_patched_weather_fixed &lt;- MS_patched_weather %&gt;%</span></span>
<span id="cb385-3715"><a href="#cb385-3715" aria-hidden="true" tabindex="-1"></a><span class="in">  select(Year, Month, Day, Tmin, Tmax)</span></span>
<span id="cb385-3716"><a href="#cb385-3716" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb385-3717"><a href="#cb385-3717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3718"><a href="#cb385-3718" aria-hidden="true" tabindex="-1"></a><span class="in">MS_temperatures &lt;- MS_patched_weather_fixed %&gt;% filter(Year %in% 1990:2020) %&gt;%</span></span>
<span id="cb385-3719"><a href="#cb385-3719" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind(Data_source="observed") %&gt;%</span></span>
<span id="cb385-3720"><a href="#cb385-3720" aria-hidden="true" tabindex="-1"></a><span class="in">  rbind(</span></span>
<span id="cb385-3721"><a href="#cb385-3721" aria-hidden="true" tabindex="-1"></a><span class="in">    MS_temp[[1]] %&gt;% select(c(Year,Month,Day,Tmin,Tmax)) %&gt;% </span></span>
<span id="cb385-3722"><a href="#cb385-3722" aria-hidden="true" tabindex="-1"></a><span class="in">      cbind(Data_source="simulated")</span></span>
<span id="cb385-3723"><a href="#cb385-3723" aria-hidden="true" tabindex="-1"></a><span class="in">    ) %&gt;%</span></span>
<span id="cb385-3724"><a href="#cb385-3724" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Date=as.Date(ISOdate(2000,Month,Day)))</span></span>
<span id="cb385-3725"><a href="#cb385-3725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3726"><a href="#cb385-3726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3727"><a href="#cb385-3727" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot for Tmin</span></span>
<span id="cb385-3728"><a href="#cb385-3728" aria-hidden="true" tabindex="-1"></a><span class="in">p1 &lt;- ggplot(data=MS_temperatures, aes(Date, Tmin)) +</span></span>
<span id="cb385-3729"><a href="#cb385-3729" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(aes(colour = factor(Year))) +</span></span>
<span id="cb385-3730"><a href="#cb385-3730" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(Data_source)) +</span></span>
<span id="cb385-3731"><a href="#cb385-3731" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 20) +</span></span>
<span id="cb385-3732"><a href="#cb385-3732" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "none") +</span></span>
<span id="cb385-3733"><a href="#cb385-3733" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_date(date_labels = "%b")</span></span>
<span id="cb385-3734"><a href="#cb385-3734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3735"><a href="#cb385-3735" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot for Tmax</span></span>
<span id="cb385-3736"><a href="#cb385-3736" aria-hidden="true" tabindex="-1"></a><span class="in">p2 &lt;- ggplot(data=MS_temperatures, aes(Date, Tmax)) +</span></span>
<span id="cb385-3737"><a href="#cb385-3737" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(aes(colour = factor(Year))) +</span></span>
<span id="cb385-3738"><a href="#cb385-3738" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(Data_source)) +</span></span>
<span id="cb385-3739"><a href="#cb385-3739" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 20) +</span></span>
<span id="cb385-3740"><a href="#cb385-3740" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "none") +</span></span>
<span id="cb385-3741"><a href="#cb385-3741" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_date(date_labels = "%b")</span></span>
<span id="cb385-3742"><a href="#cb385-3742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3743"><a href="#cb385-3743" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine the plots vertically</span></span>
<span id="cb385-3744"><a href="#cb385-3744" aria-hidden="true" tabindex="-1"></a><span class="in">p1 / p2</span></span>
<span id="cb385-3745"><a href="#cb385-3745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3746"><a href="#cb385-3746" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-3747"><a href="#cb385-3747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3748"><a href="#cb385-3748" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3749"><a href="#cb385-3749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3750"><a href="#cb385-3750" aria-hidden="true" tabindex="-1"></a>***2. Calculate winter chill (in Chill Portions) for your synthetic weather, and illustrate your results as histograms and cumulative distributions.***</span>
<span id="cb385-3751"><a href="#cb385-3751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3752"><a href="#cb385-3752" aria-hidden="true" tabindex="-1"></a>**Winter chill in Mössingen as histogram:**</span>
<span id="cb385-3753"><a href="#cb385-3753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3754"><a href="#cb385-3754" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 12.5.2a}</span></span>
<span id="cb385-3755"><a href="#cb385-3755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3756"><a href="#cb385-3756" aria-hidden="true" tabindex="-1"></a><span class="in">MS_chill_observed &lt;- MS_temperatures %&gt;%</span></span>
<span id="cb385-3757"><a href="#cb385-3757" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Data_source == "observed") %&gt;%</span></span>
<span id="cb385-3758"><a href="#cb385-3758" aria-hidden="true" tabindex="-1"></a><span class="in">  stack_hourly_temps(latitude = 48.4) %&gt;%</span></span>
<span id="cb385-3759"><a href="#cb385-3759" aria-hidden="true" tabindex="-1"></a><span class="in">  chilling(Start_JDay = 305,</span></span>
<span id="cb385-3760"><a href="#cb385-3760" aria-hidden="true" tabindex="-1"></a><span class="in">           End_JDay = 59)</span></span>
<span id="cb385-3761"><a href="#cb385-3761" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-3762"><a href="#cb385-3762" aria-hidden="true" tabindex="-1"></a><span class="in">MS_chill_simulated &lt;- MS_temperatures %&gt;%</span></span>
<span id="cb385-3763"><a href="#cb385-3763" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Data_source == "simulated") %&gt;%</span></span>
<span id="cb385-3764"><a href="#cb385-3764" aria-hidden="true" tabindex="-1"></a><span class="in">  stack_hourly_temps(latitude = 48.4) %&gt;%</span></span>
<span id="cb385-3765"><a href="#cb385-3765" aria-hidden="true" tabindex="-1"></a><span class="in">  chilling(Start_JDay = 305,</span></span>
<span id="cb385-3766"><a href="#cb385-3766" aria-hidden="true" tabindex="-1"></a><span class="in">           End_JDay = 59)</span></span>
<span id="cb385-3767"><a href="#cb385-3767" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-3768"><a href="#cb385-3768" aria-hidden="true" tabindex="-1"></a><span class="in">MS_chill_comparison &lt;-</span></span>
<span id="cb385-3769"><a href="#cb385-3769" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind(MS_chill_observed,</span></span>
<span id="cb385-3770"><a href="#cb385-3770" aria-hidden="true" tabindex="-1"></a><span class="in">        Data_source = "observed") %&gt;%</span></span>
<span id="cb385-3771"><a href="#cb385-3771" aria-hidden="true" tabindex="-1"></a><span class="in">  rbind(cbind(MS_chill_simulated,</span></span>
<span id="cb385-3772"><a href="#cb385-3772" aria-hidden="true" tabindex="-1"></a><span class="in">              Data_source = "simulated"))</span></span>
<span id="cb385-3773"><a href="#cb385-3773" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-3774"><a href="#cb385-3774" aria-hidden="true" tabindex="-1"></a><span class="in">MS_chill_comparison_full_seasons &lt;- </span></span>
<span id="cb385-3775"><a href="#cb385-3775" aria-hidden="true" tabindex="-1"></a><span class="in">  MS_chill_comparison %&gt;%</span></span>
<span id="cb385-3776"><a href="#cb385-3776" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Perc_complete == 100)</span></span>
<span id="cb385-3777"><a href="#cb385-3777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3778"><a href="#cb385-3778" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(MS_chill_comparison_full_seasons,</span></span>
<span id="cb385-3779"><a href="#cb385-3779" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(x=Chill_portions)) + </span></span>
<span id="cb385-3780"><a href="#cb385-3780" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram(binwidth = 1,</span></span>
<span id="cb385-3781"><a href="#cb385-3781" aria-hidden="true" tabindex="-1"></a><span class="in">                 aes(fill = factor(Data_source))) +</span></span>
<span id="cb385-3782"><a href="#cb385-3782" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 20) +</span></span>
<span id="cb385-3783"><a href="#cb385-3783" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(fill = "Data source") +</span></span>
<span id="cb385-3784"><a href="#cb385-3784" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Chill accumulation (Chill Portions)") +</span></span>
<span id="cb385-3785"><a href="#cb385-3785" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Frequency")</span></span>
<span id="cb385-3786"><a href="#cb385-3786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3787"><a href="#cb385-3787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3788"><a href="#cb385-3788" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-3789"><a href="#cb385-3789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3790"><a href="#cb385-3790" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3791"><a href="#cb385-3791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3792"><a href="#cb385-3792" aria-hidden="true" tabindex="-1"></a>**Winter chill in Mössingen as cumulative distribution:**</span>
<span id="cb385-3793"><a href="#cb385-3793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3794"><a href="#cb385-3794" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 12.5.2b}</span></span>
<span id="cb385-3795"><a href="#cb385-3795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3796"><a href="#cb385-3796" aria-hidden="true" tabindex="-1"></a><span class="in">MS_chill_simulations &lt;-</span></span>
<span id="cb385-3797"><a href="#cb385-3797" aria-hidden="true" tabindex="-1"></a><span class="in">  MS_chill_comparison_full_seasons %&gt;%</span></span>
<span id="cb385-3798"><a href="#cb385-3798" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Data_source == "simulated")</span></span>
<span id="cb385-3799"><a href="#cb385-3799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3800"><a href="#cb385-3800" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(MS_chill_simulations,</span></span>
<span id="cb385-3801"><a href="#cb385-3801" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(x = Chill_portions)) +</span></span>
<span id="cb385-3802"><a href="#cb385-3802" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_ecdf(geom = "step",</span></span>
<span id="cb385-3803"><a href="#cb385-3803" aria-hidden="true" tabindex="-1"></a><span class="in">            lwd = 1.5,</span></span>
<span id="cb385-3804"><a href="#cb385-3804" aria-hidden="true" tabindex="-1"></a><span class="in">            col = "blue") +</span></span>
<span id="cb385-3805"><a href="#cb385-3805" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Cumulative probability") +</span></span>
<span id="cb385-3806"><a href="#cb385-3806" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Chill accumulation (in Chill Portions)") +</span></span>
<span id="cb385-3807"><a href="#cb385-3807" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 20)</span></span>
<span id="cb385-3808"><a href="#cb385-3808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3809"><a href="#cb385-3809" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-3810"><a href="#cb385-3810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3811"><a href="#cb385-3811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3812"><a href="#cb385-3812" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3813"><a href="#cb385-3813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3814"><a href="#cb385-3814" aria-hidden="true" tabindex="-1"></a>***3. Produce similar plots for the number of freezing hours (&lt;0°C) in April (or October, if your site is in the Southern Hemisphere) for your location of interest.***</span>
<span id="cb385-3815"><a href="#cb385-3815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3816"><a href="#cb385-3816" aria-hidden="true" tabindex="-1"></a>**Check JDay for the month of April:**</span>
<span id="cb385-3817"><a href="#cb385-3817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3818"><a href="#cb385-3818" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 12.5.3a, message=FALSE, warning=FALSE}</span></span>
<span id="cb385-3819"><a href="#cb385-3819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3820"><a href="#cb385-3820" aria-hidden="true" tabindex="-1"></a><span class="in"># Add a freezing model </span></span>
<span id="cb385-3821"><a href="#cb385-3821" aria-hidden="true" tabindex="-1"></a><span class="in">df &lt;- data.frame(</span></span>
<span id="cb385-3822"><a href="#cb385-3822" aria-hidden="true" tabindex="-1"></a><span class="in">  lower= c(-1000, 0),</span></span>
<span id="cb385-3823"><a href="#cb385-3823" aria-hidden="true" tabindex="-1"></a><span class="in">  upper= c(    0, 1000),</span></span>
<span id="cb385-3824"><a href="#cb385-3824" aria-hidden="true" tabindex="-1"></a><span class="in">  weight=c(    1, 0))</span></span>
<span id="cb385-3825"><a href="#cb385-3825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3826"><a href="#cb385-3826" aria-hidden="true" tabindex="-1"></a><span class="in">freezing_hours &lt;- function(x) step_model(x,df)</span></span>
<span id="cb385-3827"><a href="#cb385-3827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3828"><a href="#cb385-3828" aria-hidden="true" tabindex="-1"></a><span class="in">## Check JDay number for the month of April</span></span>
<span id="cb385-3829"><a href="#cb385-3829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3830"><a href="#cb385-3830" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate JDay for the dataset</span></span>
<span id="cb385-3831"><a href="#cb385-3831" aria-hidden="true" tabindex="-1"></a><span class="in">JDay_MS &lt;- make_JDay(MS_temperatures$Date)</span></span>
<span id="cb385-3832"><a href="#cb385-3832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3833"><a href="#cb385-3833" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a data frame because JDay_MS is a vector</span></span>
<span id="cb385-3834"><a href="#cb385-3834" aria-hidden="true" tabindex="-1"></a><span class="in">JDay_MS_df &lt;- data.frame(Date = as.Date(JDay_MS))</span></span>
<span id="cb385-3835"><a href="#cb385-3835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3836"><a href="#cb385-3836" aria-hidden="true" tabindex="-1"></a><span class="in"># Extract Year, Month, and Day from the Date (to show JDay output as table)</span></span>
<span id="cb385-3837"><a href="#cb385-3837" aria-hidden="true" tabindex="-1"></a><span class="in"># This was only done because of the error message:</span></span>
<span id="cb385-3838"><a href="#cb385-3838" aria-hidden="true" tabindex="-1"></a><span class="in"># "Table is missing at least one required column ('Day','Month' or 'Year')"</span></span>
<span id="cb385-3839"><a href="#cb385-3839" aria-hidden="true" tabindex="-1"></a><span class="in">JDay_MS_df$Year &lt;- format(JDay_MS_df$Date, "%Y")</span></span>
<span id="cb385-3840"><a href="#cb385-3840" aria-hidden="true" tabindex="-1"></a><span class="in">JDay_MS_df$Month &lt;- format(JDay_MS_df$Date, "%m")</span></span>
<span id="cb385-3841"><a href="#cb385-3841" aria-hidden="true" tabindex="-1"></a><span class="in">JDay_MS_df$Day &lt;- format(JDay_MS_df$Date, "%d")</span></span>
<span id="cb385-3842"><a href="#cb385-3842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3843"><a href="#cb385-3843" aria-hidden="true" tabindex="-1"></a><span class="in"># Display only for the month of April</span></span>
<span id="cb385-3844"><a href="#cb385-3844" aria-hidden="true" tabindex="-1"></a><span class="in">JDay_april &lt;- JDay_MS_df[91:120, ] </span></span>
<span id="cb385-3845"><a href="#cb385-3845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3846"><a href="#cb385-3846" aria-hidden="true" tabindex="-1"></a><span class="in">kable(JDay_april[c(1, nrow(JDay_april)), ], col.names =</span></span>
<span id="cb385-3847"><a href="#cb385-3847" aria-hidden="true" tabindex="-1"></a><span class="in">        c("JDay", "Date", "Year", "Month", "Day")) %&gt;%</span></span>
<span id="cb385-3848"><a href="#cb385-3848" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-3849"><a href="#cb385-3849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3850"><a href="#cb385-3850" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-3851"><a href="#cb385-3851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3852"><a href="#cb385-3852" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3853"><a href="#cb385-3853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3854"><a href="#cb385-3854" aria-hidden="true" tabindex="-1"></a>**Frost incidence in Mössingen as histogram:**</span>
<span id="cb385-3855"><a href="#cb385-3855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3856"><a href="#cb385-3856" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 12.5.3b}</span></span>
<span id="cb385-3857"><a href="#cb385-3857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3858"><a href="#cb385-3858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3859"><a href="#cb385-3859" aria-hidden="true" tabindex="-1"></a><span class="in">MS_apr_chill_observed &lt;- MS_temperatures %&gt;%</span></span>
<span id="cb385-3860"><a href="#cb385-3860" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Data_source == "observed") %&gt;% </span></span>
<span id="cb385-3861"><a href="#cb385-3861" aria-hidden="true" tabindex="-1"></a><span class="in">  stack_hourly_temps(latitude = 48.4) %&gt;%</span></span>
<span id="cb385-3862"><a href="#cb385-3862" aria-hidden="true" tabindex="-1"></a><span class="in">  tempResponse(Start_JDay = 91,</span></span>
<span id="cb385-3863"><a href="#cb385-3863" aria-hidden="true" tabindex="-1"></a><span class="in">               End_JDay = 120,</span></span>
<span id="cb385-3864"><a href="#cb385-3864" aria-hidden="true" tabindex="-1"></a><span class="in">               models = list(Frost = freezing_hours,</span></span>
<span id="cb385-3865"><a href="#cb385-3865" aria-hidden="true" tabindex="-1"></a><span class="in">                             Chill_portions = Dynamic_Model,</span></span>
<span id="cb385-3866"><a href="#cb385-3866" aria-hidden="true" tabindex="-1"></a><span class="in">                             GDH = GDH))</span></span>
<span id="cb385-3867"><a href="#cb385-3867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3868"><a href="#cb385-3868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3869"><a href="#cb385-3869" aria-hidden="true" tabindex="-1"></a><span class="in">MS_apr_chill_simulated &lt;- MS_temperatures %&gt;%</span></span>
<span id="cb385-3870"><a href="#cb385-3870" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Data_source == "simulated") %&gt;% </span></span>
<span id="cb385-3871"><a href="#cb385-3871" aria-hidden="true" tabindex="-1"></a><span class="in">  stack_hourly_temps(latitude = 48.4) %&gt;%</span></span>
<span id="cb385-3872"><a href="#cb385-3872" aria-hidden="true" tabindex="-1"></a><span class="in">  tempResponse(Start_JDay = 91, </span></span>
<span id="cb385-3873"><a href="#cb385-3873" aria-hidden="true" tabindex="-1"></a><span class="in">               End_JDay = 120,</span></span>
<span id="cb385-3874"><a href="#cb385-3874" aria-hidden="true" tabindex="-1"></a><span class="in">               models=list(Frost = freezing_hours,</span></span>
<span id="cb385-3875"><a href="#cb385-3875" aria-hidden="true" tabindex="-1"></a><span class="in">                           Chill_portions = Dynamic_Model,</span></span>
<span id="cb385-3876"><a href="#cb385-3876" aria-hidden="true" tabindex="-1"></a><span class="in">                           GDH = GDH))</span></span>
<span id="cb385-3877"><a href="#cb385-3877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3878"><a href="#cb385-3878" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine observed and simulated in one data frame</span></span>
<span id="cb385-3879"><a href="#cb385-3879" aria-hidden="true" tabindex="-1"></a><span class="in">MS_apr_chill_comparison &lt;-</span></span>
<span id="cb385-3880"><a href="#cb385-3880" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind(MS_apr_chill_observed, </span></span>
<span id="cb385-3881"><a href="#cb385-3881" aria-hidden="true" tabindex="-1"></a><span class="in">        Data_source = "observed") %&gt;%</span></span>
<span id="cb385-3882"><a href="#cb385-3882" aria-hidden="true" tabindex="-1"></a><span class="in">  rbind(cbind(MS_apr_chill_simulated, </span></span>
<span id="cb385-3883"><a href="#cb385-3883" aria-hidden="true" tabindex="-1"></a><span class="in">              Data_source = "simulated"))</span></span>
<span id="cb385-3884"><a href="#cb385-3884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3885"><a href="#cb385-3885" aria-hidden="true" tabindex="-1"></a><span class="in"># Only include the columns with full data </span></span>
<span id="cb385-3886"><a href="#cb385-3886" aria-hidden="true" tabindex="-1"></a><span class="in">MS_apr_chill_comparison_full_seasons &lt;-</span></span>
<span id="cb385-3887"><a href="#cb385-3887" aria-hidden="true" tabindex="-1"></a><span class="in">  MS_apr_chill_comparison %&gt;%</span></span>
<span id="cb385-3888"><a href="#cb385-3888" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Perc_complete == 100)</span></span>
<span id="cb385-3889"><a href="#cb385-3889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3890"><a href="#cb385-3890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3891"><a href="#cb385-3891" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(MS_apr_chill_comparison_full_seasons,</span></span>
<span id="cb385-3892"><a href="#cb385-3892" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(x = Frost)) + </span></span>
<span id="cb385-3893"><a href="#cb385-3893" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram(binwidth = 10,</span></span>
<span id="cb385-3894"><a href="#cb385-3894" aria-hidden="true" tabindex="-1"></a><span class="in">                 aes(fill = factor(Data_source))) +</span></span>
<span id="cb385-3895"><a href="#cb385-3895" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 10) +</span></span>
<span id="cb385-3896"><a href="#cb385-3896" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(fill = "Data source") +</span></span>
<span id="cb385-3897"><a href="#cb385-3897" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Frost incidence during April (hours)") +</span></span>
<span id="cb385-3898"><a href="#cb385-3898" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Frequency")</span></span>
<span id="cb385-3899"><a href="#cb385-3899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3900"><a href="#cb385-3900" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-3901"><a href="#cb385-3901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3902"><a href="#cb385-3902" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3903"><a href="#cb385-3903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3904"><a href="#cb385-3904" aria-hidden="true" tabindex="-1"></a>**Frost incidence in Mössingen as cumulative probability:**</span>
<span id="cb385-3905"><a href="#cb385-3905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3906"><a href="#cb385-3906" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 12.5.3c}</span></span>
<span id="cb385-3907"><a href="#cb385-3907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3908"><a href="#cb385-3908" aria-hidden="true" tabindex="-1"></a><span class="in">MS_apr_chill_simulations &lt;-</span></span>
<span id="cb385-3909"><a href="#cb385-3909" aria-hidden="true" tabindex="-1"></a><span class="in">  MS_apr_chill_comparison_full_seasons %&gt;%</span></span>
<span id="cb385-3910"><a href="#cb385-3910" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Data_source == "simulated")</span></span>
<span id="cb385-3911"><a href="#cb385-3911" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-3912"><a href="#cb385-3912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3913"><a href="#cb385-3913" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(MS_apr_chill_simulations,</span></span>
<span id="cb385-3914"><a href="#cb385-3914" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(x = Frost)) +</span></span>
<span id="cb385-3915"><a href="#cb385-3915" aria-hidden="true" tabindex="-1"></a><span class="in">  stat_ecdf(geom = "step",</span></span>
<span id="cb385-3916"><a href="#cb385-3916" aria-hidden="true" tabindex="-1"></a><span class="in">            lwd = 1.5,</span></span>
<span id="cb385-3917"><a href="#cb385-3917" aria-hidden="true" tabindex="-1"></a><span class="in">            col = "blue") +</span></span>
<span id="cb385-3918"><a href="#cb385-3918" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Cumulative probability") +</span></span>
<span id="cb385-3919"><a href="#cb385-3919" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Frost incidence during April (hours)") +</span></span>
<span id="cb385-3920"><a href="#cb385-3920" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 20)</span></span>
<span id="cb385-3921"><a href="#cb385-3921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3922"><a href="#cb385-3922" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-3923"><a href="#cb385-3923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3924"><a href="#cb385-3924" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3925"><a href="#cb385-3925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3926"><a href="#cb385-3926" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 13: Saving and loading data (and hiding this in markdown)</span></span>
<span id="cb385-3927"><a href="#cb385-3927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3928"><a href="#cb385-3928" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;13.1&lt;/span&gt;&amp;nbsp; Saving and loading data</span></span>
<span id="cb385-3929"><a href="#cb385-3929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3930"><a href="#cb385-3930" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-3931"><a href="#cb385-3931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3932"><a href="#cb385-3932" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`save`</span> and <span class="in">`load`</span> functions in <span class="in">`R`</span><span class="dv">&amp;mdash;</span> may not allow to manually open the file for inspection outside <span class="in">`R`</span>?</span>
<span id="cb385-3933"><a href="#cb385-3933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3934"><a href="#cb385-3934" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For simple <span class="in">`data.frames`</span> saving can simply be done using the <span class="in">`write.csv`</span> function. </span>
<span id="cb385-3935"><a href="#cb385-3935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3936"><a href="#cb385-3936" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`chillR`</span> function called <span class="in">`read_tab`</span> is similar to <span class="in">`R`</span>'s inbuilt <span class="in">`read.csv`</span>, read the comma-separated values of the saved files, but the German computers separate values in csv file by semicolons<span class="dv">&amp;mdash;</span> the <span class="in">`read_tab`</span> function recognizes this and correctly reads files from different language regions. </span>
<span id="cb385-3937"><a href="#cb385-3937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3938"><a href="#cb385-3938" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 13.1a}</span></span>
<span id="cb385-3939"><a href="#cb385-3939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3940"><a href="#cb385-3940" aria-hidden="true" tabindex="-1"></a><span class="in"># Recall from last lesson (for knitting)</span></span>
<span id="cb385-3941"><a href="#cb385-3941" aria-hidden="true" tabindex="-1"></a><span class="in">Temp &lt;- KA_weather %&gt;% </span></span>
<span id="cb385-3942"><a href="#cb385-3942" aria-hidden="true" tabindex="-1"></a><span class="in">  temperature_generation(years=c(1998,2005),</span></span>
<span id="cb385-3943"><a href="#cb385-3943" aria-hidden="true" tabindex="-1"></a><span class="in">                         sim_years = c(2001,2100))</span></span>
<span id="cb385-3944"><a href="#cb385-3944" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb385-3945"><a href="#cb385-3945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3946"><a href="#cb385-3946" aria-hidden="true" tabindex="-1"></a><span class="in">Temperatures &lt;- KA_weather %&gt;% filter(Year %in% 1998:2005) %&gt;%</span></span>
<span id="cb385-3947"><a href="#cb385-3947" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind(Data_source="observed") %&gt;%</span></span>
<span id="cb385-3948"><a href="#cb385-3948" aria-hidden="true" tabindex="-1"></a><span class="in">  rbind(</span></span>
<span id="cb385-3949"><a href="#cb385-3949" aria-hidden="true" tabindex="-1"></a><span class="in">    Temp[[1]] %&gt;% select(c(Year,Month,Day,Tmin,Tmax)) %&gt;% </span></span>
<span id="cb385-3950"><a href="#cb385-3950" aria-hidden="true" tabindex="-1"></a><span class="in">      cbind(Data_source="simulated")</span></span>
<span id="cb385-3951"><a href="#cb385-3951" aria-hidden="true" tabindex="-1"></a><span class="in">    ) %&gt;%</span></span>
<span id="cb385-3952"><a href="#cb385-3952" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Date=as.Date(ISOdate(2000,Month,Day)))</span></span>
<span id="cb385-3953"><a href="#cb385-3953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3954"><a href="#cb385-3954" aria-hidden="true" tabindex="-1"></a><span class="in"># Display head data</span></span>
<span id="cb385-3955"><a href="#cb385-3955" aria-hidden="true" tabindex="-1"></a><span class="in">kable(head(Temperatures)) %&gt;%</span></span>
<span id="cb385-3956"><a href="#cb385-3956" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-3957"><a href="#cb385-3957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3958"><a href="#cb385-3958" aria-hidden="true" tabindex="-1"></a><span class="in"># Save the data</span></span>
<span id="cb385-3959"><a href="#cb385-3959" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(Temperatures, file="data/OT/Temperatures.csv",</span></span>
<span id="cb385-3960"><a href="#cb385-3960" aria-hidden="true" tabindex="-1"></a><span class="in">          row.names = FALSE) # don't want rows to be numbered</span></span>
<span id="cb385-3961"><a href="#cb385-3961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3962"><a href="#cb385-3962" aria-hidden="true" tabindex="-1"></a><span class="in"># Load the data again</span></span>
<span id="cb385-3963"><a href="#cb385-3963" aria-hidden="true" tabindex="-1"></a><span class="in">Temperatures &lt;- read_tab("data/OT/Temperatures.csv")</span></span>
<span id="cb385-3964"><a href="#cb385-3964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3965"><a href="#cb385-3965" aria-hidden="true" tabindex="-1"></a><span class="in">kable(head(Temperatures)) %&gt;%</span></span>
<span id="cb385-3966"><a href="#cb385-3966" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-3967"><a href="#cb385-3967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3968"><a href="#cb385-3968" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-3969"><a href="#cb385-3969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3970"><a href="#cb385-3970" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3971"><a href="#cb385-3971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3972"><a href="#cb385-3972" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To save objects that are more complex than simple <span class="in">`data.frames`</span> (a list of multiple <span class="in">`data.frames`</span>), <span class="in">`chillR`</span> includes functions for writing and reading lists that consist of numbers, character strings and/or data.frames. </span>
<span id="cb385-3973"><a href="#cb385-3973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3974"><a href="#cb385-3974" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 13.1b}</span></span>
<span id="cb385-3975"><a href="#cb385-3975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3976"><a href="#cb385-3976" aria-hidden="true" tabindex="-1"></a><span class="in"># Create test_list with three elements- double, character, list</span></span>
<span id="cb385-3977"><a href="#cb385-3977" aria-hidden="true" tabindex="-1"></a><span class="in">test_list &lt;- list(Number = 1,</span></span>
<span id="cb385-3978"><a href="#cb385-3978" aria-hidden="true" tabindex="-1"></a><span class="in">                  String = "Thanks for using chillR!",</span></span>
<span id="cb385-3979"><a href="#cb385-3979" aria-hidden="true" tabindex="-1"></a><span class="in">                  DataFrame = data.frame(a = c(1,2,3),</span></span>
<span id="cb385-3980"><a href="#cb385-3980" aria-hidden="true" tabindex="-1"></a><span class="in">                                         b = c(3,2,1),</span></span>
<span id="cb385-3981"><a href="#cb385-3981" aria-hidden="true" tabindex="-1"></a><span class="in">                                         c = c(5,4,3)))</span></span>
<span id="cb385-3982"><a href="#cb385-3982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3983"><a href="#cb385-3983" aria-hidden="true" tabindex="-1"></a><span class="in"># Save the test_list in local file using `save_temperature_scenarios` function</span></span>
<span id="cb385-3984"><a href="#cb385-3984" aria-hidden="true" tabindex="-1"></a><span class="in"># It saves dataset as three separate csv files</span></span>
<span id="cb385-3985"><a href="#cb385-3985" aria-hidden="true" tabindex="-1"></a><span class="in">save_temperature_scenarios(test_list,</span></span>
<span id="cb385-3986"><a href="#cb385-3986" aria-hidden="true" tabindex="-1"></a><span class="in">                           path = "data/OT",</span></span>
<span id="cb385-3987"><a href="#cb385-3987" aria-hidden="true" tabindex="-1"></a><span class="in">                           prefix = "test_list")</span></span>
<span id="cb385-3988"><a href="#cb385-3988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3989"><a href="#cb385-3989" aria-hidden="true" tabindex="-1"></a><span class="in"># Retreive information from three saved files using another chillR function</span></span>
<span id="cb385-3990"><a href="#cb385-3990" aria-hidden="true" tabindex="-1"></a><span class="in">test_list &lt;- load_temperature_scenarios(path = "data/OT",</span></span>
<span id="cb385-3991"><a href="#cb385-3991" aria-hidden="true" tabindex="-1"></a><span class="in">                                        prefix = "test_list")</span></span>
<span id="cb385-3992"><a href="#cb385-3992" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-3993"><a href="#cb385-3993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3994"><a href="#cb385-3994" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-3995"><a href="#cb385-3995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3996"><a href="#cb385-3996" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;13.2&lt;/span&gt;&amp;nbsp; Hiding all this from the readers of our markdown file</span></span>
<span id="cb385-3997"><a href="#cb385-3997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-3998"><a href="#cb385-3998" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-3999"><a href="#cb385-3999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4000"><a href="#cb385-4000" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Normal code chunks start with  "`{r}". Options can be added after the r, separated by a comma.</span>
<span id="cb385-4001"><a href="#cb385-4001" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>option “echo=FALSE” means that the code block will be run but the code and output are not produced in the final document. We’ll still see ‘side effects’, such as figures that are produced.</span>
<span id="cb385-4002"><a href="#cb385-4002" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>option “eval=FALSE” means that the code will be shown in the final document, but it will not be run.</span>
<span id="cb385-4003"><a href="#cb385-4003" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>More options for code chunk are <span class="co">[</span><span class="ot">here.</span><span class="co">](https://rmarkdown.rstudio.com/lesson-3.html)</span></span>
<span id="cb385-4004"><a href="#cb385-4004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4005"><a href="#cb385-4005" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4006"><a href="#cb385-4006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4007"><a href="#cb385-4007" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 14: Historic temperature scenarios</span></span>
<span id="cb385-4008"><a href="#cb385-4008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4009"><a href="#cb385-4009" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;14.1&lt;/span&gt;&amp;nbsp; Climate change scenarios</span></span>
<span id="cb385-4010"><a href="#cb385-4010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4011"><a href="#cb385-4011" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-4012"><a href="#cb385-4012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4013"><a href="#cb385-4013" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We recently learned how to use a weather generator accessed by <span class="in">`chillR`</span> to produce agroclimatic profiles for a given location. We calibrated the weather generator with historically observed temperature data, and the profile we produced was representative of climatic conditions during the period used for calibration.</span>
<span id="cb385-4014"><a href="#cb385-4014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4015"><a href="#cb385-4015" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The weather generator can also produce scenarios that represent different climatic conditions. Specifically, the <span class="in">`temperature_generation`</span> function contains a parameter called <span class="in">`temperature_scenario`</span>, which we can use to send the necessary instructions to the weather generator.</span>
<span id="cb385-4016"><a href="#cb385-4016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4017"><a href="#cb385-4017" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The temperature_scenario parameter requires a <span class="in">`data.frame`</span> with columns <span class="in">`Tmin`</span> and <span class="in">`Tmax`</span>. Each of these columns should have 12 values that specify changes to the mean minimum and maximum temperatures, respectively, for each month of the year. If we don’t specify this parameter, the function uses the default object<span class="dv">&amp;mdash;</span> a <span class="in">`data.frame`</span> with zeros for all changes.</span>
<span id="cb385-4018"><a href="#cb385-4018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4019"><a href="#cb385-4019" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Our first climate change scenario will be simple. We’ll just add arbitrary numbers to all the monthly *T~min~* and *T~max~* values.</span>
<span id="cb385-4020"><a href="#cb385-4020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4021"><a href="#cb385-4021" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 14.1a}</span></span>
<span id="cb385-4022"><a href="#cb385-4022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4023"><a href="#cb385-4023" aria-hidden="true" tabindex="-1"></a><span class="in"># Here's the call from the earlier lesson. We don't have to run this again.</span></span>
<span id="cb385-4024"><a href="#cb385-4024" aria-hidden="true" tabindex="-1"></a><span class="in">Temp &lt;- temperature_generation(KA_weather,</span></span>
<span id="cb385-4025"><a href="#cb385-4025" aria-hidden="true" tabindex="-1"></a><span class="in">                               years = c(1998,2005),</span></span>
<span id="cb385-4026"><a href="#cb385-4026" aria-hidden="true" tabindex="-1"></a><span class="in">                               sim_years = c(2001,2100))</span></span>
<span id="cb385-4027"><a href="#cb385-4027" aria-hidden="true" tabindex="-1"></a><span class="in"> </span></span>
<span id="cb385-4028"><a href="#cb385-4028" aria-hidden="true" tabindex="-1"></a><span class="in"># Now we make a temperature scenario that raises all temperatures by 2°C</span></span>
<span id="cb385-4029"><a href="#cb385-4029" aria-hidden="true" tabindex="-1"></a><span class="in">change_scenario &lt;- data.frame(Tmin = rep(2,12), # for 12 months</span></span>
<span id="cb385-4030"><a href="#cb385-4030" aria-hidden="true" tabindex="-1"></a><span class="in">                              Tmax = rep(2,12))</span></span>
<span id="cb385-4031"><a href="#cb385-4031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4032"><a href="#cb385-4032" aria-hidden="true" tabindex="-1"></a><span class="in">kable(change_scenario) %&gt;%</span></span>
<span id="cb385-4033"><a href="#cb385-4033" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-4034"><a href="#cb385-4034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4035"><a href="#cb385-4035" aria-hidden="true" tabindex="-1"></a><span class="in"># Input change_scenario to simulated temperature generations</span></span>
<span id="cb385-4036"><a href="#cb385-4036" aria-hidden="true" tabindex="-1"></a><span class="in">Temp_2 &lt;- temperature_generation(KA_weather,</span></span>
<span id="cb385-4037"><a href="#cb385-4037" aria-hidden="true" tabindex="-1"></a><span class="in">                                 years = c(1998,2005),</span></span>
<span id="cb385-4038"><a href="#cb385-4038" aria-hidden="true" tabindex="-1"></a><span class="in">                                 sim_years = c(2001,2100),</span></span>
<span id="cb385-4039"><a href="#cb385-4039" aria-hidden="true" tabindex="-1"></a><span class="in">                                 temperature_scenario = change_scenario)</span></span>
<span id="cb385-4040"><a href="#cb385-4040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4041"><a href="#cb385-4041" aria-hidden="true" tabindex="-1"></a><span class="in"># As before, we'll make a data.frame that contains all</span></span>
<span id="cb385-4042"><a href="#cb385-4042" aria-hidden="true" tabindex="-1"></a><span class="in"># our data, so we can take a look at it.</span></span>
<span id="cb385-4043"><a href="#cb385-4043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4044"><a href="#cb385-4044" aria-hidden="true" tabindex="-1"></a><span class="in">Temperature_scenarios &lt;- KA_weather %&gt;%</span></span>
<span id="cb385-4045"><a href="#cb385-4045" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Year %in% 1998:2005) %&gt;%</span></span>
<span id="cb385-4046"><a href="#cb385-4046" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind(Data_source = "observed") %&gt;%</span></span>
<span id="cb385-4047"><a href="#cb385-4047" aria-hidden="true" tabindex="-1"></a><span class="in">  rbind(Temp[[1]] %&gt;% </span></span>
<span id="cb385-4048"><a href="#cb385-4048" aria-hidden="true" tabindex="-1"></a><span class="in">          select(c(Year, Month, Day, Tmin, Tmax)) %&gt;% </span></span>
<span id="cb385-4049"><a href="#cb385-4049" aria-hidden="true" tabindex="-1"></a><span class="in">          cbind(Data_source = "simulated")</span></span>
<span id="cb385-4050"><a href="#cb385-4050" aria-hidden="true" tabindex="-1"></a><span class="in">        ) %&gt;%</span></span>
<span id="cb385-4051"><a href="#cb385-4051" aria-hidden="true" tabindex="-1"></a><span class="in">  rbind(Temp_2[[1]] %&gt;%</span></span>
<span id="cb385-4052"><a href="#cb385-4052" aria-hidden="true" tabindex="-1"></a><span class="in">          select(c(Year, Month, Day, Tmin, Tmax)) %&gt;% </span></span>
<span id="cb385-4053"><a href="#cb385-4053" aria-hidden="true" tabindex="-1"></a><span class="in">          cbind(Data_source = "Warming_2C")</span></span>
<span id="cb385-4054"><a href="#cb385-4054" aria-hidden="true" tabindex="-1"></a><span class="in">        ) %&gt;%</span></span>
<span id="cb385-4055"><a href="#cb385-4055" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Date = as.Date(ISOdate(2000,</span></span>
<span id="cb385-4056"><a href="#cb385-4056" aria-hidden="true" tabindex="-1"></a><span class="in">                                Month,</span></span>
<span id="cb385-4057"><a href="#cb385-4057" aria-hidden="true" tabindex="-1"></a><span class="in">                                Day)))</span></span>
<span id="cb385-4058"><a href="#cb385-4058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4059"><a href="#cb385-4059" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-4060"><a href="#cb385-4060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4061"><a href="#cb385-4061" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4062"><a href="#cb385-4062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4063"><a href="#cb385-4063" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Plot for <span class="in">`Tmin`</span> after applying <span class="in">`change_scenario`</span> (increase temp by 2°C):</span>
<span id="cb385-4064"><a href="#cb385-4064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4065"><a href="#cb385-4065" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 14.1b}</span></span>
<span id="cb385-4066"><a href="#cb385-4066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4067"><a href="#cb385-4067" aria-hidden="true" tabindex="-1"></a><span class="in"># Since the structure of this dataset is the same as we had in the earlier </span></span>
<span id="cb385-4068"><a href="#cb385-4068" aria-hidden="true" tabindex="-1"></a><span class="in"># lesson, we can use identical code to illustrate it </span></span>
<span id="cb385-4069"><a href="#cb385-4069" aria-hidden="true" tabindex="-1"></a><span class="in"># - just have to replace the data.frame name.</span></span>
<span id="cb385-4070"><a href="#cb385-4070" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = Temperature_scenarios, </span></span>
<span id="cb385-4071"><a href="#cb385-4071" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(Date,Tmin)) +</span></span>
<span id="cb385-4072"><a href="#cb385-4072" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(aes(colour = factor(Year))) +</span></span>
<span id="cb385-4073"><a href="#cb385-4073" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(Data_source)) +</span></span>
<span id="cb385-4074"><a href="#cb385-4074" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 20) +</span></span>
<span id="cb385-4075"><a href="#cb385-4075" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "none") +</span></span>
<span id="cb385-4076"><a href="#cb385-4076" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_date(date_labels = "%b")</span></span>
<span id="cb385-4077"><a href="#cb385-4077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4078"><a href="#cb385-4078" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-4079"><a href="#cb385-4079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4080"><a href="#cb385-4080" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4081"><a href="#cb385-4081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4082"><a href="#cb385-4082" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Plot for <span class="in">`Tmax`</span> after applying <span class="in">`change_scenario`</span> (increase temp by 2°C):</span>
<span id="cb385-4083"><a href="#cb385-4083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4084"><a href="#cb385-4084" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 14.1c}</span></span>
<span id="cb385-4085"><a href="#cb385-4085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4086"><a href="#cb385-4086" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = Temperature_scenarios,</span></span>
<span id="cb385-4087"><a href="#cb385-4087" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(Date,Tmax)) +</span></span>
<span id="cb385-4088"><a href="#cb385-4088" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(aes(colour = factor(Year))) +</span></span>
<span id="cb385-4089"><a href="#cb385-4089" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(Data_source)) +</span></span>
<span id="cb385-4090"><a href="#cb385-4090" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 20) +</span></span>
<span id="cb385-4091"><a href="#cb385-4091" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "none") +</span></span>
<span id="cb385-4092"><a href="#cb385-4092" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_date(date_labels = "%b")</span></span>
<span id="cb385-4093"><a href="#cb385-4093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4094"><a href="#cb385-4094" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-4095"><a href="#cb385-4095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4096"><a href="#cb385-4096" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4097"><a href="#cb385-4097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4098"><a href="#cb385-4098" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This was an arbitrary climate scenario. Nobody expects future changes to be so uniformly distributed across all months, and this certainly hasn’t happened in the past.</span>
<span id="cb385-4099"><a href="#cb385-4099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4100"><a href="#cb385-4100" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This is, however, pretty similar to (<span class="co">[</span><span class="ot">Luedeling et al., 2009b</span><span class="co">](https://link.springer.com/article/10.1007/s10584-009-9581-7)</span>)'s first attempt at climate change scenario modeling. </span>
<span id="cb385-4101"><a href="#cb385-4101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4102"><a href="#cb385-4102" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Let’s try to make scenarios that are a bit more realistic. For this, we start with scenarios that represent particular years from the historic record. As we discussed already, we could of course simply look at temperatures recorded during a particular year. We may, however, also be interested in what temperature conditions should have been considered normal at the time, rather than what actually happened. </span>
<span id="cb385-4103"><a href="#cb385-4103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4104"><a href="#cb385-4104" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Such a perspective can make it much easier to identify historic trends, because we can now try to evaluate the gradual shift in climate (the collection of plausible weather) rather than just looking at the random weathers we’ve been dealt in the past, where trends are often obscured by interannual variation and possibly by some freaky outliers that distort our trend analysis.</span>
<span id="cb385-4105"><a href="#cb385-4105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4106"><a href="#cb385-4106" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4107"><a href="#cb385-4107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4108"><a href="#cb385-4108" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;14.2&lt;/span&gt;&amp;nbsp; Making historic temperature scenarios</span></span>
<span id="cb385-4109"><a href="#cb385-4109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4110"><a href="#cb385-4110" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-4111"><a href="#cb385-4111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4112"><a href="#cb385-4112" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To make this a meaningful exercise, we’ll need a long-term dataset. </span>
<span id="cb385-4113"><a href="#cb385-4113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4114"><a href="#cb385-4114" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 14.2a}</span></span>
<span id="cb385-4115"><a href="#cb385-4115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4116"><a href="#cb385-4116" aria-hidden="true" tabindex="-1"></a><span class="in">## Download and patch weather for Bonn</span></span>
<span id="cb385-4117"><a href="#cb385-4117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4118"><a href="#cb385-4118" aria-hidden="true" tabindex="-1"></a><span class="in"># download weather station list for the vicinity of Bonn</span></span>
<span id="cb385-4119"><a href="#cb385-4119" aria-hidden="true" tabindex="-1"></a><span class="in">station_list &lt;- handle_gsod(action = "list_stations",</span></span>
<span id="cb385-4120"><a href="#cb385-4120" aria-hidden="true" tabindex="-1"></a><span class="in">                            location=c(7.1,50.8))</span></span>
<span id="cb385-4121"><a href="#cb385-4121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4122"><a href="#cb385-4122" aria-hidden="true" tabindex="-1"></a><span class="in"># download weather data for Cologne/Bonn airport and convert it to chillR format</span></span>
<span id="cb385-4123"><a href="#cb385-4123" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_weather &lt;- handle_gsod(action = "download_weather",</span></span>
<span id="cb385-4124"><a href="#cb385-4124" aria-hidden="true" tabindex="-1"></a><span class="in">                            location = station_list$chillR_code[1],</span></span>
<span id="cb385-4125"><a href="#cb385-4125" aria-hidden="true" tabindex="-1"></a><span class="in">                            # more years than in previous exercies</span></span>
<span id="cb385-4126"><a href="#cb385-4126" aria-hidden="true" tabindex="-1"></a><span class="in">                            time_interval = c(1973,2019)) %&gt;% </span></span>
<span id="cb385-4127"><a href="#cb385-4127" aria-hidden="true" tabindex="-1"></a><span class="in">  handle_gsod()</span></span>
<span id="cb385-4128"><a href="#cb385-4128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4129"><a href="#cb385-4129" aria-hidden="true" tabindex="-1"></a><span class="in"># check record for missing data</span></span>
<span id="cb385-4130"><a href="#cb385-4130" aria-hidden="true" tabindex="-1"></a><span class="in">kable(fix_weather(Bonn_weather$`KOLN BONN`)$QC,</span></span>
<span id="cb385-4131"><a href="#cb385-4131" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Check for missing data") %&gt;%</span></span>
<span id="cb385-4132"><a href="#cb385-4132" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-4133"><a href="#cb385-4133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4134"><a href="#cb385-4134" aria-hidden="true" tabindex="-1"></a><span class="in"># (incidentally almost all gaps are for years covered by the KA_weather dataset)</span></span>
<span id="cb385-4135"><a href="#cb385-4135" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_patched &lt;- patch_daily_temperatures(</span></span>
<span id="cb385-4136"><a href="#cb385-4136" aria-hidden="true" tabindex="-1"></a><span class="in">  weather = Bonn_weather$`KOLN BONN`,</span></span>
<span id="cb385-4137"><a href="#cb385-4137" aria-hidden="true" tabindex="-1"></a><span class="in">  patch_weather = list(KA_weather))</span></span>
<span id="cb385-4138"><a href="#cb385-4138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4139"><a href="#cb385-4139" aria-hidden="true" tabindex="-1"></a><span class="in">kable(fix_weather(Bonn_patched)$QC,</span></span>
<span id="cb385-4140"><a href="#cb385-4140" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Check for missing data after patching") %&gt;%</span></span>
<span id="cb385-4141"><a href="#cb385-4141" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-4142"><a href="#cb385-4142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4143"><a href="#cb385-4143" aria-hidden="true" tabindex="-1"></a><span class="in"># There are still 4 days missing here, out of 47 years -</span></span>
<span id="cb385-4144"><a href="#cb385-4144" aria-hidden="true" tabindex="-1"></a><span class="in"># let's simply interpolate these gaps now</span></span>
<span id="cb385-4145"><a href="#cb385-4145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4146"><a href="#cb385-4146" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn&lt;-fix_weather(Bonn_patched)</span></span>
<span id="cb385-4147"><a href="#cb385-4147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4148"><a href="#cb385-4148" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_temps&lt;-Bonn$weather</span></span>
<span id="cb385-4149"><a href="#cb385-4149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4150"><a href="#cb385-4150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4151"><a href="#cb385-4151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-4152"><a href="#cb385-4152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4153"><a href="#cb385-4153" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4154"><a href="#cb385-4154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4155"><a href="#cb385-4155" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We could now easily run the weather generator to produce weather scenarios that correspond to the normal climate between 1973 and 2019.</span>
<span id="cb385-4156"><a href="#cb385-4156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4157"><a href="#cb385-4157" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Since temperatures have been gradually rising over this period, the best guess for the year that would best represent this scenario would be the median of the time period, which is 1996. </span>
<span id="cb385-4158"><a href="#cb385-4158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4159"><a href="#cb385-4159" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>But let’s say we’re not interested in 1996, but in scenarios representing 1980, 1990, 2000 and 2010. How can we make such scenarios?</span>
<span id="cb385-4160"><a href="#cb385-4160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4161"><a href="#cb385-4161" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The way to address this challenge is to examine the historic temperature record to determine the changes that happened between the year we’re interested in and the year our temperature data represent.</span>
<span id="cb385-4162"><a href="#cb385-4162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4163"><a href="#cb385-4163" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Let’s call this representative year the **baseline** of our observed temperature data, and the years we want to make simulations for the **simulation** years.</span>
<span id="cb385-4164"><a href="#cb385-4164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4165"><a href="#cb385-4165" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`chillR`</span> has a function that helps us make temperature scenarios from temperature records, which is called <span class="in">`temperature_scenario_from_records`</span>.</span>
<span id="cb385-4166"><a href="#cb385-4166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4167"><a href="#cb385-4167" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 14.2b}</span></span>
<span id="cb385-4168"><a href="#cb385-4168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4169"><a href="#cb385-4169" aria-hidden="true" tabindex="-1"></a><span class="in">scenario_1980 &lt;- temperature_scenario_from_records(weather = Bonn_temps,</span></span>
<span id="cb385-4170"><a href="#cb385-4170" aria-hidden="true" tabindex="-1"></a><span class="in">                                                   year = 1980)</span></span>
<span id="cb385-4171"><a href="#cb385-4171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4172"><a href="#cb385-4172" aria-hidden="true" tabindex="-1"></a><span class="in">kable(do.call(rbind, scenario_1980$`1980`)) %&gt;%</span></span>
<span id="cb385-4173"><a href="#cb385-4173" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-4174"><a href="#cb385-4174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4175"><a href="#cb385-4175" aria-hidden="true" tabindex="-1"></a><span class="in"># data: a data.frame specifying Tmin and Tmax values that are representative of </span></span>
<span id="cb385-4176"><a href="#cb385-4176" aria-hidden="true" tabindex="-1"></a><span class="in"># the year of interest</span></span>
<span id="cb385-4177"><a href="#cb385-4177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4178"><a href="#cb385-4178" aria-hidden="true" tabindex="-1"></a><span class="in"># scenario_year: the year we’re interested in</span></span>
<span id="cb385-4179"><a href="#cb385-4179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4180"><a href="#cb385-4180" aria-hidden="true" tabindex="-1"></a><span class="in"># reference_year: for scenarios that describe temperature changes </span></span>
<span id="cb385-4181"><a href="#cb385-4181" aria-hidden="true" tabindex="-1"></a><span class="in"># (which is not the case here), this would specify relative to what year </span></span>
<span id="cb385-4182"><a href="#cb385-4182" aria-hidden="true" tabindex="-1"></a><span class="in"># these changes are expressed (NA in this case)</span></span>
<span id="cb385-4183"><a href="#cb385-4183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4184"><a href="#cb385-4184" aria-hidden="true" tabindex="-1"></a><span class="in"># scenario_type: specifies whether this scenario contains absolute temperatures </span></span>
<span id="cb385-4185"><a href="#cb385-4185" aria-hidden="true" tabindex="-1"></a><span class="in"># for the year of interest (true in this case), or whether it expressed changes </span></span>
<span id="cb385-4186"><a href="#cb385-4186" aria-hidden="true" tabindex="-1"></a><span class="in"># relative to another year</span></span>
<span id="cb385-4187"><a href="#cb385-4187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4188"><a href="#cb385-4188" aria-hidden="true" tabindex="-1"></a><span class="in"># labels: contains additional information we can attach to scenarios. </span></span>
<span id="cb385-4189"><a href="#cb385-4189" aria-hidden="true" tabindex="-1"></a><span class="in"># In this case, this says “running mean scenario”. </span></span>
<span id="cb385-4190"><a href="#cb385-4190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4191"><a href="#cb385-4191" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-4192"><a href="#cb385-4192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4193"><a href="#cb385-4193" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4194"><a href="#cb385-4194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4195"><a href="#cb385-4195" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This explains the warning messages we previously received when we first started running our weather generator:</span>
<span id="cb385-4196"><a href="#cb385-4196" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>*scenario doesn’t contain named elements&amp;mdash; consider using the following element names: ‘data’, ‘reference_year’,‘scenario_type’,‘labels’*</span>
<span id="cb385-4197"><a href="#cb385-4197" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>*setting `scenario_type` to ‘relative’*</span>
<span id="cb385-4198"><a href="#cb385-4198" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>*Reference year missing&amp;mdash; can’t check if relative temperature scenario is valid*</span>
<span id="cb385-4199"><a href="#cb385-4199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4200"><a href="#cb385-4200" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-4201"><a href="#cb385-4201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4202"><a href="#cb385-4202" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Our input for the scenario at that time was simply a <span class="in">`data.frame`</span>, but we’ve just seen that scenarios can contain more information.The <span class="in">`temperature_generation`</span> recognized this and decided to warn us. This is because all this information has a purpose, and if it’s not provided, <span class="in">`temperature_generation`</span> has to make some assumptions on what it’s supposed to do with the information. </span>
<span id="cb385-4203"><a href="#cb385-4203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4204"><a href="#cb385-4204" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The second element of the warning indicates that the <span class="in">`scenario_type`</span> was automatically set to ‘relative’. The function contains some decision rules for deciding whether a temperature scenario specifies absolute or relative temperatures, and here we are informed about what the outcome of that decision was.</span>
<span id="cb385-4205"><a href="#cb385-4205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4206"><a href="#cb385-4206" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Finally, we are informed that the reference year is missing. This means that we’ve specified a relative temperature scenario, but we didn’t specify relative to what. In our case, this was simply the year that the historic record represented (e.g. the median year of the observed record), but this isn’t always clear, as we’ll see when we start talking about future projections.</span>
<span id="cb385-4207"><a href="#cb385-4207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4208"><a href="#cb385-4208" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Well, in the scenario we just built here, we shouldn’t get such warning messages, because now we have a comprehensive list that contains all the information the <span class="in">`temperature_generation`</span> function needs. </span>
<span id="cb385-4209"><a href="#cb385-4209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4210"><a href="#cb385-4210" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 14.2c, warning=TRUE}</span></span>
<span id="cb385-4211"><a href="#cb385-4211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4212"><a href="#cb385-4212" aria-hidden="true" tabindex="-1"></a><span class="in">temps_1980 &lt;- temperature_generation(weather = Bonn_temps,</span></span>
<span id="cb385-4213"><a href="#cb385-4213" aria-hidden="true" tabindex="-1"></a><span class="in">                                     years = c(1973,2019),</span></span>
<span id="cb385-4214"><a href="#cb385-4214" aria-hidden="true" tabindex="-1"></a><span class="in">                                     sim_years = c(2001,2100),</span></span>
<span id="cb385-4215"><a href="#cb385-4215" aria-hidden="true" tabindex="-1"></a><span class="in">                                     temperature_scenario = scenario_1980)</span></span>
<span id="cb385-4216"><a href="#cb385-4216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4217"><a href="#cb385-4217" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-4218"><a href="#cb385-4218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4219"><a href="#cb385-4219" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We still got a warning message, which means that the weather generator evaluated the calibration dataset with respect to variation of temperatures around the mean temperatures. It then generated a dataset with means (for *T~min~* and *T~max~* of each month) that correspond to the (absolute) temperature scenario we provided, and variation similar to that in the observed record. This is what we wanted, so we’re good.</span>
<span id="cb385-4220"><a href="#cb385-4220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4221"><a href="#cb385-4221" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If we want to convert this absolute temperature scenario into a relative scenario, we have to specify a baseline scenario to compare it with. In our case, 1996 is a good choice, because that is the median year of our observed record. So let’s make a scenario for that year:</span>
<span id="cb385-4222"><a href="#cb385-4222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4223"><a href="#cb385-4223" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 14.2d}</span></span>
<span id="cb385-4224"><a href="#cb385-4224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4225"><a href="#cb385-4225" aria-hidden="true" tabindex="-1"></a><span class="in"># Absolute temperature scenario, where the baseline (reference_year) is NA</span></span>
<span id="cb385-4226"><a href="#cb385-4226" aria-hidden="true" tabindex="-1"></a><span class="in">scenario_1996 &lt;- temperature_scenario_from_records(weather = Bonn_temps,</span></span>
<span id="cb385-4227"><a href="#cb385-4227" aria-hidden="true" tabindex="-1"></a><span class="in">                                                   year = 1996)</span></span>
<span id="cb385-4228"><a href="#cb385-4228" aria-hidden="true" tabindex="-1"></a><span class="in">kable(do.call(rbind, scenario_1996$`1996`),</span></span>
<span id="cb385-4229"><a href="#cb385-4229" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Absolute temperature scenario") %&gt;%</span></span>
<span id="cb385-4230"><a href="#cb385-4230" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-4231"><a href="#cb385-4231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4232"><a href="#cb385-4232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-4233"><a href="#cb385-4233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4234"><a href="#cb385-4234" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4235"><a href="#cb385-4235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4236"><a href="#cb385-4236" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We can produce a relative change scenario by applying the <span class="in">`temperature_scenario_baseline_adjustment`</span> function:</span>
<span id="cb385-4237"><a href="#cb385-4237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4238"><a href="#cb385-4238" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 14.2e}</span></span>
<span id="cb385-4239"><a href="#cb385-4239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4240"><a href="#cb385-4240" aria-hidden="true" tabindex="-1"></a><span class="in">relative_scenario &lt;- temperature_scenario_baseline_adjustment(</span></span>
<span id="cb385-4241"><a href="#cb385-4241" aria-hidden="true" tabindex="-1"></a><span class="in">  baseline = scenario_1996,</span></span>
<span id="cb385-4242"><a href="#cb385-4242" aria-hidden="true" tabindex="-1"></a><span class="in">  temperature_scenario = scenario_1980)</span></span>
<span id="cb385-4243"><a href="#cb385-4243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4244"><a href="#cb385-4244" aria-hidden="true" tabindex="-1"></a><span class="in">kable(do.call(rbind, relative_scenario$`1980`),</span></span>
<span id="cb385-4245"><a href="#cb385-4245" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Relative change scenario") %&gt;%</span></span>
<span id="cb385-4246"><a href="#cb385-4246" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-4247"><a href="#cb385-4247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4248"><a href="#cb385-4248" aria-hidden="true" tabindex="-1"></a><span class="in">## Now we have a relative change scenario - a list with the following elements:</span></span>
<span id="cb385-4249"><a href="#cb385-4249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4250"><a href="#cb385-4250" aria-hidden="true" tabindex="-1"></a><span class="in"># data: a data.frame with Tmin and Tmax columns, but now containing</span></span>
<span id="cb385-4251"><a href="#cb385-4251" aria-hidden="true" tabindex="-1"></a><span class="in"># relative changes between 1996 and 1980 (all negative values, </span></span>
<span id="cb385-4252"><a href="#cb385-4252" aria-hidden="true" tabindex="-1"></a><span class="in"># because 1980 was cooler than 1996)</span></span>
<span id="cb385-4253"><a href="#cb385-4253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4254"><a href="#cb385-4254" aria-hidden="true" tabindex="-1"></a><span class="in"># scenario_year: still 1980</span></span>
<span id="cb385-4255"><a href="#cb385-4255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4256"><a href="#cb385-4256" aria-hidden="true" tabindex="-1"></a><span class="in"># reference_year: now 1996</span></span>
<span id="cb385-4257"><a href="#cb385-4257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4258"><a href="#cb385-4258" aria-hidden="true" tabindex="-1"></a><span class="in"># scenario_type: now ‘relative’</span></span>
<span id="cb385-4259"><a href="#cb385-4259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4260"><a href="#cb385-4260" aria-hidden="true" tabindex="-1"></a><span class="in"># labels: still ‘running mean scenario’</span></span>
<span id="cb385-4261"><a href="#cb385-4261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4262"><a href="#cb385-4262" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-4263"><a href="#cb385-4263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4264"><a href="#cb385-4264" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We can now try to apply this scenario in a similar way to what we did earlier, without generating error message because we provided the <span class="in">`temperature_generation`</span> function with everything it needed to know:</span>
<span id="cb385-4265"><a href="#cb385-4265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4266"><a href="#cb385-4266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4267"><a href="#cb385-4267" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 14.2f, warning=TRUE}</span></span>
<span id="cb385-4268"><a href="#cb385-4268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4269"><a href="#cb385-4269" aria-hidden="true" tabindex="-1"></a><span class="in">temps_1980&lt;-temperature_generation(weather = Bonn_temps,</span></span>
<span id="cb385-4270"><a href="#cb385-4270" aria-hidden="true" tabindex="-1"></a><span class="in">                                   years = c(1973,2019),</span></span>
<span id="cb385-4271"><a href="#cb385-4271" aria-hidden="true" tabindex="-1"></a><span class="in">                                   sim_years = c(2001,2100),</span></span>
<span id="cb385-4272"><a href="#cb385-4272" aria-hidden="true" tabindex="-1"></a><span class="in">                                   temperature_scenario = relative_scenario)</span></span>
<span id="cb385-4273"><a href="#cb385-4273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4274"><a href="#cb385-4274" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-4275"><a href="#cb385-4275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4276"><a href="#cb385-4276" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4277"><a href="#cb385-4277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4278"><a href="#cb385-4278" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>So let’s now make all the scenarios we had in mind. This is facilitated by most of the functions also accepting vectors and lists, rather than just single numbers and <span class="in">`data.frames`</span>.</span>
<span id="cb385-4279"><a href="#cb385-4279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4280"><a href="#cb385-4280" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 14.2g}</span></span>
<span id="cb385-4281"><a href="#cb385-4281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4282"><a href="#cb385-4282" aria-hidden="true" tabindex="-1"></a><span class="in"># Create scenarios from records of interested years</span></span>
<span id="cb385-4283"><a href="#cb385-4283" aria-hidden="true" tabindex="-1"></a><span class="in">all_past_scenarios &lt;- temperature_scenario_from_records(</span></span>
<span id="cb385-4284"><a href="#cb385-4284" aria-hidden="true" tabindex="-1"></a><span class="in">  weather = Bonn_temps,</span></span>
<span id="cb385-4285"><a href="#cb385-4285" aria-hidden="true" tabindex="-1"></a><span class="in">  year = c(1980,</span></span>
<span id="cb385-4286"><a href="#cb385-4286" aria-hidden="true" tabindex="-1"></a><span class="in">           1990,</span></span>
<span id="cb385-4287"><a href="#cb385-4287" aria-hidden="true" tabindex="-1"></a><span class="in">           2000,</span></span>
<span id="cb385-4288"><a href="#cb385-4288" aria-hidden="true" tabindex="-1"></a><span class="in">           2010))</span></span>
<span id="cb385-4289"><a href="#cb385-4289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4290"><a href="#cb385-4290" aria-hidden="true" tabindex="-1"></a><span class="in"># Make temperature scenario relative to a particular baseline </span></span>
<span id="cb385-4291"><a href="#cb385-4291" aria-hidden="true" tabindex="-1"></a><span class="in">adjusted_scenarios &lt;- temperature_scenario_baseline_adjustment(</span></span>
<span id="cb385-4292"><a href="#cb385-4292" aria-hidden="true" tabindex="-1"></a><span class="in">  baseline = scenario_1996,</span></span>
<span id="cb385-4293"><a href="#cb385-4293" aria-hidden="true" tabindex="-1"></a><span class="in">  temperature_scenario = all_past_scenarios)</span></span>
<span id="cb385-4294"><a href="#cb385-4294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4295"><a href="#cb385-4295" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate temperatures for simulation years, relative to adjusted_scenarios</span></span>
<span id="cb385-4296"><a href="#cb385-4296" aria-hidden="true" tabindex="-1"></a><span class="in">all_past_scenario_temps &lt;- temperature_generation(</span></span>
<span id="cb385-4297"><a href="#cb385-4297" aria-hidden="true" tabindex="-1"></a><span class="in">  weather = Bonn_temps,</span></span>
<span id="cb385-4298"><a href="#cb385-4298" aria-hidden="true" tabindex="-1"></a><span class="in">  years = c(1973,2019),</span></span>
<span id="cb385-4299"><a href="#cb385-4299" aria-hidden="true" tabindex="-1"></a><span class="in">  sim_years = c(2001,2100),</span></span>
<span id="cb385-4300"><a href="#cb385-4300" aria-hidden="true" tabindex="-1"></a><span class="in">  temperature_scenario = adjusted_scenarios)</span></span>
<span id="cb385-4301"><a href="#cb385-4301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4302"><a href="#cb385-4302" aria-hidden="true" tabindex="-1"></a><span class="in"># Save as four different files of 100 year simulations</span></span>
<span id="cb385-4303"><a href="#cb385-4303" aria-hidden="true" tabindex="-1"></a><span class="in">save_temperature_scenarios(all_past_scenario_temps,</span></span>
<span id="cb385-4304"><a href="#cb385-4304" aria-hidden="true" tabindex="-1"></a><span class="in">                           "data/bonn", "Bonn_hist_scenarios")</span></span>
<span id="cb385-4305"><a href="#cb385-4305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4306"><a href="#cb385-4306" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-4307"><a href="#cb385-4307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4308"><a href="#cb385-4308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4309"><a href="#cb385-4309" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The <span class="in">`all_past_scenario_temps object`</span> is a list that now contains 100 years of synthetic weather for all the past scenarios we had in mind.</span>
<span id="cb385-4310"><a href="#cb385-4310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4311"><a href="#cb385-4311" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now, to calculate chill accumulation again, we could go back and find all the functions we used before and apply them to each of the four temperature scenarios we just generated, OR use a <span class="in">`chillR`</span> function, <span class="in">`tempResponse_daily_list`</span> that has already automated all this. </span>
<span id="cb385-4312"><a href="#cb385-4312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4313"><a href="#cb385-4313" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To demonstrate, make a simple frost model and select only the Dynamic Model and GDH Model for the evaluation:</span>
<span id="cb385-4314"><a href="#cb385-4314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4315"><a href="#cb385-4315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4316"><a href="#cb385-4316" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 14.2h}</span></span>
<span id="cb385-4317"><a href="#cb385-4317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4318"><a href="#cb385-4318" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate heat for temperate trees according to a stepwise model provided</span></span>
<span id="cb385-4319"><a href="#cb385-4319" aria-hidden="true" tabindex="-1"></a><span class="in">frost_model &lt;- function(x)</span></span>
<span id="cb385-4320"><a href="#cb385-4320" aria-hidden="true" tabindex="-1"></a><span class="in">  step_model(x,</span></span>
<span id="cb385-4321"><a href="#cb385-4321" aria-hidden="true" tabindex="-1"></a><span class="in">             data.frame(</span></span>
<span id="cb385-4322"><a href="#cb385-4322" aria-hidden="true" tabindex="-1"></a><span class="in">               lower=c(-1000,0),</span></span>
<span id="cb385-4323"><a href="#cb385-4323" aria-hidden="true" tabindex="-1"></a><span class="in">               upper=c(0,1000),</span></span>
<span id="cb385-4324"><a href="#cb385-4324" aria-hidden="true" tabindex="-1"></a><span class="in">               weight=c(1,0))) # user-defined stepwise weight function </span></span>
<span id="cb385-4325"><a href="#cb385-4325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4326"><a href="#cb385-4326" aria-hidden="true" tabindex="-1"></a><span class="in"># Call the functions for each model for chill, heat and frost accumulations</span></span>
<span id="cb385-4327"><a href="#cb385-4327" aria-hidden="true" tabindex="-1"></a><span class="in">models &lt;- list(Chill_Portions = Dynamic_Model,</span></span>
<span id="cb385-4328"><a href="#cb385-4328" aria-hidden="true" tabindex="-1"></a><span class="in">               GDH = GDH, </span></span>
<span id="cb385-4329"><a href="#cb385-4329" aria-hidden="true" tabindex="-1"></a><span class="in">               Frost_H = frost_model)</span></span>
<span id="cb385-4330"><a href="#cb385-4330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4331"><a href="#cb385-4331" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate chill accumulation for the four temperature scenarios generated</span></span>
<span id="cb385-4332"><a href="#cb385-4332" aria-hidden="true" tabindex="-1"></a><span class="in">chill_hist_scenario_list &lt;- tempResponse_daily_list(all_past_scenario_temps,</span></span>
<span id="cb385-4333"><a href="#cb385-4333" aria-hidden="true" tabindex="-1"></a><span class="in">                                                    latitude = 50.9,</span></span>
<span id="cb385-4334"><a href="#cb385-4334" aria-hidden="true" tabindex="-1"></a><span class="in">                                                    Start_JDay = 305,</span></span>
<span id="cb385-4335"><a href="#cb385-4335" aria-hidden="true" tabindex="-1"></a><span class="in">                                                    End_JDay = 59,</span></span>
<span id="cb385-4336"><a href="#cb385-4336" aria-hidden="true" tabindex="-1"></a><span class="in">                                                    models = models)</span></span>
<span id="cb385-4337"><a href="#cb385-4337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4338"><a href="#cb385-4338" aria-hidden="true" tabindex="-1"></a><span class="in"># Remove all the incomplete winters from the record, before saving</span></span>
<span id="cb385-4339"><a href="#cb385-4339" aria-hidden="true" tabindex="-1"></a><span class="in">chill_hist_scenario_list &lt;- lapply(chill_hist_scenario_list,</span></span>
<span id="cb385-4340"><a href="#cb385-4340" aria-hidden="true" tabindex="-1"></a><span class="in">                                   function(x) x %&gt;%</span></span>
<span id="cb385-4341"><a href="#cb385-4341" aria-hidden="true" tabindex="-1"></a><span class="in">                                     filter(Perc_complete == 100))</span></span>
<span id="cb385-4342"><a href="#cb385-4342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4343"><a href="#cb385-4343" aria-hidden="true" tabindex="-1"></a><span class="in"># Include the place name and the start and end dates of the considered period</span></span>
<span id="cb385-4344"><a href="#cb385-4344" aria-hidden="true" tabindex="-1"></a><span class="in"># in the saved file name</span></span>
<span id="cb385-4345"><a href="#cb385-4345" aria-hidden="true" tabindex="-1"></a><span class="in">save_temperature_scenarios(chill_hist_scenario_list,</span></span>
<span id="cb385-4346"><a href="#cb385-4346" aria-hidden="true" tabindex="-1"></a><span class="in">                           "data/Bonn","Bonn_hist_chill_305_59")</span></span>
<span id="cb385-4347"><a href="#cb385-4347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4348"><a href="#cb385-4348" aria-hidden="true" tabindex="-1"></a><span class="in"># Store the years (1980, 1990, 2000, 2010) in a character vector</span></span>
<span id="cb385-4349"><a href="#cb385-4349" aria-hidden="true" tabindex="-1"></a><span class="in">scenarios &lt;- names(chill_hist_scenario_list)[1:4]</span></span>
<span id="cb385-4350"><a href="#cb385-4350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4351"><a href="#cb385-4351" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine all scenarios into one dataset, with a new column scenario for year</span></span>
<span id="cb385-4352"><a href="#cb385-4352" aria-hidden="true" tabindex="-1"></a><span class="in">all_scenarios &lt;- chill_hist_scenario_list[[scenarios[1]]] %&gt;%</span></span>
<span id="cb385-4353"><a href="#cb385-4353" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(scenario = as.numeric(scenarios[1]))</span></span>
<span id="cb385-4354"><a href="#cb385-4354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4355"><a href="#cb385-4355" aria-hidden="true" tabindex="-1"></a><span class="in"># Repeat with loop for the remaining scenarios and bind to all_scenarios</span></span>
<span id="cb385-4356"><a href="#cb385-4356" aria-hidden="true" tabindex="-1"></a><span class="in">for (sc in scenarios[2:4])</span></span>
<span id="cb385-4357"><a href="#cb385-4357" aria-hidden="true" tabindex="-1"></a><span class="in"> all_scenarios &lt;- all_scenarios %&gt;%</span></span>
<span id="cb385-4358"><a href="#cb385-4358" aria-hidden="true" tabindex="-1"></a><span class="in">  rbind(chill_hist_scenario_list[[sc]] %&gt;%</span></span>
<span id="cb385-4359"><a href="#cb385-4359" aria-hidden="true" tabindex="-1"></a><span class="in">          cbind(</span></span>
<span id="cb385-4360"><a href="#cb385-4360" aria-hidden="true" tabindex="-1"></a><span class="in">            scenario=as.numeric(sc))</span></span>
<span id="cb385-4361"><a href="#cb385-4361" aria-hidden="true" tabindex="-1"></a><span class="in">        ) %&gt;%</span></span>
<span id="cb385-4362"><a href="#cb385-4362" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Perc_complete == 100) # result is chillR data.frame</span></span>
<span id="cb385-4363"><a href="#cb385-4363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4364"><a href="#cb385-4364" aria-hidden="true" tabindex="-1"></a><span class="in"># Let's compute the actual 'observed' chill for comparison</span></span>
<span id="cb385-4365"><a href="#cb385-4365" aria-hidden="true" tabindex="-1"></a><span class="in">actual_chill &lt;- tempResponse_daily_list(Bonn_temps,</span></span>
<span id="cb385-4366"><a href="#cb385-4366" aria-hidden="true" tabindex="-1"></a><span class="in">                                        latitude=50.9,</span></span>
<span id="cb385-4367"><a href="#cb385-4367" aria-hidden="true" tabindex="-1"></a><span class="in">                                        Start_JDay = 305,</span></span>
<span id="cb385-4368"><a href="#cb385-4368" aria-hidden="true" tabindex="-1"></a><span class="in">                                        End_JDay = 59,</span></span>
<span id="cb385-4369"><a href="#cb385-4369" aria-hidden="true" tabindex="-1"></a><span class="in">                                        models)[[1]] %&gt;%</span></span>
<span id="cb385-4370"><a href="#cb385-4370" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Perc_complete == 100)</span></span>
<span id="cb385-4371"><a href="#cb385-4371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4372"><a href="#cb385-4372" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = all_scenarios,</span></span>
<span id="cb385-4373"><a href="#cb385-4373" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(scenario,</span></span>
<span id="cb385-4374"><a href="#cb385-4374" aria-hidden="true" tabindex="-1"></a><span class="in">           Chill_Portions,</span></span>
<span id="cb385-4375"><a href="#cb385-4375" aria-hidden="true" tabindex="-1"></a><span class="in">           fill = factor(scenario))) +</span></span>
<span id="cb385-4376"><a href="#cb385-4376" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_violin() +</span></span>
<span id="cb385-4377"><a href="#cb385-4377" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Chill accumulation (Chill Portions)") +</span></span>
<span id="cb385-4378"><a href="#cb385-4378" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Scenario year") +</span></span>
<span id="cb385-4379"><a href="#cb385-4379" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +</span></span>
<span id="cb385-4380"><a href="#cb385-4380" aria-hidden="true" tabindex="-1"></a><span class="in">  ylim(c(0,90)) +</span></span>
<span id="cb385-4381"><a href="#cb385-4381" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = actual_chill,</span></span>
<span id="cb385-4382"><a href="#cb385-4382" aria-hidden="true" tabindex="-1"></a><span class="in">             aes(End_year,</span></span>
<span id="cb385-4383"><a href="#cb385-4383" aria-hidden="true" tabindex="-1"></a><span class="in">                 Chill_Portions,</span></span>
<span id="cb385-4384"><a href="#cb385-4384" aria-hidden="true" tabindex="-1"></a><span class="in">                 fill = "blue"),</span></span>
<span id="cb385-4385"><a href="#cb385-4385" aria-hidden="true" tabindex="-1"></a><span class="in">             col = "blue",</span></span>
<span id="cb385-4386"><a href="#cb385-4386" aria-hidden="true" tabindex="-1"></a><span class="in">             show.legend = FALSE) +</span></span>
<span id="cb385-4387"><a href="#cb385-4387" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_discrete(name = "Scenario",</span></span>
<span id="cb385-4388"><a href="#cb385-4388" aria-hidden="true" tabindex="-1"></a><span class="in">                      breaks = unique(all_scenarios$scenario)) </span></span>
<span id="cb385-4389"><a href="#cb385-4389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4390"><a href="#cb385-4390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4391"><a href="#cb385-4391" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-4392"><a href="#cb385-4392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4393"><a href="#cb385-4393" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4394"><a href="#cb385-4394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4395"><a href="#cb385-4395" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now we have chill distribution scenarios representing the years 1980, 1990, 2000 and 2010<span class="dv">&amp;mdash;</span> not much change here, which means we probably won’t have to worry about chill deficiencies in Bonn any time soon.</span>
<span id="cb385-4396"><a href="#cb385-4396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4397"><a href="#cb385-4397" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Note that all the annual scenarios so far were based on running means of *T~min~* and *T~max~*. This seems appropriate because in times of accelerating climate change, estimating temperatures at any given time via clean mathematical equations seems rather challenging.</span>
<span id="cb385-4398"><a href="#cb385-4398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4399"><a href="#cb385-4399" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>However, <span class="in">`chillR`</span> also contains the option of using linear regression to determine these representative temperatures for a particular historic scenario. Let’s quickly look at what kind of difference this makes in this case:</span>
<span id="cb385-4400"><a href="#cb385-4400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4401"><a href="#cb385-4401" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 14.2i}</span></span>
<span id="cb385-4402"><a href="#cb385-4402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4403"><a href="#cb385-4403" aria-hidden="true" tabindex="-1"></a><span class="in"># Save the observed chill data to use in making the CMPI6 scenarios in later ch</span></span>
<span id="cb385-4404"><a href="#cb385-4404" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(actual_chill,"data/Bonn/Bonn_observed_chill_305_59.csv", </span></span>
<span id="cb385-4405"><a href="#cb385-4405" aria-hidden="true" tabindex="-1"></a><span class="in">          row.names = FALSE)</span></span>
<span id="cb385-4406"><a href="#cb385-4406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4407"><a href="#cb385-4407" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb385-4408"><a href="#cb385-4408" aria-hidden="true" tabindex="-1"></a><span class="in"># aggregate: Splits the data into subsets, computes summary statistics for each, </span></span>
<span id="cb385-4409"><a href="#cb385-4409" aria-hidden="true" tabindex="-1"></a><span class="in"># and returns the result in a convenient form.</span></span>
<span id="cb385-4410"><a href="#cb385-4410" aria-hidden="true" tabindex="-1"></a><span class="in">temperature_means &lt;- </span></span>
<span id="cb385-4411"><a href="#cb385-4411" aria-hidden="true" tabindex="-1"></a><span class="in">  data.frame(Year = min(Bonn_temps$Year):max(Bonn_temps$Year),</span></span>
<span id="cb385-4412"><a href="#cb385-4412" aria-hidden="true" tabindex="-1"></a><span class="in">             Tmin = aggregate(Bonn_temps$Tmin,</span></span>
<span id="cb385-4413"><a href="#cb385-4413" aria-hidden="true" tabindex="-1"></a><span class="in">                              FUN = "mean",</span></span>
<span id="cb385-4414"><a href="#cb385-4414" aria-hidden="true" tabindex="-1"></a><span class="in">                              by = list(Bonn_temps$Year))[,2],  </span></span>
<span id="cb385-4415"><a href="#cb385-4415" aria-hidden="true" tabindex="-1"></a><span class="in">             Tmax=aggregate(Bonn_temps$Tmax,</span></span>
<span id="cb385-4416"><a href="#cb385-4416" aria-hidden="true" tabindex="-1"></a><span class="in">                            FUN = "mean",</span></span>
<span id="cb385-4417"><a href="#cb385-4417" aria-hidden="true" tabindex="-1"></a><span class="in">                            by = list(Bonn_temps$Year))[,2]) %&gt;% # only mean column</span></span>
<span id="cb385-4418"><a href="#cb385-4418" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(runn_mean_Tmin = runn_mean(Tmin,15),</span></span>
<span id="cb385-4419"><a href="#cb385-4419" aria-hidden="true" tabindex="-1"></a><span class="in">         runn_mean_Tmax = runn_mean(Tmax,15)) # moving average </span></span>
<span id="cb385-4420"><a href="#cb385-4420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4421"><a href="#cb385-4421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4422"><a href="#cb385-4422" aria-hidden="true" tabindex="-1"></a><span class="in">Tmin_regression &lt;- lm(Tmin~Year,</span></span>
<span id="cb385-4423"><a href="#cb385-4423" aria-hidden="true" tabindex="-1"></a><span class="in">                      temperature_means) # data.frame for lm</span></span>
<span id="cb385-4424"><a href="#cb385-4424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4425"><a href="#cb385-4425" aria-hidden="true" tabindex="-1"></a><span class="in">Tmax_regression &lt;- lm(Tmax~Year,</span></span>
<span id="cb385-4426"><a href="#cb385-4426" aria-hidden="true" tabindex="-1"></a><span class="in">                      temperature_means)</span></span>
<span id="cb385-4427"><a href="#cb385-4427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4428"><a href="#cb385-4428" aria-hidden="true" tabindex="-1"></a><span class="in"># Use regression model (y = a + bx) to predict Tmin and Tmax values for </span></span>
<span id="cb385-4429"><a href="#cb385-4429" aria-hidden="true" tabindex="-1"></a><span class="in"># each yeaer and bind them to temperature_means dataset</span></span>
<span id="cb385-4430"><a href="#cb385-4430" aria-hidden="true" tabindex="-1"></a><span class="in">temperature_means &lt;- temperature_means %&gt;%</span></span>
<span id="cb385-4431"><a href="#cb385-4431" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(regression_Tmin = Tmin_regression$coefficients[1]+</span></span>
<span id="cb385-4432"><a href="#cb385-4432" aria-hidden="true" tabindex="-1"></a><span class="in">           Tmin_regression$coefficients[2]*temperature_means$Year,</span></span>
<span id="cb385-4433"><a href="#cb385-4433" aria-hidden="true" tabindex="-1"></a><span class="in">           regression_Tmax = Tmax_regression$coefficients[1]+</span></span>
<span id="cb385-4434"><a href="#cb385-4434" aria-hidden="true" tabindex="-1"></a><span class="in">           Tmax_regression$coefficients[2]*temperature_means$Year)</span></span>
<span id="cb385-4435"><a href="#cb385-4435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4436"><a href="#cb385-4436" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot for Tmin</span></span>
<span id="cb385-4437"><a href="#cb385-4437" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(temperature_means,</span></span>
<span id="cb385-4438"><a href="#cb385-4438" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(Year,</span></span>
<span id="cb385-4439"><a href="#cb385-4439" aria-hidden="true" tabindex="-1"></a><span class="in">           Tmin)) + </span></span>
<span id="cb385-4440"><a href="#cb385-4440" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() + </span></span>
<span id="cb385-4441"><a href="#cb385-4441" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(data = temperature_means,</span></span>
<span id="cb385-4442"><a href="#cb385-4442" aria-hidden="true" tabindex="-1"></a><span class="in">            aes(Year,</span></span>
<span id="cb385-4443"><a href="#cb385-4443" aria-hidden="true" tabindex="-1"></a><span class="in">                runn_mean_Tmin),</span></span>
<span id="cb385-4444"><a href="#cb385-4444" aria-hidden="true" tabindex="-1"></a><span class="in">            lwd = 2,</span></span>
<span id="cb385-4445"><a href="#cb385-4445" aria-hidden="true" tabindex="-1"></a><span class="in">            col = "blue") + </span></span>
<span id="cb385-4446"><a href="#cb385-4446" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(data = temperature_means,</span></span>
<span id="cb385-4447"><a href="#cb385-4447" aria-hidden="true" tabindex="-1"></a><span class="in">            aes(Year,</span></span>
<span id="cb385-4448"><a href="#cb385-4448" aria-hidden="true" tabindex="-1"></a><span class="in">                regression_Tmin),</span></span>
<span id="cb385-4449"><a href="#cb385-4449" aria-hidden="true" tabindex="-1"></a><span class="in">            lwd = 2,</span></span>
<span id="cb385-4450"><a href="#cb385-4450" aria-hidden="true" tabindex="-1"></a><span class="in">            col = "red") +</span></span>
<span id="cb385-4451"><a href="#cb385-4451" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +</span></span>
<span id="cb385-4452"><a href="#cb385-4452" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Mean monthly minimum temperature (°C)")</span></span>
<span id="cb385-4453"><a href="#cb385-4453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4454"><a href="#cb385-4454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4455"><a href="#cb385-4455" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot for Tmax</span></span>
<span id="cb385-4456"><a href="#cb385-4456" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(temperature_means,</span></span>
<span id="cb385-4457"><a href="#cb385-4457" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(Year,</span></span>
<span id="cb385-4458"><a href="#cb385-4458" aria-hidden="true" tabindex="-1"></a><span class="in">           Tmax)) + </span></span>
<span id="cb385-4459"><a href="#cb385-4459" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() + </span></span>
<span id="cb385-4460"><a href="#cb385-4460" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(data = temperature_means,</span></span>
<span id="cb385-4461"><a href="#cb385-4461" aria-hidden="true" tabindex="-1"></a><span class="in">            aes(Year,</span></span>
<span id="cb385-4462"><a href="#cb385-4462" aria-hidden="true" tabindex="-1"></a><span class="in">                runn_mean_Tmax),</span></span>
<span id="cb385-4463"><a href="#cb385-4463" aria-hidden="true" tabindex="-1"></a><span class="in">            lwd = 2,</span></span>
<span id="cb385-4464"><a href="#cb385-4464" aria-hidden="true" tabindex="-1"></a><span class="in">            col = "blue") + </span></span>
<span id="cb385-4465"><a href="#cb385-4465" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(data = temperature_means,</span></span>
<span id="cb385-4466"><a href="#cb385-4466" aria-hidden="true" tabindex="-1"></a><span class="in">            aes(Year, </span></span>
<span id="cb385-4467"><a href="#cb385-4467" aria-hidden="true" tabindex="-1"></a><span class="in">                regression_Tmax),</span></span>
<span id="cb385-4468"><a href="#cb385-4468" aria-hidden="true" tabindex="-1"></a><span class="in">            lwd = 2,</span></span>
<span id="cb385-4469"><a href="#cb385-4469" aria-hidden="true" tabindex="-1"></a><span class="in">            col = "red") +</span></span>
<span id="cb385-4470"><a href="#cb385-4470" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +</span></span>
<span id="cb385-4471"><a href="#cb385-4471" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Mean monthly maximum temperature (°C)")</span></span>
<span id="cb385-4472"><a href="#cb385-4472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4473"><a href="#cb385-4473" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-4474"><a href="#cb385-4474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4475"><a href="#cb385-4475" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4476"><a href="#cb385-4476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4477"><a href="#cb385-4477" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There’s a bit of a difference between the running mean function (blue) and the linear regression line (red). Sometimes this can be important, and we should expect the difference to become more pronounced as climate change progresses.</span>
<span id="cb385-4478"><a href="#cb385-4478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4479"><a href="#cb385-4479" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4480"><a href="#cb385-4480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4481"><a href="#cb385-4481" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;14.3&lt;/span&gt;&amp;nbsp; Exercises on generating historic temperature scenarios</span></span>
<span id="cb385-4482"><a href="#cb385-4482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4483"><a href="#cb385-4483" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-4484"><a href="#cb385-4484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4485"><a href="#cb385-4485" aria-hidden="true" tabindex="-1"></a>***1. For the location you chose for previous exercises, produce historic temperature scenarios representing several years of the historic record (your choice).***</span>
<span id="cb385-4486"><a href="#cb385-4486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4487"><a href="#cb385-4487" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 14.3.1}</span></span>
<span id="cb385-4488"><a href="#cb385-4488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4489"><a href="#cb385-4489" aria-hidden="true" tabindex="-1"></a><span class="in"># Call the patched weather dataset for Mössingen again</span></span>
<span id="cb385-4490"><a href="#cb385-4490" aria-hidden="true" tabindex="-1"></a><span class="in">MS_patched_weather &lt;- read.csv("data/MS/MS_patched_weather.csv")</span></span>
<span id="cb385-4491"><a href="#cb385-4491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4492"><a href="#cb385-4492" aria-hidden="true" tabindex="-1"></a><span class="in"># I chose years between 1990 and 2020; so set 2005 as baseline year (median)</span></span>
<span id="cb385-4493"><a href="#cb385-4493" aria-hidden="true" tabindex="-1"></a><span class="in"># and the start year of dataset 1990 scenarios for comparison</span></span>
<span id="cb385-4494"><a href="#cb385-4494" aria-hidden="true" tabindex="-1"></a><span class="in">MS_scenario_1990 &lt;- temperature_scenario_from_records(weather = MS_patched_weather, </span></span>
<span id="cb385-4495"><a href="#cb385-4495" aria-hidden="true" tabindex="-1"></a><span class="in">                                                   year = 1990)</span></span>
<span id="cb385-4496"><a href="#cb385-4496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4497"><a href="#cb385-4497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4498"><a href="#cb385-4498" aria-hidden="true" tabindex="-1"></a><span class="in"># Absolute temperature scenario, where the baseline (reference_year) is NA</span></span>
<span id="cb385-4499"><a href="#cb385-4499" aria-hidden="true" tabindex="-1"></a><span class="in">MS_scenario_2005 &lt;- temperature_scenario_from_records(weather = MS_patched_weather,</span></span>
<span id="cb385-4500"><a href="#cb385-4500" aria-hidden="true" tabindex="-1"></a><span class="in">                                                   year = 2005)</span></span>
<span id="cb385-4501"><a href="#cb385-4501" aria-hidden="true" tabindex="-1"></a><span class="in">kable(do.call(rbind, MS_scenario_2005$`2005`), </span></span>
<span id="cb385-4502"><a href="#cb385-4502" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Absolute temperature scenario") %&gt;%</span></span>
<span id="cb385-4503"><a href="#cb385-4503" aria-hidden="true" tabindex="-1"></a><span class="in">    kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-4504"><a href="#cb385-4504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4505"><a href="#cb385-4505" aria-hidden="true" tabindex="-1"></a><span class="in"># Relative change scenarios (2005 vs. 1990)</span></span>
<span id="cb385-4506"><a href="#cb385-4506" aria-hidden="true" tabindex="-1"></a><span class="in">MS_relative_scenario &lt;- temperature_scenario_baseline_adjustment(baseline = MS_scenario_2005,</span></span>
<span id="cb385-4507"><a href="#cb385-4507" aria-hidden="true" tabindex="-1"></a><span class="in">    temperature_scenario = MS_scenario_1990)</span></span>
<span id="cb385-4508"><a href="#cb385-4508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4509"><a href="#cb385-4509" aria-hidden="true" tabindex="-1"></a><span class="in">kable(do.call(rbind, MS_relative_scenario$`1990`), caption = "Relative change scenario") %&gt;%</span></span>
<span id="cb385-4510"><a href="#cb385-4510" aria-hidden="true" tabindex="-1"></a><span class="in">    kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-4511"><a href="#cb385-4511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4512"><a href="#cb385-4512" aria-hidden="true" tabindex="-1"></a><span class="in"># Create scenarios from records of interested years</span></span>
<span id="cb385-4513"><a href="#cb385-4513" aria-hidden="true" tabindex="-1"></a><span class="in">MS_all_past_scenarios &lt;- temperature_scenario_from_records(weather = MS_patched_weather, </span></span>
<span id="cb385-4514"><a href="#cb385-4514" aria-hidden="true" tabindex="-1"></a><span class="in">                                                           year = c(1990, 2000, 2010, 2020))</span></span>
<span id="cb385-4515"><a href="#cb385-4515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4516"><a href="#cb385-4516" aria-hidden="true" tabindex="-1"></a><span class="in"># Make temperature scenario relative to a particular baseline</span></span>
<span id="cb385-4517"><a href="#cb385-4517" aria-hidden="true" tabindex="-1"></a><span class="in">MS_adjusted_scenarios &lt;- temperature_scenario_baseline_adjustment(baseline = MS_scenario_2005,</span></span>
<span id="cb385-4518"><a href="#cb385-4518" aria-hidden="true" tabindex="-1"></a><span class="in">    temperature_scenario = MS_all_past_scenarios)</span></span>
<span id="cb385-4519"><a href="#cb385-4519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4520"><a href="#cb385-4520" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate temperatures for simulation years, relative to adjusted_scenarios</span></span>
<span id="cb385-4521"><a href="#cb385-4521" aria-hidden="true" tabindex="-1"></a><span class="in">MS_all_past_scenario_temps &lt;- temperature_generation(weather = MS_patched_weather, </span></span>
<span id="cb385-4522"><a href="#cb385-4522" aria-hidden="true" tabindex="-1"></a><span class="in">                                                     years = c(1990,2020), </span></span>
<span id="cb385-4523"><a href="#cb385-4523" aria-hidden="true" tabindex="-1"></a><span class="in">                                                     sim_years = c(2001, 2100),</span></span>
<span id="cb385-4524"><a href="#cb385-4524" aria-hidden="true" tabindex="-1"></a><span class="in">                                                     temperature_scenario = MS_adjusted_scenarios)</span></span>
<span id="cb385-4525"><a href="#cb385-4525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4526"><a href="#cb385-4526" aria-hidden="true" tabindex="-1"></a><span class="in"># Save as four different files of 100 year simulations</span></span>
<span id="cb385-4527"><a href="#cb385-4527" aria-hidden="true" tabindex="-1"></a><span class="in">save_temperature_scenarios(MS_all_past_scenario_temps, "data/MS", "MS_hist_scenarios")</span></span>
<span id="cb385-4528"><a href="#cb385-4528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4529"><a href="#cb385-4529" aria-hidden="true" tabindex="-1"></a><span class="in">MS_historic_temp_scenario_list &lt;- load_temperature_scenarios(path = "data/MS",</span></span>
<span id="cb385-4530"><a href="#cb385-4530" aria-hidden="true" tabindex="-1"></a><span class="in">                                                    prefix = "MS_hist_scenarios")</span></span>
<span id="cb385-4531"><a href="#cb385-4531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4532"><a href="#cb385-4532" aria-hidden="true" tabindex="-1"></a><span class="in">MS_historic_sc &lt;- do.call(rbind, MS_historic_temp_scenario_list)</span></span>
<span id="cb385-4533"><a href="#cb385-4533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4534"><a href="#cb385-4534" aria-hidden="true" tabindex="-1"></a><span class="in">kable(MS_historic_sc[c(1:10, 40001:40010, 80001:80010, 120001:120010), ],</span></span>
<span id="cb385-4535"><a href="#cb385-4535" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Data snippets of historic temperature scenarios </span></span>
<span id="cb385-4536"><a href="#cb385-4536" aria-hidden="true" tabindex="-1"></a><span class="in">      representing the years 1990, 2000, 2010 and 2020 for Mössigen") %&gt;%</span></span>
<span id="cb385-4537"><a href="#cb385-4537" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-4538"><a href="#cb385-4538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4539"><a href="#cb385-4539" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-4540"><a href="#cb385-4540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4541"><a href="#cb385-4541" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4542"><a href="#cb385-4542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4543"><a href="#cb385-4543" aria-hidden="true" tabindex="-1"></a>***2. Produce chill distributions for these scenarios and plot them.***</span>
<span id="cb385-4544"><a href="#cb385-4544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4545"><a href="#cb385-4545" aria-hidden="true" tabindex="-1"></a>Similar to Bonn, M<span class="dv">&amp;ouml;</span>ssigen shows comparable chill distribution scenarios for the years 1990, 2000, 2010, and 2020, indicating a low risk of chill deficiencies in the region in the future.</span>
<span id="cb385-4546"><a href="#cb385-4546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4547"><a href="#cb385-4547" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 14.3.2}</span></span>
<span id="cb385-4548"><a href="#cb385-4548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4549"><a href="#cb385-4549" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate heat for temperate trees according to a stepwise model provided</span></span>
<span id="cb385-4550"><a href="#cb385-4550" aria-hidden="true" tabindex="-1"></a><span class="in">frost_model &lt;- function(x) </span></span>
<span id="cb385-4551"><a href="#cb385-4551" aria-hidden="true" tabindex="-1"></a><span class="in">  step_model(x, data.frame(lower = c(-1000, 0), </span></span>
<span id="cb385-4552"><a href="#cb385-4552" aria-hidden="true" tabindex="-1"></a><span class="in">                           upper = c(0,1000), </span></span>
<span id="cb385-4553"><a href="#cb385-4553" aria-hidden="true" tabindex="-1"></a><span class="in">                           weight = c(1, 0))) </span></span>
<span id="cb385-4554"><a href="#cb385-4554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4555"><a href="#cb385-4555" aria-hidden="true" tabindex="-1"></a><span class="in"># Call the functions for each model for chill, heat and frost accumulations</span></span>
<span id="cb385-4556"><a href="#cb385-4556" aria-hidden="true" tabindex="-1"></a><span class="in">models &lt;- list(Chill_Portions = Dynamic_Model, GDH = GDH, Frost_H = frost_model)</span></span>
<span id="cb385-4557"><a href="#cb385-4557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4558"><a href="#cb385-4558" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate chill accumulation for the four temperature scenarios generated</span></span>
<span id="cb385-4559"><a href="#cb385-4559" aria-hidden="true" tabindex="-1"></a><span class="in">MS_chill_hist_scenario_list &lt;- tempResponse_daily_list(MS_all_past_scenario_temps, </span></span>
<span id="cb385-4560"><a href="#cb385-4560" aria-hidden="true" tabindex="-1"></a><span class="in">                                                       latitude = 48.4,</span></span>
<span id="cb385-4561"><a href="#cb385-4561" aria-hidden="true" tabindex="-1"></a><span class="in">                                                       Start_JDay = 305, </span></span>
<span id="cb385-4562"><a href="#cb385-4562" aria-hidden="true" tabindex="-1"></a><span class="in">                                                       End_JDay = 59, </span></span>
<span id="cb385-4563"><a href="#cb385-4563" aria-hidden="true" tabindex="-1"></a><span class="in">                                                       models = models)</span></span>
<span id="cb385-4564"><a href="#cb385-4564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4565"><a href="#cb385-4565" aria-hidden="true" tabindex="-1"></a><span class="in"># Remove all the incomplete winters from the record, before saving</span></span>
<span id="cb385-4566"><a href="#cb385-4566" aria-hidden="true" tabindex="-1"></a><span class="in">MS_chill_hist_scenario_list &lt;- lapply(MS_chill_hist_scenario_list, function(x) x %&gt;%</span></span>
<span id="cb385-4567"><a href="#cb385-4567" aria-hidden="true" tabindex="-1"></a><span class="in">    filter(Perc_complete == 100))</span></span>
<span id="cb385-4568"><a href="#cb385-4568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4569"><a href="#cb385-4569" aria-hidden="true" tabindex="-1"></a><span class="in"># Include the place name and the start and end dates of the considered period</span></span>
<span id="cb385-4570"><a href="#cb385-4570" aria-hidden="true" tabindex="-1"></a><span class="in"># in the saved file name</span></span>
<span id="cb385-4571"><a href="#cb385-4571" aria-hidden="true" tabindex="-1"></a><span class="in">save_temperature_scenarios(MS_chill_hist_scenario_list, </span></span>
<span id="cb385-4572"><a href="#cb385-4572" aria-hidden="true" tabindex="-1"></a><span class="in">                              "data/MS", "MS_hist_chill_305_59")</span></span>
<span id="cb385-4573"><a href="#cb385-4573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4574"><a href="#cb385-4574" aria-hidden="true" tabindex="-1"></a><span class="in"># Store the years (1990, 2000, 2010, 2020) in a character vector</span></span>
<span id="cb385-4575"><a href="#cb385-4575" aria-hidden="true" tabindex="-1"></a><span class="in">scenarios &lt;- names(MS_chill_hist_scenario_list)[1:4]</span></span>
<span id="cb385-4576"><a href="#cb385-4576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4577"><a href="#cb385-4577" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine all scenarios into one dataset, with a new column scenario for year</span></span>
<span id="cb385-4578"><a href="#cb385-4578" aria-hidden="true" tabindex="-1"></a><span class="in">MS_all_scenarios &lt;- MS_chill_hist_scenario_list[[scenarios[1]]] %&gt;%</span></span>
<span id="cb385-4579"><a href="#cb385-4579" aria-hidden="true" tabindex="-1"></a><span class="in">    mutate(scenario = as.numeric(scenarios[1]))</span></span>
<span id="cb385-4580"><a href="#cb385-4580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4581"><a href="#cb385-4581" aria-hidden="true" tabindex="-1"></a><span class="in"># Repeat with loop for the remaining scenarios and bind to all_scenarios</span></span>
<span id="cb385-4582"><a href="#cb385-4582" aria-hidden="true" tabindex="-1"></a><span class="in">for (sc in scenarios[2:4]) MS_all_scenarios &lt;- MS_all_scenarios %&gt;%</span></span>
<span id="cb385-4583"><a href="#cb385-4583" aria-hidden="true" tabindex="-1"></a><span class="in">    rbind(MS_chill_hist_scenario_list[[sc]] %&gt;%</span></span>
<span id="cb385-4584"><a href="#cb385-4584" aria-hidden="true" tabindex="-1"></a><span class="in">        cbind(scenario = as.numeric(sc))) %&gt;%</span></span>
<span id="cb385-4585"><a href="#cb385-4585" aria-hidden="true" tabindex="-1"></a><span class="in">    filter(Perc_complete == 100)  # result is chillR data.frame</span></span>
<span id="cb385-4586"><a href="#cb385-4586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4587"><a href="#cb385-4587" aria-hidden="true" tabindex="-1"></a><span class="in"># Call weather output of MS_patched_weather dataset</span></span>
<span id="cb385-4588"><a href="#cb385-4588" aria-hidden="true" tabindex="-1"></a><span class="in">MS_temps &lt;- read_tab("data/MS/MS_patched_weather.csv")</span></span>
<span id="cb385-4589"><a href="#cb385-4589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4590"><a href="#cb385-4590" aria-hidden="true" tabindex="-1"></a><span class="in"># Let's compute the actual 'observed' chill for comparison</span></span>
<span id="cb385-4591"><a href="#cb385-4591" aria-hidden="true" tabindex="-1"></a><span class="in">MS_actual_chill &lt;- tempResponse_daily_list(MS_temps, latitude = 48.4, </span></span>
<span id="cb385-4592"><a href="#cb385-4592" aria-hidden="true" tabindex="-1"></a><span class="in">                                           Start_JDay = 305,</span></span>
<span id="cb385-4593"><a href="#cb385-4593" aria-hidden="true" tabindex="-1"></a><span class="in">                                           End_JDay = 59, models)[[1]] %&gt;%</span></span>
<span id="cb385-4594"><a href="#cb385-4594" aria-hidden="true" tabindex="-1"></a><span class="in">    filter(Perc_complete == 100)</span></span>
<span id="cb385-4595"><a href="#cb385-4595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4596"><a href="#cb385-4596" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = MS_all_scenarios, </span></span>
<span id="cb385-4597"><a href="#cb385-4597" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(scenario, Chill_Portions, </span></span>
<span id="cb385-4598"><a href="#cb385-4598" aria-hidden="true" tabindex="-1"></a><span class="in">           fill = factor(scenario))) +</span></span>
<span id="cb385-4599"><a href="#cb385-4599" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_violin() + </span></span>
<span id="cb385-4600"><a href="#cb385-4600" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Chill accumulation (Chill Portions)") + </span></span>
<span id="cb385-4601"><a href="#cb385-4601" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Scenario year") +</span></span>
<span id="cb385-4602"><a href="#cb385-4602" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_bw(base_size = 15) + </span></span>
<span id="cb385-4603"><a href="#cb385-4603" aria-hidden="true" tabindex="-1"></a><span class="in">  ylim(c(0, 90)) + </span></span>
<span id="cb385-4604"><a href="#cb385-4604" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = MS_actual_chill, </span></span>
<span id="cb385-4605"><a href="#cb385-4605" aria-hidden="true" tabindex="-1"></a><span class="in">             aes(End_year,</span></span>
<span id="cb385-4606"><a href="#cb385-4606" aria-hidden="true" tabindex="-1"></a><span class="in">                 Chill_Portions, </span></span>
<span id="cb385-4607"><a href="#cb385-4607" aria-hidden="true" tabindex="-1"></a><span class="in">                 fill = "blue"), col = "blue", show.legend = FALSE) + </span></span>
<span id="cb385-4608"><a href="#cb385-4608" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_discrete(name = "Scenario",</span></span>
<span id="cb385-4609"><a href="#cb385-4609" aria-hidden="true" tabindex="-1"></a><span class="in">    breaks = unique(MS_all_scenarios$scenario))</span></span>
<span id="cb385-4610"><a href="#cb385-4610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4611"><a href="#cb385-4611" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-4612"><a href="#cb385-4612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4613"><a href="#cb385-4613" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4614"><a href="#cb385-4614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4615"><a href="#cb385-4615" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 15: Future temperature scenarios</span></span>
<span id="cb385-4616"><a href="#cb385-4616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4617"><a href="#cb385-4617" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;15.1&lt;/span&gt;&amp;nbsp; Impacts of future climate change</span></span>
<span id="cb385-4618"><a href="#cb385-4618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4619"><a href="#cb385-4619" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-4620"><a href="#cb385-4620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4621"><a href="#cb385-4621" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We’re expecting future impacts to be more dramatic than what we’ve seen so far, mainly because atmospheric greenhouse gas concentrations are now higher than they’ve ever been, since our species appeared on the planet (and in fact many millions of years before).</span>
<span id="cb385-4622"><a href="#cb385-4622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4623"><a href="#cb385-4623" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Despite some efforts to mitigate climate change, the world’s factories, cars etc. are also still emitting carbon dioxide on the order of 40 Gt CO2-eq per year<span class="dv">&amp;mdash;</span> at or at least close to the all-time peak, with only weak signs of significant slowdown over the coming decades. </span>
<span id="cb385-4624"><a href="#cb385-4624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4625"><a href="#cb385-4625" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We also know that near-global ecosystem degradation is gradually chipping away at the buffers, checks and balances that have managed to maintain stable ecosystems to date. To anticipate the future impacts of climate change, we have to keep all these dynamics in mind. </span>
<span id="cb385-4626"><a href="#cb385-4626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4627"><a href="#cb385-4627" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It then becomes pretty obvious that we cannot predict with certainty what is going to happen in the future<span class="dv">&amp;mdash;</span> to what extent global efforts to curb carbon dioxide emissions or sequester carbon from the atmosphere will be successful or how much change the Earth’s marine and terrestrial ecosystems will be able to absorb before irreversible and possibly self-reinforcing degradation will set in.</span>
<span id="cb385-4628"><a href="#cb385-4628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4629"><a href="#cb385-4629" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We can’t address all uncertainties with <span class="in">`chillR`</span>, but we can accommodate<span class="dv">&amp;mdash;</span> to some extent<span class="dv">&amp;mdash;</span> our uncertainty about future climatic conditions. In climate change adaptation research, the challenge is often conceptualized using the concept of exposure, sensitivity and adaptive capacity:</span>
<span id="cb385-4630"><a href="#cb385-4630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4631"><a href="#cb385-4631" aria-hidden="true" tabindex="-1"></a>!<span class="co">[</span><span class="ot">***Conceptual framework for evaluating vulnerability and adaptation to climate change ([Luedeling, 2020](https://www.actahort.org/members/showpdf?booknrarnr=1281_58))***</span><span class="co">](./pic/ch15_1.png)</span></span>
<span id="cb385-4632"><a href="#cb385-4632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4633"><a href="#cb385-4633" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4634"><a href="#cb385-4634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4635"><a href="#cb385-4635" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In this concept, ***exposure*** describes the future conditions we expect, and ***sensitivity*** is the way the system responds to change. By combining exposure and sensitivity, we can determine the ***potential impact*** of expected conditions on the system of interest.</span>
<span id="cb385-4636"><a href="#cb385-4636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4637"><a href="#cb385-4637" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>These aren’t necessarily the actual impacts, however, because the system may be able to adapt to some extent. This system attribute is often referred to as ***adaptive capacity***.</span>
<span id="cb385-4638"><a href="#cb385-4638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4639"><a href="#cb385-4639" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Adaptation actions usually either aim to reduce system sensitivity (e.g. by choosing different tree cultivars) or to raise adaptive capacity (e.g. by establishing management options that allow dealing with chill shortfalls).</span>
<span id="cb385-4640"><a href="#cb385-4640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4641"><a href="#cb385-4641" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>What exact aspects of this concept we’re working on depends a bit on our interpretation of these terms. </span>
<span id="cb385-4642"><a href="#cb385-4642" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>For the most part, we’re looking at exposure, because we’re producing scenarios of conditions that orchards will be confronted with in the future.</span>
<span id="cb385-4643"><a href="#cb385-4643" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>However, our chill models consider<span class="dv">&amp;mdash;</span> to some extent<span class="dv">&amp;mdash;</span> the biological response of trees, which we could argue comes close to the concept of sensitivity.</span>
<span id="cb385-4644"><a href="#cb385-4644" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Yet we’re not fully capturing this sensitivity, so I would place the analyses we’re currently doing mostly within the exposure category.</span>
<span id="cb385-4645"><a href="#cb385-4645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4646"><a href="#cb385-4646" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4647"><a href="#cb385-4647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4648"><a href="#cb385-4648" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;15.2&lt;/span&gt;&amp;nbsp; Future climate scenarios</span></span>
<span id="cb385-4649"><a href="#cb385-4649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4650"><a href="#cb385-4650" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-4651"><a href="#cb385-4651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4652"><a href="#cb385-4652" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We have already learned about future climate scenarios, and how we can make historic chill scenarios, including some technical details, but what is still missing now is a source of information on conditions that climate models predict for the place we’re interested in.</span>
<span id="cb385-4653"><a href="#cb385-4653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4654"><a href="#cb385-4654" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In principle, all the <span class="in">`chillR`</span> functions work just as well with great future scenarios as they do with deeply flawed ones<span class="dv">&amp;mdash;</span> so if you happen to be collaborating with a world-class climate modeling group, or you have access to state-of-the-art climate scenarios for your region, it may be a good idea to use those data.</span>
<span id="cb385-4655"><a href="#cb385-4655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4656"><a href="#cb385-4656" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`chillR`</span> can’t keep track of all downscaling efforts that are going on, or be aware of all regional initiatives. It does, however, includes functions that allows us easy access to useful databases of climate information.</span>
<span id="cb385-4657"><a href="#cb385-4657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4658"><a href="#cb385-4658" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4659"><a href="#cb385-4659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4660"><a href="#cb385-4660" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;15.2.1&lt;/span&gt;&amp;nbsp; Some background on climate models and warming pathways</span></span>
<span id="cb385-4661"><a href="#cb385-4661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4662"><a href="#cb385-4662" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-4663"><a href="#cb385-4663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4664"><a href="#cb385-4664" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Until November 2023, the best source of climate data that chillR had to offer was the <span class="in">`ClimateWizard`</span> database, maintained by the Center for Tropical Agriculture (CIAT).</span>
<span id="cb385-4665"><a href="#cb385-4665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4666"><a href="#cb385-4666" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Climate science evolves rapidly and models get better and better. More importantly, the type of warming scenarios that are recommended by the IPCC get updated with every major report they issue. </span>
<span id="cb385-4667"><a href="#cb385-4667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4668"><a href="#cb385-4668" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>These scenarios are produced by the <span class="co">[</span><span class="ot">Coupled Model Intercomparison Project (CMIP)</span><span class="co">](https://en.wikipedia.org/wiki/Coupled_Model_Intercomparison_Project)</span>, a major effort to assemble the best that climate science has to offer in terms of future projections.</span>
<span id="cb385-4669"><a href="#cb385-4669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4670"><a href="#cb385-4670" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>CMIP is structured in phases:</span>
<span id="cb385-4671"><a href="#cb385-4671" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Phase 5 (CMIP5) went from 2010 to 2014 and it included a certain set of climate models. </span>
<span id="cb385-4672"><a href="#cb385-4672" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>The following CMIP6 includes has a slightly different array of climate models, which (at the time of writing) represents the **state of the art** of climate science, as endorsed by the IPCC.</span>
<span id="cb385-4673"><a href="#cb385-4673" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-4674"><a href="#cb385-4674" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-4675"><a href="#cb385-4675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4676"><a href="#cb385-4676" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Another feature of these future projections that gets updated occasionally are the warming scenarios which, over the years, have evolved from the scenarios contained in the <span class="co">[</span><span class="ot">Special Report on Emission Scenarios (SRES)</span><span class="co">](https://en.wikipedia.org/wiki/Special_Report_on_Emissions_Scenarios)</span> via the <span class="co">[</span><span class="ot">Representative Concentration Pathways (RCPs)</span><span class="co">](https://en.wikipedia.org/wiki/Representative_Concentration_Pathway)</span> to the currently recommended <span class="co">[</span><span class="ot">Shared Socioeconomic Pathways (SSPs)</span><span class="co">](https://en.wikipedia.org/wiki/Shared_Socioeconomic_Pathways)</span>.</span>
<span id="cb385-4677"><a href="#cb385-4677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4678"><a href="#cb385-4678" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The SSPs are the latest generation of scenarios, which was published in 2021. If you want to produce state-of-the-art projections, these are the scenarios you should be using, and you should be using the outputs of the CMIP6 set of climate models. (<span class="in">`ClimateWizard`</span> only includes RCP scenarios, and it even only has two of these, which don’t really bracket the full array of future climates that climate scientists consider plausible.)</span>
<span id="cb385-4679"><a href="#cb385-4679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4680"><a href="#cb385-4680" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4681"><a href="#cb385-4681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4682"><a href="#cb385-4682" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;15.3&lt;/span&gt;&amp;nbsp; Exercises on future temperature scenarios</span></span>
<span id="cb385-4683"><a href="#cb385-4683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4684"><a href="#cb385-4684" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-4685"><a href="#cb385-4685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4686"><a href="#cb385-4686" aria-hidden="true" tabindex="-1"></a>***1. Briefly describe the differences between the RCPs and the SSPs (you may have to follow some of the links provided above).***</span>
<span id="cb385-4687"><a href="#cb385-4687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4688"><a href="#cb385-4688" aria-hidden="true" tabindex="-1"></a>The Representative Concentration Pathways (RCP) are the climate change scenarios that project future concentrations of pollutants and greenhouse gases emitted from human activities, accounting for efforts to reduce these emissions. These scenarios quantitatively describe the concentrations of these substances in the atmosphere over time and their radiative forcing in the year 2100 (<span class="co">[</span><span class="ot">Bjørnæs , 2022</span><span class="co">](https://cicero.oslo.no/en/articles/a-guide-to-representative-concentration-pathways)</span>).</span>
<span id="cb385-4689"><a href="#cb385-4689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4690"><a href="#cb385-4690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4691"><a href="#cb385-4691" aria-hidden="true" tabindex="-1"></a>Descriptions of various RCP scenarios are shown in the table below:</span>
<span id="cb385-4692"><a href="#cb385-4692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4693"><a href="#cb385-4693" aria-hidden="true" tabindex="-1"></a>!<span class="co">[</span><span class="ot">***Description of the Representative Concentration Pathways (RCP) scenarios ([Kwon, Y., Hwang, J., &amp; Seo, Y., 2018](https://www.mdpi.com/2071-1050/10/4/1242))***</span><span class="co">](./pic/ch16_1.png)</span></span>
<span id="cb385-4694"><a href="#cb385-4694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4695"><a href="#cb385-4695" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4696"><a href="#cb385-4696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4697"><a href="#cb385-4697" aria-hidden="true" tabindex="-1"></a>The Shared Socio-economic Pathways (SSPs) are also climate change scenarios, but unlike the RCPs, their projections are for global socioeconomic changes and their impact on climate change up to the year 2100, as stated in the 2021 IPCC Sixth Assessment Report. In other words, the SSP scenarios are a further refinement of the RCP scenarios previously used for climate modelling in the IPCC fifth Assessment Report(<span class="co">[</span><span class="ot">Ministry for the Environment, 2024</span><span class="co">](https://environment.govt.nz/what-you-can-do/climate-scenarios-toolkit/climate-scenarios-list/ipccs-ssp-rcp-scenarios/)</span>). </span>
<span id="cb385-4698"><a href="#cb385-4698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4699"><a href="#cb385-4699" aria-hidden="true" tabindex="-1"></a>The SSP scenarios are built on assumptions about socio-economic, geopolitical, economic and technological trends, which are then translated into greenhouse gas emissions scenarios by coupling these assumptions with mitigation targets for climate change. On the other hand, the RCPs directly focus on **greenhouse gases**&amp;mdash; such as carbon dioxide, methane, nitrous oxide, flourocarbons and sulphur groups and hexafluroide&amp;mdash; as well as **aerosols and chemically active gases**, including sulphur dioxide, soot, organic carbon, carbon monoxide, nitrogen oxides, volatile organic compounds and ammonia.</span>
<span id="cb385-4700"><a href="#cb385-4700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4701"><a href="#cb385-4701" aria-hidden="true" tabindex="-1"></a>The justification for the RCPs not including assumptions about population growth, economic and technological developments was that the level of radiative forcing can be the same for different socio-economic futures. Therefore, instead of focusing on a specific economic development and calculate climate change for that scenario, scientists could just pick a RCP scenario that is most aligned with a climate target, and experiment with various technology and policy choices(<span class="co">[</span><span class="ot">Bjørnæs , 2022</span><span class="co">](https://cicero.oslo.no/en/articles/a-guide-to-representative-concentration-pathways)</span>). </span>
<span id="cb385-4702"><a href="#cb385-4702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4703"><a href="#cb385-4703" aria-hidden="true" tabindex="-1"></a>However, this later was considered as a drawback due to the lack of standardization of the socio-economic characteristics of the RCP scenarios, which made it difficult to map out societal changes and relevant policies for a climate target. This led to the development on SSPs (based on RCPs), which provide a standardized framework for comparing socio-economic and other societal changes, as well as their impact on climate change levels (<span class="co">[</span><span class="ot">ClimateData.ca, 2023</span><span class="co">](https://climatedata.ca/resource/understanding-shared-socio-economic-pathways-ssps/)</span>). </span>
<span id="cb385-4704"><a href="#cb385-4704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4705"><a href="#cb385-4705" aria-hidden="true" tabindex="-1"></a>In the IPCC's latest Sixth Assessment Report (AR6), the Shared Socio-economic Pathways (SSPS) are combined with the Representative Concentration Pathways (RCPs) to form the **SSP-RCP** scenarios, which integrate the baseline socio-economic scenarios of the SSPs with the emission trajectories from the RCPs (<span class="co">[</span><span class="ot">Ministry for the Environment, 2024</span><span class="co">](https://environment.govt.nz/what-you-can-do/climate-scenarios-toolkit/climate-scenarios-list/ipccs-ssp-rcp-scenarios/)</span>).</span>
<span id="cb385-4706"><a href="#cb385-4706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4707"><a href="#cb385-4707" aria-hidden="true" tabindex="-1"></a>The table below shows how each SSP is linked to each RCP, and its description in CMIP6.</span>
<span id="cb385-4708"><a href="#cb385-4708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4709"><a href="#cb385-4709" aria-hidden="true" tabindex="-1"></a>!<span class="co">[</span><span class="ot">***Source: [USDA Climate Hub](https://www.climatehubs.usda.gov/hubs/northwest/topic/what-are-climate-model-phases-and-scenarios)***</span><span class="co">](./pic/ch16_2.png)</span></span>
<span id="cb385-4710"><a href="#cb385-4710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4711"><a href="#cb385-4711" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4712"><a href="#cb385-4712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4713"><a href="#cb385-4713" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 16: Making CMIP6 scenarios</span></span>
<span id="cb385-4714"><a href="#cb385-4714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4715"><a href="#cb385-4715" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;16.1&lt;/span&gt;&amp;nbsp; Accessing gridded climate data from the Copernicus climate data store data</span></span>
<span id="cb385-4716"><a href="#cb385-4716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4717"><a href="#cb385-4717" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-4718"><a href="#cb385-4718" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb385-4719"><a href="#cb385-4719" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Most future climate data come in the form of grids<span class="dv">&amp;mdash;</span> if we want to obtain information on a particular climatic metric for a particular place, we may have to download a sometimes fairly large file that contains data for a lot of other places as well.</span>
<span id="cb385-4720"><a href="#cb385-4720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4721"><a href="#cb385-4721" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To make use of the data provided by the <span class="co">[</span><span class="ot">Copernicus Climate Data Store</span><span class="co">](https://cds.climate.copernicus.eu/)</span> via their Application Programming Interface (API), we need a user ID and a key (called Access Token on their site).</span>
<span id="cb385-4722"><a href="#cb385-4722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4723"><a href="#cb385-4723" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To get this, we have to create a free account <span class="co">[</span><span class="ot">here</span><span class="co">](https://cds.climate.copernicus.eu/)</span> (registration button is in the top right corner), before using the <span class="in">`chillR`</span> functions.</span>
<span id="cb385-4724"><a href="#cb385-4724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4725"><a href="#cb385-4725" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Once you’ve set up your account, navigate to your user profile on the <span class="co">[</span><span class="ot">Copernicus Climate Data Store website</span><span class="co">](https://cds.climate.copernicus.eu/)</span>, where  you’ll find your <span class="in">`User ID`</span> and your <span class="in">`Personal Access Token`</span> (both are long, cryptic strings of symbols), both of which you will need to download data. </span>
<span id="cb385-4726"><a href="#cb385-4726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4727"><a href="#cb385-4727" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>After registering, you also have to read and accept the <span class="co">[</span><span class="ot">Terms of Use for Data Access</span><span class="co">](https://cds.climate.copernicus.eu/datasets/projections-cmip6?tab=download#manage-licences)</span>. After this is done, the following code should work.</span>
<span id="cb385-4728"><a href="#cb385-4728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4729"><a href="#cb385-4729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4730"><a href="#cb385-4730" aria-hidden="true" tabindex="-1"></a>!<span class="co">[</span><span class="ot">***Relation of each SSP to each RCP and description of SSPs in CMIP6 ([USDA Climate Hubs](https://www.climatehubs.usda.gov/hubs/northwest/topic/what-are-climate-model-phases-and-scenarios))***</span><span class="co">](./pic/ch16_2.png)</span></span>
<span id="cb385-4731"><a href="#cb385-4731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4732"><a href="#cb385-4732" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4733"><a href="#cb385-4733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4734"><a href="#cb385-4734" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;16.1.1&lt;/span&gt;&amp;nbsp; Downloading future climate data</span></span>
<span id="cb385-4735"><a href="#cb385-4735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4736"><a href="#cb385-4736" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-4737"><a href="#cb385-4737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4738"><a href="#cb385-4738" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>With the <span class="in">`download_cmip6_ecmwfr`</span> function, we can only download data for grids.</span>
<span id="cb385-4739"><a href="#cb385-4739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4740"><a href="#cb385-4740" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To achieve this, we need to specify the extent of the download area.</span>
<span id="cb385-4741"><a href="#cb385-4741" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>We will  actually download the data to our computer. </span>
<span id="cb385-4742"><a href="#cb385-4742" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>We can keep the data there, so that we don’t have to download them again.</span>
<span id="cb385-4743"><a href="#cb385-4743" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-4744"><a href="#cb385-4744" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-4745"><a href="#cb385-4745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4746"><a href="#cb385-4746" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For subsequent steps, we can access these data and extract whatever we need. This means that if we really only want to analyze data for a single station, we can choose a small extent around this station.</span>
<span id="cb385-4747"><a href="#cb385-4747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4748"><a href="#cb385-4748" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If we want to evaluate multiple stations, however, especially when these are located close to each other, it may be advisable to choose an extent that includes all these stations.</span>
<span id="cb385-4749"><a href="#cb385-4749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4750"><a href="#cb385-4750" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For example, if we want to evaluate data for Bonn, which is located at approximately 7.1°E and 50.8°N, we should choose a small extent around this<span class="dv">&amp;mdash;</span> specify in the form of a vector structured as follows: <span class="in">`c(maximum latitude, minimum longitude, minimum latitude, maximum longitude)`</span>.</span>
<span id="cb385-4751"><a href="#cb385-4751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4752"><a href="#cb385-4752" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 16.1.1, eval=FALSE}</span></span>
<span id="cb385-4753"><a href="#cb385-4753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4754"><a href="#cb385-4754" aria-hidden="true" tabindex="-1"></a><span class="in"># Choose/set area to download data</span></span>
<span id="cb385-4755"><a href="#cb385-4755" aria-hidden="true" tabindex="-1"></a><span class="in">location = c(7.1, 50.8)</span></span>
<span id="cb385-4756"><a href="#cb385-4756" aria-hidden="true" tabindex="-1"></a><span class="in">area &lt;- c(52, 6, 50, 8)</span></span>
<span id="cb385-4757"><a href="#cb385-4757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4758"><a href="#cb385-4758" aria-hidden="true" tabindex="-1"></a><span class="in"># Download the data. The download_cmip6_ecmwfr contains a default set of models. </span></span>
<span id="cb385-4759"><a href="#cb385-4759" aria-hidden="true" tabindex="-1"></a><span class="in"># Start by only using data for SSP1 (ssp126).</span></span>
<span id="cb385-4760"><a href="#cb385-4760" aria-hidden="true" tabindex="-1"></a><span class="in">download_cmip6_ecmwfr(</span></span>
<span id="cb385-4761"><a href="#cb385-4761" aria-hidden="true" tabindex="-1"></a><span class="in">  scenarios = 'ssp126',</span></span>
<span id="cb385-4762"><a href="#cb385-4762" aria-hidden="true" tabindex="-1"></a><span class="in">  area =  area,</span></span>
<span id="cb385-4763"><a href="#cb385-4763" aria-hidden="true" tabindex="-1"></a><span class="in">  user = 'cdc26d1b-d9e9-4552-9b32-e2b974562cee',</span></span>
<span id="cb385-4764"><a href="#cb385-4764" aria-hidden="true" tabindex="-1"></a><span class="in">  key = '1aee996e-75a8-48d2-b7e7-fe4aac7fc8df',</span></span>
<span id="cb385-4765"><a href="#cb385-4765" aria-hidden="true" tabindex="-1"></a><span class="in">  model = 'default',</span></span>
<span id="cb385-4766"><a href="#cb385-4766" aria-hidden="true" tabindex="-1"></a><span class="in">  frequency = 'monthly',</span></span>
<span id="cb385-4767"><a href="#cb385-4767" aria-hidden="true" tabindex="-1"></a><span class="in">  variable = c('Tmin', 'Tmax'),</span></span>
<span id="cb385-4768"><a href="#cb385-4768" aria-hidden="true" tabindex="-1"></a><span class="in">  year_start = 2015,</span></span>
<span id="cb385-4769"><a href="#cb385-4769" aria-hidden="true" tabindex="-1"></a><span class="in">  year_end = 2100)</span></span>
<span id="cb385-4770"><a href="#cb385-4770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4771"><a href="#cb385-4771" aria-hidden="true" tabindex="-1"></a><span class="in"># This function took a while to run, and it generated a bunch of files in a </span></span>
<span id="cb385-4772"><a href="#cb385-4772" aria-hidden="true" tabindex="-1"></a><span class="in"># subfolder of our working directory- change the name of this folder </span></span>
<span id="cb385-4773"><a href="#cb385-4773" aria-hidden="true" tabindex="-1"></a><span class="in"># (using the path_download parameter),otherwise the data should be stored in </span></span>
<span id="cb385-4774"><a href="#cb385-4774" aria-hidden="true" tabindex="-1"></a><span class="in"># the cmip6_downloaded folder. </span></span>
<span id="cb385-4775"><a href="#cb385-4775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4776"><a href="#cb385-4776" aria-hidden="true" tabindex="-1"></a><span class="in"># We also received a message about Dropped models. These are climate models, for</span></span>
<span id="cb385-4777"><a href="#cb385-4777" aria-hidden="true" tabindex="-1"></a><span class="in"># which the database contained no data with the specifications we provided. </span></span>
<span id="cb385-4778"><a href="#cb385-4778" aria-hidden="true" tabindex="-1"></a><span class="in"># For these models, the function attempted to download data but didn’t find </span></span>
<span id="cb385-4779"><a href="#cb385-4779" aria-hidden="true" tabindex="-1"></a><span class="in"># anything in the database. These models are then blacklisted, i.e. the function</span></span>
<span id="cb385-4780"><a href="#cb385-4780" aria-hidden="true" tabindex="-1"></a><span class="in"># leaves a note in the download folder to prevent the function from trying to </span></span>
<span id="cb385-4781"><a href="#cb385-4781" aria-hidden="true" tabindex="-1"></a><span class="in"># download these data again.</span></span>
<span id="cb385-4782"><a href="#cb385-4782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4783"><a href="#cb385-4783" aria-hidden="true" tabindex="-1"></a><span class="in"># Assuming that this worked well, we should now expand the download to </span></span>
<span id="cb385-4784"><a href="#cb385-4784" aria-hidden="true" tabindex="-1"></a><span class="in"># additional SSP scenarios. We can simply provide a vector of such scenarios as </span></span>
<span id="cb385-4785"><a href="#cb385-4785" aria-hidden="true" tabindex="-1"></a><span class="in"># the scenarios parameter. </span></span>
<span id="cb385-4786"><a href="#cb385-4786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4787"><a href="#cb385-4787" aria-hidden="true" tabindex="-1"></a><span class="in"># I’ll use the scenarios SSP126, SSP245, SSP370 and SSP585. These are the </span></span>
<span id="cb385-4788"><a href="#cb385-4788" aria-hidden="true" tabindex="-1"></a><span class="in"># standard scenarios of CMIP6 (and currently the only ones that this function </span></span>
<span id="cb385-4789"><a href="#cb385-4789" aria-hidden="true" tabindex="-1"></a><span class="in"># can download). </span></span>
<span id="cb385-4790"><a href="#cb385-4790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4791"><a href="#cb385-4791" aria-hidden="true" tabindex="-1"></a><span class="in"># Note that we can add “ssp126” here again, because the function is able to </span></span>
<span id="cb385-4792"><a href="#cb385-4792" aria-hidden="true" tabindex="-1"></a><span class="in"># detect whether the respective data have already been downloaded. </span></span>
<span id="cb385-4793"><a href="#cb385-4793" aria-hidden="true" tabindex="-1"></a><span class="in"># It automatically skips all files that are already present.</span></span>
<span id="cb385-4794"><a href="#cb385-4794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4795"><a href="#cb385-4795" aria-hidden="true" tabindex="-1"></a><span class="in"># Download additional SSP scenarios</span></span>
<span id="cb385-4796"><a href="#cb385-4796" aria-hidden="true" tabindex="-1"></a><span class="in">download_cmip6_ecmwfr(</span></span>
<span id="cb385-4797"><a href="#cb385-4797" aria-hidden="true" tabindex="-1"></a><span class="in">  scenarios = c("ssp126", "ssp245", "ssp370", "ssp585"),</span></span>
<span id="cb385-4798"><a href="#cb385-4798" aria-hidden="true" tabindex="-1"></a><span class="in">  area = area,</span></span>
<span id="cb385-4799"><a href="#cb385-4799" aria-hidden="true" tabindex="-1"></a><span class="in">  user = 'cdc26d1b-d9e9-4552-9b32-e2b974562cee',</span></span>
<span id="cb385-4800"><a href="#cb385-4800" aria-hidden="true" tabindex="-1"></a><span class="in">  key = '1aee996e-75a8-48d2-b7e7-fe4aac7fc8df',</span></span>
<span id="cb385-4801"><a href="#cb385-4801" aria-hidden="true" tabindex="-1"></a><span class="in">  model = 'default',</span></span>
<span id="cb385-4802"><a href="#cb385-4802" aria-hidden="true" tabindex="-1"></a><span class="in">  frequency = 'monthly',</span></span>
<span id="cb385-4803"><a href="#cb385-4803" aria-hidden="true" tabindex="-1"></a><span class="in">  variable = c('Tmin', 'Tmax'),</span></span>
<span id="cb385-4804"><a href="#cb385-4804" aria-hidden="true" tabindex="-1"></a><span class="in">  year_start = 2015, </span></span>
<span id="cb385-4805"><a href="#cb385-4805" aria-hidden="true" tabindex="-1"></a><span class="in">  year_end = 2100)</span></span>
<span id="cb385-4806"><a href="#cb385-4806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4807"><a href="#cb385-4807" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-4808"><a href="#cb385-4808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4809"><a href="#cb385-4809" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4810"><a href="#cb385-4810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4811"><a href="#cb385-4811" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;16.1.2&lt;/span&gt;&amp;nbsp; Generating change scenarios</span></span>
<span id="cb385-4812"><a href="#cb385-4812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4813"><a href="#cb385-4813" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-4814"><a href="#cb385-4814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4815"><a href="#cb385-4815" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We should now have downloaded a lot of data to a folder called <span class="in">`cmip6_downloaded/52_6_50_8`</span>, but we still need more.</span>
<span id="cb385-4816"><a href="#cb385-4816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4817"><a href="#cb385-4817" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>What we have now are future scenarios. The simulated records start in 2015, and earlier data aren’t available for the SSP scenarios.</span>
<span id="cb385-4818"><a href="#cb385-4818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4819"><a href="#cb385-4819" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>These data come out of very coarse-resolution climate models. The pixels of such models often include entire landscapes, with rivers and mountains, coastal areas and inland regions. </span>
<span id="cb385-4820"><a href="#cb385-4820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4821"><a href="#cb385-4821" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The values we downloaded represent an average of all of these, so it may be quite unlikely that they are a good approximation of the temperature conditions of our place of interest.</span>
<span id="cb385-4822"><a href="#cb385-4822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4823"><a href="#cb385-4823" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The coarse resolution is certainly a problem, and for rainfall patterns or hydrological applications, landscape-scale features may be so important that we may have to wait for someone to apply spatial downscaling to these coarse datasets. </span>
<span id="cb385-4824"><a href="#cb385-4824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4825"><a href="#cb385-4825" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In (dynamic) downscaling, the coarse GCM outputs are inserted into a finer-scale climate model that actually represents all the crucial landscape features. After such downscaling, we may have a chance to get accurate information on rainfall patterns etc. </span>
<span id="cb385-4826"><a href="#cb385-4826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4827"><a href="#cb385-4827" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Fortunately, we’re really only interested in temperature here. While landscape features also influence temperature dynamics, the effect isn’t nearly as dramatic as for precipitation.</span>
<span id="cb385-4828"><a href="#cb385-4828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4829"><a href="#cb385-4829" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Still, we should not use temperature data from our GCM projections directly, but the temperature **change** projected by these models is still quite useful. If, for instance, a GCM projects January temperatures that are 2°C warmer than today for some future scenario, then we could add these 2°C to what we observe today (ideally as a scenario for a weather generator).</span>
<span id="cb385-4830"><a href="#cb385-4830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4831"><a href="#cb385-4831" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When we talk about climate change, we often refer to warming by a certain number of degrees, e.g. in the prerogative to limit warming to 1.5°C that the international community agreed on in the <span class="co">[</span><span class="ot">Paris Agreement</span><span class="co">](https://unfccc.int/process-and-meetings/the-paris-agreement)</span>, but such talk only makes sense if we know the baseline that this change is relative to<span class="dv">&amp;mdash;</span> **today**.</span>
<span id="cb385-4832"><a href="#cb385-4832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4833"><a href="#cb385-4833" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Quite obviously, in a warming world, a 2°C change on top of conditions in, say, 1850 takes us to a cooler scenario than if we apply the same warming to today’s much warmer climate. We therefore should be very much aware of the reference conditions that apply to our warming scenario. </span>
<span id="cb385-4834"><a href="#cb385-4834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4835"><a href="#cb385-4835" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In the <span class="in">`chillR`</span> workflow for the CMIP6 data, we can control this to some extent, but we’ve also chosen a useful default for you: the 29-year period from 1986 to 2014, because </span>
<span id="cb385-4836"><a href="#cb385-4836" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>data for this interval are available for the historical model runs in the Copernicus database, </span>
<span id="cb385-4837"><a href="#cb385-4837" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>the median year of this interval is a nice round number (2000), and</span>
<span id="cb385-4838"><a href="#cb385-4838" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>29 years is pretty close to the 30 years that climate scientists generally recommend as the basis for a robust climatology.</span>
<span id="cb385-4839"><a href="#cb385-4839" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-4840"><a href="#cb385-4840" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-4841"><a href="#cb385-4841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4842"><a href="#cb385-4842" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To create change scenarios from our climate data, we have to subtract conditions during the baseline period from the future projections. For this, it is important that the baseline and the future data are generated with the same tool, i.e. the same climate model. </span>
<span id="cb385-4843"><a href="#cb385-4843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4844"><a href="#cb385-4844" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Fortunately, for every climate model contained in the CMIP6 ensemble, we can also retrieve historical information from the Copernicus database. We can get this done with the <span class="in">`download_baseline_cmip6_ecmwfr`</span> function:</span>
<span id="cb385-4845"><a href="#cb385-4845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4846"><a href="#cb385-4846" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 16.1.2, eval=FALSE}</span></span>
<span id="cb385-4847"><a href="#cb385-4847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4848"><a href="#cb385-4848" aria-hidden="true" tabindex="-1"></a><span class="in"># Download historical information (baseline data for 29 years period)</span></span>
<span id="cb385-4849"><a href="#cb385-4849" aria-hidden="true" tabindex="-1"></a><span class="in">download_baseline_cmip6_ecmwfr(</span></span>
<span id="cb385-4850"><a href="#cb385-4850" aria-hidden="true" tabindex="-1"></a><span class="in">  area = area,</span></span>
<span id="cb385-4851"><a href="#cb385-4851" aria-hidden="true" tabindex="-1"></a><span class="in">  key = '1aee996e-75a8-48d2-b7e7-fe4aac7fc8df',</span></span>
<span id="cb385-4852"><a href="#cb385-4852" aria-hidden="true" tabindex="-1"></a><span class="in">  model = 'match_downloaded',</span></span>
<span id="cb385-4853"><a href="#cb385-4853" aria-hidden="true" tabindex="-1"></a><span class="in">  frequency = 'monthly',</span></span>
<span id="cb385-4854"><a href="#cb385-4854" aria-hidden="true" tabindex="-1"></a><span class="in">  variable = c('Tmin', 'Tmax'),</span></span>
<span id="cb385-4855"><a href="#cb385-4855" aria-hidden="true" tabindex="-1"></a><span class="in">  year_start = 1986,</span></span>
<span id="cb385-4856"><a href="#cb385-4856" aria-hidden="true" tabindex="-1"></a><span class="in">  year_end = 2014,</span></span>
<span id="cb385-4857"><a href="#cb385-4857" aria-hidden="true" tabindex="-1"></a><span class="in">  month = 1:12) # we are using average of the years over the period</span></span>
<span id="cb385-4858"><a href="#cb385-4858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4859"><a href="#cb385-4859" aria-hidden="true" tabindex="-1"></a><span class="in"># Note that if we specify `models = match_downloaded` here, the function will </span></span>
<span id="cb385-4860"><a href="#cb385-4860" aria-hidden="true" tabindex="-1"></a><span class="in"># automatically look into the download folder, determine what models were used </span></span>
<span id="cb385-4861"><a href="#cb385-4861" aria-hidden="true" tabindex="-1"></a><span class="in"># and download all respective baseline data.</span></span>
<span id="cb385-4862"><a href="#cb385-4862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4863"><a href="#cb385-4863" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-4864"><a href="#cb385-4864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4865"><a href="#cb385-4865" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4866"><a href="#cb385-4866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4867"><a href="#cb385-4867" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;16.1.3&lt;/span&gt;&amp;nbsp; Extracting data from the grids</span></span>
<span id="cb385-4868"><a href="#cb385-4868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4869"><a href="#cb385-4869" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-4870"><a href="#cb385-4870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4871"><a href="#cb385-4871" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>These data are still gridded, so we have to extract the data for the point of interest.</span>
<span id="cb385-4872"><a href="#cb385-4872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4873"><a href="#cb385-4873" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To do this, we’ll create a small <span class="in">`data.frame`</span> that contains the station name and the coordinates for Bonn. </span>
<span id="cb385-4874"><a href="#cb385-4874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4875"><a href="#cb385-4875" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We could also add more station locations to this <span class="in">`data.frame`</span> but this lesson I’m only interested in data for Bonn. </span>
<span id="cb385-4876"><a href="#cb385-4876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4877"><a href="#cb385-4877" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We’ll then use the <span class="in">`extract_cmip6_data`</span> function to extract the point location data.</span>
<span id="cb385-4878"><a href="#cb385-4878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4879"><a href="#cb385-4879" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 16.1.3a}</span></span>
<span id="cb385-4880"><a href="#cb385-4880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4881"><a href="#cb385-4881" aria-hidden="true" tabindex="-1"></a><span class="in"># Create data.frame for location "Bonn"</span></span>
<span id="cb385-4882"><a href="#cb385-4882" aria-hidden="true" tabindex="-1"></a><span class="in">station &lt;- data.frame(</span></span>
<span id="cb385-4883"><a href="#cb385-4883" aria-hidden="true" tabindex="-1"></a><span class="in">  station_name = c("Bonn"),</span></span>
<span id="cb385-4884"><a href="#cb385-4884" aria-hidden="true" tabindex="-1"></a><span class="in">  longitude = c(7.1),</span></span>
<span id="cb385-4885"><a href="#cb385-4885" aria-hidden="true" tabindex="-1"></a><span class="in">  latitude = c(50.8))</span></span>
<span id="cb385-4886"><a href="#cb385-4886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4887"><a href="#cb385-4887" aria-hidden="true" tabindex="-1"></a><span class="in"># Extract point location data for Bonn</span></span>
<span id="cb385-4888"><a href="#cb385-4888" aria-hidden="true" tabindex="-1"></a><span class="in">extracted &lt;- extract_cmip6_data(stations = station,</span></span>
<span id="cb385-4889"><a href="#cb385-4889" aria-hidden="true" tabindex="-1"></a><span class="in">                                download_path = "data/Bonn/cmip6_downloaded")</span></span>
<span id="cb385-4890"><a href="#cb385-4890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4891"><a href="#cb385-4891" aria-hidden="true" tabindex="-1"></a><span class="in"># Let’s look at some of the data for one of the climate models.</span></span>
<span id="cb385-4892"><a href="#cb385-4892" aria-hidden="true" tabindex="-1"></a><span class="in">kable(head(extracted$`ssp126_AWI-CM-1-1-MR`)) %&gt;%</span></span>
<span id="cb385-4893"><a href="#cb385-4893" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-4894"><a href="#cb385-4894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4895"><a href="#cb385-4895" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-4896"><a href="#cb385-4896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4897"><a href="#cb385-4897" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4898"><a href="#cb385-4898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4899"><a href="#cb385-4899" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Since we have stored the baseline data in the same folder, we can now use a very compact call to generate change scenarios for all the climate projections in the folder.</span>
<span id="cb385-4900"><a href="#cb385-4900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4901"><a href="#cb385-4901" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 16.1.3b}</span></span>
<span id="cb385-4902"><a href="#cb385-4902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4903"><a href="#cb385-4903" aria-hidden="true" tabindex="-1"></a><span class="in">change_scenarios &lt;-gen_rel_change_scenario(extracted, </span></span>
<span id="cb385-4904"><a href="#cb385-4904" aria-hidden="true" tabindex="-1"></a><span class="in">                                            scenarios = c(2050, 2085), </span></span>
<span id="cb385-4905"><a href="#cb385-4905" aria-hidden="true" tabindex="-1"></a><span class="in">                                            reference_period = c(1986:2014),</span></span>
<span id="cb385-4906"><a href="#cb385-4906" aria-hidden="true" tabindex="-1"></a><span class="in">                                            future_window_width = 30)</span></span>
<span id="cb385-4907"><a href="#cb385-4907" aria-hidden="true" tabindex="-1"></a><span class="in">kable(head(change_scenarios)) %&gt;%</span></span>
<span id="cb385-4908"><a href="#cb385-4908" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-4909"><a href="#cb385-4909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4910"><a href="#cb385-4910" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-4911"><a href="#cb385-4911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4912"><a href="#cb385-4912" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4913"><a href="#cb385-4913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4914"><a href="#cb385-4914" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>As you can see, all the data are stored in one long data.frame. This is a format that we can easily save as a <span class="in">`csv`</span> file. </span>
<span id="cb385-4915"><a href="#cb385-4915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4916"><a href="#cb385-4916" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We can’t directly use this with our weather generator, but fortunately, <span class="in">`chillR`</span> has a conversion function called <span class="in">`convert_scen_information`</span> that can extract the relevant information and produce scenarios that are compatible with the <span class="in">`temperature_generation`</span> function.</span>
<span id="cb385-4917"><a href="#cb385-4917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4918"><a href="#cb385-4918" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 16.1.3c}</span></span>
<span id="cb385-4919"><a href="#cb385-4919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4920"><a href="#cb385-4920" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(change_scenarios, "data/Bonn/all_change_scenarios.csv", </span></span>
<span id="cb385-4921"><a href="#cb385-4921" aria-hidden="true" tabindex="-1"></a><span class="in">          row.names = FALSE)</span></span>
<span id="cb385-4922"><a href="#cb385-4922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4923"><a href="#cb385-4923" aria-hidden="true" tabindex="-1"></a><span class="in">change_scenarios &lt;- read.csv("data/Bonn/all_change_scenarios.csv")</span></span>
<span id="cb385-4924"><a href="#cb385-4924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4925"><a href="#cb385-4925" aria-hidden="true" tabindex="-1"></a><span class="in">scen_list &lt;- convert_scen_information(change_scenarios)</span></span>
<span id="cb385-4926"><a href="#cb385-4926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4927"><a href="#cb385-4927" aria-hidden="true" tabindex="-1"></a><span class="in"># Let’s look at one of the elements in the scenario lists.</span></span>
<span id="cb385-4928"><a href="#cb385-4928" aria-hidden="true" tabindex="-1"></a><span class="in">scen_list$Bonn$ssp126$`ACCESS-CM2`$'2050'</span></span>
<span id="cb385-4929"><a href="#cb385-4929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4930"><a href="#cb385-4930" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-4931"><a href="#cb385-4931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4932"><a href="#cb385-4932" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4933"><a href="#cb385-4933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4934"><a href="#cb385-4934" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>As you see, this scenario contains changes for the mean daily minimum and mean daily maximum temperature of every month, as well as several pieces of information that define the scenario:</span>
<span id="cb385-4935"><a href="#cb385-4935" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`scenario`</span> specifies the SSP scenario, </span>
<span id="cb385-4936"><a href="#cb385-4936" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`scenario_type`</span> says that this is a relative scenario, and </span>
<span id="cb385-4937"><a href="#cb385-4937" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`labels`</span> contains the name of the GCM. </span>
<span id="cb385-4938"><a href="#cb385-4938" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-4939"><a href="#cb385-4939" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-4940"><a href="#cb385-4940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4941"><a href="#cb385-4941" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Then we have four attributes that contain years. <span class="in">`start_year`</span>, <span class="in">`end_year`</span> and <span class="in">`scenario_year`</span> describe the time slice that this scenario is for. </span>
<span id="cb385-4942"><a href="#cb385-4942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4943"><a href="#cb385-4943" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We see that this corresponds to a 31-year window (2035-2065), with the median of this range (2050) serving as the <span class="in">`scenario_year`</span>, i.e. the year that this scenario should be considered most typical for. </span>
<span id="cb385-4944"><a href="#cb385-4944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4945"><a href="#cb385-4945" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The final parameter, <span class="in">`reference_year`</span>, is also quite important. This identifies the year that the specified change is relative to, i.e. the temperature changes given in this scenario describe the warming relative to conditions in 2000.</span>
<span id="cb385-4946"><a href="#cb385-4946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4947"><a href="#cb385-4947" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We can use the same convert_scen_information function to convert this list back to the data.frame format.</span>
<span id="cb385-4948"><a href="#cb385-4948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4949"><a href="#cb385-4949" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 16.1.3d}</span></span>
<span id="cb385-4950"><a href="#cb385-4950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4951"><a href="#cb385-4951" aria-hidden="true" tabindex="-1"></a><span class="in">scen_frame &lt;- convert_scen_information(scen_list)</span></span>
<span id="cb385-4952"><a href="#cb385-4952" aria-hidden="true" tabindex="-1"></a><span class="in">kable(scen_frame[1:10, ],</span></span>
<span id="cb385-4953"><a href="#cb385-4953" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "First ten row in data.frame format of the converted data </span></span>
<span id="cb385-4954"><a href="#cb385-4954" aria-hidden="true" tabindex="-1"></a><span class="in">      suitable for temperature_generation function") %&gt;%</span></span>
<span id="cb385-4955"><a href="#cb385-4955" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-4956"><a href="#cb385-4956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4957"><a href="#cb385-4957" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-4958"><a href="#cb385-4958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4959"><a href="#cb385-4959" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-4960"><a href="#cb385-4960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4961"><a href="#cb385-4961" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;16.1.4&lt;/span&gt;&amp;nbsp; Baseline adjustment</span></span>
<span id="cb385-4962"><a href="#cb385-4962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4963"><a href="#cb385-4963" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-4964"><a href="#cb385-4964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4965"><a href="#cb385-4965" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We want to produce scenarios for the future, but we also want to use the observed data from Bonn to inform the weather generator and to ensure that we actually simulate temperatures for Bonn rather than the average conditions of some GCM pixel.</span>
<span id="cb385-4966"><a href="#cb385-4966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4967"><a href="#cb385-4967" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In principle, the weather generator can do this, so let’s first try with one of the scenarios.</span>
<span id="cb385-4968"><a href="#cb385-4968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4969"><a href="#cb385-4969" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 16.1.4a}</span></span>
<span id="cb385-4970"><a href="#cb385-4970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4971"><a href="#cb385-4971" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_temps&lt;-read_tab("data/Bonn/Bonn_temps.csv")</span></span>
<span id="cb385-4972"><a href="#cb385-4972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4973"><a href="#cb385-4973" aria-hidden="true" tabindex="-1"></a><span class="in"># temperature_generation(Bonn_temps, </span></span>
<span id="cb385-4974"><a href="#cb385-4974" aria-hidden="true" tabindex="-1"></a><span class="in">#                        years = c(1973, 2019),</span></span>
<span id="cb385-4975"><a href="#cb385-4975" aria-hidden="true" tabindex="-1"></a><span class="in">#                        sim_years = c(2001, 2100),</span></span>
<span id="cb385-4976"><a href="#cb385-4976" aria-hidden="true" tabindex="-1"></a><span class="in">#                        scen_list$Bonn$ssp126$`ACCESS-CM2`)</span></span>
<span id="cb385-4977"><a href="#cb385-4977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4978"><a href="#cb385-4978" aria-hidden="true" tabindex="-1"></a><span class="in"># Error: weather data used for calibration not valid as a baseline for this </span></span>
<span id="cb385-4979"><a href="#cb385-4979" aria-hidden="true" tabindex="-1"></a><span class="in"># scenario the reference year of the scenario must correspond to the median year </span></span>
<span id="cb385-4980"><a href="#cb385-4980" aria-hidden="true" tabindex="-1"></a><span class="in"># of the weather record (specified by c(year_min,year_max). At the moment, </span></span>
<span id="cb385-4981"><a href="#cb385-4981" aria-hidden="true" tabindex="-1"></a><span class="in"># this is 1996 but it should be 2000, so that it works for this scenario</span></span>
<span id="cb385-4982"><a href="#cb385-4982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4983"><a href="#cb385-4983" aria-hidden="true" tabindex="-1"></a><span class="in"># This didn’t work! Instead, we got an error message alerting us that the </span></span>
<span id="cb385-4984"><a href="#cb385-4984" aria-hidden="true" tabindex="-1"></a><span class="in"># reference year of the scenario must correspond to the reference year of </span></span>
<span id="cb385-4985"><a href="#cb385-4985" aria-hidden="true" tabindex="-1"></a><span class="in"># the future scenario. </span></span>
<span id="cb385-4986"><a href="#cb385-4986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4987"><a href="#cb385-4987" aria-hidden="true" tabindex="-1"></a><span class="in"># The reference year of the weather station data is 1996, the median year of </span></span>
<span id="cb385-4988"><a href="#cb385-4988" aria-hidden="true" tabindex="-1"></a><span class="in"># the record, which runs from 1973 to 2019. </span></span>
<span id="cb385-4989"><a href="#cb385-4989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4990"><a href="#cb385-4990" aria-hidden="true" tabindex="-1"></a><span class="in"># We could decide now to use fewer data. If we only use observations from 1981, </span></span>
<span id="cb385-4991"><a href="#cb385-4991" aria-hidden="true" tabindex="-1"></a><span class="in"># the median year of the observations becomes 2000 and it matches the reference </span></span>
<span id="cb385-4992"><a href="#cb385-4992" aria-hidden="true" tabindex="-1"></a><span class="in"># year of the future projections. </span></span>
<span id="cb385-4993"><a href="#cb385-4993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4994"><a href="#cb385-4994" aria-hidden="true" tabindex="-1"></a><span class="in"># But maybe we really want to use the old data as well. For that case, chillR </span></span>
<span id="cb385-4995"><a href="#cb385-4995" aria-hidden="true" tabindex="-1"></a><span class="in"># offers a tool to adjust the reference year based on an analysis of the </span></span>
<span id="cb385-4996"><a href="#cb385-4996" aria-hidden="true" tabindex="-1"></a><span class="in"># temperature trends within the observed dataset.</span></span>
<span id="cb385-4997"><a href="#cb385-4997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-4998"><a href="#cb385-4998" aria-hidden="true" tabindex="-1"></a><span class="in"># If we want to adjust the baseline of the observed weather, we can conduct a </span></span>
<span id="cb385-4999"><a href="#cb385-4999" aria-hidden="true" tabindex="-1"></a><span class="in"># baseline adjustment. For this, we first need to find out how much warming </span></span>
<span id="cb385-5000"><a href="#cb385-5000" aria-hidden="true" tabindex="-1"></a><span class="in"># (or cooling) has occurred in Bonn between 1996 and 2000. </span></span>
<span id="cb385-5001"><a href="#cb385-5001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5002"><a href="#cb385-5002" aria-hidden="true" tabindex="-1"></a><span class="in"># To do this we first determine typical temperature conditions in both years </span></span>
<span id="cb385-5003"><a href="#cb385-5003" aria-hidden="true" tabindex="-1"></a><span class="in"># using the temperature_scenario_from_records function.</span></span>
<span id="cb385-5004"><a href="#cb385-5004" aria-hidden="true" tabindex="-1"></a><span class="in">temps_1996 &lt;- temperature_scenario_from_records(Bonn_temps,</span></span>
<span id="cb385-5005"><a href="#cb385-5005" aria-hidden="true" tabindex="-1"></a><span class="in">                                                1996)</span></span>
<span id="cb385-5006"><a href="#cb385-5006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5007"><a href="#cb385-5007" aria-hidden="true" tabindex="-1"></a><span class="in">temps_2000 &lt;- temperature_scenario_from_records(Bonn_temps,</span></span>
<span id="cb385-5008"><a href="#cb385-5008" aria-hidden="true" tabindex="-1"></a><span class="in">                                                2000)</span></span>
<span id="cb385-5009"><a href="#cb385-5009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5010"><a href="#cb385-5010" aria-hidden="true" tabindex="-1"></a><span class="in">temps_1996</span></span>
<span id="cb385-5011"><a href="#cb385-5011" aria-hidden="true" tabindex="-1"></a><span class="in">temps_2000</span></span>
<span id="cb385-5012"><a href="#cb385-5012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5013"><a href="#cb385-5013" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-5014"><a href="#cb385-5014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5015"><a href="#cb385-5015" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-5016"><a href="#cb385-5016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5017"><a href="#cb385-5017" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>These are both absolute temperature scenarios, i.e. they describe typical conditions in 1996 and 2000. </span>
<span id="cb385-5018"><a href="#cb385-5018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5019"><a href="#cb385-5019" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>From these, we can now compute a relative change scenario that describes the changes that occurred over this period with the <span class="in">`temperature_scenario_baseline_adjustment`</span> function.</span>
<span id="cb385-5020"><a href="#cb385-5020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5021"><a href="#cb385-5021" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 16.1.4b}</span></span>
<span id="cb385-5022"><a href="#cb385-5022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5023"><a href="#cb385-5023" aria-hidden="true" tabindex="-1"></a><span class="in">base &lt;- temperature_scenario_baseline_adjustment(temps_1996,</span></span>
<span id="cb385-5024"><a href="#cb385-5024" aria-hidden="true" tabindex="-1"></a><span class="in">                                                 temps_2000)</span></span>
<span id="cb385-5025"><a href="#cb385-5025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5026"><a href="#cb385-5026" aria-hidden="true" tabindex="-1"></a><span class="in">base</span></span>
<span id="cb385-5027"><a href="#cb385-5027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5028"><a href="#cb385-5028" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-5029"><a href="#cb385-5029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5030"><a href="#cb385-5030" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-5031"><a href="#cb385-5031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5032"><a href="#cb385-5032" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We can now apply this baseline correction to our climate scenarios. </span>
<span id="cb385-5033"><a href="#cb385-5033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5034"><a href="#cb385-5034" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For now, this only works with an unstructured list of scenarios, so we’ll have to convert the scenarios again using the <span class="in">`give_structure = FALSE`</span> option.</span>
<span id="cb385-5035"><a href="#cb385-5035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5036"><a href="#cb385-5036" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Then, we can start the temperature generation process. Note that, since we have many scenarios, this can take hours.</span>
<span id="cb385-5037"><a href="#cb385-5037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5038"><a href="#cb385-5038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5039"><a href="#cb385-5039" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 16.1.4c, eval=FALSE}</span></span>
<span id="cb385-5040"><a href="#cb385-5040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5041"><a href="#cb385-5041" aria-hidden="true" tabindex="-1"></a><span class="in">scen_list &lt;- convert_scen_information(change_scenarios, </span></span>
<span id="cb385-5042"><a href="#cb385-5042" aria-hidden="true" tabindex="-1"></a><span class="in">                                      give_structure = FALSE)</span></span>
<span id="cb385-5043"><a href="#cb385-5043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5044"><a href="#cb385-5044" aria-hidden="true" tabindex="-1"></a><span class="in">adjusted_list &lt;- </span></span>
<span id="cb385-5045"><a href="#cb385-5045" aria-hidden="true" tabindex="-1"></a><span class="in">  temperature_scenario_baseline_adjustment(</span></span>
<span id="cb385-5046"><a href="#cb385-5046" aria-hidden="true" tabindex="-1"></a><span class="in">    base,</span></span>
<span id="cb385-5047"><a href="#cb385-5047" aria-hidden="true" tabindex="-1"></a><span class="in">    scen_list,</span></span>
<span id="cb385-5048"><a href="#cb385-5048" aria-hidden="true" tabindex="-1"></a><span class="in">    temperature_check_args =</span></span>
<span id="cb385-5049"><a href="#cb385-5049" aria-hidden="true" tabindex="-1"></a><span class="in">      list( scenario_check_thresholds = c(-5, 15)))</span></span>
<span id="cb385-5050"><a href="#cb385-5050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5051"><a href="#cb385-5051" aria-hidden="true" tabindex="-1"></a><span class="in">for(scen in 1:length(adjusted_list))</span></span>
<span id="cb385-5052"><a href="#cb385-5052" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb385-5053"><a href="#cb385-5053" aria-hidden="true" tabindex="-1"></a><span class="in">  if(!file.exists(paste0("data/Bonn/Bonn_future_climate/Bonn_future_",</span></span>
<span id="cb385-5054"><a href="#cb385-5054" aria-hidden="true" tabindex="-1"></a><span class="in">                       scen,"_",</span></span>
<span id="cb385-5055"><a href="#cb385-5055" aria-hidden="true" tabindex="-1"></a><span class="in">                       names(adjusted_list)[scen],".csv")) )</span></span>
<span id="cb385-5056"><a href="#cb385-5056" aria-hidden="true" tabindex="-1"></a><span class="in">  {temp_temp &lt;- temperature_generation(Bonn_temps,</span></span>
<span id="cb385-5057"><a href="#cb385-5057" aria-hidden="true" tabindex="-1"></a><span class="in">                                   years = c(1973, 2019),</span></span>
<span id="cb385-5058"><a href="#cb385-5058" aria-hidden="true" tabindex="-1"></a><span class="in">                                   sim_years = c(2001, 2100),</span></span>
<span id="cb385-5059"><a href="#cb385-5059" aria-hidden="true" tabindex="-1"></a><span class="in">                                   adjusted_list[scen],  </span></span>
<span id="cb385-5060"><a href="#cb385-5060" aria-hidden="true" tabindex="-1"></a><span class="in">                                   temperature_check_args = </span></span>
<span id="cb385-5061"><a href="#cb385-5061" aria-hidden="true" tabindex="-1"></a><span class="in">                                     list( scenario_check_thresholds = c(-5, 15)))</span></span>
<span id="cb385-5062"><a href="#cb385-5062" aria-hidden="true" tabindex="-1"></a><span class="in">  write.csv(temp_temp[[1]],paste0("data/Bonn/Bonn_future_climate/Bonn_future_",</span></span>
<span id="cb385-5063"><a href="#cb385-5063" aria-hidden="true" tabindex="-1"></a><span class="in">                                  scen,"_",names(adjusted_list)[scen],".csv"),</span></span>
<span id="cb385-5064"><a href="#cb385-5064" aria-hidden="true" tabindex="-1"></a><span class="in">                             row.names=FALSE)</span></span>
<span id="cb385-5065"><a href="#cb385-5065" aria-hidden="true" tabindex="-1"></a><span class="in">  print(paste("Processed object",scen,"of", length(adjusted_list)))</span></span>
<span id="cb385-5066"><a href="#cb385-5066" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb385-5067"><a href="#cb385-5067" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-5068"><a href="#cb385-5068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5069"><a href="#cb385-5069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5070"><a href="#cb385-5070" aria-hidden="true" tabindex="-1"></a><span class="in">## Temperature_generation function takes very long time and hard to know </span></span>
<span id="cb385-5071"><a href="#cb385-5071" aria-hidden="true" tabindex="-1"></a><span class="in">## if it is running or stuck already.</span></span>
<span id="cb385-5072"><a href="#cb385-5072" aria-hidden="true" tabindex="-1"></a><span class="in">## And you won't get results until the function is finished running, so you will</span></span>
<span id="cb385-5073"><a href="#cb385-5073" aria-hidden="true" tabindex="-1"></a><span class="in">## be left with nothing if computer crashes or you abadon it half-way through.</span></span>
<span id="cb385-5074"><a href="#cb385-5074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5075"><a href="#cb385-5075" aria-hidden="true" tabindex="-1"></a><span class="in">## So, better use the "loop" option as shown above- that processes one scenario</span></span>
<span id="cb385-5076"><a href="#cb385-5076" aria-hidden="true" tabindex="-1"></a><span class="in">## at a time, saving the result after each run. You can even check if certain </span></span>
<span id="cb385-5077"><a href="#cb385-5077" aria-hidden="true" tabindex="-1"></a><span class="in">## scenarios have already been processed and only work on the remaining ones. </span></span>
<span id="cb385-5078"><a href="#cb385-5078" aria-hidden="true" tabindex="-1"></a><span class="in">## And you can output status messages that allow you to track the progress.</span></span>
<span id="cb385-5079"><a href="#cb385-5079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5080"><a href="#cb385-5080" aria-hidden="true" tabindex="-1"></a><span class="in">## Option to use temperature-generation function</span></span>
<span id="cb385-5081"><a href="#cb385-5081" aria-hidden="true" tabindex="-1"></a><span class="in"># temps &lt;- temperature_generation(</span></span>
<span id="cb385-5082"><a href="#cb385-5082" aria-hidden="true" tabindex="-1"></a><span class="in">#   Bonn_temps, </span></span>
<span id="cb385-5083"><a href="#cb385-5083" aria-hidden="true" tabindex="-1"></a><span class="in">#   years = c(1973, 2019), </span></span>
<span id="cb385-5084"><a href="#cb385-5084" aria-hidden="true" tabindex="-1"></a><span class="in">#   sim_years = c(2001, 2100), </span></span>
<span id="cb385-5085"><a href="#cb385-5085" aria-hidden="true" tabindex="-1"></a><span class="in">#   adjusted_list,    </span></span>
<span id="cb385-5086"><a href="#cb385-5086" aria-hidden="true" tabindex="-1"></a><span class="in">#   temperature_check_args =</span></span>
<span id="cb385-5087"><a href="#cb385-5087" aria-hidden="true" tabindex="-1"></a><span class="in">#     list( scenario_check_thresholds = c(-5, 15)))</span></span>
<span id="cb385-5088"><a href="#cb385-5088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5089"><a href="#cb385-5089" aria-hidden="true" tabindex="-1"></a><span class="in"># save_temperature_scenarios(temps,</span></span>
<span id="cb385-5090"><a href="#cb385-5090" aria-hidden="true" tabindex="-1"></a><span class="in">#                            "data/future_climate",</span></span>
<span id="cb385-5091"><a href="#cb385-5091" aria-hidden="true" tabindex="-1"></a><span class="in">#                            "Bonn_futuretemps")</span></span>
<span id="cb385-5092"><a href="#cb385-5092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5093"><a href="#cb385-5093" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-5094"><a href="#cb385-5094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5095"><a href="#cb385-5095" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now we can calculate temperature responses based on these records by using the <span class="in">`tempResponse_daily_list`</span> function<span class="dv">&amp;mdash;</span> the Dynamic Model for chill accumulation, the GDH model for heat accumulation and a simple model to compute frost hours.</span>
<span id="cb385-5096"><a href="#cb385-5096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5097"><a href="#cb385-5097" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 16.1.4d, eval=FALSE}</span></span>
<span id="cb385-5098"><a href="#cb385-5098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5099"><a href="#cb385-5099" aria-hidden="true" tabindex="-1"></a><span class="in"># Make a simple model to compute frost hours</span></span>
<span id="cb385-5100"><a href="#cb385-5100" aria-hidden="true" tabindex="-1"></a><span class="in">frost_model &lt;- function(x)</span></span>
<span id="cb385-5101"><a href="#cb385-5101" aria-hidden="true" tabindex="-1"></a><span class="in">  step_model(x,</span></span>
<span id="cb385-5102"><a href="#cb385-5102" aria-hidden="true" tabindex="-1"></a><span class="in">             data.frame(</span></span>
<span id="cb385-5103"><a href="#cb385-5103" aria-hidden="true" tabindex="-1"></a><span class="in">               lower = c(-1000, 0),</span></span>
<span id="cb385-5104"><a href="#cb385-5104" aria-hidden="true" tabindex="-1"></a><span class="in">               upper = c(0, 1000),</span></span>
<span id="cb385-5105"><a href="#cb385-5105" aria-hidden="true" tabindex="-1"></a><span class="in">               weight = c(1, 0)))</span></span>
<span id="cb385-5106"><a href="#cb385-5106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5107"><a href="#cb385-5107" aria-hidden="true" tabindex="-1"></a><span class="in"># Save the models as list</span></span>
<span id="cb385-5108"><a href="#cb385-5108" aria-hidden="true" tabindex="-1"></a><span class="in">models &lt;- list(Chill_Portions = Dynamic_Model,</span></span>
<span id="cb385-5109"><a href="#cb385-5109" aria-hidden="true" tabindex="-1"></a><span class="in">               GDH = GDH,</span></span>
<span id="cb385-5110"><a href="#cb385-5110" aria-hidden="true" tabindex="-1"></a><span class="in">               Frost_H = frost_model)</span></span>
<span id="cb385-5111"><a href="#cb385-5111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5112"><a href="#cb385-5112" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate temperature responses for chill accumulation and save output</span></span>
<span id="cb385-5113"><a href="#cb385-5113" aria-hidden="true" tabindex="-1"></a><span class="in">chill_future_scenario_list &lt;- </span></span>
<span id="cb385-5114"><a href="#cb385-5114" aria-hidden="true" tabindex="-1"></a><span class="in">  tempResponse_daily_list(temps,</span></span>
<span id="cb385-5115"><a href="#cb385-5115" aria-hidden="true" tabindex="-1"></a><span class="in">                          latitude = 50.8,</span></span>
<span id="cb385-5116"><a href="#cb385-5116" aria-hidden="true" tabindex="-1"></a><span class="in">                          Start_JDay = 305,</span></span>
<span id="cb385-5117"><a href="#cb385-5117" aria-hidden="true" tabindex="-1"></a><span class="in">                          End_JDay = 59,</span></span>
<span id="cb385-5118"><a href="#cb385-5118" aria-hidden="true" tabindex="-1"></a><span class="in">                          models = models)</span></span>
<span id="cb385-5119"><a href="#cb385-5119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5120"><a href="#cb385-5120" aria-hidden="true" tabindex="-1"></a><span class="in"># Only select complete data</span></span>
<span id="cb385-5121"><a href="#cb385-5121" aria-hidden="true" tabindex="-1"></a><span class="in">chill_future_scenario_list &lt;- </span></span>
<span id="cb385-5122"><a href="#cb385-5122" aria-hidden="true" tabindex="-1"></a><span class="in">  lapply(chill_future_scenario_list,</span></span>
<span id="cb385-5123"><a href="#cb385-5123" aria-hidden="true" tabindex="-1"></a><span class="in">         function(x) x %&gt;%</span></span>
<span id="cb385-5124"><a href="#cb385-5124" aria-hidden="true" tabindex="-1"></a><span class="in">           filter(Perc_complete == 100))</span></span>
<span id="cb385-5125"><a href="#cb385-5125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5126"><a href="#cb385-5126" aria-hidden="true" tabindex="-1"></a><span class="in"># Save future chill accumulation for Bonn</span></span>
<span id="cb385-5127"><a href="#cb385-5127" aria-hidden="true" tabindex="-1"></a><span class="in">save_temperature_scenarios(chill_future_scenario_list,</span></span>
<span id="cb385-5128"><a href="#cb385-5128" aria-hidden="true" tabindex="-1"></a><span class="in">                           "data/Bonn/Bonn_future_climate",</span></span>
<span id="cb385-5129"><a href="#cb385-5129" aria-hidden="true" tabindex="-1"></a><span class="in">                           "Bonn_futurechill")</span></span>
<span id="cb385-5130"><a href="#cb385-5130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5131"><a href="#cb385-5131" aria-hidden="true" tabindex="-1"></a><span class="in"># simulate for the observed record</span></span>
<span id="cb385-5132"><a href="#cb385-5132" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_temps &lt;- read_tab("data/Bonn/Bonn_temps.csv")</span></span>
<span id="cb385-5133"><a href="#cb385-5133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5134"><a href="#cb385-5134" aria-hidden="true" tabindex="-1"></a><span class="in">observed_chill &lt;- tempResponse_daily_list(Bonn_temps,</span></span>
<span id="cb385-5135"><a href="#cb385-5135" aria-hidden="true" tabindex="-1"></a><span class="in">                                          latitude = 50.8,</span></span>
<span id="cb385-5136"><a href="#cb385-5136" aria-hidden="true" tabindex="-1"></a><span class="in">                                          Start_JDay = 305,</span></span>
<span id="cb385-5137"><a href="#cb385-5137" aria-hidden="true" tabindex="-1"></a><span class="in">                                          End_JDay = 59,</span></span>
<span id="cb385-5138"><a href="#cb385-5138" aria-hidden="true" tabindex="-1"></a><span class="in">                                          models = models)</span></span>
<span id="cb385-5139"><a href="#cb385-5139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5140"><a href="#cb385-5140" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(observed_chill, "data/Bonn/Bonn_observed_chill_305_59.csv")</span></span>
<span id="cb385-5141"><a href="#cb385-5141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5142"><a href="#cb385-5142" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-5143"><a href="#cb385-5143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5144"><a href="#cb385-5144" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In <span class="in">`chillR`</span>, the most convenient way to plot all the data is to produce climate scenarios with the <span class="in">`make_climate_scenario`</span> function. The plotting function then simply processes a list of such climate scenarios. </span>
<span id="cb385-5145"><a href="#cb385-5145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5146"><a href="#cb385-5146" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Let’s start with a historical scenario that contains both the distributions for historic years and the historically observed chill. </span>
<span id="cb385-5147"><a href="#cb385-5147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5148"><a href="#cb385-5148" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 16.1.4e}</span></span>
<span id="cb385-5149"><a href="#cb385-5149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5150"><a href="#cb385-5150" aria-hidden="true" tabindex="-1"></a><span class="in"># Load the historical data saved in Historic Temperature Scenarios lesson</span></span>
<span id="cb385-5151"><a href="#cb385-5151" aria-hidden="true" tabindex="-1"></a><span class="in">chill_hist_scenario_list&lt;-load_temperature_scenarios("data/Bonn",</span></span>
<span id="cb385-5152"><a href="#cb385-5152" aria-hidden="true" tabindex="-1"></a><span class="in">                                                     "Bonn_hist_chill_305_59")</span></span>
<span id="cb385-5153"><a href="#cb385-5153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5154"><a href="#cb385-5154" aria-hidden="true" tabindex="-1"></a><span class="in"># Load the observed chill data</span></span>
<span id="cb385-5155"><a href="#cb385-5155" aria-hidden="true" tabindex="-1"></a><span class="in">observed_chill &lt;- read_tab("data/Bonn/Bonn_observed_chill_305_59.csv")</span></span>
<span id="cb385-5156"><a href="#cb385-5156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5157"><a href="#cb385-5157" aria-hidden="true" tabindex="-1"></a><span class="in"># Produce climate scenarios</span></span>
<span id="cb385-5158"><a href="#cb385-5158" aria-hidden="true" tabindex="-1"></a><span class="in">chills &lt;- make_climate_scenario(</span></span>
<span id="cb385-5159"><a href="#cb385-5159" aria-hidden="true" tabindex="-1"></a><span class="in">  chill_hist_scenario_list,</span></span>
<span id="cb385-5160"><a href="#cb385-5160" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Historical",</span></span>
<span id="cb385-5161"><a href="#cb385-5161" aria-hidden="true" tabindex="-1"></a><span class="in">  historic_data = observed_chill,</span></span>
<span id="cb385-5162"><a href="#cb385-5162" aria-hidden="true" tabindex="-1"></a><span class="in">  time_series = TRUE)</span></span>
<span id="cb385-5163"><a href="#cb385-5163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5164"><a href="#cb385-5164" aria-hidden="true" tabindex="-1"></a><span class="in">plot_climate_scenarios(</span></span>
<span id="cb385-5165"><a href="#cb385-5165" aria-hidden="true" tabindex="-1"></a><span class="in">  climate_scenario_list = chills,</span></span>
<span id="cb385-5166"><a href="#cb385-5166" aria-hidden="true" tabindex="-1"></a><span class="in">  metric = "Chill_Portions",</span></span>
<span id="cb385-5167"><a href="#cb385-5167" aria-hidden="true" tabindex="-1"></a><span class="in">  metric_label = "Chill (Chill Portions)")</span></span>
<span id="cb385-5168"><a href="#cb385-5168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5169"><a href="#cb385-5169" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-5170"><a href="#cb385-5170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5171"><a href="#cb385-5171" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-5172"><a href="#cb385-5172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5173"><a href="#cb385-5173" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This function has two effects<span class="dv">&amp;mdash;</span> itt produced a plot and it returned a short list containing the message “time series labels”. </span>
<span id="cb385-5174"><a href="#cb385-5174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5175"><a href="#cb385-5175" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If we want to just store this information rather than immediately displaying it in our output, we can assign the plotting command to a new object (as in <span class="in">`info &lt;- plot_climate_scenarios(...)`</span>).  The function will then just produce its side effect, which is the plot itself.</span>
<span id="cb385-5176"><a href="#cb385-5176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5177"><a href="#cb385-5177" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now we run through the same process for all the future climate scenarios. For each one, we add the climate scenario to the <span class="in">`chills`</span> object (<span class="in">`make_climate_scenario`</span> has an argument <span class="in">`add_to`</span>, where we can specify that). </span>
<span id="cb385-5178"><a href="#cb385-5178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5179"><a href="#cb385-5179" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>As a preparatory step, we’ll have to identify the data that belong to specific combinations of SSP and Time.</span>
<span id="cb385-5180"><a href="#cb385-5180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5181"><a href="#cb385-5181" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 16.1.4f}</span></span>
<span id="cb385-5182"><a href="#cb385-5182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5183"><a href="#cb385-5183" aria-hidden="true" tabindex="-1"></a><span class="in"># Load data</span></span>
<span id="cb385-5184"><a href="#cb385-5184" aria-hidden="true" tabindex="-1"></a><span class="in">chill_future_scenario_list &lt;- load_temperature_scenarios("data/Bonn/Bonn_future_climate","Bonn_futurechill")</span></span>
<span id="cb385-5185"><a href="#cb385-5185" aria-hidden="true" tabindex="-1"></a><span class="in">chill_hist_scenario_list&lt;-load_temperature_scenarios(</span></span>
<span id="cb385-5186"><a href="#cb385-5186" aria-hidden="true" tabindex="-1"></a><span class="in">  "data/Bonn/Bonn_future_climate","Bonn_hist_chill_305_59")</span></span>
<span id="cb385-5187"><a href="#cb385-5187" aria-hidden="true" tabindex="-1"></a><span class="in">observed_chill &lt;- read_tab("data/Bonn/Bonn_observed_chill_305_59.csv")</span></span>
<span id="cb385-5188"><a href="#cb385-5188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5189"><a href="#cb385-5189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5190"><a href="#cb385-5190" aria-hidden="true" tabindex="-1"></a><span class="in">SSPs &lt;- c("ssp126", "ssp245", "ssp370", "ssp585")</span></span>
<span id="cb385-5191"><a href="#cb385-5191" aria-hidden="true" tabindex="-1"></a><span class="in">Times &lt;- c(2050, 2085)</span></span>
<span id="cb385-5192"><a href="#cb385-5192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5193"><a href="#cb385-5193" aria-hidden="true" tabindex="-1"></a><span class="in">list_ssp &lt;- </span></span>
<span id="cb385-5194"><a href="#cb385-5194" aria-hidden="true" tabindex="-1"></a><span class="in">  strsplit(names(chill_future_scenario_list), '\\.') %&gt;%</span></span>
<span id="cb385-5195"><a href="#cb385-5195" aria-hidden="true" tabindex="-1"></a><span class="in">  map(2) %&gt;%</span></span>
<span id="cb385-5196"><a href="#cb385-5196" aria-hidden="true" tabindex="-1"></a><span class="in">  unlist()</span></span>
<span id="cb385-5197"><a href="#cb385-5197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5198"><a href="#cb385-5198" aria-hidden="true" tabindex="-1"></a><span class="in">list_gcm &lt;-</span></span>
<span id="cb385-5199"><a href="#cb385-5199" aria-hidden="true" tabindex="-1"></a><span class="in">  strsplit(names(chill_future_scenario_list), '\\.') %&gt;%</span></span>
<span id="cb385-5200"><a href="#cb385-5200" aria-hidden="true" tabindex="-1"></a><span class="in">  map(3) %&gt;%</span></span>
<span id="cb385-5201"><a href="#cb385-5201" aria-hidden="true" tabindex="-1"></a><span class="in">  unlist()</span></span>
<span id="cb385-5202"><a href="#cb385-5202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5203"><a href="#cb385-5203" aria-hidden="true" tabindex="-1"></a><span class="in">list_time &lt;-</span></span>
<span id="cb385-5204"><a href="#cb385-5204" aria-hidden="true" tabindex="-1"></a><span class="in">  strsplit(names(chill_future_scenario_list), '\\.') %&gt;%</span></span>
<span id="cb385-5205"><a href="#cb385-5205" aria-hidden="true" tabindex="-1"></a><span class="in">  map(4) %&gt;%</span></span>
<span id="cb385-5206"><a href="#cb385-5206" aria-hidden="true" tabindex="-1"></a><span class="in">  unlist()</span></span>
<span id="cb385-5207"><a href="#cb385-5207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5208"><a href="#cb385-5208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5209"><a href="#cb385-5209" aria-hidden="true" tabindex="-1"></a><span class="in">for(SSP in SSPs)</span></span>
<span id="cb385-5210"><a href="#cb385-5210" aria-hidden="true" tabindex="-1"></a><span class="in">  for(Time in Times)</span></span>
<span id="cb385-5211"><a href="#cb385-5211" aria-hidden="true" tabindex="-1"></a><span class="in">    {</span></span>
<span id="cb385-5212"><a href="#cb385-5212" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb385-5213"><a href="#cb385-5213" aria-hidden="true" tabindex="-1"></a><span class="in">    # find all scenarios for the ssp and time</span></span>
<span id="cb385-5214"><a href="#cb385-5214" aria-hidden="true" tabindex="-1"></a><span class="in">    chill &lt;- chill_future_scenario_list[list_ssp == SSP &amp; list_time == Time]</span></span>
<span id="cb385-5215"><a href="#cb385-5215" aria-hidden="true" tabindex="-1"></a><span class="in">    names(chill) &lt;- list_gcm[list_ssp == SSP &amp; list_time == Time]</span></span>
<span id="cb385-5216"><a href="#cb385-5216" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp126") SSPcaption &lt;- "SSP1"</span></span>
<span id="cb385-5217"><a href="#cb385-5217" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp245") SSPcaption &lt;- "SSP2"</span></span>
<span id="cb385-5218"><a href="#cb385-5218" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp370") SSPcaption &lt;- "SSP3"</span></span>
<span id="cb385-5219"><a href="#cb385-5219" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp585") SSPcaption &lt;- "SSP5"    </span></span>
<span id="cb385-5220"><a href="#cb385-5220" aria-hidden="true" tabindex="-1"></a><span class="in">    if(Time == "2050") Time_caption &lt;- "2050"</span></span>
<span id="cb385-5221"><a href="#cb385-5221" aria-hidden="true" tabindex="-1"></a><span class="in">    if(Time == "2085") Time_caption &lt;- "2085"</span></span>
<span id="cb385-5222"><a href="#cb385-5222" aria-hidden="true" tabindex="-1"></a><span class="in">    chills &lt;- chill %&gt;% </span></span>
<span id="cb385-5223"><a href="#cb385-5223" aria-hidden="true" tabindex="-1"></a><span class="in">      make_climate_scenario(</span></span>
<span id="cb385-5224"><a href="#cb385-5224" aria-hidden="true" tabindex="-1"></a><span class="in">        caption = c(SSPcaption,</span></span>
<span id="cb385-5225"><a href="#cb385-5225" aria-hidden="true" tabindex="-1"></a><span class="in">                    Time_caption),</span></span>
<span id="cb385-5226"><a href="#cb385-5226" aria-hidden="true" tabindex="-1"></a><span class="in">        add_to = chills)</span></span>
<span id="cb385-5227"><a href="#cb385-5227" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-5228"><a href="#cb385-5228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5229"><a href="#cb385-5229" aria-hidden="true" tabindex="-1"></a><span class="in">## Now we have everything we need to plot the results of our climate change </span></span>
<span id="cb385-5230"><a href="#cb385-5230" aria-hidden="true" tabindex="-1"></a><span class="in">## analysis:</span></span>
<span id="cb385-5231"><a href="#cb385-5231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5232"><a href="#cb385-5232" aria-hidden="true" tabindex="-1"></a><span class="in"># For Chill Accumulation in Klein-Altendorf</span></span>
<span id="cb385-5233"><a href="#cb385-5233" aria-hidden="true" tabindex="-1"></a><span class="in">info_chill &lt;-</span></span>
<span id="cb385-5234"><a href="#cb385-5234" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_climate_scenarios(</span></span>
<span id="cb385-5235"><a href="#cb385-5235" aria-hidden="true" tabindex="-1"></a><span class="in">    climate_scenario_list = chills,</span></span>
<span id="cb385-5236"><a href="#cb385-5236" aria-hidden="true" tabindex="-1"></a><span class="in">    metric = "Chill_Portions",</span></span>
<span id="cb385-5237"><a href="#cb385-5237" aria-hidden="true" tabindex="-1"></a><span class="in">    metric_label = "Chill (Chill Portions)",</span></span>
<span id="cb385-5238"><a href="#cb385-5238" aria-hidden="true" tabindex="-1"></a><span class="in">    texcex = 1.5)</span></span>
<span id="cb385-5239"><a href="#cb385-5239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5240"><a href="#cb385-5240" aria-hidden="true" tabindex="-1"></a><span class="in"># For Heat Accumulation in Klein-Altendorf</span></span>
<span id="cb385-5241"><a href="#cb385-5241" aria-hidden="true" tabindex="-1"></a><span class="in">info_heat &lt;-</span></span>
<span id="cb385-5242"><a href="#cb385-5242" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_climate_scenarios(</span></span>
<span id="cb385-5243"><a href="#cb385-5243" aria-hidden="true" tabindex="-1"></a><span class="in">    climate_scenario_list = chills,</span></span>
<span id="cb385-5244"><a href="#cb385-5244" aria-hidden="true" tabindex="-1"></a><span class="in">    metric = "GDH",</span></span>
<span id="cb385-5245"><a href="#cb385-5245" aria-hidden="true" tabindex="-1"></a><span class="in">    metric_label = "Heat (Growing Degree Hours)",</span></span>
<span id="cb385-5246"><a href="#cb385-5246" aria-hidden="true" tabindex="-1"></a><span class="in">    texcex = 1.5)</span></span>
<span id="cb385-5247"><a href="#cb385-5247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5248"><a href="#cb385-5248" aria-hidden="true" tabindex="-1"></a><span class="in"># For Frost hours in Klein-Altendorf</span></span>
<span id="cb385-5249"><a href="#cb385-5249" aria-hidden="true" tabindex="-1"></a><span class="in">info_frost &lt;-</span></span>
<span id="cb385-5250"><a href="#cb385-5250" aria-hidden="true" tabindex="-1"></a><span class="in"> plot_climate_scenarios(</span></span>
<span id="cb385-5251"><a href="#cb385-5251" aria-hidden="true" tabindex="-1"></a><span class="in">   climate_scenario_list=chills,</span></span>
<span id="cb385-5252"><a href="#cb385-5252" aria-hidden="true" tabindex="-1"></a><span class="in">   metric="Frost_H",</span></span>
<span id="cb385-5253"><a href="#cb385-5253" aria-hidden="true" tabindex="-1"></a><span class="in">   metric_label="Frost hours",</span></span>
<span id="cb385-5254"><a href="#cb385-5254" aria-hidden="true" tabindex="-1"></a><span class="in">   texcex=1.5)</span></span>
<span id="cb385-5255"><a href="#cb385-5255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5256"><a href="#cb385-5256" aria-hidden="true" tabindex="-1"></a><span class="in"># As we saw earlier, the function didn’t only return the plot, but also some </span></span>
<span id="cb385-5257"><a href="#cb385-5257" aria-hidden="true" tabindex="-1"></a><span class="in"># supplementary information, which we stored in the `info...` objects in the </span></span>
<span id="cb385-5258"><a href="#cb385-5258" aria-hidden="true" tabindex="-1"></a><span class="in"># latest code chunk. </span></span>
<span id="cb385-5259"><a href="#cb385-5259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5260"><a href="#cb385-5260" aria-hidden="true" tabindex="-1"></a><span class="in"># If you inspect these objects, you’ll see that they contain the names of the </span></span>
<span id="cb385-5261"><a href="#cb385-5261" aria-hidden="true" tabindex="-1"></a><span class="in"># climate models for each of the subplots (in addition to the time series labels</span></span>
<span id="cb385-5262"><a href="#cb385-5262" aria-hidden="true" tabindex="-1"></a><span class="in"># for the historic plot). </span></span>
<span id="cb385-5263"><a href="#cb385-5263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5264"><a href="#cb385-5264" aria-hidden="true" tabindex="-1"></a><span class="in"># Since we used the same models each time, all information is listed multiple </span></span>
<span id="cb385-5265"><a href="#cb385-5265" aria-hidden="true" tabindex="-1"></a><span class="in"># times. Let’s only look at this once, and only for one of the plots:</span></span>
<span id="cb385-5266"><a href="#cb385-5266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5267"><a href="#cb385-5267" aria-hidden="true" tabindex="-1"></a><span class="in"># These labels aren’t provided directly in the plot, because they would take up </span></span>
<span id="cb385-5268"><a href="#cb385-5268" aria-hidden="true" tabindex="-1"></a><span class="in"># quite a bit of space. Instead, each model is specified by a number, with the</span></span>
<span id="cb385-5269"><a href="#cb385-5269" aria-hidden="true" tabindex="-1"></a><span class="in"># key to these number codes given in this table.</span></span>
<span id="cb385-5270"><a href="#cb385-5270" aria-hidden="true" tabindex="-1"></a><span class="in">info_chill[[2]]</span></span>
<span id="cb385-5271"><a href="#cb385-5271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5272"><a href="#cb385-5272" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-5273"><a href="#cb385-5273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5274"><a href="#cb385-5274" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-5275"><a href="#cb385-5275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5276"><a href="#cb385-5276" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;16.2&lt;/span&gt;&amp;nbsp; Exercises on generating CMIP6 temperature scenarios</span></span>
<span id="cb385-5277"><a href="#cb385-5277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5278"><a href="#cb385-5278" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-5279"><a href="#cb385-5279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5280"><a href="#cb385-5280" aria-hidden="true" tabindex="-1"></a>***1. Analyze the historic and future impact of climate change on two agroclimatic metrics of your choice, for the location you’ve chosen for your earlier analyses.***</span>
<span id="cb385-5281"><a href="#cb385-5281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5282"><a href="#cb385-5282" aria-hidden="true" tabindex="-1"></a>Codes for historic and future climatic scenarios for M<span class="dv">&amp;ouml;</span>ssigen:</span>
<span id="cb385-5283"><a href="#cb385-5283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5284"><a href="#cb385-5284" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 16.2a, eval=FALSE}</span></span>
<span id="cb385-5285"><a href="#cb385-5285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5286"><a href="#cb385-5286" aria-hidden="true" tabindex="-1"></a><span class="in">require(chillR)</span></span>
<span id="cb385-5287"><a href="#cb385-5287" aria-hidden="true" tabindex="-1"></a><span class="in">require(tidyverse)</span></span>
<span id="cb385-5288"><a href="#cb385-5288" aria-hidden="true" tabindex="-1"></a><span class="in">MS_temps &lt;- read_tab("data/MS/MS_patched_weather.csv")</span></span>
<span id="cb385-5289"><a href="#cb385-5289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5290"><a href="#cb385-5290" aria-hidden="true" tabindex="-1"></a><span class="in">location = c(9.0, 48.4)</span></span>
<span id="cb385-5291"><a href="#cb385-5291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5292"><a href="#cb385-5292" aria-hidden="true" tabindex="-1"></a><span class="in">area &lt;- c(50, 8, 48, 10)</span></span>
<span id="cb385-5293"><a href="#cb385-5293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5294"><a href="#cb385-5294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5295"><a href="#cb385-5295" aria-hidden="true" tabindex="-1"></a><span class="in">download_cmip6_ecmwfr(</span></span>
<span id="cb385-5296"><a href="#cb385-5296" aria-hidden="true" tabindex="-1"></a><span class="in">  scenarios = 'ssp126',</span></span>
<span id="cb385-5297"><a href="#cb385-5297" aria-hidden="true" tabindex="-1"></a><span class="in">  area =  area,</span></span>
<span id="cb385-5298"><a href="#cb385-5298" aria-hidden="true" tabindex="-1"></a><span class="in">  user = 'cdc26d1b-d9e9-4552-9b32-e2b974562cee',</span></span>
<span id="cb385-5299"><a href="#cb385-5299" aria-hidden="true" tabindex="-1"></a><span class="in">  key = '1aee996e-75a8-48d2-b7e7-fe4aac7fc8df',</span></span>
<span id="cb385-5300"><a href="#cb385-5300" aria-hidden="true" tabindex="-1"></a><span class="in">  model = 'default',</span></span>
<span id="cb385-5301"><a href="#cb385-5301" aria-hidden="true" tabindex="-1"></a><span class="in">  frequency = 'monthly',</span></span>
<span id="cb385-5302"><a href="#cb385-5302" aria-hidden="true" tabindex="-1"></a><span class="in">  variable = c('Tmin', 'Tmax'),</span></span>
<span id="cb385-5303"><a href="#cb385-5303" aria-hidden="true" tabindex="-1"></a><span class="in">  year_start = 2015,</span></span>
<span id="cb385-5304"><a href="#cb385-5304" aria-hidden="true" tabindex="-1"></a><span class="in">  year_end = 2100,</span></span>
<span id="cb385-5305"><a href="#cb385-5305" aria-hidden="true" tabindex="-1"></a><span class="in">  path_download = "data/MS/MS_cmip6_downloaded")</span></span>
<span id="cb385-5306"><a href="#cb385-5306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5307"><a href="#cb385-5307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5308"><a href="#cb385-5308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5309"><a href="#cb385-5309" aria-hidden="true" tabindex="-1"></a><span class="in">download_cmip6_ecmwfr(</span></span>
<span id="cb385-5310"><a href="#cb385-5310" aria-hidden="true" tabindex="-1"></a><span class="in">  scenarios = c("ssp126", "ssp245", "ssp370", "ssp585"),</span></span>
<span id="cb385-5311"><a href="#cb385-5311" aria-hidden="true" tabindex="-1"></a><span class="in">  area = area,</span></span>
<span id="cb385-5312"><a href="#cb385-5312" aria-hidden="true" tabindex="-1"></a><span class="in">  user = 'cdc26d1b-d9e9-4552-9b32-e2b974562cee',</span></span>
<span id="cb385-5313"><a href="#cb385-5313" aria-hidden="true" tabindex="-1"></a><span class="in">  key = '1aee996e-75a8-48d2-b7e7-fe4aac7fc8df',</span></span>
<span id="cb385-5314"><a href="#cb385-5314" aria-hidden="true" tabindex="-1"></a><span class="in">  model = 'default',</span></span>
<span id="cb385-5315"><a href="#cb385-5315" aria-hidden="true" tabindex="-1"></a><span class="in">  frequency = 'monthly',</span></span>
<span id="cb385-5316"><a href="#cb385-5316" aria-hidden="true" tabindex="-1"></a><span class="in">  variable = c('Tmin', 'Tmax'),</span></span>
<span id="cb385-5317"><a href="#cb385-5317" aria-hidden="true" tabindex="-1"></a><span class="in">  year_start = 2015,</span></span>
<span id="cb385-5318"><a href="#cb385-5318" aria-hidden="true" tabindex="-1"></a><span class="in">  year_end = 2100,</span></span>
<span id="cb385-5319"><a href="#cb385-5319" aria-hidden="true" tabindex="-1"></a><span class="in">  path_download = "data/MS/MS_cmip6_downloaded")</span></span>
<span id="cb385-5320"><a href="#cb385-5320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5321"><a href="#cb385-5321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5322"><a href="#cb385-5322" aria-hidden="true" tabindex="-1"></a><span class="in">download_baseline_cmip6_ecmwfr2 &lt;-</span></span>
<span id="cb385-5323"><a href="#cb385-5323" aria-hidden="true" tabindex="-1"></a><span class="in">  function (area, model = "match_downloaded", service = "cds",</span></span>
<span id="cb385-5324"><a href="#cb385-5324" aria-hidden="true" tabindex="-1"></a><span class="in">            frequency = "monthly", variable = c("Tmin", "Tmax"), year_start = 1990,</span></span>
<span id="cb385-5325"><a href="#cb385-5325" aria-hidden="true" tabindex="-1"></a><span class="in">            year_end = 2020, month = 1:12, sec_wait = 3600, n_try = 10,</span></span>
<span id="cb385-5326"><a href="#cb385-5326" aria-hidden="true" tabindex="-1"></a><span class="in">            update_everything = FALSE, path_download = "data/MS/MS_cmip6_downloaded",</span></span>
<span id="cb385-5327"><a href="#cb385-5327" aria-hidden="true" tabindex="-1"></a><span class="in">            user = "ecmwfr", key = NULL)</span></span>
<span id="cb385-5328"><a href="#cb385-5328" aria-hidden="true" tabindex="-1"></a><span class="in">  {</span></span>
<span id="cb385-5329"><a href="#cb385-5329" aria-hidden="true" tabindex="-1"></a><span class="in">    if (model == "match_downloaded") {</span></span>
<span id="cb385-5330"><a href="#cb385-5330" aria-hidden="true" tabindex="-1"></a><span class="in">      if (dir.exists(paste0(path_download, "/", paste(area,</span></span>
<span id="cb385-5331"><a href="#cb385-5331" aria-hidden="true" tabindex="-1"></a><span class="in">                                                      collapse = "_"))) == FALSE) {</span></span>
<span id="cb385-5332"><a href="#cb385-5332" aria-hidden="true" tabindex="-1"></a><span class="in">        stop("There is no directory matching your arguments. Check if you really downloaded the \n           SSP scenarios and that you used the same area argument.")</span></span>
<span id="cb385-5333"><a href="#cb385-5333" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb385-5334"><a href="#cb385-5334" aria-hidden="true" tabindex="-1"></a><span class="in">      f &lt;- list.files(paste0(path_download, "/", paste(area,</span></span>
<span id="cb385-5335"><a href="#cb385-5335" aria-hidden="true" tabindex="-1"></a><span class="in">                                                       collapse = "_")))</span></span>
<span id="cb385-5336"><a href="#cb385-5336" aria-hidden="true" tabindex="-1"></a><span class="in">      if (length(f) == 0) {</span></span>
<span id="cb385-5337"><a href="#cb385-5337" aria-hidden="true" tabindex="-1"></a><span class="in">        stop("The directory is empty. Please chekc if the \"path_download\" and the \"area\" \n           argument are correct")</span></span>
<span id="cb385-5338"><a href="#cb385-5338" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb385-5339"><a href="#cb385-5339" aria-hidden="true" tabindex="-1"></a><span class="in">      # model &lt;- f %&gt;% strsplit("_") %&gt;% purrr::map(function(x) paste(x[5:(length(x) -</span></span>
<span id="cb385-5340"><a href="#cb385-5340" aria-hidden="true" tabindex="-1"></a><span class="in">      #                                                                      5)], collapse = "_")) %&gt;% unique() %&gt;% unlist()</span></span>
<span id="cb385-5341"><a href="#cb385-5341" aria-hidden="true" tabindex="-1"></a><span class="in">      model &lt;- gsub("(tmin_|tmax_|historical_|ssp1_2_6_|ssp2_4_5_|ssp3_7_0_|ssp5_8_5_|_monthly.+$|tas.+)",</span></span>
<span id="cb385-5342"><a href="#cb385-5342" aria-hidden="true" tabindex="-1"></a><span class="in">                    "",</span></span>
<span id="cb385-5343"><a href="#cb385-5343" aria-hidden="true" tabindex="-1"></a><span class="in">                    f) %&gt;%</span></span>
<span id="cb385-5344"><a href="#cb385-5344" aria-hidden="true" tabindex="-1"></a><span class="in">        unique() %&gt;% </span></span>
<span id="cb385-5345"><a href="#cb385-5345" aria-hidden="true" tabindex="-1"></a><span class="in">        .[.!=""]</span></span>
<span id="cb385-5346"><a href="#cb385-5346" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb385-5347"><a href="#cb385-5347" aria-hidden="true" tabindex="-1"></a><span class="in">    download_cmip6_ecmwfr(scenarios = "historical", area = area,</span></span>
<span id="cb385-5348"><a href="#cb385-5348" aria-hidden="true" tabindex="-1"></a><span class="in">                          model = model, service = service, frequency = frequency,</span></span>
<span id="cb385-5349"><a href="#cb385-5349" aria-hidden="true" tabindex="-1"></a><span class="in">                          variable = variable, year_start = year_start, year_end = year_end,</span></span>
<span id="cb385-5350"><a href="#cb385-5350" aria-hidden="true" tabindex="-1"></a><span class="in">                          month = month, sec_wait = sec_wait, n_try = n_try, update_everything = update_everything,</span></span>
<span id="cb385-5351"><a href="#cb385-5351" aria-hidden="true" tabindex="-1"></a><span class="in">                          path_download = path_download, user = user, key = key)</span></span>
<span id="cb385-5352"><a href="#cb385-5352" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb385-5353"><a href="#cb385-5353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5354"><a href="#cb385-5354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5355"><a href="#cb385-5355" aria-hidden="true" tabindex="-1"></a><span class="in">download_baseline_cmip6_ecmwfr2(</span></span>
<span id="cb385-5356"><a href="#cb385-5356" aria-hidden="true" tabindex="-1"></a><span class="in">  area = area,</span></span>
<span id="cb385-5357"><a href="#cb385-5357" aria-hidden="true" tabindex="-1"></a><span class="in">  user = 'cdc26d1b-d9e9-4552-9b32-e2b974562cee',</span></span>
<span id="cb385-5358"><a href="#cb385-5358" aria-hidden="true" tabindex="-1"></a><span class="in">  key = '1aee996e-75a8-48d2-b7e7-fe4aac7fc8df',</span></span>
<span id="cb385-5359"><a href="#cb385-5359" aria-hidden="true" tabindex="-1"></a><span class="in">  model = 'match_downloaded',</span></span>
<span id="cb385-5360"><a href="#cb385-5360" aria-hidden="true" tabindex="-1"></a><span class="in">  frequency = 'monthly',</span></span>
<span id="cb385-5361"><a href="#cb385-5361" aria-hidden="true" tabindex="-1"></a><span class="in">  variable = c('Tmin', 'Tmax'),</span></span>
<span id="cb385-5362"><a href="#cb385-5362" aria-hidden="true" tabindex="-1"></a><span class="in">  year_start = 1990,</span></span>
<span id="cb385-5363"><a href="#cb385-5363" aria-hidden="true" tabindex="-1"></a><span class="in">  year_end = 2020,</span></span>
<span id="cb385-5364"><a href="#cb385-5364" aria-hidden="true" tabindex="-1"></a><span class="in">  month = 1:12,</span></span>
<span id="cb385-5365"><a href="#cb385-5365" aria-hidden="true" tabindex="-1"></a><span class="in">  path_download = "data/MS/MS_cmip6_downloaded")</span></span>
<span id="cb385-5366"><a href="#cb385-5366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5367"><a href="#cb385-5367" aria-hidden="true" tabindex="-1"></a><span class="in">station &lt;- data.frame(</span></span>
<span id="cb385-5368"><a href="#cb385-5368" aria-hidden="true" tabindex="-1"></a><span class="in">  station_name = c("MS"),</span></span>
<span id="cb385-5369"><a href="#cb385-5369" aria-hidden="true" tabindex="-1"></a><span class="in">  longitude = c(9.0),</span></span>
<span id="cb385-5370"><a href="#cb385-5370" aria-hidden="true" tabindex="-1"></a><span class="in">  latitude = c(48.4))</span></span>
<span id="cb385-5371"><a href="#cb385-5371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5372"><a href="#cb385-5372" aria-hidden="true" tabindex="-1"></a><span class="in">extracted &lt;- extract_cmip6_data(stations = station,</span></span>
<span id="cb385-5373"><a href="#cb385-5373" aria-hidden="true" tabindex="-1"></a><span class="in">                                download_path = "data/MS/MS_cmip6_downloaded")</span></span>
<span id="cb385-5374"><a href="#cb385-5374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5375"><a href="#cb385-5375" aria-hidden="true" tabindex="-1"></a><span class="in">library(ncdf4)</span></span>
<span id="cb385-5376"><a href="#cb385-5376" aria-hidden="true" tabindex="-1"></a><span class="in">library(PCICt)</span></span>
<span id="cb385-5377"><a href="#cb385-5377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5378"><a href="#cb385-5378" aria-hidden="true" tabindex="-1"></a><span class="in"># extracted &lt;- extract_cmip6_data(stations = station)</span></span>
<span id="cb385-5379"><a href="#cb385-5379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5380"><a href="#cb385-5380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5381"><a href="#cb385-5381" aria-hidden="true" tabindex="-1"></a><span class="in">head(extracted$`ssp126_AWI-CM-1-1-MR`)</span></span>
<span id="cb385-5382"><a href="#cb385-5382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5383"><a href="#cb385-5383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5384"><a href="#cb385-5384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5385"><a href="#cb385-5385" aria-hidden="true" tabindex="-1"></a><span class="in">change_scenarios &lt;- </span></span>
<span id="cb385-5386"><a href="#cb385-5386" aria-hidden="true" tabindex="-1"></a><span class="in">  gen_rel_change_scenario(extracted,</span></span>
<span id="cb385-5387"><a href="#cb385-5387" aria-hidden="true" tabindex="-1"></a><span class="in">                          scenarios = c(2050, 2085),</span></span>
<span id="cb385-5388"><a href="#cb385-5388" aria-hidden="true" tabindex="-1"></a><span class="in">                          reference_period = c(1990:2020),</span></span>
<span id="cb385-5389"><a href="#cb385-5389" aria-hidden="true" tabindex="-1"></a><span class="in">                          future_window_width = 30)</span></span>
<span id="cb385-5390"><a href="#cb385-5390" aria-hidden="true" tabindex="-1"></a><span class="in">head(change_scenarios)</span></span>
<span id="cb385-5391"><a href="#cb385-5391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5392"><a href="#cb385-5392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5393"><a href="#cb385-5393" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(change_scenarios, "data/MS/MS_all_change_scenarios.csv", row.names = FALSE)</span></span>
<span id="cb385-5394"><a href="#cb385-5394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5395"><a href="#cb385-5395" aria-hidden="true" tabindex="-1"></a><span class="in">change_scenarios &lt;- read.csv("data/MS/MS_all_change_scenarios.csv")</span></span>
<span id="cb385-5396"><a href="#cb385-5396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5397"><a href="#cb385-5397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5398"><a href="#cb385-5398" aria-hidden="true" tabindex="-1"></a><span class="in">scen_list &lt;- convert_scen_information(change_scenarios)</span></span>
<span id="cb385-5399"><a href="#cb385-5399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5400"><a href="#cb385-5400" aria-hidden="true" tabindex="-1"></a><span class="in">scen_frame &lt;- convert_scen_information(scen_list)</span></span>
<span id="cb385-5401"><a href="#cb385-5401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5402"><a href="#cb385-5402" aria-hidden="true" tabindex="-1"></a><span class="in">scen_list$MS$ssp126$`ACCESS-CM2`$'2050'</span></span>
<span id="cb385-5403"><a href="#cb385-5403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5404"><a href="#cb385-5404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5405"><a href="#cb385-5405" aria-hidden="true" tabindex="-1"></a><span class="in">MS_temps &lt;- read_tab("data/MS/MS_patched_weather.csv")</span></span>
<span id="cb385-5406"><a href="#cb385-5406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5407"><a href="#cb385-5407" aria-hidden="true" tabindex="-1"></a><span class="in">temps_1990 &lt;- temperature_scenario_from_records(MS_temps,</span></span>
<span id="cb385-5408"><a href="#cb385-5408" aria-hidden="true" tabindex="-1"></a><span class="in">                                                1990)</span></span>
<span id="cb385-5409"><a href="#cb385-5409" aria-hidden="true" tabindex="-1"></a><span class="in">temps_2005 &lt;- temperature_scenario_from_records(MS_temps,</span></span>
<span id="cb385-5410"><a href="#cb385-5410" aria-hidden="true" tabindex="-1"></a><span class="in">                                                2005)</span></span>
<span id="cb385-5411"><a href="#cb385-5411" aria-hidden="true" tabindex="-1"></a><span class="in">temps_1990</span></span>
<span id="cb385-5412"><a href="#cb385-5412" aria-hidden="true" tabindex="-1"></a><span class="in">temps_2005</span></span>
<span id="cb385-5413"><a href="#cb385-5413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5414"><a href="#cb385-5414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5415"><a href="#cb385-5415" aria-hidden="true" tabindex="-1"></a><span class="in">base &lt;- temperature_scenario_baseline_adjustment(temps_1990,</span></span>
<span id="cb385-5416"><a href="#cb385-5416" aria-hidden="true" tabindex="-1"></a><span class="in">                                                 temps_2005)</span></span>
<span id="cb385-5417"><a href="#cb385-5417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5418"><a href="#cb385-5418" aria-hidden="true" tabindex="-1"></a><span class="in">base</span></span>
<span id="cb385-5419"><a href="#cb385-5419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5420"><a href="#cb385-5420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5421"><a href="#cb385-5421" aria-hidden="true" tabindex="-1"></a><span class="in">scen_list &lt;- convert_scen_information(change_scenarios,</span></span>
<span id="cb385-5422"><a href="#cb385-5422" aria-hidden="true" tabindex="-1"></a><span class="in">                                      give_structure = FALSE)</span></span>
<span id="cb385-5423"><a href="#cb385-5423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5424"><a href="#cb385-5424" aria-hidden="true" tabindex="-1"></a><span class="in">adjusted_list &lt;- temperature_scenario_baseline_adjustment(base,</span></span>
<span id="cb385-5425"><a href="#cb385-5425" aria-hidden="true" tabindex="-1"></a><span class="in">                                                          scen_list,</span></span>
<span id="cb385-5426"><a href="#cb385-5426" aria-hidden="true" tabindex="-1"></a><span class="in">                                                          temperature_check_args = </span></span>
<span id="cb385-5427"><a href="#cb385-5427" aria-hidden="true" tabindex="-1"></a><span class="in">                                                            list(scenario_check_thresholds = c(5, 15)))</span></span>
<span id="cb385-5428"><a href="#cb385-5428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5429"><a href="#cb385-5429" aria-hidden="true" tabindex="-1"></a><span class="in">dir.create("data/MS/MS_future_climate", recursive = TRUE)</span></span>
<span id="cb385-5430"><a href="#cb385-5430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5431"><a href="#cb385-5431" aria-hidden="true" tabindex="-1"></a><span class="in">for(scen in 1:length(adjusted_list))</span></span>
<span id="cb385-5432"><a href="#cb385-5432" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb385-5433"><a href="#cb385-5433" aria-hidden="true" tabindex="-1"></a><span class="in">  if(!file.exists(paste0("data/MS/MS_future_climate/MS_future_",</span></span>
<span id="cb385-5434"><a href="#cb385-5434" aria-hidden="true" tabindex="-1"></a><span class="in">                         scen,"_",</span></span>
<span id="cb385-5435"><a href="#cb385-5435" aria-hidden="true" tabindex="-1"></a><span class="in">                         names(adjusted_list)[scen],".csv")) )</span></span>
<span id="cb385-5436"><a href="#cb385-5436" aria-hidden="true" tabindex="-1"></a><span class="in">  {temp_temp &lt;- temperature_generation(MS_temps,</span></span>
<span id="cb385-5437"><a href="#cb385-5437" aria-hidden="true" tabindex="-1"></a><span class="in">                                       years = c(1990, 2020),</span></span>
<span id="cb385-5438"><a href="#cb385-5438" aria-hidden="true" tabindex="-1"></a><span class="in">                                       sim_years = c(2001, 2100),</span></span>
<span id="cb385-5439"><a href="#cb385-5439" aria-hidden="true" tabindex="-1"></a><span class="in">                                       adjusted_list[scen],  </span></span>
<span id="cb385-5440"><a href="#cb385-5440" aria-hidden="true" tabindex="-1"></a><span class="in">                                       temperature_check_args = </span></span>
<span id="cb385-5441"><a href="#cb385-5441" aria-hidden="true" tabindex="-1"></a><span class="in">                                         list( scenario_check_thresholds = c(5, 15)))</span></span>
<span id="cb385-5442"><a href="#cb385-5442" aria-hidden="true" tabindex="-1"></a><span class="in">  write.csv(temp_temp[[1]],paste0("data/MS/MS_future_climate/MS_future_",scen,"_",names(adjusted_list)[scen],".csv"),</span></span>
<span id="cb385-5443"><a href="#cb385-5443" aria-hidden="true" tabindex="-1"></a><span class="in">            row.names=FALSE)</span></span>
<span id="cb385-5444"><a href="#cb385-5444" aria-hidden="true" tabindex="-1"></a><span class="in">  print(paste("Processed object",scen,"of", length(adjusted_list)))</span></span>
<span id="cb385-5445"><a href="#cb385-5445" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-5446"><a href="#cb385-5446" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-5447"><a href="#cb385-5447" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb385-5448"><a href="#cb385-5448" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-5449"><a href="#cb385-5449" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-5450"><a href="#cb385-5450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5451"><a href="#cb385-5451" aria-hidden="true" tabindex="-1"></a><span class="in">temps &lt;- load_temperature_scenarios("data/MS/MS_future_climate","MS_future_")</span></span>
<span id="cb385-5452"><a href="#cb385-5452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5453"><a href="#cb385-5453" aria-hidden="true" tabindex="-1"></a><span class="in"># now we have temperature scenarios</span></span>
<span id="cb385-5454"><a href="#cb385-5454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5455"><a href="#cb385-5455" aria-hidden="true" tabindex="-1"></a><span class="in">frost_model &lt;- function(x)</span></span>
<span id="cb385-5456"><a href="#cb385-5456" aria-hidden="true" tabindex="-1"></a><span class="in">  step_model(x,</span></span>
<span id="cb385-5457"><a href="#cb385-5457" aria-hidden="true" tabindex="-1"></a><span class="in">             data.frame(</span></span>
<span id="cb385-5458"><a href="#cb385-5458" aria-hidden="true" tabindex="-1"></a><span class="in">               lower = c(-1000, 0),</span></span>
<span id="cb385-5459"><a href="#cb385-5459" aria-hidden="true" tabindex="-1"></a><span class="in">               upper = c(0, 1000),</span></span>
<span id="cb385-5460"><a href="#cb385-5460" aria-hidden="true" tabindex="-1"></a><span class="in">               weight = c(1, 0)))</span></span>
<span id="cb385-5461"><a href="#cb385-5461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5462"><a href="#cb385-5462" aria-hidden="true" tabindex="-1"></a><span class="in">models &lt;- list(Chill_Portions = Dynamic_Model,</span></span>
<span id="cb385-5463"><a href="#cb385-5463" aria-hidden="true" tabindex="-1"></a><span class="in">               GDH = GDH,</span></span>
<span id="cb385-5464"><a href="#cb385-5464" aria-hidden="true" tabindex="-1"></a><span class="in">               Frost_H = frost_model)</span></span>
<span id="cb385-5465"><a href="#cb385-5465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5466"><a href="#cb385-5466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5467"><a href="#cb385-5467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5468"><a href="#cb385-5468" aria-hidden="true" tabindex="-1"></a><span class="in">chill_future_scenario_list &lt;- </span></span>
<span id="cb385-5469"><a href="#cb385-5469" aria-hidden="true" tabindex="-1"></a><span class="in">  tempResponse_daily_list(temps,</span></span>
<span id="cb385-5470"><a href="#cb385-5470" aria-hidden="true" tabindex="-1"></a><span class="in">                          latitude = 48.4,</span></span>
<span id="cb385-5471"><a href="#cb385-5471" aria-hidden="true" tabindex="-1"></a><span class="in">                          Start_JDay = 305,</span></span>
<span id="cb385-5472"><a href="#cb385-5472" aria-hidden="true" tabindex="-1"></a><span class="in">                          End_JDay = 59,</span></span>
<span id="cb385-5473"><a href="#cb385-5473" aria-hidden="true" tabindex="-1"></a><span class="in">                          models = models)</span></span>
<span id="cb385-5474"><a href="#cb385-5474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5475"><a href="#cb385-5475" aria-hidden="true" tabindex="-1"></a><span class="in">chill_future_scenario_list &lt;- </span></span>
<span id="cb385-5476"><a href="#cb385-5476" aria-hidden="true" tabindex="-1"></a><span class="in">  lapply(chill_future_scenario_list,</span></span>
<span id="cb385-5477"><a href="#cb385-5477" aria-hidden="true" tabindex="-1"></a><span class="in">         function(x) x %&gt;%</span></span>
<span id="cb385-5478"><a href="#cb385-5478" aria-hidden="true" tabindex="-1"></a><span class="in">           filter(Perc_complete == 100))</span></span>
<span id="cb385-5479"><a href="#cb385-5479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5480"><a href="#cb385-5480" aria-hidden="true" tabindex="-1"></a><span class="in">save_temperature_scenarios(chill_future_scenario_list,</span></span>
<span id="cb385-5481"><a href="#cb385-5481" aria-hidden="true" tabindex="-1"></a><span class="in">                           "data/MS/MS_future_climate",</span></span>
<span id="cb385-5482"><a href="#cb385-5482" aria-hidden="true" tabindex="-1"></a><span class="in">                           "MS_futurechill")</span></span>
<span id="cb385-5483"><a href="#cb385-5483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5484"><a href="#cb385-5484" aria-hidden="true" tabindex="-1"></a><span class="in"># this would be for spring frost, but we're not running this</span></span>
<span id="cb385-5485"><a href="#cb385-5485" aria-hidden="true" tabindex="-1"></a><span class="in">chill_future_scenario_list_frost &lt;- </span></span>
<span id="cb385-5486"><a href="#cb385-5486" aria-hidden="true" tabindex="-1"></a><span class="in">  tempResponse_daily_list(temps,</span></span>
<span id="cb385-5487"><a href="#cb385-5487" aria-hidden="true" tabindex="-1"></a><span class="in">                          latitude = 48.4,</span></span>
<span id="cb385-5488"><a href="#cb385-5488" aria-hidden="true" tabindex="-1"></a><span class="in">                          Start_JDay = 75,</span></span>
<span id="cb385-5489"><a href="#cb385-5489" aria-hidden="true" tabindex="-1"></a><span class="in">                          End_JDay = 120,</span></span>
<span id="cb385-5490"><a href="#cb385-5490" aria-hidden="true" tabindex="-1"></a><span class="in">                          models = list(GDH = GDH,</span></span>
<span id="cb385-5491"><a href="#cb385-5491" aria-hidden="true" tabindex="-1"></a><span class="in">                                        Frost_H = frost_model))</span></span>
<span id="cb385-5492"><a href="#cb385-5492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5493"><a href="#cb385-5493" aria-hidden="true" tabindex="-1"></a><span class="in">chill_future_scenario_list_frost &lt;- </span></span>
<span id="cb385-5494"><a href="#cb385-5494" aria-hidden="true" tabindex="-1"></a><span class="in">  lapply(chill_future_scenario_list_frost,</span></span>
<span id="cb385-5495"><a href="#cb385-5495" aria-hidden="true" tabindex="-1"></a><span class="in">         function(x) x %&gt;%</span></span>
<span id="cb385-5496"><a href="#cb385-5496" aria-hidden="true" tabindex="-1"></a><span class="in">           filter(Perc_complete == 100))</span></span>
<span id="cb385-5497"><a href="#cb385-5497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5498"><a href="#cb385-5498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5499"><a href="#cb385-5499" aria-hidden="true" tabindex="-1"></a><span class="in">save_temperature_scenarios(chill_future_scenario_list_frost,</span></span>
<span id="cb385-5500"><a href="#cb385-5500" aria-hidden="true" tabindex="-1"></a><span class="in">                           "data/MS/MS_future_climate",</span></span>
<span id="cb385-5501"><a href="#cb385-5501" aria-hidden="true" tabindex="-1"></a><span class="in">                           "MS_futurefrost")</span></span>
<span id="cb385-5502"><a href="#cb385-5502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5503"><a href="#cb385-5503" aria-hidden="true" tabindex="-1"></a><span class="in">observed_chill &lt;- tempResponse_daily_list(MS_temps,</span></span>
<span id="cb385-5504"><a href="#cb385-5504" aria-hidden="true" tabindex="-1"></a><span class="in">                                          latitude = 48.4,</span></span>
<span id="cb385-5505"><a href="#cb385-5505" aria-hidden="true" tabindex="-1"></a><span class="in">                                          Start_JDay = 305,</span></span>
<span id="cb385-5506"><a href="#cb385-5506" aria-hidden="true" tabindex="-1"></a><span class="in">                                          End_JDay = 59,</span></span>
<span id="cb385-5507"><a href="#cb385-5507" aria-hidden="true" tabindex="-1"></a><span class="in">                                          models = models)</span></span>
<span id="cb385-5508"><a href="#cb385-5508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5509"><a href="#cb385-5509" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(observed_chill, "data/MS/MS_observed_chill_305_59.csv")</span></span>
<span id="cb385-5510"><a href="#cb385-5510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5511"><a href="#cb385-5511" aria-hidden="true" tabindex="-1"></a><span class="in"># simulate chill for historic scenarios</span></span>
<span id="cb385-5512"><a href="#cb385-5512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5513"><a href="#cb385-5513" aria-hidden="true" tabindex="-1"></a><span class="in">hist_temps &lt;- load_temperature_scenarios("data/MS","MS_hist_scenarios")</span></span>
<span id="cb385-5514"><a href="#cb385-5514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5515"><a href="#cb385-5515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5516"><a href="#cb385-5516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5517"><a href="#cb385-5517" aria-hidden="true" tabindex="-1"></a><span class="in">chill_hist_scenario_list &lt;- tempResponse_daily_list(hist_temps,</span></span>
<span id="cb385-5518"><a href="#cb385-5518" aria-hidden="true" tabindex="-1"></a><span class="in">                                                    latitude = 48.4,</span></span>
<span id="cb385-5519"><a href="#cb385-5519" aria-hidden="true" tabindex="-1"></a><span class="in">                                                    Start_JDay = 305,</span></span>
<span id="cb385-5520"><a href="#cb385-5520" aria-hidden="true" tabindex="-1"></a><span class="in">                                                    End_JDay = 59,</span></span>
<span id="cb385-5521"><a href="#cb385-5521" aria-hidden="true" tabindex="-1"></a><span class="in">                                                    models = models)</span></span>
<span id="cb385-5522"><a href="#cb385-5522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5523"><a href="#cb385-5523" aria-hidden="true" tabindex="-1"></a><span class="in">chill_hist_scenario_list &lt;- lapply(chill_hist_scenario_list,</span></span>
<span id="cb385-5524"><a href="#cb385-5524" aria-hidden="true" tabindex="-1"></a><span class="in">                                   function(x) x %&gt;%</span></span>
<span id="cb385-5525"><a href="#cb385-5525" aria-hidden="true" tabindex="-1"></a><span class="in">                                     filter(Perc_complete == 100))</span></span>
<span id="cb385-5526"><a href="#cb385-5526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5527"><a href="#cb385-5527" aria-hidden="true" tabindex="-1"></a><span class="in">save_temperature_scenarios(chill_hist_scenario_list,</span></span>
<span id="cb385-5528"><a href="#cb385-5528" aria-hidden="true" tabindex="-1"></a><span class="in">                           "data/MS",</span></span>
<span id="cb385-5529"><a href="#cb385-5529" aria-hidden="true" tabindex="-1"></a><span class="in">                           "MS_hist_chill_305_59")</span></span>
<span id="cb385-5530"><a href="#cb385-5530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5531"><a href="#cb385-5531" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-5532"><a href="#cb385-5532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5533"><a href="#cb385-5533" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-5534"><a href="#cb385-5534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5535"><a href="#cb385-5535" aria-hidden="true" tabindex="-1"></a>Plot the results for chill/heat accumulation and frost incidence: *(The question asked for two only, but I added all three because I just wanted to save them.)*</span>
<span id="cb385-5536"><a href="#cb385-5536" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 16.2b}</span></span>
<span id="cb385-5537"><a href="#cb385-5537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5538"><a href="#cb385-5538" aria-hidden="true" tabindex="-1"></a><span class="in">chill_future_scenario_list &lt;- load_temperature_scenarios("data/MS/MS_future_climate","MS_futurechill")</span></span>
<span id="cb385-5539"><a href="#cb385-5539" aria-hidden="true" tabindex="-1"></a><span class="in">chill_hist_scenario_list&lt;-load_temperature_scenarios("data/MS","MS_hist_chill_305_59")</span></span>
<span id="cb385-5540"><a href="#cb385-5540" aria-hidden="true" tabindex="-1"></a><span class="in">observed_chill &lt;- read_tab("data/MS/MS_observed_chill_305_59.csv")</span></span>
<span id="cb385-5541"><a href="#cb385-5541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5542"><a href="#cb385-5542" aria-hidden="true" tabindex="-1"></a><span class="in"># prepare for plotting</span></span>
<span id="cb385-5543"><a href="#cb385-5543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5544"><a href="#cb385-5544" aria-hidden="true" tabindex="-1"></a><span class="in">chills &lt;- make_climate_scenario(</span></span>
<span id="cb385-5545"><a href="#cb385-5545" aria-hidden="true" tabindex="-1"></a><span class="in">  metric_summary = chill_hist_scenario_list,</span></span>
<span id="cb385-5546"><a href="#cb385-5546" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Historical",</span></span>
<span id="cb385-5547"><a href="#cb385-5547" aria-hidden="true" tabindex="-1"></a><span class="in">  historic_data = observed_chill,</span></span>
<span id="cb385-5548"><a href="#cb385-5548" aria-hidden="true" tabindex="-1"></a><span class="in">  time_series = TRUE)</span></span>
<span id="cb385-5549"><a href="#cb385-5549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5550"><a href="#cb385-5550" aria-hidden="true" tabindex="-1"></a><span class="in">plot_climate_scenarios(</span></span>
<span id="cb385-5551"><a href="#cb385-5551" aria-hidden="true" tabindex="-1"></a><span class="in">  climate_scenario_list = chills,</span></span>
<span id="cb385-5552"><a href="#cb385-5552" aria-hidden="true" tabindex="-1"></a><span class="in">  metric = "Chill_Portions",</span></span>
<span id="cb385-5553"><a href="#cb385-5553" aria-hidden="true" tabindex="-1"></a><span class="in">  metric_label = "Chill (Chill Portions)")</span></span>
<span id="cb385-5554"><a href="#cb385-5554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5555"><a href="#cb385-5555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5556"><a href="#cb385-5556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5557"><a href="#cb385-5557" aria-hidden="true" tabindex="-1"></a><span class="in">list_ssp &lt;- </span></span>
<span id="cb385-5558"><a href="#cb385-5558" aria-hidden="true" tabindex="-1"></a><span class="in">  strsplit(names(chill_future_scenario_list),</span></span>
<span id="cb385-5559"><a href="#cb385-5559" aria-hidden="true" tabindex="-1"></a><span class="in">           '\\.') %&gt;%</span></span>
<span id="cb385-5560"><a href="#cb385-5560" aria-hidden="true" tabindex="-1"></a><span class="in">  map(2) %&gt;%</span></span>
<span id="cb385-5561"><a href="#cb385-5561" aria-hidden="true" tabindex="-1"></a><span class="in">  unlist()</span></span>
<span id="cb385-5562"><a href="#cb385-5562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5563"><a href="#cb385-5563" aria-hidden="true" tabindex="-1"></a><span class="in">list_gcm &lt;-</span></span>
<span id="cb385-5564"><a href="#cb385-5564" aria-hidden="true" tabindex="-1"></a><span class="in">  strsplit(names(chill_future_scenario_list), '\\.') %&gt;%</span></span>
<span id="cb385-5565"><a href="#cb385-5565" aria-hidden="true" tabindex="-1"></a><span class="in">  map(3) %&gt;%</span></span>
<span id="cb385-5566"><a href="#cb385-5566" aria-hidden="true" tabindex="-1"></a><span class="in">  unlist()</span></span>
<span id="cb385-5567"><a href="#cb385-5567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5568"><a href="#cb385-5568" aria-hidden="true" tabindex="-1"></a><span class="in">list_time &lt;-</span></span>
<span id="cb385-5569"><a href="#cb385-5569" aria-hidden="true" tabindex="-1"></a><span class="in">  strsplit(names(chill_future_scenario_list), '\\.') %&gt;%</span></span>
<span id="cb385-5570"><a href="#cb385-5570" aria-hidden="true" tabindex="-1"></a><span class="in">  map(4) %&gt;%</span></span>
<span id="cb385-5571"><a href="#cb385-5571" aria-hidden="true" tabindex="-1"></a><span class="in">  unlist()</span></span>
<span id="cb385-5572"><a href="#cb385-5572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5573"><a href="#cb385-5573" aria-hidden="true" tabindex="-1"></a><span class="in">SSPs &lt;- c("ssp126", "ssp245", "ssp585")</span></span>
<span id="cb385-5574"><a href="#cb385-5574" aria-hidden="true" tabindex="-1"></a><span class="in">Times &lt;- c(2050, 2085)</span></span>
<span id="cb385-5575"><a href="#cb385-5575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5576"><a href="#cb385-5576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5577"><a href="#cb385-5577" aria-hidden="true" tabindex="-1"></a><span class="in">for(SSP in SSPs)</span></span>
<span id="cb385-5578"><a href="#cb385-5578" aria-hidden="true" tabindex="-1"></a><span class="in">  for(Time in Times)</span></span>
<span id="cb385-5579"><a href="#cb385-5579" aria-hidden="true" tabindex="-1"></a><span class="in">  {</span></span>
<span id="cb385-5580"><a href="#cb385-5580" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb385-5581"><a href="#cb385-5581" aria-hidden="true" tabindex="-1"></a><span class="in">    # find all scenarios for the ssp and time</span></span>
<span id="cb385-5582"><a href="#cb385-5582" aria-hidden="true" tabindex="-1"></a><span class="in">    chill &lt;- chill_future_scenario_list[list_ssp == SSP &amp;</span></span>
<span id="cb385-5583"><a href="#cb385-5583" aria-hidden="true" tabindex="-1"></a><span class="in">                                          list_time == Time]</span></span>
<span id="cb385-5584"><a href="#cb385-5584" aria-hidden="true" tabindex="-1"></a><span class="in">    names(chill) &lt;- list_gcm[list_ssp == SSP &amp;</span></span>
<span id="cb385-5585"><a href="#cb385-5585" aria-hidden="true" tabindex="-1"></a><span class="in">                               list_time == Time]</span></span>
<span id="cb385-5586"><a href="#cb385-5586" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp126") SSPcaption &lt;- "SSP1"</span></span>
<span id="cb385-5587"><a href="#cb385-5587" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp245") SSPcaption &lt;- "SSP2"</span></span>
<span id="cb385-5588"><a href="#cb385-5588" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp585") SSPcaption &lt;- "SSP5"    </span></span>
<span id="cb385-5589"><a href="#cb385-5589" aria-hidden="true" tabindex="-1"></a><span class="in">    chills &lt;- chill %&gt;% </span></span>
<span id="cb385-5590"><a href="#cb385-5590" aria-hidden="true" tabindex="-1"></a><span class="in">      make_climate_scenario(</span></span>
<span id="cb385-5591"><a href="#cb385-5591" aria-hidden="true" tabindex="-1"></a><span class="in">        caption = c(SSPcaption,</span></span>
<span id="cb385-5592"><a href="#cb385-5592" aria-hidden="true" tabindex="-1"></a><span class="in">                    Time),</span></span>
<span id="cb385-5593"><a href="#cb385-5593" aria-hidden="true" tabindex="-1"></a><span class="in">        add_to = chills)</span></span>
<span id="cb385-5594"><a href="#cb385-5594" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb385-5595"><a href="#cb385-5595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5596"><a href="#cb385-5596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5597"><a href="#cb385-5597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5598"><a href="#cb385-5598" aria-hidden="true" tabindex="-1"></a><span class="in">info_chill &lt;-</span></span>
<span id="cb385-5599"><a href="#cb385-5599" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_climate_scenarios(</span></span>
<span id="cb385-5600"><a href="#cb385-5600" aria-hidden="true" tabindex="-1"></a><span class="in">    climate_scenario_list = chills,</span></span>
<span id="cb385-5601"><a href="#cb385-5601" aria-hidden="true" tabindex="-1"></a><span class="in">    metric = "Chill_Portions",</span></span>
<span id="cb385-5602"><a href="#cb385-5602" aria-hidden="true" tabindex="-1"></a><span class="in">    metric_label = "Chill (Chill Portions)",</span></span>
<span id="cb385-5603"><a href="#cb385-5603" aria-hidden="true" tabindex="-1"></a><span class="in">    texcex = 1)</span></span>
<span id="cb385-5604"><a href="#cb385-5604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5605"><a href="#cb385-5605" aria-hidden="true" tabindex="-1"></a><span class="in">info_heat &lt;-</span></span>
<span id="cb385-5606"><a href="#cb385-5606" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_climate_scenarios(</span></span>
<span id="cb385-5607"><a href="#cb385-5607" aria-hidden="true" tabindex="-1"></a><span class="in">    climate_scenario_list = chills,</span></span>
<span id="cb385-5608"><a href="#cb385-5608" aria-hidden="true" tabindex="-1"></a><span class="in">    metric = "GDH",</span></span>
<span id="cb385-5609"><a href="#cb385-5609" aria-hidden="true" tabindex="-1"></a><span class="in">    metric_label = "Heat (Growing Degree Hours)",</span></span>
<span id="cb385-5610"><a href="#cb385-5610" aria-hidden="true" tabindex="-1"></a><span class="in">    texcex = 1)</span></span>
<span id="cb385-5611"><a href="#cb385-5611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5612"><a href="#cb385-5612" aria-hidden="true" tabindex="-1"></a><span class="in">info_frost &lt;- </span></span>
<span id="cb385-5613"><a href="#cb385-5613" aria-hidden="true" tabindex="-1"></a><span class="in">  plot_climate_scenarios(  </span></span>
<span id="cb385-5614"><a href="#cb385-5614" aria-hidden="true" tabindex="-1"></a><span class="in">    climate_scenario_list=chills,</span></span>
<span id="cb385-5615"><a href="#cb385-5615" aria-hidden="true" tabindex="-1"></a><span class="in">    metric="Frost_H",</span></span>
<span id="cb385-5616"><a href="#cb385-5616" aria-hidden="true" tabindex="-1"></a><span class="in">    metric_label="Frost incidence (hours)",</span></span>
<span id="cb385-5617"><a href="#cb385-5617" aria-hidden="true" tabindex="-1"></a><span class="in">    texcex=1)</span></span>
<span id="cb385-5618"><a href="#cb385-5618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5619"><a href="#cb385-5619" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-5620"><a href="#cb385-5620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5621"><a href="#cb385-5621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5622"><a href="#cb385-5622" aria-hidden="true" tabindex="-1"></a>***To check/ add details later***</span>
<span id="cb385-5623"><a href="#cb385-5623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5624"><a href="#cb385-5624" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-5625"><a href="#cb385-5625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5626"><a href="#cb385-5626" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 18: Plotting future scenarios</span></span>
<span id="cb385-5627"><a href="#cb385-5627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5628"><a href="#cb385-5628" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;18.1&lt;/span&gt;&amp;nbsp; Making attractive plots</span></span>
<span id="cb385-5629"><a href="#cb385-5629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5630"><a href="#cb385-5630" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-5631"><a href="#cb385-5631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5632"><a href="#cb385-5632" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We produce similar plots to <span class="in">`plot_climate_scenarios`</span> using <span class="in">`ggplot`</span>.</span>
<span id="cb385-5633"><a href="#cb385-5633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5634"><a href="#cb385-5634" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We’ll be building on our previous work, so we’ll have to load the outputs we produced in chapters **Historic temperature scenarios** and **Making CMIP6 scenarios** now.</span>
<span id="cb385-5635"><a href="#cb385-5635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5636"><a href="#cb385-5636" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 18.1a}</span></span>
<span id="cb385-5637"><a href="#cb385-5637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5638"><a href="#cb385-5638" aria-hidden="true" tabindex="-1"></a><span class="in"># library(kableExtra)</span></span>
<span id="cb385-5639"><a href="#cb385-5639" aria-hidden="true" tabindex="-1"></a><span class="in"># library(chillR)</span></span>
<span id="cb385-5640"><a href="#cb385-5640" aria-hidden="true" tabindex="-1"></a><span class="in"># library(tidyverse)</span></span>
<span id="cb385-5641"><a href="#cb385-5641" aria-hidden="true" tabindex="-1"></a><span class="in"># library(ggpmisc)</span></span>
<span id="cb385-5642"><a href="#cb385-5642" aria-hidden="true" tabindex="-1"></a><span class="in"># library(patchwork)</span></span>
<span id="cb385-5643"><a href="#cb385-5643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5644"><a href="#cb385-5644" aria-hidden="true" tabindex="-1"></a><span class="in">chill_hist_scenario_list &lt;- load_temperature_scenarios("data/Bonn",</span></span>
<span id="cb385-5645"><a href="#cb385-5645" aria-hidden="true" tabindex="-1"></a><span class="in">                                                       "Bonn_hist_chill_305_59")</span></span>
<span id="cb385-5646"><a href="#cb385-5646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5647"><a href="#cb385-5647" aria-hidden="true" tabindex="-1"></a><span class="in">actual_chill &lt;- read_tab("data/Bonn/Bonn_observed_chill_305_59.csv")</span></span>
<span id="cb385-5648"><a href="#cb385-5648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5649"><a href="#cb385-5649" aria-hidden="true" tabindex="-1"></a><span class="in">chill_future_scenario_list &lt;- load_temperature_scenarios("data/Bonn/Bonn_future_climate","Bonn_futurechill")</span></span>
<span id="cb385-5650"><a href="#cb385-5650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5651"><a href="#cb385-5651" aria-hidden="true" tabindex="-1"></a><span class="in">chills &lt;- make_climate_scenario(</span></span>
<span id="cb385-5652"><a href="#cb385-5652" aria-hidden="true" tabindex="-1"></a><span class="in">  chill_hist_scenario_list,</span></span>
<span id="cb385-5653"><a href="#cb385-5653" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Historic",</span></span>
<span id="cb385-5654"><a href="#cb385-5654" aria-hidden="true" tabindex="-1"></a><span class="in">  historic_data = actual_chill,</span></span>
<span id="cb385-5655"><a href="#cb385-5655" aria-hidden="true" tabindex="-1"></a><span class="in">  time_series = TRUE)</span></span>
<span id="cb385-5656"><a href="#cb385-5656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5657"><a href="#cb385-5657" aria-hidden="true" tabindex="-1"></a><span class="in">SSPs &lt;- c("ssp126", "ssp245", "ssp370", "ssp585")</span></span>
<span id="cb385-5658"><a href="#cb385-5658" aria-hidden="true" tabindex="-1"></a><span class="in">Times &lt;- c(2050, 2085)</span></span>
<span id="cb385-5659"><a href="#cb385-5659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5660"><a href="#cb385-5660" aria-hidden="true" tabindex="-1"></a><span class="in">list_ssp &lt;- </span></span>
<span id="cb385-5661"><a href="#cb385-5661" aria-hidden="true" tabindex="-1"></a><span class="in">  strsplit(names(chill_future_scenario_list), '\\.') %&gt;%</span></span>
<span id="cb385-5662"><a href="#cb385-5662" aria-hidden="true" tabindex="-1"></a><span class="in">  map(2) %&gt;%</span></span>
<span id="cb385-5663"><a href="#cb385-5663" aria-hidden="true" tabindex="-1"></a><span class="in">  unlist()</span></span>
<span id="cb385-5664"><a href="#cb385-5664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5665"><a href="#cb385-5665" aria-hidden="true" tabindex="-1"></a><span class="in">list_gcm &lt;-</span></span>
<span id="cb385-5666"><a href="#cb385-5666" aria-hidden="true" tabindex="-1"></a><span class="in">  strsplit(names(chill_future_scenario_list), '\\.') %&gt;%</span></span>
<span id="cb385-5667"><a href="#cb385-5667" aria-hidden="true" tabindex="-1"></a><span class="in">  map(3) %&gt;%</span></span>
<span id="cb385-5668"><a href="#cb385-5668" aria-hidden="true" tabindex="-1"></a><span class="in">  unlist()</span></span>
<span id="cb385-5669"><a href="#cb385-5669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5670"><a href="#cb385-5670" aria-hidden="true" tabindex="-1"></a><span class="in">list_time &lt;-</span></span>
<span id="cb385-5671"><a href="#cb385-5671" aria-hidden="true" tabindex="-1"></a><span class="in">  strsplit(names(chill_future_scenario_list), '\\.') %&gt;%</span></span>
<span id="cb385-5672"><a href="#cb385-5672" aria-hidden="true" tabindex="-1"></a><span class="in">  map(4) %&gt;%</span></span>
<span id="cb385-5673"><a href="#cb385-5673" aria-hidden="true" tabindex="-1"></a><span class="in">  unlist()</span></span>
<span id="cb385-5674"><a href="#cb385-5674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5675"><a href="#cb385-5675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5676"><a href="#cb385-5676" aria-hidden="true" tabindex="-1"></a><span class="in">for(SSP in SSPs)</span></span>
<span id="cb385-5677"><a href="#cb385-5677" aria-hidden="true" tabindex="-1"></a><span class="in">  for(Time in Times)</span></span>
<span id="cb385-5678"><a href="#cb385-5678" aria-hidden="true" tabindex="-1"></a><span class="in">    {</span></span>
<span id="cb385-5679"><a href="#cb385-5679" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb385-5680"><a href="#cb385-5680" aria-hidden="true" tabindex="-1"></a><span class="in">    # find all scenarios for the ssp and time</span></span>
<span id="cb385-5681"><a href="#cb385-5681" aria-hidden="true" tabindex="-1"></a><span class="in">    chill &lt;- chill_future_scenario_list[list_ssp == SSP &amp; list_time == Time]</span></span>
<span id="cb385-5682"><a href="#cb385-5682" aria-hidden="true" tabindex="-1"></a><span class="in">    names(chill) &lt;- list_gcm[list_ssp == SSP &amp; list_time == Time]</span></span>
<span id="cb385-5683"><a href="#cb385-5683" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp126") SSPcaption &lt;- "SSP1"</span></span>
<span id="cb385-5684"><a href="#cb385-5684" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp245") SSPcaption &lt;- "SSP2"</span></span>
<span id="cb385-5685"><a href="#cb385-5685" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp370") SSPcaption &lt;- "SSP3"</span></span>
<span id="cb385-5686"><a href="#cb385-5686" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp585") SSPcaption &lt;- "SSP5"    </span></span>
<span id="cb385-5687"><a href="#cb385-5687" aria-hidden="true" tabindex="-1"></a><span class="in">    if(Time == "2050") Time_caption &lt;- "2050"</span></span>
<span id="cb385-5688"><a href="#cb385-5688" aria-hidden="true" tabindex="-1"></a><span class="in">    if(Time == "2085") Time_caption &lt;- "2085"</span></span>
<span id="cb385-5689"><a href="#cb385-5689" aria-hidden="true" tabindex="-1"></a><span class="in">    chills &lt;- chill %&gt;% </span></span>
<span id="cb385-5690"><a href="#cb385-5690" aria-hidden="true" tabindex="-1"></a><span class="in">      make_climate_scenario(</span></span>
<span id="cb385-5691"><a href="#cb385-5691" aria-hidden="true" tabindex="-1"></a><span class="in">        caption = c(SSPcaption,</span></span>
<span id="cb385-5692"><a href="#cb385-5692" aria-hidden="true" tabindex="-1"></a><span class="in">                    Time_caption),</span></span>
<span id="cb385-5693"><a href="#cb385-5693" aria-hidden="true" tabindex="-1"></a><span class="in">        add_to = chills)</span></span>
<span id="cb385-5694"><a href="#cb385-5694" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-5695"><a href="#cb385-5695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5696"><a href="#cb385-5696" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-5697"><a href="#cb385-5697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5698"><a href="#cb385-5698" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`ggplot`</span> works best with all data arranged in a single <span class="in">`data.frame`</span> rather than the kind of list we’ve stored our projection data in. </span>
<span id="cb385-5699"><a href="#cb385-5699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5700"><a href="#cb385-5700" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Each row of this <span class="in">`data.frame`</span> should contain information about the GCM, the SSP and the Year. </span>
<span id="cb385-5701"><a href="#cb385-5701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5702"><a href="#cb385-5702" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This is most easily done by looping through the elements of our chill projection list, extracting the needed information and assembling it in a new, long <span class="in">`data.frame`</span>.</span>
<span id="cb385-5703"><a href="#cb385-5703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5704"><a href="#cb385-5704" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 18.1b}</span></span>
<span id="cb385-5705"><a href="#cb385-5705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5706"><a href="#cb385-5706" aria-hidden="true" tabindex="-1"></a><span class="in"># We'll first process the past scenarios (element 1 of the chills list).</span></span>
<span id="cb385-5707"><a href="#cb385-5707" aria-hidden="true" tabindex="-1"></a><span class="in"># Within the data element, we have a list of multiple data.frames for</span></span>
<span id="cb385-5708"><a href="#cb385-5708" aria-hidden="true" tabindex="-1"></a><span class="in"># the various past scenarios.</span></span>
<span id="cb385-5709"><a href="#cb385-5709" aria-hidden="true" tabindex="-1"></a><span class="in"># Using a 'for' loop, we cycle through all these data.frames.</span></span>
<span id="cb385-5710"><a href="#cb385-5710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5711"><a href="#cb385-5711" aria-hidden="true" tabindex="-1"></a><span class="in">for(nam in names(chills[[1]]$data))</span></span>
<span id="cb385-5712"><a href="#cb385-5712" aria-hidden="true" tabindex="-1"></a><span class="in">  {</span></span>
<span id="cb385-5713"><a href="#cb385-5713" aria-hidden="true" tabindex="-1"></a><span class="in">   # Extract the data frame.</span></span>
<span id="cb385-5714"><a href="#cb385-5714" aria-hidden="true" tabindex="-1"></a><span class="in">   ch &lt;- chills[[1]]$data[[nam]]</span></span>
<span id="cb385-5715"><a href="#cb385-5715" aria-hidden="true" tabindex="-1"></a><span class="in">   # Add columns for the new information we have to add and fill them.</span></span>
<span id="cb385-5716"><a href="#cb385-5716" aria-hidden="true" tabindex="-1"></a><span class="in">   ch[,"GCM"] &lt;- "none"</span></span>
<span id="cb385-5717"><a href="#cb385-5717" aria-hidden="true" tabindex="-1"></a><span class="in">   ch[,"SSP"] &lt;- "none"</span></span>
<span id="cb385-5718"><a href="#cb385-5718" aria-hidden="true" tabindex="-1"></a><span class="in">   ch[,"Year"] &lt;- as.numeric(nam)</span></span>
<span id="cb385-5719"><a href="#cb385-5719" aria-hidden="true" tabindex="-1"></a><span class="in">   </span></span>
<span id="cb385-5720"><a href="#cb385-5720" aria-hidden="true" tabindex="-1"></a><span class="in">   # Now check if this is the first time we've gone through this loop.</span></span>
<span id="cb385-5721"><a href="#cb385-5721" aria-hidden="true" tabindex="-1"></a><span class="in">   # If this is the first time, the ch data.frame becomes the output</span></span>
<span id="cb385-5722"><a href="#cb385-5722" aria-hidden="true" tabindex="-1"></a><span class="in">   # object (past_simulated).</span></span>
<span id="cb385-5723"><a href="#cb385-5723" aria-hidden="true" tabindex="-1"></a><span class="in">   # If it is not the first time ('else'), we add the current data.frame</span></span>
<span id="cb385-5724"><a href="#cb385-5724" aria-hidden="true" tabindex="-1"></a><span class="in">   # to the 'past_simulated' object</span></span>
<span id="cb385-5725"><a href="#cb385-5725" aria-hidden="true" tabindex="-1"></a><span class="in">  if(nam == names(chills[[1]]$data)[1])</span></span>
<span id="cb385-5726"><a href="#cb385-5726" aria-hidden="true" tabindex="-1"></a><span class="in">    past_simulated &lt;- ch else</span></span>
<span id="cb385-5727"><a href="#cb385-5727" aria-hidden="true" tabindex="-1"></a><span class="in">      past_simulated &lt;- rbind(past_simulated,</span></span>
<span id="cb385-5728"><a href="#cb385-5728" aria-hidden="true" tabindex="-1"></a><span class="in">                              ch)</span></span>
<span id="cb385-5729"><a href="#cb385-5729" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb385-5730"><a href="#cb385-5730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5731"><a href="#cb385-5731" aria-hidden="true" tabindex="-1"></a><span class="in"># We add another column called 'Scenario' and label all rows as 'Historical' </span></span>
<span id="cb385-5732"><a href="#cb385-5732" aria-hidden="true" tabindex="-1"></a><span class="in">past_simulated["Scenario"] &lt;- "Historical"</span></span>
<span id="cb385-5733"><a href="#cb385-5733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5734"><a href="#cb385-5734" aria-hidden="true" tabindex="-1"></a><span class="in">kable(head(past_simulated))  %&gt;%</span></span>
<span id="cb385-5735"><a href="#cb385-5735" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left",font_size = 8)</span></span>
<span id="cb385-5736"><a href="#cb385-5736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5737"><a href="#cb385-5737" aria-hidden="true" tabindex="-1"></a><span class="in"># We'll want to add the historic observation too, so let's simplify the</span></span>
<span id="cb385-5738"><a href="#cb385-5738" aria-hidden="true" tabindex="-1"></a><span class="in"># pointer to this information for easier use later</span></span>
<span id="cb385-5739"><a href="#cb385-5739" aria-hidden="true" tabindex="-1"></a><span class="in">past_observed &lt;- chills[[1]][["historic_data"]]</span></span>
<span id="cb385-5740"><a href="#cb385-5740" aria-hidden="true" tabindex="-1"></a><span class="in">kable(head(past_observed)) %&gt;%</span></span>
<span id="cb385-5741"><a href="#cb385-5741" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-5742"><a href="#cb385-5742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5743"><a href="#cb385-5743" aria-hidden="true" tabindex="-1"></a><span class="in"># Now we do the same thing for future data</span></span>
<span id="cb385-5744"><a href="#cb385-5744" aria-hidden="true" tabindex="-1"></a><span class="in"># Extract future data</span></span>
<span id="cb385-5745"><a href="#cb385-5745" aria-hidden="true" tabindex="-1"></a><span class="in">for(i in 2:length(chills))</span></span>
<span id="cb385-5746"><a href="#cb385-5746" aria-hidden="true" tabindex="-1"></a><span class="in">  for(nam in names(chills[[i]]$data))</span></span>
<span id="cb385-5747"><a href="#cb385-5747" aria-hidden="true" tabindex="-1"></a><span class="in">    {ch &lt;- chills[[i]]$data[[nam]]</span></span>
<span id="cb385-5748"><a href="#cb385-5748" aria-hidden="true" tabindex="-1"></a><span class="in">     ch[,"GCM"] &lt;- nam</span></span>
<span id="cb385-5749"><a href="#cb385-5749" aria-hidden="true" tabindex="-1"></a><span class="in">     ch[,"SSP"] &lt;- chills[[i]]$caption[1]</span></span>
<span id="cb385-5750"><a href="#cb385-5750" aria-hidden="true" tabindex="-1"></a><span class="in">     ch[,"Year"] &lt;- chills[[i]]$caption[2]</span></span>
<span id="cb385-5751"><a href="#cb385-5751" aria-hidden="true" tabindex="-1"></a><span class="in">     if(i == 2 &amp; nam == names(chills[[i]]$data)[1])</span></span>
<span id="cb385-5752"><a href="#cb385-5752" aria-hidden="true" tabindex="-1"></a><span class="in">       future_data &lt;- ch else</span></span>
<span id="cb385-5753"><a href="#cb385-5753" aria-hidden="true" tabindex="-1"></a><span class="in">         future_data &lt;- rbind(future_data,ch)</span></span>
<span id="cb385-5754"><a href="#cb385-5754" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb385-5755"><a href="#cb385-5755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5756"><a href="#cb385-5756" aria-hidden="true" tabindex="-1"></a><span class="in">kable(head(future_data)) %&gt;%</span></span>
<span id="cb385-5757"><a href="#cb385-5757" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-5758"><a href="#cb385-5758" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-5759"><a href="#cb385-5759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5760"><a href="#cb385-5760" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-5761"><a href="#cb385-5761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5762"><a href="#cb385-5762" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now our data are in a format that ggplot should be able to work with. We have three metrics in our dataset: <span class="in">`Chill_Portions`</span>, <span class="in">`GDH`</span> and <span class="in">`Frost_H`</span>. We’re not going to write an actual function now (though we probably should), but the code should be flexible enough to allow plotting all three metrics without major adjustments. So I’m defining a variable <span class="in">`metric`</span>, and a variable <span class="in">`axis_label`</span> that we can easily adjust later.</span>
<span id="cb385-5763"><a href="#cb385-5763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5764"><a href="#cb385-5764" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The complex plot we’re going to produce is difficult (or even impossible) to make as a single <span class="in">`ggplot`</span> plot, but this is no problem, because we can assemble multiple plots into a compound figure later. Here we’ll do this with the <span class="in">`plot_layout`</span> function of the <span class="in">`patchwork`</span> package. One problem that arises when we combine figures from multiple plots and we want to use common axes (the y-axis in this case) is that these axes may not be similar. The data in the various plots may span different ranges, so that the automatic selection of reasonable axis settings may lead to different results. Here, we’ll use the <span class="in">`range`</span> function to identify reasonable axis extents that work across all plots.</span>
<span id="cb385-5765"><a href="#cb385-5765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5766"><a href="#cb385-5766" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 18.1c}</span></span>
<span id="cb385-5767"><a href="#cb385-5767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5768"><a href="#cb385-5768" aria-hidden="true" tabindex="-1"></a><span class="in"># Define variables `metric` and `axis_label` to easily adjust later</span></span>
<span id="cb385-5769"><a href="#cb385-5769" aria-hidden="true" tabindex="-1"></a><span class="in">metric &lt;- "GDH"</span></span>
<span id="cb385-5770"><a href="#cb385-5770" aria-hidden="true" tabindex="-1"></a><span class="in">axis_label &lt;- "Heat (in GDH)"</span></span>
<span id="cb385-5771"><a href="#cb385-5771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5772"><a href="#cb385-5772" aria-hidden="true" tabindex="-1"></a><span class="in">## get extreme values for the axis scale</span></span>
<span id="cb385-5773"><a href="#cb385-5773" aria-hidden="true" tabindex="-1"></a><span class="in"># range returns a vector containing the minimum and maximum of </span></span>
<span id="cb385-5774"><a href="#cb385-5774" aria-hidden="true" tabindex="-1"></a><span class="in"># all the given arguments.</span></span>
<span id="cb385-5775"><a href="#cb385-5775" aria-hidden="true" tabindex="-1"></a><span class="in">rng &lt;- range(past_observed[[metric]],</span></span>
<span id="cb385-5776"><a href="#cb385-5776" aria-hidden="true" tabindex="-1"></a><span class="in">             past_simulated[[metric]],</span></span>
<span id="cb385-5777"><a href="#cb385-5777" aria-hidden="true" tabindex="-1"></a><span class="in">             future_data[[metric]])  </span></span>
<span id="cb385-5778"><a href="#cb385-5778" aria-hidden="true" tabindex="-1"></a><span class="in">rng</span></span>
<span id="cb385-5779"><a href="#cb385-5779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5780"><a href="#cb385-5780" aria-hidden="true" tabindex="-1"></a><span class="in"># Now we’re ready for our first plot. We’ll start with the past scenarios:</span></span>
<span id="cb385-5781"><a href="#cb385-5781" aria-hidden="true" tabindex="-1"></a><span class="in">past_plot &lt;- ggplot() +</span></span>
<span id="cb385-5782"><a href="#cb385-5782" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_boxplot(data = past_simulated,</span></span>
<span id="cb385-5783"><a href="#cb385-5783" aria-hidden="true" tabindex="-1"></a><span class="in">               aes_string("as.numeric(Year)",</span></span>
<span id="cb385-5784"><a href="#cb385-5784" aria-hidden="true" tabindex="-1"></a><span class="in">                          metric,group="Year"),</span></span>
<span id="cb385-5785"><a href="#cb385-5785" aria-hidden="true" tabindex="-1"></a><span class="in">               fill = "skyblue")</span></span>
<span id="cb385-5786"><a href="#cb385-5786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5787"><a href="#cb385-5787" aria-hidden="true" tabindex="-1"></a><span class="in">past_plot</span></span>
<span id="cb385-5788"><a href="#cb385-5788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5789"><a href="#cb385-5789" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-5790"><a href="#cb385-5790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5791"><a href="#cb385-5791" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-5792"><a href="#cb385-5792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5793"><a href="#cb385-5793" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You’ll have noticed that in many places in <span class="in">`ggplot`</span> commands, we can simply write the names of the variables we want to use (as in <span class="in">`group=Year`</span>). This is a bit unusual, because normally in R we have to place such strings in quotation marks. Otherwise, R thinks these are variable names and<span class="dv">&amp;mdash;</span> if no such variable is defined<span class="dv">&amp;mdash;</span> we get an error message. </span>
<span id="cb385-5794"><a href="#cb385-5794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5795"><a href="#cb385-5795" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This requirement is no more, and it sure makes life easier, until you’re trying to use actual variable names in a <span class="in">`ggplot2`</span> call. Then we’d actually like to have the distinction between strings and variable names back. Well, we can get it back by using the <span class="in">`aes_string`</span> command instead of <span class="in">`aes`</span>, as you can see in the call above.</span>
<span id="cb385-5796"><a href="#cb385-5796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5797"><a href="#cb385-5797" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>As I said earlier, we need to make sure that the y-axis can accommodate not only the data in this plot, but also all future scenarios. We can use the <span class="in">`rng`</span> range we produced before. I’ll also adjust the axis labels (including for the y axis the customized <span class="in">`axis_label`</span> we made above):</span>
<span id="cb385-5798"><a href="#cb385-5798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5799"><a href="#cb385-5799" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 18.1d}</span></span>
<span id="cb385-5800"><a href="#cb385-5800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5801"><a href="#cb385-5801" aria-hidden="true" tabindex="-1"></a><span class="in">past_plot &lt;- past_plot +</span></span>
<span id="cb385-5802"><a href="#cb385-5802" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(</span></span>
<span id="cb385-5803"><a href="#cb385-5803" aria-hidden="true" tabindex="-1"></a><span class="in">    limits = c(0, </span></span>
<span id="cb385-5804"><a href="#cb385-5804" aria-hidden="true" tabindex="-1"></a><span class="in">               round(rng[2] + rng[2]/10))) +</span></span>
<span id="cb385-5805"><a href="#cb385-5805" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Year", </span></span>
<span id="cb385-5806"><a href="#cb385-5806" aria-hidden="true" tabindex="-1"></a><span class="in">       y = axis_label)</span></span>
<span id="cb385-5807"><a href="#cb385-5807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5808"><a href="#cb385-5808" aria-hidden="true" tabindex="-1"></a><span class="in">past_plot</span></span>
<span id="cb385-5809"><a href="#cb385-5809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5810"><a href="#cb385-5810" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-5811"><a href="#cb385-5811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5812"><a href="#cb385-5812" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-5813"><a href="#cb385-5813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5814"><a href="#cb385-5814" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now we already have a fine plot of the past scenarios, but to make sure it is formatted in a similar way as the future data, we still need some adjustments. </span>
<span id="cb385-5815"><a href="#cb385-5815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5816"><a href="#cb385-5816" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Here we only have one plot, but for the future scenarios, we’ll produce multiple plots, once again using the <span class="in">`facet_wrap`</span> function. This will automatically add some design elements to our plot. </span>
<span id="cb385-5817"><a href="#cb385-5817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5818"><a href="#cb385-5818" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To ensure we have a consistent layout for the whole figure, we therefore also make this single plot into a facet. We’ll also choose our black and white theme again:</span>
<span id="cb385-5819"><a href="#cb385-5819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5820"><a href="#cb385-5820" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 18.1e}</span></span>
<span id="cb385-5821"><a href="#cb385-5821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5822"><a href="#cb385-5822" aria-hidden="true" tabindex="-1"></a><span class="in">past_plot &lt;- past_plot +</span></span>
<span id="cb385-5823"><a href="#cb385-5823" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(~ Scenario) +</span></span>
<span id="cb385-5824"><a href="#cb385-5824" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) </span></span>
<span id="cb385-5825"><a href="#cb385-5825" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-5826"><a href="#cb385-5826" aria-hidden="true" tabindex="-1"></a><span class="in">past_plot</span></span>
<span id="cb385-5827"><a href="#cb385-5827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5828"><a href="#cb385-5828" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-5829"><a href="#cb385-5829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5830"><a href="#cb385-5830" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-5831"><a href="#cb385-5831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5832"><a href="#cb385-5832" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Finally, some finishing touches, related to the facet title (make background disappear and text bold) and the x-axis text (place at an angle, so that all year labels can be displayed properly, even when we change the text size).</span>
<span id="cb385-5833"><a href="#cb385-5833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5834"><a href="#cb385-5834" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 18.1f}</span></span>
<span id="cb385-5835"><a href="#cb385-5835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5836"><a href="#cb385-5836" aria-hidden="true" tabindex="-1"></a><span class="in">past_plot &lt;- past_plot +  </span></span>
<span id="cb385-5837"><a href="#cb385-5837" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(strip.background = element_blank(),</span></span>
<span id="cb385-5838"><a href="#cb385-5838" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.text = element_text(face = "bold"),</span></span>
<span id="cb385-5839"><a href="#cb385-5839" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.x = element_text(angle=45,</span></span>
<span id="cb385-5840"><a href="#cb385-5840" aria-hidden="true" tabindex="-1"></a><span class="in">                                   hjust=1)) </span></span>
<span id="cb385-5841"><a href="#cb385-5841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5842"><a href="#cb385-5842" aria-hidden="true" tabindex="-1"></a><span class="in">past_plot</span></span>
<span id="cb385-5843"><a href="#cb385-5843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5844"><a href="#cb385-5844" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-5845"><a href="#cb385-5845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5846"><a href="#cb385-5846" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-5847"><a href="#cb385-5847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5848"><a href="#cb385-5848" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This is our plot of past scenarios. Now let’s add the actual observations. I’ll make them blue, so that they can be distinguished from the outliers in the <span class="in">`box_plots`</span>. That one is fairly straightforward:</span>
<span id="cb385-5849"><a href="#cb385-5849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5850"><a href="#cb385-5850" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 18.1g}</span></span>
<span id="cb385-5851"><a href="#cb385-5851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5852"><a href="#cb385-5852" aria-hidden="true" tabindex="-1"></a><span class="in"># add historic data</span></span>
<span id="cb385-5853"><a href="#cb385-5853" aria-hidden="true" tabindex="-1"></a><span class="in">past_plot &lt;- past_plot +</span></span>
<span id="cb385-5854"><a href="#cb385-5854" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = past_observed,</span></span>
<span id="cb385-5855"><a href="#cb385-5855" aria-hidden="true" tabindex="-1"></a><span class="in">             aes_string("End_year",</span></span>
<span id="cb385-5856"><a href="#cb385-5856" aria-hidden="true" tabindex="-1"></a><span class="in">                        metric),</span></span>
<span id="cb385-5857"><a href="#cb385-5857" aria-hidden="true" tabindex="-1"></a><span class="in">             col = "blue")</span></span>
<span id="cb385-5858"><a href="#cb385-5858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5859"><a href="#cb385-5859" aria-hidden="true" tabindex="-1"></a><span class="in">past_plot</span></span>
<span id="cb385-5860"><a href="#cb385-5860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5861"><a href="#cb385-5861" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-5862"><a href="#cb385-5862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5863"><a href="#cb385-5863" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-5864"><a href="#cb385-5864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5865"><a href="#cb385-5865" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now we have what we needed for the past. The plots for the future an be produced in a largely similar way. </span>
<span id="cb385-5866"><a href="#cb385-5866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5867"><a href="#cb385-5867" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To organize things properly, we’ll produce one plot for the two scenarios for 2050 first, and then another one for 2085. Then we can display them as two groups of two plots each. </span>
<span id="cb385-5868"><a href="#cb385-5868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5869"><a href="#cb385-5869" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>I’ll save these two plots in a list. This wouldn’t really be necessary here, but such a structure would allow us to later add more scenarios, should that seem desirable. Before making the plots in such a list structure, let’s first see one being assembled. We’ll start with the year (<span class="in">`y`</span>) 2050</span>
<span id="cb385-5870"><a href="#cb385-5870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5871"><a href="#cb385-5871" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 18.1h}</span></span>
<span id="cb385-5872"><a href="#cb385-5872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5873"><a href="#cb385-5873" aria-hidden="true" tabindex="-1"></a><span class="in">y &lt;- 2050</span></span>
<span id="cb385-5874"><a href="#cb385-5874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5875"><a href="#cb385-5875" aria-hidden="true" tabindex="-1"></a><span class="in">future_2050 &lt;- ggplot(data= future_data[which(future_data$Year==y),]) +</span></span>
<span id="cb385-5876"><a href="#cb385-5876" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_boxplot(aes_string("GCM", </span></span>
<span id="cb385-5877"><a href="#cb385-5877" aria-hidden="true" tabindex="-1"></a><span class="in">                          metric, </span></span>
<span id="cb385-5878"><a href="#cb385-5878" aria-hidden="true" tabindex="-1"></a><span class="in">                          fill = "GCM"))</span></span>
<span id="cb385-5879"><a href="#cb385-5879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5880"><a href="#cb385-5880" aria-hidden="true" tabindex="-1"></a><span class="in">future_2050</span></span>
<span id="cb385-5881"><a href="#cb385-5881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5882"><a href="#cb385-5882" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-5883"><a href="#cb385-5883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5884"><a href="#cb385-5884" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-5885"><a href="#cb385-5885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5886"><a href="#cb385-5886" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>So far, we have all SSPs mixed together here. We also can’t read anything on the y-axis. That’s no big deal, because the same information is contained in the color scheme, but it sure looks ugly. </span>
<span id="cb385-5887"><a href="#cb385-5887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5888"><a href="#cb385-5888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5889"><a href="#cb385-5889" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 18.1i}</span></span>
<span id="cb385-5890"><a href="#cb385-5890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5891"><a href="#cb385-5891" aria-hidden="true" tabindex="-1"></a><span class="in"># Add a bit of padding on the side of the plots (with the expand parameter), </span></span>
<span id="cb385-5892"><a href="#cb385-5892" aria-hidden="true" tabindex="-1"></a><span class="in"># to ensure that the plot doesn’t look too crowded</span></span>
<span id="cb385-5893"><a href="#cb385-5893" aria-hidden="true" tabindex="-1"></a><span class="in">future_2050 &lt;- future_2050 +</span></span>
<span id="cb385-5894"><a href="#cb385-5894" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(SSP), nrow = 1) + # arrange panels in single row</span></span>
<span id="cb385-5895"><a href="#cb385-5895" aria-hidden="true" tabindex="-1"></a><span class="in">   scale_x_discrete(labels = NULL, </span></span>
<span id="cb385-5896"><a href="#cb385-5896" aria-hidden="true" tabindex="-1"></a><span class="in">                    expand = expansion(add = 1)) # add 1unit to both ends of x</span></span>
<span id="cb385-5897"><a href="#cb385-5897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5898"><a href="#cb385-5898" aria-hidden="true" tabindex="-1"></a><span class="in"># Also here, we need to adjust the axis limits, so that the future plots can use</span></span>
<span id="cb385-5899"><a href="#cb385-5899" aria-hidden="true" tabindex="-1"></a><span class="in"># the same axis as the past plots. </span></span>
<span id="cb385-5900"><a href="#cb385-5900" aria-hidden="true" tabindex="-1"></a><span class="in"># Use the geom_text_npc function from the ggpmisc package to add scenario year </span></span>
<span id="cb385-5901"><a href="#cb385-5901" aria-hidden="true" tabindex="-1"></a><span class="in"># to the plots.</span></span>
<span id="cb385-5902"><a href="#cb385-5902" aria-hidden="true" tabindex="-1"></a><span class="in">future_2050 &lt;- future_2050 +</span></span>
<span id="cb385-5903"><a href="#cb385-5903" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(limits = c(0, </span></span>
<span id="cb385-5904"><a href="#cb385-5904" aria-hidden="true" tabindex="-1"></a><span class="in">                                round(round(1.1*rng[2])))) + # why double round?</span></span>
<span id="cb385-5905"><a href="#cb385-5905" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_text_npc(aes(npcx = "center", </span></span>
<span id="cb385-5906"><a href="#cb385-5906" aria-hidden="true" tabindex="-1"></a><span class="in">                      npcy = "top",</span></span>
<span id="cb385-5907"><a href="#cb385-5907" aria-hidden="true" tabindex="-1"></a><span class="in">                      label = Year),</span></span>
<span id="cb385-5908"><a href="#cb385-5908" aria-hidden="true" tabindex="-1"></a><span class="in">                  size = 5)</span></span>
<span id="cb385-5909"><a href="#cb385-5909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5910"><a href="#cb385-5910" aria-hidden="true" tabindex="-1"></a><span class="in">future_2050</span></span>
<span id="cb385-5911"><a href="#cb385-5911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5912"><a href="#cb385-5912" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-5913"><a href="#cb385-5913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5914"><a href="#cb385-5914" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-5915"><a href="#cb385-5915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5916"><a href="#cb385-5916" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Finally, some cosmetics: we again choose the black and white theme, and we’ll remove all axis text and titles (they don’t add much, and they make the figure look crowded). </span>
<span id="cb385-5917"><a href="#cb385-5917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5918"><a href="#cb385-5918" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We’ll also remove the y-axis ticks. We then want the legend at the bottom and format the facet title the same way as for the past plot.</span>
<span id="cb385-5919"><a href="#cb385-5919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5920"><a href="#cb385-5920" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 18.1j}</span></span>
<span id="cb385-5921"><a href="#cb385-5921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5922"><a href="#cb385-5922" aria-hidden="true" tabindex="-1"></a><span class="in">future_2050 &lt;- future_2050 +</span></span>
<span id="cb385-5923"><a href="#cb385-5923" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +</span></span>
<span id="cb385-5924"><a href="#cb385-5924" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.ticks.y = element_blank(),</span></span>
<span id="cb385-5925"><a href="#cb385-5925" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text = element_blank(),</span></span>
<span id="cb385-5926"><a href="#cb385-5926" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.title = element_blank(),</span></span>
<span id="cb385-5927"><a href="#cb385-5927" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.position = "bottom",</span></span>
<span id="cb385-5928"><a href="#cb385-5928" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.margin = margin(0,</span></span>
<span id="cb385-5929"><a href="#cb385-5929" aria-hidden="true" tabindex="-1"></a><span class="in">                               0,</span></span>
<span id="cb385-5930"><a href="#cb385-5930" aria-hidden="true" tabindex="-1"></a><span class="in">                               0,</span></span>
<span id="cb385-5931"><a href="#cb385-5931" aria-hidden="true" tabindex="-1"></a><span class="in">                               0,</span></span>
<span id="cb385-5932"><a href="#cb385-5932" aria-hidden="true" tabindex="-1"></a><span class="in">                               "cm"),</span></span>
<span id="cb385-5933"><a href="#cb385-5933" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.background = element_rect(),</span></span>
<span id="cb385-5934"><a href="#cb385-5934" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.background = element_blank(),</span></span>
<span id="cb385-5935"><a href="#cb385-5935" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.text = element_text(face = "bold"),</span></span>
<span id="cb385-5936"><a href="#cb385-5936" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.box.spacing = unit(0, "cm"),</span></span>
<span id="cb385-5937"><a href="#cb385-5937" aria-hidden="true" tabindex="-1"></a><span class="in">        plot.subtitle = element_text(hjust = 0.5,</span></span>
<span id="cb385-5938"><a href="#cb385-5938" aria-hidden="true" tabindex="-1"></a><span class="in">                                     vjust = -1,</span></span>
<span id="cb385-5939"><a href="#cb385-5939" aria-hidden="true" tabindex="-1"></a><span class="in">                                     size = 15 * 1.05,</span></span>
<span id="cb385-5940"><a href="#cb385-5940" aria-hidden="true" tabindex="-1"></a><span class="in">                                     face = "bold")) </span></span>
<span id="cb385-5941"><a href="#cb385-5941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5942"><a href="#cb385-5942" aria-hidden="true" tabindex="-1"></a><span class="in">future_2050</span></span>
<span id="cb385-5943"><a href="#cb385-5943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5944"><a href="#cb385-5944" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-5945"><a href="#cb385-5945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5946"><a href="#cb385-5946" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-5947"><a href="#cb385-5947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5948"><a href="#cb385-5948" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now let’s implement the same procedure in a loop, where we make a list of two plots<span class="dv">&amp;mdash;</span> one for 2050 and one for 2085:</span>
<span id="cb385-5949"><a href="#cb385-5949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5950"><a href="#cb385-5950" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 18.1k}</span></span>
<span id="cb385-5951"><a href="#cb385-5951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5952"><a href="#cb385-5952" aria-hidden="true" tabindex="-1"></a><span class="in">future_plot_list &lt;- list()</span></span>
<span id="cb385-5953"><a href="#cb385-5953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5954"><a href="#cb385-5954" aria-hidden="true" tabindex="-1"></a><span class="in">time_points &lt;- c(2050, 2085)</span></span>
<span id="cb385-5955"><a href="#cb385-5955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5956"><a href="#cb385-5956" aria-hidden="true" tabindex="-1"></a><span class="in">for(y in time_points)</span></span>
<span id="cb385-5957"><a href="#cb385-5957" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb385-5958"><a href="#cb385-5958" aria-hidden="true" tabindex="-1"></a><span class="in">  future_plot_list[[which(y == time_points)]] &lt;-</span></span>
<span id="cb385-5959"><a href="#cb385-5959" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot(data = future_data[which(future_data$Year==y),]) +</span></span>
<span id="cb385-5960"><a href="#cb385-5960" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_boxplot(aes_string("GCM",</span></span>
<span id="cb385-5961"><a href="#cb385-5961" aria-hidden="true" tabindex="-1"></a><span class="in">                            metric,</span></span>
<span id="cb385-5962"><a href="#cb385-5962" aria-hidden="true" tabindex="-1"></a><span class="in">                            fill="GCM")) +</span></span>
<span id="cb385-5963"><a href="#cb385-5963" aria-hidden="true" tabindex="-1"></a><span class="in">    facet_wrap(vars(SSP), nrow = 1) +</span></span>
<span id="cb385-5964"><a href="#cb385-5964" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_x_discrete(labels = NULL,</span></span>
<span id="cb385-5965"><a href="#cb385-5965" aria-hidden="true" tabindex="-1"></a><span class="in">                     expand = expansion(add = 1)) +</span></span>
<span id="cb385-5966"><a href="#cb385-5966" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_y_continuous(limits = c(0, </span></span>
<span id="cb385-5967"><a href="#cb385-5967" aria-hidden="true" tabindex="-1"></a><span class="in">                                  round(round(1.1*rng[2])))) +</span></span>
<span id="cb385-5968"><a href="#cb385-5968" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_text_npc(aes(npcx = "center",</span></span>
<span id="cb385-5969"><a href="#cb385-5969" aria-hidden="true" tabindex="-1"></a><span class="in">                      npcy = "top", </span></span>
<span id="cb385-5970"><a href="#cb385-5970" aria-hidden="true" tabindex="-1"></a><span class="in">                      label = Year),</span></span>
<span id="cb385-5971"><a href="#cb385-5971" aria-hidden="true" tabindex="-1"></a><span class="in">                  size = 5) +</span></span>
<span id="cb385-5972"><a href="#cb385-5972" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_bw(base_size = 15) +</span></span>
<span id="cb385-5973"><a href="#cb385-5973" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(axis.ticks.y = element_blank(),</span></span>
<span id="cb385-5974"><a href="#cb385-5974" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.text = element_blank(),</span></span>
<span id="cb385-5975"><a href="#cb385-5975" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.title = element_blank(),</span></span>
<span id="cb385-5976"><a href="#cb385-5976" aria-hidden="true" tabindex="-1"></a><span class="in">          legend.position = "bottom",</span></span>
<span id="cb385-5977"><a href="#cb385-5977" aria-hidden="true" tabindex="-1"></a><span class="in">          legend.margin = margin(0, </span></span>
<span id="cb385-5978"><a href="#cb385-5978" aria-hidden="true" tabindex="-1"></a><span class="in">                                 0, </span></span>
<span id="cb385-5979"><a href="#cb385-5979" aria-hidden="true" tabindex="-1"></a><span class="in">                                 0, </span></span>
<span id="cb385-5980"><a href="#cb385-5980" aria-hidden="true" tabindex="-1"></a><span class="in">                                 0, </span></span>
<span id="cb385-5981"><a href="#cb385-5981" aria-hidden="true" tabindex="-1"></a><span class="in">                                 "cm"),</span></span>
<span id="cb385-5982"><a href="#cb385-5982" aria-hidden="true" tabindex="-1"></a><span class="in">          legend.background = element_rect(),</span></span>
<span id="cb385-5983"><a href="#cb385-5983" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.background = element_blank(),</span></span>
<span id="cb385-5984"><a href="#cb385-5984" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.text = element_text(face = "bold"),</span></span>
<span id="cb385-5985"><a href="#cb385-5985" aria-hidden="true" tabindex="-1"></a><span class="in">          legend.box.spacing = unit(0, "cm"),</span></span>
<span id="cb385-5986"><a href="#cb385-5986" aria-hidden="true" tabindex="-1"></a><span class="in">          plot.subtitle = element_text(</span></span>
<span id="cb385-5987"><a href="#cb385-5987" aria-hidden="true" tabindex="-1"></a><span class="in">            hjust = 0.5,</span></span>
<span id="cb385-5988"><a href="#cb385-5988" aria-hidden="true" tabindex="-1"></a><span class="in">            vjust = -1,</span></span>
<span id="cb385-5989"><a href="#cb385-5989" aria-hidden="true" tabindex="-1"></a><span class="in">            size = 15 * 1.05,</span></span>
<span id="cb385-5990"><a href="#cb385-5990" aria-hidden="true" tabindex="-1"></a><span class="in">            face = "bold")) </span></span>
<span id="cb385-5991"><a href="#cb385-5991" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-5992"><a href="#cb385-5992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5993"><a href="#cb385-5993" aria-hidden="true" tabindex="-1"></a><span class="in">future_plot_list</span></span>
<span id="cb385-5994"><a href="#cb385-5994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5995"><a href="#cb385-5995" aria-hidden="true" tabindex="-1"></a><span class="in"># Put the two plots together using + sign</span></span>
<span id="cb385-5996"><a href="#cb385-5996" aria-hidden="true" tabindex="-1"></a><span class="in">both_plots &lt;- past_plot + future_plot_list</span></span>
<span id="cb385-5997"><a href="#cb385-5997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-5998"><a href="#cb385-5998" aria-hidden="true" tabindex="-1"></a><span class="in">both_plots</span></span>
<span id="cb385-5999"><a href="#cb385-5999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6000"><a href="#cb385-6000" aria-hidden="true" tabindex="-1"></a><span class="in">```</span> </span>
<span id="cb385-6001"><a href="#cb385-6001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6002"><a href="#cb385-6002" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-6003"><a href="#cb385-6003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6004"><a href="#cb385-6004" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>All the basics are there, but we need a few adjustments, mainly to the legend. </span>
<span id="cb385-6005"><a href="#cb385-6005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6006"><a href="#cb385-6006" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For this, we use the <span class="in">`plot_layout`</span> function of the <span class="co">[</span><span class="ot">`patchwork`</span><span class="co">](https://cran.r-project.org/web/packages/patchwork/patchwork.pdf)</span> package. </span>
<span id="cb385-6007"><a href="#cb385-6007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6008"><a href="#cb385-6008" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This supports the production of such patchwork figures, e.g. by collecting all legends and removing duplicates. This is handy, because we only want one version of the legend drawn. </span>
<span id="cb385-6009"><a href="#cb385-6009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6010"><a href="#cb385-6010" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We can also specify the width of the various plots. I’m making a vector <span class="in">`c(1,1.8,1.8)`</span> (using a slightly more flexible formulation) to specify that the width of each set of future plots should be 1.8 times the width of the past scenario plot</span>
<span id="cb385-6011"><a href="#cb385-6011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6012"><a href="#cb385-6012" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 18.1l}</span></span>
<span id="cb385-6013"><a href="#cb385-6013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6014"><a href="#cb385-6014" aria-hidden="true" tabindex="-1"></a><span class="in">plot &lt;- both_plots +</span></span>
<span id="cb385-6015"><a href="#cb385-6015" aria-hidden="true" tabindex="-1"></a><span class="in">           plot_layout(guides = "collect",</span></span>
<span id="cb385-6016"><a href="#cb385-6016" aria-hidden="true" tabindex="-1"></a><span class="in">                       widths = c(1,rep(2,length(future_plot_list))))</span></span>
<span id="cb385-6017"><a href="#cb385-6017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6018"><a href="#cb385-6018" aria-hidden="true" tabindex="-1"></a><span class="in"># Now we can’t really see the plot any more, so let’s place the legend at the </span></span>
<span id="cb385-6019"><a href="#cb385-6019" aria-hidden="true" tabindex="-1"></a><span class="in"># bottom. For some reason that probably has to do with the `patchwork` package, </span></span>
<span id="cb385-6020"><a href="#cb385-6020" aria-hidden="true" tabindex="-1"></a><span class="in"># we have to add the corresponding `theme` call after an `&amp;` symbol.</span></span>
<span id="cb385-6021"><a href="#cb385-6021" aria-hidden="true" tabindex="-1"></a><span class="in">plot &lt;- plot &amp; theme(legend.position = "bottom",</span></span>
<span id="cb385-6022"><a href="#cb385-6022" aria-hidden="true" tabindex="-1"></a><span class="in">                     legend.text = element_text(size=8),</span></span>
<span id="cb385-6023"><a href="#cb385-6023" aria-hidden="true" tabindex="-1"></a><span class="in">                     legend.title = element_text(size=10),</span></span>
<span id="cb385-6024"><a href="#cb385-6024" aria-hidden="true" tabindex="-1"></a><span class="in">                     axis.title.x = element_blank())</span></span>
<span id="cb385-6025"><a href="#cb385-6025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6026"><a href="#cb385-6026" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-6027"><a href="#cb385-6027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6028"><a href="#cb385-6028" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-6029"><a href="#cb385-6029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6030"><a href="#cb385-6030" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;18.2&lt;/span&gt;&amp;nbsp; The results</span></span>
<span id="cb385-6031"><a href="#cb385-6031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6032"><a href="#cb385-6032" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-6033"><a href="#cb385-6033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6034"><a href="#cb385-6034" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now we have some fairly nice ggplot figures showing a heat analysis for Bonn:</span>
<span id="cb385-6035"><a href="#cb385-6035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6036"><a href="#cb385-6036" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 18.2a}</span></span>
<span id="cb385-6037"><a href="#cb385-6037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6038"><a href="#cb385-6038" aria-hidden="true" tabindex="-1"></a><span class="in">plot</span></span>
<span id="cb385-6039"><a href="#cb385-6039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6040"><a href="#cb385-6040" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-6041"><a href="#cb385-6041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6042"><a href="#cb385-6042" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-6043"><a href="#cb385-6043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6044"><a href="#cb385-6044" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Do the same for the Chill model, by changing the <span class="in">`metric`</span> and <span class="in">`axis_label`</span>. </span>
<span id="cb385-6045"><a href="#cb385-6045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6046"><a href="#cb385-6046" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 18.2b}</span></span>
<span id="cb385-6047"><a href="#cb385-6047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6048"><a href="#cb385-6048" aria-hidden="true" tabindex="-1"></a><span class="in"># Define variables `metric` and `axis_label` to easily adjust later</span></span>
<span id="cb385-6049"><a href="#cb385-6049" aria-hidden="true" tabindex="-1"></a><span class="in">metric &lt;- "Chill_Portions"</span></span>
<span id="cb385-6050"><a href="#cb385-6050" aria-hidden="true" tabindex="-1"></a><span class="in">axis_label &lt;- "Chill (in CP)"</span></span>
<span id="cb385-6051"><a href="#cb385-6051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6052"><a href="#cb385-6052" aria-hidden="true" tabindex="-1"></a><span class="in">## get extreme values for the axis scale</span></span>
<span id="cb385-6053"><a href="#cb385-6053" aria-hidden="true" tabindex="-1"></a><span class="in"># range returns a vector containing the minimum and maximum of </span></span>
<span id="cb385-6054"><a href="#cb385-6054" aria-hidden="true" tabindex="-1"></a><span class="in"># all the given arguments.</span></span>
<span id="cb385-6055"><a href="#cb385-6055" aria-hidden="true" tabindex="-1"></a><span class="in">rng &lt;- range(past_observed[[metric]],</span></span>
<span id="cb385-6056"><a href="#cb385-6056" aria-hidden="true" tabindex="-1"></a><span class="in">             past_simulated[[metric]],</span></span>
<span id="cb385-6057"><a href="#cb385-6057" aria-hidden="true" tabindex="-1"></a><span class="in">             future_data[[metric]])  </span></span>
<span id="cb385-6058"><a href="#cb385-6058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6059"><a href="#cb385-6059" aria-hidden="true" tabindex="-1"></a><span class="in"># Past plot</span></span>
<span id="cb385-6060"><a href="#cb385-6060" aria-hidden="true" tabindex="-1"></a><span class="in">past_plot &lt;- ggplot() +</span></span>
<span id="cb385-6061"><a href="#cb385-6061" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_boxplot(data = past_simulated,</span></span>
<span id="cb385-6062"><a href="#cb385-6062" aria-hidden="true" tabindex="-1"></a><span class="in">               aes_string("as.numeric(Year)",</span></span>
<span id="cb385-6063"><a href="#cb385-6063" aria-hidden="true" tabindex="-1"></a><span class="in">                          metric,group="Year"),</span></span>
<span id="cb385-6064"><a href="#cb385-6064" aria-hidden="true" tabindex="-1"></a><span class="in">               fill = "skyblue") +</span></span>
<span id="cb385-6065"><a href="#cb385-6065" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(</span></span>
<span id="cb385-6066"><a href="#cb385-6066" aria-hidden="true" tabindex="-1"></a><span class="in">    limits = c(0, </span></span>
<span id="cb385-6067"><a href="#cb385-6067" aria-hidden="true" tabindex="-1"></a><span class="in">               round(rng[2] + rng[2]/10))) +</span></span>
<span id="cb385-6068"><a href="#cb385-6068" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Year", </span></span>
<span id="cb385-6069"><a href="#cb385-6069" aria-hidden="true" tabindex="-1"></a><span class="in">       y = axis_label) +</span></span>
<span id="cb385-6070"><a href="#cb385-6070" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(~ Scenario) +</span></span>
<span id="cb385-6071"><a href="#cb385-6071" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15)  +  </span></span>
<span id="cb385-6072"><a href="#cb385-6072" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(strip.background = element_blank(),</span></span>
<span id="cb385-6073"><a href="#cb385-6073" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.text = element_text(face = "bold"),</span></span>
<span id="cb385-6074"><a href="#cb385-6074" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.x = element_text(angle=45,</span></span>
<span id="cb385-6075"><a href="#cb385-6075" aria-hidden="true" tabindex="-1"></a><span class="in">                                   hjust=1))  +</span></span>
<span id="cb385-6076"><a href="#cb385-6076" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = past_observed,</span></span>
<span id="cb385-6077"><a href="#cb385-6077" aria-hidden="true" tabindex="-1"></a><span class="in">             aes_string("End_year",</span></span>
<span id="cb385-6078"><a href="#cb385-6078" aria-hidden="true" tabindex="-1"></a><span class="in">                        metric),</span></span>
<span id="cb385-6079"><a href="#cb385-6079" aria-hidden="true" tabindex="-1"></a><span class="in">             col = "blue")</span></span>
<span id="cb385-6080"><a href="#cb385-6080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6081"><a href="#cb385-6081" aria-hidden="true" tabindex="-1"></a><span class="in"># Future plots</span></span>
<span id="cb385-6082"><a href="#cb385-6082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6083"><a href="#cb385-6083" aria-hidden="true" tabindex="-1"></a><span class="in">y &lt;- 2050</span></span>
<span id="cb385-6084"><a href="#cb385-6084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6085"><a href="#cb385-6085" aria-hidden="true" tabindex="-1"></a><span class="in">future_2050 &lt;- ggplot(data= future_data[which(future_data$Year==y),]) +</span></span>
<span id="cb385-6086"><a href="#cb385-6086" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_boxplot(aes_string("GCM", </span></span>
<span id="cb385-6087"><a href="#cb385-6087" aria-hidden="true" tabindex="-1"></a><span class="in">                          metric, </span></span>
<span id="cb385-6088"><a href="#cb385-6088" aria-hidden="true" tabindex="-1"></a><span class="in">                          fill = "GCM")) +</span></span>
<span id="cb385-6089"><a href="#cb385-6089" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(SSP), nrow = 1) +</span></span>
<span id="cb385-6090"><a href="#cb385-6090" aria-hidden="true" tabindex="-1"></a><span class="in">   scale_x_discrete(labels = NULL,</span></span>
<span id="cb385-6091"><a href="#cb385-6091" aria-hidden="true" tabindex="-1"></a><span class="in">                    expand = expansion(add = 1))  +</span></span>
<span id="cb385-6092"><a href="#cb385-6092" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(limits = c(0, </span></span>
<span id="cb385-6093"><a href="#cb385-6093" aria-hidden="true" tabindex="-1"></a><span class="in">                                round(round(1.1*rng[2])))) +</span></span>
<span id="cb385-6094"><a href="#cb385-6094" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_text_npc(aes(npcx = "center", </span></span>
<span id="cb385-6095"><a href="#cb385-6095" aria-hidden="true" tabindex="-1"></a><span class="in">                      npcy = "top",</span></span>
<span id="cb385-6096"><a href="#cb385-6096" aria-hidden="true" tabindex="-1"></a><span class="in">                      label = Year),</span></span>
<span id="cb385-6097"><a href="#cb385-6097" aria-hidden="true" tabindex="-1"></a><span class="in">                  size = 5) +</span></span>
<span id="cb385-6098"><a href="#cb385-6098" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +</span></span>
<span id="cb385-6099"><a href="#cb385-6099" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.ticks.y = element_blank(),</span></span>
<span id="cb385-6100"><a href="#cb385-6100" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text = element_blank(),</span></span>
<span id="cb385-6101"><a href="#cb385-6101" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.title = element_blank(),</span></span>
<span id="cb385-6102"><a href="#cb385-6102" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.position = "bottom",</span></span>
<span id="cb385-6103"><a href="#cb385-6103" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.margin = margin(0,</span></span>
<span id="cb385-6104"><a href="#cb385-6104" aria-hidden="true" tabindex="-1"></a><span class="in">                               0,</span></span>
<span id="cb385-6105"><a href="#cb385-6105" aria-hidden="true" tabindex="-1"></a><span class="in">                               0,</span></span>
<span id="cb385-6106"><a href="#cb385-6106" aria-hidden="true" tabindex="-1"></a><span class="in">                               0,</span></span>
<span id="cb385-6107"><a href="#cb385-6107" aria-hidden="true" tabindex="-1"></a><span class="in">                               "cm"),</span></span>
<span id="cb385-6108"><a href="#cb385-6108" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.background = element_rect(),</span></span>
<span id="cb385-6109"><a href="#cb385-6109" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.background = element_blank(),</span></span>
<span id="cb385-6110"><a href="#cb385-6110" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.text = element_text(face = "bold"),</span></span>
<span id="cb385-6111"><a href="#cb385-6111" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.box.spacing = unit(0, "cm"),</span></span>
<span id="cb385-6112"><a href="#cb385-6112" aria-hidden="true" tabindex="-1"></a><span class="in">        plot.subtitle = element_text(hjust = 0.5,</span></span>
<span id="cb385-6113"><a href="#cb385-6113" aria-hidden="true" tabindex="-1"></a><span class="in">                                     vjust = -1,</span></span>
<span id="cb385-6114"><a href="#cb385-6114" aria-hidden="true" tabindex="-1"></a><span class="in">                                     size = 15 * 1.05,</span></span>
<span id="cb385-6115"><a href="#cb385-6115" aria-hidden="true" tabindex="-1"></a><span class="in">                                     face = "bold")) </span></span>
<span id="cb385-6116"><a href="#cb385-6116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6117"><a href="#cb385-6117" aria-hidden="true" tabindex="-1"></a><span class="in">future_plot_list &lt;- list()</span></span>
<span id="cb385-6118"><a href="#cb385-6118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6119"><a href="#cb385-6119" aria-hidden="true" tabindex="-1"></a><span class="in">time_points &lt;- c(2050, 2085)</span></span>
<span id="cb385-6120"><a href="#cb385-6120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6121"><a href="#cb385-6121" aria-hidden="true" tabindex="-1"></a><span class="in">for(y in time_points)</span></span>
<span id="cb385-6122"><a href="#cb385-6122" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb385-6123"><a href="#cb385-6123" aria-hidden="true" tabindex="-1"></a><span class="in">  future_plot_list[[which(y == time_points)]] &lt;-</span></span>
<span id="cb385-6124"><a href="#cb385-6124" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot(data = future_data[which(future_data$Year==y),]) +</span></span>
<span id="cb385-6125"><a href="#cb385-6125" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_boxplot(aes_string("GCM",</span></span>
<span id="cb385-6126"><a href="#cb385-6126" aria-hidden="true" tabindex="-1"></a><span class="in">                            metric,</span></span>
<span id="cb385-6127"><a href="#cb385-6127" aria-hidden="true" tabindex="-1"></a><span class="in">                            fill="GCM")) +</span></span>
<span id="cb385-6128"><a href="#cb385-6128" aria-hidden="true" tabindex="-1"></a><span class="in">    facet_wrap(vars(SSP), nrow = 1) +</span></span>
<span id="cb385-6129"><a href="#cb385-6129" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_x_discrete(labels = NULL,</span></span>
<span id="cb385-6130"><a href="#cb385-6130" aria-hidden="true" tabindex="-1"></a><span class="in">                     expand = expansion(add = 1)) +</span></span>
<span id="cb385-6131"><a href="#cb385-6131" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_y_continuous(limits = c(0, </span></span>
<span id="cb385-6132"><a href="#cb385-6132" aria-hidden="true" tabindex="-1"></a><span class="in">                                  round(round(1.1*rng[2])))) +</span></span>
<span id="cb385-6133"><a href="#cb385-6133" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_text_npc(aes(npcx = "center",</span></span>
<span id="cb385-6134"><a href="#cb385-6134" aria-hidden="true" tabindex="-1"></a><span class="in">                      npcy = "top", </span></span>
<span id="cb385-6135"><a href="#cb385-6135" aria-hidden="true" tabindex="-1"></a><span class="in">                      label = Year),</span></span>
<span id="cb385-6136"><a href="#cb385-6136" aria-hidden="true" tabindex="-1"></a><span class="in">                  size = 5) +</span></span>
<span id="cb385-6137"><a href="#cb385-6137" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_bw(base_size = 15) +</span></span>
<span id="cb385-6138"><a href="#cb385-6138" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(axis.ticks.y = element_blank(),</span></span>
<span id="cb385-6139"><a href="#cb385-6139" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.text = element_blank(),</span></span>
<span id="cb385-6140"><a href="#cb385-6140" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.title = element_blank(),</span></span>
<span id="cb385-6141"><a href="#cb385-6141" aria-hidden="true" tabindex="-1"></a><span class="in">          legend.position = "bottom",</span></span>
<span id="cb385-6142"><a href="#cb385-6142" aria-hidden="true" tabindex="-1"></a><span class="in">          legend.margin = margin(0, </span></span>
<span id="cb385-6143"><a href="#cb385-6143" aria-hidden="true" tabindex="-1"></a><span class="in">                                 0, </span></span>
<span id="cb385-6144"><a href="#cb385-6144" aria-hidden="true" tabindex="-1"></a><span class="in">                                 0, </span></span>
<span id="cb385-6145"><a href="#cb385-6145" aria-hidden="true" tabindex="-1"></a><span class="in">                                 0, </span></span>
<span id="cb385-6146"><a href="#cb385-6146" aria-hidden="true" tabindex="-1"></a><span class="in">                                 "cm"),</span></span>
<span id="cb385-6147"><a href="#cb385-6147" aria-hidden="true" tabindex="-1"></a><span class="in">          legend.background = element_rect(),</span></span>
<span id="cb385-6148"><a href="#cb385-6148" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.background = element_blank(),</span></span>
<span id="cb385-6149"><a href="#cb385-6149" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.text = element_text(face = "bold"),</span></span>
<span id="cb385-6150"><a href="#cb385-6150" aria-hidden="true" tabindex="-1"></a><span class="in">          legend.box.spacing = unit(0, "cm"),</span></span>
<span id="cb385-6151"><a href="#cb385-6151" aria-hidden="true" tabindex="-1"></a><span class="in">          plot.subtitle = element_text(</span></span>
<span id="cb385-6152"><a href="#cb385-6152" aria-hidden="true" tabindex="-1"></a><span class="in">            hjust = 0.5,</span></span>
<span id="cb385-6153"><a href="#cb385-6153" aria-hidden="true" tabindex="-1"></a><span class="in">            vjust = -1,</span></span>
<span id="cb385-6154"><a href="#cb385-6154" aria-hidden="true" tabindex="-1"></a><span class="in">            size = 15 * 1.05,</span></span>
<span id="cb385-6155"><a href="#cb385-6155" aria-hidden="true" tabindex="-1"></a><span class="in">            face = "bold")) </span></span>
<span id="cb385-6156"><a href="#cb385-6156" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-6157"><a href="#cb385-6157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6158"><a href="#cb385-6158" aria-hidden="true" tabindex="-1"></a><span class="in">both_plots &lt;- past_plot + future_plot_list</span></span>
<span id="cb385-6159"><a href="#cb385-6159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6160"><a href="#cb385-6160" aria-hidden="true" tabindex="-1"></a><span class="in">plot &lt;- both_plots +</span></span>
<span id="cb385-6161"><a href="#cb385-6161" aria-hidden="true" tabindex="-1"></a><span class="in">           plot_layout(guides = "collect",</span></span>
<span id="cb385-6162"><a href="#cb385-6162" aria-hidden="true" tabindex="-1"></a><span class="in">                       widths = c(1,rep(2,length(future_plot_list))))</span></span>
<span id="cb385-6163"><a href="#cb385-6163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6164"><a href="#cb385-6164" aria-hidden="true" tabindex="-1"></a><span class="in">plot &lt;- plot &amp; theme(legend.position = "bottom",</span></span>
<span id="cb385-6165"><a href="#cb385-6165" aria-hidden="true" tabindex="-1"></a><span class="in">                     legend.text = element_text(size=8),</span></span>
<span id="cb385-6166"><a href="#cb385-6166" aria-hidden="true" tabindex="-1"></a><span class="in">                     legend.title = element_text(size=10),</span></span>
<span id="cb385-6167"><a href="#cb385-6167" aria-hidden="true" tabindex="-1"></a><span class="in">                     axis.title.x = element_blank())</span></span>
<span id="cb385-6168"><a href="#cb385-6168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6169"><a href="#cb385-6169" aria-hidden="true" tabindex="-1"></a><span class="in">plot</span></span>
<span id="cb385-6170"><a href="#cb385-6170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6171"><a href="#cb385-6171" aria-hidden="true" tabindex="-1"></a><span class="in">```</span>    </span>
<span id="cb385-6172"><a href="#cb385-6172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6173"><a href="#cb385-6173" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-6174"><a href="#cb385-6174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6175"><a href="#cb385-6175" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Plot the Frost duration:</span>
<span id="cb385-6176"><a href="#cb385-6176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6177"><a href="#cb385-6177" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 18.2c}</span></span>
<span id="cb385-6178"><a href="#cb385-6178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6179"><a href="#cb385-6179" aria-hidden="true" tabindex="-1"></a><span class="in"># Define variables `metric` and `axis_label` to easily adjust later</span></span>
<span id="cb385-6180"><a href="#cb385-6180" aria-hidden="true" tabindex="-1"></a><span class="in">metric &lt;- "Frost_H"</span></span>
<span id="cb385-6181"><a href="#cb385-6181" aria-hidden="true" tabindex="-1"></a><span class="in">axis_label &lt;- "Frost duration (in hours)"</span></span>
<span id="cb385-6182"><a href="#cb385-6182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6183"><a href="#cb385-6183" aria-hidden="true" tabindex="-1"></a><span class="in">## get extreme values for the axis scale</span></span>
<span id="cb385-6184"><a href="#cb385-6184" aria-hidden="true" tabindex="-1"></a><span class="in"># range returns a vector containing the minimum and maximum of </span></span>
<span id="cb385-6185"><a href="#cb385-6185" aria-hidden="true" tabindex="-1"></a><span class="in"># all the given arguments.</span></span>
<span id="cb385-6186"><a href="#cb385-6186" aria-hidden="true" tabindex="-1"></a><span class="in">rng &lt;- range(past_observed[[metric]],</span></span>
<span id="cb385-6187"><a href="#cb385-6187" aria-hidden="true" tabindex="-1"></a><span class="in">             past_simulated[[metric]],</span></span>
<span id="cb385-6188"><a href="#cb385-6188" aria-hidden="true" tabindex="-1"></a><span class="in">             future_data[[metric]])  </span></span>
<span id="cb385-6189"><a href="#cb385-6189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6190"><a href="#cb385-6190" aria-hidden="true" tabindex="-1"></a><span class="in"># Past plot</span></span>
<span id="cb385-6191"><a href="#cb385-6191" aria-hidden="true" tabindex="-1"></a><span class="in">past_plot &lt;- ggplot() +</span></span>
<span id="cb385-6192"><a href="#cb385-6192" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_boxplot(data = past_simulated,</span></span>
<span id="cb385-6193"><a href="#cb385-6193" aria-hidden="true" tabindex="-1"></a><span class="in">               aes_string("as.numeric(Year)",</span></span>
<span id="cb385-6194"><a href="#cb385-6194" aria-hidden="true" tabindex="-1"></a><span class="in">                          metric,group="Year"),</span></span>
<span id="cb385-6195"><a href="#cb385-6195" aria-hidden="true" tabindex="-1"></a><span class="in">               fill = "skyblue") +</span></span>
<span id="cb385-6196"><a href="#cb385-6196" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(</span></span>
<span id="cb385-6197"><a href="#cb385-6197" aria-hidden="true" tabindex="-1"></a><span class="in">    limits = c(0, </span></span>
<span id="cb385-6198"><a href="#cb385-6198" aria-hidden="true" tabindex="-1"></a><span class="in">               round(rng[2] + rng[2]/10))) +</span></span>
<span id="cb385-6199"><a href="#cb385-6199" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Year", </span></span>
<span id="cb385-6200"><a href="#cb385-6200" aria-hidden="true" tabindex="-1"></a><span class="in">       y = axis_label) +</span></span>
<span id="cb385-6201"><a href="#cb385-6201" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(~ Scenario) +</span></span>
<span id="cb385-6202"><a href="#cb385-6202" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15)  +  </span></span>
<span id="cb385-6203"><a href="#cb385-6203" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(strip.background = element_blank(),</span></span>
<span id="cb385-6204"><a href="#cb385-6204" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.text = element_text(face = "bold"),</span></span>
<span id="cb385-6205"><a href="#cb385-6205" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.x = element_text(angle=45,</span></span>
<span id="cb385-6206"><a href="#cb385-6206" aria-hidden="true" tabindex="-1"></a><span class="in">                                   hjust=1))  +</span></span>
<span id="cb385-6207"><a href="#cb385-6207" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data = past_observed,</span></span>
<span id="cb385-6208"><a href="#cb385-6208" aria-hidden="true" tabindex="-1"></a><span class="in">             aes_string("End_year",</span></span>
<span id="cb385-6209"><a href="#cb385-6209" aria-hidden="true" tabindex="-1"></a><span class="in">                        metric),</span></span>
<span id="cb385-6210"><a href="#cb385-6210" aria-hidden="true" tabindex="-1"></a><span class="in">             col = "blue")</span></span>
<span id="cb385-6211"><a href="#cb385-6211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6212"><a href="#cb385-6212" aria-hidden="true" tabindex="-1"></a><span class="in"># Future plots</span></span>
<span id="cb385-6213"><a href="#cb385-6213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6214"><a href="#cb385-6214" aria-hidden="true" tabindex="-1"></a><span class="in">y &lt;- 2050</span></span>
<span id="cb385-6215"><a href="#cb385-6215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6216"><a href="#cb385-6216" aria-hidden="true" tabindex="-1"></a><span class="in">future_2050 &lt;- ggplot(data= future_data[which(future_data$Year==y),]) +</span></span>
<span id="cb385-6217"><a href="#cb385-6217" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_boxplot(aes_string("GCM", </span></span>
<span id="cb385-6218"><a href="#cb385-6218" aria-hidden="true" tabindex="-1"></a><span class="in">                          metric, </span></span>
<span id="cb385-6219"><a href="#cb385-6219" aria-hidden="true" tabindex="-1"></a><span class="in">                          fill = "GCM")) +</span></span>
<span id="cb385-6220"><a href="#cb385-6220" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(SSP), nrow = 1) +</span></span>
<span id="cb385-6221"><a href="#cb385-6221" aria-hidden="true" tabindex="-1"></a><span class="in">   scale_x_discrete(labels = NULL,</span></span>
<span id="cb385-6222"><a href="#cb385-6222" aria-hidden="true" tabindex="-1"></a><span class="in">                    expand = expansion(add = 1))  +</span></span>
<span id="cb385-6223"><a href="#cb385-6223" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(limits = c(0, </span></span>
<span id="cb385-6224"><a href="#cb385-6224" aria-hidden="true" tabindex="-1"></a><span class="in">                                round(round(1.1*rng[2])))) +</span></span>
<span id="cb385-6225"><a href="#cb385-6225" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_text_npc(aes(npcx = "center", </span></span>
<span id="cb385-6226"><a href="#cb385-6226" aria-hidden="true" tabindex="-1"></a><span class="in">                      npcy = "top",</span></span>
<span id="cb385-6227"><a href="#cb385-6227" aria-hidden="true" tabindex="-1"></a><span class="in">                      label = Year),</span></span>
<span id="cb385-6228"><a href="#cb385-6228" aria-hidden="true" tabindex="-1"></a><span class="in">                  size = 5) +</span></span>
<span id="cb385-6229"><a href="#cb385-6229" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +</span></span>
<span id="cb385-6230"><a href="#cb385-6230" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.ticks.y = element_blank(),</span></span>
<span id="cb385-6231"><a href="#cb385-6231" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text = element_blank(),</span></span>
<span id="cb385-6232"><a href="#cb385-6232" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.title = element_blank(),</span></span>
<span id="cb385-6233"><a href="#cb385-6233" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.position = "bottom",</span></span>
<span id="cb385-6234"><a href="#cb385-6234" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.margin = margin(0,</span></span>
<span id="cb385-6235"><a href="#cb385-6235" aria-hidden="true" tabindex="-1"></a><span class="in">                               0,</span></span>
<span id="cb385-6236"><a href="#cb385-6236" aria-hidden="true" tabindex="-1"></a><span class="in">                               0,</span></span>
<span id="cb385-6237"><a href="#cb385-6237" aria-hidden="true" tabindex="-1"></a><span class="in">                               0,</span></span>
<span id="cb385-6238"><a href="#cb385-6238" aria-hidden="true" tabindex="-1"></a><span class="in">                               "cm"),</span></span>
<span id="cb385-6239"><a href="#cb385-6239" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.background = element_rect(),</span></span>
<span id="cb385-6240"><a href="#cb385-6240" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.background = element_blank(),</span></span>
<span id="cb385-6241"><a href="#cb385-6241" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.text = element_text(face = "bold"),</span></span>
<span id="cb385-6242"><a href="#cb385-6242" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.box.spacing = unit(0, "cm"),</span></span>
<span id="cb385-6243"><a href="#cb385-6243" aria-hidden="true" tabindex="-1"></a><span class="in">        plot.subtitle = element_text(hjust = 0.5,</span></span>
<span id="cb385-6244"><a href="#cb385-6244" aria-hidden="true" tabindex="-1"></a><span class="in">                                     vjust = -1,</span></span>
<span id="cb385-6245"><a href="#cb385-6245" aria-hidden="true" tabindex="-1"></a><span class="in">                                     size = 15 * 1.05,</span></span>
<span id="cb385-6246"><a href="#cb385-6246" aria-hidden="true" tabindex="-1"></a><span class="in">                                     face = "bold")) </span></span>
<span id="cb385-6247"><a href="#cb385-6247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6248"><a href="#cb385-6248" aria-hidden="true" tabindex="-1"></a><span class="in">future_plot_list &lt;- list()</span></span>
<span id="cb385-6249"><a href="#cb385-6249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6250"><a href="#cb385-6250" aria-hidden="true" tabindex="-1"></a><span class="in">time_points &lt;- c(2050, 2085)</span></span>
<span id="cb385-6251"><a href="#cb385-6251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6252"><a href="#cb385-6252" aria-hidden="true" tabindex="-1"></a><span class="in">for(y in time_points)</span></span>
<span id="cb385-6253"><a href="#cb385-6253" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb385-6254"><a href="#cb385-6254" aria-hidden="true" tabindex="-1"></a><span class="in">  future_plot_list[[which(y == time_points)]] &lt;-</span></span>
<span id="cb385-6255"><a href="#cb385-6255" aria-hidden="true" tabindex="-1"></a><span class="in">    ggplot(data = future_data[which(future_data$Year==y),]) +</span></span>
<span id="cb385-6256"><a href="#cb385-6256" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_boxplot(aes_string("GCM",</span></span>
<span id="cb385-6257"><a href="#cb385-6257" aria-hidden="true" tabindex="-1"></a><span class="in">                            metric,</span></span>
<span id="cb385-6258"><a href="#cb385-6258" aria-hidden="true" tabindex="-1"></a><span class="in">                            fill="GCM")) +</span></span>
<span id="cb385-6259"><a href="#cb385-6259" aria-hidden="true" tabindex="-1"></a><span class="in">    facet_wrap(vars(SSP), nrow = 1) +</span></span>
<span id="cb385-6260"><a href="#cb385-6260" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_x_discrete(labels = NULL,</span></span>
<span id="cb385-6261"><a href="#cb385-6261" aria-hidden="true" tabindex="-1"></a><span class="in">                     expand = expansion(add = 1)) +</span></span>
<span id="cb385-6262"><a href="#cb385-6262" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_y_continuous(limits = c(0, </span></span>
<span id="cb385-6263"><a href="#cb385-6263" aria-hidden="true" tabindex="-1"></a><span class="in">                                  round(round(1.1*rng[2])))) +</span></span>
<span id="cb385-6264"><a href="#cb385-6264" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_text_npc(aes(npcx = "center",</span></span>
<span id="cb385-6265"><a href="#cb385-6265" aria-hidden="true" tabindex="-1"></a><span class="in">                      npcy = "top", </span></span>
<span id="cb385-6266"><a href="#cb385-6266" aria-hidden="true" tabindex="-1"></a><span class="in">                      label = Year),</span></span>
<span id="cb385-6267"><a href="#cb385-6267" aria-hidden="true" tabindex="-1"></a><span class="in">                  size = 5) +</span></span>
<span id="cb385-6268"><a href="#cb385-6268" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_bw(base_size = 15) +</span></span>
<span id="cb385-6269"><a href="#cb385-6269" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(axis.ticks.y = element_blank(),</span></span>
<span id="cb385-6270"><a href="#cb385-6270" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.text = element_blank(),</span></span>
<span id="cb385-6271"><a href="#cb385-6271" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.title = element_blank(),</span></span>
<span id="cb385-6272"><a href="#cb385-6272" aria-hidden="true" tabindex="-1"></a><span class="in">          legend.position = "bottom",</span></span>
<span id="cb385-6273"><a href="#cb385-6273" aria-hidden="true" tabindex="-1"></a><span class="in">          legend.margin = margin(0, </span></span>
<span id="cb385-6274"><a href="#cb385-6274" aria-hidden="true" tabindex="-1"></a><span class="in">                                 0, </span></span>
<span id="cb385-6275"><a href="#cb385-6275" aria-hidden="true" tabindex="-1"></a><span class="in">                                 0, </span></span>
<span id="cb385-6276"><a href="#cb385-6276" aria-hidden="true" tabindex="-1"></a><span class="in">                                 0, </span></span>
<span id="cb385-6277"><a href="#cb385-6277" aria-hidden="true" tabindex="-1"></a><span class="in">                                 "cm"),</span></span>
<span id="cb385-6278"><a href="#cb385-6278" aria-hidden="true" tabindex="-1"></a><span class="in">          legend.background = element_rect(),</span></span>
<span id="cb385-6279"><a href="#cb385-6279" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.background = element_blank(),</span></span>
<span id="cb385-6280"><a href="#cb385-6280" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.text = element_text(face = "bold"),</span></span>
<span id="cb385-6281"><a href="#cb385-6281" aria-hidden="true" tabindex="-1"></a><span class="in">          legend.box.spacing = unit(0, "cm"),</span></span>
<span id="cb385-6282"><a href="#cb385-6282" aria-hidden="true" tabindex="-1"></a><span class="in">          plot.subtitle = element_text(</span></span>
<span id="cb385-6283"><a href="#cb385-6283" aria-hidden="true" tabindex="-1"></a><span class="in">            hjust = 0.5,</span></span>
<span id="cb385-6284"><a href="#cb385-6284" aria-hidden="true" tabindex="-1"></a><span class="in">            vjust = -1,</span></span>
<span id="cb385-6285"><a href="#cb385-6285" aria-hidden="true" tabindex="-1"></a><span class="in">            size = 15 * 1.05,</span></span>
<span id="cb385-6286"><a href="#cb385-6286" aria-hidden="true" tabindex="-1"></a><span class="in">            face = "bold")) </span></span>
<span id="cb385-6287"><a href="#cb385-6287" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-6288"><a href="#cb385-6288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6289"><a href="#cb385-6289" aria-hidden="true" tabindex="-1"></a><span class="in">both_plots &lt;- past_plot + future_plot_list</span></span>
<span id="cb385-6290"><a href="#cb385-6290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6291"><a href="#cb385-6291" aria-hidden="true" tabindex="-1"></a><span class="in">plot &lt;- both_plots +</span></span>
<span id="cb385-6292"><a href="#cb385-6292" aria-hidden="true" tabindex="-1"></a><span class="in">           plot_layout(guides = "collect",</span></span>
<span id="cb385-6293"><a href="#cb385-6293" aria-hidden="true" tabindex="-1"></a><span class="in">                       widths = c(1,rep(2,length(future_plot_list))))</span></span>
<span id="cb385-6294"><a href="#cb385-6294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6295"><a href="#cb385-6295" aria-hidden="true" tabindex="-1"></a><span class="in">plot &lt;- plot &amp; theme(legend.position = "bottom",</span></span>
<span id="cb385-6296"><a href="#cb385-6296" aria-hidden="true" tabindex="-1"></a><span class="in">                     legend.text = element_text(size=8),</span></span>
<span id="cb385-6297"><a href="#cb385-6297" aria-hidden="true" tabindex="-1"></a><span class="in">                     legend.title = element_text(size=10),</span></span>
<span id="cb385-6298"><a href="#cb385-6298" aria-hidden="true" tabindex="-1"></a><span class="in">                     axis.title.x = element_blank())</span></span>
<span id="cb385-6299"><a href="#cb385-6299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6300"><a href="#cb385-6300" aria-hidden="true" tabindex="-1"></a><span class="in">plot</span></span>
<span id="cb385-6301"><a href="#cb385-6301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6302"><a href="#cb385-6302" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-6303"><a href="#cb385-6303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6304"><a href="#cb385-6304" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-6305"><a href="#cb385-6305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6306"><a href="#cb385-6306" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If we wanted to make a generally applicable function that does all the processing we just set up, we’d have to make sure that the function produces warnings or errors when it’s fed with inappropriate inputs, and that it’s flexible enough to deal with various types of inputs. </span>
<span id="cb385-6307"><a href="#cb385-6307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6308"><a href="#cb385-6308" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>But let’s assume we only want to use it with data that has the same structure as what we’ve used so far. Then we can just take all the commands so far and wrap them in a function call:</span>
<span id="cb385-6309"><a href="#cb385-6309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6310"><a href="#cb385-6310" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 18.2d}</span></span>
<span id="cb385-6311"><a href="#cb385-6311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6312"><a href="#cb385-6312" aria-hidden="true" tabindex="-1"></a><span class="in">plot_scenarios_gg &lt;- function(past_observed,</span></span>
<span id="cb385-6313"><a href="#cb385-6313" aria-hidden="true" tabindex="-1"></a><span class="in">                              past_simulated,</span></span>
<span id="cb385-6314"><a href="#cb385-6314" aria-hidden="true" tabindex="-1"></a><span class="in">                              future_data,</span></span>
<span id="cb385-6315"><a href="#cb385-6315" aria-hidden="true" tabindex="-1"></a><span class="in">                              metric,</span></span>
<span id="cb385-6316"><a href="#cb385-6316" aria-hidden="true" tabindex="-1"></a><span class="in">                              axis_label,</span></span>
<span id="cb385-6317"><a href="#cb385-6317" aria-hidden="true" tabindex="-1"></a><span class="in">                              time_points)</span></span>
<span id="cb385-6318"><a href="#cb385-6318" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb385-6319"><a href="#cb385-6319" aria-hidden="true" tabindex="-1"></a><span class="in">  rng &lt;- range(past_observed[[metric]],</span></span>
<span id="cb385-6320"><a href="#cb385-6320" aria-hidden="true" tabindex="-1"></a><span class="in">               past_simulated[[metric]],</span></span>
<span id="cb385-6321"><a href="#cb385-6321" aria-hidden="true" tabindex="-1"></a><span class="in">               future_data[[metric]])  </span></span>
<span id="cb385-6322"><a href="#cb385-6322" aria-hidden="true" tabindex="-1"></a><span class="in">  past_plot &lt;- ggplot() +</span></span>
<span id="cb385-6323"><a href="#cb385-6323" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_boxplot(data = past_simulated,</span></span>
<span id="cb385-6324"><a href="#cb385-6324" aria-hidden="true" tabindex="-1"></a><span class="in">                 aes_string("as.numeric(Year)",</span></span>
<span id="cb385-6325"><a href="#cb385-6325" aria-hidden="true" tabindex="-1"></a><span class="in">                            metric,</span></span>
<span id="cb385-6326"><a href="#cb385-6326" aria-hidden="true" tabindex="-1"></a><span class="in">                            group="Year"),</span></span>
<span id="cb385-6327"><a href="#cb385-6327" aria-hidden="true" tabindex="-1"></a><span class="in">                 fill="skyblue") +</span></span>
<span id="cb385-6328"><a href="#cb385-6328" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_y_continuous(limits = c(0, </span></span>
<span id="cb385-6329"><a href="#cb385-6329" aria-hidden="true" tabindex="-1"></a><span class="in">                                  round(round(1.1*rng[2])))) +</span></span>
<span id="cb385-6330"><a href="#cb385-6330" aria-hidden="true" tabindex="-1"></a><span class="in">    labs(x = "Year", y = axis_label) +</span></span>
<span id="cb385-6331"><a href="#cb385-6331" aria-hidden="true" tabindex="-1"></a><span class="in">    facet_grid(~ Scenario) +</span></span>
<span id="cb385-6332"><a href="#cb385-6332" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_bw(base_size = 15) +  </span></span>
<span id="cb385-6333"><a href="#cb385-6333" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(strip.background = element_blank(),</span></span>
<span id="cb385-6334"><a href="#cb385-6334" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.text = element_text(face = "bold"),</span></span>
<span id="cb385-6335"><a href="#cb385-6335" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.text.x = element_text(angle=45, </span></span>
<span id="cb385-6336"><a href="#cb385-6336" aria-hidden="true" tabindex="-1"></a><span class="in">                                     hjust=1)) +</span></span>
<span id="cb385-6337"><a href="#cb385-6337" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_point(data = past_observed,</span></span>
<span id="cb385-6338"><a href="#cb385-6338" aria-hidden="true" tabindex="-1"></a><span class="in">               aes_string("End_year",</span></span>
<span id="cb385-6339"><a href="#cb385-6339" aria-hidden="true" tabindex="-1"></a><span class="in">                          metric),</span></span>
<span id="cb385-6340"><a href="#cb385-6340" aria-hidden="true" tabindex="-1"></a><span class="in">               col="blue")</span></span>
<span id="cb385-6341"><a href="#cb385-6341" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-6342"><a href="#cb385-6342" aria-hidden="true" tabindex="-1"></a><span class="in">  future_plot_list &lt;- list()</span></span>
<span id="cb385-6343"><a href="#cb385-6343" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-6344"><a href="#cb385-6344" aria-hidden="true" tabindex="-1"></a><span class="in">  for(y in time_points)</span></span>
<span id="cb385-6345"><a href="#cb385-6345" aria-hidden="true" tabindex="-1"></a><span class="in">  {</span></span>
<span id="cb385-6346"><a href="#cb385-6346" aria-hidden="true" tabindex="-1"></a><span class="in">    future_plot_list[[which(y == time_points)]] &lt;-</span></span>
<span id="cb385-6347"><a href="#cb385-6347" aria-hidden="true" tabindex="-1"></a><span class="in">      ggplot(data = future_data[which(future_data$Year==y),]) +</span></span>
<span id="cb385-6348"><a href="#cb385-6348" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_boxplot(aes_string("GCM", </span></span>
<span id="cb385-6349"><a href="#cb385-6349" aria-hidden="true" tabindex="-1"></a><span class="in">                              metric, </span></span>
<span id="cb385-6350"><a href="#cb385-6350" aria-hidden="true" tabindex="-1"></a><span class="in">                              fill="GCM")) +</span></span>
<span id="cb385-6351"><a href="#cb385-6351" aria-hidden="true" tabindex="-1"></a><span class="in">      facet_wrap(vars(SSP), nrow = 1) +</span></span>
<span id="cb385-6352"><a href="#cb385-6352" aria-hidden="true" tabindex="-1"></a><span class="in">      scale_x_discrete(labels = NULL,</span></span>
<span id="cb385-6353"><a href="#cb385-6353" aria-hidden="true" tabindex="-1"></a><span class="in">                       expand = expansion(add = 1)) +</span></span>
<span id="cb385-6354"><a href="#cb385-6354" aria-hidden="true" tabindex="-1"></a><span class="in">      scale_y_continuous(limits = c(0, </span></span>
<span id="cb385-6355"><a href="#cb385-6355" aria-hidden="true" tabindex="-1"></a><span class="in">                                    round(round(1.1*rng[2])))) +</span></span>
<span id="cb385-6356"><a href="#cb385-6356" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_text_npc(aes(npcx = "center",</span></span>
<span id="cb385-6357"><a href="#cb385-6357" aria-hidden="true" tabindex="-1"></a><span class="in">                        npcy = "top",</span></span>
<span id="cb385-6358"><a href="#cb385-6358" aria-hidden="true" tabindex="-1"></a><span class="in">                        label = Year),</span></span>
<span id="cb385-6359"><a href="#cb385-6359" aria-hidden="true" tabindex="-1"></a><span class="in">                    size = 5) +</span></span>
<span id="cb385-6360"><a href="#cb385-6360" aria-hidden="true" tabindex="-1"></a><span class="in">      theme_bw(base_size = 15) +</span></span>
<span id="cb385-6361"><a href="#cb385-6361" aria-hidden="true" tabindex="-1"></a><span class="in">      theme(axis.ticks.y = element_blank(),</span></span>
<span id="cb385-6362"><a href="#cb385-6362" aria-hidden="true" tabindex="-1"></a><span class="in">            axis.text = element_blank(),</span></span>
<span id="cb385-6363"><a href="#cb385-6363" aria-hidden="true" tabindex="-1"></a><span class="in">            axis.title = element_blank(),</span></span>
<span id="cb385-6364"><a href="#cb385-6364" aria-hidden="true" tabindex="-1"></a><span class="in">            legend.position = "bottom",</span></span>
<span id="cb385-6365"><a href="#cb385-6365" aria-hidden="true" tabindex="-1"></a><span class="in">            legend.margin = margin(0,</span></span>
<span id="cb385-6366"><a href="#cb385-6366" aria-hidden="true" tabindex="-1"></a><span class="in">                                   0, </span></span>
<span id="cb385-6367"><a href="#cb385-6367" aria-hidden="true" tabindex="-1"></a><span class="in">                                   0, </span></span>
<span id="cb385-6368"><a href="#cb385-6368" aria-hidden="true" tabindex="-1"></a><span class="in">                                   0, </span></span>
<span id="cb385-6369"><a href="#cb385-6369" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "cm"),</span></span>
<span id="cb385-6370"><a href="#cb385-6370" aria-hidden="true" tabindex="-1"></a><span class="in">            legend.background = element_rect(),</span></span>
<span id="cb385-6371"><a href="#cb385-6371" aria-hidden="true" tabindex="-1"></a><span class="in">            strip.background = element_blank(),</span></span>
<span id="cb385-6372"><a href="#cb385-6372" aria-hidden="true" tabindex="-1"></a><span class="in">            strip.text = element_text(face = "bold"),</span></span>
<span id="cb385-6373"><a href="#cb385-6373" aria-hidden="true" tabindex="-1"></a><span class="in">            legend.box.spacing = unit(0, "cm"),</span></span>
<span id="cb385-6374"><a href="#cb385-6374" aria-hidden="true" tabindex="-1"></a><span class="in">            plot.subtitle = element_text(hjust = 0.5,</span></span>
<span id="cb385-6375"><a href="#cb385-6375" aria-hidden="true" tabindex="-1"></a><span class="in">                                         vjust = -1,</span></span>
<span id="cb385-6376"><a href="#cb385-6376" aria-hidden="true" tabindex="-1"></a><span class="in">                                         size = 15 * 1.05,</span></span>
<span id="cb385-6377"><a href="#cb385-6377" aria-hidden="true" tabindex="-1"></a><span class="in">                                         face = "bold")) </span></span>
<span id="cb385-6378"><a href="#cb385-6378" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb385-6379"><a href="#cb385-6379" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-6380"><a href="#cb385-6380" aria-hidden="true" tabindex="-1"></a><span class="in">  plot &lt;- (past_plot +</span></span>
<span id="cb385-6381"><a href="#cb385-6381" aria-hidden="true" tabindex="-1"></a><span class="in">             future_plot_list +</span></span>
<span id="cb385-6382"><a href="#cb385-6382" aria-hidden="true" tabindex="-1"></a><span class="in">             plot_layout(guides = "collect",</span></span>
<span id="cb385-6383"><a href="#cb385-6383" aria-hidden="true" tabindex="-1"></a><span class="in">                         widths = c(1,rep(2,length(future_plot_list))))</span></span>
<span id="cb385-6384"><a href="#cb385-6384" aria-hidden="true" tabindex="-1"></a><span class="in">           ) &amp; theme(legend.position = "bottom",</span></span>
<span id="cb385-6385"><a href="#cb385-6385" aria-hidden="true" tabindex="-1"></a><span class="in">                     legend.text = element_text(size = 8),</span></span>
<span id="cb385-6386"><a href="#cb385-6386" aria-hidden="true" tabindex="-1"></a><span class="in">                     legend.title = element_text(size = 10),</span></span>
<span id="cb385-6387"><a href="#cb385-6387" aria-hidden="true" tabindex="-1"></a><span class="in">                     axis.title.x=element_blank())</span></span>
<span id="cb385-6388"><a href="#cb385-6388" aria-hidden="true" tabindex="-1"></a><span class="in">  plot</span></span>
<span id="cb385-6389"><a href="#cb385-6389" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-6390"><a href="#cb385-6390" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-6391"><a href="#cb385-6391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6392"><a href="#cb385-6392" aria-hidden="true" tabindex="-1"></a><span class="in">## Now we can produce the same outputs a bit more quickly:</span></span>
<span id="cb385-6393"><a href="#cb385-6393" aria-hidden="true" tabindex="-1"></a><span class="in"># For Heat</span></span>
<span id="cb385-6394"><a href="#cb385-6394" aria-hidden="true" tabindex="-1"></a><span class="in">plot_scenarios_gg(past_observed = past_observed,</span></span>
<span id="cb385-6395"><a href="#cb385-6395" aria-hidden="true" tabindex="-1"></a><span class="in">                  past_simulated = past_simulated,</span></span>
<span id="cb385-6396"><a href="#cb385-6396" aria-hidden="true" tabindex="-1"></a><span class="in">                  future_data = future_data,</span></span>
<span id="cb385-6397"><a href="#cb385-6397" aria-hidden="true" tabindex="-1"></a><span class="in">                  metric = "GDH",</span></span>
<span id="cb385-6398"><a href="#cb385-6398" aria-hidden="true" tabindex="-1"></a><span class="in">                  axis_label = "Heat (in Growing Degree Hours)",</span></span>
<span id="cb385-6399"><a href="#cb385-6399" aria-hidden="true" tabindex="-1"></a><span class="in">                  time_points = c(2050, 2085))</span></span>
<span id="cb385-6400"><a href="#cb385-6400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6401"><a href="#cb385-6401" aria-hidden="true" tabindex="-1"></a><span class="in"># For Chill </span></span>
<span id="cb385-6402"><a href="#cb385-6402" aria-hidden="true" tabindex="-1"></a><span class="in">plot_scenarios_gg(past_observed = past_observed,</span></span>
<span id="cb385-6403"><a href="#cb385-6403" aria-hidden="true" tabindex="-1"></a><span class="in">                  past_simulated = past_simulated,</span></span>
<span id="cb385-6404"><a href="#cb385-6404" aria-hidden="true" tabindex="-1"></a><span class="in">                  future_data = future_data,</span></span>
<span id="cb385-6405"><a href="#cb385-6405" aria-hidden="true" tabindex="-1"></a><span class="in">                  metric = "Chill_Portions",</span></span>
<span id="cb385-6406"><a href="#cb385-6406" aria-hidden="true" tabindex="-1"></a><span class="in">                  axis_label = "Chill (in Chill Portions)",</span></span>
<span id="cb385-6407"><a href="#cb385-6407" aria-hidden="true" tabindex="-1"></a><span class="in">                  time_points = c(2050, 2085))</span></span>
<span id="cb385-6408"><a href="#cb385-6408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6409"><a href="#cb385-6409" aria-hidden="true" tabindex="-1"></a><span class="in"># For Frost </span></span>
<span id="cb385-6410"><a href="#cb385-6410" aria-hidden="true" tabindex="-1"></a><span class="in">plot_scenarios_gg(past_observed = past_observed,</span></span>
<span id="cb385-6411"><a href="#cb385-6411" aria-hidden="true" tabindex="-1"></a><span class="in">                  past_simulated = past_simulated,</span></span>
<span id="cb385-6412"><a href="#cb385-6412" aria-hidden="true" tabindex="-1"></a><span class="in">                  future_data = future_data,</span></span>
<span id="cb385-6413"><a href="#cb385-6413" aria-hidden="true" tabindex="-1"></a><span class="in">                  metric = "Frost_H",</span></span>
<span id="cb385-6414"><a href="#cb385-6414" aria-hidden="true" tabindex="-1"></a><span class="in">                  axis_label = "Frost duration (in hours)",</span></span>
<span id="cb385-6415"><a href="#cb385-6415" aria-hidden="true" tabindex="-1"></a><span class="in">                  time_points = c(2050, 2085))</span></span>
<span id="cb385-6416"><a href="#cb385-6416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6417"><a href="#cb385-6417" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-6418"><a href="#cb385-6418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6419"><a href="#cb385-6419" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-6420"><a href="#cb385-6420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6421"><a href="#cb385-6421" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;18.3&lt;/span&gt;&amp;nbsp; Exercises on plotting future projections</span></span>
<span id="cb385-6422"><a href="#cb385-6422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6423"><a href="#cb385-6423" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-6424"><a href="#cb385-6424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6425"><a href="#cb385-6425" aria-hidden="true" tabindex="-1"></a>***1. Produce similar plots for the weather station you selected for earlier exercises.***</span>
<span id="cb385-6426"><a href="#cb385-6426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6427"><a href="#cb385-6427" aria-hidden="true" tabindex="-1"></a>Create similar plots for **Mössingen**:</span>
<span id="cb385-6428"><a href="#cb385-6428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6429"><a href="#cb385-6429" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 18.3}</span></span>
<span id="cb385-6430"><a href="#cb385-6430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6431"><a href="#cb385-6431" aria-hidden="true" tabindex="-1"></a><span class="in">chill_hist_scenario_list &lt;- load_temperature_scenarios("data/MS",</span></span>
<span id="cb385-6432"><a href="#cb385-6432" aria-hidden="true" tabindex="-1"></a><span class="in">                                                       "MS_hist_chill_305_59")</span></span>
<span id="cb385-6433"><a href="#cb385-6433" aria-hidden="true" tabindex="-1"></a><span class="in">actual_chill &lt;- read_tab("data/MS/MS_observed_chill_305_59.csv")</span></span>
<span id="cb385-6434"><a href="#cb385-6434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6435"><a href="#cb385-6435" aria-hidden="true" tabindex="-1"></a><span class="in">chill_future_scenario_list &lt;- load_temperature_scenarios("data/MS/MS_future_climate","MS_futurechill")</span></span>
<span id="cb385-6436"><a href="#cb385-6436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6437"><a href="#cb385-6437" aria-hidden="true" tabindex="-1"></a><span class="in">chills &lt;- make_climate_scenario(</span></span>
<span id="cb385-6438"><a href="#cb385-6438" aria-hidden="true" tabindex="-1"></a><span class="in">  chill_hist_scenario_list,</span></span>
<span id="cb385-6439"><a href="#cb385-6439" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Historic",</span></span>
<span id="cb385-6440"><a href="#cb385-6440" aria-hidden="true" tabindex="-1"></a><span class="in">  historic_data = actual_chill,</span></span>
<span id="cb385-6441"><a href="#cb385-6441" aria-hidden="true" tabindex="-1"></a><span class="in">  time_series = TRUE)</span></span>
<span id="cb385-6442"><a href="#cb385-6442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6443"><a href="#cb385-6443" aria-hidden="true" tabindex="-1"></a><span class="in">SSPs &lt;- c("ssp126", "ssp245", "ssp370", "ssp585")</span></span>
<span id="cb385-6444"><a href="#cb385-6444" aria-hidden="true" tabindex="-1"></a><span class="in">Times &lt;- c(2050, 2085)</span></span>
<span id="cb385-6445"><a href="#cb385-6445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6446"><a href="#cb385-6446" aria-hidden="true" tabindex="-1"></a><span class="in">list_ssp &lt;- </span></span>
<span id="cb385-6447"><a href="#cb385-6447" aria-hidden="true" tabindex="-1"></a><span class="in">  strsplit(names(chill_future_scenario_list), '\\.') %&gt;%</span></span>
<span id="cb385-6448"><a href="#cb385-6448" aria-hidden="true" tabindex="-1"></a><span class="in">  map(2) %&gt;%</span></span>
<span id="cb385-6449"><a href="#cb385-6449" aria-hidden="true" tabindex="-1"></a><span class="in">  unlist()</span></span>
<span id="cb385-6450"><a href="#cb385-6450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6451"><a href="#cb385-6451" aria-hidden="true" tabindex="-1"></a><span class="in">list_gcm &lt;-</span></span>
<span id="cb385-6452"><a href="#cb385-6452" aria-hidden="true" tabindex="-1"></a><span class="in">  strsplit(names(chill_future_scenario_list), '\\.') %&gt;%</span></span>
<span id="cb385-6453"><a href="#cb385-6453" aria-hidden="true" tabindex="-1"></a><span class="in">  map(3) %&gt;%</span></span>
<span id="cb385-6454"><a href="#cb385-6454" aria-hidden="true" tabindex="-1"></a><span class="in">  unlist()</span></span>
<span id="cb385-6455"><a href="#cb385-6455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6456"><a href="#cb385-6456" aria-hidden="true" tabindex="-1"></a><span class="in">list_time &lt;-</span></span>
<span id="cb385-6457"><a href="#cb385-6457" aria-hidden="true" tabindex="-1"></a><span class="in">  strsplit(names(chill_future_scenario_list), '\\.') %&gt;%</span></span>
<span id="cb385-6458"><a href="#cb385-6458" aria-hidden="true" tabindex="-1"></a><span class="in">  map(4) %&gt;%</span></span>
<span id="cb385-6459"><a href="#cb385-6459" aria-hidden="true" tabindex="-1"></a><span class="in">  unlist()</span></span>
<span id="cb385-6460"><a href="#cb385-6460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6461"><a href="#cb385-6461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6462"><a href="#cb385-6462" aria-hidden="true" tabindex="-1"></a><span class="in">for(SSP in SSPs)</span></span>
<span id="cb385-6463"><a href="#cb385-6463" aria-hidden="true" tabindex="-1"></a><span class="in">  for(Time in Times)</span></span>
<span id="cb385-6464"><a href="#cb385-6464" aria-hidden="true" tabindex="-1"></a><span class="in">    {</span></span>
<span id="cb385-6465"><a href="#cb385-6465" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb385-6466"><a href="#cb385-6466" aria-hidden="true" tabindex="-1"></a><span class="in">    # find all scenarios for the ssp and time</span></span>
<span id="cb385-6467"><a href="#cb385-6467" aria-hidden="true" tabindex="-1"></a><span class="in">    chill &lt;- chill_future_scenario_list[list_ssp == SSP &amp; list_time == Time]</span></span>
<span id="cb385-6468"><a href="#cb385-6468" aria-hidden="true" tabindex="-1"></a><span class="in">    names(chill) &lt;- list_gcm[list_ssp == SSP &amp; list_time == Time]</span></span>
<span id="cb385-6469"><a href="#cb385-6469" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp126") SSPcaption &lt;- "SSP1"</span></span>
<span id="cb385-6470"><a href="#cb385-6470" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp245") SSPcaption &lt;- "SSP2"</span></span>
<span id="cb385-6471"><a href="#cb385-6471" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp370") SSPcaption &lt;- "SSP3"</span></span>
<span id="cb385-6472"><a href="#cb385-6472" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp585") SSPcaption &lt;- "SSP5"    </span></span>
<span id="cb385-6473"><a href="#cb385-6473" aria-hidden="true" tabindex="-1"></a><span class="in">    if(Time == "2050") Time_caption &lt;- "2050"</span></span>
<span id="cb385-6474"><a href="#cb385-6474" aria-hidden="true" tabindex="-1"></a><span class="in">    if(Time == "2085") Time_caption &lt;- "2085"</span></span>
<span id="cb385-6475"><a href="#cb385-6475" aria-hidden="true" tabindex="-1"></a><span class="in">    chills &lt;- chill %&gt;% </span></span>
<span id="cb385-6476"><a href="#cb385-6476" aria-hidden="true" tabindex="-1"></a><span class="in">      make_climate_scenario(</span></span>
<span id="cb385-6477"><a href="#cb385-6477" aria-hidden="true" tabindex="-1"></a><span class="in">        caption = c(SSPcaption,</span></span>
<span id="cb385-6478"><a href="#cb385-6478" aria-hidden="true" tabindex="-1"></a><span class="in">                    Time_caption),</span></span>
<span id="cb385-6479"><a href="#cb385-6479" aria-hidden="true" tabindex="-1"></a><span class="in">        add_to = chills)</span></span>
<span id="cb385-6480"><a href="#cb385-6480" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb385-6481"><a href="#cb385-6481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6482"><a href="#cb385-6482" aria-hidden="true" tabindex="-1"></a><span class="in"># We'll first process the past scenarios (element 1 of the chills list).</span></span>
<span id="cb385-6483"><a href="#cb385-6483" aria-hidden="true" tabindex="-1"></a><span class="in"># Within the data element, we have a list of multiple data.frames for</span></span>
<span id="cb385-6484"><a href="#cb385-6484" aria-hidden="true" tabindex="-1"></a><span class="in"># the various past scenarios.</span></span>
<span id="cb385-6485"><a href="#cb385-6485" aria-hidden="true" tabindex="-1"></a><span class="in"># Using a 'for' loop, we cycle through all these data.frames.</span></span>
<span id="cb385-6486"><a href="#cb385-6486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6487"><a href="#cb385-6487" aria-hidden="true" tabindex="-1"></a><span class="in">for(nam in names(chills[[1]]$data))</span></span>
<span id="cb385-6488"><a href="#cb385-6488" aria-hidden="true" tabindex="-1"></a><span class="in">  {</span></span>
<span id="cb385-6489"><a href="#cb385-6489" aria-hidden="true" tabindex="-1"></a><span class="in">   # Extract the data frame.</span></span>
<span id="cb385-6490"><a href="#cb385-6490" aria-hidden="true" tabindex="-1"></a><span class="in">   ch &lt;- chills[[1]]$data[[nam]]</span></span>
<span id="cb385-6491"><a href="#cb385-6491" aria-hidden="true" tabindex="-1"></a><span class="in">   # Add columns for the new information we have to add and fill them.</span></span>
<span id="cb385-6492"><a href="#cb385-6492" aria-hidden="true" tabindex="-1"></a><span class="in">   ch[,"GCM"] &lt;- "none"</span></span>
<span id="cb385-6493"><a href="#cb385-6493" aria-hidden="true" tabindex="-1"></a><span class="in">   ch[,"SSP"] &lt;- "none"</span></span>
<span id="cb385-6494"><a href="#cb385-6494" aria-hidden="true" tabindex="-1"></a><span class="in">   ch[,"Year"] &lt;- as.numeric(nam)</span></span>
<span id="cb385-6495"><a href="#cb385-6495" aria-hidden="true" tabindex="-1"></a><span class="in">   </span></span>
<span id="cb385-6496"><a href="#cb385-6496" aria-hidden="true" tabindex="-1"></a><span class="in">   # Now check if this is the first time we've gone through this loop.</span></span>
<span id="cb385-6497"><a href="#cb385-6497" aria-hidden="true" tabindex="-1"></a><span class="in">   # If this is the first time, the ch data.frame becomes the output</span></span>
<span id="cb385-6498"><a href="#cb385-6498" aria-hidden="true" tabindex="-1"></a><span class="in">   # object (past_simulated).</span></span>
<span id="cb385-6499"><a href="#cb385-6499" aria-hidden="true" tabindex="-1"></a><span class="in">   # If it is not the first time ('else'), we add the current data.frame</span></span>
<span id="cb385-6500"><a href="#cb385-6500" aria-hidden="true" tabindex="-1"></a><span class="in">   # to the 'past_simulated' object</span></span>
<span id="cb385-6501"><a href="#cb385-6501" aria-hidden="true" tabindex="-1"></a><span class="in">  if(nam == names(chills[[1]]$data)[1])</span></span>
<span id="cb385-6502"><a href="#cb385-6502" aria-hidden="true" tabindex="-1"></a><span class="in">    past_simulated &lt;- ch else</span></span>
<span id="cb385-6503"><a href="#cb385-6503" aria-hidden="true" tabindex="-1"></a><span class="in">      past_simulated &lt;- rbind(past_simulated,</span></span>
<span id="cb385-6504"><a href="#cb385-6504" aria-hidden="true" tabindex="-1"></a><span class="in">                              ch)</span></span>
<span id="cb385-6505"><a href="#cb385-6505" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb385-6506"><a href="#cb385-6506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6507"><a href="#cb385-6507" aria-hidden="true" tabindex="-1"></a><span class="in"># We add another column called 'Scenario' and label all rows as 'Historical' </span></span>
<span id="cb385-6508"><a href="#cb385-6508" aria-hidden="true" tabindex="-1"></a><span class="in">past_simulated["Scenario"] &lt;- "Historical"</span></span>
<span id="cb385-6509"><a href="#cb385-6509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6510"><a href="#cb385-6510" aria-hidden="true" tabindex="-1"></a><span class="in"># We'll want to add the historic observation too, so let's simplify the</span></span>
<span id="cb385-6511"><a href="#cb385-6511" aria-hidden="true" tabindex="-1"></a><span class="in"># pointer to this information for easier use later</span></span>
<span id="cb385-6512"><a href="#cb385-6512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6513"><a href="#cb385-6513" aria-hidden="true" tabindex="-1"></a><span class="in">past_observed &lt;- chills[[1]][["historic_data"]]</span></span>
<span id="cb385-6514"><a href="#cb385-6514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6515"><a href="#cb385-6515" aria-hidden="true" tabindex="-1"></a><span class="in"># Extract future data</span></span>
<span id="cb385-6516"><a href="#cb385-6516" aria-hidden="true" tabindex="-1"></a><span class="in">for(i in 2:length(chills))</span></span>
<span id="cb385-6517"><a href="#cb385-6517" aria-hidden="true" tabindex="-1"></a><span class="in">  for(nam in names(chills[[i]]$data))</span></span>
<span id="cb385-6518"><a href="#cb385-6518" aria-hidden="true" tabindex="-1"></a><span class="in">    {ch &lt;- chills[[i]]$data[[nam]]</span></span>
<span id="cb385-6519"><a href="#cb385-6519" aria-hidden="true" tabindex="-1"></a><span class="in">     ch[,"GCM"] &lt;- nam</span></span>
<span id="cb385-6520"><a href="#cb385-6520" aria-hidden="true" tabindex="-1"></a><span class="in">     ch[,"SSP"] &lt;- chills[[i]]$caption[1]</span></span>
<span id="cb385-6521"><a href="#cb385-6521" aria-hidden="true" tabindex="-1"></a><span class="in">     ch[,"Year"] &lt;- chills[[i]]$caption[2]</span></span>
<span id="cb385-6522"><a href="#cb385-6522" aria-hidden="true" tabindex="-1"></a><span class="in">     if(i == 2 &amp; nam == names(chills[[i]]$data)[1])</span></span>
<span id="cb385-6523"><a href="#cb385-6523" aria-hidden="true" tabindex="-1"></a><span class="in">       future_data &lt;- ch else</span></span>
<span id="cb385-6524"><a href="#cb385-6524" aria-hidden="true" tabindex="-1"></a><span class="in">         future_data &lt;- rbind(future_data,ch)</span></span>
<span id="cb385-6525"><a href="#cb385-6525" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb385-6526"><a href="#cb385-6526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6527"><a href="#cb385-6527" aria-hidden="true" tabindex="-1"></a><span class="in">plot_scenarios_gg &lt;- function(past_observed,</span></span>
<span id="cb385-6528"><a href="#cb385-6528" aria-hidden="true" tabindex="-1"></a><span class="in">                              past_simulated,</span></span>
<span id="cb385-6529"><a href="#cb385-6529" aria-hidden="true" tabindex="-1"></a><span class="in">                              future_data,</span></span>
<span id="cb385-6530"><a href="#cb385-6530" aria-hidden="true" tabindex="-1"></a><span class="in">                              metric,</span></span>
<span id="cb385-6531"><a href="#cb385-6531" aria-hidden="true" tabindex="-1"></a><span class="in">                              axis_label,</span></span>
<span id="cb385-6532"><a href="#cb385-6532" aria-hidden="true" tabindex="-1"></a><span class="in">                              time_points)</span></span>
<span id="cb385-6533"><a href="#cb385-6533" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb385-6534"><a href="#cb385-6534" aria-hidden="true" tabindex="-1"></a><span class="in">  rng &lt;- range(past_observed[[metric]],</span></span>
<span id="cb385-6535"><a href="#cb385-6535" aria-hidden="true" tabindex="-1"></a><span class="in">               past_simulated[[metric]],</span></span>
<span id="cb385-6536"><a href="#cb385-6536" aria-hidden="true" tabindex="-1"></a><span class="in">               future_data[[metric]])  </span></span>
<span id="cb385-6537"><a href="#cb385-6537" aria-hidden="true" tabindex="-1"></a><span class="in">  past_plot &lt;- ggplot() +</span></span>
<span id="cb385-6538"><a href="#cb385-6538" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_boxplot(data = past_simulated,</span></span>
<span id="cb385-6539"><a href="#cb385-6539" aria-hidden="true" tabindex="-1"></a><span class="in">                 aes_string("as.numeric(Year)",</span></span>
<span id="cb385-6540"><a href="#cb385-6540" aria-hidden="true" tabindex="-1"></a><span class="in">                            metric,</span></span>
<span id="cb385-6541"><a href="#cb385-6541" aria-hidden="true" tabindex="-1"></a><span class="in">                            group="Year"),</span></span>
<span id="cb385-6542"><a href="#cb385-6542" aria-hidden="true" tabindex="-1"></a><span class="in">                 fill="skyblue") +</span></span>
<span id="cb385-6543"><a href="#cb385-6543" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_y_continuous(limits = c(0, </span></span>
<span id="cb385-6544"><a href="#cb385-6544" aria-hidden="true" tabindex="-1"></a><span class="in">                                  round(round(1.1*rng[2])))) +</span></span>
<span id="cb385-6545"><a href="#cb385-6545" aria-hidden="true" tabindex="-1"></a><span class="in">    labs(x = "Year", y = axis_label) +</span></span>
<span id="cb385-6546"><a href="#cb385-6546" aria-hidden="true" tabindex="-1"></a><span class="in">    facet_grid(~ Scenario) +</span></span>
<span id="cb385-6547"><a href="#cb385-6547" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_bw(base_size = 15) +  </span></span>
<span id="cb385-6548"><a href="#cb385-6548" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(strip.background = element_blank(),</span></span>
<span id="cb385-6549"><a href="#cb385-6549" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.text = element_text(face = "bold"),</span></span>
<span id="cb385-6550"><a href="#cb385-6550" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.text.x = element_text(angle=45, </span></span>
<span id="cb385-6551"><a href="#cb385-6551" aria-hidden="true" tabindex="-1"></a><span class="in">                                     hjust=1)) +</span></span>
<span id="cb385-6552"><a href="#cb385-6552" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_point(data = past_observed,</span></span>
<span id="cb385-6553"><a href="#cb385-6553" aria-hidden="true" tabindex="-1"></a><span class="in">               aes_string("End_year",</span></span>
<span id="cb385-6554"><a href="#cb385-6554" aria-hidden="true" tabindex="-1"></a><span class="in">                          metric),</span></span>
<span id="cb385-6555"><a href="#cb385-6555" aria-hidden="true" tabindex="-1"></a><span class="in">               col="blue")</span></span>
<span id="cb385-6556"><a href="#cb385-6556" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-6557"><a href="#cb385-6557" aria-hidden="true" tabindex="-1"></a><span class="in">  future_plot_list &lt;- list()</span></span>
<span id="cb385-6558"><a href="#cb385-6558" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-6559"><a href="#cb385-6559" aria-hidden="true" tabindex="-1"></a><span class="in">  for(y in time_points)</span></span>
<span id="cb385-6560"><a href="#cb385-6560" aria-hidden="true" tabindex="-1"></a><span class="in">  {</span></span>
<span id="cb385-6561"><a href="#cb385-6561" aria-hidden="true" tabindex="-1"></a><span class="in">    future_plot_list[[which(y == time_points)]] &lt;-</span></span>
<span id="cb385-6562"><a href="#cb385-6562" aria-hidden="true" tabindex="-1"></a><span class="in">      ggplot(data = future_data[which(future_data$Year==y),]) +</span></span>
<span id="cb385-6563"><a href="#cb385-6563" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_boxplot(aes_string("GCM", </span></span>
<span id="cb385-6564"><a href="#cb385-6564" aria-hidden="true" tabindex="-1"></a><span class="in">                              metric, </span></span>
<span id="cb385-6565"><a href="#cb385-6565" aria-hidden="true" tabindex="-1"></a><span class="in">                              fill="GCM")) +</span></span>
<span id="cb385-6566"><a href="#cb385-6566" aria-hidden="true" tabindex="-1"></a><span class="in">      facet_wrap(vars(SSP), nrow = 1) +</span></span>
<span id="cb385-6567"><a href="#cb385-6567" aria-hidden="true" tabindex="-1"></a><span class="in">      scale_x_discrete(labels = NULL,</span></span>
<span id="cb385-6568"><a href="#cb385-6568" aria-hidden="true" tabindex="-1"></a><span class="in">                       expand = expansion(add = 1)) +</span></span>
<span id="cb385-6569"><a href="#cb385-6569" aria-hidden="true" tabindex="-1"></a><span class="in">      scale_y_continuous(limits = c(0, </span></span>
<span id="cb385-6570"><a href="#cb385-6570" aria-hidden="true" tabindex="-1"></a><span class="in">                                    round(round(1.1*rng[2])))) +</span></span>
<span id="cb385-6571"><a href="#cb385-6571" aria-hidden="true" tabindex="-1"></a><span class="in">      geom_text_npc(aes(npcx = "center",</span></span>
<span id="cb385-6572"><a href="#cb385-6572" aria-hidden="true" tabindex="-1"></a><span class="in">                        npcy = "top",</span></span>
<span id="cb385-6573"><a href="#cb385-6573" aria-hidden="true" tabindex="-1"></a><span class="in">                        label = Year),</span></span>
<span id="cb385-6574"><a href="#cb385-6574" aria-hidden="true" tabindex="-1"></a><span class="in">                    size = 5) +</span></span>
<span id="cb385-6575"><a href="#cb385-6575" aria-hidden="true" tabindex="-1"></a><span class="in">      theme_bw(base_size = 15) +</span></span>
<span id="cb385-6576"><a href="#cb385-6576" aria-hidden="true" tabindex="-1"></a><span class="in">      theme(axis.ticks.y = element_blank(),</span></span>
<span id="cb385-6577"><a href="#cb385-6577" aria-hidden="true" tabindex="-1"></a><span class="in">            axis.text = element_blank(),</span></span>
<span id="cb385-6578"><a href="#cb385-6578" aria-hidden="true" tabindex="-1"></a><span class="in">            axis.title = element_blank(),</span></span>
<span id="cb385-6579"><a href="#cb385-6579" aria-hidden="true" tabindex="-1"></a><span class="in">            legend.position = "bottom",</span></span>
<span id="cb385-6580"><a href="#cb385-6580" aria-hidden="true" tabindex="-1"></a><span class="in">            legend.margin = margin(0,</span></span>
<span id="cb385-6581"><a href="#cb385-6581" aria-hidden="true" tabindex="-1"></a><span class="in">                                   0, </span></span>
<span id="cb385-6582"><a href="#cb385-6582" aria-hidden="true" tabindex="-1"></a><span class="in">                                   0, </span></span>
<span id="cb385-6583"><a href="#cb385-6583" aria-hidden="true" tabindex="-1"></a><span class="in">                                   0, </span></span>
<span id="cb385-6584"><a href="#cb385-6584" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "cm"),</span></span>
<span id="cb385-6585"><a href="#cb385-6585" aria-hidden="true" tabindex="-1"></a><span class="in">            legend.background = element_rect(),</span></span>
<span id="cb385-6586"><a href="#cb385-6586" aria-hidden="true" tabindex="-1"></a><span class="in">            strip.background = element_blank(),</span></span>
<span id="cb385-6587"><a href="#cb385-6587" aria-hidden="true" tabindex="-1"></a><span class="in">            strip.text = element_text(face = "bold"),</span></span>
<span id="cb385-6588"><a href="#cb385-6588" aria-hidden="true" tabindex="-1"></a><span class="in">            legend.box.spacing = unit(0, "cm"),</span></span>
<span id="cb385-6589"><a href="#cb385-6589" aria-hidden="true" tabindex="-1"></a><span class="in">            plot.subtitle = element_text(hjust = 0.5,</span></span>
<span id="cb385-6590"><a href="#cb385-6590" aria-hidden="true" tabindex="-1"></a><span class="in">                                         vjust = -1,</span></span>
<span id="cb385-6591"><a href="#cb385-6591" aria-hidden="true" tabindex="-1"></a><span class="in">                                         size = 15 * 1.05,</span></span>
<span id="cb385-6592"><a href="#cb385-6592" aria-hidden="true" tabindex="-1"></a><span class="in">                                         face = "bold")) </span></span>
<span id="cb385-6593"><a href="#cb385-6593" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb385-6594"><a href="#cb385-6594" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-6595"><a href="#cb385-6595" aria-hidden="true" tabindex="-1"></a><span class="in">  plot &lt;- (past_plot +</span></span>
<span id="cb385-6596"><a href="#cb385-6596" aria-hidden="true" tabindex="-1"></a><span class="in">             future_plot_list +</span></span>
<span id="cb385-6597"><a href="#cb385-6597" aria-hidden="true" tabindex="-1"></a><span class="in">             plot_layout(guides = "collect",</span></span>
<span id="cb385-6598"><a href="#cb385-6598" aria-hidden="true" tabindex="-1"></a><span class="in">                         widths = c(1,rep(2,length(future_plot_list))))</span></span>
<span id="cb385-6599"><a href="#cb385-6599" aria-hidden="true" tabindex="-1"></a><span class="in">           ) &amp; theme(legend.position = "bottom",</span></span>
<span id="cb385-6600"><a href="#cb385-6600" aria-hidden="true" tabindex="-1"></a><span class="in">                     legend.text = element_text(size = 8),</span></span>
<span id="cb385-6601"><a href="#cb385-6601" aria-hidden="true" tabindex="-1"></a><span class="in">                     legend.title = element_text(size = 10),</span></span>
<span id="cb385-6602"><a href="#cb385-6602" aria-hidden="true" tabindex="-1"></a><span class="in">                     axis.title.x=element_blank())</span></span>
<span id="cb385-6603"><a href="#cb385-6603" aria-hidden="true" tabindex="-1"></a><span class="in">  plot</span></span>
<span id="cb385-6604"><a href="#cb385-6604" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-6605"><a href="#cb385-6605" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-6606"><a href="#cb385-6606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6607"><a href="#cb385-6607" aria-hidden="true" tabindex="-1"></a><span class="in">plot_scenarios_gg(past_observed = past_observed,</span></span>
<span id="cb385-6608"><a href="#cb385-6608" aria-hidden="true" tabindex="-1"></a><span class="in">                  past_simulated = past_simulated,</span></span>
<span id="cb385-6609"><a href="#cb385-6609" aria-hidden="true" tabindex="-1"></a><span class="in">                  future_data = future_data,</span></span>
<span id="cb385-6610"><a href="#cb385-6610" aria-hidden="true" tabindex="-1"></a><span class="in">                  metric = "GDH",</span></span>
<span id="cb385-6611"><a href="#cb385-6611" aria-hidden="true" tabindex="-1"></a><span class="in">                  axis_label = "Heat (in Growing Degree Hours)",</span></span>
<span id="cb385-6612"><a href="#cb385-6612" aria-hidden="true" tabindex="-1"></a><span class="in">                  time_points = c(2050, 2085)) </span></span>
<span id="cb385-6613"><a href="#cb385-6613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6614"><a href="#cb385-6614" aria-hidden="true" tabindex="-1"></a><span class="in">plot_scenarios_gg(past_observed = past_observed,</span></span>
<span id="cb385-6615"><a href="#cb385-6615" aria-hidden="true" tabindex="-1"></a><span class="in">                  past_simulated = past_simulated,</span></span>
<span id="cb385-6616"><a href="#cb385-6616" aria-hidden="true" tabindex="-1"></a><span class="in">                  future_data = future_data,</span></span>
<span id="cb385-6617"><a href="#cb385-6617" aria-hidden="true" tabindex="-1"></a><span class="in">                  metric = "Chill_Portions",</span></span>
<span id="cb385-6618"><a href="#cb385-6618" aria-hidden="true" tabindex="-1"></a><span class="in">                  axis_label = "Chill (in Chill Portions)",</span></span>
<span id="cb385-6619"><a href="#cb385-6619" aria-hidden="true" tabindex="-1"></a><span class="in">                  time_points = c(2050, 2085))</span></span>
<span id="cb385-6620"><a href="#cb385-6620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6621"><a href="#cb385-6621" aria-hidden="true" tabindex="-1"></a><span class="in">plot_scenarios_gg(past_observed = past_observed,</span></span>
<span id="cb385-6622"><a href="#cb385-6622" aria-hidden="true" tabindex="-1"></a><span class="in">                  past_simulated = past_simulated,</span></span>
<span id="cb385-6623"><a href="#cb385-6623" aria-hidden="true" tabindex="-1"></a><span class="in">                  future_data = future_data,</span></span>
<span id="cb385-6624"><a href="#cb385-6624" aria-hidden="true" tabindex="-1"></a><span class="in">                  metric = "Frost_H",</span></span>
<span id="cb385-6625"><a href="#cb385-6625" aria-hidden="true" tabindex="-1"></a><span class="in">                  axis_label = "Frost duration (in hours)",</span></span>
<span id="cb385-6626"><a href="#cb385-6626" aria-hidden="true" tabindex="-1"></a><span class="in">                  time_points = c(2050, 2085))</span></span>
<span id="cb385-6627"><a href="#cb385-6627" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-6628"><a href="#cb385-6628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6629"><a href="#cb385-6629" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-6630"><a href="#cb385-6630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6631"><a href="#cb385-6631" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 19: Chill model comparison</span></span>
<span id="cb385-6632"><a href="#cb385-6632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6633"><a href="#cb385-6633" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;19.1&lt;/span&gt;&amp;nbsp; Safe Winter Chill</span></span>
<span id="cb385-6634"><a href="#cb385-6634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6635"><a href="#cb385-6635" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-6636"><a href="#cb385-6636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6637"><a href="#cb385-6637" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Safe Winter Chill is defined as the 10% quantile of the kind of chill distributions. For growers, this measure corresponds to the amount of chill that is likely to be exceeded in 90% of all years. A specific tree cultivar with a chilling requirement that corresponds to Safe Winter Chill can be expected to meet this requirement about 90% of the time.</span>
<span id="cb385-6638"><a href="#cb385-6638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6639"><a href="#cb385-6639" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Besides practical usefulness, Safe Winter Chill also offers an opportunity for reducing the complexity of our simulation results by computing the 10% quantiles of each of the distributions we generated.</span>
<span id="cb385-6640"><a href="#cb385-6640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6641"><a href="#cb385-6641" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>While such a reduction always involves a loss of information, it gives us the opportunity to present our data in different, possibly more attractive, formats<span class="dv">&amp;mdash;</span> for example, heat map which illustrates differences in the behavior of the various chill models that have been used in the literature (and sometimes in practice). </span>
<span id="cb385-6642"><a href="#cb385-6642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6643"><a href="#cb385-6643" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-6644"><a href="#cb385-6644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6645"><a href="#cb385-6645" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;19.2&lt;/span&gt;&amp;nbsp; Chill metrics</span></span>
<span id="cb385-6646"><a href="#cb385-6646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6647"><a href="#cb385-6647" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-6648"><a href="#cb385-6648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6649"><a href="#cb385-6649" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A list of 13 chill metrics, which has recently been compiled and published in <span class="co">[</span><span class="ot">a paper by Eduardo Fernandez</span><span class="co">](https://www.sciencedirect.com/science/article/pii/S1161030120301106)</span>, provides the blueprint for the present analysis.</span>
<span id="cb385-6650"><a href="#cb385-6650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6651"><a href="#cb385-6651" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The models are compiled in <span class="in">`dormancyR`</span> package, and using the <span class="in">`devtools`</span> package, we can install this directly from github.</span>
<span id="cb385-6652"><a href="#cb385-6652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6653"><a href="#cb385-6653" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We also need <span class="in">`chillR`</span>, because Eduardo did not include in this package the chill models that are already contained in <span class="in">`chillR`</span>.</span>
<span id="cb385-6654"><a href="#cb385-6654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6655"><a href="#cb385-6655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6656"><a href="#cb385-6656" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 19.2a}</span></span>
<span id="cb385-6657"><a href="#cb385-6657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6658"><a href="#cb385-6658" aria-hidden="true" tabindex="-1"></a><span class="in"># library(chillR)</span></span>
<span id="cb385-6659"><a href="#cb385-6659" aria-hidden="true" tabindex="-1"></a><span class="in"># library(devtools)</span></span>
<span id="cb385-6660"><a href="#cb385-6660" aria-hidden="true" tabindex="-1"></a><span class="in"># install_github("EduardoFernandezC/dormancyR")</span></span>
<span id="cb385-6661"><a href="#cb385-6661" aria-hidden="true" tabindex="-1"></a><span class="in"># library(dormancyR)</span></span>
<span id="cb385-6662"><a href="#cb385-6662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6663"><a href="#cb385-6663" aria-hidden="true" tabindex="-1"></a><span class="in"># Make a list of models that calculate chilling using hourly temp data</span></span>
<span id="cb385-6664"><a href="#cb385-6664" aria-hidden="true" tabindex="-1"></a><span class="in">hourly_models &lt;- list(Chilling_units = chilling_units,</span></span>
<span id="cb385-6665"><a href="#cb385-6665" aria-hidden="true" tabindex="-1"></a><span class="in">     Low_chill = low_chill_model,</span></span>
<span id="cb385-6666"><a href="#cb385-6666" aria-hidden="true" tabindex="-1"></a><span class="in">     Modified_Utah = modified_utah_model,</span></span>
<span id="cb385-6667"><a href="#cb385-6667" aria-hidden="true" tabindex="-1"></a><span class="in">     North_Carolina = north_carolina_model,</span></span>
<span id="cb385-6668"><a href="#cb385-6668" aria-hidden="true" tabindex="-1"></a><span class="in">     Positive_Utah = positive_utah_model,</span></span>
<span id="cb385-6669"><a href="#cb385-6669" aria-hidden="true" tabindex="-1"></a><span class="in">     Chilling_Hours = Chilling_Hours,</span></span>
<span id="cb385-6670"><a href="#cb385-6670" aria-hidden="true" tabindex="-1"></a><span class="in">     Utah_Chill_Units = Utah_Model,</span></span>
<span id="cb385-6671"><a href="#cb385-6671" aria-hidden="true" tabindex="-1"></a><span class="in">     Chill_Portions = Dynamic_Model)</span></span>
<span id="cb385-6672"><a href="#cb385-6672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6673"><a href="#cb385-6673" aria-hidden="true" tabindex="-1"></a><span class="in"># list for daily models that use daily temp data</span></span>
<span id="cb385-6674"><a href="#cb385-6674" aria-hidden="true" tabindex="-1"></a><span class="in">daily_models &lt;- list(Rate_of_Chill = rate_of_chill,</span></span>
<span id="cb385-6675"><a href="#cb385-6675" aria-hidden="true" tabindex="-1"></a><span class="in">                     Chill_Days = chill_days,</span></span>
<span id="cb385-6676"><a href="#cb385-6676" aria-hidden="true" tabindex="-1"></a><span class="in">                     Exponential_Chill = exponential_chill,</span></span>
<span id="cb385-6677"><a href="#cb385-6677" aria-hidden="true" tabindex="-1"></a><span class="in">                     # Triangular_Chill_Haninnen = triangular_chill_1,</span></span>
<span id="cb385-6678"><a href="#cb385-6678" aria-hidden="true" tabindex="-1"></a><span class="in">                     Triangular_Chill_Legave = triangular_chill_2)</span></span>
<span id="cb385-6679"><a href="#cb385-6679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6680"><a href="#cb385-6680" aria-hidden="true" tabindex="-1"></a><span class="in"># Combines hourly and daily model names into a single vector</span></span>
<span id="cb385-6681"><a href="#cb385-6681" aria-hidden="true" tabindex="-1"></a><span class="in">metrics &lt;- c(names(daily_models),</span></span>
<span id="cb385-6682"><a href="#cb385-6682" aria-hidden="true" tabindex="-1"></a><span class="in">             names(hourly_models))</span></span>
<span id="cb385-6683"><a href="#cb385-6683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6684"><a href="#cb385-6684" aria-hidden="true" tabindex="-1"></a><span class="in"># Give readable names</span></span>
<span id="cb385-6685"><a href="#cb385-6685" aria-hidden="true" tabindex="-1"></a><span class="in">model_labels = c("Rate of Chill",</span></span>
<span id="cb385-6686"><a href="#cb385-6686" aria-hidden="true" tabindex="-1"></a><span class="in">                 "Chill Days",</span></span>
<span id="cb385-6687"><a href="#cb385-6687" aria-hidden="true" tabindex="-1"></a><span class="in">                 "Exponential Chill",</span></span>
<span id="cb385-6688"><a href="#cb385-6688" aria-hidden="true" tabindex="-1"></a><span class="in">                 # "Triangular Chill (Häninnen)",</span></span>
<span id="cb385-6689"><a href="#cb385-6689" aria-hidden="true" tabindex="-1"></a><span class="in">                 "Triangular Chill (Legave)",</span></span>
<span id="cb385-6690"><a href="#cb385-6690" aria-hidden="true" tabindex="-1"></a><span class="in">                 "Chilling Units",</span></span>
<span id="cb385-6691"><a href="#cb385-6691" aria-hidden="true" tabindex="-1"></a><span class="in">                 "Low-Chill Chill Units",</span></span>
<span id="cb385-6692"><a href="#cb385-6692" aria-hidden="true" tabindex="-1"></a><span class="in">                 "Modified Utah Chill Units",</span></span>
<span id="cb385-6693"><a href="#cb385-6693" aria-hidden="true" tabindex="-1"></a><span class="in">                 "North Carolina Chill Units",</span></span>
<span id="cb385-6694"><a href="#cb385-6694" aria-hidden="true" tabindex="-1"></a><span class="in">                 "Positive Utah Chill Units",</span></span>
<span id="cb385-6695"><a href="#cb385-6695" aria-hidden="true" tabindex="-1"></a><span class="in">                 "Chilling Hours",</span></span>
<span id="cb385-6696"><a href="#cb385-6696" aria-hidden="true" tabindex="-1"></a><span class="in">                 "Utah Chill Units",</span></span>
<span id="cb385-6697"><a href="#cb385-6697" aria-hidden="true" tabindex="-1"></a><span class="in">                 "Chill Portions")</span></span>
<span id="cb385-6698"><a href="#cb385-6698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6699"><a href="#cb385-6699" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a data frame</span></span>
<span id="cb385-6700"><a href="#cb385-6700" aria-hidden="true" tabindex="-1"></a><span class="in">kable(data.frame(Metric = model_labels, 'Function name' = metrics)) %&gt;%</span></span>
<span id="cb385-6701"><a href="#cb385-6701" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size =  10)</span></span>
<span id="cb385-6702"><a href="#cb385-6702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6703"><a href="#cb385-6703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6704"><a href="#cb385-6704" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-6705"><a href="#cb385-6705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6706"><a href="#cb385-6706" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-6707"><a href="#cb385-6707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6708"><a href="#cb385-6708" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now we want to apply all these chill models to our observed temperature record, as well as to the past and future temperature scenarios for Bonn.</span>
<span id="cb385-6709"><a href="#cb385-6709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6710"><a href="#cb385-6710" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 19.2b, eval=FALSE}</span></span>
<span id="cb385-6711"><a href="#cb385-6711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6712"><a href="#cb385-6712" aria-hidden="true" tabindex="-1"></a><span class="in"># Load saved historical temp data for Bonn</span></span>
<span id="cb385-6713"><a href="#cb385-6713" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_temps &lt;- read_tab("data/Bonn/Bonn_temps.csv")</span></span>
<span id="cb385-6714"><a href="#cb385-6714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6715"><a href="#cb385-6715" aria-hidden="true" tabindex="-1"></a><span class="in">Temps &lt;- load_temperature_scenarios("data/Bonn",</span></span>
<span id="cb385-6716"><a href="#cb385-6716" aria-hidden="true" tabindex="-1"></a><span class="in">                                    "Bonn_hist_scenarios")</span></span>
<span id="cb385-6717"><a href="#cb385-6717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6718"><a href="#cb385-6718" aria-hidden="true" tabindex="-1"></a><span class="in"># Now we can apply the chill models.</span></span>
<span id="cb385-6719"><a href="#cb385-6719" aria-hidden="true" tabindex="-1"></a><span class="in"># We’ve already seen how we can use models that use hourly temperature data as </span></span>
<span id="cb385-6720"><a href="#cb385-6720" aria-hidden="true" tabindex="-1"></a><span class="in"># input. However, some of the models on the list require daily temperature only,</span></span>
<span id="cb385-6721"><a href="#cb385-6721" aria-hidden="true" tabindex="-1"></a><span class="in"># so Eduardo wrote the `tempResponse_list_daily` function, which applies similar</span></span>
<span id="cb385-6722"><a href="#cb385-6722" aria-hidden="true" tabindex="-1"></a><span class="in"># procedures to daily data. </span></span>
<span id="cb385-6723"><a href="#cb385-6723" aria-hidden="true" tabindex="-1"></a><span class="in"># Unlike the `tempResponse_daily_list` function from `chillR`, this function </span></span>
<span id="cb385-6724"><a href="#cb385-6724" aria-hidden="true" tabindex="-1"></a><span class="in"># doesn’t include a `misstolerance` parameter, so we have to manually remove all</span></span>
<span id="cb385-6725"><a href="#cb385-6725" aria-hidden="true" tabindex="-1"></a><span class="in"># years with incomplete winter seasons. </span></span>
<span id="cb385-6726"><a href="#cb385-6726" aria-hidden="true" tabindex="-1"></a><span class="in"># We save all results in the data/chill folder, using the prefix Bonn_multichill:</span></span>
<span id="cb385-6727"><a href="#cb385-6727" aria-hidden="true" tabindex="-1"></a><span class="in">Start_JDay &lt;- 305</span></span>
<span id="cb385-6728"><a href="#cb385-6728" aria-hidden="true" tabindex="-1"></a><span class="in">End_JDay &lt;- 59</span></span>
<span id="cb385-6729"><a href="#cb385-6729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6730"><a href="#cb385-6730" aria-hidden="true" tabindex="-1"></a><span class="in"># Compute metrics from model using daily temps as input(rather than hourly temp)</span></span>
<span id="cb385-6731"><a href="#cb385-6731" aria-hidden="true" tabindex="-1"></a><span class="in">daily_models_past_scenarios &lt;- </span></span>
<span id="cb385-6732"><a href="#cb385-6732" aria-hidden="true" tabindex="-1"></a><span class="in">  tempResponse_list_daily(Temps,</span></span>
<span id="cb385-6733"><a href="#cb385-6733" aria-hidden="true" tabindex="-1"></a><span class="in">                          Start_JDay = Start_JDay,</span></span>
<span id="cb385-6734"><a href="#cb385-6734" aria-hidden="true" tabindex="-1"></a><span class="in">                          End_JDay = End_JDay,</span></span>
<span id="cb385-6735"><a href="#cb385-6735" aria-hidden="true" tabindex="-1"></a><span class="in">                          models=daily_models)</span></span>
<span id="cb385-6736"><a href="#cb385-6736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6737"><a href="#cb385-6737" aria-hidden="true" tabindex="-1"></a><span class="in"># Filter years with more than 90% temp data is available</span></span>
<span id="cb385-6738"><a href="#cb385-6738" aria-hidden="true" tabindex="-1"></a><span class="in">daily_models_past_scenarios &lt;- lapply(</span></span>
<span id="cb385-6739"><a href="#cb385-6739" aria-hidden="true" tabindex="-1"></a><span class="in">  daily_models_past_scenarios,</span></span>
<span id="cb385-6740"><a href="#cb385-6740" aria-hidden="true" tabindex="-1"></a><span class="in">  function(x) x[which(x$Perc_complete&gt;90),])</span></span>
<span id="cb385-6741"><a href="#cb385-6741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6742"><a href="#cb385-6742" aria-hidden="true" tabindex="-1"></a><span class="in"># Use chillR function to calculate from hourly temp data</span></span>
<span id="cb385-6743"><a href="#cb385-6743" aria-hidden="true" tabindex="-1"></a><span class="in">hourly_models_past_scenarios&lt;-</span></span>
<span id="cb385-6744"><a href="#cb385-6744" aria-hidden="true" tabindex="-1"></a><span class="in">  tempResponse_daily_list(Temps,</span></span>
<span id="cb385-6745"><a href="#cb385-6745" aria-hidden="true" tabindex="-1"></a><span class="in">                          latitude = 50.866,</span></span>
<span id="cb385-6746"><a href="#cb385-6746" aria-hidden="true" tabindex="-1"></a><span class="in">                          Start_JDay = Start_JDay,</span></span>
<span id="cb385-6747"><a href="#cb385-6747" aria-hidden="true" tabindex="-1"></a><span class="in">                          End_JDay = End_JDay,</span></span>
<span id="cb385-6748"><a href="#cb385-6748" aria-hidden="true" tabindex="-1"></a><span class="in">                          models = hourly_models,</span></span>
<span id="cb385-6749"><a href="#cb385-6749" aria-hidden="true" tabindex="-1"></a><span class="in">                          misstolerance = 10) # maximum percentage of values for </span></span>
<span id="cb385-6750"><a href="#cb385-6750" aria-hidden="true" tabindex="-1"></a><span class="in"># a given season that can be missing without the record being removed from the </span></span>
<span id="cb385-6751"><a href="#cb385-6751" aria-hidden="true" tabindex="-1"></a><span class="in"># output. Defaults to 50.</span></span>
<span id="cb385-6752"><a href="#cb385-6752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6753"><a href="#cb385-6753" aria-hidden="true" tabindex="-1"></a><span class="in">past_scenarios &lt;- daily_models_past_scenarios</span></span>
<span id="cb385-6754"><a href="#cb385-6754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6755"><a href="#cb385-6755" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine daily and hourly results into a single dataset</span></span>
<span id="cb385-6756"><a href="#cb385-6756" aria-hidden="true" tabindex="-1"></a><span class="in">past_scenarios &lt;- lapply(</span></span>
<span id="cb385-6757"><a href="#cb385-6757" aria-hidden="true" tabindex="-1"></a><span class="in">  names(past_scenarios),</span></span>
<span id="cb385-6758"><a href="#cb385-6758" aria-hidden="true" tabindex="-1"></a><span class="in">  function(x)</span></span>
<span id="cb385-6759"><a href="#cb385-6759" aria-hidden="true" tabindex="-1"></a><span class="in">    cbind(past_scenarios[[x]],</span></span>
<span id="cb385-6760"><a href="#cb385-6760" aria-hidden="true" tabindex="-1"></a><span class="in">          hourly_models_past_scenarios[[x]][,names(hourly_models)]))</span></span>
<span id="cb385-6761"><a href="#cb385-6761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6762"><a href="#cb385-6762" aria-hidden="true" tabindex="-1"></a><span class="in"># Take the years?</span></span>
<span id="cb385-6763"><a href="#cb385-6763" aria-hidden="true" tabindex="-1"></a><span class="in">names(past_scenarios) &lt;- names(daily_models_past_scenarios)</span></span>
<span id="cb385-6764"><a href="#cb385-6764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6765"><a href="#cb385-6765" aria-hidden="true" tabindex="-1"></a><span class="in">## Produce a summarize data.frame of chill responses from daily chill models</span></span>
<span id="cb385-6766"><a href="#cb385-6766" aria-hidden="true" tabindex="-1"></a><span class="in">daily_models_observed &lt;- </span></span>
<span id="cb385-6767"><a href="#cb385-6767" aria-hidden="true" tabindex="-1"></a><span class="in">  tempResponse_daily(Bonn_temps,</span></span>
<span id="cb385-6768"><a href="#cb385-6768" aria-hidden="true" tabindex="-1"></a><span class="in">                     Start_JDay = Start_JDay,</span></span>
<span id="cb385-6769"><a href="#cb385-6769" aria-hidden="true" tabindex="-1"></a><span class="in">                     End_JDay = End_JDay,</span></span>
<span id="cb385-6770"><a href="#cb385-6770" aria-hidden="true" tabindex="-1"></a><span class="in">                     models = daily_models)</span></span>
<span id="cb385-6771"><a href="#cb385-6771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6772"><a href="#cb385-6772" aria-hidden="true" tabindex="-1"></a><span class="in"># Filter only the records with more than 90% completeness</span></span>
<span id="cb385-6773"><a href="#cb385-6773" aria-hidden="true" tabindex="-1"></a><span class="in">daily_models_observed &lt;-</span></span>
<span id="cb385-6774"><a href="#cb385-6774" aria-hidden="true" tabindex="-1"></a><span class="in">  daily_models_observed[which(daily_models_observed$Perc_complete&gt;90),]</span></span>
<span id="cb385-6775"><a href="#cb385-6775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6776"><a href="#cb385-6776" aria-hidden="true" tabindex="-1"></a><span class="in"># Produce a data frame showing totals for all specified models for the </span></span>
<span id="cb385-6777"><a href="#cb385-6777" aria-hidden="true" tabindex="-1"></a><span class="in"># respective periods for all seasons included in the temperature records. </span></span>
<span id="cb385-6778"><a href="#cb385-6778" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculation of climatic metrics from lists of daily temperature records (hourly)</span></span>
<span id="cb385-6779"><a href="#cb385-6779" aria-hidden="true" tabindex="-1"></a><span class="in">hourly_models_observed &lt;- </span></span>
<span id="cb385-6780"><a href="#cb385-6780" aria-hidden="true" tabindex="-1"></a><span class="in">  tempResponse_daily_list(Bonn_temps,</span></span>
<span id="cb385-6781"><a href="#cb385-6781" aria-hidden="true" tabindex="-1"></a><span class="in">                          latitude=50.866,</span></span>
<span id="cb385-6782"><a href="#cb385-6782" aria-hidden="true" tabindex="-1"></a><span class="in">                          Start_JDay = Start_JDay,</span></span>
<span id="cb385-6783"><a href="#cb385-6783" aria-hidden="true" tabindex="-1"></a><span class="in">                          End_JDay = End_JDay,</span></span>
<span id="cb385-6784"><a href="#cb385-6784" aria-hidden="true" tabindex="-1"></a><span class="in">                          models = hourly_models,</span></span>
<span id="cb385-6785"><a href="#cb385-6785" aria-hidden="true" tabindex="-1"></a><span class="in">                          misstolerance = 10)</span></span>
<span id="cb385-6786"><a href="#cb385-6786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6787"><a href="#cb385-6787" aria-hidden="true" tabindex="-1"></a><span class="in"># Bind the observed daily and hourly resutls with respective model names</span></span>
<span id="cb385-6788"><a href="#cb385-6788" aria-hidden="true" tabindex="-1"></a><span class="in">past_observed &lt;- cbind(</span></span>
<span id="cb385-6789"><a href="#cb385-6789" aria-hidden="true" tabindex="-1"></a><span class="in">  daily_models_observed,</span></span>
<span id="cb385-6790"><a href="#cb385-6790" aria-hidden="true" tabindex="-1"></a><span class="in">  hourly_models_observed[[1]][,names(hourly_models)])</span></span>
<span id="cb385-6791"><a href="#cb385-6791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6792"><a href="#cb385-6792" aria-hidden="true" tabindex="-1"></a><span class="in"># Save data for later use</span></span>
<span id="cb385-6793"><a href="#cb385-6793" aria-hidden="true" tabindex="-1"></a><span class="in">save_temperature_scenarios(past_scenarios,</span></span>
<span id="cb385-6794"><a href="#cb385-6794" aria-hidden="true" tabindex="-1"></a><span class="in">                           "data/Bonn/Bonn_future_climate",</span></span>
<span id="cb385-6795"><a href="#cb385-6795" aria-hidden="true" tabindex="-1"></a><span class="in">                           "Bonn_multichill_305_59_historic")</span></span>
<span id="cb385-6796"><a href="#cb385-6796" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(past_observed,</span></span>
<span id="cb385-6797"><a href="#cb385-6797" aria-hidden="true" tabindex="-1"></a><span class="in">          "data/Bonn/Bonn_future_climate/Bonn_multichill_305_59_observed.csv",</span></span>
<span id="cb385-6798"><a href="#cb385-6798" aria-hidden="true" tabindex="-1"></a><span class="in">          row.names=FALSE)</span></span>
<span id="cb385-6799"><a href="#cb385-6799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6800"><a href="#cb385-6800" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-6801"><a href="#cb385-6801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6802"><a href="#cb385-6802" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-6803"><a href="#cb385-6803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6804"><a href="#cb385-6804" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now we apply similar procedures to the future data. Since we have eight scenarios again here, it makes sense to design this as a loop:</span>
<span id="cb385-6805"><a href="#cb385-6805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6806"><a href="#cb385-6806" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 19.2c, eval=FALSE}</span></span>
<span id="cb385-6807"><a href="#cb385-6807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6808"><a href="#cb385-6808" aria-hidden="true" tabindex="-1"></a><span class="in">## Do the same for future scenarios but in a loop</span></span>
<span id="cb385-6809"><a href="#cb385-6809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6810"><a href="#cb385-6810" aria-hidden="true" tabindex="-1"></a><span class="in"># Load future data </span></span>
<span id="cb385-6811"><a href="#cb385-6811" aria-hidden="true" tabindex="-1"></a><span class="in">future_temps &lt;- load_temperature_scenarios("data/Bonn/Bonn_future_climate",</span></span>
<span id="cb385-6812"><a href="#cb385-6812" aria-hidden="true" tabindex="-1"></a><span class="in">                                           "Bonn_future_")</span></span>
<span id="cb385-6813"><a href="#cb385-6813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6814"><a href="#cb385-6814" aria-hidden="true" tabindex="-1"></a><span class="in"># Define SSP models and years</span></span>
<span id="cb385-6815"><a href="#cb385-6815" aria-hidden="true" tabindex="-1"></a><span class="in">SSPs &lt;- c("ssp126", "ssp245","ssp370", "ssp585")</span></span>
<span id="cb385-6816"><a href="#cb385-6816" aria-hidden="true" tabindex="-1"></a><span class="in">Times &lt;- c(2050, 2085)</span></span>
<span id="cb385-6817"><a href="#cb385-6817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6818"><a href="#cb385-6818" aria-hidden="true" tabindex="-1"></a><span class="in"># Split names for ssp models</span></span>
<span id="cb385-6819"><a href="#cb385-6819" aria-hidden="true" tabindex="-1"></a><span class="in">list_ssp &lt;- </span></span>
<span id="cb385-6820"><a href="#cb385-6820" aria-hidden="true" tabindex="-1"></a><span class="in">  strsplit(names(future_temps), '\\.') %&gt;%</span></span>
<span id="cb385-6821"><a href="#cb385-6821" aria-hidden="true" tabindex="-1"></a><span class="in">  map(2) %&gt;%</span></span>
<span id="cb385-6822"><a href="#cb385-6822" aria-hidden="true" tabindex="-1"></a><span class="in">  unlist()</span></span>
<span id="cb385-6823"><a href="#cb385-6823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6824"><a href="#cb385-6824" aria-hidden="true" tabindex="-1"></a><span class="in"># Split for model names</span></span>
<span id="cb385-6825"><a href="#cb385-6825" aria-hidden="true" tabindex="-1"></a><span class="in">list_gcm &lt;-</span></span>
<span id="cb385-6826"><a href="#cb385-6826" aria-hidden="true" tabindex="-1"></a><span class="in">  strsplit(names(future_temps), '\\.') %&gt;%</span></span>
<span id="cb385-6827"><a href="#cb385-6827" aria-hidden="true" tabindex="-1"></a><span class="in">  map(3) %&gt;%</span></span>
<span id="cb385-6828"><a href="#cb385-6828" aria-hidden="true" tabindex="-1"></a><span class="in">  unlist()</span></span>
<span id="cb385-6829"><a href="#cb385-6829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6830"><a href="#cb385-6830" aria-hidden="true" tabindex="-1"></a><span class="in"># Split the years</span></span>
<span id="cb385-6831"><a href="#cb385-6831" aria-hidden="true" tabindex="-1"></a><span class="in">list_time &lt;-</span></span>
<span id="cb385-6832"><a href="#cb385-6832" aria-hidden="true" tabindex="-1"></a><span class="in">  strsplit(names(future_temps), '\\.') %&gt;%</span></span>
<span id="cb385-6833"><a href="#cb385-6833" aria-hidden="true" tabindex="-1"></a><span class="in">  map(4) %&gt;%</span></span>
<span id="cb385-6834"><a href="#cb385-6834" aria-hidden="true" tabindex="-1"></a><span class="in">  unlist()</span></span>
<span id="cb385-6835"><a href="#cb385-6835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6836"><a href="#cb385-6836" aria-hidden="true" tabindex="-1"></a><span class="in"># Make loop to repeat for all 8 scenarios</span></span>
<span id="cb385-6837"><a href="#cb385-6837" aria-hidden="true" tabindex="-1"></a><span class="in">for(SSP in SSPs)</span></span>
<span id="cb385-6838"><a href="#cb385-6838" aria-hidden="true" tabindex="-1"></a><span class="in">  for(Time in Times)</span></span>
<span id="cb385-6839"><a href="#cb385-6839" aria-hidden="true" tabindex="-1"></a><span class="in">    {</span></span>
<span id="cb385-6840"><a href="#cb385-6840" aria-hidden="true" tabindex="-1"></a><span class="in">    Temps &lt;- future_temps[list_ssp == SSP &amp; list_time == Time]</span></span>
<span id="cb385-6841"><a href="#cb385-6841" aria-hidden="true" tabindex="-1"></a><span class="in">    names(Temps) &lt;- list_gcm[list_ssp == SSP &amp; list_time == Time]</span></span>
<span id="cb385-6842"><a href="#cb385-6842" aria-hidden="true" tabindex="-1"></a><span class="in">    daily_models_future_scenarios &lt;- tempResponse_list_daily(</span></span>
<span id="cb385-6843"><a href="#cb385-6843" aria-hidden="true" tabindex="-1"></a><span class="in">      Temps,</span></span>
<span id="cb385-6844"><a href="#cb385-6844" aria-hidden="true" tabindex="-1"></a><span class="in">      Start_JDay = Start_JDay,</span></span>
<span id="cb385-6845"><a href="#cb385-6845" aria-hidden="true" tabindex="-1"></a><span class="in">      End_JDay = End_JDay,</span></span>
<span id="cb385-6846"><a href="#cb385-6846" aria-hidden="true" tabindex="-1"></a><span class="in">      models = daily_models)</span></span>
<span id="cb385-6847"><a href="#cb385-6847" aria-hidden="true" tabindex="-1"></a><span class="in">    daily_models_future_scenarios&lt;-lapply(</span></span>
<span id="cb385-6848"><a href="#cb385-6848" aria-hidden="true" tabindex="-1"></a><span class="in">      daily_models_future_scenarios,</span></span>
<span id="cb385-6849"><a href="#cb385-6849" aria-hidden="true" tabindex="-1"></a><span class="in">      function(x) x[which(x$Perc_complete&gt;90),])</span></span>
<span id="cb385-6850"><a href="#cb385-6850" aria-hidden="true" tabindex="-1"></a><span class="in">    hourly_models_future_scenarios&lt;-</span></span>
<span id="cb385-6851"><a href="#cb385-6851" aria-hidden="true" tabindex="-1"></a><span class="in">      tempResponse_daily_list(</span></span>
<span id="cb385-6852"><a href="#cb385-6852" aria-hidden="true" tabindex="-1"></a><span class="in">        Temps,</span></span>
<span id="cb385-6853"><a href="#cb385-6853" aria-hidden="true" tabindex="-1"></a><span class="in">        latitude = 50.866,</span></span>
<span id="cb385-6854"><a href="#cb385-6854" aria-hidden="true" tabindex="-1"></a><span class="in">        Start_JDay = Start_JDay,</span></span>
<span id="cb385-6855"><a href="#cb385-6855" aria-hidden="true" tabindex="-1"></a><span class="in">        End_JDay = End_JDay,</span></span>
<span id="cb385-6856"><a href="#cb385-6856" aria-hidden="true" tabindex="-1"></a><span class="in">        models=hourly_models,</span></span>
<span id="cb385-6857"><a href="#cb385-6857" aria-hidden="true" tabindex="-1"></a><span class="in">        misstolerance = 10)</span></span>
<span id="cb385-6858"><a href="#cb385-6858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6859"><a href="#cb385-6859" aria-hidden="true" tabindex="-1"></a><span class="in">    future_scenarios &lt;- daily_models_future_scenarios</span></span>
<span id="cb385-6860"><a href="#cb385-6860" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb385-6861"><a href="#cb385-6861" aria-hidden="true" tabindex="-1"></a><span class="in">    future_scenarios &lt;- lapply(</span></span>
<span id="cb385-6862"><a href="#cb385-6862" aria-hidden="true" tabindex="-1"></a><span class="in">      names(future_scenarios),</span></span>
<span id="cb385-6863"><a href="#cb385-6863" aria-hidden="true" tabindex="-1"></a><span class="in">      function(x)</span></span>
<span id="cb385-6864"><a href="#cb385-6864" aria-hidden="true" tabindex="-1"></a><span class="in">        cbind(future_scenarios[[x]],</span></span>
<span id="cb385-6865"><a href="#cb385-6865" aria-hidden="true" tabindex="-1"></a><span class="in">              hourly_models_future_scenarios[[x]][,names(hourly_models)]))</span></span>
<span id="cb385-6866"><a href="#cb385-6866" aria-hidden="true" tabindex="-1"></a><span class="in">    names(future_scenarios)&lt;-names(daily_models_future_scenarios)</span></span>
<span id="cb385-6867"><a href="#cb385-6867" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb385-6868"><a href="#cb385-6868" aria-hidden="true" tabindex="-1"></a><span class="in">    chill&lt;-future_scenarios</span></span>
<span id="cb385-6869"><a href="#cb385-6869" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb385-6870"><a href="#cb385-6870" aria-hidden="true" tabindex="-1"></a><span class="in">    save_temperature_scenarios(</span></span>
<span id="cb385-6871"><a href="#cb385-6871" aria-hidden="true" tabindex="-1"></a><span class="in">      chill,</span></span>
<span id="cb385-6872"><a href="#cb385-6872" aria-hidden="true" tabindex="-1"></a><span class="in">      "data/Bonn/Bonn_future_climate",</span></span>
<span id="cb385-6873"><a href="#cb385-6873" aria-hidden="true" tabindex="-1"></a><span class="in">      paste0("Bonn_multichill_305_59_",Time,"_",SSP))</span></span>
<span id="cb385-6874"><a href="#cb385-6874" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-6875"><a href="#cb385-6875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6876"><a href="#cb385-6876" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-6877"><a href="#cb385-6877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6878"><a href="#cb385-6878" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-6879"><a href="#cb385-6879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6880"><a href="#cb385-6880" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now all scenarios we want to process and plot have been saved to disk. We can now load them and produce chill scenarios.</span>
<span id="cb385-6881"><a href="#cb385-6881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6882"><a href="#cb385-6882" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 19.2d}</span></span>
<span id="cb385-6883"><a href="#cb385-6883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6884"><a href="#cb385-6884" aria-hidden="true" tabindex="-1"></a><span class="in">chill_past_scenarios &lt;- load_temperature_scenarios(</span></span>
<span id="cb385-6885"><a href="#cb385-6885" aria-hidden="true" tabindex="-1"></a><span class="in">  "data/Bonn/Bonn_future_climate",</span></span>
<span id="cb385-6886"><a href="#cb385-6886" aria-hidden="true" tabindex="-1"></a><span class="in">  "Bonn_multichill_305_59_historic")</span></span>
<span id="cb385-6887"><a href="#cb385-6887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6888"><a href="#cb385-6888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6889"><a href="#cb385-6889" aria-hidden="true" tabindex="-1"></a><span class="in">chill_observed &lt;- read_tab(</span></span>
<span id="cb385-6890"><a href="#cb385-6890" aria-hidden="true" tabindex="-1"></a><span class="in">  "data/Bonn/Bonn_future_climate/Bonn_multichill_305_59_observed.csv")</span></span>
<span id="cb385-6891"><a href="#cb385-6891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6892"><a href="#cb385-6892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6893"><a href="#cb385-6893" aria-hidden="true" tabindex="-1"></a><span class="in"># Make climate scenarios for plotting from a list of climate metric data </span></span>
<span id="cb385-6894"><a href="#cb385-6894" aria-hidden="true" tabindex="-1"></a><span class="in"># produced by tempResponse_daily_list, for example</span></span>
<span id="cb385-6895"><a href="#cb385-6895" aria-hidden="true" tabindex="-1"></a><span class="in">chills &lt;- make_climate_scenario(chill_past_scenarios,</span></span>
<span id="cb385-6896"><a href="#cb385-6896" aria-hidden="true" tabindex="-1"></a><span class="in">                                caption = "Historical",</span></span>
<span id="cb385-6897"><a href="#cb385-6897" aria-hidden="true" tabindex="-1"></a><span class="in">                                historic_data = chill_observed,</span></span>
<span id="cb385-6898"><a href="#cb385-6898" aria-hidden="true" tabindex="-1"></a><span class="in">                                time_series = TRUE)</span></span>
<span id="cb385-6899"><a href="#cb385-6899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6900"><a href="#cb385-6900" aria-hidden="true" tabindex="-1"></a><span class="in"># Add this again to knit better</span></span>
<span id="cb385-6901"><a href="#cb385-6901" aria-hidden="true" tabindex="-1"></a><span class="in">SSPs &lt;- c("ssp126", "ssp245","ssp370", "ssp585")</span></span>
<span id="cb385-6902"><a href="#cb385-6902" aria-hidden="true" tabindex="-1"></a><span class="in">Times &lt;- c(2050, 2085)</span></span>
<span id="cb385-6903"><a href="#cb385-6903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6904"><a href="#cb385-6904" aria-hidden="true" tabindex="-1"></a><span class="in"># Create loops for future scenarios</span></span>
<span id="cb385-6905"><a href="#cb385-6905" aria-hidden="true" tabindex="-1"></a><span class="in">for(SSP in SSPs)</span></span>
<span id="cb385-6906"><a href="#cb385-6906" aria-hidden="true" tabindex="-1"></a><span class="in">  for(Time in Times)</span></span>
<span id="cb385-6907"><a href="#cb385-6907" aria-hidden="true" tabindex="-1"></a><span class="in">    { # load future climate scenarios with designated file names</span></span>
<span id="cb385-6908"><a href="#cb385-6908" aria-hidden="true" tabindex="-1"></a><span class="in">    chill &lt;- load_temperature_scenarios(</span></span>
<span id="cb385-6909"><a href="#cb385-6909" aria-hidden="true" tabindex="-1"></a><span class="in">      "data/Bonn/Bonn_future_climate",</span></span>
<span id="cb385-6910"><a href="#cb385-6910" aria-hidden="true" tabindex="-1"></a><span class="in">      paste0("Bonn_multichill_305_59_",Time,"_",SSP))</span></span>
<span id="cb385-6911"><a href="#cb385-6911" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp126") SSPcaption &lt;- "SSP1"</span></span>
<span id="cb385-6912"><a href="#cb385-6912" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp245") SSPcaption &lt;- "SSP2"</span></span>
<span id="cb385-6913"><a href="#cb385-6913" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp370") SSPcaption &lt;- "SSP3"</span></span>
<span id="cb385-6914"><a href="#cb385-6914" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp585") SSPcaption &lt;- "SSP5"    </span></span>
<span id="cb385-6915"><a href="#cb385-6915" aria-hidden="true" tabindex="-1"></a><span class="in">    if(Time == "2050") Time_caption &lt;- "2050"</span></span>
<span id="cb385-6916"><a href="#cb385-6916" aria-hidden="true" tabindex="-1"></a><span class="in">    if(Time == "2085") Time_caption &lt;- "2085"</span></span>
<span id="cb385-6917"><a href="#cb385-6917" aria-hidden="true" tabindex="-1"></a><span class="in">    chills &lt;- make_climate_scenario(chill,</span></span>
<span id="cb385-6918"><a href="#cb385-6918" aria-hidden="true" tabindex="-1"></a><span class="in">                                    caption = c(SSPcaption,</span></span>
<span id="cb385-6919"><a href="#cb385-6919" aria-hidden="true" tabindex="-1"></a><span class="in">                                                Time_caption),</span></span>
<span id="cb385-6920"><a href="#cb385-6920" aria-hidden="true" tabindex="-1"></a><span class="in">                                    add_to = chills) </span></span>
<span id="cb385-6921"><a href="#cb385-6921" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-6922"><a href="#cb385-6922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6923"><a href="#cb385-6923" aria-hidden="true" tabindex="-1"></a><span class="in"># Now we want to make a heat map of Safe Winter Chill, using the ggplot2. </span></span>
<span id="cb385-6924"><a href="#cb385-6924" aria-hidden="true" tabindex="-1"></a><span class="in"># This again requires reorganizing our data into a long data.frame. </span></span>
<span id="cb385-6925"><a href="#cb385-6925" aria-hidden="true" tabindex="-1"></a><span class="in"># We also have to calculate the 10% quantiles from the distributions. </span></span>
<span id="cb385-6926"><a href="#cb385-6926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6927"><a href="#cb385-6927" aria-hidden="true" tabindex="-1"></a><span class="in"># Since all the chill models have different units, and numeric values differ </span></span>
<span id="cb385-6928"><a href="#cb385-6928" aria-hidden="true" tabindex="-1"></a><span class="in"># greatly across the models, we normalize all the results, expressing them as </span></span>
<span id="cb385-6929"><a href="#cb385-6929" aria-hidden="true" tabindex="-1"></a><span class="in"># changes relative to a 1980 baseline:</span></span>
<span id="cb385-6930"><a href="#cb385-6930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6931"><a href="#cb385-6931" aria-hidden="true" tabindex="-1"></a><span class="in">for(i in 1:length(chills))</span></span>
<span id="cb385-6932"><a href="#cb385-6932" aria-hidden="true" tabindex="-1"></a><span class="in">   {ch &lt;- chills[[i]]</span></span>
<span id="cb385-6933"><a href="#cb385-6933" aria-hidden="true" tabindex="-1"></a><span class="in">   if(ch$caption[1] == "Historical")</span></span>
<span id="cb385-6934"><a href="#cb385-6934" aria-hidden="true" tabindex="-1"></a><span class="in">     {GCMs &lt;- rep("none",length(names(ch$data)))</span></span>
<span id="cb385-6935"><a href="#cb385-6935" aria-hidden="true" tabindex="-1"></a><span class="in">      SSPs &lt;- rep("none",length(names(ch$data)))</span></span>
<span id="cb385-6936"><a href="#cb385-6936" aria-hidden="true" tabindex="-1"></a><span class="in">      Years &lt;- as.numeric(ch$labels)</span></span>
<span id="cb385-6937"><a href="#cb385-6937" aria-hidden="true" tabindex="-1"></a><span class="in">      Scenario &lt;- rep("Historical",</span></span>
<span id="cb385-6938"><a href="#cb385-6938" aria-hidden="true" tabindex="-1"></a><span class="in">                      length(names(ch$data)))} else</span></span>
<span id="cb385-6939"><a href="#cb385-6939" aria-hidden="true" tabindex="-1"></a><span class="in">                        {GCMs &lt;- names(ch$data)</span></span>
<span id="cb385-6940"><a href="#cb385-6940" aria-hidden="true" tabindex="-1"></a><span class="in">                        SSPs &lt;- rep(ch$caption[1],</span></span>
<span id="cb385-6941"><a href="#cb385-6941" aria-hidden="true" tabindex="-1"></a><span class="in">                                    length(names(ch$data)))</span></span>
<span id="cb385-6942"><a href="#cb385-6942" aria-hidden="true" tabindex="-1"></a><span class="in">                        Years &lt;- rep(as.numeric(ch$caption[2]),</span></span>
<span id="cb385-6943"><a href="#cb385-6943" aria-hidden="true" tabindex="-1"></a><span class="in">                                     length(names(ch$data)))</span></span>
<span id="cb385-6944"><a href="#cb385-6944" aria-hidden="true" tabindex="-1"></a><span class="in">                        Scenario &lt;- rep("Future",</span></span>
<span id="cb385-6945"><a href="#cb385-6945" aria-hidden="true" tabindex="-1"></a><span class="in">                                        length(names(ch$data)))}</span></span>
<span id="cb385-6946"><a href="#cb385-6946" aria-hidden="true" tabindex="-1"></a><span class="in">   for(nam in names(ch$data))</span></span>
<span id="cb385-6947"><a href="#cb385-6947" aria-hidden="true" tabindex="-1"></a><span class="in">     {for(met in metrics)</span></span>
<span id="cb385-6948"><a href="#cb385-6948" aria-hidden="true" tabindex="-1"></a><span class="in">       {temp_res &lt;-</span></span>
<span id="cb385-6949"><a href="#cb385-6949" aria-hidden="true" tabindex="-1"></a><span class="in">         data.frame(Metric = met,</span></span>
<span id="cb385-6950"><a href="#cb385-6950" aria-hidden="true" tabindex="-1"></a><span class="in">                    GCM = GCMs[which(nam == names(ch$data))],</span></span>
<span id="cb385-6951"><a href="#cb385-6951" aria-hidden="true" tabindex="-1"></a><span class="in">                    SSP = SSPs[which(nam == names(ch$data))],</span></span>
<span id="cb385-6952"><a href="#cb385-6952" aria-hidden="true" tabindex="-1"></a><span class="in">                    Year = Years[which(nam == names(ch$data))],</span></span>
<span id="cb385-6953"><a href="#cb385-6953" aria-hidden="true" tabindex="-1"></a><span class="in">                    Result = quantile(ch$data[[nam]][,met],0.1), # calculate 10% quantile</span></span>
<span id="cb385-6954"><a href="#cb385-6954" aria-hidden="true" tabindex="-1"></a><span class="in">                    Scenario = Scenario[which(nam == names(ch$data))])</span></span>
<span id="cb385-6955"><a href="#cb385-6955" aria-hidden="true" tabindex="-1"></a><span class="in">       if(i == 1 &amp; nam == names(ch$data)[1] &amp; met == metrics[1])</span></span>
<span id="cb385-6956"><a href="#cb385-6956" aria-hidden="true" tabindex="-1"></a><span class="in">         results &lt;- temp_res else</span></span>
<span id="cb385-6957"><a href="#cb385-6957" aria-hidden="true" tabindex="-1"></a><span class="in">           results &lt;- rbind(results,</span></span>
<span id="cb385-6958"><a href="#cb385-6958" aria-hidden="true" tabindex="-1"></a><span class="in">                            temp_res)</span></span>
<span id="cb385-6959"><a href="#cb385-6959" aria-hidden="true" tabindex="-1"></a><span class="in">         }</span></span>
<span id="cb385-6960"><a href="#cb385-6960" aria-hidden="true" tabindex="-1"></a><span class="in">     }</span></span>
<span id="cb385-6961"><a href="#cb385-6961" aria-hidden="true" tabindex="-1"></a><span class="in">   }</span></span>
<span id="cb385-6962"><a href="#cb385-6962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6963"><a href="#cb385-6963" aria-hidden="true" tabindex="-1"></a><span class="in"># Normalize the results by dividing with the 1989 baseline value</span></span>
<span id="cb385-6964"><a href="#cb385-6964" aria-hidden="true" tabindex="-1"></a><span class="in">for(met in metrics)</span></span>
<span id="cb385-6965"><a href="#cb385-6965" aria-hidden="true" tabindex="-1"></a><span class="in">  results[which(results$Metric == met),"SWC"] &lt;-</span></span>
<span id="cb385-6966"><a href="#cb385-6966" aria-hidden="true" tabindex="-1"></a><span class="in">    results[which(results$Metric == met),"Result"]/</span></span>
<span id="cb385-6967"><a href="#cb385-6967" aria-hidden="true" tabindex="-1"></a><span class="in">      results[which(results$Metric == met &amp; results$Year == 1980),</span></span>
<span id="cb385-6968"><a href="#cb385-6968" aria-hidden="true" tabindex="-1"></a><span class="in">              "Result"]-1 # calculate percentage change compared to baseline</span></span>
<span id="cb385-6969"><a href="#cb385-6969" aria-hidden="true" tabindex="-1"></a><span class="in"># subtract 1 to change to percent change (% increase or decrease)</span></span>
<span id="cb385-6970"><a href="#cb385-6970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6971"><a href="#cb385-6971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6972"><a href="#cb385-6972" aria-hidden="true" tabindex="-1"></a><span class="in"># Now we’re ready for plotting the results. Since we’ll have different panels in</span></span>
<span id="cb385-6973"><a href="#cb385-6973" aria-hidden="true" tabindex="-1"></a><span class="in"># this plot and we want axes to be consistent, we need to capture the full range</span></span>
<span id="cb385-6974"><a href="#cb385-6974" aria-hidden="true" tabindex="-1"></a><span class="in"># of Safe Winter Chill change values. </span></span>
<span id="cb385-6975"><a href="#cb385-6975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6976"><a href="#cb385-6976" aria-hidden="true" tabindex="-1"></a><span class="in"># Then we can make our first heat map plot. Let’s start with the future (the </span></span>
<span id="cb385-6977"><a href="#cb385-6977" aria-hidden="true" tabindex="-1"></a><span class="in"># ones where the GCM is not ‘none’). Note that in the aesthetics we’re using </span></span>
<span id="cb385-6978"><a href="#cb385-6978" aria-hidden="true" tabindex="-1"></a><span class="in"># `factor` here for the y element. This ensures that the metrics are plotted in </span></span>
<span id="cb385-6979"><a href="#cb385-6979" aria-hidden="true" tabindex="-1"></a><span class="in"># the order specified by the `levels` parameter.</span></span>
<span id="cb385-6980"><a href="#cb385-6980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6981"><a href="#cb385-6981" aria-hidden="true" tabindex="-1"></a><span class="in"># Get the minimum and maximum values using range function</span></span>
<span id="cb385-6982"><a href="#cb385-6982" aria-hidden="true" tabindex="-1"></a><span class="in">rng = range(results$SWC) </span></span>
<span id="cb385-6983"><a href="#cb385-6983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6984"><a href="#cb385-6984" aria-hidden="true" tabindex="-1"></a><span class="in">p_future &lt;- ggplot(results[which(!results$GCM == "none"),], # future ones</span></span>
<span id="cb385-6985"><a href="#cb385-6985" aria-hidden="true" tabindex="-1"></a><span class="in">                   aes(GCM,</span></span>
<span id="cb385-6986"><a href="#cb385-6986" aria-hidden="true" tabindex="-1"></a><span class="in">                       y = factor(Metric, # factor as categorical data </span></span>
<span id="cb385-6987"><a href="#cb385-6987" aria-hidden="true" tabindex="-1"></a><span class="in">                                  levels = metrics), # follow order in metrics</span></span>
<span id="cb385-6988"><a href="#cb385-6988" aria-hidden="true" tabindex="-1"></a><span class="in">                       fill = SWC)) +</span></span>
<span id="cb385-6989"><a href="#cb385-6989" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_tile()</span></span>
<span id="cb385-6990"><a href="#cb385-6990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6991"><a href="#cb385-6991" aria-hidden="true" tabindex="-1"></a><span class="in">p_future</span></span>
<span id="cb385-6992"><a href="#cb385-6992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6993"><a href="#cb385-6993" aria-hidden="true" tabindex="-1"></a><span class="in"># This plot still combines information for both SSPs and both points in time. </span></span>
<span id="cb385-6994"><a href="#cb385-6994" aria-hidden="true" tabindex="-1"></a><span class="in"># Let’s show these in separate facets:</span></span>
<span id="cb385-6995"><a href="#cb385-6995" aria-hidden="true" tabindex="-1"></a><span class="in">p_future &lt;-</span></span>
<span id="cb385-6996"><a href="#cb385-6996" aria-hidden="true" tabindex="-1"></a><span class="in">  p_future +</span></span>
<span id="cb385-6997"><a href="#cb385-6997" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(SSP ~ Year) </span></span>
<span id="cb385-6998"><a href="#cb385-6998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-6999"><a href="#cb385-6999" aria-hidden="true" tabindex="-1"></a><span class="in">p_future</span></span>
<span id="cb385-7000"><a href="#cb385-7000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7001"><a href="#cb385-7001" aria-hidden="true" tabindex="-1"></a><span class="in"># Let’s choose the black and white scheme and make the axis text a bit smaller. </span></span>
<span id="cb385-7002"><a href="#cb385-7002" aria-hidden="true" tabindex="-1"></a><span class="in"># The latter seems reasonable here, because we have a lot of text there, </span></span>
<span id="cb385-7003"><a href="#cb385-7003" aria-hidden="true" tabindex="-1"></a><span class="in"># which will be hard to show at full size.</span></span>
<span id="cb385-7004"><a href="#cb385-7004" aria-hidden="true" tabindex="-1"></a><span class="in">p_future &lt;-</span></span>
<span id="cb385-7005"><a href="#cb385-7005" aria-hidden="true" tabindex="-1"></a><span class="in">  p_future +</span></span>
<span id="cb385-7006"><a href="#cb385-7006" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +</span></span>
<span id="cb385-7007"><a href="#cb385-7007" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text = element_text(size=6))</span></span>
<span id="cb385-7008"><a href="#cb385-7008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7009"><a href="#cb385-7009" aria-hidden="true" tabindex="-1"></a><span class="in">p_future</span></span>
<span id="cb385-7010"><a href="#cb385-7010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7011"><a href="#cb385-7011" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-7012"><a href="#cb385-7012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7013"><a href="#cb385-7013" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-7014"><a href="#cb385-7014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7015"><a href="#cb385-7015" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The current color scheme makes it hard to distinguish subtle differences. Let’s use a red to blue color ramp with a few intermediate values. </span>
<span id="cb385-7016"><a href="#cb385-7016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7017"><a href="#cb385-7017" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The <span class="in">`colorRamps`</span> library has a few nice schemes, including the <span class="in">`matlab.like`</span> color ramp, from which we choose 15 equally spaced values. </span>
<span id="cb385-7018"><a href="#cb385-7018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7019"><a href="#cb385-7019" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We’ll also show the changes in percent, and set the scale limits to the full range of the data we determined earlier:</span>
<span id="cb385-7020"><a href="#cb385-7020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7021"><a href="#cb385-7021" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 19.2e}</span></span>
<span id="cb385-7022"><a href="#cb385-7022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7023"><a href="#cb385-7023" aria-hidden="true" tabindex="-1"></a><span class="in"># library(colorRamps)</span></span>
<span id="cb385-7024"><a href="#cb385-7024" aria-hidden="true" tabindex="-1"></a><span class="in">p_future &lt;-</span></span>
<span id="cb385-7025"><a href="#cb385-7025" aria-hidden="true" tabindex="-1"></a><span class="in">  p_future +</span></span>
<span id="cb385-7026"><a href="#cb385-7026" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_gradientn(colours = matlab.like(15),</span></span>
<span id="cb385-7027"><a href="#cb385-7027" aria-hidden="true" tabindex="-1"></a><span class="in">                       labels = scales::percent,</span></span>
<span id="cb385-7028"><a href="#cb385-7028" aria-hidden="true" tabindex="-1"></a><span class="in">                       limits = rng)</span></span>
<span id="cb385-7029"><a href="#cb385-7029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7030"><a href="#cb385-7030" aria-hidden="true" tabindex="-1"></a><span class="in">p_future</span></span>
<span id="cb385-7031"><a href="#cb385-7031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7032"><a href="#cb385-7032" aria-hidden="true" tabindex="-1"></a><span class="in"># Let’s change the angle of the x-axis labels to 75°, so that the labels are </span></span>
<span id="cb385-7033"><a href="#cb385-7033" aria-hidden="true" tabindex="-1"></a><span class="in"># actually readable.</span></span>
<span id="cb385-7034"><a href="#cb385-7034" aria-hidden="true" tabindex="-1"></a><span class="in"># We’ll also add a nicer title to the legend (note the ‘backslash n’ commands </span></span>
<span id="cb385-7035"><a href="#cb385-7035" aria-hidden="true" tabindex="-1"></a><span class="in"># that stand for line breaks), replace the automatic axis labels with the nicer </span></span>
<span id="cb385-7036"><a href="#cb385-7036" aria-hidden="true" tabindex="-1"></a><span class="in"># ones we designed above and change the label of the y-axis to “Chill metric”.</span></span>
<span id="cb385-7037"><a href="#cb385-7037" aria-hidden="true" tabindex="-1"></a><span class="in">p_future &lt;-</span></span>
<span id="cb385-7038"><a href="#cb385-7038" aria-hidden="true" tabindex="-1"></a><span class="in">  p_future  +</span></span>
<span id="cb385-7039"><a href="#cb385-7039" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.x = element_text(angle = 75, </span></span>
<span id="cb385-7040"><a href="#cb385-7040" aria-hidden="true" tabindex="-1"></a><span class="in">                                   hjust = 1,</span></span>
<span id="cb385-7041"><a href="#cb385-7041" aria-hidden="true" tabindex="-1"></a><span class="in">                                   vjust = 1)) +</span></span>
<span id="cb385-7042"><a href="#cb385-7042" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(fill = "Change in\nSafe Winter Chill\nsince 1980") +</span></span>
<span id="cb385-7043"><a href="#cb385-7043" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_discrete(labels = model_labels) + # change to publishable format</span></span>
<span id="cb385-7044"><a href="#cb385-7044" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Chill metric")</span></span>
<span id="cb385-7045"><a href="#cb385-7045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7046"><a href="#cb385-7046" aria-hidden="true" tabindex="-1"></a><span class="in">p_future</span></span>
<span id="cb385-7047"><a href="#cb385-7047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7048"><a href="#cb385-7048" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-7049"><a href="#cb385-7049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7050"><a href="#cb385-7050" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-7051"><a href="#cb385-7051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7052"><a href="#cb385-7052" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now we can make the plot of past scenarios. </span>
<span id="cb385-7053"><a href="#cb385-7053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7054"><a href="#cb385-7054" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Note that we’re moving the x-axis to the top using the <span class="in">`scale_x_continuous(position = "top")`</span> command.</span>
<span id="cb385-7055"><a href="#cb385-7055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7056"><a href="#cb385-7056" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 19.2f}</span></span>
<span id="cb385-7057"><a href="#cb385-7057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7058"><a href="#cb385-7058" aria-hidden="true" tabindex="-1"></a><span class="in">p_past&lt;-</span></span>
<span id="cb385-7059"><a href="#cb385-7059" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(results[which(results$GCM == "none"),],</span></span>
<span id="cb385-7060"><a href="#cb385-7060" aria-hidden="true" tabindex="-1"></a><span class="in">         aes(Year,</span></span>
<span id="cb385-7061"><a href="#cb385-7061" aria-hidden="true" tabindex="-1"></a><span class="in">             y = factor(Metric, </span></span>
<span id="cb385-7062"><a href="#cb385-7062" aria-hidden="true" tabindex="-1"></a><span class="in">                        levels=metrics),</span></span>
<span id="cb385-7063"><a href="#cb385-7063" aria-hidden="true" tabindex="-1"></a><span class="in">             fill = SWC)) +</span></span>
<span id="cb385-7064"><a href="#cb385-7064" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_tile()</span></span>
<span id="cb385-7065"><a href="#cb385-7065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7066"><a href="#cb385-7066" aria-hidden="true" tabindex="-1"></a><span class="in">p_past&lt;-</span></span>
<span id="cb385-7067"><a href="#cb385-7067" aria-hidden="true" tabindex="-1"></a><span class="in">  p_past +</span></span>
<span id="cb385-7068"><a href="#cb385-7068" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +</span></span>
<span id="cb385-7069"><a href="#cb385-7069" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text = element_text(size = 6))</span></span>
<span id="cb385-7070"><a href="#cb385-7070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7071"><a href="#cb385-7071" aria-hidden="true" tabindex="-1"></a><span class="in">p_past&lt;-</span></span>
<span id="cb385-7072"><a href="#cb385-7072" aria-hidden="true" tabindex="-1"></a><span class="in">  p_past +</span></span>
<span id="cb385-7073"><a href="#cb385-7073" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_gradientn(colours = matlab.like(15),</span></span>
<span id="cb385-7074"><a href="#cb385-7074" aria-hidden="true" tabindex="-1"></a><span class="in">                       labels = scales::percent,</span></span>
<span id="cb385-7075"><a href="#cb385-7075" aria-hidden="true" tabindex="-1"></a><span class="in">                       limits = rng)</span></span>
<span id="cb385-7076"><a href="#cb385-7076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7077"><a href="#cb385-7077" aria-hidden="true" tabindex="-1"></a><span class="in">p_past&lt;-</span></span>
<span id="cb385-7078"><a href="#cb385-7078" aria-hidden="true" tabindex="-1"></a><span class="in">  p_past +</span></span>
<span id="cb385-7079"><a href="#cb385-7079" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(position = "top") </span></span>
<span id="cb385-7080"><a href="#cb385-7080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7081"><a href="#cb385-7081" aria-hidden="true" tabindex="-1"></a><span class="in">p_past&lt;-</span></span>
<span id="cb385-7082"><a href="#cb385-7082" aria-hidden="true" tabindex="-1"></a><span class="in">  p_past +</span></span>
<span id="cb385-7083"><a href="#cb385-7083" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(fill = "Change in\nSafe Winter Chill\nsince 1980") +</span></span>
<span id="cb385-7084"><a href="#cb385-7084" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_discrete(labels = model_labels) +</span></span>
<span id="cb385-7085"><a href="#cb385-7085" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Chill metric")</span></span>
<span id="cb385-7086"><a href="#cb385-7086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7087"><a href="#cb385-7087" aria-hidden="true" tabindex="-1"></a><span class="in">p_past</span></span>
<span id="cb385-7088"><a href="#cb385-7088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7089"><a href="#cb385-7089" aria-hidden="true" tabindex="-1"></a><span class="in"># Now we can combine the plots. We’ll again use the patchwork package for this. </span></span>
<span id="cb385-7090"><a href="#cb385-7090" aria-hidden="true" tabindex="-1"></a><span class="in"># Mainly the plots are now on top of each other (nrow=2, with relative heights </span></span>
<span id="cb385-7091"><a href="#cb385-7091" aria-hidden="true" tabindex="-1"></a><span class="in"># specified by heights=c(1,2)). </span></span>
<span id="cb385-7092"><a href="#cb385-7092" aria-hidden="true" tabindex="-1"></a><span class="in">chill_comp_plot&lt;-</span></span>
<span id="cb385-7093"><a href="#cb385-7093" aria-hidden="true" tabindex="-1"></a><span class="in">  (p_past +</span></span>
<span id="cb385-7094"><a href="#cb385-7094" aria-hidden="true" tabindex="-1"></a><span class="in">     p_future +</span></span>
<span id="cb385-7095"><a href="#cb385-7095" aria-hidden="true" tabindex="-1"></a><span class="in">     # collect guides below to the given nesting level, removing duplicates/</span></span>
<span id="cb385-7096"><a href="#cb385-7096" aria-hidden="true" tabindex="-1"></a><span class="in">     # collect all legends from two plots into a single legend</span></span>
<span id="cb385-7097"><a href="#cb385-7097" aria-hidden="true" tabindex="-1"></a><span class="in">     plot_layout(guides = "collect", </span></span>
<span id="cb385-7098"><a href="#cb385-7098" aria-hidden="true" tabindex="-1"></a><span class="in">                 nrow = 2,</span></span>
<span id="cb385-7099"><a href="#cb385-7099" aria-hidden="true" tabindex="-1"></a><span class="in">                 heights = c(1,3))) &amp;</span></span>
<span id="cb385-7100"><a href="#cb385-7100" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "right",</span></span>
<span id="cb385-7101"><a href="#cb385-7101" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.background = element_blank(),</span></span>
<span id="cb385-7102"><a href="#cb385-7102" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.text = element_text(face = "bold"))</span></span>
<span id="cb385-7103"><a href="#cb385-7103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7104"><a href="#cb385-7104" aria-hidden="true" tabindex="-1"></a><span class="in">chill_comp_plot</span></span>
<span id="cb385-7105"><a href="#cb385-7105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7106"><a href="#cb385-7106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-7107"><a href="#cb385-7107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7108"><a href="#cb385-7108" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-7109"><a href="#cb385-7109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7110"><a href="#cb385-7110" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Note the major differences between the behaviors of the various model. Some models indicate that Safe Winter Chill is increasing, while other say it’s decreasing. This is a clear indication that model choice matters!</span>
<span id="cb385-7111"><a href="#cb385-7111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7112"><a href="#cb385-7112" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-7113"><a href="#cb385-7113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7114"><a href="#cb385-7114" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;19.3&lt;/span&gt;&amp;nbsp; An animated plot of relative changes in Safe Winter Chill</span></span>
<span id="cb385-7115"><a href="#cb385-7115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7116"><a href="#cb385-7116" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-7117"><a href="#cb385-7117" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-7118"><a href="#cb385-7118" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Another R package <span class="in">`gganimate`</span> can add a cool feature to figures produced with <span class="in">`ggplot2`</span>.</span>
<span id="cb385-7119"><a href="#cb385-7119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7120"><a href="#cb385-7120" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To make use of this, let’s produce a simpler representation of the Safe Winter Chill data. For this, let’s summarize the results across all the GCMs. </span>
<span id="cb385-7121"><a href="#cb385-7121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7122"><a href="#cb385-7122" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We’ll also duplicate the historic data and assign one of each of the duplicates to each SSP scenario. This is needed for easily plotting the full time series, disaggregated by SSP.</span>
<span id="cb385-7123"><a href="#cb385-7123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7124"><a href="#cb385-7124" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 19.3a}</span></span>
<span id="cb385-7125"><a href="#cb385-7125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7126"><a href="#cb385-7126" aria-hidden="true" tabindex="-1"></a><span class="in"># Copy historical data for each SSP and then bind into data frame</span></span>
<span id="cb385-7127"><a href="#cb385-7127" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results &lt;- results[which(results$GCM == "none"),]</span></span>
<span id="cb385-7128"><a href="#cb385-7128" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results$SSP &lt;- "SSP1"</span></span>
<span id="cb385-7129"><a href="#cb385-7129" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results_2 &lt;- hist_results</span></span>
<span id="cb385-7130"><a href="#cb385-7130" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results_2$SSP &lt;- "SSP2"</span></span>
<span id="cb385-7131"><a href="#cb385-7131" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results_3 &lt;- hist_results</span></span>
<span id="cb385-7132"><a href="#cb385-7132" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results_3$SSP &lt;- "SSP3"</span></span>
<span id="cb385-7133"><a href="#cb385-7133" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results_4 &lt;- hist_results</span></span>
<span id="cb385-7134"><a href="#cb385-7134" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results_4$SSP &lt;- "SSP5"</span></span>
<span id="cb385-7135"><a href="#cb385-7135" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results &lt;- rbind(hist_results,</span></span>
<span id="cb385-7136"><a href="#cb385-7136" aria-hidden="true" tabindex="-1"></a><span class="in">                      hist_results_2,</span></span>
<span id="cb385-7137"><a href="#cb385-7137" aria-hidden="true" tabindex="-1"></a><span class="in">                      hist_results_3,</span></span>
<span id="cb385-7138"><a href="#cb385-7138" aria-hidden="true" tabindex="-1"></a><span class="in">                      hist_results_4)</span></span>
<span id="cb385-7139"><a href="#cb385-7139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7140"><a href="#cb385-7140" aria-hidden="true" tabindex="-1"></a><span class="in">future_results &lt;- results[which(!results$GCM == "none"),]</span></span>
<span id="cb385-7141"><a href="#cb385-7141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7142"><a href="#cb385-7142" aria-hidden="true" tabindex="-1"></a><span class="in"># Compute summary statistics of data subsets</span></span>
<span id="cb385-7143"><a href="#cb385-7143" aria-hidden="true" tabindex="-1"></a><span class="in">GCM_aggregate &lt;- aggregate(</span></span>
<span id="cb385-7144"><a href="#cb385-7144" aria-hidden="true" tabindex="-1"></a><span class="in">  future_results$SWC, # safe winter chill- the value to aggregate</span></span>
<span id="cb385-7145"><a href="#cb385-7145" aria-hidden="true" tabindex="-1"></a><span class="in">  by=list(future_results$Metric, # group data by these categories/select only</span></span>
<span id="cb385-7146"><a href="#cb385-7146" aria-hidden="true" tabindex="-1"></a><span class="in">          future_results$SSP,</span></span>
<span id="cb385-7147"><a href="#cb385-7147" aria-hidden="true" tabindex="-1"></a><span class="in">          future_results$Year),</span></span>
<span id="cb385-7148"><a href="#cb385-7148" aria-hidden="true" tabindex="-1"></a><span class="in">  FUN=mean) # calculate the mean</span></span>
<span id="cb385-7149"><a href="#cb385-7149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7150"><a href="#cb385-7150" aria-hidden="true" tabindex="-1"></a><span class="in"># Rename the columns</span></span>
<span id="cb385-7151"><a href="#cb385-7151" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(GCM_aggregate) &lt;- c("Metric",</span></span>
<span id="cb385-7152"><a href="#cb385-7152" aria-hidden="true" tabindex="-1"></a><span class="in">                             "SSP",</span></span>
<span id="cb385-7153"><a href="#cb385-7153" aria-hidden="true" tabindex="-1"></a><span class="in">                             "Year",</span></span>
<span id="cb385-7154"><a href="#cb385-7154" aria-hidden="true" tabindex="-1"></a><span class="in">                             "SWC")</span></span>
<span id="cb385-7155"><a href="#cb385-7155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7156"><a href="#cb385-7156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7157"><a href="#cb385-7157" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine historical SWC data (for SSPs) and mean future SWC projection </span></span>
<span id="cb385-7158"><a href="#cb385-7158" aria-hidden="true" tabindex="-1"></a><span class="in">SSP_Time_series&lt;-rbind(hist_results[,c("Metric",</span></span>
<span id="cb385-7159"><a href="#cb385-7159" aria-hidden="true" tabindex="-1"></a><span class="in">                                       "SSP",</span></span>
<span id="cb385-7160"><a href="#cb385-7160" aria-hidden="true" tabindex="-1"></a><span class="in">                                       "Year",</span></span>
<span id="cb385-7161"><a href="#cb385-7161" aria-hidden="true" tabindex="-1"></a><span class="in">                                       "SWC")], # only select these 4 columns</span></span>
<span id="cb385-7162"><a href="#cb385-7162" aria-hidden="true" tabindex="-1"></a><span class="in">                       GCM_aggregate)</span></span>
<span id="cb385-7163"><a href="#cb385-7163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7164"><a href="#cb385-7164" aria-hidden="true" tabindex="-1"></a><span class="in"># Now we can make a line plot showing changes in Safe Winter Chill over the two </span></span>
<span id="cb385-7165"><a href="#cb385-7165" aria-hidden="true" tabindex="-1"></a><span class="in"># SSP scenarios for all of the chill metrics. This is very similar to the </span></span>
<span id="cb385-7166"><a href="#cb385-7166" aria-hidden="true" tabindex="-1"></a><span class="in"># procedures above, except that now we’re using the geom_line command </span></span>
<span id="cb385-7167"><a href="#cb385-7167" aria-hidden="true" tabindex="-1"></a><span class="in"># rather than geom_tile (there are some more minor differences).</span></span>
<span id="cb385-7168"><a href="#cb385-7168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7169"><a href="#cb385-7169" aria-hidden="true" tabindex="-1"></a><span class="in"># Make sure all are numeric years</span></span>
<span id="cb385-7170"><a href="#cb385-7170" aria-hidden="true" tabindex="-1"></a><span class="in">SSP_Time_series$Year &lt;- as.numeric(SSP_Time_series$Year)</span></span>
<span id="cb385-7171"><a href="#cb385-7171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7172"><a href="#cb385-7172" aria-hidden="true" tabindex="-1"></a><span class="in">chill_change_plot&lt;-</span></span>
<span id="cb385-7173"><a href="#cb385-7173" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(data = SSP_Time_series,</span></span>
<span id="cb385-7174"><a href="#cb385-7174" aria-hidden="true" tabindex="-1"></a><span class="in">         aes(x = Year,</span></span>
<span id="cb385-7175"><a href="#cb385-7175" aria-hidden="true" tabindex="-1"></a><span class="in">             y = SWC,</span></span>
<span id="cb385-7176"><a href="#cb385-7176" aria-hidden="true" tabindex="-1"></a><span class="in">             col = factor(Metric,</span></span>
<span id="cb385-7177"><a href="#cb385-7177" aria-hidden="true" tabindex="-1"></a><span class="in">                          levels = metrics))) +</span></span>
<span id="cb385-7178"><a href="#cb385-7178" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(lwd = 1.3) +</span></span>
<span id="cb385-7179"><a href="#cb385-7179" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~SSP,</span></span>
<span id="cb385-7180"><a href="#cb385-7180" aria-hidden="true" tabindex="-1"></a><span class="in">             nrow = 4) +</span></span>
<span id="cb385-7181"><a href="#cb385-7181" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 10) +</span></span>
<span id="cb385-7182"><a href="#cb385-7182" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(col = "Change in\nSafe Winter Chill\nsince 1980") +</span></span>
<span id="cb385-7183"><a href="#cb385-7183" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_discrete(labels = model_labels) +</span></span>
<span id="cb385-7184"><a href="#cb385-7184" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(labels = scales::percent) + # display values as %</span></span>
<span id="cb385-7185"><a href="#cb385-7185" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(strip.background = element_blank(),</span></span>
<span id="cb385-7186"><a href="#cb385-7186" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.text = element_text(face = "bold")) +</span></span>
<span id="cb385-7187"><a href="#cb385-7187" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Safe Winter Chill")</span></span>
<span id="cb385-7188"><a href="#cb385-7188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7189"><a href="#cb385-7189" aria-hidden="true" tabindex="-1"></a><span class="in">chill_change_plot</span></span>
<span id="cb385-7190"><a href="#cb385-7190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7191"><a href="#cb385-7191" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-7192"><a href="#cb385-7192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7193"><a href="#cb385-7193" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-7194"><a href="#cb385-7194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7195"><a href="#cb385-7195" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now as a final step, we’ll convert this into a moving picture using the <span class="in">`transition_reveal`</span> function from the <span class="in">`gganimate`</span> package. We’ll save the resulting animation.</span>
<span id="cb385-7196"><a href="#cb385-7196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7197"><a href="#cb385-7197" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 19.3b, eval=FALSE}</span></span>
<span id="cb385-7198"><a href="#cb385-7198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7199"><a href="#cb385-7199" aria-hidden="true" tabindex="-1"></a><span class="in"># library(gganimate)</span></span>
<span id="cb385-7200"><a href="#cb385-7200" aria-hidden="true" tabindex="-1"></a><span class="in"># library(gifski)</span></span>
<span id="cb385-7201"><a href="#cb385-7201" aria-hidden="true" tabindex="-1"></a><span class="in"># library(png)</span></span>
<span id="cb385-7202"><a href="#cb385-7202" aria-hidden="true" tabindex="-1"></a><span class="in"># library(transformr)</span></span>
<span id="cb385-7203"><a href="#cb385-7203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7204"><a href="#cb385-7204" aria-hidden="true" tabindex="-1"></a><span class="in">ccp&lt;-chill_change_plot +</span></span>
<span id="cb385-7205"><a href="#cb385-7205" aria-hidden="true" tabindex="-1"></a><span class="in">  transition_reveal(Year)</span></span>
<span id="cb385-7206"><a href="#cb385-7206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7207"><a href="#cb385-7207" aria-hidden="true" tabindex="-1"></a><span class="in">animate(ccp, fps = 10)</span></span>
<span id="cb385-7208"><a href="#cb385-7208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7209"><a href="#cb385-7209" aria-hidden="true" tabindex="-1"></a><span class="in">anim_save("data/Bonn/Bonn_chill_comparison_animation.gif",</span></span>
<span id="cb385-7210"><a href="#cb385-7210" aria-hidden="true" tabindex="-1"></a><span class="in">          animation = last_animation())</span></span>
<span id="cb385-7211"><a href="#cb385-7211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7212"><a href="#cb385-7212" aria-hidden="true" tabindex="-1"></a><span class="in">include_graphics("data/Bonn/Bonn_chill_comparison_animation.gif")</span></span>
<span id="cb385-7213"><a href="#cb385-7213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7214"><a href="#cb385-7214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7215"><a href="#cb385-7215" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-7216"><a href="#cb385-7216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7217"><a href="#cb385-7217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7218"><a href="#cb385-7218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7219"><a href="#cb385-7219" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 19.3c, echo=FALSE, out.width="80%"}</span></span>
<span id="cb385-7220"><a href="#cb385-7220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7221"><a href="#cb385-7221" aria-hidden="true" tabindex="-1"></a><span class="in">include_graphics("data/Bonn/Bonn_chill_comparison_animation.gif")</span></span>
<span id="cb385-7222"><a href="#cb385-7222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7223"><a href="#cb385-7223" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-7224"><a href="#cb385-7224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7225"><a href="#cb385-7225" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-7226"><a href="#cb385-7226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7227"><a href="#cb385-7227" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Animation of chill development over time, relative to 1980 and evaluated with 13 chill models.</span>
<span id="cb385-7228"><a href="#cb385-7228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7229"><a href="#cb385-7229" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-7230"><a href="#cb385-7230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7231"><a href="#cb385-7231" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;19.4&lt;/span&gt;&amp;nbsp; Exercises on chill model comparison</span></span>
<span id="cb385-7232"><a href="#cb385-7232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7233"><a href="#cb385-7233" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-7234"><a href="#cb385-7234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7235"><a href="#cb385-7235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7236"><a href="#cb385-7236" aria-hidden="true" tabindex="-1"></a>***1. Perform a similar analysis for the location you’ve chosen for your exercises.***</span>
<span id="cb385-7237"><a href="#cb385-7237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7238"><a href="#cb385-7238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7239"><a href="#cb385-7239" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 19.4.1, eval=FALSE}</span></span>
<span id="cb385-7240"><a href="#cb385-7240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7241"><a href="#cb385-7241" aria-hidden="true" tabindex="-1"></a><span class="in"># Make a list of models that calculate chilling using hourly temp data</span></span>
<span id="cb385-7242"><a href="#cb385-7242" aria-hidden="true" tabindex="-1"></a><span class="in">hourly_models &lt;- list(Chilling_units = chilling_units,</span></span>
<span id="cb385-7243"><a href="#cb385-7243" aria-hidden="true" tabindex="-1"></a><span class="in">     Low_chill = low_chill_model,</span></span>
<span id="cb385-7244"><a href="#cb385-7244" aria-hidden="true" tabindex="-1"></a><span class="in">     Modified_Utah = modified_utah_model,</span></span>
<span id="cb385-7245"><a href="#cb385-7245" aria-hidden="true" tabindex="-1"></a><span class="in">     North_Carolina = north_carolina_model,</span></span>
<span id="cb385-7246"><a href="#cb385-7246" aria-hidden="true" tabindex="-1"></a><span class="in">     Positive_Utah = positive_utah_model,</span></span>
<span id="cb385-7247"><a href="#cb385-7247" aria-hidden="true" tabindex="-1"></a><span class="in">     Chilling_Hours = Chilling_Hours,</span></span>
<span id="cb385-7248"><a href="#cb385-7248" aria-hidden="true" tabindex="-1"></a><span class="in">     Utah_Chill_Units = Utah_Model,</span></span>
<span id="cb385-7249"><a href="#cb385-7249" aria-hidden="true" tabindex="-1"></a><span class="in">     Chill_Portions = Dynamic_Model)</span></span>
<span id="cb385-7250"><a href="#cb385-7250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7251"><a href="#cb385-7251" aria-hidden="true" tabindex="-1"></a><span class="in"># list for daily models that use daily temp data</span></span>
<span id="cb385-7252"><a href="#cb385-7252" aria-hidden="true" tabindex="-1"></a><span class="in">daily_models &lt;- list(Rate_of_Chill = rate_of_chill,</span></span>
<span id="cb385-7253"><a href="#cb385-7253" aria-hidden="true" tabindex="-1"></a><span class="in">                     Chill_Days = chill_days,</span></span>
<span id="cb385-7254"><a href="#cb385-7254" aria-hidden="true" tabindex="-1"></a><span class="in">                     Exponential_Chill = exponential_chill,</span></span>
<span id="cb385-7255"><a href="#cb385-7255" aria-hidden="true" tabindex="-1"></a><span class="in">                     Triangular_Chill_Legave = triangular_chill_2)</span></span>
<span id="cb385-7256"><a href="#cb385-7256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7257"><a href="#cb385-7257" aria-hidden="true" tabindex="-1"></a><span class="in"># Combines hourly and daily model names into a single vector</span></span>
<span id="cb385-7258"><a href="#cb385-7258" aria-hidden="true" tabindex="-1"></a><span class="in">metrics &lt;- c(names(daily_models),</span></span>
<span id="cb385-7259"><a href="#cb385-7259" aria-hidden="true" tabindex="-1"></a><span class="in">             names(hourly_models))</span></span>
<span id="cb385-7260"><a href="#cb385-7260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7261"><a href="#cb385-7261" aria-hidden="true" tabindex="-1"></a><span class="in"># Give readable names</span></span>
<span id="cb385-7262"><a href="#cb385-7262" aria-hidden="true" tabindex="-1"></a><span class="in">model_labels = c("Rate of Chill",</span></span>
<span id="cb385-7263"><a href="#cb385-7263" aria-hidden="true" tabindex="-1"></a><span class="in">                 "Chill Days",</span></span>
<span id="cb385-7264"><a href="#cb385-7264" aria-hidden="true" tabindex="-1"></a><span class="in">                 "Exponential Chill",</span></span>
<span id="cb385-7265"><a href="#cb385-7265" aria-hidden="true" tabindex="-1"></a><span class="in">                 "Triangular Chill (Legave)",</span></span>
<span id="cb385-7266"><a href="#cb385-7266" aria-hidden="true" tabindex="-1"></a><span class="in">                 "Chilling Units",</span></span>
<span id="cb385-7267"><a href="#cb385-7267" aria-hidden="true" tabindex="-1"></a><span class="in">                 "Low-Chill Chill Units",</span></span>
<span id="cb385-7268"><a href="#cb385-7268" aria-hidden="true" tabindex="-1"></a><span class="in">                 "Modified Utah Chill Units",</span></span>
<span id="cb385-7269"><a href="#cb385-7269" aria-hidden="true" tabindex="-1"></a><span class="in">                 "North Carolina Chill Units",</span></span>
<span id="cb385-7270"><a href="#cb385-7270" aria-hidden="true" tabindex="-1"></a><span class="in">                 "Positive Utah Chill Units",</span></span>
<span id="cb385-7271"><a href="#cb385-7271" aria-hidden="true" tabindex="-1"></a><span class="in">                 "Chilling Hours",</span></span>
<span id="cb385-7272"><a href="#cb385-7272" aria-hidden="true" tabindex="-1"></a><span class="in">                 "Utah Chill Units",</span></span>
<span id="cb385-7273"><a href="#cb385-7273" aria-hidden="true" tabindex="-1"></a><span class="in">                 "Chill Portions")</span></span>
<span id="cb385-7274"><a href="#cb385-7274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7275"><a href="#cb385-7275" aria-hidden="true" tabindex="-1"></a><span class="in"># Load saved historical temp data for Mössingen</span></span>
<span id="cb385-7276"><a href="#cb385-7276" aria-hidden="true" tabindex="-1"></a><span class="in">MS_temps &lt;- read_tab("data/MS/MS_patched_weather.csv")</span></span>
<span id="cb385-7277"><a href="#cb385-7277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7278"><a href="#cb385-7278" aria-hidden="true" tabindex="-1"></a><span class="in">Temps &lt;- load_temperature_scenarios("data/MS", "MS_hist_scenarios")</span></span>
<span id="cb385-7279"><a href="#cb385-7279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7280"><a href="#cb385-7280" aria-hidden="true" tabindex="-1"></a><span class="in"># Select JDays</span></span>
<span id="cb385-7281"><a href="#cb385-7281" aria-hidden="true" tabindex="-1"></a><span class="in">Start_JDay &lt;- 305</span></span>
<span id="cb385-7282"><a href="#cb385-7282" aria-hidden="true" tabindex="-1"></a><span class="in">End_JDay &lt;- 59</span></span>
<span id="cb385-7283"><a href="#cb385-7283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7284"><a href="#cb385-7284" aria-hidden="true" tabindex="-1"></a><span class="in"># Compute metrics from model using daily temps as input(rather than hourly</span></span>
<span id="cb385-7285"><a href="#cb385-7285" aria-hidden="true" tabindex="-1"></a><span class="in"># temp)</span></span>
<span id="cb385-7286"><a href="#cb385-7286" aria-hidden="true" tabindex="-1"></a><span class="in">daily_models_past_scenarios &lt;- tempResponse_list_daily(Temps, </span></span>
<span id="cb385-7287"><a href="#cb385-7287" aria-hidden="true" tabindex="-1"></a><span class="in">                                                       Start_JDay = Start_JDay,</span></span>
<span id="cb385-7288"><a href="#cb385-7288" aria-hidden="true" tabindex="-1"></a><span class="in">                                                       End_JDay = End_JDay, </span></span>
<span id="cb385-7289"><a href="#cb385-7289" aria-hidden="true" tabindex="-1"></a><span class="in">                                                       models = daily_models)</span></span>
<span id="cb385-7290"><a href="#cb385-7290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7291"><a href="#cb385-7291" aria-hidden="true" tabindex="-1"></a><span class="in"># Filter years with more than 90% temp data is available</span></span>
<span id="cb385-7292"><a href="#cb385-7292" aria-hidden="true" tabindex="-1"></a><span class="in">daily_models_past_scenarios &lt;- lapply(daily_models_past_scenarios, function(x) x[which(x$Perc_complete &gt;</span></span>
<span id="cb385-7293"><a href="#cb385-7293" aria-hidden="true" tabindex="-1"></a><span class="in">    90), ])</span></span>
<span id="cb385-7294"><a href="#cb385-7294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7295"><a href="#cb385-7295" aria-hidden="true" tabindex="-1"></a><span class="in"># Use chillR function to calculate from hourly temp data</span></span>
<span id="cb385-7296"><a href="#cb385-7296" aria-hidden="true" tabindex="-1"></a><span class="in">hourly_models_past_scenarios &lt;- tempResponse_daily_list(Temps, latitude = 48.405,</span></span>
<span id="cb385-7297"><a href="#cb385-7297" aria-hidden="true" tabindex="-1"></a><span class="in">    Start_JDay = Start_JDay, End_JDay = End_JDay, models = hourly_models, </span></span>
<span id="cb385-7298"><a href="#cb385-7298" aria-hidden="true" tabindex="-1"></a><span class="in">    misstolerance = 10) </span></span>
<span id="cb385-7299"><a href="#cb385-7299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7300"><a href="#cb385-7300" aria-hidden="true" tabindex="-1"></a><span class="in">past_scenarios &lt;- daily_models_past_scenarios</span></span>
<span id="cb385-7301"><a href="#cb385-7301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7302"><a href="#cb385-7302" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine daily and hourly results into a single dataset</span></span>
<span id="cb385-7303"><a href="#cb385-7303" aria-hidden="true" tabindex="-1"></a><span class="in">past_scenarios &lt;- lapply(names(past_scenarios), function(x) cbind(past_scenarios[[x]],</span></span>
<span id="cb385-7304"><a href="#cb385-7304" aria-hidden="true" tabindex="-1"></a><span class="in">    hourly_models_past_scenarios[[x]][, names(hourly_models)]))</span></span>
<span id="cb385-7305"><a href="#cb385-7305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7306"><a href="#cb385-7306" aria-hidden="true" tabindex="-1"></a><span class="in"># Take the years</span></span>
<span id="cb385-7307"><a href="#cb385-7307" aria-hidden="true" tabindex="-1"></a><span class="in">names(past_scenarios) &lt;- names(daily_models_past_scenarios)</span></span>
<span id="cb385-7308"><a href="#cb385-7308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7309"><a href="#cb385-7309" aria-hidden="true" tabindex="-1"></a><span class="in">## Produce a summarize data.frame of chill responses from daily chill models</span></span>
<span id="cb385-7310"><a href="#cb385-7310" aria-hidden="true" tabindex="-1"></a><span class="in">daily_models_observed &lt;- tempResponse_daily(MS_temps, Start_JDay = Start_JDay,</span></span>
<span id="cb385-7311"><a href="#cb385-7311" aria-hidden="true" tabindex="-1"></a><span class="in">    End_JDay = End_JDay, models = daily_models)</span></span>
<span id="cb385-7312"><a href="#cb385-7312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7313"><a href="#cb385-7313" aria-hidden="true" tabindex="-1"></a><span class="in"># Filter only the records with more than 90% completeness</span></span>
<span id="cb385-7314"><a href="#cb385-7314" aria-hidden="true" tabindex="-1"></a><span class="in">daily_models_observed &lt;- daily_models_observed[which(daily_models_observed$Perc_complete &gt;</span></span>
<span id="cb385-7315"><a href="#cb385-7315" aria-hidden="true" tabindex="-1"></a><span class="in">    90), ]</span></span>
<span id="cb385-7316"><a href="#cb385-7316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7317"><a href="#cb385-7317" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculation of climatic metrics from lists of daily temperature records</span></span>
<span id="cb385-7318"><a href="#cb385-7318" aria-hidden="true" tabindex="-1"></a><span class="in"># (hourly)</span></span>
<span id="cb385-7319"><a href="#cb385-7319" aria-hidden="true" tabindex="-1"></a><span class="in">hourly_models_observed &lt;- tempResponse_daily_list(MS_temps, latitude = 48.405,</span></span>
<span id="cb385-7320"><a href="#cb385-7320" aria-hidden="true" tabindex="-1"></a><span class="in">    Start_JDay = Start_JDay, End_JDay = End_JDay, models = hourly_models,</span></span>
<span id="cb385-7321"><a href="#cb385-7321" aria-hidden="true" tabindex="-1"></a><span class="in">    misstolerance = 10)</span></span>
<span id="cb385-7322"><a href="#cb385-7322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7323"><a href="#cb385-7323" aria-hidden="true" tabindex="-1"></a><span class="in"># Bind the observed daily and hourly resutls with respective model names</span></span>
<span id="cb385-7324"><a href="#cb385-7324" aria-hidden="true" tabindex="-1"></a><span class="in">past_observed &lt;- cbind(daily_models_observed, </span></span>
<span id="cb385-7325"><a href="#cb385-7325" aria-hidden="true" tabindex="-1"></a><span class="in">                       hourly_models_observed[[1]][, names(hourly_models)])</span></span>
<span id="cb385-7326"><a href="#cb385-7326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7327"><a href="#cb385-7327" aria-hidden="true" tabindex="-1"></a><span class="in"># Save data for later use</span></span>
<span id="cb385-7328"><a href="#cb385-7328" aria-hidden="true" tabindex="-1"></a><span class="in">save_temperature_scenarios(past_scenarios, "data/MS/MS_future_climate", "MS_multichill_305_59_historic")</span></span>
<span id="cb385-7329"><a href="#cb385-7329" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(past_observed, "data/MS/MS_future_climate/MS_multichill_305_59_observed.csv",</span></span>
<span id="cb385-7330"><a href="#cb385-7330" aria-hidden="true" tabindex="-1"></a><span class="in">    row.names = FALSE)</span></span>
<span id="cb385-7331"><a href="#cb385-7331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7332"><a href="#cb385-7332" aria-hidden="true" tabindex="-1"></a><span class="in">## Do the same for future scenarios but in a loop</span></span>
<span id="cb385-7333"><a href="#cb385-7333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7334"><a href="#cb385-7334" aria-hidden="true" tabindex="-1"></a><span class="in"># Load future data</span></span>
<span id="cb385-7335"><a href="#cb385-7335" aria-hidden="true" tabindex="-1"></a><span class="in">future_temps &lt;- load_temperature_scenarios("data/MS/MS_future_climate", "MS_future_")</span></span>
<span id="cb385-7336"><a href="#cb385-7336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7337"><a href="#cb385-7337" aria-hidden="true" tabindex="-1"></a><span class="in"># Define SSP models and years</span></span>
<span id="cb385-7338"><a href="#cb385-7338" aria-hidden="true" tabindex="-1"></a><span class="in">SSPs &lt;- c("ssp126", "ssp245", "ssp370", "ssp585")</span></span>
<span id="cb385-7339"><a href="#cb385-7339" aria-hidden="true" tabindex="-1"></a><span class="in">Times &lt;- c(2050, 2085)</span></span>
<span id="cb385-7340"><a href="#cb385-7340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7341"><a href="#cb385-7341" aria-hidden="true" tabindex="-1"></a><span class="in"># Split names for ssp models</span></span>
<span id="cb385-7342"><a href="#cb385-7342" aria-hidden="true" tabindex="-1"></a><span class="in">list_ssp &lt;- strsplit(names(future_temps), "\\.") %&gt;%</span></span>
<span id="cb385-7343"><a href="#cb385-7343" aria-hidden="true" tabindex="-1"></a><span class="in">    map(2) %&gt;%</span></span>
<span id="cb385-7344"><a href="#cb385-7344" aria-hidden="true" tabindex="-1"></a><span class="in">    unlist()</span></span>
<span id="cb385-7345"><a href="#cb385-7345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7346"><a href="#cb385-7346" aria-hidden="true" tabindex="-1"></a><span class="in"># Split for model names</span></span>
<span id="cb385-7347"><a href="#cb385-7347" aria-hidden="true" tabindex="-1"></a><span class="in">list_gcm &lt;- strsplit(names(future_temps), "\\.") %&gt;%</span></span>
<span id="cb385-7348"><a href="#cb385-7348" aria-hidden="true" tabindex="-1"></a><span class="in">    map(3) %&gt;%</span></span>
<span id="cb385-7349"><a href="#cb385-7349" aria-hidden="true" tabindex="-1"></a><span class="in">    unlist()</span></span>
<span id="cb385-7350"><a href="#cb385-7350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7351"><a href="#cb385-7351" aria-hidden="true" tabindex="-1"></a><span class="in"># Split the years</span></span>
<span id="cb385-7352"><a href="#cb385-7352" aria-hidden="true" tabindex="-1"></a><span class="in">list_time &lt;- strsplit(names(future_temps), "\\.") %&gt;%</span></span>
<span id="cb385-7353"><a href="#cb385-7353" aria-hidden="true" tabindex="-1"></a><span class="in">    map(4) %&gt;%</span></span>
<span id="cb385-7354"><a href="#cb385-7354" aria-hidden="true" tabindex="-1"></a><span class="in">    unlist()</span></span>
<span id="cb385-7355"><a href="#cb385-7355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7356"><a href="#cb385-7356" aria-hidden="true" tabindex="-1"></a><span class="in"># Make loop to repeat for all 8 scenarios</span></span>
<span id="cb385-7357"><a href="#cb385-7357" aria-hidden="true" tabindex="-1"></a><span class="in">for (SSP in SSPs) for (Time in Times) {</span></span>
<span id="cb385-7358"><a href="#cb385-7358" aria-hidden="true" tabindex="-1"></a><span class="in">    Temps &lt;- future_temps[list_ssp == SSP &amp; list_time == Time]</span></span>
<span id="cb385-7359"><a href="#cb385-7359" aria-hidden="true" tabindex="-1"></a><span class="in">    names(Temps) &lt;- list_gcm[list_ssp == SSP &amp; list_time == Time]</span></span>
<span id="cb385-7360"><a href="#cb385-7360" aria-hidden="true" tabindex="-1"></a><span class="in">    daily_models_future_scenarios &lt;- tempResponse_list_daily(Temps, Start_JDay = Start_JDay,</span></span>
<span id="cb385-7361"><a href="#cb385-7361" aria-hidden="true" tabindex="-1"></a><span class="in">        End_JDay = End_JDay, models = daily_models)</span></span>
<span id="cb385-7362"><a href="#cb385-7362" aria-hidden="true" tabindex="-1"></a><span class="in">    daily_models_future_scenarios &lt;- lapply(daily_models_future_scenarios, function(x) x[which(x$Perc_complete &gt;</span></span>
<span id="cb385-7363"><a href="#cb385-7363" aria-hidden="true" tabindex="-1"></a><span class="in">        90), ])</span></span>
<span id="cb385-7364"><a href="#cb385-7364" aria-hidden="true" tabindex="-1"></a><span class="in">    hourly_models_future_scenarios &lt;- tempResponse_daily_list(Temps, latitude = 48.405,</span></span>
<span id="cb385-7365"><a href="#cb385-7365" aria-hidden="true" tabindex="-1"></a><span class="in">        Start_JDay = Start_JDay, End_JDay = End_JDay, models = hourly_models, misstolerance = 10)</span></span>
<span id="cb385-7366"><a href="#cb385-7366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7367"><a href="#cb385-7367" aria-hidden="true" tabindex="-1"></a><span class="in">    future_scenarios &lt;- daily_models_future_scenarios</span></span>
<span id="cb385-7368"><a href="#cb385-7368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7369"><a href="#cb385-7369" aria-hidden="true" tabindex="-1"></a><span class="in">    future_scenarios &lt;- lapply(names(future_scenarios), function(x) cbind(future_scenarios[[x]],</span></span>
<span id="cb385-7370"><a href="#cb385-7370" aria-hidden="true" tabindex="-1"></a><span class="in">        hourly_models_future_scenarios[[x]][, names(hourly_models)]))</span></span>
<span id="cb385-7371"><a href="#cb385-7371" aria-hidden="true" tabindex="-1"></a><span class="in">    names(future_scenarios) &lt;- names(daily_models_future_scenarios)</span></span>
<span id="cb385-7372"><a href="#cb385-7372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7373"><a href="#cb385-7373" aria-hidden="true" tabindex="-1"></a><span class="in">    chill &lt;- future_scenarios</span></span>
<span id="cb385-7374"><a href="#cb385-7374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7375"><a href="#cb385-7375" aria-hidden="true" tabindex="-1"></a><span class="in">    save_temperature_scenarios(chill, "data/MS/MS_future_climate", </span></span>
<span id="cb385-7376"><a href="#cb385-7376" aria-hidden="true" tabindex="-1"></a><span class="in">                               paste0("MS_multichill_305_59_", Time, "_", SSP))</span></span>
<span id="cb385-7377"><a href="#cb385-7377" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-7378"><a href="#cb385-7378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7379"><a href="#cb385-7379" aria-hidden="true" tabindex="-1"></a><span class="in">chill_past_scenarios &lt;- load_temperature_scenarios(</span></span>
<span id="cb385-7380"><a href="#cb385-7380" aria-hidden="true" tabindex="-1"></a><span class="in">  "data/MS/MS_future_climate",</span></span>
<span id="cb385-7381"><a href="#cb385-7381" aria-hidden="true" tabindex="-1"></a><span class="in">  "MS_multichill_305_59_historic")</span></span>
<span id="cb385-7382"><a href="#cb385-7382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7383"><a href="#cb385-7383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7384"><a href="#cb385-7384" aria-hidden="true" tabindex="-1"></a><span class="in">chill_observed &lt;- read_tab(</span></span>
<span id="cb385-7385"><a href="#cb385-7385" aria-hidden="true" tabindex="-1"></a><span class="in">  "data/MS/MS_future_climate/MS_multichill_305_59_observed.csv")</span></span>
<span id="cb385-7386"><a href="#cb385-7386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7387"><a href="#cb385-7387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7388"><a href="#cb385-7388" aria-hidden="true" tabindex="-1"></a><span class="in"># Make climate scenarios for plotting from a list of climate metric data </span></span>
<span id="cb385-7389"><a href="#cb385-7389" aria-hidden="true" tabindex="-1"></a><span class="in"># produced by tempResponse_daily_list, for example</span></span>
<span id="cb385-7390"><a href="#cb385-7390" aria-hidden="true" tabindex="-1"></a><span class="in">chills &lt;- make_climate_scenario(chill_past_scenarios,</span></span>
<span id="cb385-7391"><a href="#cb385-7391" aria-hidden="true" tabindex="-1"></a><span class="in">                                caption = "Historical",</span></span>
<span id="cb385-7392"><a href="#cb385-7392" aria-hidden="true" tabindex="-1"></a><span class="in">                                historic_data = chill_observed,</span></span>
<span id="cb385-7393"><a href="#cb385-7393" aria-hidden="true" tabindex="-1"></a><span class="in">                                time_series = TRUE)</span></span>
<span id="cb385-7394"><a href="#cb385-7394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7395"><a href="#cb385-7395" aria-hidden="true" tabindex="-1"></a><span class="in"># Add this again to knit better</span></span>
<span id="cb385-7396"><a href="#cb385-7396" aria-hidden="true" tabindex="-1"></a><span class="in">SSPs &lt;- c("ssp126", "ssp245","ssp370", "ssp585")</span></span>
<span id="cb385-7397"><a href="#cb385-7397" aria-hidden="true" tabindex="-1"></a><span class="in">Times &lt;- c(2050, 2085)</span></span>
<span id="cb385-7398"><a href="#cb385-7398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7399"><a href="#cb385-7399" aria-hidden="true" tabindex="-1"></a><span class="in"># Create loops for future scenarios</span></span>
<span id="cb385-7400"><a href="#cb385-7400" aria-hidden="true" tabindex="-1"></a><span class="in">for(SSP in SSPs)</span></span>
<span id="cb385-7401"><a href="#cb385-7401" aria-hidden="true" tabindex="-1"></a><span class="in">  for(Time in Times)</span></span>
<span id="cb385-7402"><a href="#cb385-7402" aria-hidden="true" tabindex="-1"></a><span class="in">    { # load future climate scenarios with designated file names</span></span>
<span id="cb385-7403"><a href="#cb385-7403" aria-hidden="true" tabindex="-1"></a><span class="in">    chill &lt;- load_temperature_scenarios(</span></span>
<span id="cb385-7404"><a href="#cb385-7404" aria-hidden="true" tabindex="-1"></a><span class="in">      "data/MS/MS_future_climate",</span></span>
<span id="cb385-7405"><a href="#cb385-7405" aria-hidden="true" tabindex="-1"></a><span class="in">      paste0("MS_multichill_305_59_",Time,"_",SSP))</span></span>
<span id="cb385-7406"><a href="#cb385-7406" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp126") SSPcaption &lt;- "SSP1"</span></span>
<span id="cb385-7407"><a href="#cb385-7407" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp245") SSPcaption &lt;- "SSP2"</span></span>
<span id="cb385-7408"><a href="#cb385-7408" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp370") SSPcaption &lt;- "SSP3"</span></span>
<span id="cb385-7409"><a href="#cb385-7409" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp585") SSPcaption &lt;- "SSP5"    </span></span>
<span id="cb385-7410"><a href="#cb385-7410" aria-hidden="true" tabindex="-1"></a><span class="in">    if(Time == "2050") Time_caption &lt;- "2050"</span></span>
<span id="cb385-7411"><a href="#cb385-7411" aria-hidden="true" tabindex="-1"></a><span class="in">    if(Time == "2085") Time_caption &lt;- "2085"</span></span>
<span id="cb385-7412"><a href="#cb385-7412" aria-hidden="true" tabindex="-1"></a><span class="in">    chills &lt;- make_climate_scenario(chill,</span></span>
<span id="cb385-7413"><a href="#cb385-7413" aria-hidden="true" tabindex="-1"></a><span class="in">                                    caption = c(SSPcaption,</span></span>
<span id="cb385-7414"><a href="#cb385-7414" aria-hidden="true" tabindex="-1"></a><span class="in">                                                Time_caption),</span></span>
<span id="cb385-7415"><a href="#cb385-7415" aria-hidden="true" tabindex="-1"></a><span class="in">                                    add_to = chills) </span></span>
<span id="cb385-7416"><a href="#cb385-7416" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-7417"><a href="#cb385-7417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7418"><a href="#cb385-7418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7419"><a href="#cb385-7419" aria-hidden="true" tabindex="-1"></a><span class="in"># Since all the chill models have different units, and numeric values differ </span></span>
<span id="cb385-7420"><a href="#cb385-7420" aria-hidden="true" tabindex="-1"></a><span class="in"># greatly across the models, we normalize all the results, expressing them as </span></span>
<span id="cb385-7421"><a href="#cb385-7421" aria-hidden="true" tabindex="-1"></a><span class="in"># changes relative to a 2005 baseline:</span></span>
<span id="cb385-7422"><a href="#cb385-7422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7423"><a href="#cb385-7423" aria-hidden="true" tabindex="-1"></a><span class="in">for(i in 1:length(chills))</span></span>
<span id="cb385-7424"><a href="#cb385-7424" aria-hidden="true" tabindex="-1"></a><span class="in">   {ch &lt;- chills[[i]]</span></span>
<span id="cb385-7425"><a href="#cb385-7425" aria-hidden="true" tabindex="-1"></a><span class="in">   if(ch$caption[1] == "Historical")</span></span>
<span id="cb385-7426"><a href="#cb385-7426" aria-hidden="true" tabindex="-1"></a><span class="in">     {GCMs &lt;- rep("none",length(names(ch$data)))</span></span>
<span id="cb385-7427"><a href="#cb385-7427" aria-hidden="true" tabindex="-1"></a><span class="in">      SSPs &lt;- rep("none",length(names(ch$data)))</span></span>
<span id="cb385-7428"><a href="#cb385-7428" aria-hidden="true" tabindex="-1"></a><span class="in">      Years &lt;- as.numeric(ch$labels)</span></span>
<span id="cb385-7429"><a href="#cb385-7429" aria-hidden="true" tabindex="-1"></a><span class="in">      Scenario &lt;- rep("Historical",</span></span>
<span id="cb385-7430"><a href="#cb385-7430" aria-hidden="true" tabindex="-1"></a><span class="in">                      length(names(ch$data)))} else</span></span>
<span id="cb385-7431"><a href="#cb385-7431" aria-hidden="true" tabindex="-1"></a><span class="in">                        {GCMs &lt;- names(ch$data)</span></span>
<span id="cb385-7432"><a href="#cb385-7432" aria-hidden="true" tabindex="-1"></a><span class="in">                        SSPs &lt;- rep(ch$caption[1],</span></span>
<span id="cb385-7433"><a href="#cb385-7433" aria-hidden="true" tabindex="-1"></a><span class="in">                                    length(names(ch$data)))</span></span>
<span id="cb385-7434"><a href="#cb385-7434" aria-hidden="true" tabindex="-1"></a><span class="in">                        Years &lt;- rep(as.numeric(ch$caption[2]),</span></span>
<span id="cb385-7435"><a href="#cb385-7435" aria-hidden="true" tabindex="-1"></a><span class="in">                                     length(names(ch$data)))</span></span>
<span id="cb385-7436"><a href="#cb385-7436" aria-hidden="true" tabindex="-1"></a><span class="in">                        Scenario &lt;- rep("Future",</span></span>
<span id="cb385-7437"><a href="#cb385-7437" aria-hidden="true" tabindex="-1"></a><span class="in">                                        length(names(ch$data)))}</span></span>
<span id="cb385-7438"><a href="#cb385-7438" aria-hidden="true" tabindex="-1"></a><span class="in">   for(nam in names(ch$data))</span></span>
<span id="cb385-7439"><a href="#cb385-7439" aria-hidden="true" tabindex="-1"></a><span class="in">     {for(met in metrics)</span></span>
<span id="cb385-7440"><a href="#cb385-7440" aria-hidden="true" tabindex="-1"></a><span class="in">       {temp_res &lt;-</span></span>
<span id="cb385-7441"><a href="#cb385-7441" aria-hidden="true" tabindex="-1"></a><span class="in">         data.frame(Metric = met,</span></span>
<span id="cb385-7442"><a href="#cb385-7442" aria-hidden="true" tabindex="-1"></a><span class="in">                    GCM = GCMs[which(nam == names(ch$data))],</span></span>
<span id="cb385-7443"><a href="#cb385-7443" aria-hidden="true" tabindex="-1"></a><span class="in">                    SSP = SSPs[which(nam == names(ch$data))],</span></span>
<span id="cb385-7444"><a href="#cb385-7444" aria-hidden="true" tabindex="-1"></a><span class="in">                    Year = Years[which(nam == names(ch$data))],</span></span>
<span id="cb385-7445"><a href="#cb385-7445" aria-hidden="true" tabindex="-1"></a><span class="in">                    Result = quantile(ch$data[[nam]][,met],0.1), </span></span>
<span id="cb385-7446"><a href="#cb385-7446" aria-hidden="true" tabindex="-1"></a><span class="in">                    Scenario = Scenario[which(nam == names(ch$data))])</span></span>
<span id="cb385-7447"><a href="#cb385-7447" aria-hidden="true" tabindex="-1"></a><span class="in">       if(i == 1 &amp; nam == names(ch$data)[1] &amp; met == metrics[1])</span></span>
<span id="cb385-7448"><a href="#cb385-7448" aria-hidden="true" tabindex="-1"></a><span class="in">         results &lt;- temp_res else</span></span>
<span id="cb385-7449"><a href="#cb385-7449" aria-hidden="true" tabindex="-1"></a><span class="in">           results &lt;- rbind(results,</span></span>
<span id="cb385-7450"><a href="#cb385-7450" aria-hidden="true" tabindex="-1"></a><span class="in">                            temp_res)</span></span>
<span id="cb385-7451"><a href="#cb385-7451" aria-hidden="true" tabindex="-1"></a><span class="in">         }</span></span>
<span id="cb385-7452"><a href="#cb385-7452" aria-hidden="true" tabindex="-1"></a><span class="in">     }</span></span>
<span id="cb385-7453"><a href="#cb385-7453" aria-hidden="true" tabindex="-1"></a><span class="in">   }</span></span>
<span id="cb385-7454"><a href="#cb385-7454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7455"><a href="#cb385-7455" aria-hidden="true" tabindex="-1"></a><span class="in"># Normalize the results by dividing with the 2000 baseline value</span></span>
<span id="cb385-7456"><a href="#cb385-7456" aria-hidden="true" tabindex="-1"></a><span class="in">for(met in metrics)</span></span>
<span id="cb385-7457"><a href="#cb385-7457" aria-hidden="true" tabindex="-1"></a><span class="in">  results[which(results$Metric == met),"SWC"] &lt;-</span></span>
<span id="cb385-7458"><a href="#cb385-7458" aria-hidden="true" tabindex="-1"></a><span class="in">    results[which(results$Metric == met),"Result"]/</span></span>
<span id="cb385-7459"><a href="#cb385-7459" aria-hidden="true" tabindex="-1"></a><span class="in">      results[which(results$Metric == met &amp; results$Year == 2000),</span></span>
<span id="cb385-7460"><a href="#cb385-7460" aria-hidden="true" tabindex="-1"></a><span class="in">              "Result"]-1 </span></span>
<span id="cb385-7461"><a href="#cb385-7461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7462"><a href="#cb385-7462" aria-hidden="true" tabindex="-1"></a><span class="in"># Get the minimum and maximum values using range function</span></span>
<span id="cb385-7463"><a href="#cb385-7463" aria-hidden="true" tabindex="-1"></a><span class="in">rng = range(results$SWC) </span></span>
<span id="cb385-7464"><a href="#cb385-7464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7465"><a href="#cb385-7465" aria-hidden="true" tabindex="-1"></a><span class="in">p_future &lt;- ggplot(results[which(!results$GCM == "none"),], # future ones</span></span>
<span id="cb385-7466"><a href="#cb385-7466" aria-hidden="true" tabindex="-1"></a><span class="in">                   aes(GCM,</span></span>
<span id="cb385-7467"><a href="#cb385-7467" aria-hidden="true" tabindex="-1"></a><span class="in">                       y = factor(Metric, # factor as categorical data </span></span>
<span id="cb385-7468"><a href="#cb385-7468" aria-hidden="true" tabindex="-1"></a><span class="in">                                  levels = metrics), # follow order in metrics</span></span>
<span id="cb385-7469"><a href="#cb385-7469" aria-hidden="true" tabindex="-1"></a><span class="in">                       fill = SWC)) +</span></span>
<span id="cb385-7470"><a href="#cb385-7470" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_tile() +</span></span>
<span id="cb385-7471"><a href="#cb385-7471" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(SSP ~ Year) +</span></span>
<span id="cb385-7472"><a href="#cb385-7472" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +</span></span>
<span id="cb385-7473"><a href="#cb385-7473" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text = element_text(size=6)) +</span></span>
<span id="cb385-7474"><a href="#cb385-7474" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_gradientn(colours = matlab.like(15),</span></span>
<span id="cb385-7475"><a href="#cb385-7475" aria-hidden="true" tabindex="-1"></a><span class="in">                       labels = scales::percent,</span></span>
<span id="cb385-7476"><a href="#cb385-7476" aria-hidden="true" tabindex="-1"></a><span class="in">                       limits = rng) +</span></span>
<span id="cb385-7477"><a href="#cb385-7477" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.x = element_text(angle = 75, </span></span>
<span id="cb385-7478"><a href="#cb385-7478" aria-hidden="true" tabindex="-1"></a><span class="in">                                   hjust = 1,</span></span>
<span id="cb385-7479"><a href="#cb385-7479" aria-hidden="true" tabindex="-1"></a><span class="in">                                   vjust = 1)) +</span></span>
<span id="cb385-7480"><a href="#cb385-7480" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(fill = "Change in\nSafe Winter Chill\nsince 2005") +</span></span>
<span id="cb385-7481"><a href="#cb385-7481" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_discrete(labels = model_labels) +</span></span>
<span id="cb385-7482"><a href="#cb385-7482" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Chill metric")</span></span>
<span id="cb385-7483"><a href="#cb385-7483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7484"><a href="#cb385-7484" aria-hidden="true" tabindex="-1"></a><span class="in">p_future</span></span>
<span id="cb385-7485"><a href="#cb385-7485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7486"><a href="#cb385-7486" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot for past scenarios</span></span>
<span id="cb385-7487"><a href="#cb385-7487" aria-hidden="true" tabindex="-1"></a><span class="in">p_past&lt;-</span></span>
<span id="cb385-7488"><a href="#cb385-7488" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(results[which(results$GCM == "none"),],</span></span>
<span id="cb385-7489"><a href="#cb385-7489" aria-hidden="true" tabindex="-1"></a><span class="in">         aes(Year,</span></span>
<span id="cb385-7490"><a href="#cb385-7490" aria-hidden="true" tabindex="-1"></a><span class="in">             y = factor(Metric, </span></span>
<span id="cb385-7491"><a href="#cb385-7491" aria-hidden="true" tabindex="-1"></a><span class="in">                        levels=metrics),</span></span>
<span id="cb385-7492"><a href="#cb385-7492" aria-hidden="true" tabindex="-1"></a><span class="in">             fill = SWC)) +</span></span>
<span id="cb385-7493"><a href="#cb385-7493" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_tile()</span></span>
<span id="cb385-7494"><a href="#cb385-7494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7495"><a href="#cb385-7495" aria-hidden="true" tabindex="-1"></a><span class="in">p_past&lt;-</span></span>
<span id="cb385-7496"><a href="#cb385-7496" aria-hidden="true" tabindex="-1"></a><span class="in">  p_past +</span></span>
<span id="cb385-7497"><a href="#cb385-7497" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +</span></span>
<span id="cb385-7498"><a href="#cb385-7498" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text = element_text(size = 6)) +</span></span>
<span id="cb385-7499"><a href="#cb385-7499" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_gradientn(colours = matlab.like(15),</span></span>
<span id="cb385-7500"><a href="#cb385-7500" aria-hidden="true" tabindex="-1"></a><span class="in">                       labels = scales::percent,</span></span>
<span id="cb385-7501"><a href="#cb385-7501" aria-hidden="true" tabindex="-1"></a><span class="in">                       limits = rng) +</span></span>
<span id="cb385-7502"><a href="#cb385-7502" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(position = "top") +</span></span>
<span id="cb385-7503"><a href="#cb385-7503" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(fill = "Change in\nSafe Winter Chill\nsince 2000") +</span></span>
<span id="cb385-7504"><a href="#cb385-7504" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_discrete(labels = model_labels) +</span></span>
<span id="cb385-7505"><a href="#cb385-7505" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Chill metric")</span></span>
<span id="cb385-7506"><a href="#cb385-7506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7507"><a href="#cb385-7507" aria-hidden="true" tabindex="-1"></a><span class="in">p_past</span></span>
<span id="cb385-7508"><a href="#cb385-7508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7509"><a href="#cb385-7509" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-7510"><a href="#cb385-7510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7511"><a href="#cb385-7511" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 19.4.1b, echo=FALSE}</span></span>
<span id="cb385-7512"><a href="#cb385-7512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7513"><a href="#cb385-7513" aria-hidden="true" tabindex="-1"></a><span class="in">chill_past_scenarios &lt;- load_temperature_scenarios(</span></span>
<span id="cb385-7514"><a href="#cb385-7514" aria-hidden="true" tabindex="-1"></a><span class="in">  "data/MS/MS_future_climate",</span></span>
<span id="cb385-7515"><a href="#cb385-7515" aria-hidden="true" tabindex="-1"></a><span class="in">  "MS_multichill_305_59_historic")</span></span>
<span id="cb385-7516"><a href="#cb385-7516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7517"><a href="#cb385-7517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7518"><a href="#cb385-7518" aria-hidden="true" tabindex="-1"></a><span class="in">chill_observed &lt;- read_tab(</span></span>
<span id="cb385-7519"><a href="#cb385-7519" aria-hidden="true" tabindex="-1"></a><span class="in">  "data/MS/MS_future_climate/MS_multichill_305_59_observed.csv")</span></span>
<span id="cb385-7520"><a href="#cb385-7520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7521"><a href="#cb385-7521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7522"><a href="#cb385-7522" aria-hidden="true" tabindex="-1"></a><span class="in"># Make climate scenarios for plotting from a list of climate metric data </span></span>
<span id="cb385-7523"><a href="#cb385-7523" aria-hidden="true" tabindex="-1"></a><span class="in"># produced by tempResponse_daily_list, for example</span></span>
<span id="cb385-7524"><a href="#cb385-7524" aria-hidden="true" tabindex="-1"></a><span class="in">chills &lt;- make_climate_scenario(chill_past_scenarios,</span></span>
<span id="cb385-7525"><a href="#cb385-7525" aria-hidden="true" tabindex="-1"></a><span class="in">                                caption = "Historical",</span></span>
<span id="cb385-7526"><a href="#cb385-7526" aria-hidden="true" tabindex="-1"></a><span class="in">                                historic_data = chill_observed,</span></span>
<span id="cb385-7527"><a href="#cb385-7527" aria-hidden="true" tabindex="-1"></a><span class="in">                                time_series = TRUE)</span></span>
<span id="cb385-7528"><a href="#cb385-7528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7529"><a href="#cb385-7529" aria-hidden="true" tabindex="-1"></a><span class="in"># Add this again to knit better</span></span>
<span id="cb385-7530"><a href="#cb385-7530" aria-hidden="true" tabindex="-1"></a><span class="in">SSPs &lt;- c("ssp126", "ssp245","ssp370", "ssp585")</span></span>
<span id="cb385-7531"><a href="#cb385-7531" aria-hidden="true" tabindex="-1"></a><span class="in">Times &lt;- c(2050, 2085)</span></span>
<span id="cb385-7532"><a href="#cb385-7532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7533"><a href="#cb385-7533" aria-hidden="true" tabindex="-1"></a><span class="in"># Create loops for future scenarios</span></span>
<span id="cb385-7534"><a href="#cb385-7534" aria-hidden="true" tabindex="-1"></a><span class="in">for(SSP in SSPs)</span></span>
<span id="cb385-7535"><a href="#cb385-7535" aria-hidden="true" tabindex="-1"></a><span class="in">  for(Time in Times)</span></span>
<span id="cb385-7536"><a href="#cb385-7536" aria-hidden="true" tabindex="-1"></a><span class="in">    { # load future climate scenarios with designated file names</span></span>
<span id="cb385-7537"><a href="#cb385-7537" aria-hidden="true" tabindex="-1"></a><span class="in">    chill &lt;- load_temperature_scenarios(</span></span>
<span id="cb385-7538"><a href="#cb385-7538" aria-hidden="true" tabindex="-1"></a><span class="in">      "data/MS/MS_future_climate",</span></span>
<span id="cb385-7539"><a href="#cb385-7539" aria-hidden="true" tabindex="-1"></a><span class="in">      paste0("MS_multichill_305_59_",Time,"_",SSP))</span></span>
<span id="cb385-7540"><a href="#cb385-7540" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp126") SSPcaption &lt;- "SSP1"</span></span>
<span id="cb385-7541"><a href="#cb385-7541" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp245") SSPcaption &lt;- "SSP2"</span></span>
<span id="cb385-7542"><a href="#cb385-7542" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp370") SSPcaption &lt;- "SSP3"</span></span>
<span id="cb385-7543"><a href="#cb385-7543" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp585") SSPcaption &lt;- "SSP5"    </span></span>
<span id="cb385-7544"><a href="#cb385-7544" aria-hidden="true" tabindex="-1"></a><span class="in">    if(Time == "2050") Time_caption &lt;- "2050"</span></span>
<span id="cb385-7545"><a href="#cb385-7545" aria-hidden="true" tabindex="-1"></a><span class="in">    if(Time == "2085") Time_caption &lt;- "2085"</span></span>
<span id="cb385-7546"><a href="#cb385-7546" aria-hidden="true" tabindex="-1"></a><span class="in">    chills &lt;- make_climate_scenario(chill,</span></span>
<span id="cb385-7547"><a href="#cb385-7547" aria-hidden="true" tabindex="-1"></a><span class="in">                                    caption = c(SSPcaption,</span></span>
<span id="cb385-7548"><a href="#cb385-7548" aria-hidden="true" tabindex="-1"></a><span class="in">                                                Time_caption),</span></span>
<span id="cb385-7549"><a href="#cb385-7549" aria-hidden="true" tabindex="-1"></a><span class="in">                                    add_to = chills) </span></span>
<span id="cb385-7550"><a href="#cb385-7550" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-7551"><a href="#cb385-7551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7552"><a href="#cb385-7552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7553"><a href="#cb385-7553" aria-hidden="true" tabindex="-1"></a><span class="in"># Since all the chill models have different units, and numeric values differ </span></span>
<span id="cb385-7554"><a href="#cb385-7554" aria-hidden="true" tabindex="-1"></a><span class="in"># greatly across the models, we normalize all the results, expressing them as </span></span>
<span id="cb385-7555"><a href="#cb385-7555" aria-hidden="true" tabindex="-1"></a><span class="in"># changes relative to a 2005 baseline:</span></span>
<span id="cb385-7556"><a href="#cb385-7556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7557"><a href="#cb385-7557" aria-hidden="true" tabindex="-1"></a><span class="in">for(i in 1:length(chills))</span></span>
<span id="cb385-7558"><a href="#cb385-7558" aria-hidden="true" tabindex="-1"></a><span class="in">   {ch &lt;- chills[[i]]</span></span>
<span id="cb385-7559"><a href="#cb385-7559" aria-hidden="true" tabindex="-1"></a><span class="in">   if(ch$caption[1] == "Historical")</span></span>
<span id="cb385-7560"><a href="#cb385-7560" aria-hidden="true" tabindex="-1"></a><span class="in">     {GCMs &lt;- rep("none",length(names(ch$data)))</span></span>
<span id="cb385-7561"><a href="#cb385-7561" aria-hidden="true" tabindex="-1"></a><span class="in">      SSPs &lt;- rep("none",length(names(ch$data)))</span></span>
<span id="cb385-7562"><a href="#cb385-7562" aria-hidden="true" tabindex="-1"></a><span class="in">      Years &lt;- as.numeric(ch$labels)</span></span>
<span id="cb385-7563"><a href="#cb385-7563" aria-hidden="true" tabindex="-1"></a><span class="in">      Scenario &lt;- rep("Historical",</span></span>
<span id="cb385-7564"><a href="#cb385-7564" aria-hidden="true" tabindex="-1"></a><span class="in">                      length(names(ch$data)))} else</span></span>
<span id="cb385-7565"><a href="#cb385-7565" aria-hidden="true" tabindex="-1"></a><span class="in">                        {GCMs &lt;- names(ch$data)</span></span>
<span id="cb385-7566"><a href="#cb385-7566" aria-hidden="true" tabindex="-1"></a><span class="in">                        SSPs &lt;- rep(ch$caption[1],</span></span>
<span id="cb385-7567"><a href="#cb385-7567" aria-hidden="true" tabindex="-1"></a><span class="in">                                    length(names(ch$data)))</span></span>
<span id="cb385-7568"><a href="#cb385-7568" aria-hidden="true" tabindex="-1"></a><span class="in">                        Years &lt;- rep(as.numeric(ch$caption[2]),</span></span>
<span id="cb385-7569"><a href="#cb385-7569" aria-hidden="true" tabindex="-1"></a><span class="in">                                     length(names(ch$data)))</span></span>
<span id="cb385-7570"><a href="#cb385-7570" aria-hidden="true" tabindex="-1"></a><span class="in">                        Scenario &lt;- rep("Future",</span></span>
<span id="cb385-7571"><a href="#cb385-7571" aria-hidden="true" tabindex="-1"></a><span class="in">                                        length(names(ch$data)))}</span></span>
<span id="cb385-7572"><a href="#cb385-7572" aria-hidden="true" tabindex="-1"></a><span class="in">   for(nam in names(ch$data))</span></span>
<span id="cb385-7573"><a href="#cb385-7573" aria-hidden="true" tabindex="-1"></a><span class="in">     {for(met in metrics)</span></span>
<span id="cb385-7574"><a href="#cb385-7574" aria-hidden="true" tabindex="-1"></a><span class="in">       {temp_res &lt;-</span></span>
<span id="cb385-7575"><a href="#cb385-7575" aria-hidden="true" tabindex="-1"></a><span class="in">         data.frame(Metric = met,</span></span>
<span id="cb385-7576"><a href="#cb385-7576" aria-hidden="true" tabindex="-1"></a><span class="in">                    GCM = GCMs[which(nam == names(ch$data))],</span></span>
<span id="cb385-7577"><a href="#cb385-7577" aria-hidden="true" tabindex="-1"></a><span class="in">                    SSP = SSPs[which(nam == names(ch$data))],</span></span>
<span id="cb385-7578"><a href="#cb385-7578" aria-hidden="true" tabindex="-1"></a><span class="in">                    Year = Years[which(nam == names(ch$data))],</span></span>
<span id="cb385-7579"><a href="#cb385-7579" aria-hidden="true" tabindex="-1"></a><span class="in">                    Result = quantile(ch$data[[nam]][,met],0.1), </span></span>
<span id="cb385-7580"><a href="#cb385-7580" aria-hidden="true" tabindex="-1"></a><span class="in">                    Scenario = Scenario[which(nam == names(ch$data))])</span></span>
<span id="cb385-7581"><a href="#cb385-7581" aria-hidden="true" tabindex="-1"></a><span class="in">       if(i == 1 &amp; nam == names(ch$data)[1] &amp; met == metrics[1])</span></span>
<span id="cb385-7582"><a href="#cb385-7582" aria-hidden="true" tabindex="-1"></a><span class="in">         results &lt;- temp_res else</span></span>
<span id="cb385-7583"><a href="#cb385-7583" aria-hidden="true" tabindex="-1"></a><span class="in">           results &lt;- rbind(results,</span></span>
<span id="cb385-7584"><a href="#cb385-7584" aria-hidden="true" tabindex="-1"></a><span class="in">                            temp_res)</span></span>
<span id="cb385-7585"><a href="#cb385-7585" aria-hidden="true" tabindex="-1"></a><span class="in">         }</span></span>
<span id="cb385-7586"><a href="#cb385-7586" aria-hidden="true" tabindex="-1"></a><span class="in">     }</span></span>
<span id="cb385-7587"><a href="#cb385-7587" aria-hidden="true" tabindex="-1"></a><span class="in">   }</span></span>
<span id="cb385-7588"><a href="#cb385-7588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7589"><a href="#cb385-7589" aria-hidden="true" tabindex="-1"></a><span class="in"># Normalize the results by dividing with the 2000 baseline value</span></span>
<span id="cb385-7590"><a href="#cb385-7590" aria-hidden="true" tabindex="-1"></a><span class="in"># I couldn't use 2005 coz (I think) historical data for 2005 is not saved as csv?</span></span>
<span id="cb385-7591"><a href="#cb385-7591" aria-hidden="true" tabindex="-1"></a><span class="in">for(met in metrics)</span></span>
<span id="cb385-7592"><a href="#cb385-7592" aria-hidden="true" tabindex="-1"></a><span class="in">  results[which(results$Metric == met),"SWC"] &lt;-</span></span>
<span id="cb385-7593"><a href="#cb385-7593" aria-hidden="true" tabindex="-1"></a><span class="in">    results[which(results$Metric == met),"Result"]/</span></span>
<span id="cb385-7594"><a href="#cb385-7594" aria-hidden="true" tabindex="-1"></a><span class="in">      results[which(results$Metric == met &amp; results$Year == 2000),</span></span>
<span id="cb385-7595"><a href="#cb385-7595" aria-hidden="true" tabindex="-1"></a><span class="in">              "Result"]-1 </span></span>
<span id="cb385-7596"><a href="#cb385-7596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7597"><a href="#cb385-7597" aria-hidden="true" tabindex="-1"></a><span class="in"># Get the minimum and maximum values using range function</span></span>
<span id="cb385-7598"><a href="#cb385-7598" aria-hidden="true" tabindex="-1"></a><span class="in">rng = range(results$SWC) </span></span>
<span id="cb385-7599"><a href="#cb385-7599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7600"><a href="#cb385-7600" aria-hidden="true" tabindex="-1"></a><span class="in">p_future &lt;- ggplot(results[which(!results$GCM == "none"),], # future ones</span></span>
<span id="cb385-7601"><a href="#cb385-7601" aria-hidden="true" tabindex="-1"></a><span class="in">                   aes(GCM,</span></span>
<span id="cb385-7602"><a href="#cb385-7602" aria-hidden="true" tabindex="-1"></a><span class="in">                       y = factor(Metric, # factor as categorical data </span></span>
<span id="cb385-7603"><a href="#cb385-7603" aria-hidden="true" tabindex="-1"></a><span class="in">                                  levels = metrics), # follow order in metrics</span></span>
<span id="cb385-7604"><a href="#cb385-7604" aria-hidden="true" tabindex="-1"></a><span class="in">                       fill = SWC)) +</span></span>
<span id="cb385-7605"><a href="#cb385-7605" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_tile() +</span></span>
<span id="cb385-7606"><a href="#cb385-7606" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(SSP ~ Year) +</span></span>
<span id="cb385-7607"><a href="#cb385-7607" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +</span></span>
<span id="cb385-7608"><a href="#cb385-7608" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text = element_text(size=6)) +</span></span>
<span id="cb385-7609"><a href="#cb385-7609" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_gradientn(colours = matlab.like(15),</span></span>
<span id="cb385-7610"><a href="#cb385-7610" aria-hidden="true" tabindex="-1"></a><span class="in">                       labels = scales::percent,</span></span>
<span id="cb385-7611"><a href="#cb385-7611" aria-hidden="true" tabindex="-1"></a><span class="in">                       limits = rng) +</span></span>
<span id="cb385-7612"><a href="#cb385-7612" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.x = element_text(angle = 75, </span></span>
<span id="cb385-7613"><a href="#cb385-7613" aria-hidden="true" tabindex="-1"></a><span class="in">                                   hjust = 1,</span></span>
<span id="cb385-7614"><a href="#cb385-7614" aria-hidden="true" tabindex="-1"></a><span class="in">                                   vjust = 1)) +</span></span>
<span id="cb385-7615"><a href="#cb385-7615" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(fill = "Change in\nSafe Winter Chill\nsince 2000") +</span></span>
<span id="cb385-7616"><a href="#cb385-7616" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_discrete(labels = model_labels) +</span></span>
<span id="cb385-7617"><a href="#cb385-7617" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Chill metric")</span></span>
<span id="cb385-7618"><a href="#cb385-7618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7619"><a href="#cb385-7619" aria-hidden="true" tabindex="-1"></a><span class="in">p_future</span></span>
<span id="cb385-7620"><a href="#cb385-7620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7621"><a href="#cb385-7621" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot for past scenarios</span></span>
<span id="cb385-7622"><a href="#cb385-7622" aria-hidden="true" tabindex="-1"></a><span class="in">p_past&lt;-</span></span>
<span id="cb385-7623"><a href="#cb385-7623" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(results[which(results$GCM == "none"),],</span></span>
<span id="cb385-7624"><a href="#cb385-7624" aria-hidden="true" tabindex="-1"></a><span class="in">         aes(Year,</span></span>
<span id="cb385-7625"><a href="#cb385-7625" aria-hidden="true" tabindex="-1"></a><span class="in">             y = factor(Metric, </span></span>
<span id="cb385-7626"><a href="#cb385-7626" aria-hidden="true" tabindex="-1"></a><span class="in">                        levels=metrics),</span></span>
<span id="cb385-7627"><a href="#cb385-7627" aria-hidden="true" tabindex="-1"></a><span class="in">             fill = SWC)) +</span></span>
<span id="cb385-7628"><a href="#cb385-7628" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_tile()</span></span>
<span id="cb385-7629"><a href="#cb385-7629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7630"><a href="#cb385-7630" aria-hidden="true" tabindex="-1"></a><span class="in">p_past&lt;-</span></span>
<span id="cb385-7631"><a href="#cb385-7631" aria-hidden="true" tabindex="-1"></a><span class="in">  p_past +</span></span>
<span id="cb385-7632"><a href="#cb385-7632" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +</span></span>
<span id="cb385-7633"><a href="#cb385-7633" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text = element_text(size = 6)) +</span></span>
<span id="cb385-7634"><a href="#cb385-7634" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_gradientn(colours = matlab.like(15),</span></span>
<span id="cb385-7635"><a href="#cb385-7635" aria-hidden="true" tabindex="-1"></a><span class="in">                       labels = scales::percent,</span></span>
<span id="cb385-7636"><a href="#cb385-7636" aria-hidden="true" tabindex="-1"></a><span class="in">                       limits = rng) +</span></span>
<span id="cb385-7637"><a href="#cb385-7637" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(position = "top") +</span></span>
<span id="cb385-7638"><a href="#cb385-7638" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(fill = "Change in\nSafe Winter Chill\nsince 2000") +</span></span>
<span id="cb385-7639"><a href="#cb385-7639" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_discrete(labels = model_labels) +</span></span>
<span id="cb385-7640"><a href="#cb385-7640" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Chill metric")</span></span>
<span id="cb385-7641"><a href="#cb385-7641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7642"><a href="#cb385-7642" aria-hidden="true" tabindex="-1"></a><span class="in">p_past</span></span>
<span id="cb385-7643"><a href="#cb385-7643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7644"><a href="#cb385-7644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7645"><a href="#cb385-7645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7646"><a href="#cb385-7646" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-7647"><a href="#cb385-7647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7648"><a href="#cb385-7648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7649"><a href="#cb385-7649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7650"><a href="#cb385-7650" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-7651"><a href="#cb385-7651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7652"><a href="#cb385-7652" aria-hidden="true" tabindex="-1"></a>***2. Make a heat map illustrating past and future changes in Safe Winter Chill, relative to a past scenario, for the 13 chill models used here.***</span>
<span id="cb385-7653"><a href="#cb385-7653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7654"><a href="#cb385-7654" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 19.4.2, out.width="100%", out.height="100%"}</span></span>
<span id="cb385-7655"><a href="#cb385-7655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7656"><a href="#cb385-7656" aria-hidden="true" tabindex="-1"></a><span class="in">chill_past_scenarios &lt;- load_temperature_scenarios(</span></span>
<span id="cb385-7657"><a href="#cb385-7657" aria-hidden="true" tabindex="-1"></a><span class="in">  "data/MS/MS_future_climate",</span></span>
<span id="cb385-7658"><a href="#cb385-7658" aria-hidden="true" tabindex="-1"></a><span class="in">  "MS_multichill_305_59_historic")</span></span>
<span id="cb385-7659"><a href="#cb385-7659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7660"><a href="#cb385-7660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7661"><a href="#cb385-7661" aria-hidden="true" tabindex="-1"></a><span class="in">chill_observed &lt;- read_tab(</span></span>
<span id="cb385-7662"><a href="#cb385-7662" aria-hidden="true" tabindex="-1"></a><span class="in">  "data/MS/MS_future_climate/MS_multichill_305_59_observed.csv")</span></span>
<span id="cb385-7663"><a href="#cb385-7663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7664"><a href="#cb385-7664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7665"><a href="#cb385-7665" aria-hidden="true" tabindex="-1"></a><span class="in"># Make climate scenarios for plotting from a list of climate metric data </span></span>
<span id="cb385-7666"><a href="#cb385-7666" aria-hidden="true" tabindex="-1"></a><span class="in"># produced by tempResponse_daily_list, for example</span></span>
<span id="cb385-7667"><a href="#cb385-7667" aria-hidden="true" tabindex="-1"></a><span class="in">chills &lt;- make_climate_scenario(chill_past_scenarios,</span></span>
<span id="cb385-7668"><a href="#cb385-7668" aria-hidden="true" tabindex="-1"></a><span class="in">                                caption = "Historical",</span></span>
<span id="cb385-7669"><a href="#cb385-7669" aria-hidden="true" tabindex="-1"></a><span class="in">                                historic_data = chill_observed,</span></span>
<span id="cb385-7670"><a href="#cb385-7670" aria-hidden="true" tabindex="-1"></a><span class="in">                                time_series = TRUE)</span></span>
<span id="cb385-7671"><a href="#cb385-7671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7672"><a href="#cb385-7672" aria-hidden="true" tabindex="-1"></a><span class="in"># Add this again to knit better</span></span>
<span id="cb385-7673"><a href="#cb385-7673" aria-hidden="true" tabindex="-1"></a><span class="in">SSPs &lt;- c("ssp126", "ssp245","ssp370", "ssp585")</span></span>
<span id="cb385-7674"><a href="#cb385-7674" aria-hidden="true" tabindex="-1"></a><span class="in">Times &lt;- c(2050, 2085)</span></span>
<span id="cb385-7675"><a href="#cb385-7675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7676"><a href="#cb385-7676" aria-hidden="true" tabindex="-1"></a><span class="in"># Create loops for future scenarios</span></span>
<span id="cb385-7677"><a href="#cb385-7677" aria-hidden="true" tabindex="-1"></a><span class="in">for(SSP in SSPs)</span></span>
<span id="cb385-7678"><a href="#cb385-7678" aria-hidden="true" tabindex="-1"></a><span class="in">  for(Time in Times)</span></span>
<span id="cb385-7679"><a href="#cb385-7679" aria-hidden="true" tabindex="-1"></a><span class="in">    { # load future climate scenarios with designated file names</span></span>
<span id="cb385-7680"><a href="#cb385-7680" aria-hidden="true" tabindex="-1"></a><span class="in">    chill &lt;- load_temperature_scenarios(</span></span>
<span id="cb385-7681"><a href="#cb385-7681" aria-hidden="true" tabindex="-1"></a><span class="in">      "data/MS/MS_future_climate",</span></span>
<span id="cb385-7682"><a href="#cb385-7682" aria-hidden="true" tabindex="-1"></a><span class="in">      paste0("MS_multichill_305_59_",Time,"_",SSP))</span></span>
<span id="cb385-7683"><a href="#cb385-7683" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp126") SSPcaption &lt;- "SSP1"</span></span>
<span id="cb385-7684"><a href="#cb385-7684" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp245") SSPcaption &lt;- "SSP2"</span></span>
<span id="cb385-7685"><a href="#cb385-7685" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp370") SSPcaption &lt;- "SSP3"</span></span>
<span id="cb385-7686"><a href="#cb385-7686" aria-hidden="true" tabindex="-1"></a><span class="in">    if(SSP == "ssp585") SSPcaption &lt;- "SSP5"    </span></span>
<span id="cb385-7687"><a href="#cb385-7687" aria-hidden="true" tabindex="-1"></a><span class="in">    if(Time == "2050") Time_caption &lt;- "2050"</span></span>
<span id="cb385-7688"><a href="#cb385-7688" aria-hidden="true" tabindex="-1"></a><span class="in">    if(Time == "2085") Time_caption &lt;- "2085"</span></span>
<span id="cb385-7689"><a href="#cb385-7689" aria-hidden="true" tabindex="-1"></a><span class="in">    chills &lt;- make_climate_scenario(chill,</span></span>
<span id="cb385-7690"><a href="#cb385-7690" aria-hidden="true" tabindex="-1"></a><span class="in">                                    caption = c(SSPcaption,</span></span>
<span id="cb385-7691"><a href="#cb385-7691" aria-hidden="true" tabindex="-1"></a><span class="in">                                                Time_caption),</span></span>
<span id="cb385-7692"><a href="#cb385-7692" aria-hidden="true" tabindex="-1"></a><span class="in">                                    add_to = chills) </span></span>
<span id="cb385-7693"><a href="#cb385-7693" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-7694"><a href="#cb385-7694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7695"><a href="#cb385-7695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7696"><a href="#cb385-7696" aria-hidden="true" tabindex="-1"></a><span class="in"># Since all the chill models have different units, and numeric values differ </span></span>
<span id="cb385-7697"><a href="#cb385-7697" aria-hidden="true" tabindex="-1"></a><span class="in"># greatly across the models, we normalize all the results, expressing them as </span></span>
<span id="cb385-7698"><a href="#cb385-7698" aria-hidden="true" tabindex="-1"></a><span class="in"># changes relative to a 2005 baseline:</span></span>
<span id="cb385-7699"><a href="#cb385-7699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7700"><a href="#cb385-7700" aria-hidden="true" tabindex="-1"></a><span class="in">for(i in 1:length(chills))</span></span>
<span id="cb385-7701"><a href="#cb385-7701" aria-hidden="true" tabindex="-1"></a><span class="in">   {ch &lt;- chills[[i]]</span></span>
<span id="cb385-7702"><a href="#cb385-7702" aria-hidden="true" tabindex="-1"></a><span class="in">   if(ch$caption[1] == "Historical")</span></span>
<span id="cb385-7703"><a href="#cb385-7703" aria-hidden="true" tabindex="-1"></a><span class="in">     {GCMs &lt;- rep("none",length(names(ch$data)))</span></span>
<span id="cb385-7704"><a href="#cb385-7704" aria-hidden="true" tabindex="-1"></a><span class="in">      SSPs &lt;- rep("none",length(names(ch$data)))</span></span>
<span id="cb385-7705"><a href="#cb385-7705" aria-hidden="true" tabindex="-1"></a><span class="in">      Years &lt;- as.numeric(ch$labels)</span></span>
<span id="cb385-7706"><a href="#cb385-7706" aria-hidden="true" tabindex="-1"></a><span class="in">      Scenario &lt;- rep("Historical",</span></span>
<span id="cb385-7707"><a href="#cb385-7707" aria-hidden="true" tabindex="-1"></a><span class="in">                      length(names(ch$data)))} else</span></span>
<span id="cb385-7708"><a href="#cb385-7708" aria-hidden="true" tabindex="-1"></a><span class="in">                        {GCMs &lt;- names(ch$data)</span></span>
<span id="cb385-7709"><a href="#cb385-7709" aria-hidden="true" tabindex="-1"></a><span class="in">                        SSPs &lt;- rep(ch$caption[1],</span></span>
<span id="cb385-7710"><a href="#cb385-7710" aria-hidden="true" tabindex="-1"></a><span class="in">                                    length(names(ch$data)))</span></span>
<span id="cb385-7711"><a href="#cb385-7711" aria-hidden="true" tabindex="-1"></a><span class="in">                        Years &lt;- rep(as.numeric(ch$caption[2]),</span></span>
<span id="cb385-7712"><a href="#cb385-7712" aria-hidden="true" tabindex="-1"></a><span class="in">                                     length(names(ch$data)))</span></span>
<span id="cb385-7713"><a href="#cb385-7713" aria-hidden="true" tabindex="-1"></a><span class="in">                        Scenario &lt;- rep("Future",</span></span>
<span id="cb385-7714"><a href="#cb385-7714" aria-hidden="true" tabindex="-1"></a><span class="in">                                        length(names(ch$data)))}</span></span>
<span id="cb385-7715"><a href="#cb385-7715" aria-hidden="true" tabindex="-1"></a><span class="in">   for(nam in names(ch$data))</span></span>
<span id="cb385-7716"><a href="#cb385-7716" aria-hidden="true" tabindex="-1"></a><span class="in">     {for(met in metrics)</span></span>
<span id="cb385-7717"><a href="#cb385-7717" aria-hidden="true" tabindex="-1"></a><span class="in">       {temp_res &lt;-</span></span>
<span id="cb385-7718"><a href="#cb385-7718" aria-hidden="true" tabindex="-1"></a><span class="in">         data.frame(Metric = met,</span></span>
<span id="cb385-7719"><a href="#cb385-7719" aria-hidden="true" tabindex="-1"></a><span class="in">                    GCM = GCMs[which(nam == names(ch$data))],</span></span>
<span id="cb385-7720"><a href="#cb385-7720" aria-hidden="true" tabindex="-1"></a><span class="in">                    SSP = SSPs[which(nam == names(ch$data))],</span></span>
<span id="cb385-7721"><a href="#cb385-7721" aria-hidden="true" tabindex="-1"></a><span class="in">                    Year = Years[which(nam == names(ch$data))],</span></span>
<span id="cb385-7722"><a href="#cb385-7722" aria-hidden="true" tabindex="-1"></a><span class="in">                    Result = quantile(ch$data[[nam]][,met],0.1), </span></span>
<span id="cb385-7723"><a href="#cb385-7723" aria-hidden="true" tabindex="-1"></a><span class="in">                    Scenario = Scenario[which(nam == names(ch$data))])</span></span>
<span id="cb385-7724"><a href="#cb385-7724" aria-hidden="true" tabindex="-1"></a><span class="in">       if(i == 1 &amp; nam == names(ch$data)[1] &amp; met == metrics[1])</span></span>
<span id="cb385-7725"><a href="#cb385-7725" aria-hidden="true" tabindex="-1"></a><span class="in">         results &lt;- temp_res else</span></span>
<span id="cb385-7726"><a href="#cb385-7726" aria-hidden="true" tabindex="-1"></a><span class="in">           results &lt;- rbind(results,</span></span>
<span id="cb385-7727"><a href="#cb385-7727" aria-hidden="true" tabindex="-1"></a><span class="in">                            temp_res)</span></span>
<span id="cb385-7728"><a href="#cb385-7728" aria-hidden="true" tabindex="-1"></a><span class="in">         }</span></span>
<span id="cb385-7729"><a href="#cb385-7729" aria-hidden="true" tabindex="-1"></a><span class="in">     }</span></span>
<span id="cb385-7730"><a href="#cb385-7730" aria-hidden="true" tabindex="-1"></a><span class="in">   }</span></span>
<span id="cb385-7731"><a href="#cb385-7731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7732"><a href="#cb385-7732" aria-hidden="true" tabindex="-1"></a><span class="in"># Normalize the results by dividing with the 2000 baseline value</span></span>
<span id="cb385-7733"><a href="#cb385-7733" aria-hidden="true" tabindex="-1"></a><span class="in"># I couldn't use 2005 coz (I think) historical data for 2005 is not saved as csv?</span></span>
<span id="cb385-7734"><a href="#cb385-7734" aria-hidden="true" tabindex="-1"></a><span class="in">for(met in metrics)</span></span>
<span id="cb385-7735"><a href="#cb385-7735" aria-hidden="true" tabindex="-1"></a><span class="in">  results[which(results$Metric == met),"SWC"] &lt;-</span></span>
<span id="cb385-7736"><a href="#cb385-7736" aria-hidden="true" tabindex="-1"></a><span class="in">    results[which(results$Metric == met),"Result"]/</span></span>
<span id="cb385-7737"><a href="#cb385-7737" aria-hidden="true" tabindex="-1"></a><span class="in">      results[which(results$Metric == met &amp; results$Year == 2000),</span></span>
<span id="cb385-7738"><a href="#cb385-7738" aria-hidden="true" tabindex="-1"></a><span class="in">              "Result"]-1 </span></span>
<span id="cb385-7739"><a href="#cb385-7739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7740"><a href="#cb385-7740" aria-hidden="true" tabindex="-1"></a><span class="in"># Get the minimum and maximum values using range function</span></span>
<span id="cb385-7741"><a href="#cb385-7741" aria-hidden="true" tabindex="-1"></a><span class="in">rng = range(results$SWC) </span></span>
<span id="cb385-7742"><a href="#cb385-7742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7743"><a href="#cb385-7743" aria-hidden="true" tabindex="-1"></a><span class="in">p_future &lt;- ggplot(results[which(!results$GCM == "none"),], # future ones</span></span>
<span id="cb385-7744"><a href="#cb385-7744" aria-hidden="true" tabindex="-1"></a><span class="in">                   aes(GCM,</span></span>
<span id="cb385-7745"><a href="#cb385-7745" aria-hidden="true" tabindex="-1"></a><span class="in">                       y = factor(Metric, # factor as categorical data </span></span>
<span id="cb385-7746"><a href="#cb385-7746" aria-hidden="true" tabindex="-1"></a><span class="in">                                  levels = metrics), # follow order in metrics</span></span>
<span id="cb385-7747"><a href="#cb385-7747" aria-hidden="true" tabindex="-1"></a><span class="in">                       fill = SWC)) +</span></span>
<span id="cb385-7748"><a href="#cb385-7748" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_tile() +</span></span>
<span id="cb385-7749"><a href="#cb385-7749" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(SSP ~ Year) +</span></span>
<span id="cb385-7750"><a href="#cb385-7750" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +</span></span>
<span id="cb385-7751"><a href="#cb385-7751" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text = element_text(size=6)) +</span></span>
<span id="cb385-7752"><a href="#cb385-7752" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_gradientn(colours = matlab.like(15),</span></span>
<span id="cb385-7753"><a href="#cb385-7753" aria-hidden="true" tabindex="-1"></a><span class="in">                       labels = scales::percent,</span></span>
<span id="cb385-7754"><a href="#cb385-7754" aria-hidden="true" tabindex="-1"></a><span class="in">                       limits = rng) +</span></span>
<span id="cb385-7755"><a href="#cb385-7755" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.x = element_text(angle = 75, </span></span>
<span id="cb385-7756"><a href="#cb385-7756" aria-hidden="true" tabindex="-1"></a><span class="in">                                   hjust = 1,</span></span>
<span id="cb385-7757"><a href="#cb385-7757" aria-hidden="true" tabindex="-1"></a><span class="in">                                   vjust = 1)) +</span></span>
<span id="cb385-7758"><a href="#cb385-7758" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(fill = "Change in\nSafe Winter Chill\nsince 2000") +</span></span>
<span id="cb385-7759"><a href="#cb385-7759" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_discrete(labels = model_labels) +</span></span>
<span id="cb385-7760"><a href="#cb385-7760" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Chill metric")</span></span>
<span id="cb385-7761"><a href="#cb385-7761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7762"><a href="#cb385-7762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7763"><a href="#cb385-7763" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot for past scenarios</span></span>
<span id="cb385-7764"><a href="#cb385-7764" aria-hidden="true" tabindex="-1"></a><span class="in">p_past&lt;-</span></span>
<span id="cb385-7765"><a href="#cb385-7765" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(results[which(results$GCM == "none"),],</span></span>
<span id="cb385-7766"><a href="#cb385-7766" aria-hidden="true" tabindex="-1"></a><span class="in">         aes(Year,</span></span>
<span id="cb385-7767"><a href="#cb385-7767" aria-hidden="true" tabindex="-1"></a><span class="in">             y = factor(Metric, </span></span>
<span id="cb385-7768"><a href="#cb385-7768" aria-hidden="true" tabindex="-1"></a><span class="in">                        levels=metrics),</span></span>
<span id="cb385-7769"><a href="#cb385-7769" aria-hidden="true" tabindex="-1"></a><span class="in">             fill = SWC)) +</span></span>
<span id="cb385-7770"><a href="#cb385-7770" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_tile()</span></span>
<span id="cb385-7771"><a href="#cb385-7771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7772"><a href="#cb385-7772" aria-hidden="true" tabindex="-1"></a><span class="in">p_past&lt;-</span></span>
<span id="cb385-7773"><a href="#cb385-7773" aria-hidden="true" tabindex="-1"></a><span class="in">  p_past +</span></span>
<span id="cb385-7774"><a href="#cb385-7774" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +</span></span>
<span id="cb385-7775"><a href="#cb385-7775" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text = element_text(size = 6)) +</span></span>
<span id="cb385-7776"><a href="#cb385-7776" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_gradientn(colours = matlab.like(15),</span></span>
<span id="cb385-7777"><a href="#cb385-7777" aria-hidden="true" tabindex="-1"></a><span class="in">                       labels = scales::percent,</span></span>
<span id="cb385-7778"><a href="#cb385-7778" aria-hidden="true" tabindex="-1"></a><span class="in">                       limits = rng) +</span></span>
<span id="cb385-7779"><a href="#cb385-7779" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(position = "top") +</span></span>
<span id="cb385-7780"><a href="#cb385-7780" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(fill = "Change in\nSafe Winter Chill\nsince 2000") +</span></span>
<span id="cb385-7781"><a href="#cb385-7781" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_discrete(labels = model_labels) +</span></span>
<span id="cb385-7782"><a href="#cb385-7782" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Chill metric")</span></span>
<span id="cb385-7783"><a href="#cb385-7783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7784"><a href="#cb385-7784" aria-hidden="true" tabindex="-1"></a><span class="in"># Now we can combine the plots. We’ll again use the patchwork package for this. </span></span>
<span id="cb385-7785"><a href="#cb385-7785" aria-hidden="true" tabindex="-1"></a><span class="in"># Mainly the plots are now on top of each other (nrow=2, with relative heights </span></span>
<span id="cb385-7786"><a href="#cb385-7786" aria-hidden="true" tabindex="-1"></a><span class="in"># specified by heights=c(1,2)). </span></span>
<span id="cb385-7787"><a href="#cb385-7787" aria-hidden="true" tabindex="-1"></a><span class="in">chill_comp_plot&lt;-</span></span>
<span id="cb385-7788"><a href="#cb385-7788" aria-hidden="true" tabindex="-1"></a><span class="in">  (p_past +</span></span>
<span id="cb385-7789"><a href="#cb385-7789" aria-hidden="true" tabindex="-1"></a><span class="in">     p_future +</span></span>
<span id="cb385-7790"><a href="#cb385-7790" aria-hidden="true" tabindex="-1"></a><span class="in">     # collect guides below to the given nesting level, removing duplicates/</span></span>
<span id="cb385-7791"><a href="#cb385-7791" aria-hidden="true" tabindex="-1"></a><span class="in">     # collect all legends from two plots into a single legend</span></span>
<span id="cb385-7792"><a href="#cb385-7792" aria-hidden="true" tabindex="-1"></a><span class="in">     plot_layout(guides = "collect", </span></span>
<span id="cb385-7793"><a href="#cb385-7793" aria-hidden="true" tabindex="-1"></a><span class="in">                 nrow = 2,</span></span>
<span id="cb385-7794"><a href="#cb385-7794" aria-hidden="true" tabindex="-1"></a><span class="in">                 heights = c(1,3))) &amp;</span></span>
<span id="cb385-7795"><a href="#cb385-7795" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "right",</span></span>
<span id="cb385-7796"><a href="#cb385-7796" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.background = element_blank(),</span></span>
<span id="cb385-7797"><a href="#cb385-7797" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.text = element_text(face = "bold"))</span></span>
<span id="cb385-7798"><a href="#cb385-7798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7799"><a href="#cb385-7799" aria-hidden="true" tabindex="-1"></a><span class="in">chill_comp_plot</span></span>
<span id="cb385-7800"><a href="#cb385-7800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7801"><a href="#cb385-7801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7802"><a href="#cb385-7802" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-7803"><a href="#cb385-7803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7804"><a href="#cb385-7804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7805"><a href="#cb385-7805" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-7806"><a href="#cb385-7806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7807"><a href="#cb385-7807" aria-hidden="true" tabindex="-1"></a>***3. Produce an animated line plot of your results (summarizing Safe Winter Chill across all the GCMs).***</span>
<span id="cb385-7808"><a href="#cb385-7808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7809"><a href="#cb385-7809" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 19.4.3, eval=FALSE}</span></span>
<span id="cb385-7810"><a href="#cb385-7810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7811"><a href="#cb385-7811" aria-hidden="true" tabindex="-1"></a><span class="in"># Copy historical data for each SSP and then bind into data frame</span></span>
<span id="cb385-7812"><a href="#cb385-7812" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results &lt;- results[which(results$GCM == "none"),]</span></span>
<span id="cb385-7813"><a href="#cb385-7813" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results$SSP &lt;- "SSP1"</span></span>
<span id="cb385-7814"><a href="#cb385-7814" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results_2 &lt;- hist_results</span></span>
<span id="cb385-7815"><a href="#cb385-7815" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results_2$SSP &lt;- "SSP2"</span></span>
<span id="cb385-7816"><a href="#cb385-7816" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results_3 &lt;- hist_results</span></span>
<span id="cb385-7817"><a href="#cb385-7817" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results_3$SSP &lt;- "SSP3"</span></span>
<span id="cb385-7818"><a href="#cb385-7818" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results_4 &lt;- hist_results</span></span>
<span id="cb385-7819"><a href="#cb385-7819" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results_4$SSP &lt;- "SSP5"</span></span>
<span id="cb385-7820"><a href="#cb385-7820" aria-hidden="true" tabindex="-1"></a><span class="in">hist_results &lt;- rbind(hist_results,</span></span>
<span id="cb385-7821"><a href="#cb385-7821" aria-hidden="true" tabindex="-1"></a><span class="in">                      hist_results_2,</span></span>
<span id="cb385-7822"><a href="#cb385-7822" aria-hidden="true" tabindex="-1"></a><span class="in">                      hist_results_3,</span></span>
<span id="cb385-7823"><a href="#cb385-7823" aria-hidden="true" tabindex="-1"></a><span class="in">                      hist_results_4)</span></span>
<span id="cb385-7824"><a href="#cb385-7824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7825"><a href="#cb385-7825" aria-hidden="true" tabindex="-1"></a><span class="in">future_results &lt;- results[which(!results$GCM == "none"),]</span></span>
<span id="cb385-7826"><a href="#cb385-7826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7827"><a href="#cb385-7827" aria-hidden="true" tabindex="-1"></a><span class="in"># Compute summary statistics of data subsets</span></span>
<span id="cb385-7828"><a href="#cb385-7828" aria-hidden="true" tabindex="-1"></a><span class="in">GCM_aggregate &lt;- aggregate(</span></span>
<span id="cb385-7829"><a href="#cb385-7829" aria-hidden="true" tabindex="-1"></a><span class="in">  future_results$SWC,</span></span>
<span id="cb385-7830"><a href="#cb385-7830" aria-hidden="true" tabindex="-1"></a><span class="in">  by=list(future_results$Metric, </span></span>
<span id="cb385-7831"><a href="#cb385-7831" aria-hidden="true" tabindex="-1"></a><span class="in">          future_results$SSP,</span></span>
<span id="cb385-7832"><a href="#cb385-7832" aria-hidden="true" tabindex="-1"></a><span class="in">          future_results$Year),</span></span>
<span id="cb385-7833"><a href="#cb385-7833" aria-hidden="true" tabindex="-1"></a><span class="in">  FUN=mean) </span></span>
<span id="cb385-7834"><a href="#cb385-7834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7835"><a href="#cb385-7835" aria-hidden="true" tabindex="-1"></a><span class="in"># Rename the columns</span></span>
<span id="cb385-7836"><a href="#cb385-7836" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(GCM_aggregate) &lt;- c("Metric",</span></span>
<span id="cb385-7837"><a href="#cb385-7837" aria-hidden="true" tabindex="-1"></a><span class="in">                             "SSP",</span></span>
<span id="cb385-7838"><a href="#cb385-7838" aria-hidden="true" tabindex="-1"></a><span class="in">                             "Year",</span></span>
<span id="cb385-7839"><a href="#cb385-7839" aria-hidden="true" tabindex="-1"></a><span class="in">                             "SWC")</span></span>
<span id="cb385-7840"><a href="#cb385-7840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7841"><a href="#cb385-7841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7842"><a href="#cb385-7842" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine historical SWC data (for SSPs) and mean future SWC projection </span></span>
<span id="cb385-7843"><a href="#cb385-7843" aria-hidden="true" tabindex="-1"></a><span class="in">SSP_Time_series&lt;-rbind(hist_results[,c("Metric",</span></span>
<span id="cb385-7844"><a href="#cb385-7844" aria-hidden="true" tabindex="-1"></a><span class="in">                                       "SSP",</span></span>
<span id="cb385-7845"><a href="#cb385-7845" aria-hidden="true" tabindex="-1"></a><span class="in">                                       "Year",</span></span>
<span id="cb385-7846"><a href="#cb385-7846" aria-hidden="true" tabindex="-1"></a><span class="in">                                       "SWC")], </span></span>
<span id="cb385-7847"><a href="#cb385-7847" aria-hidden="true" tabindex="-1"></a><span class="in">                       GCM_aggregate)</span></span>
<span id="cb385-7848"><a href="#cb385-7848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7849"><a href="#cb385-7849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7850"><a href="#cb385-7850" aria-hidden="true" tabindex="-1"></a><span class="in"># Make sure all are numeric years</span></span>
<span id="cb385-7851"><a href="#cb385-7851" aria-hidden="true" tabindex="-1"></a><span class="in">SSP_Time_series$Year &lt;- as.numeric(SSP_Time_series$Year)</span></span>
<span id="cb385-7852"><a href="#cb385-7852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7853"><a href="#cb385-7853" aria-hidden="true" tabindex="-1"></a><span class="in">chill_change_plot&lt;-</span></span>
<span id="cb385-7854"><a href="#cb385-7854" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(data = SSP_Time_series,</span></span>
<span id="cb385-7855"><a href="#cb385-7855" aria-hidden="true" tabindex="-1"></a><span class="in">         aes(x = Year,</span></span>
<span id="cb385-7856"><a href="#cb385-7856" aria-hidden="true" tabindex="-1"></a><span class="in">             y = SWC,</span></span>
<span id="cb385-7857"><a href="#cb385-7857" aria-hidden="true" tabindex="-1"></a><span class="in">             col = factor(Metric,</span></span>
<span id="cb385-7858"><a href="#cb385-7858" aria-hidden="true" tabindex="-1"></a><span class="in">                          levels = metrics))) +</span></span>
<span id="cb385-7859"><a href="#cb385-7859" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(lwd = 1.3) +</span></span>
<span id="cb385-7860"><a href="#cb385-7860" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~SSP,</span></span>
<span id="cb385-7861"><a href="#cb385-7861" aria-hidden="true" tabindex="-1"></a><span class="in">             nrow = 4) +</span></span>
<span id="cb385-7862"><a href="#cb385-7862" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 10) +</span></span>
<span id="cb385-7863"><a href="#cb385-7863" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(col = "Change in\nSafe Winter Chill\nsince 2000") +</span></span>
<span id="cb385-7864"><a href="#cb385-7864" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_discrete(labels = model_labels) +</span></span>
<span id="cb385-7865"><a href="#cb385-7865" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(labels = scales::percent) + # display values as %</span></span>
<span id="cb385-7866"><a href="#cb385-7866" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(strip.background = element_blank(),</span></span>
<span id="cb385-7867"><a href="#cb385-7867" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.text = element_text(face = "bold")) +</span></span>
<span id="cb385-7868"><a href="#cb385-7868" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Safe Winter Chill")</span></span>
<span id="cb385-7869"><a href="#cb385-7869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7870"><a href="#cb385-7870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7871"><a href="#cb385-7871" aria-hidden="true" tabindex="-1"></a><span class="in">ccp &lt;- chill_change_plot + transition_reveal(Year)</span></span>
<span id="cb385-7872"><a href="#cb385-7872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7873"><a href="#cb385-7873" aria-hidden="true" tabindex="-1"></a><span class="in">animate(ccp, fps = 10)</span></span>
<span id="cb385-7874"><a href="#cb385-7874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7875"><a href="#cb385-7875" aria-hidden="true" tabindex="-1"></a><span class="in">anim_save("data/MS/MS_chill_comparison_animation.gif", animation = last_animation())</span></span>
<span id="cb385-7876"><a href="#cb385-7876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7877"><a href="#cb385-7877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7878"><a href="#cb385-7878" aria-hidden="true" tabindex="-1"></a><span class="in">include_graphics("data/MS/MS_chill_comparison_animation.gif")</span></span>
<span id="cb385-7879"><a href="#cb385-7879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7880"><a href="#cb385-7880" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-7881"><a href="#cb385-7881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7882"><a href="#cb385-7882" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 19.4.3a, echo=FALSE, out.width="80%"}</span></span>
<span id="cb385-7883"><a href="#cb385-7883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7884"><a href="#cb385-7884" aria-hidden="true" tabindex="-1"></a><span class="in">include_graphics("data/MS/MS_chill_comparison_animation.gif")</span></span>
<span id="cb385-7885"><a href="#cb385-7885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7886"><a href="#cb385-7886" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-7887"><a href="#cb385-7887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7888"><a href="#cb385-7888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7889"><a href="#cb385-7889" aria-hidden="true" tabindex="-1"></a>*Check and add details later.*</span>
<span id="cb385-7890"><a href="#cb385-7890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7891"><a href="#cb385-7891" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-7892"><a href="#cb385-7892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7893"><a href="#cb385-7893" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 20: Simple phenology analysis</span></span>
<span id="cb385-7894"><a href="#cb385-7894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7895"><a href="#cb385-7895" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;20.1&lt;/span&gt;&amp;nbsp; Phenology analysis</span></span>
<span id="cb385-7896"><a href="#cb385-7896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7897"><a href="#cb385-7897" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-7898"><a href="#cb385-7898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7899"><a href="#cb385-7899" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Finally, we will seriously start analyzing phenology, using the example of bloom dates of the pear cultivar *Alexander Lucas* that we already worked with in the frost analysis.</span>
<span id="cb385-7900"><a href="#cb385-7900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7901"><a href="#cb385-7901" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>As you may remember, we have a time series of first, full and last bloom dates recorded at Campus Klein-Altendorf between 1958 and 2019. For this analysis, I’ll just use the first bloom dates:</span>
<span id="cb385-7902"><a href="#cb385-7902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7903"><a href="#cb385-7903" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 20.1}</span></span>
<span id="cb385-7904"><a href="#cb385-7904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7905"><a href="#cb385-7905" aria-hidden="true" tabindex="-1"></a><span class="in">Alex &lt;- read_tab("data/OT/Alexander_Lucas_bloom_1958_2019.csv")</span></span>
<span id="cb385-7906"><a href="#cb385-7906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7907"><a href="#cb385-7907" aria-hidden="true" tabindex="-1"></a><span class="in"># Collapse First_bloom to Last_bloom columns into rows</span></span>
<span id="cb385-7908"><a href="#cb385-7908" aria-hidden="true" tabindex="-1"></a><span class="in">Alex &lt;- pivot_longer(Alex,</span></span>
<span id="cb385-7909"><a href="#cb385-7909" aria-hidden="true" tabindex="-1"></a><span class="in">                     cols = c(First_bloom:Last_bloom),</span></span>
<span id="cb385-7910"><a href="#cb385-7910" aria-hidden="true" tabindex="-1"></a><span class="in">                     names_to = "Stage",</span></span>
<span id="cb385-7911"><a href="#cb385-7911" aria-hidden="true" tabindex="-1"></a><span class="in">                     values_to = "YEARMODA")</span></span>
<span id="cb385-7912"><a href="#cb385-7912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7913"><a href="#cb385-7913" aria-hidden="true" tabindex="-1"></a><span class="in">Alex_first &lt;- Alex %&gt;%</span></span>
<span id="cb385-7914"><a href="#cb385-7914" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Year = as.numeric(substr(YEARMODA, 1, 4)), # add year, month and day columns</span></span>
<span id="cb385-7915"><a href="#cb385-7915" aria-hidden="true" tabindex="-1"></a><span class="in">         Month = as.numeric(substr(YEARMODA, 5, 6)),</span></span>
<span id="cb385-7916"><a href="#cb385-7916" aria-hidden="true" tabindex="-1"></a><span class="in">         Day = as.numeric(substr(YEARMODA, 7, 8))) %&gt;%</span></span>
<span id="cb385-7917"><a href="#cb385-7917" aria-hidden="true" tabindex="-1"></a><span class="in">  make_JDay() %&gt;% # JDay column</span></span>
<span id="cb385-7918"><a href="#cb385-7918" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Stage == "First_bloom") # only select the data for First_bloom </span></span>
<span id="cb385-7919"><a href="#cb385-7919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7920"><a href="#cb385-7920" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-7921"><a href="#cb385-7921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7922"><a href="#cb385-7922" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-7923"><a href="#cb385-7923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7924"><a href="#cb385-7924" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;20.2&lt;/span&gt;&amp;nbsp; Time series analysis</span></span>
<span id="cb385-7925"><a href="#cb385-7925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7926"><a href="#cb385-7926" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-7927"><a href="#cb385-7927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7928"><a href="#cb385-7928" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The first analysis people often do with such a dataset is a simple analysis over time. Let’s first plot the data:</span>
<span id="cb385-7929"><a href="#cb385-7929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7930"><a href="#cb385-7930" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 20.2a}</span></span>
<span id="cb385-7931"><a href="#cb385-7931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7932"><a href="#cb385-7932" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(Alex_first,</span></span>
<span id="cb385-7933"><a href="#cb385-7933" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(Pheno_year,</span></span>
<span id="cb385-7934"><a href="#cb385-7934" aria-hidden="true" tabindex="-1"></a><span class="in">           JDay)) +</span></span>
<span id="cb385-7935"><a href="#cb385-7935" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb385-7936"><a href="#cb385-7936" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("First bloom date (day of the year)") +</span></span>
<span id="cb385-7937"><a href="#cb385-7937" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab ("Year") +</span></span>
<span id="cb385-7938"><a href="#cb385-7938" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15)</span></span>
<span id="cb385-7939"><a href="#cb385-7939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7940"><a href="#cb385-7940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7941"><a href="#cb385-7941" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-7942"><a href="#cb385-7942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7943"><a href="#cb385-7943" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-7944"><a href="#cb385-7944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7945"><a href="#cb385-7945" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It’s a bit hard to see a clear pattern here, but let’s check if there is a trend over time using the Kendall test. </span>
<span id="cb385-7946"><a href="#cb385-7946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7947"><a href="#cb385-7947" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 20.2b}</span></span>
<span id="cb385-7948"><a href="#cb385-7948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7949"><a href="#cb385-7949" aria-hidden="true" tabindex="-1"></a><span class="in"># library(Kendall)</span></span>
<span id="cb385-7950"><a href="#cb385-7950" aria-hidden="true" tabindex="-1"></a><span class="in">Kendall(x = Alex_first$Pheno_year,</span></span>
<span id="cb385-7951"><a href="#cb385-7951" aria-hidden="true" tabindex="-1"></a><span class="in">        y = Alex_first$JDay)</span></span>
<span id="cb385-7952"><a href="#cb385-7952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7953"><a href="#cb385-7953" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-7954"><a href="#cb385-7954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7955"><a href="#cb385-7955" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>p-value is 0.035 and the tau value is negative, so it seems we have a significant trend towards earlier bloom.</span>
<span id="cb385-7956"><a href="#cb385-7956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7957"><a href="#cb385-7957" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To determine how strong this trend is, many researchers use regression analysis, with model coefficients fitted to data. To do that, we first assume a linear relationship between time and bloom dates: </span>
<span id="cb385-7958"><a href="#cb385-7958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7959"><a href="#cb385-7959" aria-hidden="true" tabindex="-1"></a>$$Bloomdate = a ~.~ Phenoyear + b$$</span>
<span id="cb385-7960"><a href="#cb385-7960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7961"><a href="#cb385-7961" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To make the code easier to read, name the Pheno_year <span class="in">`x`</span> and the Bloom date (JDay) <span class="in">`y`</span> </span>
<span id="cb385-7962"><a href="#cb385-7962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7963"><a href="#cb385-7963" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 20.2c}</span></span>
<span id="cb385-7964"><a href="#cb385-7964" aria-hidden="true" tabindex="-1"></a><span class="in">x &lt;- Alex_first$Pheno_year</span></span>
<span id="cb385-7965"><a href="#cb385-7965" aria-hidden="true" tabindex="-1"></a><span class="in">y &lt;- Alex_first$JDay</span></span>
<span id="cb385-7966"><a href="#cb385-7966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7967"><a href="#cb385-7967" aria-hidden="true" tabindex="-1"></a><span class="in">summary(lm(y ~ x))</span></span>
<span id="cb385-7968"><a href="#cb385-7968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7969"><a href="#cb385-7969" aria-hidden="true" tabindex="-1"></a><span class="in"># We get the best estimate for the slope of -0.16 and also a p-value.</span></span>
<span id="cb385-7970"><a href="#cb385-7970" aria-hidden="true" tabindex="-1"></a><span class="in"># But, for a time series we're better off using the one returned by Kendall test.</span></span>
<span id="cb385-7971"><a href="#cb385-7971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7972"><a href="#cb385-7972" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data</span></span>
<span id="cb385-7973"><a href="#cb385-7973" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(Alex_first,</span></span>
<span id="cb385-7974"><a href="#cb385-7974" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(Year,</span></span>
<span id="cb385-7975"><a href="#cb385-7975" aria-hidden="true" tabindex="-1"></a><span class="in">           JDay)) +</span></span>
<span id="cb385-7976"><a href="#cb385-7976" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb385-7977"><a href="#cb385-7977" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = 'lm',</span></span>
<span id="cb385-7978"><a href="#cb385-7978" aria-hidden="true" tabindex="-1"></a><span class="in">              formula = y ~ x) +</span></span>
<span id="cb385-7979"><a href="#cb385-7979" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("First bloom date (day of the year)") +</span></span>
<span id="cb385-7980"><a href="#cb385-7980" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab ("Year") +</span></span>
<span id="cb385-7981"><a href="#cb385-7981" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15)</span></span>
<span id="cb385-7982"><a href="#cb385-7982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7983"><a href="#cb385-7983" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-7984"><a href="#cb385-7984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7985"><a href="#cb385-7985" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-7986"><a href="#cb385-7986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7987"><a href="#cb385-7987" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In the diagram, many of the data points are still pretty far from the regression line, with many of them way outside the confidence interval that is shown.</span>
<span id="cb385-7988"><a href="#cb385-7988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7989"><a href="#cb385-7989" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Maybe we can find another model that better describes the data, e.g. by fitting a second-order polynomial, or maybe a third-order polynomial… Let’s cut this process short and immediately fit a 25th-order polynomial:</span>
<span id="cb385-7990"><a href="#cb385-7990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7991"><a href="#cb385-7991" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 20.2d}</span></span>
<span id="cb385-7992"><a href="#cb385-7992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7993"><a href="#cb385-7993" aria-hidden="true" tabindex="-1"></a><span class="in">summary(lm(y ~ poly(x, 25)))</span></span>
<span id="cb385-7994"><a href="#cb385-7994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-7995"><a href="#cb385-7995" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data</span></span>
<span id="cb385-7996"><a href="#cb385-7996" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(Alex_first,</span></span>
<span id="cb385-7997"><a href="#cb385-7997" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(Year,</span></span>
<span id="cb385-7998"><a href="#cb385-7998" aria-hidden="true" tabindex="-1"></a><span class="in">           JDay)) +</span></span>
<span id="cb385-7999"><a href="#cb385-7999" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb385-8000"><a href="#cb385-8000" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method='lm',</span></span>
<span id="cb385-8001"><a href="#cb385-8001" aria-hidden="true" tabindex="-1"></a><span class="in">              formula = y ~ poly(x, 25)) +</span></span>
<span id="cb385-8002"><a href="#cb385-8002" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("First bloom date (day of the year)") +</span></span>
<span id="cb385-8003"><a href="#cb385-8003" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab ("Year") +</span></span>
<span id="cb385-8004"><a href="#cb385-8004" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15)</span></span>
<span id="cb385-8005"><a href="#cb385-8005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8006"><a href="#cb385-8006" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-8007"><a href="#cb385-8007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8008"><a href="#cb385-8008" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8009"><a href="#cb385-8009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8010"><a href="#cb385-8010" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It’s a bit hard now to make a clear statement about the temporal trend, since there is no single number for the slope. The slope varies over time, but it can be calculated by taking the first derivative of the complex 25th-order polynomial we computed. But we got a stellar p-value, and almost all of the data points are contained in the confidence interval!</span>
<span id="cb385-8011"><a href="#cb385-8011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8012"><a href="#cb385-8012" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>But, it is obvious that this is not a useful model. If we make the model equation increasingly more complex, we’ll eventually find a structure that can perfectly fit all data points. This is not desirable, however, because we have no reason to expect that there is such a perfect relationship between our independent and dependent variables.</span>
<span id="cb385-8013"><a href="#cb385-8013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8014"><a href="#cb385-8014" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Each measurement (such as a bloom date recording) comes with an error, and, more importantly, there may also be other factors in addition to time that affect bloom dates. If we make our model more complex than we can reasonably expect the actual relationship to be, we run the risk of **overfitting** our model. </span>
<span id="cb385-8015"><a href="#cb385-8015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8016"><a href="#cb385-8016" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This means that we may get a very good fit, but our regression equation isn’t very useful for explaining the actual process we’re trying to model.</span>
<span id="cb385-8017"><a href="#cb385-8017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8018"><a href="#cb385-8018" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8019"><a href="#cb385-8019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8020"><a href="#cb385-8020" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;20.3&lt;/span&gt;&amp;nbsp; p-hacking</span></span>
<span id="cb385-8021"><a href="#cb385-8021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8022"><a href="#cb385-8022" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-8023"><a href="#cb385-8023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8024"><a href="#cb385-8024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8025"><a href="#cb385-8025" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A concept that is closely related to overfitting and that also often occurs in machine-learning is that of *p-hacking*, also known as a *fishing expedition*.</span>
<span id="cb385-8026"><a href="#cb385-8026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8027"><a href="#cb385-8027" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The idea behind these terms is that when you look at a sufficiently large dataset, with lots of variables, you’re bound to find correlations somewhere in this dataset, regardless of whether your data involves actual causal relationships.</span>
<span id="cb385-8028"><a href="#cb385-8028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8029"><a href="#cb385-8029" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Screening large datasets for ‘significant’ relationships and then presenting these as meaningful correlations is bad scientific practice (<span class="co">[</span><span class="ot">Nuzzo, 2014</span><span class="co">](https://www.nature.com/articles/506150a)</span>). Possibly, such screening can lead to hypotheses that can then be tested through further studies, but we should not rely on this to generate ‘facts’.</span>
<span id="cb385-8030"><a href="#cb385-8030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8031"><a href="#cb385-8031" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8032"><a href="#cb385-8032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8033"><a href="#cb385-8033" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;20.4&lt;/span&gt;&amp;nbsp; The process that generates the data</span></span>
<span id="cb385-8034"><a href="#cb385-8034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8035"><a href="#cb385-8035" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-8036"><a href="#cb385-8036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8037"><a href="#cb385-8037" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Many researchers are focused on finding structure in the datasets they work with. What we really want to understand is ***the process that generates the data***, rather than the data themselves.</span>
<span id="cb385-8038"><a href="#cb385-8038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8039"><a href="#cb385-8039" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Rather than digging straight into the numbers, we first need to sit back and think about what may actually be going on in the system we’re analyzing. We can then use causal diagrams to sketch out how we think our system works:</span>
<span id="cb385-8040"><a href="#cb385-8040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8041"><a href="#cb385-8041" aria-hidden="true" tabindex="-1"></a>$$A \rightarrow B$$</span>
<span id="cb385-8042"><a href="#cb385-8042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8043"><a href="#cb385-8043" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Up to now, we were looking for the following relationship:</span>
<span id="cb385-8044"><a href="#cb385-8044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8045"><a href="#cb385-8045" aria-hidden="true" tabindex="-1"></a>$$Time \rightarrow Phenology$$</span>
<span id="cb385-8046"><a href="#cb385-8046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8047"><a href="#cb385-8047" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Can this possibly be what’s going on here? Can time drive phenology? While I won’t completely rule out that trees are somehow able to track the passage of time within their annual cycle, I’m pretty sure they have no idea what the current year is…</span>
<span id="cb385-8048"><a href="#cb385-8048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8049"><a href="#cb385-8049" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8050"><a href="#cb385-8050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8051"><a href="#cb385-8051" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;20.5&lt;/span&gt;&amp;nbsp; An ecological theory to guide our analysis</span></span>
<span id="cb385-8052"><a href="#cb385-8052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8053"><a href="#cb385-8053" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-8054"><a href="#cb385-8054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8055"><a href="#cb385-8055" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Temperature drives phenology:</span>
<span id="cb385-8056"><a href="#cb385-8056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8057"><a href="#cb385-8057" aria-hidden="true" tabindex="-1"></a>$$Temperature \rightarrow Phenology$$</span>
<span id="cb385-8058"><a href="#cb385-8058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8059"><a href="#cb385-8059" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>As you can see, this theory doesn’t involve time. The reason why we were able to find statistical relationships earlier is not that time (as in the calendar year) actually affects phenology<span class="dv">&amp;mdash;</span> it is that temperatures have been rising over the years, mainly in response to anthropogenic global warming.</span>
<span id="cb385-8060"><a href="#cb385-8060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8061"><a href="#cb385-8061" aria-hidden="true" tabindex="-1"></a>$$Time \rightarrow Temperature$$</span>
<span id="cb385-8062"><a href="#cb385-8062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8063"><a href="#cb385-8063" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Actually this is:</span>
<span id="cb385-8064"><a href="#cb385-8064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8065"><a href="#cb385-8065" aria-hidden="true" tabindex="-1"></a>$$Time \rightarrow Greenhouse~Gas~Concentrations \rightarrow Climate~Forcing \rightarrow Temperature$$</span>
<span id="cb385-8066"><a href="#cb385-8066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8067"><a href="#cb385-8067" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Since temperature, especially at the local scale, is subject to considerable random variation, this relationship may not be particularly strong. The noise in this relationship can easily keep us from detecting the actual response of tree phenology during our time series.</span>
<span id="cb385-8068"><a href="#cb385-8068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8069"><a href="#cb385-8069" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The full causal diagram of these three variables (without the greenhouse effect part) is:</span>
<span id="cb385-8070"><a href="#cb385-8070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8071"><a href="#cb385-8071" aria-hidden="true" tabindex="-1"></a>$$Time \rightarrow Temperature \rightarrow Phenology$$</span>
<span id="cb385-8072"><a href="#cb385-8072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8073"><a href="#cb385-8073" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Sometimes we have no data on the intermediate steps in such a diagram. In such cases, we either have to live with a model that doesn’t actually get to the direct causal mechanisms in play, or we have to get a bit more creative with our analysis. Fortunately, here we actually do have data on temperature, so we can focus on the direct causal relationship between temperature and phenology.</span>
<span id="cb385-8074"><a href="#cb385-8074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8075"><a href="#cb385-8075" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8076"><a href="#cb385-8076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8077"><a href="#cb385-8077" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;20.6&lt;/span&gt;&amp;nbsp; Temperature correlations</span></span>
<span id="cb385-8078"><a href="#cb385-8078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8079"><a href="#cb385-8079" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-8080"><a href="#cb385-8080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8081"><a href="#cb385-8081" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now that we have clarified that it would make more sense to narrow in on the temperature-phenology relationship, we gained some conceptual clarity, but we are faced with a much greater statistical challenge.</span>
<span id="cb385-8082"><a href="#cb385-8082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8083"><a href="#cb385-8083" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In correlating years with bloom dates, we had just two series of numbers to look at, since we had exactly one bloom date per year. </span>
<span id="cb385-8084"><a href="#cb385-8084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8085"><a href="#cb385-8085" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Temperature, in contrast, is a variable we can measure at different temporal scales. If we just look at the average annual temperature, the statistical challenge is similar to using just the year number.</span>
<span id="cb385-8086"><a href="#cb385-8086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8087"><a href="#cb385-8087" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Let’s see if we can find a correlation for this.</span>
<span id="cb385-8088"><a href="#cb385-8088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8089"><a href="#cb385-8089" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 20.6a}</span></span>
<span id="cb385-8090"><a href="#cb385-8090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8091"><a href="#cb385-8091" aria-hidden="true" tabindex="-1"></a><span class="in">temperature &lt;- read_tab("data/OT/TMaxTMin1958-2019_patched.csv")</span></span>
<span id="cb385-8092"><a href="#cb385-8092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8093"><a href="#cb385-8093" aria-hidden="true" tabindex="-1"></a><span class="in"># Group data by year and calculate mean of Tmin for each year</span></span>
<span id="cb385-8094"><a href="#cb385-8094" aria-hidden="true" tabindex="-1"></a><span class="in">Tmin &lt;- temperature %&gt;%</span></span>
<span id="cb385-8095"><a href="#cb385-8095" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(Year) %&gt;%</span></span>
<span id="cb385-8096"><a href="#cb385-8096" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(Tmin = mean(Tmin))</span></span>
<span id="cb385-8097"><a href="#cb385-8097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8098"><a href="#cb385-8098" aria-hidden="true" tabindex="-1"></a><span class="in"># Group data by year and calculate mean of Tmax for each year</span></span>
<span id="cb385-8099"><a href="#cb385-8099" aria-hidden="true" tabindex="-1"></a><span class="in">Tmax &lt;- temperature %&gt;%</span></span>
<span id="cb385-8100"><a href="#cb385-8100" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(Year) %&gt;% </span></span>
<span id="cb385-8101"><a href="#cb385-8101" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(Tmax = mean(Tmax))</span></span>
<span id="cb385-8102"><a href="#cb385-8102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8103"><a href="#cb385-8103" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a dataframe with year, Tmin, Tmax and Tmean columns</span></span>
<span id="cb385-8104"><a href="#cb385-8104" aria-hidden="true" tabindex="-1"></a><span class="in">Annual_means &lt;- Tmin %&gt;%</span></span>
<span id="cb385-8105"><a href="#cb385-8105" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind(Tmax[,2]) %&gt;% # select only the Tmax column (excluding year column)</span></span>
<span id="cb385-8106"><a href="#cb385-8106" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Tmean = (Tmin + Tmax)/2)</span></span>
<span id="cb385-8107"><a href="#cb385-8107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8108"><a href="#cb385-8108" aria-hidden="true" tabindex="-1"></a><span class="in"># Merge with Alex_first dataset</span></span>
<span id="cb385-8109"><a href="#cb385-8109" aria-hidden="true" tabindex="-1"></a><span class="in">Annual_means &lt;- merge(Annual_means,</span></span>
<span id="cb385-8110"><a href="#cb385-8110" aria-hidden="true" tabindex="-1"></a><span class="in">                      Alex_first)</span></span>
<span id="cb385-8111"><a href="#cb385-8111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8112"><a href="#cb385-8112" aria-hidden="true" tabindex="-1"></a><span class="in"># Modify dataset for ggplot with pivot_longer</span></span>
<span id="cb385-8113"><a href="#cb385-8113" aria-hidden="true" tabindex="-1"></a><span class="in">Annual_means_longer &lt;- Annual_means[,c(1:4,10)] %&gt;% # First 4 and 10th columns</span></span>
<span id="cb385-8114"><a href="#cb385-8114" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_longer(cols = c(Tmin:Tmean),</span></span>
<span id="cb385-8115"><a href="#cb385-8115" aria-hidden="true" tabindex="-1"></a><span class="in">               names_to = "Variable",</span></span>
<span id="cb385-8116"><a href="#cb385-8116" aria-hidden="true" tabindex="-1"></a><span class="in">               values_to = "Temp")</span></span>
<span id="cb385-8117"><a href="#cb385-8117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8118"><a href="#cb385-8118" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(Annual_means_longer,</span></span>
<span id="cb385-8119"><a href="#cb385-8119" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(x=Temp,</span></span>
<span id="cb385-8120"><a href="#cb385-8120" aria-hidden="true" tabindex="-1"></a><span class="in">           y=JDay)) + </span></span>
<span id="cb385-8121"><a href="#cb385-8121" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb385-8122"><a href="#cb385-8122" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method="lm",</span></span>
<span id="cb385-8123"><a href="#cb385-8123" aria-hidden="true" tabindex="-1"></a><span class="in">              formula=y~x) + </span></span>
<span id="cb385-8124"><a href="#cb385-8124" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap("Variable")</span></span>
<span id="cb385-8125"><a href="#cb385-8125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8126"><a href="#cb385-8126" aria-hidden="true" tabindex="-1"></a><span class="in"># Simple linear regression between JDay (dependent/response variable, Y) and </span></span>
<span id="cb385-8127"><a href="#cb385-8127" aria-hidden="true" tabindex="-1"></a><span class="in"># Tmax (independent/predictor variable, X)</span></span>
<span id="cb385-8128"><a href="#cb385-8128" aria-hidden="true" tabindex="-1"></a><span class="in">summary(lm(Annual_means$JDay ~ Annual_means$Tmin))</span></span>
<span id="cb385-8129"><a href="#cb385-8129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8130"><a href="#cb385-8130" aria-hidden="true" tabindex="-1"></a><span class="in"># Predict JDay based on Tmax</span></span>
<span id="cb385-8131"><a href="#cb385-8131" aria-hidden="true" tabindex="-1"></a><span class="in">summary(lm(Annual_means$JDay ~ Annual_means$Tmax))</span></span>
<span id="cb385-8132"><a href="#cb385-8132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8133"><a href="#cb385-8133" aria-hidden="true" tabindex="-1"></a><span class="in"># Predict JDay based on Tmean</span></span>
<span id="cb385-8134"><a href="#cb385-8134" aria-hidden="true" tabindex="-1"></a><span class="in">summary(lm(Annual_means$JDay ~ Annual_means$Tmean))</span></span>
<span id="cb385-8135"><a href="#cb385-8135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8136"><a href="#cb385-8136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-8137"><a href="#cb385-8137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8138"><a href="#cb385-8138" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There’s a relationship here, but this is still not really a convincing analysis. The main reason is that the time period we’re calculating the mean temperatures for is the whole year, even though bloom already occurs in spring. Temperatures after this can’t possibly affect the bloom date in the year of interest! </span>
<span id="cb385-8139"><a href="#cb385-8139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8140"><a href="#cb385-8140" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Then why did we get such convincing results, with exceptionally low <span class="in">`p`</span> values?</span>
<span id="cb385-8141"><a href="#cb385-8141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8142"><a href="#cb385-8142" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Again, the reason is climate change. Temperatures have been rising over time, and phenology has advanced over time, so later years generally feature earlier bloom dates. </span>
<span id="cb385-8143"><a href="#cb385-8143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8144"><a href="#cb385-8144" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To get to an analysis that has a chance of actually reflecting a causal relationship, however, we need to restrict the analysis to a range of dates that can plausibly affect bloom dates.</span>
<span id="cb385-8145"><a href="#cb385-8145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8146"><a href="#cb385-8146" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Let’s write a quick function to screen for such correlations. To facilitate this, we’ll use <span class="in">`JDay`</span>, i.e. the day of the year, to express the date.</span>
<span id="cb385-8147"><a href="#cb385-8147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8148"><a href="#cb385-8148" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 20.6b}</span></span>
<span id="cb385-8149"><a href="#cb385-8149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8150"><a href="#cb385-8150" aria-hidden="true" tabindex="-1"></a><span class="in">temps_JDays &lt;-</span></span>
<span id="cb385-8151"><a href="#cb385-8151" aria-hidden="true" tabindex="-1"></a><span class="in">  make_JDay(temperature)</span></span>
<span id="cb385-8152"><a href="#cb385-8152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8153"><a href="#cb385-8153" aria-hidden="true" tabindex="-1"></a><span class="in">corr_temp_pheno &lt;- function(start_JDay, # the start JDay of the period</span></span>
<span id="cb385-8154"><a href="#cb385-8154" aria-hidden="true" tabindex="-1"></a><span class="in">                            end_JDay, # the start JDay of the period</span></span>
<span id="cb385-8155"><a href="#cb385-8155" aria-hidden="true" tabindex="-1"></a><span class="in">                            temps_JDay = temps_JDays, # the temperature dataset</span></span>
<span id="cb385-8156"><a href="#cb385-8156" aria-hidden="true" tabindex="-1"></a><span class="in">                            bloom = Alex_first) # a data.frame with bloom dates</span></span>
<span id="cb385-8157"><a href="#cb385-8157" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb385-8158"><a href="#cb385-8158" aria-hidden="true" tabindex="-1"></a><span class="in">  temps_JDay &lt;- temps_JDay %&gt;%</span></span>
<span id="cb385-8159"><a href="#cb385-8159" aria-hidden="true" tabindex="-1"></a><span class="in">    mutate(Season = Year) # Add a season column, with years data at first</span></span>
<span id="cb385-8160"><a href="#cb385-8160" aria-hidden="true" tabindex="-1"></a><span class="in"> </span></span>
<span id="cb385-8161"><a href="#cb385-8161" aria-hidden="true" tabindex="-1"></a><span class="in">  # Change the year in "season" column to next year (by + 1) if start JDay is</span></span>
<span id="cb385-8162"><a href="#cb385-8162" aria-hidden="true" tabindex="-1"></a><span class="in">  # greater than end JDay (start later in the year, end in early next year)</span></span>
<span id="cb385-8163"><a href="#cb385-8163" aria-hidden="true" tabindex="-1"></a><span class="in">  if(start_JDay &gt; end_JDay) # select all rows where JDay is &gt;= start_JDay</span></span>
<span id="cb385-8164"><a href="#cb385-8164" aria-hidden="true" tabindex="-1"></a><span class="in">    temps_JDay$Season[temps_JDay$JDay &gt;= start_JDay]&lt;-</span></span>
<span id="cb385-8165"><a href="#cb385-8165" aria-hidden="true" tabindex="-1"></a><span class="in">      temps_JDay$Year[temps_JDay$JDay &gt;= start_JDay]+1</span></span>
<span id="cb385-8166"><a href="#cb385-8166" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-8167"><a href="#cb385-8167" aria-hidden="true" tabindex="-1"></a><span class="in">  # Subset data include the JDay across year boundary, if start &gt; end</span></span>
<span id="cb385-8168"><a href="#cb385-8168" aria-hidden="true" tabindex="-1"></a><span class="in">  if(start_JDay &gt; end_JDay)</span></span>
<span id="cb385-8169"><a href="#cb385-8169" aria-hidden="true" tabindex="-1"></a><span class="in">    sub_temps &lt;- subset(temps_JDay,</span></span>
<span id="cb385-8170"><a href="#cb385-8170" aria-hidden="true" tabindex="-1"></a><span class="in">                        JDay &lt;= end_JDay | JDay &gt;= start_JDay)</span></span>
<span id="cb385-8171"><a href="#cb385-8171" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-8172"><a href="#cb385-8172" aria-hidden="true" tabindex="-1"></a><span class="in">  # If start &lt;= end, then take all days normally</span></span>
<span id="cb385-8173"><a href="#cb385-8173" aria-hidden="true" tabindex="-1"></a><span class="in">  if(start_JDay &lt;= end_JDay) </span></span>
<span id="cb385-8174"><a href="#cb385-8174" aria-hidden="true" tabindex="-1"></a><span class="in">    sub_temps &lt;- subset(temps_JDay,</span></span>
<span id="cb385-8175"><a href="#cb385-8175" aria-hidden="true" tabindex="-1"></a><span class="in">                        JDay &lt;= end_JDay &amp; JDay &gt;= start_JDay)</span></span>
<span id="cb385-8176"><a href="#cb385-8176" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-8177"><a href="#cb385-8177" aria-hidden="true" tabindex="-1"></a><span class="in">  # Add mean_temps column</span></span>
<span id="cb385-8178"><a href="#cb385-8178" aria-hidden="true" tabindex="-1"></a><span class="in">  mean_temps &lt;- sub_temps %&gt;%</span></span>
<span id="cb385-8179"><a href="#cb385-8179" aria-hidden="true" tabindex="-1"></a><span class="in">    group_by(Season) %&gt;%</span></span>
<span id="cb385-8180"><a href="#cb385-8180" aria-hidden="true" tabindex="-1"></a><span class="in">    summarise(Tmin = mean(Tmin), # summarize sum all Tmin rows by year</span></span>
<span id="cb385-8181"><a href="#cb385-8181" aria-hidden="true" tabindex="-1"></a><span class="in">              Tmax = mean(Tmax)) %&gt;% # here summarize applies to each column separately</span></span>
<span id="cb385-8182"><a href="#cb385-8182" aria-hidden="true" tabindex="-1"></a><span class="in">    mutate(Tmean = (Tmin + Tmax)/2)</span></span>
<span id="cb385-8183"><a href="#cb385-8183" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-8184"><a href="#cb385-8184" aria-hidden="true" tabindex="-1"></a><span class="in">  # Change first column name to Pheno_year (to merge with Pheno_year in bloom)</span></span>
<span id="cb385-8185"><a href="#cb385-8185" aria-hidden="true" tabindex="-1"></a><span class="in">  colnames(mean_temps)[1] &lt;- c("Pheno_year") # season to Pheno_year?</span></span>
<span id="cb385-8186"><a href="#cb385-8186" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-8187"><a href="#cb385-8187" aria-hidden="true" tabindex="-1"></a><span class="in">  # Merge Pheno_year from bloom and mean_temps, only keeping matching years</span></span>
<span id="cb385-8188"><a href="#cb385-8188" aria-hidden="true" tabindex="-1"></a><span class="in">  # Add JDay only for those matched years</span></span>
<span id="cb385-8189"><a href="#cb385-8189" aria-hidden="true" tabindex="-1"></a><span class="in">  # So, this will take temp values for years with bloom data?</span></span>
<span id="cb385-8190"><a href="#cb385-8190" aria-hidden="true" tabindex="-1"></a><span class="in">  temps_bloom &lt;- merge(mean_temps,</span></span>
<span id="cb385-8191"><a href="#cb385-8191" aria-hidden="true" tabindex="-1"></a><span class="in">                       bloom[c("Pheno_year",</span></span>
<span id="cb385-8192"><a href="#cb385-8192" aria-hidden="true" tabindex="-1"></a><span class="in">                               "JDay")])</span></span>
<span id="cb385-8193"><a href="#cb385-8193" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-8194"><a href="#cb385-8194" aria-hidden="true" tabindex="-1"></a><span class="in">  # Let's just extract the slopes of the regression model for now</span></span>
<span id="cb385-8195"><a href="#cb385-8195" aria-hidden="true" tabindex="-1"></a><span class="in">  slope_Tmin &lt;- summary(lm(temps_bloom$JDay~temps_bloom$Tmin))$coefficients[2,1]</span></span>
<span id="cb385-8196"><a href="#cb385-8196" aria-hidden="true" tabindex="-1"></a><span class="in">  slope_Tmean &lt;- summary(lm(temps_bloom$JDay~temps_bloom$Tmean))$coefficients[2,1]</span></span>
<span id="cb385-8197"><a href="#cb385-8197" aria-hidden="true" tabindex="-1"></a><span class="in">  slope_Tmax &lt;- summary(lm(temps_bloom$JDay~temps_bloom$Tmax))$coefficients[2,1]</span></span>
<span id="cb385-8198"><a href="#cb385-8198" aria-hidden="true" tabindex="-1"></a><span class="in"> </span></span>
<span id="cb385-8199"><a href="#cb385-8199" aria-hidden="true" tabindex="-1"></a><span class="in">  # Name the returned values, so we don't need to call the value by its position </span></span>
<span id="cb385-8200"><a href="#cb385-8200" aria-hidden="true" tabindex="-1"></a><span class="in">  c(start_JDay = start_JDay,</span></span>
<span id="cb385-8201"><a href="#cb385-8201" aria-hidden="true" tabindex="-1"></a><span class="in">    end_JDay = end_JDay, # length count how many JDays in the sub_temps</span></span>
<span id="cb385-8202"><a href="#cb385-8202" aria-hidden="true" tabindex="-1"></a><span class="in">    length = length(unique(sub_temps$JDay)), # unique removes duplicate values</span></span>
<span id="cb385-8203"><a href="#cb385-8203" aria-hidden="true" tabindex="-1"></a><span class="in">    slope_Tmin = slope_Tmin,</span></span>
<span id="cb385-8204"><a href="#cb385-8204" aria-hidden="true" tabindex="-1"></a><span class="in">    slope_Tmean = slope_Tmean,</span></span>
<span id="cb385-8205"><a href="#cb385-8205" aria-hidden="true" tabindex="-1"></a><span class="in">    slope_Tmax = slope_Tmax)</span></span>
<span id="cb385-8206"><a href="#cb385-8206" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-8207"><a href="#cb385-8207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8208"><a href="#cb385-8208" aria-hidden="true" tabindex="-1"></a><span class="in">corr_temp_pheno(start_JDay = 305, # 01-11-58</span></span>
<span id="cb385-8209"><a href="#cb385-8209" aria-hidden="true" tabindex="-1"></a><span class="in">                end_JDay = 29, # 29-01-59</span></span>
<span id="cb385-8210"><a href="#cb385-8210" aria-hidden="true" tabindex="-1"></a><span class="in">                temps_JDay = temps_JDays,</span></span>
<span id="cb385-8211"><a href="#cb385-8211" aria-hidden="true" tabindex="-1"></a><span class="in">                bloom = Alex_first)</span></span>
<span id="cb385-8212"><a href="#cb385-8212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8213"><a href="#cb385-8213" aria-hidden="true" tabindex="-1"></a><span class="in">corr_temp_pheno(start_JDay = 305, # 01-11-58</span></span>
<span id="cb385-8214"><a href="#cb385-8214" aria-hidden="true" tabindex="-1"></a><span class="in">                end_JDay = 45, # 14-02-59</span></span>
<span id="cb385-8215"><a href="#cb385-8215" aria-hidden="true" tabindex="-1"></a><span class="in">                temps_JDay = temps_JDays,</span></span>
<span id="cb385-8216"><a href="#cb385-8216" aria-hidden="true" tabindex="-1"></a><span class="in">                bloom = Alex_first)</span></span>
<span id="cb385-8217"><a href="#cb385-8217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8218"><a href="#cb385-8218" aria-hidden="true" tabindex="-1"></a><span class="in"># Now we can apply this function to all combinations of days we we find </span></span>
<span id="cb385-8219"><a href="#cb385-8219" aria-hidden="true" tabindex="-1"></a><span class="in"># reasonable. Rather than trying all possible values, I’ll only use every 10th </span></span>
<span id="cb385-8220"><a href="#cb385-8220" aria-hidden="true" tabindex="-1"></a><span class="in"># possible start and end date.</span></span>
<span id="cb385-8221"><a href="#cb385-8221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8222"><a href="#cb385-8222" aria-hidden="true" tabindex="-1"></a><span class="in"># library(colorRamps) # for the color scheme we'll use in the plot</span></span>
<span id="cb385-8223"><a href="#cb385-8223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8224"><a href="#cb385-8224" aria-hidden="true" tabindex="-1"></a><span class="in">stJDs &lt;- seq(from = 1,</span></span>
<span id="cb385-8225"><a href="#cb385-8225" aria-hidden="true" tabindex="-1"></a><span class="in">             to = 366,</span></span>
<span id="cb385-8226"><a href="#cb385-8226" aria-hidden="true" tabindex="-1"></a><span class="in">             by = 10) </span></span>
<span id="cb385-8227"><a href="#cb385-8227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8228"><a href="#cb385-8228" aria-hidden="true" tabindex="-1"></a><span class="in">eJDs &lt;- seq(from = 1,</span></span>
<span id="cb385-8229"><a href="#cb385-8229" aria-hidden="true" tabindex="-1"></a><span class="in">            to = 366,</span></span>
<span id="cb385-8230"><a href="#cb385-8230" aria-hidden="true" tabindex="-1"></a><span class="in">            by = 10)</span></span>
<span id="cb385-8231"><a href="#cb385-8231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8232"><a href="#cb385-8232" aria-hidden="true" tabindex="-1"></a><span class="in"># Nested loop that run every values in eJDs for each value in stJDs</span></span>
<span id="cb385-8233"><a href="#cb385-8233" aria-hidden="true" tabindex="-1"></a><span class="in">for(stJD in stJDs)</span></span>
<span id="cb385-8234"><a href="#cb385-8234" aria-hidden="true" tabindex="-1"></a><span class="in">  for(eJD in eJDs)</span></span>
<span id="cb385-8235"><a href="#cb385-8235" aria-hidden="true" tabindex="-1"></a><span class="in">    {correlations &lt;- corr_temp_pheno(stJD,</span></span>
<span id="cb385-8236"><a href="#cb385-8236" aria-hidden="true" tabindex="-1"></a><span class="in">                                     eJD)</span></span>
<span id="cb385-8237"><a href="#cb385-8237" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb385-8238"><a href="#cb385-8238" aria-hidden="true" tabindex="-1"></a><span class="in">    if(stJD == 1 &amp; eJD == 1) # check if it is the first combination (first values)</span></span>
<span id="cb385-8239"><a href="#cb385-8239" aria-hidden="true" tabindex="-1"></a><span class="in">      corrs &lt;- correlations else</span></span>
<span id="cb385-8240"><a href="#cb385-8240" aria-hidden="true" tabindex="-1"></a><span class="in">        corrs &lt;- rbind(corrs, correlations)</span></span>
<span id="cb385-8241"><a href="#cb385-8241" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-8242"><a href="#cb385-8242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8243"><a href="#cb385-8243" aria-hidden="true" tabindex="-1"></a><span class="in"># Prepare data for ggplot</span></span>
<span id="cb385-8244"><a href="#cb385-8244" aria-hidden="true" tabindex="-1"></a><span class="in">slopes &lt;- as.data.frame(corrs) %&gt;%</span></span>
<span id="cb385-8245"><a href="#cb385-8245" aria-hidden="true" tabindex="-1"></a><span class="in">  rename(Tmin = slope_Tmin,</span></span>
<span id="cb385-8246"><a href="#cb385-8246" aria-hidden="true" tabindex="-1"></a><span class="in">         Tmax = slope_Tmax,</span></span>
<span id="cb385-8247"><a href="#cb385-8247" aria-hidden="true" tabindex="-1"></a><span class="in">         Tmean = slope_Tmean) %&gt;%</span></span>
<span id="cb385-8248"><a href="#cb385-8248" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_longer(cols = c(Tmin : Tmax),</span></span>
<span id="cb385-8249"><a href="#cb385-8249" aria-hidden="true" tabindex="-1"></a><span class="in">               values_to = "Slope",</span></span>
<span id="cb385-8250"><a href="#cb385-8250" aria-hidden="true" tabindex="-1"></a><span class="in">               names_to = "Variable")</span></span>
<span id="cb385-8251"><a href="#cb385-8251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8252"><a href="#cb385-8252" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = slopes,</span></span>
<span id="cb385-8253"><a href="#cb385-8253" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(x = start_JDay,</span></span>
<span id="cb385-8254"><a href="#cb385-8254" aria-hidden="true" tabindex="-1"></a><span class="in">           y = length,</span></span>
<span id="cb385-8255"><a href="#cb385-8255" aria-hidden="true" tabindex="-1"></a><span class="in">           fill = Slope)) +</span></span>
<span id="cb385-8256"><a href="#cb385-8256" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_tile() +</span></span>
<span id="cb385-8257"><a href="#cb385-8257" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(Variable)) +</span></span>
<span id="cb385-8258"><a href="#cb385-8258" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_gradientn(colours = matlab.like(15)) +</span></span>
<span id="cb385-8259"><a href="#cb385-8259" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Interval duration (days)") + </span></span>
<span id="cb385-8260"><a href="#cb385-8260" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Start date of temperature summary interval (Day of year)") +</span></span>
<span id="cb385-8261"><a href="#cb385-8261" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15)</span></span>
<span id="cb385-8262"><a href="#cb385-8262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8263"><a href="#cb385-8263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-8264"><a href="#cb385-8264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8265"><a href="#cb385-8265" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>While this plot can give us an idea about the periods during which temperatures are strongly related to bloom dates, we’ve actually veered slightly off track again.</span>
<span id="cb385-8266"><a href="#cb385-8266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8267"><a href="#cb385-8267" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>First, if we now went for the strongest possible influence and declared this as the main driver of bloom dates, we’d be p-hacking again. More importantly, we’re again looking for something that’s a bit different from what we should actually expect based on our ecological knowledge.</span>
<span id="cb385-8268"><a href="#cb385-8268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8269"><a href="#cb385-8269" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We learned earlier that bloom dates are determined by two separate temperature-dependent processes: chilling and forcing. So we need more than one temperature period! We could now expand our p-hacking exercise to include multiple temperature summary variables. We could then also apply multiple regression, which can automatically identify variables that are correlated with bloom dates.</span>
<span id="cb385-8270"><a href="#cb385-8270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8271"><a href="#cb385-8271" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Such fishing for correlations is a tedious and unsatisfying exercise, and it wouldn’t seem particularly enlightened. It’s likely to lead to overfits, and it can easily miss important temperature response periods by narrowing in on the phases that are most strongly correlated to the outcome variable. So let’s not do this and instead take a step back again to think about the theory. Here’s what we should actually expect:</span>
<span id="cb385-8272"><a href="#cb385-8272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8273"><a href="#cb385-8273" aria-hidden="true" tabindex="-1"></a><span class="al">![](./pic/ch20_1.png)</span></span>
<span id="cb385-8274"><a href="#cb385-8274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8275"><a href="#cb385-8275" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We could now start developing equations that describe what we think we know about chilling and forcing, and then fitted these equations to observed phenology data<span class="dv">&amp;mdash;</span> most of the chill models we compared in the last lesson come from such exercises.</span>
<span id="cb385-8276"><a href="#cb385-8276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8277"><a href="#cb385-8277" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Some of these are clearly way off the mark<span class="dv">&amp;mdash;</span> and I assume the phenology models they were a part of still did pretty well. This is possible, because most phenology models have quite a few parameters, e.g. the start and end dates of chilling and forcing periods, the chilling and forcing requirements and the specifications of the temperature response curves during both phases. It’s easy for these parameters to compensate for each other, so that we get the right result for the wrong reasons. Such models have also often been fitted through trial and error or through less-than-convincing machine learning algorithms.</span>
<span id="cb385-8278"><a href="#cb385-8278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8279"><a href="#cb385-8279" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In the next lesson, we’ll combine our ecological knowledge with a machine learning technique to figure out when trees are responsive to temperature.</span>
<span id="cb385-8280"><a href="#cb385-8280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8281"><a href="#cb385-8281" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8282"><a href="#cb385-8282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8283"><a href="#cb385-8283" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;20.7&lt;/span&gt;&amp;nbsp; Exercises on simple phenology analysis</span></span>
<span id="cb385-8284"><a href="#cb385-8284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8285"><a href="#cb385-8285" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-8286"><a href="#cb385-8286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8287"><a href="#cb385-8287" aria-hidden="true" tabindex="-1"></a>***1. Provide a brief narrative describing what p-hacking is, and why this is a problematic approach to data analysis.***</span>
<span id="cb385-8288"><a href="#cb385-8288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8289"><a href="#cb385-8289" aria-hidden="true" tabindex="-1"></a>P-hacking, a practice known as a fishing expedition, is to purposely look for any significant correlations in large datasets which contain many variables. These dataset are large enough and variables are diverse enough that some correlations are bound to be observed among variables, even if there are no actual causal relationships. In the words of <span class="co">[</span><span class="ot">Simonsohn</span><span class="co">](https://www.nature.com/articles/506150a)</span>, "p-hacking is trying multiple things until you get a desired result." This is particularly problematic because p-hacking results in findings that are not replicable (false positives)<span class="dv">&amp;mdash;</span> meaningless discoveries that amount to nothing but a waste of resource and time. </span>
<span id="cb385-8290"><a href="#cb385-8290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8291"><a href="#cb385-8291" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8292"><a href="#cb385-8292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8293"><a href="#cb385-8293" aria-hidden="true" tabindex="-1"></a>***2. Provide a sketch of your causal understanding of the relationship between temperature and bloom dates.***</span>
<span id="cb385-8294"><a href="#cb385-8294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8295"><a href="#cb385-8295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8296"><a href="#cb385-8296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8297"><a href="#cb385-8297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8298"><a href="#cb385-8298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8299"><a href="#cb385-8299" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8300"><a href="#cb385-8300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8301"><a href="#cb385-8301" aria-hidden="true" tabindex="-1"></a>***3. What do we need to know to build a process-based model from this?***</span>
<span id="cb385-8302"><a href="#cb385-8302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8303"><a href="#cb385-8303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8304"><a href="#cb385-8304" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8305"><a href="#cb385-8305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8306"><a href="#cb385-8306" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 21: Delineating temperature response phases with PLS regression</span></span>
<span id="cb385-8307"><a href="#cb385-8307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8308"><a href="#cb385-8308" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;21.1&lt;/span&gt;&amp;nbsp; Detecting temperature response phases</span></span>
<span id="cb385-8309"><a href="#cb385-8309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8310"><a href="#cb385-8310" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-8311"><a href="#cb385-8311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8312"><a href="#cb385-8312" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Spring phenology responds to exposure to chilling temperatures over a considerable period, during which the precise timing of this exposure is probably not important. </span>
<span id="cb385-8313"><a href="#cb385-8313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8314"><a href="#cb385-8314" aria-hidden="true" tabindex="-1"></a><span class="ss">-  </span>The same applies to heat. We thus shouldn’t expect temperature during a single well-defined period to explain much of the observed variation in bloom or leafing dates.</span>
<span id="cb385-8315"><a href="#cb385-8315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8316"><a href="#cb385-8316" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It seems more likely that temperatures during longer periods have an effect, possibly with varying levels of effectiveness. Methods that either fully consider temperatures during particular intervals or completely discard them are then not very promising.</span>
<span id="cb385-8317"><a href="#cb385-8317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8318"><a href="#cb385-8318" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Another major problem is that we may have high-resolution temperature data, e.g. at daily or even hourly resolution, but we may not have a good way of correlating this to observed phenology. Statistically, this is because we are relating a small number of dependent variables<span class="dv">&amp;mdash;</span>e.g. bloom dates, for which we usually just have one value per year<span class="dv">&amp;mdash;</span>with a large number of independent variables - temperatures on each day, or during each hour, of the dormant season. Ordinary regression procedures don’t do well in such settings.</span>
<span id="cb385-8319"><a href="#cb385-8319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8320"><a href="#cb385-8320" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Wanting to explain relatively few observations with lots of independent variables is actually a pretty common challenge, for example in remote sensing, and researchers in several disciplines have found ways of dealing with it.</span>
<span id="cb385-8321"><a href="#cb385-8321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8322"><a href="#cb385-8322" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8323"><a href="#cb385-8323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8324"><a href="#cb385-8324" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;21.2&lt;/span&gt;&amp;nbsp; Finding signals in hyperspectral remote sensing data</span></span>
<span id="cb385-8325"><a href="#cb385-8325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8326"><a href="#cb385-8326" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-8327"><a href="#cb385-8327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8328"><a href="#cb385-8328" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Hyperspectral data often contain spectral reflectance (or absorption) data for radiation at hundreds (even thousands) of spectral wavelengths. Such spectra are then related to properties of particular materials.</span>
<span id="cb385-8329"><a href="#cb385-8329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8330"><a href="#cb385-8330" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In the case of detecting spider mite damage in peaches in California, we had scored mite damage on 1132 peach leaves, for which we also collected reflectance spectra at wavelengths between 350 and 2500 nm  (<span class="co">[</span><span class="ot">Luedeling et al., 2009c</span><span class="co">](https://www.sciencedirect.com/science/article/pii/S0303243409000221)</span>).</span>
<span id="cb385-8331"><a href="#cb385-8331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8332"><a href="#cb385-8332" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The following image shows two distinct reflectance profiles that represent healthy (0% damage) and heavily affected (90% damage) leaves. As you can see, the healthy leaves reflected less light at wavelengths around 500 nm and more light in a wide region around 1000 nm. We can easily see that here, but there are also mathematical procedures for detecting the signals caused by a particular property of the material (in this case mite damage).</span>
<span id="cb385-8333"><a href="#cb385-8333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8334"><a href="#cb385-8334" aria-hidden="true" tabindex="-1"></a><span class="al">![***Spectral reflectance profiles of all healthy and all heavily mite-affected peach leaves and canopies (0% and 90% of the leaf area damaged for the leaf dataset, and damage classes 0–1 and 4–5 for the canopies). The gray areas around the curves indicate ± one standard error of the mean. Left: Hyperspectral reflectance spectra of healthy (0% damage) and highly mite-affected (90% damage) peach leaves in California. The lines show the averages, the shading illustrates the standard error of the mean (Luedeling et al., 2009c)***](./pic/ch21_1.jpg)</span></span>
<span id="cb385-8335"><a href="#cb385-8335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8336"><a href="#cb385-8336" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8337"><a href="#cb385-8337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8338"><a href="#cb385-8338" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To identify significant wavelengths, we should not look at this as a regression exercise, but rather address the situation as a signal detection problem. There is a lot of noise in such datasets, and we’re looking for the signal that is produced by the property we’re trying to measure.</span>
<span id="cb385-8339"><a href="#cb385-8339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8340"><a href="#cb385-8340" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There are a number of methods to detect signals, and the blossoming machine learning literature keeps producing new ones. The method I adopted back then is Projection-to-Latent-Structures (PLS) regression, also known as Partial Least Squares regression.</span>
<span id="cb385-8341"><a href="#cb385-8341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8342"><a href="#cb385-8342" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In principle, the method identifies latent structures, a sort of principal components, that best describe the variation in the dataset. These latent structures are then used in a regression procedure.</span>
<span id="cb385-8343"><a href="#cb385-8343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8344"><a href="#cb385-8344" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This is quite effective in identifying signals in noisy datasets, and it works in situations where we have lots of independent variables and just one dependent variable, for which we don’t necessarily need a lot of observations. Here are the PLS results for the peach leaf dataset, relating reflectance to mite damage:</span>
<span id="cb385-8345"><a href="#cb385-8345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8346"><a href="#cb385-8346" aria-hidden="true" tabindex="-1"></a><span class="al">![***Model coefficients of the Partial Least Squares (PLS) regression between reflectance at all spectral wavelengths analyzed and the numeric mite damage classification for data measured at the leaf (left graph) and canopy (right graph) level. The bold horizontal lines in both graphs indicate the thresholds at 0.8/−0.8, above/below which wavelengths were considered significant. Left: Coefficients of a PLS model relating mite damage to hyperspectral reflectance data. Particularly prominent wavelengths are marked (Luedeling et al., 2009c)***](./pic/ch21_2.jpg)</span></span>
<span id="cb385-8347"><a href="#cb385-8347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8348"><a href="#cb385-8348" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8349"><a href="#cb385-8349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8350"><a href="#cb385-8350" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We can see here that certain wavelengths are particularly strongly correlated with spider mite damage, so it might be possible to construct some sort of mite detection index by concentrating on wavelengths around 365 nm, 497 nm, 687 nm and so forth. Well, in this case that didn’t work so well. Except for cases of extreme damage, we didn’t really manage to detect mites. </span>
<span id="cb385-8351"><a href="#cb385-8351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8352"><a href="#cb385-8352" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The general statistical situation here is quite similar to the situation we’re facing when trying to relate high-resolution temperature to tree phenology. We have one dependent variable, just a few observations and lots of independent variables. </span>
<span id="cb385-8353"><a href="#cb385-8353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8354"><a href="#cb385-8354" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8355"><a href="#cb385-8355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8356"><a href="#cb385-8356" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;21.3&lt;/span&gt;&amp;nbsp; PLS regression for phenology analysis</span></span>
<span id="cb385-8357"><a href="#cb385-8357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8358"><a href="#cb385-8358" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-8359"><a href="#cb385-8359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8360"><a href="#cb385-8360" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A similar analysis was done with leaf emergence data of the walnut cultivar ‘Payne’ in California (<span class="co">[</span><span class="ot">Luedeling &amp; Gassner, 2012</span><span class="co">](https://www.sciencedirect.com/science/article/pii/S0168192312000561)</span>).</span>
<span id="cb385-8361"><a href="#cb385-8361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8362"><a href="#cb385-8362" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We used PLS regression on a 54-year dataset, from 1953-2007 (with data for 1996 missing), recorded at the University of California at Davis.</span>
<span id="cb385-8363"><a href="#cb385-8363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8364"><a href="#cb385-8364" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We related these leaf emergence dates with mean daily temperature, obtaining the following results:</span>
<span id="cb385-8365"><a href="#cb385-8365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8366"><a href="#cb385-8366" aria-hidden="true" tabindex="-1"></a><span class="al">![***Results of a PLS regression analysis of the relationship between leaf emergence of ‘Payne’ walnuts in Davis, California, and daily mean temperature during the dormant season (Luedeling et al., 2012). Comparison of different temporal resolutions of the independent input data (temperature) to the PLS analysis with leaf emergence dates of the walnut cultivar Payne. The top two panels show variable-importance-plot (VIP) and model coefficients of the centered and scaled data (MC) for daily temperature data as independent input; the middle two panels show VIP and MC for an 11-day running mean of temperature as input; and the bottom two panels show the analysis for monthly means of temperature data as independent variables.***](./pic/ch21_3.jpg)</span></span>
<span id="cb385-8367"><a href="#cb385-8367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8368"><a href="#cb385-8368" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8369"><a href="#cb385-8369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8370"><a href="#cb385-8370" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This figure shows three versions of the analysis. In the analysis that produced the topmost set of figures, unprocessed daily mean temperatures were related to phenology dates. The results looked a little fuzzy, so I also ran the analysis with an 11-day running mean of temperatures (middle) and also with monthly data (bottom).</span>
<span id="cb385-8371"><a href="#cb385-8371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8372"><a href="#cb385-8372" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Each set of plots contains illustrations of two results: the model coefficients, which are comparable to the coefficients of a normal regression model, and the ‘variable importance in the projection’ score (VIP), which indicates how important the contribution of each daily temperature is for the overall regression model. This is often interpreted as a sort of ‘significance’, which is decided on by using a cut-off threshold (often 0.8).</span>
<span id="cb385-8373"><a href="#cb385-8373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8374"><a href="#cb385-8374" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Basically, the model coefficients illustrate how leaf emergence dates are affected by particularly warm or cool conditions on a certain day. Positive model coefficients indicate a positive relationship between (Julian) leaf emergence dates and temperature, i.e. warmer than usual temperatures are correlated with later than usual leaf emergence dates. Conversely, negative model coefficients indicate a negative correlation, i.e. warm temperatures are related to early spring phenology.</span>
<span id="cb385-8375"><a href="#cb385-8375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8376"><a href="#cb385-8376" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When we relate the emerging pattern of model coefficients to our understanding of the dormancy process, we can detect two distinct phases here.</span>
<span id="cb385-8377"><a href="#cb385-8377" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-8378"><a href="#cb385-8378" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Between early November and mid-January, we see a period with positive model coefficients (and high VIP scores), i.e. warm conditions during this period are related to delayed leaf emergence in spring. This is consistent with what we might expect to be happening during the chilling period, when warm conditions might delay the fulfillment of chilling requirements, which would in turn delay all subsequent development.</span>
<span id="cb385-8379"><a href="#cb385-8379" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-8380"><a href="#cb385-8380" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Following this period of positive model coefficients, we see a phase with negative coefficients between mid-January and (about) the end of March. Such coefficients are consistent with our expectation for the forcing phase, when warm temperatures would accelerate heat accumulation and thus advance leaf emergence.</span>
<span id="cb385-8381"><a href="#cb385-8381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8382"><a href="#cb385-8382" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>After early to mid-April, we see an inconsistent pattern. Given that leaf emergence happens in March to very early April, this is not surprising. Temperatures after this time cannot possibly affect budbreak dates. We also see that temperature response patterns before November are inconsistent. This may indicate that no chill accumulates before the end of October.</span>
<span id="cb385-8383"><a href="#cb385-8383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8384"><a href="#cb385-8384" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We found quite similar patterns for the cultivars ‘Chandler’ and ‘Franquette’:</span>
<span id="cb385-8385"><a href="#cb385-8385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8386"><a href="#cb385-8386" aria-hidden="true" tabindex="-1"></a><span class="al">![***VIP scores and model coefficients of PLS models relating leaf emergence dates of the walnut cultivars ‘Payne’, ‘Chandler’ and ‘Franquette’ in Davis, California, with mean daily temperatures (Luedeling et al., 2012). Results of the PLS analysis for the phenological stage of leaf emergence for the walnut cultivars Payne, Chandler and Franquette, with 11-day running means of daily mean temperatures as independent input variables. The three top panels show variable-importance plots for each cultivar, whereas the bottom three panels display the model coefficients of the centered and scaled data.***](./pic/ch21_4.jpg)</span></span>
<span id="cb385-8387"><a href="#cb385-8387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8388"><a href="#cb385-8388" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8389"><a href="#cb385-8389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8390"><a href="#cb385-8390" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The model coefficient patterns are a bit less clear here, including brief interruptions of the chilling period for the two other cultivars and lots of variation in heat and chilling responses. What does this mean?</span>
<span id="cb385-8391"><a href="#cb385-8391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8392"><a href="#cb385-8392" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8393"><a href="#cb385-8393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8394"><a href="#cb385-8394" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;21.4&lt;/span&gt;&amp;nbsp; A note of caution about PLS results</span></span>
<span id="cb385-8395"><a href="#cb385-8395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8396"><a href="#cb385-8396" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-8397"><a href="#cb385-8397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8398"><a href="#cb385-8398" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>PLS is a data mining technique that is usually used with a lot larger datasets than what we have here. </span>
<span id="cb385-8399"><a href="#cb385-8399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8400"><a href="#cb385-8400" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Remember that in the spider mite example, we had over 1000 leaf samples. The method also works with less data, but we should not expect results to be crystal-clear then. It is thus very important that we don’t overinterpret every little feature of the plots that emerges.</span>
<span id="cb385-8401"><a href="#cb385-8401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8402"><a href="#cb385-8402" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In fact, when we’re dealing with datasets as small as the ones we usually encounter in phenology analysis, I would strongly advise against using PLS as a data-mining tool, i.e. to detect patterns in the data.</span>
<span id="cb385-8403"><a href="#cb385-8403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8404"><a href="#cb385-8404" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This tool should only be used in conjunction with a theory about how the system works. With this, we can use the PLS results to support or possibly refute certain ideas.</span>
<span id="cb385-8405"><a href="#cb385-8405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8406"><a href="#cb385-8406" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In our case, we may start with a strong expectation of finding a chilling period (with positive model coefficients), followed by a forcing period (with negative coefficients). Our results are consistent with our theory, so<span class="dv">&amp;mdash;</span>together with this theory<span class="dv">&amp;mdash;</span>the picture that emerges is quite consistent.</span>
<span id="cb385-8407"><a href="#cb385-8407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8408"><a href="#cb385-8408" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>***Important: always keep in mind that we’re using PLS with a very small dataset and we should not place too much emphasis on individual characteristics of the emerging model coefficient patterns,*** (unless of course, we have other reasons to believe they are meaningful, or we find them across many similar analyses).</span>
<span id="cb385-8409"><a href="#cb385-8409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8410"><a href="#cb385-8410" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In this context, it is important that we clarify our expectations *before* we run our analysis. </span>
<span id="cb385-8411"><a href="#cb385-8411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8412"><a href="#cb385-8412" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It’s always possible to interpret random patterns that emerge in some reasonable-sounding way after the fact, but this practice<span class="dv">&amp;mdash;</span>which is also known as *rationalizing*<span class="dv">&amp;mdash;</span>isn’t particularly sound.</span>
<span id="cb385-8413"><a href="#cb385-8413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8414"><a href="#cb385-8414" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8415"><a href="#cb385-8415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8416"><a href="#cb385-8416" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;21.5&lt;/span&gt;&amp;nbsp; PLS analysis of ‘Alexander Lucas’ pears in Klein-Altendorf</span></span>
<span id="cb385-8417"><a href="#cb385-8417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8418"><a href="#cb385-8418" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-8419"><a href="#cb385-8419" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-8420"><a href="#cb385-8420" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now let’s try this analysis for ourselves with the dataset of pears (cultivar ‘Alexander Lucas’).</span>
<span id="cb385-8421"><a href="#cb385-8421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8422"><a href="#cb385-8422" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We’ll start with first bloom, which we first have to convert to Julian dates, and then the temperature data:</span>
<span id="cb385-8423"><a href="#cb385-8423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8424"><a href="#cb385-8424" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 21.5a}</span></span>
<span id="cb385-8425"><a href="#cb385-8425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8426"><a href="#cb385-8426" aria-hidden="true" tabindex="-1"></a><span class="in"># library(chillR)</span></span>
<span id="cb385-8427"><a href="#cb385-8427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8428"><a href="#cb385-8428" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a data.frame with two columns: Year (Pheno_year) and pheno (JDay)</span></span>
<span id="cb385-8429"><a href="#cb385-8429" aria-hidden="true" tabindex="-1"></a><span class="in">Alex_first &lt;- read_tab("data/OT/Alexander_Lucas_bloom_1958_2019.csv") %&gt;%</span></span>
<span id="cb385-8430"><a href="#cb385-8430" aria-hidden="true" tabindex="-1"></a><span class="in">  select(Pheno_year, First_bloom) %&gt;% # select only two columns</span></span>
<span id="cb385-8431"><a href="#cb385-8431" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Year = as.numeric(substr(First_bloom, 1, 4)), # extract year, month,</span></span>
<span id="cb385-8432"><a href="#cb385-8432" aria-hidden="true" tabindex="-1"></a><span class="in">         Month = as.numeric(substr(First_bloom, 5, 6)), # and day from</span></span>
<span id="cb385-8433"><a href="#cb385-8433" aria-hidden="true" tabindex="-1"></a><span class="in">         Day = as.numeric(substr(First_bloom, 7, 8))) %&gt;% # First_bloom date</span></span>
<span id="cb385-8434"><a href="#cb385-8434" aria-hidden="true" tabindex="-1"></a><span class="in">  make_JDay() %&gt;% # add a new JDay column</span></span>
<span id="cb385-8435"><a href="#cb385-8435" aria-hidden="true" tabindex="-1"></a><span class="in">  select(Pheno_year, JDay) %&gt;% # select only year and JDay columns</span></span>
<span id="cb385-8436"><a href="#cb385-8436" aria-hidden="true" tabindex="-1"></a><span class="in">  rename(Year = Pheno_year,</span></span>
<span id="cb385-8437"><a href="#cb385-8437" aria-hidden="true" tabindex="-1"></a><span class="in">         pheno = JDay)</span></span>
<span id="cb385-8438"><a href="#cb385-8438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8439"><a href="#cb385-8439" aria-hidden="true" tabindex="-1"></a><span class="in"># Display head data</span></span>
<span id="cb385-8440"><a href="#cb385-8440" aria-hidden="true" tabindex="-1"></a><span class="in">kable(head(Alex_first)) %&gt;%</span></span>
<span id="cb385-8441"><a href="#cb385-8441" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-8442"><a href="#cb385-8442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8443"><a href="#cb385-8443" aria-hidden="true" tabindex="-1"></a><span class="in"># The PLS function we’ll use is a bit particular about the format of this </span></span>
<span id="cb385-8444"><a href="#cb385-8444" aria-hidden="true" tabindex="-1"></a><span class="in"># data.frame, so I had to adjust the data.frame structure a bit and change </span></span>
<span id="cb385-8445"><a href="#cb385-8445" aria-hidden="true" tabindex="-1"></a><span class="in"># the column names. </span></span>
<span id="cb385-8446"><a href="#cb385-8446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8447"><a href="#cb385-8447" aria-hidden="true" tabindex="-1"></a><span class="in"># Now we need temperature data, which we have also worked with before:</span></span>
<span id="cb385-8448"><a href="#cb385-8448" aria-hidden="true" tabindex="-1"></a><span class="in">KA_temps &lt;- read_tab("data/OT/TMaxTMin1958-2019_patched.csv") %&gt;%</span></span>
<span id="cb385-8449"><a href="#cb385-8449" aria-hidden="true" tabindex="-1"></a><span class="in">  make_JDay()</span></span>
<span id="cb385-8450"><a href="#cb385-8450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8451"><a href="#cb385-8451" aria-hidden="true" tabindex="-1"></a><span class="in">kable(head(KA_temps)) %&gt;%</span></span>
<span id="cb385-8452"><a href="#cb385-8452" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-8453"><a href="#cb385-8453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8454"><a href="#cb385-8454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-8455"><a href="#cb385-8455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8456"><a href="#cb385-8456" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8457"><a href="#cb385-8457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8458"><a href="#cb385-8458" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This <span class="in">`data.frame`</span> can be more complex, but it needs to conform to the typical structure of <span class="in">`chillR`</span> temperature datasets, i.e. it must have columns <span class="in">`Year`</span>, <span class="in">`Month`</span>, <span class="in">`Day`</span>, <span class="in">`Tmin`</span>, <span class="in">`Tmax`</span> and in this case also <span class="in">`JDay`</span>.</span>
<span id="cb385-8459"><a href="#cb385-8459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8460"><a href="#cb385-8460" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>With these two inputs, we can now use the <span class="in">`PLS_pheno`</span> function from the <span class="in">`chillR`</span> package. I note here that this function makes use of the <span class="in">`plsr`</span> package.</span>
<span id="cb385-8461"><a href="#cb385-8461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8462"><a href="#cb385-8462" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The <span class="in">`PLS_pheno`</span> function requires as a minimum just a temperature dataset (<span class="in">`weather_data`</span>) and a phenology dataset (<span class="in">`bio_data`</span>). </span>
<span id="cb385-8463"><a href="#cb385-8463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8464"><a href="#cb385-8464" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The result is a list of three objects: <span class="in">`$object_type`</span><span class="dv">&amp;mdash;</span> just the string ‘PLS_Temp_pheno’, <span class="in">`$pheno`</span><span class="dv">&amp;mdash;</span> the phenology input data, and <span class="in">`$PLS_summary`</span><span class="dv">&amp;mdash;</span> the results we’re interested in.</span>
<span id="cb385-8465"><a href="#cb385-8465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8466"><a href="#cb385-8466" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 21.5b}</span></span>
<span id="cb385-8467"><a href="#cb385-8467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8468"><a href="#cb385-8468" aria-hidden="true" tabindex="-1"></a><span class="in">PLS_results &lt;- PLS_pheno(KA_temps, # weather data</span></span>
<span id="cb385-8469"><a href="#cb385-8469" aria-hidden="true" tabindex="-1"></a><span class="in">                         Alex_first) # bio data</span></span>
<span id="cb385-8470"><a href="#cb385-8470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8471"><a href="#cb385-8471" aria-hidden="true" tabindex="-1"></a><span class="in">kable(head(PLS_results$PLS_summary)) %&gt;%</span></span>
<span id="cb385-8472"><a href="#cb385-8472" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-8473"><a href="#cb385-8473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8474"><a href="#cb385-8474" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-8475"><a href="#cb385-8475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8476"><a href="#cb385-8476" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8477"><a href="#cb385-8477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8478"><a href="#cb385-8478" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This summary object contains 6 columns: </span>
<span id="cb385-8479"><a href="#cb385-8479" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`Date`</span><span class="dv">&amp;mdash;</span> the calendar day coded as <span class="in">`MMDD`</span>, </span>
<span id="cb385-8480"><a href="#cb385-8480" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`JDay`</span><span class="dv">&amp;mdash;</span> the Julian date, </span>
<span id="cb385-8481"><a href="#cb385-8481" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`Coef`</span><span class="dv">&amp;mdash;</span> the PLS model coefficient, </span>
<span id="cb385-8482"><a href="#cb385-8482" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`VIP`</span><span class="dv">&amp;mdash;</span> the variable importance in the projection score, </span>
<span id="cb385-8483"><a href="#cb385-8483" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`Tmean`</span><span class="dv">&amp;mdash;</span> the mean temperature on the respective day, and </span>
<span id="cb385-8484"><a href="#cb385-8484" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`Tstdev`</span><span class="dv">&amp;mdash;</span> the standard deviation of temperatures on this day across the whole temperature dataset.</span>
<span id="cb385-8485"><a href="#cb385-8485" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-8486"><a href="#cb385-8486" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-8487"><a href="#cb385-8487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8488"><a href="#cb385-8488" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This <span class="in">`PLS_results`</span> element can now be plotted with the dedicated plotting function <span class="in">`plot_PLS`</span>. Here’s what the results of this would look like:</span>
<span id="cb385-8489"><a href="#cb385-8489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8490"><a href="#cb385-8490" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 21.5c}</span></span>
<span id="cb385-8491"><a href="#cb385-8491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8492"><a href="#cb385-8492" aria-hidden="true" tabindex="-1"></a><span class="in">PLS_output &lt;- PLS_results</span></span>
<span id="cb385-8493"><a href="#cb385-8493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8494"><a href="#cb385-8494" aria-hidden="true" tabindex="-1"></a><span class="in">PLS_results_path&lt;-paste(getwd(),"/data/OT/PLS_output/PLS_output",sep="")</span></span>
<span id="cb385-8495"><a href="#cb385-8495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8496"><a href="#cb385-8496" aria-hidden="true" tabindex="-1"></a><span class="in">plot_PLS(PLS_output,</span></span>
<span id="cb385-8497"><a href="#cb385-8497" aria-hidden="true" tabindex="-1"></a><span class="in">         PLS_results_path) # this seems to create a new dir path.</span></span>
<span id="cb385-8498"><a href="#cb385-8498" aria-hidden="true" tabindex="-1"></a><span class="in"># so, i get an empty folder every time I run this. And the function doesn't </span></span>
<span id="cb385-8499"><a href="#cb385-8499" aria-hidden="true" tabindex="-1"></a><span class="in"># run if I delete the path. So, I guess I have to live with an empty folder here.</span></span>
<span id="cb385-8500"><a href="#cb385-8500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8501"><a href="#cb385-8501" aria-hidden="true" tabindex="-1"></a><span class="in"># grid.raster(readPNG("data/OT/PLS_output/PLS_output.png")) </span></span>
<span id="cb385-8502"><a href="#cb385-8502" aria-hidden="true" tabindex="-1"></a><span class="in"># grid.text("Temperature response pattern of\n‘Alexander Lucas' pears in Klein-Altendorf", </span></span>
<span id="cb385-8503"><a href="#cb385-8503" aria-hidden="true" tabindex="-1"></a><span class="in">#           x = 0.9, y = 0.15, gp = gpar(fontsize = 10, fontface = "italic"))</span></span>
<span id="cb385-8504"><a href="#cb385-8504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8505"><a href="#cb385-8505" aria-hidden="true" tabindex="-1"></a><span class="in">img &lt;- readPNG("data/OT/PLS_output/PLS_output.png")</span></span>
<span id="cb385-8506"><a href="#cb385-8506" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot() +</span></span>
<span id="cb385-8507"><a href="#cb385-8507" aria-hidden="true" tabindex="-1"></a><span class="in">  annotation_custom(rasterGrob(img, width=unit(1,"npc"), height=unit(1,"npc"))) +</span></span>
<span id="cb385-8508"><a href="#cb385-8508" aria-hidden="true" tabindex="-1"></a><span class="in">  ggtitle("Temperature response pattern of ‘Alexander Lucas' pears in Klein-Altendorf") +</span></span>
<span id="cb385-8509"><a href="#cb385-8509" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_void() +</span></span>
<span id="cb385-8510"><a href="#cb385-8510" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(plot.title = element_text(hjust = 0.5, size = 14, face = "bold"))</span></span>
<span id="cb385-8511"><a href="#cb385-8511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8512"><a href="#cb385-8512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8513"><a href="#cb385-8513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8514"><a href="#cb385-8514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8515"><a href="#cb385-8515" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-8516"><a href="#cb385-8516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8517"><a href="#cb385-8517" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8518"><a href="#cb385-8518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8519"><a href="#cb385-8519" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We have the VIP plot on top, with ‘important’ days highlighted in blue. In the second row, we have the model coefficients, with data for all the days identified as ‘important’ shown in red (when negative) or green (when positive). </span>
<span id="cb385-8520"><a href="#cb385-8520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8521"><a href="#cb385-8521" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In the bottom row, we see the temperature dynamics during this time, with the mean temperature across all years shown by the black line, and the standard deviation indicated by the shading, which uses the same color scheme as the model coefficient plot. </span>
<span id="cb385-8522"><a href="#cb385-8522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8523"><a href="#cb385-8523" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The gray shading at the left end of the plot shows the full range of observed bloom dates, with the dashed line indicating the mean bloom date.</span>
<span id="cb385-8524"><a href="#cb385-8524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8525"><a href="#cb385-8525" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Before we reproduce this using ggplot, let’s look at the parameters of the PLS_pheno function.</span>
<span id="cb385-8526"><a href="#cb385-8526" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`split_month`</span><span class="dv">&amp;mdash;</span> the <span class="in">`PLS_pheno`</span> function uses temperature data for an entire year, but we can decide when to start this year. The default is 7, which means that the phenological year ends at the end of July.</span>
<span id="cb385-8527"><a href="#cb385-8527" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`runn_mean`</span><span class="dv">&amp;mdash;</span> the running mean to be applied to the temperature data before the analysis. We can set this to 1, but then we get a fairly messy temperature response pattern. The default is 11, which has usually worked pretty well.</span>
<span id="cb385-8528"><a href="#cb385-8528" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`end_at_pheno_end`</span><span class="dv">&amp;mdash;</span> if this is set to <span class="in">`TRUE`</span> (the default), then temperatures after the latest <span class="in">`JDay`</span> of the phenology dataset aren’t considered in the analysis.</span>
<span id="cb385-8529"><a href="#cb385-8529" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`use_Tmean`</span><span class="dv">&amp;mdash;</span> this can be set to <span class="in">`TRUE`</span>, if your temperature dataset has a <span class="in">`Tmean`</span> column and you want to use that rather than calculating means from <span class="in">`Tmin`</span> and <span class="in">`TMax`</span>.</span>
<span id="cb385-8530"><a href="#cb385-8530" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`expl.var`</span>, <span class="in">`ncomp.fix`</span> and <span class="in">`crossvalidate`</span> refer to specifics of the PLS analysis, <span class="in">`return.all`</span> indicates that you also want all the PLS outputs to be returned. Refer to the help function of <span class="in">`PLS_pheno`</span> and possibly to the <span class="in">`plsr`</span> package for more details.</span>
<span id="cb385-8531"><a href="#cb385-8531" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-8532"><a href="#cb385-8532" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb385-8533"><a href="#cb385-8533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8534"><a href="#cb385-8534" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>So now let’s make the same plot in <span class="in">`ggplot`</span>:</span>
<span id="cb385-8535"><a href="#cb385-8535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8536"><a href="#cb385-8536" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 21.5d}</span></span>
<span id="cb385-8537"><a href="#cb385-8537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8538"><a href="#cb385-8538" aria-hidden="true" tabindex="-1"></a><span class="in"># library(ggplot2)</span></span>
<span id="cb385-8539"><a href="#cb385-8539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8540"><a href="#cb385-8540" aria-hidden="true" tabindex="-1"></a><span class="in"># Remove `date` column which shows month and day (eg.801 for August 1) and </span></span>
<span id="cb385-8541"><a href="#cb385-8541" aria-hidden="true" tabindex="-1"></a><span class="in"># add two columns Month and Day</span></span>
<span id="cb385-8542"><a href="#cb385-8542" aria-hidden="true" tabindex="-1"></a><span class="in">PLS_gg &lt;- PLS_results$PLS_summary %&gt;%</span></span>
<span id="cb385-8543"><a href="#cb385-8543" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Month = trunc(Date / 100), # truncate to remove decimal part</span></span>
<span id="cb385-8544"><a href="#cb385-8544" aria-hidden="true" tabindex="-1"></a><span class="in">         Day = Date - Month * 100,</span></span>
<span id="cb385-8545"><a href="#cb385-8545" aria-hidden="true" tabindex="-1"></a><span class="in">         Date = NULL) </span></span>
<span id="cb385-8546"><a href="#cb385-8546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8547"><a href="#cb385-8547" aria-hidden="true" tabindex="-1"></a><span class="in"># Add back Date column with ISO date format (year-month-day-time)</span></span>
<span id="cb385-8548"><a href="#cb385-8548" aria-hidden="true" tabindex="-1"></a><span class="in">PLS_gg$Date &lt;- ISOdate(2002, </span></span>
<span id="cb385-8549"><a href="#cb385-8549" aria-hidden="true" tabindex="-1"></a><span class="in">                       PLS_gg$Month, </span></span>
<span id="cb385-8550"><a href="#cb385-8550" aria-hidden="true" tabindex="-1"></a><span class="in">                       PLS_gg$Day)</span></span>
<span id="cb385-8551"><a href="#cb385-8551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8552"><a href="#cb385-8552" aria-hidden="true" tabindex="-1"></a><span class="in"># For the rows with JDay 0 or lower (negative JDay- refer to previous year)</span></span>
<span id="cb385-8553"><a href="#cb385-8553" aria-hidden="true" tabindex="-1"></a><span class="in"># Change 2002 to 2001- last year, while month and day stay the same</span></span>
<span id="cb385-8554"><a href="#cb385-8554" aria-hidden="true" tabindex="-1"></a><span class="in">PLS_gg$Date[PLS_gg$JDay &lt;= 0] &lt;-</span></span>
<span id="cb385-8555"><a href="#cb385-8555" aria-hidden="true" tabindex="-1"></a><span class="in">  ISOdate(2001, </span></span>
<span id="cb385-8556"><a href="#cb385-8556" aria-hidden="true" tabindex="-1"></a><span class="in">          PLS_gg$Month[PLS_gg$JDay &lt;= 0], </span></span>
<span id="cb385-8557"><a href="#cb385-8557" aria-hidden="true" tabindex="-1"></a><span class="in">          PLS_gg$Day[PLS_gg$JDay &lt;= 0])</span></span>
<span id="cb385-8558"><a href="#cb385-8558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8559"><a href="#cb385-8559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8560"><a href="#cb385-8560" aria-hidden="true" tabindex="-1"></a><span class="in"># sing() function returns a vector with the signs of the corresponding elements </span></span>
<span id="cb385-8561"><a href="#cb385-8561" aria-hidden="true" tabindex="-1"></a><span class="in"># of x (the sign of a real number is 1, 0, or −1 if the number is positive, </span></span>
<span id="cb385-8562"><a href="#cb385-8562" aria-hidden="true" tabindex="-1"></a><span class="in"># zero, or negative, respectively)- so, 1 of Coef is positive, -1 if Coef is</span></span>
<span id="cb385-8563"><a href="#cb385-8563" aria-hidden="true" tabindex="-1"></a><span class="in"># negative and 0 if Coef is zero. So, basically change Coef into a series of </span></span>
<span id="cb385-8564"><a href="#cb385-8564" aria-hidden="true" tabindex="-1"></a><span class="in"># 1, -1 and 0. </span></span>
<span id="cb385-8565"><a href="#cb385-8565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8566"><a href="#cb385-8566" aria-hidden="true" tabindex="-1"></a><span class="in"># VIP_importance is either 1 for TRUE and 0 for FALSE. So, basically only taking</span></span>
<span id="cb385-8567"><a href="#cb385-8567" aria-hidden="true" tabindex="-1"></a><span class="in"># the coef signs for singnificant values. </span></span>
<span id="cb385-8568"><a href="#cb385-8568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8569"><a href="#cb385-8569" aria-hidden="true" tabindex="-1"></a><span class="in"># The function factor is used to encode a vector as a factor (the terms </span></span>
<span id="cb385-8570"><a href="#cb385-8570" aria-hidden="true" tabindex="-1"></a><span class="in"># ‘category’ and ‘enumerated type’ are also used for factors). </span></span>
<span id="cb385-8571"><a href="#cb385-8571" aria-hidden="true" tabindex="-1"></a><span class="in"># Here, factor will make R to treat the 1,-1 and 0 as categorical, rather than</span></span>
<span id="cb385-8572"><a href="#cb385-8572" aria-hidden="true" tabindex="-1"></a><span class="in"># continuous numbers.</span></span>
<span id="cb385-8573"><a href="#cb385-8573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8574"><a href="#cb385-8574" aria-hidden="true" tabindex="-1"></a><span class="in"># Add two new columns: VIP_importance (TRUE/FALSE for cut-off 0.8), VIP_Coeff.</span></span>
<span id="cb385-8575"><a href="#cb385-8575" aria-hidden="true" tabindex="-1"></a><span class="in">PLS_gg &lt;- PLS_gg %&gt;%</span></span>
<span id="cb385-8576"><a href="#cb385-8576" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(VIP_importance = VIP &gt;= 0.8,</span></span>
<span id="cb385-8577"><a href="#cb385-8577" aria-hidden="true" tabindex="-1"></a><span class="in">         VIP_Coeff = factor(sign(Coef) * VIP_importance))</span></span>
<span id="cb385-8578"><a href="#cb385-8578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8579"><a href="#cb385-8579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8580"><a href="#cb385-8580" aria-hidden="true" tabindex="-1"></a><span class="in"># geom_bar()'s default stat is "count"- count the number of data points for x values</span></span>
<span id="cb385-8581"><a href="#cb385-8581" aria-hidden="true" tabindex="-1"></a><span class="in"># here stat is "identity"- The identity statistic leaves the data unchanged.</span></span>
<span id="cb385-8582"><a href="#cb385-8582" aria-hidden="true" tabindex="-1"></a><span class="in"># use the data as it is for plotting height of each bar. </span></span>
<span id="cb385-8583"><a href="#cb385-8583" aria-hidden="true" tabindex="-1"></a><span class="in">VIP_plot&lt;- ggplot(PLS_gg,</span></span>
<span id="cb385-8584"><a href="#cb385-8584" aria-hidden="true" tabindex="-1"></a><span class="in">                  aes(x = Date,y = VIP)) +</span></span>
<span id="cb385-8585"><a href="#cb385-8585" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat = 'identity',</span></span>
<span id="cb385-8586"><a href="#cb385-8586" aria-hidden="true" tabindex="-1"></a><span class="in">           aes(fill = VIP &gt; 0.8))</span></span>
<span id="cb385-8587"><a href="#cb385-8587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8588"><a href="#cb385-8588" aria-hidden="true" tabindex="-1"></a><span class="in">VIP_plot &lt;- VIP_plot +</span></span>
<span id="cb385-8589"><a href="#cb385-8589" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(name="VIP", </span></span>
<span id="cb385-8590"><a href="#cb385-8590" aria-hidden="true" tabindex="-1"></a><span class="in">                    labels = c("&lt;0.8", "&gt;0.8"), </span></span>
<span id="cb385-8591"><a href="#cb385-8591" aria-hidden="true" tabindex="-1"></a><span class="in">                    values = c("FALSE" = "grey", "TRUE" = "blue")) +</span></span>
<span id="cb385-8592"><a href="#cb385-8592" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +</span></span>
<span id="cb385-8593"><a href="#cb385-8593" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.x = element_blank(),</span></span>
<span id="cb385-8594"><a href="#cb385-8594" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.ticks.x = element_blank(),</span></span>
<span id="cb385-8595"><a href="#cb385-8595" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.title.x = element_blank()) # remove x-axis label and title and tick</span></span>
<span id="cb385-8596"><a href="#cb385-8596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8597"><a href="#cb385-8597" aria-hidden="true" tabindex="-1"></a><span class="in">VIP_plot</span></span>
<span id="cb385-8598"><a href="#cb385-8598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8599"><a href="#cb385-8599" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot PLS coefficient</span></span>
<span id="cb385-8600"><a href="#cb385-8600" aria-hidden="true" tabindex="-1"></a><span class="in">coeff_plot &lt;- ggplot(PLS_gg,</span></span>
<span id="cb385-8601"><a href="#cb385-8601" aria-hidden="true" tabindex="-1"></a><span class="in">                     aes(x = Date,</span></span>
<span id="cb385-8602"><a href="#cb385-8602" aria-hidden="true" tabindex="-1"></a><span class="in">                         y = Coef)) +</span></span>
<span id="cb385-8603"><a href="#cb385-8603" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat ='identity',</span></span>
<span id="cb385-8604"><a href="#cb385-8604" aria-hidden="true" tabindex="-1"></a><span class="in">           aes(fill = VIP_Coeff)) +</span></span>
<span id="cb385-8605"><a href="#cb385-8605" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(name = "Effect direction", </span></span>
<span id="cb385-8606"><a href="#cb385-8606" aria-hidden="true" tabindex="-1"></a><span class="in">                    labels = c("Advancing",</span></span>
<span id="cb385-8607"><a href="#cb385-8607" aria-hidden="true" tabindex="-1"></a><span class="in">                               "Unimportant",</span></span>
<span id="cb385-8608"><a href="#cb385-8608" aria-hidden="true" tabindex="-1"></a><span class="in">                               "Delaying"), </span></span>
<span id="cb385-8609"><a href="#cb385-8609" aria-hidden="true" tabindex="-1"></a><span class="in">                    values = c("-1" = "red", </span></span>
<span id="cb385-8610"><a href="#cb385-8610" aria-hidden="true" tabindex="-1"></a><span class="in">                               "0" = "grey",</span></span>
<span id="cb385-8611"><a href="#cb385-8611" aria-hidden="true" tabindex="-1"></a><span class="in">                               "1" = "dark green")) +</span></span>
<span id="cb385-8612"><a href="#cb385-8612" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +</span></span>
<span id="cb385-8613"><a href="#cb385-8613" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("PLS coefficient") +</span></span>
<span id="cb385-8614"><a href="#cb385-8614" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.x = element_blank(),</span></span>
<span id="cb385-8615"><a href="#cb385-8615" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.ticks.x = element_blank(),</span></span>
<span id="cb385-8616"><a href="#cb385-8616" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.title.x = element_blank() )</span></span>
<span id="cb385-8617"><a href="#cb385-8617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8618"><a href="#cb385-8618" aria-hidden="true" tabindex="-1"></a><span class="in">coeff_plot</span></span>
<span id="cb385-8619"><a href="#cb385-8619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8620"><a href="#cb385-8620" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot tempearature</span></span>
<span id="cb385-8621"><a href="#cb385-8621" aria-hidden="true" tabindex="-1"></a><span class="in">temp_plot &lt;- ggplot(PLS_gg) +</span></span>
<span id="cb385-8622"><a href="#cb385-8622" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_ribbon(aes(x = Date,</span></span>
<span id="cb385-8623"><a href="#cb385-8623" aria-hidden="true" tabindex="-1"></a><span class="in">                  ymin = Tmean - Tstdev,</span></span>
<span id="cb385-8624"><a href="#cb385-8624" aria-hidden="true" tabindex="-1"></a><span class="in">                  ymax = Tmean + Tstdev),</span></span>
<span id="cb385-8625"><a href="#cb385-8625" aria-hidden="true" tabindex="-1"></a><span class="in">              fill = "grey") + # fill grey for mix and max</span></span>
<span id="cb385-8626"><a href="#cb385-8626" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_ribbon(aes(x = Date,</span></span>
<span id="cb385-8627"><a href="#cb385-8627" aria-hidden="true" tabindex="-1"></a><span class="in">                  ymin = Tmean - Tstdev * (VIP_Coeff == -1),</span></span>
<span id="cb385-8628"><a href="#cb385-8628" aria-hidden="true" tabindex="-1"></a><span class="in">                  ymax = Tmean + Tstdev * (VIP_Coeff == -1)),</span></span>
<span id="cb385-8629"><a href="#cb385-8629" aria-hidden="true" tabindex="-1"></a><span class="in">              fill = "red") + # fill red when negative VIP_Coeff</span></span>
<span id="cb385-8630"><a href="#cb385-8630" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_ribbon(aes(x = Date,</span></span>
<span id="cb385-8631"><a href="#cb385-8631" aria-hidden="true" tabindex="-1"></a><span class="in">                  ymin = Tmean - Tstdev * (VIP_Coeff == 1),</span></span>
<span id="cb385-8632"><a href="#cb385-8632" aria-hidden="true" tabindex="-1"></a><span class="in">                  ymax = Tmean + Tstdev * (VIP_Coeff == 1)),</span></span>
<span id="cb385-8633"><a href="#cb385-8633" aria-hidden="true" tabindex="-1"></a><span class="in">              fill = "dark green") + # fill green for positive VIP_Coeff</span></span>
<span id="cb385-8634"><a href="#cb385-8634" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(aes(x = Date,</span></span>
<span id="cb385-8635"><a href="#cb385-8635" aria-hidden="true" tabindex="-1"></a><span class="in">                y = Tmean)) +</span></span>
<span id="cb385-8636"><a href="#cb385-8636" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +</span></span>
<span id="cb385-8637"><a href="#cb385-8637" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab(expression(paste(T[mean]," (°C)")))</span></span>
<span id="cb385-8638"><a href="#cb385-8638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8639"><a href="#cb385-8639" aria-hidden="true" tabindex="-1"></a><span class="in">temp_plot</span></span>
<span id="cb385-8640"><a href="#cb385-8640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8641"><a href="#cb385-8641" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine the plots</span></span>
<span id="cb385-8642"><a href="#cb385-8642" aria-hidden="true" tabindex="-1"></a><span class="in"># library(patchwork)</span></span>
<span id="cb385-8643"><a href="#cb385-8643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8644"><a href="#cb385-8644" aria-hidden="true" tabindex="-1"></a><span class="in">plot&lt;- (VIP_plot +</span></span>
<span id="cb385-8645"><a href="#cb385-8645" aria-hidden="true" tabindex="-1"></a><span class="in">          coeff_plot +</span></span>
<span id="cb385-8646"><a href="#cb385-8646" aria-hidden="true" tabindex="-1"></a><span class="in">          temp_plot +</span></span>
<span id="cb385-8647"><a href="#cb385-8647" aria-hidden="true" tabindex="-1"></a><span class="in">          plot_layout(ncol=1, # plots combine vertically in a single column</span></span>
<span id="cb385-8648"><a href="#cb385-8648" aria-hidden="true" tabindex="-1"></a><span class="in">            guides = "collect") # guides for each scale/give single shared legend</span></span>
<span id="cb385-8649"><a href="#cb385-8649" aria-hidden="true" tabindex="-1"></a><span class="in">        ) &amp; theme(legend.position = "right",</span></span>
<span id="cb385-8650"><a href="#cb385-8650" aria-hidden="true" tabindex="-1"></a><span class="in">                  legend.text = element_text(size = 8),</span></span>
<span id="cb385-8651"><a href="#cb385-8651" aria-hidden="true" tabindex="-1"></a><span class="in">                  legend.title = element_text(size = 10),</span></span>
<span id="cb385-8652"><a href="#cb385-8652" aria-hidden="true" tabindex="-1"></a><span class="in">                  axis.title.x = element_blank())</span></span>
<span id="cb385-8653"><a href="#cb385-8653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8654"><a href="#cb385-8654" aria-hidden="true" tabindex="-1"></a><span class="in">plot</span></span>
<span id="cb385-8655"><a href="#cb385-8655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8656"><a href="#cb385-8656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8657"><a href="#cb385-8657" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-8658"><a href="#cb385-8658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8659"><a href="#cb385-8659" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8660"><a href="#cb385-8660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8661"><a href="#cb385-8661" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now we have code that produces a nice compound figure that shows everything we expect of the outputs of a PLS analysis. Let's make a function for future use.</span>
<span id="cb385-8662"><a href="#cb385-8662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8663"><a href="#cb385-8663" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 21.5e}</span></span>
<span id="cb385-8664"><a href="#cb385-8664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8665"><a href="#cb385-8665" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot_PLS &lt;- function(PLS_results)</span></span>
<span id="cb385-8666"><a href="#cb385-8666" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb385-8667"><a href="#cb385-8667" aria-hidden="true" tabindex="-1"></a><span class="in">  library(ggplot2)</span></span>
<span id="cb385-8668"><a href="#cb385-8668" aria-hidden="true" tabindex="-1"></a><span class="in">  PLS_gg &lt;- PLS_results$PLS_summary %&gt;%</span></span>
<span id="cb385-8669"><a href="#cb385-8669" aria-hidden="true" tabindex="-1"></a><span class="in">    mutate(Month = trunc(Date / 100),</span></span>
<span id="cb385-8670"><a href="#cb385-8670" aria-hidden="true" tabindex="-1"></a><span class="in">           Day = Date - Month * 100,</span></span>
<span id="cb385-8671"><a href="#cb385-8671" aria-hidden="true" tabindex="-1"></a><span class="in">           Date = NULL) </span></span>
<span id="cb385-8672"><a href="#cb385-8672" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-8673"><a href="#cb385-8673" aria-hidden="true" tabindex="-1"></a><span class="in">  PLS_gg$Date &lt;- ISOdate(2002, </span></span>
<span id="cb385-8674"><a href="#cb385-8674" aria-hidden="true" tabindex="-1"></a><span class="in">                         PLS_gg$Month, </span></span>
<span id="cb385-8675"><a href="#cb385-8675" aria-hidden="true" tabindex="-1"></a><span class="in">                         PLS_gg$Day)</span></span>
<span id="cb385-8676"><a href="#cb385-8676" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-8677"><a href="#cb385-8677" aria-hidden="true" tabindex="-1"></a><span class="in">  PLS_gg$Date[PLS_gg$JDay &lt;= 0] &lt;-</span></span>
<span id="cb385-8678"><a href="#cb385-8678" aria-hidden="true" tabindex="-1"></a><span class="in">    ISOdate(2001, </span></span>
<span id="cb385-8679"><a href="#cb385-8679" aria-hidden="true" tabindex="-1"></a><span class="in">            PLS_gg$Month[PLS_gg$JDay &lt;= 0], </span></span>
<span id="cb385-8680"><a href="#cb385-8680" aria-hidden="true" tabindex="-1"></a><span class="in">            PLS_gg$Day[PLS_gg$JDay &lt;= 0])</span></span>
<span id="cb385-8681"><a href="#cb385-8681" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-8682"><a href="#cb385-8682" aria-hidden="true" tabindex="-1"></a><span class="in">  PLS_gg &lt;- PLS_gg %&gt;%</span></span>
<span id="cb385-8683"><a href="#cb385-8683" aria-hidden="true" tabindex="-1"></a><span class="in">    mutate(VIP_importance = VIP &gt;= 0.8,</span></span>
<span id="cb385-8684"><a href="#cb385-8684" aria-hidden="true" tabindex="-1"></a><span class="in">           VIP_Coeff = factor(sign(Coef) * VIP_importance))</span></span>
<span id="cb385-8685"><a href="#cb385-8685" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-8686"><a href="#cb385-8686" aria-hidden="true" tabindex="-1"></a><span class="in">  VIP_plot&lt;- ggplot(PLS_gg,aes(x=Date,y=VIP)) +</span></span>
<span id="cb385-8687"><a href="#cb385-8687" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_bar(stat='identity',aes(fill=VIP&gt;0.8))</span></span>
<span id="cb385-8688"><a href="#cb385-8688" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-8689"><a href="#cb385-8689" aria-hidden="true" tabindex="-1"></a><span class="in">  VIP_plot &lt;- VIP_plot +</span></span>
<span id="cb385-8690"><a href="#cb385-8690" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_fill_manual(name="VIP", </span></span>
<span id="cb385-8691"><a href="#cb385-8691" aria-hidden="true" tabindex="-1"></a><span class="in">                      labels = c("&lt;0.8", "&gt;0.8"), </span></span>
<span id="cb385-8692"><a href="#cb385-8692" aria-hidden="true" tabindex="-1"></a><span class="in">                      values = c("FALSE" = "grey", </span></span>
<span id="cb385-8693"><a href="#cb385-8693" aria-hidden="true" tabindex="-1"></a><span class="in">                                 "TRUE" = "blue")) +</span></span>
<span id="cb385-8694"><a href="#cb385-8694" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_bw(base_size=15) +</span></span>
<span id="cb385-8695"><a href="#cb385-8695" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(axis.text.x = element_blank(),</span></span>
<span id="cb385-8696"><a href="#cb385-8696" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.ticks.x = element_blank(),</span></span>
<span id="cb385-8697"><a href="#cb385-8697" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.title.x = element_blank())</span></span>
<span id="cb385-8698"><a href="#cb385-8698" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-8699"><a href="#cb385-8699" aria-hidden="true" tabindex="-1"></a><span class="in">  coeff_plot &lt;- ggplot(PLS_gg,</span></span>
<span id="cb385-8700"><a href="#cb385-8700" aria-hidden="true" tabindex="-1"></a><span class="in">                       aes(x = Date,</span></span>
<span id="cb385-8701"><a href="#cb385-8701" aria-hidden="true" tabindex="-1"></a><span class="in">                           y = Coef)) +</span></span>
<span id="cb385-8702"><a href="#cb385-8702" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_bar(stat ='identity',</span></span>
<span id="cb385-8703"><a href="#cb385-8703" aria-hidden="true" tabindex="-1"></a><span class="in">             aes(fill = VIP_Coeff)) +</span></span>
<span id="cb385-8704"><a href="#cb385-8704" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_fill_manual(name = "Effect direction", </span></span>
<span id="cb385-8705"><a href="#cb385-8705" aria-hidden="true" tabindex="-1"></a><span class="in">                      labels = c("Advancing",</span></span>
<span id="cb385-8706"><a href="#cb385-8706" aria-hidden="true" tabindex="-1"></a><span class="in">                                 "Unimportant",</span></span>
<span id="cb385-8707"><a href="#cb385-8707" aria-hidden="true" tabindex="-1"></a><span class="in">                                 "Delaying"), </span></span>
<span id="cb385-8708"><a href="#cb385-8708" aria-hidden="true" tabindex="-1"></a><span class="in">                      values = c("-1" = "red", </span></span>
<span id="cb385-8709"><a href="#cb385-8709" aria-hidden="true" tabindex="-1"></a><span class="in">                                 "0" = "grey",</span></span>
<span id="cb385-8710"><a href="#cb385-8710" aria-hidden="true" tabindex="-1"></a><span class="in">                                 "1" = "dark green")) +</span></span>
<span id="cb385-8711"><a href="#cb385-8711" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_bw(base_size = 15) +</span></span>
<span id="cb385-8712"><a href="#cb385-8712" aria-hidden="true" tabindex="-1"></a><span class="in">    ylab("PLS coefficient") +</span></span>
<span id="cb385-8713"><a href="#cb385-8713" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(axis.text.x = element_blank(),</span></span>
<span id="cb385-8714"><a href="#cb385-8714" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.ticks.x = element_blank(),</span></span>
<span id="cb385-8715"><a href="#cb385-8715" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.title.x = element_blank())</span></span>
<span id="cb385-8716"><a href="#cb385-8716" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-8717"><a href="#cb385-8717" aria-hidden="true" tabindex="-1"></a><span class="in">  temp_plot &lt;- ggplot(PLS_gg) +</span></span>
<span id="cb385-8718"><a href="#cb385-8718" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_ribbon(aes(x = Date,</span></span>
<span id="cb385-8719"><a href="#cb385-8719" aria-hidden="true" tabindex="-1"></a><span class="in">                    ymin = Tmean - Tstdev,</span></span>
<span id="cb385-8720"><a href="#cb385-8720" aria-hidden="true" tabindex="-1"></a><span class="in">                    ymax = Tmean + Tstdev),</span></span>
<span id="cb385-8721"><a href="#cb385-8721" aria-hidden="true" tabindex="-1"></a><span class="in">                fill = "grey") +</span></span>
<span id="cb385-8722"><a href="#cb385-8722" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_ribbon(aes(x = Date,</span></span>
<span id="cb385-8723"><a href="#cb385-8723" aria-hidden="true" tabindex="-1"></a><span class="in">                    ymin = Tmean - Tstdev * (VIP_Coeff == -1),</span></span>
<span id="cb385-8724"><a href="#cb385-8724" aria-hidden="true" tabindex="-1"></a><span class="in">                    ymax = Tmean + Tstdev * (VIP_Coeff == -1)),</span></span>
<span id="cb385-8725"><a href="#cb385-8725" aria-hidden="true" tabindex="-1"></a><span class="in">                fill = "red") +</span></span>
<span id="cb385-8726"><a href="#cb385-8726" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_ribbon(aes(x = Date,</span></span>
<span id="cb385-8727"><a href="#cb385-8727" aria-hidden="true" tabindex="-1"></a><span class="in">                    ymin = Tmean - Tstdev * (VIP_Coeff == 1),</span></span>
<span id="cb385-8728"><a href="#cb385-8728" aria-hidden="true" tabindex="-1"></a><span class="in">                    ymax = Tmean + Tstdev * (VIP_Coeff == 1)),</span></span>
<span id="cb385-8729"><a href="#cb385-8729" aria-hidden="true" tabindex="-1"></a><span class="in">                fill = "dark green") +</span></span>
<span id="cb385-8730"><a href="#cb385-8730" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_line(aes(x = Date,</span></span>
<span id="cb385-8731"><a href="#cb385-8731" aria-hidden="true" tabindex="-1"></a><span class="in">                  y = Tmean)) +</span></span>
<span id="cb385-8732"><a href="#cb385-8732" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_bw(base_size = 15) +</span></span>
<span id="cb385-8733"><a href="#cb385-8733" aria-hidden="true" tabindex="-1"></a><span class="in">    ylab(expression(paste(T[mean]," (°C)")))</span></span>
<span id="cb385-8734"><a href="#cb385-8734" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-8735"><a href="#cb385-8735" aria-hidden="true" tabindex="-1"></a><span class="in">  library(patchwork)</span></span>
<span id="cb385-8736"><a href="#cb385-8736" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-8737"><a href="#cb385-8737" aria-hidden="true" tabindex="-1"></a><span class="in">  plot&lt;- (VIP_plot +</span></span>
<span id="cb385-8738"><a href="#cb385-8738" aria-hidden="true" tabindex="-1"></a><span class="in">            coeff_plot +</span></span>
<span id="cb385-8739"><a href="#cb385-8739" aria-hidden="true" tabindex="-1"></a><span class="in">            temp_plot +</span></span>
<span id="cb385-8740"><a href="#cb385-8740" aria-hidden="true" tabindex="-1"></a><span class="in">            plot_layout(ncol=1,</span></span>
<span id="cb385-8741"><a href="#cb385-8741" aria-hidden="true" tabindex="-1"></a><span class="in">                        guides = "collect")</span></span>
<span id="cb385-8742"><a href="#cb385-8742" aria-hidden="true" tabindex="-1"></a><span class="in">          ) &amp; theme(legend.position = "right",</span></span>
<span id="cb385-8743"><a href="#cb385-8743" aria-hidden="true" tabindex="-1"></a><span class="in">                    legend.text = element_text(size = 8),</span></span>
<span id="cb385-8744"><a href="#cb385-8744" aria-hidden="true" tabindex="-1"></a><span class="in">                    legend.title = element_text(size = 10),</span></span>
<span id="cb385-8745"><a href="#cb385-8745" aria-hidden="true" tabindex="-1"></a><span class="in">                    axis.title.x = element_blank())</span></span>
<span id="cb385-8746"><a href="#cb385-8746" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-8747"><a href="#cb385-8747" aria-hidden="true" tabindex="-1"></a><span class="in">  plot}</span></span>
<span id="cb385-8748"><a href="#cb385-8748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8749"><a href="#cb385-8749" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot_PLS(PLS_results)</span></span>
<span id="cb385-8750"><a href="#cb385-8750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8751"><a href="#cb385-8751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8752"><a href="#cb385-8752" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-8753"><a href="#cb385-8753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8754"><a href="#cb385-8754" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8755"><a href="#cb385-8755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8756"><a href="#cb385-8756" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We see a strong bloom-advancing response to high temperatures in spring, but where is the chilling period?</span>
<span id="cb385-8757"><a href="#cb385-8757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8758"><a href="#cb385-8758" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8759"><a href="#cb385-8759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8760"><a href="#cb385-8760" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;21.6&lt;/span&gt;&amp;nbsp; Exercises on chill model comparison</span></span>
<span id="cb385-8761"><a href="#cb385-8761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8762"><a href="#cb385-8762" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-8763"><a href="#cb385-8763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8764"><a href="#cb385-8764" aria-hidden="true" tabindex="-1"></a>***1. Briefly explain why you shouldn’t take the results of a PLS regression analysis between temperature and phenology at face value. What do you need in addition in order to make sense of such outputs?***</span>
<span id="cb385-8765"><a href="#cb385-8765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8766"><a href="#cb385-8766" aria-hidden="true" tabindex="-1"></a>PLS regression is usually used for large datasets. However, in phenology analysis, dataset can be rather small. For example, in the case of bloom dates for temperate fruit trees, there is only one bloom date per year, compared to high-resolution temperature data. Although the PLS method also works with limited data, the results will be less reliable and should not be taken at face value. Several reasons can contribute to this:</span>
<span id="cb385-8767"><a href="#cb385-8767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8768"><a href="#cb385-8768" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There are very few observations to correlate a dependent variable with many possible independent variables.</span>
<span id="cb385-8769"><a href="#cb385-8769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8770"><a href="#cb385-8770" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>PLS only finds pattern within the dataset, which may or may not be meaningful<span class="dv">&amp;mdash;</span> correlation does not mean causation.</span>
<span id="cb385-8771"><a href="#cb385-8771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8772"><a href="#cb385-8772" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A risk of overfitting where the model captures noise than meaningful trends. </span>
<span id="cb385-8773"><a href="#cb385-8773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8774"><a href="#cb385-8774" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Phenological variables may not response consistently to temperature as other environmental variables may also have impacts. </span>
<span id="cb385-8775"><a href="#cb385-8775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8776"><a href="#cb385-8776" aria-hidden="true" tabindex="-1"></a>In order to make sense of such outputs, we need to have a prior theory or assumptions about how the system works. We can then run the analyses to check if the outputs support or contradict our theory. This practice will help prevent 'rationalizing'<span class="dv">&amp;mdash;</span> a tendency to impose meaning on random patterns to make them appear reasonable. </span>
<span id="cb385-8777"><a href="#cb385-8777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8778"><a href="#cb385-8778" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8779"><a href="#cb385-8779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8780"><a href="#cb385-8780" aria-hidden="true" tabindex="-1"></a>***2. Replicate the PLS analysis for the Roter Boskoop dataset that you used in a previous lesson.***</span>
<span id="cb385-8781"><a href="#cb385-8781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8782"><a href="#cb385-8782" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 21.6.2}</span></span>
<span id="cb385-8783"><a href="#cb385-8783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8784"><a href="#cb385-8784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8785"><a href="#cb385-8785" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a data.frame with two columns: Year (Pheno_year) and pheno (JDay)</span></span>
<span id="cb385-8786"><a href="#cb385-8786" aria-hidden="true" tabindex="-1"></a><span class="in">Roter_first &lt;- read_tab("data/OT/Roter_Boskoop_bloom_1958_2019.csv.csv") %&gt;%</span></span>
<span id="cb385-8787"><a href="#cb385-8787" aria-hidden="true" tabindex="-1"></a><span class="in">  select(Pheno_year, First_bloom) %&gt;%</span></span>
<span id="cb385-8788"><a href="#cb385-8788" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Year = as.numeric(substr(First_bloom, 1, 4)),</span></span>
<span id="cb385-8789"><a href="#cb385-8789" aria-hidden="true" tabindex="-1"></a><span class="in">         Month = as.numeric(substr(First_bloom, 5, 6)), </span></span>
<span id="cb385-8790"><a href="#cb385-8790" aria-hidden="true" tabindex="-1"></a><span class="in">         Day = as.numeric(substr(First_bloom, 7, 8))) %&gt;% </span></span>
<span id="cb385-8791"><a href="#cb385-8791" aria-hidden="true" tabindex="-1"></a><span class="in">  make_JDay() %&gt;% </span></span>
<span id="cb385-8792"><a href="#cb385-8792" aria-hidden="true" tabindex="-1"></a><span class="in">  select(Pheno_year, JDay) %&gt;% </span></span>
<span id="cb385-8793"><a href="#cb385-8793" aria-hidden="true" tabindex="-1"></a><span class="in">  rename(Year = Pheno_year,</span></span>
<span id="cb385-8794"><a href="#cb385-8794" aria-hidden="true" tabindex="-1"></a><span class="in">         pheno = JDay)</span></span>
<span id="cb385-8795"><a href="#cb385-8795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8796"><a href="#cb385-8796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8797"><a href="#cb385-8797" aria-hidden="true" tabindex="-1"></a><span class="in"># Recall temperature data to be used as weather data</span></span>
<span id="cb385-8798"><a href="#cb385-8798" aria-hidden="true" tabindex="-1"></a><span class="in">KA_temps &lt;- read_tab("data/OT/TMaxTMin1958-2019_patched.csv") %&gt;%</span></span>
<span id="cb385-8799"><a href="#cb385-8799" aria-hidden="true" tabindex="-1"></a><span class="in">  make_JDay()</span></span>
<span id="cb385-8800"><a href="#cb385-8800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8801"><a href="#cb385-8801" aria-hidden="true" tabindex="-1"></a><span class="in"># Run PLS</span></span>
<span id="cb385-8802"><a href="#cb385-8802" aria-hidden="true" tabindex="-1"></a><span class="in">PLS_roter_results &lt;- PLS_pheno(KA_temps, # weather data</span></span>
<span id="cb385-8803"><a href="#cb385-8803" aria-hidden="true" tabindex="-1"></a><span class="in">                         Roter_first) # bio data</span></span>
<span id="cb385-8804"><a href="#cb385-8804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8805"><a href="#cb385-8805" aria-hidden="true" tabindex="-1"></a><span class="in">kable(head(PLS_roter_results$PLS_summary)) %&gt;%</span></span>
<span id="cb385-8806"><a href="#cb385-8806" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-8807"><a href="#cb385-8807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8808"><a href="#cb385-8808" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot PLS using function for ggplot</span></span>
<span id="cb385-8809"><a href="#cb385-8809" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot_PLS(PLS_roter_results)</span></span>
<span id="cb385-8810"><a href="#cb385-8810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8811"><a href="#cb385-8811" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-8812"><a href="#cb385-8812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8813"><a href="#cb385-8813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8814"><a href="#cb385-8814" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8815"><a href="#cb385-8815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8816"><a href="#cb385-8816" aria-hidden="true" tabindex="-1"></a>***3. Write down your thoughts on why we’re not seeing the temperature response pattern we may have expected. What happened to the chill response?***</span>
<span id="cb385-8817"><a href="#cb385-8817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8818"><a href="#cb385-8818" aria-hidden="true" tabindex="-1"></a>It seems the answer is in the next chapter, but I will answer it based on this chapter, because this is a question for this chapter. </span>
<span id="cb385-8819"><a href="#cb385-8819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8820"><a href="#cb385-8820" aria-hidden="true" tabindex="-1"></a>I can think of two possible reasons:</span>
<span id="cb385-8821"><a href="#cb385-8821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8822"><a href="#cb385-8822" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>PLS method is not suitable for this analysis</span>
<span id="cb385-8823"><a href="#cb385-8823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8824"><a href="#cb385-8824" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>There is actually no correlation observed<span class="dv">&amp;mdash;</span> maybe the trees don't need chilling phase?</span>
<span id="cb385-8825"><a href="#cb385-8825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8826"><a href="#cb385-8826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8827"><a href="#cb385-8827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8828"><a href="#cb385-8828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8829"><a href="#cb385-8829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8830"><a href="#cb385-8830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8831"><a href="#cb385-8831" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8832"><a href="#cb385-8832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8833"><a href="#cb385-8833" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 22: Successes and limitations of PLS regression analysis</span></span>
<span id="cb385-8834"><a href="#cb385-8834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8835"><a href="#cb385-8835" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;22.1&lt;/span&gt;&amp;nbsp; PLS regression</span></span>
<span id="cb385-8836"><a href="#cb385-8836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8837"><a href="#cb385-8837" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-8838"><a href="#cb385-8838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8839"><a href="#cb385-8839" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In the context of phenology analysis, we can use the PLS regression method to correlate high-resolution temperature data (e.g. daily data) with low-resolution (annual) data on the timing of phenology events. </span>
<span id="cb385-8840"><a href="#cb385-8840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8841"><a href="#cb385-8841" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In the case of pears at Klein-Altendorf we were only really able to recognize the forcing period (where warm conditions advance bloom), while the chilling phase remained obscure.</span>
<span id="cb385-8842"><a href="#cb385-8842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8843"><a href="#cb385-8843" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This was a bit disappointing, because the two dormancy phases had emerged quite clearly in the study on walnut leaf emergence in California.</span>
<span id="cb385-8844"><a href="#cb385-8844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8845"><a href="#cb385-8845" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Let’s look at a few more examples to understand where and when this works<span class="dv">&amp;mdash;</span> and to try to figure out why.</span>
<span id="cb385-8846"><a href="#cb385-8846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8847"><a href="#cb385-8847" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8848"><a href="#cb385-8848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8849"><a href="#cb385-8849" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;22.2&lt;/span&gt;&amp;nbsp; PLS examples</span></span>
<span id="cb385-8850"><a href="#cb385-8850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8851"><a href="#cb385-8851" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;22.2.1&lt;/span&gt;&amp;nbsp; Grasslands on the Tibetan Plateau</span></span>
<span id="cb385-8852"><a href="#cb385-8852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8853"><a href="#cb385-8853" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-8854"><a href="#cb385-8854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8855"><a href="#cb385-8855" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We looked at how the beginning of the growing season has responded to climate change on the grasslands of the Tibetan Plateau. </span>
<span id="cb385-8856"><a href="#cb385-8856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8857"><a href="#cb385-8857" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When we just look at the trend over time, the pattern that emerges is rather confusing, with a fairly clear advancing trend until the late 1990s, followed by a surprising delay in ‘green up’ dates.</span>
<span id="cb385-8858"><a href="#cb385-8858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8859"><a href="#cb385-8859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8860"><a href="#cb385-8860" aria-hidden="true" tabindex="-1"></a>!<span class="co">[</span><span class="ot">***Beginning of the growing season (BGS) for steppe (A) and meadow (B) vegetation on the Tibetan Plateau between 1982 and 2006, derived from 15-day NDVI composites obtained from the Advanced Very High Resolution Radiometer (AVHRR) sensor. BGS dates advanced markedly between 1982 and the mid 1990s, before retreating significantly after that. Consistent increases in temperature (C and D) indicate that observed changes are not linear responses to temperature. Lines in the graph represent 3-year running means ([Yu et al., 2010](https://www.pnas.org/doi/pdf/10.1073/pnas.1012490107))***</span><span class="co">](./pic/ch22_1.png)</span></span>
<span id="cb385-8861"><a href="#cb385-8861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8862"><a href="#cb385-8862" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8863"><a href="#cb385-8863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8864"><a href="#cb385-8864" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Similar to what we found for walnuts in California, we detected a conspicuous relationship between warm temperatures in winter and delayed beginning of the growing season in spring.</span>
<span id="cb385-8865"><a href="#cb385-8865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8866"><a href="#cb385-8866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8867"><a href="#cb385-8867" aria-hidden="true" tabindex="-1"></a>!<span class="co">[</span><span class="ot">***Response of the BGS (A–D) in steppe and meadow vegetation of the Tibetan Plateau between 1982 and 2006 to monthly temperatures, according to PLS regression. The variable importance plots (VIP; C and D) indicate that temperatures in both spring (May and June) and winter (October through March) were important for explaining the response of BGS dates (VIP values above 0.8). Model coefficients (MC) of the centered and scaled data showed that warm winter temperatures delayed spring phenology (positive coefficients), whereas warm spring temperatures advanced the BGS (negative coefficients) for both steppe (A) and meadow (B). Including both effects into phenological models could substantially enhance our understanding of climate-change effects on vegetation at temperate and cold locations ([Yu et al., 2010](https://www.pnas.org/doi/pdf/10.1073/pnas.1012490107))***</span><span class="co">](./pic/ch22_2.png)</span></span>
<span id="cb385-8868"><a href="#cb385-8868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8869"><a href="#cb385-8869" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8870"><a href="#cb385-8870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8871"><a href="#cb385-8871" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We later added a spatial component to this analysis, investigating vegetation responses to temperature on a pixel-by-pixel basis.</span>
<span id="cb385-8872"><a href="#cb385-8872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8873"><a href="#cb385-8873" aria-hidden="true" tabindex="-1"></a>!<span class="co">[</span><span class="ot">***Correlations of monthly temperatures (left) and precipitation (right) with the beginning of the growing season (BGS) on the Tibetan Plateau, according to Partial Least Squares (PLS) regression. For each variable, pixels for which the variable-importance-in-the-projection score was &lt;0.8 are shown in gray. Pixels with insufficient data for PLS analysis are shown in white ([Yu et al., 2012](https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0049230))***</span><span class="co">](./pic/ch22_3.png)</span></span>
<span id="cb385-8874"><a href="#cb385-8874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8875"><a href="#cb385-8875" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8876"><a href="#cb385-8876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8877"><a href="#cb385-8877" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In principle, the temperature response pattern of grasslands is thus similar to what we’ve seen for walnuts in California, but the mechanisms at work here are probably quite different, so we should not jump to conclusions here without adequate knowledge of grassland ecology. </span>
<span id="cb385-8878"><a href="#cb385-8878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8879"><a href="#cb385-8879" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>These findings are concerning, because our initial expectation would probably have been that increasing temperature allows vegetation to get going earlier in the year. Failure of the vegetation to keep up with increasingly available thermal resources indicates a possible mismatch of the established ecosystems with future climatic conditions.</span>
<span id="cb385-8880"><a href="#cb385-8880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8881"><a href="#cb385-8881" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Such a mismatch is usually not sustainable, and it may open opportunities for invasive species that are better able to exploit the climatic ‘resources’ that will be available in the future.</span>
<span id="cb385-8882"><a href="#cb385-8882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8883"><a href="#cb385-8883" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8884"><a href="#cb385-8884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8885"><a href="#cb385-8885" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;22.2.2&lt;/span&gt;&amp;nbsp; Deciduous trees</span></span>
<span id="cb385-8886"><a href="#cb385-8886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8887"><a href="#cb385-8887" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-8888"><a href="#cb385-8888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8889"><a href="#cb385-8889" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In his first analysis, Guo Liang looked at the phenology of Chinese chestnuts <span class="co">[</span><span class="ot">(*Castanea mollissima*)</span><span class="co">](https://en.wikipedia.org/wiki/Castanea_mollissima)</span>grown in Beijing, China. </span>
<span id="cb385-8890"><a href="#cb385-8890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8891"><a href="#cb385-8891" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Once again, we can quite clearly see the forcing period - the long period of consistent negative model coefficients from January to May. The chilling period is also somewhat visible, but model coefficients are much less consistent, with many ‘unimportant’ values and even some interruptions.</span>
<span id="cb385-8892"><a href="#cb385-8892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8893"><a href="#cb385-8893" aria-hidden="true" tabindex="-1"></a>!<span class="co">[</span><span class="ot">***Results of Partial Least Squares (PLS) regression correlating first flowering dates for chestnut at Beijing Summer Palace with 11-day running means of daily mean temperatures from the previous July to June. Blue bars in the top panel indicate VIP values greater than 0.8, the threshold for variable importance. In the middle and bottom panels, red color means the model coefficients are negative (and important), while the green color indicates positive (and important) relationships between flowering and temperature. The black line in the bottom figure stands for the mean temperatures, while the gray, green and red areas represent the standard deviation of daily mean temperatures for each day of the year ([Guo et al., 2013](https://www.sciencedirect.com/science/article/pii/S0168192313001627))***</span><span class="co">](./pic/ch22_4.jpg)</span></span>
<span id="cb385-8894"><a href="#cb385-8894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8895"><a href="#cb385-8895" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8896"><a href="#cb385-8896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8897"><a href="#cb385-8897" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A similar analysis of cherry phenology from Campus Klein-Altendorf produced quite similar results. We see the pronounced forcing phase, which follows a chilling period that is difficult to delineate.</span>
<span id="cb385-8898"><a href="#cb385-8898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8899"><a href="#cb385-8899" aria-hidden="true" tabindex="-1"></a>!<span class="co">[</span><span class="ot">***Results of Partial Least Squares (PLS) regression of bloom dates for cv. ‘Schneiders späte Knorpelkirsche’ cherries in Klein-Altendorf, Germany, with 11-day running means of daily mean temperatures. The top panel shows Variable Importance in the Projection (VIP) scores, the middle panel model coefficients of the centered and scaled data, and the bottom panel mean temperatures (black line) and their standard deviation (grey areas). Blue bars in the top panel indicate values above 0.8, the threshold for variable importance. In the middle and bottom figures, data for these dates is shown in red whenever model coefficients are negative, and green when they are positive ([Luedeling et al., 2013b](https://link.springer.com/article/10.1007/s00484-012-0594-y))***</span><span class="co">](./pic/ch22_5.webp)</span></span>
<span id="cb385-8900"><a href="#cb385-8900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8901"><a href="#cb385-8901" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8902"><a href="#cb385-8902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8903"><a href="#cb385-8903" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A common pattern that emerges here is that the forcing phase is clearly visible, while the chilling phase is hard to see. This is disappointing after the very clear pattern we found earlier in California:</span>
<span id="cb385-8904"><a href="#cb385-8904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8905"><a href="#cb385-8905" aria-hidden="true" tabindex="-1"></a><span class="al">![***Results of a PLS analysis relating leaf emergence dates of ‘Payne’ walnuts in California to mean daily temperature***](./pic/ch22_6.png)</span></span>
<span id="cb385-8906"><a href="#cb385-8906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8907"><a href="#cb385-8907" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-8908"><a href="#cb385-8908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8909"><a href="#cb385-8909" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;22.2.3&lt;/span&gt;&amp;nbsp; Why we’re not seeing the chilling phase</span></span>
<span id="cb385-8910"><a href="#cb385-8910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8911"><a href="#cb385-8911" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-8912"><a href="#cb385-8912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8913"><a href="#cb385-8913" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In the spider mite example, PLS regression was sensitive to the quantity of reflected radiation that reached the sensor, with greater reflectance at certain wavelengths and lower reflectance at other wavelengths indicating mite damage severity.</span>
<span id="cb385-8914"><a href="#cb385-8914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8915"><a href="#cb385-8915" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In detecting the forcing phase, PLS responded to temperature, with higher temperatures indicating greater heat accumulation, which was in turn related to early bloom.</span>
<span id="cb385-8916"><a href="#cb385-8916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8917"><a href="#cb385-8917" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In all of these cases, changes in the response variable were monotonically related to changes in the signal, i.e. the greater the signal, the greater/smaller the response. </span>
<span id="cb385-8918"><a href="#cb385-8918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8919"><a href="#cb385-8919" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Let’s look at the temperature ranges that the chill models respond to and compare this to the temperature range that we can observe at the three study locations during the winter months.</span>
<span id="cb385-8920"><a href="#cb385-8920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8921"><a href="#cb385-8921" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To determine the range of effective temperatures for the various chill models we’ve already worked with, let’s see how much chill they produce at various levels of constant temperatures (chill days is omitted here, because this model doesn’t work with constant temperatures):</span>
<span id="cb385-8922"><a href="#cb385-8922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8923"><a href="#cb385-8923" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 22.2.3a}</span></span>
<span id="cb385-8924"><a href="#cb385-8924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8925"><a href="#cb385-8925" aria-hidden="true" tabindex="-1"></a><span class="in"># library(chillR)</span></span>
<span id="cb385-8926"><a href="#cb385-8926" aria-hidden="true" tabindex="-1"></a><span class="in"># library(dormancyR)</span></span>
<span id="cb385-8927"><a href="#cb385-8927" aria-hidden="true" tabindex="-1"></a><span class="in"># library(ggplot2)</span></span>
<span id="cb385-8928"><a href="#cb385-8928" aria-hidden="true" tabindex="-1"></a><span class="in"># library(kableExtra)</span></span>
<span id="cb385-8929"><a href="#cb385-8929" aria-hidden="true" tabindex="-1"></a><span class="in"># library(patchwork)</span></span>
<span id="cb385-8930"><a href="#cb385-8930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8931"><a href="#cb385-8931" aria-hidden="true" tabindex="-1"></a><span class="in"># List the hourly models to use for chill calculations</span></span>
<span id="cb385-8932"><a href="#cb385-8932" aria-hidden="true" tabindex="-1"></a><span class="in">hourly_models &lt;- </span></span>
<span id="cb385-8933"><a href="#cb385-8933" aria-hidden="true" tabindex="-1"></a><span class="in">  list(</span></span>
<span id="cb385-8934"><a href="#cb385-8934" aria-hidden="true" tabindex="-1"></a><span class="in">    Chilling_units = chilling_units,</span></span>
<span id="cb385-8935"><a href="#cb385-8935" aria-hidden="true" tabindex="-1"></a><span class="in">    Low_chill = low_chill_model,</span></span>
<span id="cb385-8936"><a href="#cb385-8936" aria-hidden="true" tabindex="-1"></a><span class="in">    Modified_Utah = modified_utah_model,</span></span>
<span id="cb385-8937"><a href="#cb385-8937" aria-hidden="true" tabindex="-1"></a><span class="in">    North_Carolina = north_carolina_model,</span></span>
<span id="cb385-8938"><a href="#cb385-8938" aria-hidden="true" tabindex="-1"></a><span class="in">    Positive_Utah = positive_utah_model,</span></span>
<span id="cb385-8939"><a href="#cb385-8939" aria-hidden="true" tabindex="-1"></a><span class="in">    Chilling_Hours = Chilling_Hours,</span></span>
<span id="cb385-8940"><a href="#cb385-8940" aria-hidden="true" tabindex="-1"></a><span class="in">    Utah_Chill_Units = Utah_Model,</span></span>
<span id="cb385-8941"><a href="#cb385-8941" aria-hidden="true" tabindex="-1"></a><span class="in">    Chill_Portions = Dynamic_Model)</span></span>
<span id="cb385-8942"><a href="#cb385-8942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8943"><a href="#cb385-8943" aria-hidden="true" tabindex="-1"></a><span class="in"># List the daily models to calculate daily chill requirements</span></span>
<span id="cb385-8944"><a href="#cb385-8944" aria-hidden="true" tabindex="-1"></a><span class="in">daily_models &lt;-</span></span>
<span id="cb385-8945"><a href="#cb385-8945" aria-hidden="true" tabindex="-1"></a><span class="in">  list(</span></span>
<span id="cb385-8946"><a href="#cb385-8946" aria-hidden="true" tabindex="-1"></a><span class="in">    Rate_of_Chill = rate_of_chill, </span></span>
<span id="cb385-8947"><a href="#cb385-8947" aria-hidden="true" tabindex="-1"></a><span class="in">    Exponential_Chill = exponential_chill,</span></span>
<span id="cb385-8948"><a href="#cb385-8948" aria-hidden="true" tabindex="-1"></a><span class="in">    Triangular_Chill_Haninnen = triangular_chill_1,</span></span>
<span id="cb385-8949"><a href="#cb385-8949" aria-hidden="true" tabindex="-1"></a><span class="in">    Triangular_Chill_Legave = triangular_chill_2)</span></span>
<span id="cb385-8950"><a href="#cb385-8950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8951"><a href="#cb385-8951" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine both into a vector</span></span>
<span id="cb385-8952"><a href="#cb385-8952" aria-hidden="true" tabindex="-1"></a><span class="in">metrics &lt;- c(names(daily_models),</span></span>
<span id="cb385-8953"><a href="#cb385-8953" aria-hidden="true" tabindex="-1"></a><span class="in">             names(hourly_models))</span></span>
<span id="cb385-8954"><a href="#cb385-8954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8955"><a href="#cb385-8955" aria-hidden="true" tabindex="-1"></a><span class="in"># Give model labels for plotting</span></span>
<span id="cb385-8956"><a href="#cb385-8956" aria-hidden="true" tabindex="-1"></a><span class="in">model_labels &lt;- c("Rate of Chill",</span></span>
<span id="cb385-8957"><a href="#cb385-8957" aria-hidden="true" tabindex="-1"></a><span class="in">                  "Exponential Chill",</span></span>
<span id="cb385-8958"><a href="#cb385-8958" aria-hidden="true" tabindex="-1"></a><span class="in">                  "Triangular Chill (Häninnen)",</span></span>
<span id="cb385-8959"><a href="#cb385-8959" aria-hidden="true" tabindex="-1"></a><span class="in">                  "Triangular Chill (Legave)",</span></span>
<span id="cb385-8960"><a href="#cb385-8960" aria-hidden="true" tabindex="-1"></a><span class="in">                  "Chilling Units",</span></span>
<span id="cb385-8961"><a href="#cb385-8961" aria-hidden="true" tabindex="-1"></a><span class="in">                  "Low-Chill Chill Units",</span></span>
<span id="cb385-8962"><a href="#cb385-8962" aria-hidden="true" tabindex="-1"></a><span class="in">                  "Modified Utah Chill Units",</span></span>
<span id="cb385-8963"><a href="#cb385-8963" aria-hidden="true" tabindex="-1"></a><span class="in">                  "North Carolina Chill Units",</span></span>
<span id="cb385-8964"><a href="#cb385-8964" aria-hidden="true" tabindex="-1"></a><span class="in">                  "Positive Utah Chill Units",</span></span>
<span id="cb385-8965"><a href="#cb385-8965" aria-hidden="true" tabindex="-1"></a><span class="in">                  "Chilling Hours",</span></span>
<span id="cb385-8966"><a href="#cb385-8966" aria-hidden="true" tabindex="-1"></a><span class="in">                  "Utah Chill Units",</span></span>
<span id="cb385-8967"><a href="#cb385-8967" aria-hidden="true" tabindex="-1"></a><span class="in">                  "Chill Portions")</span></span>
<span id="cb385-8968"><a href="#cb385-8968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8969"><a href="#cb385-8969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8970"><a href="#cb385-8970" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a function to calculate </span></span>
<span id="cb385-8971"><a href="#cb385-8971" aria-hidden="true" tabindex="-1"></a><span class="in">for(T in -20:30)</span></span>
<span id="cb385-8972"><a href="#cb385-8972" aria-hidden="true" tabindex="-1"></a><span class="in"> {</span></span>
<span id="cb385-8973"><a href="#cb385-8973" aria-hidden="true" tabindex="-1"></a><span class="in">  hourly &lt;- sapply( hourly_models,</span></span>
<span id="cb385-8974"><a href="#cb385-8974" aria-hidden="true" tabindex="-1"></a><span class="in">                    function(x) # hourly models</span></span>
<span id="cb385-8975"><a href="#cb385-8975" aria-hidden="true" tabindex="-1"></a><span class="in">                      x(rep(T,1000)) # 51 x 1000 -&gt; 51000 outputs</span></span>
<span id="cb385-8976"><a href="#cb385-8976" aria-hidden="true" tabindex="-1"></a><span class="in">                    )[1000,] # take only 1000th row (end of a cycle run???)</span></span>
<span id="cb385-8977"><a href="#cb385-8977" aria-hidden="true" tabindex="-1"></a><span class="in"> </span></span>
<span id="cb385-8978"><a href="#cb385-8978" aria-hidden="true" tabindex="-1"></a><span class="in">  # Just to create a data frame- same values for all columns</span></span>
<span id="cb385-8979"><a href="#cb385-8979" aria-hidden="true" tabindex="-1"></a><span class="in">  temp_frame &lt;- data.frame(Tmin = rep(T,1000),</span></span>
<span id="cb385-8980"><a href="#cb385-8980" aria-hidden="true" tabindex="-1"></a><span class="in">                           Tmax = rep(T,1000),</span></span>
<span id="cb385-8981"><a href="#cb385-8981" aria-hidden="true" tabindex="-1"></a><span class="in">                           Tmean = rep(T,1000))</span></span>
<span id="cb385-8982"><a href="#cb385-8982" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-8983"><a href="#cb385-8983" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-8984"><a href="#cb385-8984" aria-hidden="true" tabindex="-1"></a><span class="in">  daily &lt;- sapply( daily_models,</span></span>
<span id="cb385-8985"><a href="#cb385-8985" aria-hidden="true" tabindex="-1"></a><span class="in">                   function(x) </span></span>
<span id="cb385-8986"><a href="#cb385-8986" aria-hidden="true" tabindex="-1"></a><span class="in">                     x(temp_frame)</span></span>
<span id="cb385-8987"><a href="#cb385-8987" aria-hidden="true" tabindex="-1"></a><span class="in">                   )[1000,]</span></span>
<span id="cb385-8988"><a href="#cb385-8988" aria-hidden="true" tabindex="-1"></a><span class="in"># When T is -20 the sensitivity is created (the start) and then bind the rest to it</span></span>
<span id="cb385-8989"><a href="#cb385-8989" aria-hidden="true" tabindex="-1"></a><span class="in">  if(T == -20)</span></span>
<span id="cb385-8990"><a href="#cb385-8990" aria-hidden="true" tabindex="-1"></a><span class="in">    sensitivity &lt;- c(T = T,</span></span>
<span id="cb385-8991"><a href="#cb385-8991" aria-hidden="true" tabindex="-1"></a><span class="in">                     daily,</span></span>
<span id="cb385-8992"><a href="#cb385-8992" aria-hidden="true" tabindex="-1"></a><span class="in">                     hourly) else   </span></span>
<span id="cb385-8993"><a href="#cb385-8993" aria-hidden="true" tabindex="-1"></a><span class="in">      sensitivity &lt;- rbind(sensitivity,</span></span>
<span id="cb385-8994"><a href="#cb385-8994" aria-hidden="true" tabindex="-1"></a><span class="in">                           c(T = T,</span></span>
<span id="cb385-8995"><a href="#cb385-8995" aria-hidden="true" tabindex="-1"></a><span class="in">                             daily,</span></span>
<span id="cb385-8996"><a href="#cb385-8996" aria-hidden="true" tabindex="-1"></a><span class="in">                             hourly))</span></span>
<span id="cb385-8997"><a href="#cb385-8997" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb385-8998"><a href="#cb385-8998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-8999"><a href="#cb385-8999" aria-hidden="true" tabindex="-1"></a><span class="in">sensitivity_normal &lt;- </span></span>
<span id="cb385-9000"><a href="#cb385-9000" aria-hidden="true" tabindex="-1"></a><span class="in">  as.data.frame(cbind(sensitivity[,1],</span></span>
<span id="cb385-9001"><a href="#cb385-9001" aria-hidden="true" tabindex="-1"></a><span class="in">                      sapply(2:ncol(sensitivity),</span></span>
<span id="cb385-9002"><a href="#cb385-9002" aria-hidden="true" tabindex="-1"></a><span class="in">                             function(x)</span></span>
<span id="cb385-9003"><a href="#cb385-9003" aria-hidden="true" tabindex="-1"></a><span class="in">                               sensitivity[,x]/max(sensitivity[,x]))))</span></span>
<span id="cb385-9004"><a href="#cb385-9004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9005"><a href="#cb385-9005" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(sensitivity_normal) &lt;- colnames(sensitivity)</span></span>
<span id="cb385-9006"><a href="#cb385-9006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9007"><a href="#cb385-9007" aria-hidden="true" tabindex="-1"></a><span class="in">sensitivity_gg &lt;- </span></span>
<span id="cb385-9008"><a href="#cb385-9008" aria-hidden="true" tabindex="-1"></a><span class="in">  sensitivity_normal %&gt;%</span></span>
<span id="cb385-9009"><a href="#cb385-9009" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_longer(Rate_of_Chill:Chill_Portions)</span></span>
<span id="cb385-9010"><a href="#cb385-9010" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-9011"><a href="#cb385-9011" aria-hidden="true" tabindex="-1"></a><span class="in"> # melt(sensitivity_normal,id.vars="T")</span></span>
<span id="cb385-9012"><a href="#cb385-9012" aria-hidden="true" tabindex="-1"></a><span class="in">sensitivity_gg$value[sensitivity_gg$value&lt;=0.001] &lt;- NA</span></span>
<span id="cb385-9013"><a href="#cb385-9013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9014"><a href="#cb385-9014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9015"><a href="#cb385-9015" aria-hidden="true" tabindex="-1"></a><span class="in">chill&lt;-</span></span>
<span id="cb385-9016"><a href="#cb385-9016" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(sensitivity_gg,</span></span>
<span id="cb385-9017"><a href="#cb385-9017" aria-hidden="true" tabindex="-1"></a><span class="in">         aes(x = T,</span></span>
<span id="cb385-9018"><a href="#cb385-9018" aria-hidden="true" tabindex="-1"></a><span class="in">             y = factor(name),</span></span>
<span id="cb385-9019"><a href="#cb385-9019" aria-hidden="true" tabindex="-1"></a><span class="in">             size = value)) +</span></span>
<span id="cb385-9020"><a href="#cb385-9020" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(col = "light blue") +</span></span>
<span id="cb385-9021"><a href="#cb385-9021" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_discrete(labels = model_labels) +</span></span>
<span id="cb385-9022"><a href="#cb385-9022" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Chill model") +</span></span>
<span id="cb385-9023"><a href="#cb385-9023" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Temperature (assumed constant, °C)") +</span></span>
<span id="cb385-9024"><a href="#cb385-9024" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(c(-30, 40)) +</span></span>
<span id="cb385-9025"><a href="#cb385-9025" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +</span></span>
<span id="cb385-9026"><a href="#cb385-9026" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(size = "Chill \nWeight")</span></span>
<span id="cb385-9027"><a href="#cb385-9027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9028"><a href="#cb385-9028" aria-hidden="true" tabindex="-1"></a><span class="in">chill</span></span>
<span id="cb385-9029"><a href="#cb385-9029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9030"><a href="#cb385-9030" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-9031"><a href="#cb385-9031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9032"><a href="#cb385-9032" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-9033"><a href="#cb385-9033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9034"><a href="#cb385-9034" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now let’s summarize winter temperatures at the three locations for which we’ve seen phenology responses above: Klein-Altendorf (Germany), Beijing (China) and Davis (California).</span>
<span id="cb385-9035"><a href="#cb385-9035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9036"><a href="#cb385-9036" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 22.2.3b}</span></span>
<span id="cb385-9037"><a href="#cb385-9037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9038"><a href="#cb385-9038" aria-hidden="true" tabindex="-1"></a><span class="in">KA_temps &lt;- read_tab("data/OT/TMaxTMin1958-2019_patched.csv") %&gt;%</span></span>
<span id="cb385-9039"><a href="#cb385-9039" aria-hidden="true" tabindex="-1"></a><span class="in">  make_JDay() %&gt;%</span></span>
<span id="cb385-9040"><a href="#cb385-9040" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(JDay &gt; 305 | JDay &lt; 90) %&gt;%</span></span>
<span id="cb385-9041"><a href="#cb385-9041" aria-hidden="true" tabindex="-1"></a><span class="in">  stack_hourly_temps(latitude = 50.6)</span></span>
<span id="cb385-9042"><a href="#cb385-9042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9043"><a href="#cb385-9043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9044"><a href="#cb385-9044" aria-hidden="true" tabindex="-1"></a><span class="in">hh_KA &lt;- hist(KA_temps$hourtemps$Temp,</span></span>
<span id="cb385-9045"><a href="#cb385-9045" aria-hidden="true" tabindex="-1"></a><span class="in">              breaks = c(-30:30),</span></span>
<span id="cb385-9046"><a href="#cb385-9046" aria-hidden="true" tabindex="-1"></a><span class="in">              plot=FALSE)</span></span>
<span id="cb385-9047"><a href="#cb385-9047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9048"><a href="#cb385-9048" aria-hidden="true" tabindex="-1"></a><span class="in">hh_KA_df &lt;- data.frame(</span></span>
<span id="cb385-9049"><a href="#cb385-9049" aria-hidden="true" tabindex="-1"></a><span class="in">  T = hh_KA$mids,</span></span>
<span id="cb385-9050"><a href="#cb385-9050" aria-hidden="true" tabindex="-1"></a><span class="in">  name = "Klein-Altendorf, Germany",</span></span>
<span id="cb385-9051"><a href="#cb385-9051" aria-hidden="true" tabindex="-1"></a><span class="in">  value = hh_KA$counts / max(hh_KA$counts))</span></span>
<span id="cb385-9052"><a href="#cb385-9052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9053"><a href="#cb385-9053" aria-hidden="true" tabindex="-1"></a><span class="in">hh_KA_df$value[hh_KA_df$value == 0] &lt;- NA</span></span>
<span id="cb385-9054"><a href="#cb385-9054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9055"><a href="#cb385-9055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9056"><a href="#cb385-9056" aria-hidden="true" tabindex="-1"></a><span class="in">Beijing_temps &lt;- read_tab("data/OT/Beijing_weather.csv") %&gt;%</span></span>
<span id="cb385-9057"><a href="#cb385-9057" aria-hidden="true" tabindex="-1"></a><span class="in">  make_JDay() %&gt;%</span></span>
<span id="cb385-9058"><a href="#cb385-9058" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(JDay &gt; 305 | JDay &lt; 90) %&gt;%</span></span>
<span id="cb385-9059"><a href="#cb385-9059" aria-hidden="true" tabindex="-1"></a><span class="in">  stack_hourly_temps(latitude = 39.9)</span></span>
<span id="cb385-9060"><a href="#cb385-9060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9061"><a href="#cb385-9061" aria-hidden="true" tabindex="-1"></a><span class="in">hh_Beijing &lt;- hist(Beijing_temps$hourtemps$Temp,</span></span>
<span id="cb385-9062"><a href="#cb385-9062" aria-hidden="true" tabindex="-1"></a><span class="in">                   breaks = c(-30:30),</span></span>
<span id="cb385-9063"><a href="#cb385-9063" aria-hidden="true" tabindex="-1"></a><span class="in">                   plot=FALSE)</span></span>
<span id="cb385-9064"><a href="#cb385-9064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9065"><a href="#cb385-9065" aria-hidden="true" tabindex="-1"></a><span class="in">hh_Beijing_df&lt;-data.frame(</span></span>
<span id="cb385-9066"><a href="#cb385-9066" aria-hidden="true" tabindex="-1"></a><span class="in">  T = hh_Beijing$mids,</span></span>
<span id="cb385-9067"><a href="#cb385-9067" aria-hidden="true" tabindex="-1"></a><span class="in">  name = "Beijing, China",</span></span>
<span id="cb385-9068"><a href="#cb385-9068" aria-hidden="true" tabindex="-1"></a><span class="in">  value = hh_Beijing$counts / max(hh_Beijing$counts))</span></span>
<span id="cb385-9069"><a href="#cb385-9069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9070"><a href="#cb385-9070" aria-hidden="true" tabindex="-1"></a><span class="in">hh_Beijing_df$value[hh_Beijing_df$value==0]&lt;-NA</span></span>
<span id="cb385-9071"><a href="#cb385-9071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9072"><a href="#cb385-9072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9073"><a href="#cb385-9073" aria-hidden="true" tabindex="-1"></a><span class="in">Davis_temps &lt;- read_tab("data/OT/Davis_weather.csv") %&gt;%</span></span>
<span id="cb385-9074"><a href="#cb385-9074" aria-hidden="true" tabindex="-1"></a><span class="in">  make_JDay() %&gt;%</span></span>
<span id="cb385-9075"><a href="#cb385-9075" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(JDay &gt; 305 | JDay &lt; 90) %&gt;%</span></span>
<span id="cb385-9076"><a href="#cb385-9076" aria-hidden="true" tabindex="-1"></a><span class="in">  stack_hourly_temps(latitude = 38.5)</span></span>
<span id="cb385-9077"><a href="#cb385-9077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9078"><a href="#cb385-9078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9079"><a href="#cb385-9079" aria-hidden="true" tabindex="-1"></a><span class="in">hh_Davis &lt;- hist(Davis_temps$hourtemps$Temp,</span></span>
<span id="cb385-9080"><a href="#cb385-9080" aria-hidden="true" tabindex="-1"></a><span class="in">              breaks = c(-30:40),</span></span>
<span id="cb385-9081"><a href="#cb385-9081" aria-hidden="true" tabindex="-1"></a><span class="in">              plot=FALSE)</span></span>
<span id="cb385-9082"><a href="#cb385-9082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9083"><a href="#cb385-9083" aria-hidden="true" tabindex="-1"></a><span class="in">hh_Davis_df &lt;- data.frame(</span></span>
<span id="cb385-9084"><a href="#cb385-9084" aria-hidden="true" tabindex="-1"></a><span class="in">  T = hh_Davis$mids,</span></span>
<span id="cb385-9085"><a href="#cb385-9085" aria-hidden="true" tabindex="-1"></a><span class="in">  name = "Davis, California",</span></span>
<span id="cb385-9086"><a href="#cb385-9086" aria-hidden="true" tabindex="-1"></a><span class="in">  value = hh_Davis$counts / max(hh_Davis$counts))</span></span>
<span id="cb385-9087"><a href="#cb385-9087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9088"><a href="#cb385-9088" aria-hidden="true" tabindex="-1"></a><span class="in">hh_Davis_df$value[hh_Davis_df$value == 0] &lt;- NA</span></span>
<span id="cb385-9089"><a href="#cb385-9089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9090"><a href="#cb385-9090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9091"><a href="#cb385-9091" aria-hidden="true" tabindex="-1"></a><span class="in">hh_df&lt;-rbind(hh_KA_df,</span></span>
<span id="cb385-9092"><a href="#cb385-9092" aria-hidden="true" tabindex="-1"></a><span class="in">             hh_Beijing_df,</span></span>
<span id="cb385-9093"><a href="#cb385-9093" aria-hidden="true" tabindex="-1"></a><span class="in">             hh_Davis_df)</span></span>
<span id="cb385-9094"><a href="#cb385-9094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9095"><a href="#cb385-9095" aria-hidden="true" tabindex="-1"></a><span class="in">locations&lt;-</span></span>
<span id="cb385-9096"><a href="#cb385-9096" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(data = hh_df,</span></span>
<span id="cb385-9097"><a href="#cb385-9097" aria-hidden="true" tabindex="-1"></a><span class="in">         aes(x = T,</span></span>
<span id="cb385-9098"><a href="#cb385-9098" aria-hidden="true" tabindex="-1"></a><span class="in">             y = name,</span></span>
<span id="cb385-9099"><a href="#cb385-9099" aria-hidden="true" tabindex="-1"></a><span class="in">             size = value)) +</span></span>
<span id="cb385-9100"><a href="#cb385-9100" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(col = "coral2") +</span></span>
<span id="cb385-9101"><a href="#cb385-9101" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Location") +</span></span>
<span id="cb385-9102"><a href="#cb385-9102" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Temperature (between November and March, °C)") + </span></span>
<span id="cb385-9103"><a href="#cb385-9103" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(c(-30, 40)) +</span></span>
<span id="cb385-9104"><a href="#cb385-9104" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +</span></span>
<span id="cb385-9105"><a href="#cb385-9105" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(size = "Relative \nfrequency")</span></span>
<span id="cb385-9106"><a href="#cb385-9106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9107"><a href="#cb385-9107" aria-hidden="true" tabindex="-1"></a><span class="in">locations</span></span>
<span id="cb385-9108"><a href="#cb385-9108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9109"><a href="#cb385-9109" aria-hidden="true" tabindex="-1"></a><span class="in"># To compare the plots, let’s combine them in one figure (using the patchwork package):</span></span>
<span id="cb385-9110"><a href="#cb385-9110" aria-hidden="true" tabindex="-1"></a><span class="in">  plot &lt;- (chill +</span></span>
<span id="cb385-9111"><a href="#cb385-9111" aria-hidden="true" tabindex="-1"></a><span class="in">             locations +</span></span>
<span id="cb385-9112"><a href="#cb385-9112" aria-hidden="true" tabindex="-1"></a><span class="in">             plot_layout(guides = "collect",</span></span>
<span id="cb385-9113"><a href="#cb385-9113" aria-hidden="true" tabindex="-1"></a><span class="in">                         heights = c(1, 0.4))</span></span>
<span id="cb385-9114"><a href="#cb385-9114" aria-hidden="true" tabindex="-1"></a><span class="in">           ) &amp; theme(legend.position = "right",</span></span>
<span id="cb385-9115"><a href="#cb385-9115" aria-hidden="true" tabindex="-1"></a><span class="in">                     legend.text = element_text(size = 10),</span></span>
<span id="cb385-9116"><a href="#cb385-9116" aria-hidden="true" tabindex="-1"></a><span class="in">                     legend.title = element_text(size = 12))</span></span>
<span id="cb385-9117"><a href="#cb385-9117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9118"><a href="#cb385-9118" aria-hidden="true" tabindex="-1"></a><span class="in">plot</span></span>
<span id="cb385-9119"><a href="#cb385-9119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9120"><a href="#cb385-9120" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-9121"><a href="#cb385-9121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9122"><a href="#cb385-9122" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-9123"><a href="#cb385-9123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9124"><a href="#cb385-9124" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We already realized earlier that some of these models are probably pretty poor. So let’s simplify by only plotting chill according to the Dynamic Model:</span>
<span id="cb385-9125"><a href="#cb385-9125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9126"><a href="#cb385-9126" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 22.2.3c}</span></span>
<span id="cb385-9127"><a href="#cb385-9127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9128"><a href="#cb385-9128" aria-hidden="true" tabindex="-1"></a><span class="in">chill &lt;-</span></span>
<span id="cb385-9129"><a href="#cb385-9129" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(sensitivity_gg %&gt;%</span></span>
<span id="cb385-9130"><a href="#cb385-9130" aria-hidden="true" tabindex="-1"></a><span class="in">           filter(name == "Chill_Portions"),</span></span>
<span id="cb385-9131"><a href="#cb385-9131" aria-hidden="true" tabindex="-1"></a><span class="in">         aes(x = T,</span></span>
<span id="cb385-9132"><a href="#cb385-9132" aria-hidden="true" tabindex="-1"></a><span class="in">             y = factor(name),</span></span>
<span id="cb385-9133"><a href="#cb385-9133" aria-hidden="true" tabindex="-1"></a><span class="in">             size=value)) +</span></span>
<span id="cb385-9134"><a href="#cb385-9134" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(col = "light blue") +</span></span>
<span id="cb385-9135"><a href="#cb385-9135" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_discrete(labels = "Chill Portions") +</span></span>
<span id="cb385-9136"><a href="#cb385-9136" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Chill model") +</span></span>
<span id="cb385-9137"><a href="#cb385-9137" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Temperature (assumed constant, °C)") +</span></span>
<span id="cb385-9138"><a href="#cb385-9138" aria-hidden="true" tabindex="-1"></a><span class="in">  xlim(c(-30, 40)) +</span></span>
<span id="cb385-9139"><a href="#cb385-9139" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) +</span></span>
<span id="cb385-9140"><a href="#cb385-9140" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(size = "Chill \nWeight")</span></span>
<span id="cb385-9141"><a href="#cb385-9141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9142"><a href="#cb385-9142" aria-hidden="true" tabindex="-1"></a><span class="in">  plot&lt;- (chill +</span></span>
<span id="cb385-9143"><a href="#cb385-9143" aria-hidden="true" tabindex="-1"></a><span class="in">            locations +</span></span>
<span id="cb385-9144"><a href="#cb385-9144" aria-hidden="true" tabindex="-1"></a><span class="in">            plot_layout(guides = "collect",</span></span>
<span id="cb385-9145"><a href="#cb385-9145" aria-hidden="true" tabindex="-1"></a><span class="in">                        heights = c(0.5,1))</span></span>
<span id="cb385-9146"><a href="#cb385-9146" aria-hidden="true" tabindex="-1"></a><span class="in">        ) &amp; theme(legend.position = "right",</span></span>
<span id="cb385-9147"><a href="#cb385-9147" aria-hidden="true" tabindex="-1"></a><span class="in">                  legend.text = element_text(size = 10),</span></span>
<span id="cb385-9148"><a href="#cb385-9148" aria-hidden="true" tabindex="-1"></a><span class="in">                  legend.title = element_text(size = 12))</span></span>
<span id="cb385-9149"><a href="#cb385-9149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9150"><a href="#cb385-9150" aria-hidden="true" tabindex="-1"></a><span class="in">plot</span></span>
<span id="cb385-9151"><a href="#cb385-9151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9152"><a href="#cb385-9152" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-9153"><a href="#cb385-9153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9154"><a href="#cb385-9154" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-9155"><a href="#cb385-9155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9156"><a href="#cb385-9156" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If we compare the effective chill ranges with winter temperatures at the three locations, we can see that in Klein-Altendorf and Beijing, temperatures are quite often cooler than the effective temperature range for chill accumulation.</span>
<span id="cb385-9157"><a href="#cb385-9157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9158"><a href="#cb385-9158" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>At Davis, this is rarely the case. Temperatures that are too warm for chill accumulation occur quite frequently at Davis, and occasionally at the other two locations. This means that at Davis, it is reasonable to expect that warm temperatures in winter reduce chill accumulation.</span>
<span id="cb385-9159"><a href="#cb385-9159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9160"><a href="#cb385-9160" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In the other two locations, this is not always the case. When it is relatively cold, warming may actually increase chill. When temperatures are relatively high, however, chill accumulation would be reduced by warming.</span>
<span id="cb385-9161"><a href="#cb385-9161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9162"><a href="#cb385-9162" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>At these two locations, there is thus no monotonic relationship between temperature and chill accumulation. In such a setting, we shouldn’t expect PLS regression to produce clear results.</span>
<span id="cb385-9163"><a href="#cb385-9163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9164"><a href="#cb385-9164" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-9165"><a href="#cb385-9165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9166"><a href="#cb385-9166" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;22.3&lt;/span&gt;&amp;nbsp; Exercises on chill model comparison</span></span>
<span id="cb385-9167"><a href="#cb385-9167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9168"><a href="#cb385-9168" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-9169"><a href="#cb385-9169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9170"><a href="#cb385-9170" aria-hidden="true" tabindex="-1"></a>***1. Briefly explain in what climatic settings we can expect PLS regression to detect the chilling phase&amp;mdash; and in what settings this probably won’t work.***</span>
<span id="cb385-9171"><a href="#cb385-9171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9172"><a href="#cb385-9172" aria-hidden="true" tabindex="-1"></a>We can expect PLS regression to detect the chilling phase in relatively warmer climate where the temperature and chill accumulation have a monotonic relationship<span class="dv">&amp;mdash;</span> warmer temperature during the chilling phase consistently reduces chill accumulation. </span>
<span id="cb385-9173"><a href="#cb385-9173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9174"><a href="#cb385-9174" aria-hidden="true" tabindex="-1"></a>This probably won't work in colder climate where the temperature and chill accumulation do not have a monotonic relationship, i.e. when temperatures fall below the effective chill portions range, warmer temperatures may actually contribute to better chill accumulation, while temperatures exceeding the effective chill temperature range can reduce chill accumulation.</span>
<span id="cb385-9175"><a href="#cb385-9175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9176"><a href="#cb385-9176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9177"><a href="#cb385-9177" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-9178"><a href="#cb385-9178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9179"><a href="#cb385-9179" aria-hidden="true" tabindex="-1"></a>***2. How could we overcome this problem?***</span>
<span id="cb385-9180"><a href="#cb385-9180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9181"><a href="#cb385-9181" aria-hidden="true" tabindex="-1"></a>The answer to this question is in the next chapter but I have not read the next chapter yet, so I will answer based on the information given in this chapter.</span>
<span id="cb385-9182"><a href="#cb385-9182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9183"><a href="#cb385-9183" aria-hidden="true" tabindex="-1"></a>In the examples of Beijing and Campus Klein-Altendorf, PLS regression was used to correlate the daily mean temperatures with first flowering dates. As pointed out in the lecture, the PLS could not capture chilling phase in these two colder regions, because a monotonic relationship between temperature and flowering response was not observed. When an increase in temperature can contribute to both advanced and delayed flowering response,the PLS will consider this inconsistent trend as no significant correlation<span class="dv">&amp;mdash;</span> that's why we cannot observe a proper chilling phase in the two examples. </span>
<span id="cb385-9184"><a href="#cb385-9184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9185"><a href="#cb385-9185" aria-hidden="true" tabindex="-1"></a>To overcome this problem, we need a new independent variable other than temperature. </span>
<span id="cb385-9186"><a href="#cb385-9186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9187"><a href="#cb385-9187" aria-hidden="true" tabindex="-1"></a>So, instead of correlating like this:</span>
<span id="cb385-9188"><a href="#cb385-9188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9189"><a href="#cb385-9189" aria-hidden="true" tabindex="-1"></a>$$Temperature \rightarrow First~flowering~date$$</span>
<span id="cb385-9190"><a href="#cb385-9190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9191"><a href="#cb385-9191" aria-hidden="true" tabindex="-1"></a>What if we draw the correlation like this:</span>
<span id="cb385-9192"><a href="#cb385-9192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9193"><a href="#cb385-9193" aria-hidden="true" tabindex="-1"></a>$$Temperature \rightarrow Chill~hour \rightarrow First~flowering~date$$</span>
<span id="cb385-9194"><a href="#cb385-9194" aria-hidden="true" tabindex="-1"></a>Daily chill hours will have monotonic relationship with the flowering response *(What about excess chill hours? Can that be a problem too, as in normally more chill accumulation during chilling phase leads to earlier bloom date but too much chill accumulation leads to delayed bloom date? Will it still be monotonic if the chill portions/hours exceed the effective range or amount&amp;mdash; can extremely low temperature delay bloom and should we consider this as well? Or this is not a problem at all because of the trend of warmer temperatures- global warming?)*. Therefore, the PLS would be able to identify a correlation, if one exists. Maybe we can calculate daily chill hours from the hourly temperature record and the effective chill temperature range of the location. Then, we can correlate chill hours with the first flowering dates<span class="dv">&amp;mdash;</span> the PLS method can then detect the chilling phase. </span>
<span id="cb385-9195"><a href="#cb385-9195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9196"><a href="#cb385-9196" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-9197"><a href="#cb385-9197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9198"><a href="#cb385-9198" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 23: PLS regression with agroclimatic metrics</span></span>
<span id="cb385-9199"><a href="#cb385-9199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9200"><a href="#cb385-9200" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;23.1&lt;/span&gt;&amp;nbsp; Adjusting PLS for use with non-monotonic relationships </span></span>
<span id="cb385-9201"><a href="#cb385-9201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9202"><a href="#cb385-9202" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-9203"><a href="#cb385-9203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9204"><a href="#cb385-9204" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The most likely reason why PLS regression failed to pick up the chilling period in relatively cold locations is that there is no monotonic relationship between temperature and chill effectiveness, i.e. warmer temperatures may either lead to less chill (when it’s fairly warm) or more chill (when it’s cold). </span>
<span id="cb385-9205"><a href="#cb385-9205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9206"><a href="#cb385-9206" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To overcome this problem, we need to convert temperature into something that is monotonically related to chill accumulation, maybe by making use of the chill models. </span>
<span id="cb385-9207"><a href="#cb385-9207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9208"><a href="#cb385-9208" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If PLS holds its promise to identify chilling periods, it should be responsive to the daily rate of chill accumulation. </span>
<span id="cb385-9209"><a href="#cb385-9209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9210"><a href="#cb385-9210" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This brings us back to an old problem<span class="dv">&amp;mdash;</span> we don’t really know how to quantify chill accumulation accurately, and we don’t really trust the models we have. But, let's swallow this concerns for now.</span>
<span id="cb385-9211"><a href="#cb385-9211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9212"><a href="#cb385-9212" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>***We’ll be converting temperature data to chill (and heat) accumulation to run PLS analyses. This strategy assumes that the respective chill and heat models are reasonable approximations of the underlying biology.***</span>
<span id="cb385-9213"><a href="#cb385-9213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9214"><a href="#cb385-9214" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-9215"><a href="#cb385-9215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9216"><a href="#cb385-9216" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;23.2&lt;/span&gt;&amp;nbsp; PLS analysis with chilling and forcing data</span></span>
<span id="cb385-9217"><a href="#cb385-9217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9218"><a href="#cb385-9218" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-9219"><a href="#cb385-9219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9220"><a href="#cb385-9220" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The <span class="in">`chillR`</span> package has a function called <span class="in">`PLS_chill_force`</span> that implements PLS analysis based on daily chill and heat accumulation rates.</span>
<span id="cb385-9221"><a href="#cb385-9221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9222"><a href="#cb385-9222" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When you look at the documentation of the <span class="in">`PLS_chill_force`</span> function (e.g. by typing <span class="in">`?PLS_chill_force`</span>), you’ll see that this function requires a daily chill object (<span class="in">`daily_chill_obj`</span>) as an input. This object contains daily chill and heat accumulation rates, as well as mean temperature data. (More info in documentation of <span class="in">`daily_chill`</span>)</span>
<span id="cb385-9223"><a href="#cb385-9223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9224"><a href="#cb385-9224" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Let's test on the first bloom dates of ‘Alexander Lucas’ pears in Klein-Altendorf. So we’ll start by applying the <span class="in">`daily_chill`</span> function to produce such a daily chill object. We’ll also use a standard function in <span class="in">`chillR`</span> (<span class="in">`make_daily_chill_plot2`</span>) to plot daily chill accumulation:</span>
<span id="cb385-9225"><a href="#cb385-9225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9226"><a href="#cb385-9226" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 23.2a}</span></span>
<span id="cb385-9227"><a href="#cb385-9227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9228"><a href="#cb385-9228" aria-hidden="true" tabindex="-1"></a><span class="in">#library(chillR)</span></span>
<span id="cb385-9229"><a href="#cb385-9229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9230"><a href="#cb385-9230" aria-hidden="true" tabindex="-1"></a><span class="in"># daily_chill function calculates calculates daily chill (with three models) </span></span>
<span id="cb385-9231"><a href="#cb385-9231" aria-hidden="true" tabindex="-1"></a><span class="in"># and heat accumulation for every day of an hourly temperature record </span></span>
<span id="cb385-9232"><a href="#cb385-9232" aria-hidden="true" tabindex="-1"></a><span class="in"># (best generated with stack_hourly_temps)</span></span>
<span id="cb385-9233"><a href="#cb385-9233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9234"><a href="#cb385-9234" aria-hidden="true" tabindex="-1"></a><span class="in"># It includes the option to include calculation of a running mean, which smoothes </span></span>
<span id="cb385-9235"><a href="#cb385-9235" aria-hidden="true" tabindex="-1"></a><span class="in"># accumulation curves. Especially for the Dynamic Model, this may be advisable, </span></span>
<span id="cb385-9236"><a href="#cb385-9236" aria-hidden="true" tabindex="-1"></a><span class="in"># because it does not accumulate chill smoothly, but rather in steps.</span></span>
<span id="cb385-9237"><a href="#cb385-9237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9238"><a href="#cb385-9238" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate an hourly temperature record</span></span>
<span id="cb385-9239"><a href="#cb385-9239" aria-hidden="true" tabindex="-1"></a><span class="in">temps_hourly &lt;- read_tab("data/OT/TMaxTMin1958-2019_patched.csv") %&gt;%</span></span>
<span id="cb385-9240"><a href="#cb385-9240" aria-hidden="true" tabindex="-1"></a><span class="in">  stack_hourly_temps(latitude = 50.6)</span></span>
<span id="cb385-9241"><a href="#cb385-9241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9242"><a href="#cb385-9242" aria-hidden="true" tabindex="-1"></a><span class="in">kable(head(temps_hourly$hourtemps)) %&gt;%</span></span>
<span id="cb385-9243"><a href="#cb385-9243" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-9244"><a href="#cb385-9244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9245"><a href="#cb385-9245" aria-hidden="true" tabindex="-1"></a><span class="in"># Apply the daily_chill function</span></span>
<span id="cb385-9246"><a href="#cb385-9246" aria-hidden="true" tabindex="-1"></a><span class="in">daychill &lt;- daily_chill(hourtemps = temps_hourly,</span></span>
<span id="cb385-9247"><a href="#cb385-9247" aria-hidden="true" tabindex="-1"></a><span class="in">                        running_mean = 1, # 1 (default) for no smoothing</span></span>
<span id="cb385-9248"><a href="#cb385-9248" aria-hidden="true" tabindex="-1"></a><span class="in">                        models = list(</span></span>
<span id="cb385-9249"><a href="#cb385-9249" aria-hidden="true" tabindex="-1"></a><span class="in">                          Chilling_Hours = Chilling_Hours,</span></span>
<span id="cb385-9250"><a href="#cb385-9250" aria-hidden="true" tabindex="-1"></a><span class="in">                          Utah_Chill_Units = Utah_Model,</span></span>
<span id="cb385-9251"><a href="#cb385-9251" aria-hidden="true" tabindex="-1"></a><span class="in">                          Chill_Portions = Dynamic_Model,</span></span>
<span id="cb385-9252"><a href="#cb385-9252" aria-hidden="true" tabindex="-1"></a><span class="in">                          GDH = GDH)</span></span>
<span id="cb385-9253"><a href="#cb385-9253" aria-hidden="true" tabindex="-1"></a><span class="in">                        )</span></span>
<span id="cb385-9254"><a href="#cb385-9254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9255"><a href="#cb385-9255" aria-hidden="true" tabindex="-1"></a><span class="in">kable(head(daychill$daily_chill)) %&gt;%</span></span>
<span id="cb385-9256"><a href="#cb385-9256" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-9257"><a href="#cb385-9257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9258"><a href="#cb385-9258" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot daily chill accumulation</span></span>
<span id="cb385-9259"><a href="#cb385-9259" aria-hidden="true" tabindex="-1"></a><span class="in">dc &lt;- make_daily_chill_plot2(daychill,</span></span>
<span id="cb385-9260"><a href="#cb385-9260" aria-hidden="true" tabindex="-1"></a><span class="in">                             metrics = c("Chill_Portions"),</span></span>
<span id="cb385-9261"><a href="#cb385-9261" aria-hidden="true" tabindex="-1"></a><span class="in">                             cumulative = FALSE, # show daily accumulation rates</span></span>
<span id="cb385-9262"><a href="#cb385-9262" aria-hidden="true" tabindex="-1"></a><span class="in">                             startdate = 300,</span></span>
<span id="cb385-9263"><a href="#cb385-9263" aria-hidden="true" tabindex="-1"></a><span class="in">                             enddate = 30,</span></span>
<span id="cb385-9264"><a href="#cb385-9264" aria-hidden="true" tabindex="-1"></a><span class="in">                             focusyears = c(2008), # highlight specific year</span></span>
<span id="cb385-9265"><a href="#cb385-9265" aria-hidden="true" tabindex="-1"></a><span class="in">                             metriclabels = "Chill Portions")</span></span>
<span id="cb385-9266"><a href="#cb385-9266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9267"><a href="#cb385-9267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-9268"><a href="#cb385-9268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9269"><a href="#cb385-9269" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-9270"><a href="#cb385-9270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9271"><a href="#cb385-9271" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We can also switch to cumulative view to illustrate how chill accumulation in a particular year differs from historic accumulation patterns.</span>
<span id="cb385-9272"><a href="#cb385-9272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9273"><a href="#cb385-9273" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 23.2b}</span></span>
<span id="cb385-9274"><a href="#cb385-9274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9275"><a href="#cb385-9275" aria-hidden="true" tabindex="-1"></a><span class="in">dc &lt;- make_daily_chill_plot2(daychill,</span></span>
<span id="cb385-9276"><a href="#cb385-9276" aria-hidden="true" tabindex="-1"></a><span class="in">                             metrics = c("Chill_Portions"),</span></span>
<span id="cb385-9277"><a href="#cb385-9277" aria-hidden="true" tabindex="-1"></a><span class="in">                             cumulative = TRUE, # show as cumulative accumulation</span></span>
<span id="cb385-9278"><a href="#cb385-9278" aria-hidden="true" tabindex="-1"></a><span class="in">                             startdate = 300,</span></span>
<span id="cb385-9279"><a href="#cb385-9279" aria-hidden="true" tabindex="-1"></a><span class="in">                             enddate = 30,</span></span>
<span id="cb385-9280"><a href="#cb385-9280" aria-hidden="true" tabindex="-1"></a><span class="in">                             focusyears = c(2008),</span></span>
<span id="cb385-9281"><a href="#cb385-9281" aria-hidden="true" tabindex="-1"></a><span class="in">                             metriclabels = "Chill Portions")</span></span>
<span id="cb385-9282"><a href="#cb385-9282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9283"><a href="#cb385-9283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-9284"><a href="#cb385-9284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9285"><a href="#cb385-9285" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-9286"><a href="#cb385-9286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9287"><a href="#cb385-9287" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>One special feature in this plot are the double ticks on the x-axis. These account for the additional day (29^th^ February) that is added to the year in leap years. These leap days make Julian dates not map to precisely the same calendar dates in each year. The double ticks are an attempt to do justice to this ambiguity.</span>
<span id="cb385-9288"><a href="#cb385-9288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9289"><a href="#cb385-9289" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We can now feed this daily chill object to the <span class="in">`PLS_chill_force`</span> function. We’ll also need the pear bloom data again:</span>
<span id="cb385-9290"><a href="#cb385-9290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9291"><a href="#cb385-9291" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 23.2c}</span></span>
<span id="cb385-9292"><a href="#cb385-9292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9293"><a href="#cb385-9293" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a data.frame with year and JDay of first bloom date</span></span>
<span id="cb385-9294"><a href="#cb385-9294" aria-hidden="true" tabindex="-1"></a><span class="in"># This is a required format for PLS_chill_force function</span></span>
<span id="cb385-9295"><a href="#cb385-9295" aria-hidden="true" tabindex="-1"></a><span class="in">Alex_first &lt;- read_tab("data/OT/Alexander_Lucas_bloom_1958_2019.csv") %&gt;%</span></span>
<span id="cb385-9296"><a href="#cb385-9296" aria-hidden="true" tabindex="-1"></a><span class="in">  select(Pheno_year, First_bloom) %&gt;%</span></span>
<span id="cb385-9297"><a href="#cb385-9297" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Year = as.numeric(substr(First_bloom, 1, 4)),</span></span>
<span id="cb385-9298"><a href="#cb385-9298" aria-hidden="true" tabindex="-1"></a><span class="in">         Month = as.numeric(substr(First_bloom, 5, 6)),</span></span>
<span id="cb385-9299"><a href="#cb385-9299" aria-hidden="true" tabindex="-1"></a><span class="in">         Day = as.numeric(substr(First_bloom, 7, 8))) %&gt;%</span></span>
<span id="cb385-9300"><a href="#cb385-9300" aria-hidden="true" tabindex="-1"></a><span class="in">  make_JDay() %&gt;%</span></span>
<span id="cb385-9301"><a href="#cb385-9301" aria-hidden="true" tabindex="-1"></a><span class="in">  select(Pheno_year, </span></span>
<span id="cb385-9302"><a href="#cb385-9302" aria-hidden="true" tabindex="-1"></a><span class="in">         JDay) %&gt;%</span></span>
<span id="cb385-9303"><a href="#cb385-9303" aria-hidden="true" tabindex="-1"></a><span class="in">  rename(Year = Pheno_year,</span></span>
<span id="cb385-9304"><a href="#cb385-9304" aria-hidden="true" tabindex="-1"></a><span class="in">         pheno = JDay)</span></span>
<span id="cb385-9305"><a href="#cb385-9305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9306"><a href="#cb385-9306" aria-hidden="true" tabindex="-1"></a><span class="in"># PLS_chill_force function conducts a Partial Least Squares (PLS) regression </span></span>
<span id="cb385-9307"><a href="#cb385-9307" aria-hidden="true" tabindex="-1"></a><span class="in"># analysis relating an annual biological phenomenon, e.g. fruit tree flowering </span></span>
<span id="cb385-9308"><a href="#cb385-9308" aria-hidden="true" tabindex="-1"></a><span class="in"># or leaf emergence, to mean daily rates of chill (with three models) and heat </span></span>
<span id="cb385-9309"><a href="#cb385-9309" aria-hidden="true" tabindex="-1"></a><span class="in"># accumulation of the preceding 12 months. It produces figures that illustrate </span></span>
<span id="cb385-9310"><a href="#cb385-9310" aria-hidden="true" tabindex="-1"></a><span class="in"># statistical correlations between temperature variation during certain phases </span></span>
<span id="cb385-9311"><a href="#cb385-9311" aria-hidden="true" tabindex="-1"></a><span class="in"># and the timing of phenological events.</span></span>
<span id="cb385-9312"><a href="#cb385-9312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9313"><a href="#cb385-9313" aria-hidden="true" tabindex="-1"></a><span class="in">plscf &lt;- PLS_chill_force(daily_chill_obj = daychill, #generate with daily_chill</span></span>
<span id="cb385-9314"><a href="#cb385-9314" aria-hidden="true" tabindex="-1"></a><span class="in">                         bio_data_frame = Alex_first,#Year and Pheno format only</span></span>
<span id="cb385-9315"><a href="#cb385-9315" aria-hidden="true" tabindex="-1"></a><span class="in">                         split_month = 6,#last month for a given phenological year; all subsequent months in the following year </span></span>
<span id="cb385-9316"><a href="#cb385-9316" aria-hidden="true" tabindex="-1"></a><span class="in">                         chill_models = "Chill_Portions",</span></span>
<span id="cb385-9317"><a href="#cb385-9317" aria-hidden="true" tabindex="-1"></a><span class="in">                         heat_models = "GDH")</span></span>
<span id="cb385-9318"><a href="#cb385-9318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9319"><a href="#cb385-9319" aria-hidden="true" tabindex="-1"></a><span class="in">kable(head(plscf$Chill_Portions$GDH$PLS_summary)) %&gt;%</span></span>
<span id="cb385-9320"><a href="#cb385-9320" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb385-9321"><a href="#cb385-9321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9322"><a href="#cb385-9322" aria-hidden="true" tabindex="-1"></a><span class="in"># We could have specified multiple chill and heat models, and the function would</span></span>
<span id="cb385-9323"><a href="#cb385-9323" aria-hidden="true" tabindex="-1"></a><span class="in"># have evaluated all combinations of these models. This is why, to find the </span></span>
<span id="cb385-9324"><a href="#cb385-9324" aria-hidden="true" tabindex="-1"></a><span class="in"># results, we have to look at plscf$Chill_Portions$GDH$PLS_summary</span></span>
<span id="cb385-9325"><a href="#cb385-9325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9326"><a href="#cb385-9326" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the results with the inbuilt function plot_PLS, which is a fairly old</span></span>
<span id="cb385-9327"><a href="#cb385-9327" aria-hidden="true" tabindex="-1"></a><span class="in"># function that writes an image in a place you can specify.</span></span>
<span id="cb385-9328"><a href="#cb385-9328" aria-hidden="true" tabindex="-1"></a><span class="in"># This gives output in png and csv file.</span></span>
<span id="cb385-9329"><a href="#cb385-9329" aria-hidden="true" tabindex="-1"></a><span class="in">plot_PLS(plscf,</span></span>
<span id="cb385-9330"><a href="#cb385-9330" aria-hidden="true" tabindex="-1"></a><span class="in">         PLS_results_path = "data/OT/plscf_outputs") </span></span>
<span id="cb385-9331"><a href="#cb385-9331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9332"><a href="#cb385-9332" aria-hidden="true" tabindex="-1"></a><span class="in"># Call the generated result image</span></span>
<span id="cb385-9333"><a href="#cb385-9333" aria-hidden="true" tabindex="-1"></a><span class="in">grid.raster(readPNG("data/OT/plscf_outputs_Chill_Portions_GDH.png"))</span></span>
<span id="cb385-9334"><a href="#cb385-9334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9335"><a href="#cb385-9335" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-9336"><a href="#cb385-9336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9337"><a href="#cb385-9337" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-9338"><a href="#cb385-9338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9339"><a href="#cb385-9339" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The results don’t look very clear quite yet. To a considerable extent, this is because we didn’t use a running mean to smooth the chill and heat data. Especially for the Dynamic Model, this is worth considering, because Chill Portions accumulate in a stepwise manner, rather than continuously. Such steps aren’t reached every day, which adds a random element to estimations of daily rates. </span>
<span id="cb385-9340"><a href="#cb385-9340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9341"><a href="#cb385-9341" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Let’s apply an 11-day running mean and plot the results again:</span>
<span id="cb385-9342"><a href="#cb385-9342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9343"><a href="#cb385-9343" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 23.2d}</span></span>
<span id="cb385-9344"><a href="#cb385-9344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9345"><a href="#cb385-9345" aria-hidden="true" tabindex="-1"></a><span class="in">plscf &lt;- PLS_chill_force(daily_chill_obj = daychill,</span></span>
<span id="cb385-9346"><a href="#cb385-9346" aria-hidden="true" tabindex="-1"></a><span class="in">                         bio_data_frame=Alex_first,</span></span>
<span id="cb385-9347"><a href="#cb385-9347" aria-hidden="true" tabindex="-1"></a><span class="in">                         split_month = 6,</span></span>
<span id="cb385-9348"><a href="#cb385-9348" aria-hidden="true" tabindex="-1"></a><span class="in">                         chill_models = "Chill_Portions",</span></span>
<span id="cb385-9349"><a href="#cb385-9349" aria-hidden="true" tabindex="-1"></a><span class="in">                         heat_models = "GDH",</span></span>
<span id="cb385-9350"><a href="#cb385-9350" aria-hidden="true" tabindex="-1"></a><span class="in">                         runn_means = 11)</span></span>
<span id="cb385-9351"><a href="#cb385-9351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9352"><a href="#cb385-9352" aria-hidden="true" tabindex="-1"></a><span class="in">plot_PLS(plscf,</span></span>
<span id="cb385-9353"><a href="#cb385-9353" aria-hidden="true" tabindex="-1"></a><span class="in">         PLS_results_path = "data/OT/plscf_outputs_11days")</span></span>
<span id="cb385-9354"><a href="#cb385-9354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9355"><a href="#cb385-9355" aria-hidden="true" tabindex="-1"></a><span class="in">grid.raster(readPNG("data/OT/plscf_outputs_11days_Chill_Portions_GDH.png"))</span></span>
<span id="cb385-9356"><a href="#cb385-9356" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-9357"><a href="#cb385-9357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9358"><a href="#cb385-9358" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-9359"><a href="#cb385-9359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9360"><a href="#cb385-9360" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This looks a lot clearer now. We see two plots here, with the one on the left showing the relationship between bloom dates and chill accumulation, and the one on the right showing the same for heat accumulation. </span>
<span id="cb385-9361"><a href="#cb385-9361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9362"><a href="#cb385-9362" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Note that these are plotted in different panels, but they emerged from the same PLS analysis, which thus related bloom dates to a total of 730 independent variables<span class="dv">&amp;mdash;</span> chill and heat accumulation dates for each calendar day (if you set <span class="in">`end_at_pheno_end = TRUE`</span>, minus all days after the latest bloom date).</span>
<span id="cb385-9363"><a href="#cb385-9363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9364"><a href="#cb385-9364" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To find the chilling and forcing periods, we should now look for consistent periods of negative model coefficients on both sides of the figure. For the chilling period, we’ll look on the left, where the relationship of bloom dates with daily chill accumulation rates is shown, and for the forcing period, we’ll look right, where the same is shown for daily heat accumulation rates.</span>
<span id="cb385-9365"><a href="#cb385-9365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9366"><a href="#cb385-9366" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Again, the forcing period is easier to see than the chilling phase. It’s approximately between early January and the bloom date (between mid-March and early May). </span>
<span id="cb385-9367"><a href="#cb385-9367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9368"><a href="#cb385-9368" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The chilling period is still a bit hard to see, but we can now detect a phase between some point in November or early December and February where high chill accumulation rates are correlated with early bloom.</span>
<span id="cb385-9369"><a href="#cb385-9369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9370"><a href="#cb385-9370" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In these delineations, I recommend to not focus too narrowly on ‘important’ values, but rather take a broad perspective in evaluating model coefficient dynamics.</span>
<span id="cb385-9371"><a href="#cb385-9371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9372"><a href="#cb385-9372" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Always remember that PLS regression with small datasets may struggle to distinguish signals from noise, with random effects easily creeping in. We also need to remember that our chill and heat models aren’t perfect and that they don’t actually include much knowledge on dormancy physiology.</span>
<span id="cb385-9373"><a href="#cb385-9373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9374"><a href="#cb385-9374" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-9375"><a href="#cb385-9375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9376"><a href="#cb385-9376" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;23.3&lt;/span&gt;&amp;nbsp; Delineating chilling and forcing periods</span></span>
<span id="cb385-9377"><a href="#cb385-9377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9378"><a href="#cb385-9378" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-9379"><a href="#cb385-9379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9380"><a href="#cb385-9380" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The precise delineations of chilling and forcing periods are often a bit debatable, and there have often been slight disagreements about the precise dates to use.</span>
<span id="cb385-9381"><a href="#cb385-9381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9382"><a href="#cb385-9382" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>I would recommend taking both the plot and the detailed results table into account in deciding when periods start and end. More importantly, consider what you know about tree dormancy! ***Never lose sight of the ecological theory behind your analysis when you evaluate the results.***</span>
<span id="cb385-9383"><a href="#cb385-9383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9384"><a href="#cb385-9384" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>My call on the present dataset would be a chilling period between 13^th^ November and 3^rd^ March (Julian dates -48 to 62) and a forcing period between 3^rd^ January and the date of bloom (Julian dates 3 to 105.5, which represents the median of all bloom dates).</span>
<span id="cb385-9385"><a href="#cb385-9385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9386"><a href="#cb385-9386" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 23.3a}</span></span>
<span id="cb385-9387"><a href="#cb385-9387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9388"><a href="#cb385-9388" aria-hidden="true" tabindex="-1"></a><span class="in">plot_PLS(plscf,</span></span>
<span id="cb385-9389"><a href="#cb385-9389" aria-hidden="true" tabindex="-1"></a><span class="in">         PLS_results_path = "data/OT/plscf_outputs_11days_periods",</span></span>
<span id="cb385-9390"><a href="#cb385-9390" aria-hidden="true" tabindex="-1"></a><span class="in">         add_chill = c(-48,62),</span></span>
<span id="cb385-9391"><a href="#cb385-9391" aria-hidden="true" tabindex="-1"></a><span class="in">         add_heat = c(3,105.5))</span></span>
<span id="cb385-9392"><a href="#cb385-9392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9393"><a href="#cb385-9393" aria-hidden="true" tabindex="-1"></a><span class="in"># grid.raster(readPNG("data/OT/plscf_outputs_11days_periods_Chill_Portions_GDH.png"))</span></span>
<span id="cb385-9394"><a href="#cb385-9394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9395"><a href="#cb385-9395" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-9396"><a href="#cb385-9396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9397"><a href="#cb385-9397" aria-hidden="true" tabindex="-1"></a><span class="al">![***Plot of `PLS_chill_force` results, with our delineations of chilling (light blue) and forcing (light red) phases highlighted***](./data/OT/plscf_outputs_11days_periods_Chill_Portions_GDH.png)</span></span>
<span id="cb385-9398"><a href="#cb385-9398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9399"><a href="#cb385-9399" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-9400"><a href="#cb385-9400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9401"><a href="#cb385-9401" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;23.4&lt;/span&gt;&amp;nbsp; `ggplot`ting the results</span></span>
<span id="cb385-9402"><a href="#cb385-9402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9403"><a href="#cb385-9403" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-9404"><a href="#cb385-9404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9405"><a href="#cb385-9405" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The only real change is that we need to split the results according to chill vs. heat analysis. We’ll use <span class="in">`facet_wrap`</span> for this.</span>
<span id="cb385-9406"><a href="#cb385-9406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9407"><a href="#cb385-9407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9408"><a href="#cb385-9408" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 23.4a}</span></span>
<span id="cb385-9409"><a href="#cb385-9409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9410"><a href="#cb385-9410" aria-hidden="true" tabindex="-1"></a><span class="in">## First we need to prepare the data for `ggplot`ting:</span></span>
<span id="cb385-9411"><a href="#cb385-9411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9412"><a href="#cb385-9412" aria-hidden="true" tabindex="-1"></a><span class="in"># Date chillR format date</span></span>
<span id="cb385-9413"><a href="#cb385-9413" aria-hidden="true" tabindex="-1"></a><span class="in">PLS_gg &lt;- plscf$Chill_Portions$GDH$PLS_summary %&gt;%</span></span>
<span id="cb385-9414"><a href="#cb385-9414" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Month = trunc(Date/100), # round number towards 0</span></span>
<span id="cb385-9415"><a href="#cb385-9415" aria-hidden="true" tabindex="-1"></a><span class="in">         Day = Date - Month * 100,</span></span>
<span id="cb385-9416"><a href="#cb385-9416" aria-hidden="true" tabindex="-1"></a><span class="in">         Date = ISOdate(2002,</span></span>
<span id="cb385-9417"><a href="#cb385-9417" aria-hidden="true" tabindex="-1"></a><span class="in">                        Month,</span></span>
<span id="cb385-9418"><a href="#cb385-9418" aria-hidden="true" tabindex="-1"></a><span class="in">                        Day))</span></span>
<span id="cb385-9419"><a href="#cb385-9419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9420"><a href="#cb385-9420" aria-hidden="true" tabindex="-1"></a><span class="in"># Change year to last year for JDay less than or equal to zero (-JDay)</span></span>
<span id="cb385-9421"><a href="#cb385-9421" aria-hidden="true" tabindex="-1"></a><span class="in">PLS_gg[PLS_gg$JDay &lt;= 0,"Date"]&lt;-</span></span>
<span id="cb385-9422"><a href="#cb385-9422" aria-hidden="true" tabindex="-1"></a><span class="in">  ISOdate(2001,</span></span>
<span id="cb385-9423"><a href="#cb385-9423" aria-hidden="true" tabindex="-1"></a><span class="in">          PLS_gg$Month[PLS_gg$JDay &lt;= 0],</span></span>
<span id="cb385-9424"><a href="#cb385-9424" aria-hidden="true" tabindex="-1"></a><span class="in">          PLS_gg$Day[PLS_gg$JDay &lt;= 0])</span></span>
<span id="cb385-9425"><a href="#cb385-9425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9426"><a href="#cb385-9426" aria-hidden="true" tabindex="-1"></a><span class="in"># sign(Coef) gives a vector of 1, 0, -1, multiplied by VIP_importance (1 or 0). </span></span>
<span id="cb385-9427"><a href="#cb385-9427" aria-hidden="true" tabindex="-1"></a><span class="in"># Then, use factor to keep it categorical. </span></span>
<span id="cb385-9428"><a href="#cb385-9428" aria-hidden="true" tabindex="-1"></a><span class="in"># Add VIP_importance (TRUE, FALSE) and VIP_Coeff (1, -1, 0) columns.</span></span>
<span id="cb385-9429"><a href="#cb385-9429" aria-hidden="true" tabindex="-1"></a><span class="in">PLS_gg &lt;- PLS_gg %&gt;%</span></span>
<span id="cb385-9430"><a href="#cb385-9430" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(VIP_importance = VIP &gt;= 0.8,</span></span>
<span id="cb385-9431"><a href="#cb385-9431" aria-hidden="true" tabindex="-1"></a><span class="in">         VIP_Coeff = factor(sign(Coef) * VIP_importance))</span></span>
<span id="cb385-9432"><a href="#cb385-9432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9433"><a href="#cb385-9433" aria-hidden="true" tabindex="-1"></a><span class="in"># We decide this based on csv and graph outputs?</span></span>
<span id="cb385-9434"><a href="#cb385-9434" aria-hidden="true" tabindex="-1"></a><span class="in">chill_start_JDay &lt;- -48</span></span>
<span id="cb385-9435"><a href="#cb385-9435" aria-hidden="true" tabindex="-1"></a><span class="in">chill_end_JDay &lt;- 62</span></span>
<span id="cb385-9436"><a href="#cb385-9436" aria-hidden="true" tabindex="-1"></a><span class="in">heat_start_JDay &lt;- 3</span></span>
<span id="cb385-9437"><a href="#cb385-9437" aria-hidden="true" tabindex="-1"></a><span class="in">heat_end_JDay &lt;- 105.5</span></span>
<span id="cb385-9438"><a href="#cb385-9438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9439"><a href="#cb385-9439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9440"><a href="#cb385-9440" aria-hidden="true" tabindex="-1"></a><span class="in"># Convert JDay into Date (change JDay to seconds and then add)</span></span>
<span id="cb385-9441"><a href="#cb385-9441" aria-hidden="true" tabindex="-1"></a><span class="in">chill_start_date &lt;- ISOdate(2001,</span></span>
<span id="cb385-9442"><a href="#cb385-9442" aria-hidden="true" tabindex="-1"></a><span class="in">                            12,</span></span>
<span id="cb385-9443"><a href="#cb385-9443" aria-hidden="true" tabindex="-1"></a><span class="in">                            31) + chill_start_JDay * 24 * 3600</span></span>
<span id="cb385-9444"><a href="#cb385-9444" aria-hidden="true" tabindex="-1"></a><span class="in">chill_end_date &lt;- ISOdate(2001,</span></span>
<span id="cb385-9445"><a href="#cb385-9445" aria-hidden="true" tabindex="-1"></a><span class="in">                          12,</span></span>
<span id="cb385-9446"><a href="#cb385-9446" aria-hidden="true" tabindex="-1"></a><span class="in">                          31) + chill_end_JDay * 24 * 3600</span></span>
<span id="cb385-9447"><a href="#cb385-9447" aria-hidden="true" tabindex="-1"></a><span class="in">heat_start_date &lt;- ISOdate(2001,</span></span>
<span id="cb385-9448"><a href="#cb385-9448" aria-hidden="true" tabindex="-1"></a><span class="in">                           12,</span></span>
<span id="cb385-9449"><a href="#cb385-9449" aria-hidden="true" tabindex="-1"></a><span class="in">                           31) + heat_start_JDay * 24 * 3600</span></span>
<span id="cb385-9450"><a href="#cb385-9450" aria-hidden="true" tabindex="-1"></a><span class="in">heat_end_date &lt;- ISOdate(2001,</span></span>
<span id="cb385-9451"><a href="#cb385-9451" aria-hidden="true" tabindex="-1"></a><span class="in">                         12,</span></span>
<span id="cb385-9452"><a href="#cb385-9452" aria-hidden="true" tabindex="-1"></a><span class="in">                         31) + heat_end_JDay * 24 * 3600</span></span>
<span id="cb385-9453"><a href="#cb385-9453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9454"><a href="#cb385-9454" aria-hidden="true" tabindex="-1"></a><span class="in">## This time we’ll start with the bottom plot, because that’s the most </span></span>
<span id="cb385-9455"><a href="#cb385-9455" aria-hidden="true" tabindex="-1"></a><span class="in">## complicated one. It’s complicated, because we need to put different labels on</span></span>
<span id="cb385-9456"><a href="#cb385-9456" aria-hidden="true" tabindex="-1"></a><span class="in">## the y-axes of the two facets.</span></span>
<span id="cb385-9457"><a href="#cb385-9457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9458"><a href="#cb385-9458" aria-hidden="true" tabindex="-1"></a><span class="in">## Since the daily chill accumulation rate is between 0 and ~1 Chill Portions, </span></span>
<span id="cb385-9459"><a href="#cb385-9459" aria-hidden="true" tabindex="-1"></a><span class="in">## and the daily heat accumulation rate can reach 300 GDH and more, we also need </span></span>
<span id="cb385-9460"><a href="#cb385-9460" aria-hidden="true" tabindex="-1"></a><span class="in">## different scales for the axes. </span></span>
<span id="cb385-9461"><a href="#cb385-9461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9462"><a href="#cb385-9462" aria-hidden="true" tabindex="-1"></a><span class="in">## We’ll start with the hardest plot, because the way we solve these problems </span></span>
<span id="cb385-9463"><a href="#cb385-9463" aria-hidden="true" tabindex="-1"></a><span class="in">## may have implications for how we have to construct the other plots.</span></span>
<span id="cb385-9464"><a href="#cb385-9464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9465"><a href="#cb385-9465" aria-hidden="true" tabindex="-1"></a><span class="in">#library(ggplot2)</span></span>
<span id="cb385-9466"><a href="#cb385-9466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9467"><a href="#cb385-9467" aria-hidden="true" tabindex="-1"></a><span class="in">temp_plot &lt;- ggplot(PLS_gg,</span></span>
<span id="cb385-9468"><a href="#cb385-9468" aria-hidden="true" tabindex="-1"></a><span class="in">                    x = Date) +</span></span>
<span id="cb385-9469"><a href="#cb385-9469" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("rect", # add shaded rectangular box</span></span>
<span id="cb385-9470"><a href="#cb385-9470" aria-hidden="true" tabindex="-1"></a><span class="in">           xmin = chill_start_date,</span></span>
<span id="cb385-9471"><a href="#cb385-9471" aria-hidden="true" tabindex="-1"></a><span class="in">           xmax = chill_end_date,</span></span>
<span id="cb385-9472"><a href="#cb385-9472" aria-hidden="true" tabindex="-1"></a><span class="in">           ymin = -Inf,</span></span>
<span id="cb385-9473"><a href="#cb385-9473" aria-hidden="true" tabindex="-1"></a><span class="in">           ymax = Inf,</span></span>
<span id="cb385-9474"><a href="#cb385-9474" aria-hidden="true" tabindex="-1"></a><span class="in">           alpha = .1, # transparency 10%</span></span>
<span id="cb385-9475"><a href="#cb385-9475" aria-hidden="true" tabindex="-1"></a><span class="in">           fill = "blue") +</span></span>
<span id="cb385-9476"><a href="#cb385-9476" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("rect",</span></span>
<span id="cb385-9477"><a href="#cb385-9477" aria-hidden="true" tabindex="-1"></a><span class="in">           xmin = heat_start_date,</span></span>
<span id="cb385-9478"><a href="#cb385-9478" aria-hidden="true" tabindex="-1"></a><span class="in">           xmax = heat_end_date,</span></span>
<span id="cb385-9479"><a href="#cb385-9479" aria-hidden="true" tabindex="-1"></a><span class="in">           ymin = -Inf,</span></span>
<span id="cb385-9480"><a href="#cb385-9480" aria-hidden="true" tabindex="-1"></a><span class="in">           ymax = Inf,</span></span>
<span id="cb385-9481"><a href="#cb385-9481" aria-hidden="true" tabindex="-1"></a><span class="in">           alpha = .1,</span></span>
<span id="cb385-9482"><a href="#cb385-9482" aria-hidden="true" tabindex="-1"></a><span class="in">           fill = "red") +</span></span>
<span id="cb385-9483"><a href="#cb385-9483" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("rect",</span></span>
<span id="cb385-9484"><a href="#cb385-9484" aria-hidden="true" tabindex="-1"></a><span class="in">           xmin = ISOdate(2001, # this gives earliest bloom date?</span></span>
<span id="cb385-9485"><a href="#cb385-9485" aria-hidden="true" tabindex="-1"></a><span class="in">                          12,</span></span>
<span id="cb385-9486"><a href="#cb385-9486" aria-hidden="true" tabindex="-1"></a><span class="in">                          31) +</span></span>
<span id="cb385-9487"><a href="#cb385-9487" aria-hidden="true" tabindex="-1"></a><span class="in">             min(plscf$pheno$pheno,</span></span>
<span id="cb385-9488"><a href="#cb385-9488" aria-hidden="true" tabindex="-1"></a><span class="in">                 na.rm = TRUE) * 24 * 3600,</span></span>
<span id="cb385-9489"><a href="#cb385-9489" aria-hidden="true" tabindex="-1"></a><span class="in">           xmax = ISOdate(2001, # latest bloom date?</span></span>
<span id="cb385-9490"><a href="#cb385-9490" aria-hidden="true" tabindex="-1"></a><span class="in">                          12,</span></span>
<span id="cb385-9491"><a href="#cb385-9491" aria-hidden="true" tabindex="-1"></a><span class="in">                          31) +</span></span>
<span id="cb385-9492"><a href="#cb385-9492" aria-hidden="true" tabindex="-1"></a><span class="in">             max(plscf$pheno$pheno,</span></span>
<span id="cb385-9493"><a href="#cb385-9493" aria-hidden="true" tabindex="-1"></a><span class="in">                 na.rm = TRUE) * 24 * 3600,</span></span>
<span id="cb385-9494"><a href="#cb385-9494" aria-hidden="true" tabindex="-1"></a><span class="in">           ymin = -Inf,</span></span>
<span id="cb385-9495"><a href="#cb385-9495" aria-hidden="true" tabindex="-1"></a><span class="in">           ymax = Inf,</span></span>
<span id="cb385-9496"><a href="#cb385-9496" aria-hidden="true" tabindex="-1"></a><span class="in">           alpha = .1,</span></span>
<span id="cb385-9497"><a href="#cb385-9497" aria-hidden="true" tabindex="-1"></a><span class="in">           fill = "black") +</span></span>
<span id="cb385-9498"><a href="#cb385-9498" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = ISOdate(2001, # add median bloom date line</span></span>
<span id="cb385-9499"><a href="#cb385-9499" aria-hidden="true" tabindex="-1"></a><span class="in">                                  12,</span></span>
<span id="cb385-9500"><a href="#cb385-9500" aria-hidden="true" tabindex="-1"></a><span class="in">                                  31) +</span></span>
<span id="cb385-9501"><a href="#cb385-9501" aria-hidden="true" tabindex="-1"></a><span class="in">               median(plscf$pheno$pheno,</span></span>
<span id="cb385-9502"><a href="#cb385-9502" aria-hidden="true" tabindex="-1"></a><span class="in">                      na.rm = TRUE) * 24 * 3600,</span></span>
<span id="cb385-9503"><a href="#cb385-9503" aria-hidden="true" tabindex="-1"></a><span class="in">             linetype = "dashed") +</span></span>
<span id="cb385-9504"><a href="#cb385-9504" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_ribbon(aes(x = Date, # add uncertainty</span></span>
<span id="cb385-9505"><a href="#cb385-9505" aria-hidden="true" tabindex="-1"></a><span class="in">                  ymin = MetricMean - MetricStdev ,</span></span>
<span id="cb385-9506"><a href="#cb385-9506" aria-hidden="true" tabindex="-1"></a><span class="in">                  ymax = MetricMean + MetricStdev),</span></span>
<span id="cb385-9507"><a href="#cb385-9507" aria-hidden="true" tabindex="-1"></a><span class="in">              fill="grey") +</span></span>
<span id="cb385-9508"><a href="#cb385-9508" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_ribbon(aes(x = Date, # negative correlation then fill red?</span></span>
<span id="cb385-9509"><a href="#cb385-9509" aria-hidden="true" tabindex="-1"></a><span class="in">                  ymin = MetricMean - MetricStdev * (VIP_Coeff == -1),</span></span>
<span id="cb385-9510"><a href="#cb385-9510" aria-hidden="true" tabindex="-1"></a><span class="in">                  ymax = MetricMean + MetricStdev * (VIP_Coeff == -1)),</span></span>
<span id="cb385-9511"><a href="#cb385-9511" aria-hidden="true" tabindex="-1"></a><span class="in">              fill = "red") +</span></span>
<span id="cb385-9512"><a href="#cb385-9512" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_ribbon(aes(x = Date,</span></span>
<span id="cb385-9513"><a href="#cb385-9513" aria-hidden="true" tabindex="-1"></a><span class="in">                  ymin = MetricMean - MetricStdev * (VIP_Coeff == 1),</span></span>
<span id="cb385-9514"><a href="#cb385-9514" aria-hidden="true" tabindex="-1"></a><span class="in">                  ymax = MetricMean + MetricStdev * (VIP_Coeff == 1)),</span></span>
<span id="cb385-9515"><a href="#cb385-9515" aria-hidden="true" tabindex="-1"></a><span class="in">              fill = "dark green") +</span></span>
<span id="cb385-9516"><a href="#cb385-9516" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(aes(x = Date,</span></span>
<span id="cb385-9517"><a href="#cb385-9517" aria-hidden="true" tabindex="-1"></a><span class="in">                y = MetricMean ))</span></span>
<span id="cb385-9518"><a href="#cb385-9518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9519"><a href="#cb385-9519" aria-hidden="true" tabindex="-1"></a><span class="in">temp_plot</span></span>
<span id="cb385-9520"><a href="#cb385-9520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9521"><a href="#cb385-9521" aria-hidden="true" tabindex="-1"></a><span class="in"># Use the facet labels instead and moved them to the left side, using them as </span></span>
<span id="cb385-9522"><a href="#cb385-9522" aria-hidden="true" tabindex="-1"></a><span class="in"># y-axis labels. The labeller element in facet_wrap can easily be customized </span></span>
<span id="cb385-9523"><a href="#cb385-9523" aria-hidden="true" tabindex="-1"></a><span class="in"># with text of your choice. </span></span>
<span id="cb385-9524"><a href="#cb385-9524" aria-hidden="true" tabindex="-1"></a><span class="in">temp_plot &lt;- temp_plot +</span></span>
<span id="cb385-9525"><a href="#cb385-9525" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(Type), </span></span>
<span id="cb385-9526"><a href="#cb385-9526" aria-hidden="true" tabindex="-1"></a><span class="in">             scales = "free_y", # free scales in y dimension</span></span>
<span id="cb385-9527"><a href="#cb385-9527" aria-hidden="true" tabindex="-1"></a><span class="in">             strip.position = "left",</span></span>
<span id="cb385-9528"><a href="#cb385-9528" aria-hidden="true" tabindex="-1"></a><span class="in">             labeller =</span></span>
<span id="cb385-9529"><a href="#cb385-9529" aria-hidden="true" tabindex="-1"></a><span class="in">               labeller(Type = as_labeller(</span></span>
<span id="cb385-9530"><a href="#cb385-9530" aria-hidden="true" tabindex="-1"></a><span class="in">               c(Chill = "Chill (CP)",</span></span>
<span id="cb385-9531"><a href="#cb385-9531" aria-hidden="true" tabindex="-1"></a><span class="in">                 Heat = "Heat (GDH)")))) +</span></span>
<span id="cb385-9532"><a href="#cb385-9532" aria-hidden="true" tabindex="-1"></a><span class="in">  ggtitle("Daily chill and heat accumulation rates") +</span></span>
<span id="cb385-9533"><a href="#cb385-9533" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) + </span></span>
<span id="cb385-9534"><a href="#cb385-9534" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(strip.background = element_blank(),</span></span>
<span id="cb385-9535"><a href="#cb385-9535" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.placement = "outside",</span></span>
<span id="cb385-9536"><a href="#cb385-9536" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.text.y = element_text(size =12),</span></span>
<span id="cb385-9537"><a href="#cb385-9537" aria-hidden="true" tabindex="-1"></a><span class="in">        plot.title = element_text(hjust = 0.5),</span></span>
<span id="cb385-9538"><a href="#cb385-9538" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.title.y = element_blank()</span></span>
<span id="cb385-9539"><a href="#cb385-9539" aria-hidden="true" tabindex="-1"></a><span class="in">        )</span></span>
<span id="cb385-9540"><a href="#cb385-9540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9541"><a href="#cb385-9541" aria-hidden="true" tabindex="-1"></a><span class="in">temp_plot</span></span>
<span id="cb385-9542"><a href="#cb385-9542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9543"><a href="#cb385-9543" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-9544"><a href="#cb385-9544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9545"><a href="#cb385-9545" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-9546"><a href="#cb385-9546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9547"><a href="#cb385-9547" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now use the same strategy to make the VIP and model coefficient plots (this is important, because the plots should have similar structures when we combine them later).</span>
<span id="cb385-9548"><a href="#cb385-9548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9549"><a href="#cb385-9549" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Create VIP plot:</span>
<span id="cb385-9550"><a href="#cb385-9550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9551"><a href="#cb385-9551" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 23.4b}</span></span>
<span id="cb385-9552"><a href="#cb385-9552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9553"><a href="#cb385-9553" aria-hidden="true" tabindex="-1"></a><span class="in">VIP_plot&lt;- ggplot(PLS_gg,</span></span>
<span id="cb385-9554"><a href="#cb385-9554" aria-hidden="true" tabindex="-1"></a><span class="in">                  aes(x = Date,</span></span>
<span id="cb385-9555"><a href="#cb385-9555" aria-hidden="true" tabindex="-1"></a><span class="in">                      y = VIP)) +</span></span>
<span id="cb385-9556"><a href="#cb385-9556" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("rect",</span></span>
<span id="cb385-9557"><a href="#cb385-9557" aria-hidden="true" tabindex="-1"></a><span class="in">           xmin = chill_start_date,</span></span>
<span id="cb385-9558"><a href="#cb385-9558" aria-hidden="true" tabindex="-1"></a><span class="in">           xmax = chill_end_date,</span></span>
<span id="cb385-9559"><a href="#cb385-9559" aria-hidden="true" tabindex="-1"></a><span class="in">           ymin = -Inf,</span></span>
<span id="cb385-9560"><a href="#cb385-9560" aria-hidden="true" tabindex="-1"></a><span class="in">           ymax = Inf,</span></span>
<span id="cb385-9561"><a href="#cb385-9561" aria-hidden="true" tabindex="-1"></a><span class="in">           alpha = .1,</span></span>
<span id="cb385-9562"><a href="#cb385-9562" aria-hidden="true" tabindex="-1"></a><span class="in">           fill = "blue") +</span></span>
<span id="cb385-9563"><a href="#cb385-9563" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("rect",</span></span>
<span id="cb385-9564"><a href="#cb385-9564" aria-hidden="true" tabindex="-1"></a><span class="in">           xmin = heat_start_date,</span></span>
<span id="cb385-9565"><a href="#cb385-9565" aria-hidden="true" tabindex="-1"></a><span class="in">           xmax = heat_end_date,</span></span>
<span id="cb385-9566"><a href="#cb385-9566" aria-hidden="true" tabindex="-1"></a><span class="in">           ymin = -Inf,</span></span>
<span id="cb385-9567"><a href="#cb385-9567" aria-hidden="true" tabindex="-1"></a><span class="in">           ymax = Inf,</span></span>
<span id="cb385-9568"><a href="#cb385-9568" aria-hidden="true" tabindex="-1"></a><span class="in">           alpha = .1,</span></span>
<span id="cb385-9569"><a href="#cb385-9569" aria-hidden="true" tabindex="-1"></a><span class="in">           fill = "red") +</span></span>
<span id="cb385-9570"><a href="#cb385-9570" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("rect",</span></span>
<span id="cb385-9571"><a href="#cb385-9571" aria-hidden="true" tabindex="-1"></a><span class="in">           xmin = ISOdate(2001,</span></span>
<span id="cb385-9572"><a href="#cb385-9572" aria-hidden="true" tabindex="-1"></a><span class="in">                          12,</span></span>
<span id="cb385-9573"><a href="#cb385-9573" aria-hidden="true" tabindex="-1"></a><span class="in">                          31) +</span></span>
<span id="cb385-9574"><a href="#cb385-9574" aria-hidden="true" tabindex="-1"></a><span class="in">             min(plscf$pheno$pheno,</span></span>
<span id="cb385-9575"><a href="#cb385-9575" aria-hidden="true" tabindex="-1"></a><span class="in">                 na.rm = TRUE) * 24 * 3600,</span></span>
<span id="cb385-9576"><a href="#cb385-9576" aria-hidden="true" tabindex="-1"></a><span class="in">           xmax = ISOdate(2001,</span></span>
<span id="cb385-9577"><a href="#cb385-9577" aria-hidden="true" tabindex="-1"></a><span class="in">                          12,</span></span>
<span id="cb385-9578"><a href="#cb385-9578" aria-hidden="true" tabindex="-1"></a><span class="in">                          31) +</span></span>
<span id="cb385-9579"><a href="#cb385-9579" aria-hidden="true" tabindex="-1"></a><span class="in">             max(plscf$pheno$pheno,</span></span>
<span id="cb385-9580"><a href="#cb385-9580" aria-hidden="true" tabindex="-1"></a><span class="in">                 na.rm = TRUE) * 24 * 3600,</span></span>
<span id="cb385-9581"><a href="#cb385-9581" aria-hidden="true" tabindex="-1"></a><span class="in">           ymin = -Inf,</span></span>
<span id="cb385-9582"><a href="#cb385-9582" aria-hidden="true" tabindex="-1"></a><span class="in">           ymax = Inf,</span></span>
<span id="cb385-9583"><a href="#cb385-9583" aria-hidden="true" tabindex="-1"></a><span class="in">           alpha = .1,</span></span>
<span id="cb385-9584"><a href="#cb385-9584" aria-hidden="true" tabindex="-1"></a><span class="in">           fill = "black") +</span></span>
<span id="cb385-9585"><a href="#cb385-9585" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = ISOdate(2001,</span></span>
<span id="cb385-9586"><a href="#cb385-9586" aria-hidden="true" tabindex="-1"></a><span class="in">                                  12,</span></span>
<span id="cb385-9587"><a href="#cb385-9587" aria-hidden="true" tabindex="-1"></a><span class="in">                                  31) +</span></span>
<span id="cb385-9588"><a href="#cb385-9588" aria-hidden="true" tabindex="-1"></a><span class="in">               median(plscf$pheno$pheno,</span></span>
<span id="cb385-9589"><a href="#cb385-9589" aria-hidden="true" tabindex="-1"></a><span class="in">                      na.rm = TRUE) * 24 * 3600,</span></span>
<span id="cb385-9590"><a href="#cb385-9590" aria-hidden="true" tabindex="-1"></a><span class="in">             linetype = "dashed") +</span></span>
<span id="cb385-9591"><a href="#cb385-9591" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat = 'identity', # leave data unchanged</span></span>
<span id="cb385-9592"><a href="#cb385-9592" aria-hidden="true" tabindex="-1"></a><span class="in">           aes(fill = VIP &gt; 0.8))</span></span>
<span id="cb385-9593"><a href="#cb385-9593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9594"><a href="#cb385-9594" aria-hidden="true" tabindex="-1"></a><span class="in">VIP_plot</span></span>
<span id="cb385-9595"><a href="#cb385-9595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9596"><a href="#cb385-9596" aria-hidden="true" tabindex="-1"></a><span class="in"># Split the VIP_plot by Type</span></span>
<span id="cb385-9597"><a href="#cb385-9597" aria-hidden="true" tabindex="-1"></a><span class="in">VIP_plot &lt;- VIP_plot + </span></span>
<span id="cb385-9598"><a href="#cb385-9598" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(Type),</span></span>
<span id="cb385-9599"><a href="#cb385-9599" aria-hidden="true" tabindex="-1"></a><span class="in">             scales = "free",</span></span>
<span id="cb385-9600"><a href="#cb385-9600" aria-hidden="true" tabindex="-1"></a><span class="in">             strip.position = "left",</span></span>
<span id="cb385-9601"><a href="#cb385-9601" aria-hidden="true" tabindex="-1"></a><span class="in">             labeller = </span></span>
<span id="cb385-9602"><a href="#cb385-9602" aria-hidden="true" tabindex="-1"></a><span class="in">               labeller(Type = as_labeller(</span></span>
<span id="cb385-9603"><a href="#cb385-9603" aria-hidden="true" tabindex="-1"></a><span class="in">                 c(Chill = "VIP for chill",</span></span>
<span id="cb385-9604"><a href="#cb385-9604" aria-hidden="true" tabindex="-1"></a><span class="in">                   Heat = "VIP for heat")))) +</span></span>
<span id="cb385-9605"><a href="#cb385-9605" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(</span></span>
<span id="cb385-9606"><a href="#cb385-9606" aria-hidden="true" tabindex="-1"></a><span class="in">    limits = c(0,</span></span>
<span id="cb385-9607"><a href="#cb385-9607" aria-hidden="true" tabindex="-1"></a><span class="in">               max(plscf$Chill_Portions$GDH$PLS_summary$VIP))) +</span></span>
<span id="cb385-9608"><a href="#cb385-9608" aria-hidden="true" tabindex="-1"></a><span class="in">  ggtitle("Variable Importance in the Projection (VIP) scores") +</span></span>
<span id="cb385-9609"><a href="#cb385-9609" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) + </span></span>
<span id="cb385-9610"><a href="#cb385-9610" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(strip.background = element_blank(),</span></span>
<span id="cb385-9611"><a href="#cb385-9611" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.placement = "outside",</span></span>
<span id="cb385-9612"><a href="#cb385-9612" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.text.y = element_text(size = 12),</span></span>
<span id="cb385-9613"><a href="#cb385-9613" aria-hidden="true" tabindex="-1"></a><span class="in">        plot.title = element_text(hjust = 0.5),</span></span>
<span id="cb385-9614"><a href="#cb385-9614" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.title.y = element_blank()</span></span>
<span id="cb385-9615"><a href="#cb385-9615" aria-hidden="true" tabindex="-1"></a><span class="in">        )</span></span>
<span id="cb385-9616"><a href="#cb385-9616" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-9617"><a href="#cb385-9617" aria-hidden="true" tabindex="-1"></a><span class="in">VIP_plot</span></span>
<span id="cb385-9618"><a href="#cb385-9618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9619"><a href="#cb385-9619" aria-hidden="true" tabindex="-1"></a><span class="in"># Change color to grey and blue</span></span>
<span id="cb385-9620"><a href="#cb385-9620" aria-hidden="true" tabindex="-1"></a><span class="in">VIP_plot &lt;- VIP_plot +</span></span>
<span id="cb385-9621"><a href="#cb385-9621" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(name = "VIP", </span></span>
<span id="cb385-9622"><a href="#cb385-9622" aria-hidden="true" tabindex="-1"></a><span class="in">                    labels = c("&lt;0.8", "&gt;0.8"), </span></span>
<span id="cb385-9623"><a href="#cb385-9623" aria-hidden="true" tabindex="-1"></a><span class="in">                    values = c("FALSE" = "grey",</span></span>
<span id="cb385-9624"><a href="#cb385-9624" aria-hidden="true" tabindex="-1"></a><span class="in">                               "TRUE" = "blue")) +</span></span>
<span id="cb385-9625"><a href="#cb385-9625" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.x = element_blank(),</span></span>
<span id="cb385-9626"><a href="#cb385-9626" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.ticks.x = element_blank(),</span></span>
<span id="cb385-9627"><a href="#cb385-9627" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.title.x = element_blank(),</span></span>
<span id="cb385-9628"><a href="#cb385-9628" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.title.y = element_blank())</span></span>
<span id="cb385-9629"><a href="#cb385-9629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9630"><a href="#cb385-9630" aria-hidden="true" tabindex="-1"></a><span class="in">VIP_plot</span></span>
<span id="cb385-9631"><a href="#cb385-9631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9632"><a href="#cb385-9632" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-9633"><a href="#cb385-9633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9634"><a href="#cb385-9634" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-9635"><a href="#cb385-9635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9636"><a href="#cb385-9636" aria-hidden="true" tabindex="-1"></a>_ Create model coefficient plots:</span>
<span id="cb385-9637"><a href="#cb385-9637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9638"><a href="#cb385-9638" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 23.4c}</span></span>
<span id="cb385-9639"><a href="#cb385-9639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9640"><a href="#cb385-9640" aria-hidden="true" tabindex="-1"></a><span class="in">coeff_plot &lt;- ggplot(PLS_gg,</span></span>
<span id="cb385-9641"><a href="#cb385-9641" aria-hidden="true" tabindex="-1"></a><span class="in">                     aes(x = Date,</span></span>
<span id="cb385-9642"><a href="#cb385-9642" aria-hidden="true" tabindex="-1"></a><span class="in">                         y = Coef)) +</span></span>
<span id="cb385-9643"><a href="#cb385-9643" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("rect",</span></span>
<span id="cb385-9644"><a href="#cb385-9644" aria-hidden="true" tabindex="-1"></a><span class="in">           xmin = chill_start_date,</span></span>
<span id="cb385-9645"><a href="#cb385-9645" aria-hidden="true" tabindex="-1"></a><span class="in">           xmax = chill_end_date,</span></span>
<span id="cb385-9646"><a href="#cb385-9646" aria-hidden="true" tabindex="-1"></a><span class="in">           ymin = -Inf,</span></span>
<span id="cb385-9647"><a href="#cb385-9647" aria-hidden="true" tabindex="-1"></a><span class="in">           ymax = Inf,</span></span>
<span id="cb385-9648"><a href="#cb385-9648" aria-hidden="true" tabindex="-1"></a><span class="in">           alpha = .1,</span></span>
<span id="cb385-9649"><a href="#cb385-9649" aria-hidden="true" tabindex="-1"></a><span class="in">           fill = "blue") +</span></span>
<span id="cb385-9650"><a href="#cb385-9650" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("rect",</span></span>
<span id="cb385-9651"><a href="#cb385-9651" aria-hidden="true" tabindex="-1"></a><span class="in">           xmin = heat_start_date,</span></span>
<span id="cb385-9652"><a href="#cb385-9652" aria-hidden="true" tabindex="-1"></a><span class="in">           xmax = heat_end_date,</span></span>
<span id="cb385-9653"><a href="#cb385-9653" aria-hidden="true" tabindex="-1"></a><span class="in">           ymin = -Inf,</span></span>
<span id="cb385-9654"><a href="#cb385-9654" aria-hidden="true" tabindex="-1"></a><span class="in">           ymax = Inf,</span></span>
<span id="cb385-9655"><a href="#cb385-9655" aria-hidden="true" tabindex="-1"></a><span class="in">           alpha = .1,</span></span>
<span id="cb385-9656"><a href="#cb385-9656" aria-hidden="true" tabindex="-1"></a><span class="in">           fill = "red") +</span></span>
<span id="cb385-9657"><a href="#cb385-9657" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("rect",</span></span>
<span id="cb385-9658"><a href="#cb385-9658" aria-hidden="true" tabindex="-1"></a><span class="in">           xmin = ISOdate(2001,</span></span>
<span id="cb385-9659"><a href="#cb385-9659" aria-hidden="true" tabindex="-1"></a><span class="in">                          12,</span></span>
<span id="cb385-9660"><a href="#cb385-9660" aria-hidden="true" tabindex="-1"></a><span class="in">                          31) +</span></span>
<span id="cb385-9661"><a href="#cb385-9661" aria-hidden="true" tabindex="-1"></a><span class="in">             min(plscf$pheno$pheno,</span></span>
<span id="cb385-9662"><a href="#cb385-9662" aria-hidden="true" tabindex="-1"></a><span class="in">                 na.rm=TRUE) * 24 * 3600,</span></span>
<span id="cb385-9663"><a href="#cb385-9663" aria-hidden="true" tabindex="-1"></a><span class="in">           xmax = ISOdate(2001,</span></span>
<span id="cb385-9664"><a href="#cb385-9664" aria-hidden="true" tabindex="-1"></a><span class="in">                          12,</span></span>
<span id="cb385-9665"><a href="#cb385-9665" aria-hidden="true" tabindex="-1"></a><span class="in">                          31) +</span></span>
<span id="cb385-9666"><a href="#cb385-9666" aria-hidden="true" tabindex="-1"></a><span class="in">             max(plscf$pheno$pheno,</span></span>
<span id="cb385-9667"><a href="#cb385-9667" aria-hidden="true" tabindex="-1"></a><span class="in">                 na.rm = TRUE) * 24 * 3600,</span></span>
<span id="cb385-9668"><a href="#cb385-9668" aria-hidden="true" tabindex="-1"></a><span class="in">           ymin = -Inf,</span></span>
<span id="cb385-9669"><a href="#cb385-9669" aria-hidden="true" tabindex="-1"></a><span class="in">           ymax = Inf,</span></span>
<span id="cb385-9670"><a href="#cb385-9670" aria-hidden="true" tabindex="-1"></a><span class="in">           alpha = .1,</span></span>
<span id="cb385-9671"><a href="#cb385-9671" aria-hidden="true" tabindex="-1"></a><span class="in">           fill = "black") +</span></span>
<span id="cb385-9672"><a href="#cb385-9672" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = ISOdate(2001,</span></span>
<span id="cb385-9673"><a href="#cb385-9673" aria-hidden="true" tabindex="-1"></a><span class="in">                                  12,</span></span>
<span id="cb385-9674"><a href="#cb385-9674" aria-hidden="true" tabindex="-1"></a><span class="in">                                  31) +</span></span>
<span id="cb385-9675"><a href="#cb385-9675" aria-hidden="true" tabindex="-1"></a><span class="in">               median(plscf$pheno$pheno,</span></span>
<span id="cb385-9676"><a href="#cb385-9676" aria-hidden="true" tabindex="-1"></a><span class="in">                      na.rm = TRUE) * 24 * 3600,</span></span>
<span id="cb385-9677"><a href="#cb385-9677" aria-hidden="true" tabindex="-1"></a><span class="in">             linetype = "dashed") +</span></span>
<span id="cb385-9678"><a href="#cb385-9678" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_bar(stat = 'identity',</span></span>
<span id="cb385-9679"><a href="#cb385-9679" aria-hidden="true" tabindex="-1"></a><span class="in">           aes(fill = VIP_Coeff))</span></span>
<span id="cb385-9680"><a href="#cb385-9680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9681"><a href="#cb385-9681" aria-hidden="true" tabindex="-1"></a><span class="in">coeff_plot</span></span>
<span id="cb385-9682"><a href="#cb385-9682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9683"><a href="#cb385-9683" aria-hidden="true" tabindex="-1"></a><span class="in"># Wrap by Type</span></span>
<span id="cb385-9684"><a href="#cb385-9684" aria-hidden="true" tabindex="-1"></a><span class="in">coeff_plot &lt;- coeff_plot +</span></span>
<span id="cb385-9685"><a href="#cb385-9685" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(vars(Type),</span></span>
<span id="cb385-9686"><a href="#cb385-9686" aria-hidden="true" tabindex="-1"></a><span class="in">             scales = "free",</span></span>
<span id="cb385-9687"><a href="#cb385-9687" aria-hidden="true" tabindex="-1"></a><span class="in">             strip.position = "left",</span></span>
<span id="cb385-9688"><a href="#cb385-9688" aria-hidden="true" tabindex="-1"></a><span class="in">             labeller =</span></span>
<span id="cb385-9689"><a href="#cb385-9689" aria-hidden="true" tabindex="-1"></a><span class="in">               labeller(</span></span>
<span id="cb385-9690"><a href="#cb385-9690" aria-hidden="true" tabindex="-1"></a><span class="in">                 Type = as_labeller(</span></span>
<span id="cb385-9691"><a href="#cb385-9691" aria-hidden="true" tabindex="-1"></a><span class="in">                   c(Chill = "MC for chill",</span></span>
<span id="cb385-9692"><a href="#cb385-9692" aria-hidden="true" tabindex="-1"></a><span class="in">                     Heat = "MC for heat")))) +</span></span>
<span id="cb385-9693"><a href="#cb385-9693" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(</span></span>
<span id="cb385-9694"><a href="#cb385-9694" aria-hidden="true" tabindex="-1"></a><span class="in">    limits = c(min(plscf$Chill_Portions$GDH$PLS_summary$Coef),</span></span>
<span id="cb385-9695"><a href="#cb385-9695" aria-hidden="true" tabindex="-1"></a><span class="in">               max(plscf$Chill_Portions$GDH$PLS_summary$Coef))) +</span></span>
<span id="cb385-9696"><a href="#cb385-9696" aria-hidden="true" tabindex="-1"></a><span class="in">  ggtitle("Model coefficients (MC)") +</span></span>
<span id="cb385-9697"><a href="#cb385-9697" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 15) + </span></span>
<span id="cb385-9698"><a href="#cb385-9698" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(strip.background = element_blank(),</span></span>
<span id="cb385-9699"><a href="#cb385-9699" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.placement = "outside",</span></span>
<span id="cb385-9700"><a href="#cb385-9700" aria-hidden="true" tabindex="-1"></a><span class="in">        strip.text.y = element_text(size = 12),</span></span>
<span id="cb385-9701"><a href="#cb385-9701" aria-hidden="true" tabindex="-1"></a><span class="in">        plot.title = element_text(hjust = 0.5),</span></span>
<span id="cb385-9702"><a href="#cb385-9702" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.title.y = element_blank()</span></span>
<span id="cb385-9703"><a href="#cb385-9703" aria-hidden="true" tabindex="-1"></a><span class="in">        )</span></span>
<span id="cb385-9704"><a href="#cb385-9704" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-9705"><a href="#cb385-9705" aria-hidden="true" tabindex="-1"></a><span class="in">coeff_plot </span></span>
<span id="cb385-9706"><a href="#cb385-9706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9707"><a href="#cb385-9707" aria-hidden="true" tabindex="-1"></a><span class="in"># Change colors and legends</span></span>
<span id="cb385-9708"><a href="#cb385-9708" aria-hidden="true" tabindex="-1"></a><span class="in">coeff_plot &lt;- coeff_plot +  </span></span>
<span id="cb385-9709"><a href="#cb385-9709" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(name="Effect direction", </span></span>
<span id="cb385-9710"><a href="#cb385-9710" aria-hidden="true" tabindex="-1"></a><span class="in">                    labels = c("Advancing",</span></span>
<span id="cb385-9711"><a href="#cb385-9711" aria-hidden="true" tabindex="-1"></a><span class="in">                               "Unimportant",</span></span>
<span id="cb385-9712"><a href="#cb385-9712" aria-hidden="true" tabindex="-1"></a><span class="in">                               "Delaying"), </span></span>
<span id="cb385-9713"><a href="#cb385-9713" aria-hidden="true" tabindex="-1"></a><span class="in">                    values = c("-1" = "red",</span></span>
<span id="cb385-9714"><a href="#cb385-9714" aria-hidden="true" tabindex="-1"></a><span class="in">                               "0" = "grey",</span></span>
<span id="cb385-9715"><a href="#cb385-9715" aria-hidden="true" tabindex="-1"></a><span class="in">                               "1" = "dark green")) +</span></span>
<span id="cb385-9716"><a href="#cb385-9716" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("PLS coefficient") +</span></span>
<span id="cb385-9717"><a href="#cb385-9717" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(axis.text.x = element_blank(),</span></span>
<span id="cb385-9718"><a href="#cb385-9718" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.ticks.x = element_blank(),</span></span>
<span id="cb385-9719"><a href="#cb385-9719" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.title.x = element_blank(),</span></span>
<span id="cb385-9720"><a href="#cb385-9720" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.title.y = element_blank())</span></span>
<span id="cb385-9721"><a href="#cb385-9721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9722"><a href="#cb385-9722" aria-hidden="true" tabindex="-1"></a><span class="in">coeff_plot</span></span>
<span id="cb385-9723"><a href="#cb385-9723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9724"><a href="#cb385-9724" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-9725"><a href="#cb385-9725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9726"><a href="#cb385-9726" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-9727"><a href="#cb385-9727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9728"><a href="#cb385-9728" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now it’s time to combine the plots. We’ll use the <span class="in">`patchwork`</span> package again.</span>
<span id="cb385-9729"><a href="#cb385-9729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9730"><a href="#cb385-9730" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 23.4d}</span></span>
<span id="cb385-9731"><a href="#cb385-9731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9732"><a href="#cb385-9732" aria-hidden="true" tabindex="-1"></a><span class="in">#library(patchwork)</span></span>
<span id="cb385-9733"><a href="#cb385-9733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9734"><a href="#cb385-9734" aria-hidden="true" tabindex="-1"></a><span class="in">plot&lt;- (VIP_plot +</span></span>
<span id="cb385-9735"><a href="#cb385-9735" aria-hidden="true" tabindex="-1"></a><span class="in">          coeff_plot +</span></span>
<span id="cb385-9736"><a href="#cb385-9736" aria-hidden="true" tabindex="-1"></a><span class="in">          temp_plot +</span></span>
<span id="cb385-9737"><a href="#cb385-9737" aria-hidden="true" tabindex="-1"></a><span class="in">          plot_layout(ncol = 1,</span></span>
<span id="cb385-9738"><a href="#cb385-9738" aria-hidden="true" tabindex="-1"></a><span class="in">            guides = "collect")</span></span>
<span id="cb385-9739"><a href="#cb385-9739" aria-hidden="true" tabindex="-1"></a><span class="in">        ) &amp; theme(legend.position = "right",</span></span>
<span id="cb385-9740"><a href="#cb385-9740" aria-hidden="true" tabindex="-1"></a><span class="in">                  legend.text = element_text(size = 8),</span></span>
<span id="cb385-9741"><a href="#cb385-9741" aria-hidden="true" tabindex="-1"></a><span class="in">                  legend.title = element_text(size = 10),</span></span>
<span id="cb385-9742"><a href="#cb385-9742" aria-hidden="true" tabindex="-1"></a><span class="in">                  axis.title.x = element_blank())</span></span>
<span id="cb385-9743"><a href="#cb385-9743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9744"><a href="#cb385-9744" aria-hidden="true" tabindex="-1"></a><span class="in">plot</span></span>
<span id="cb385-9745"><a href="#cb385-9745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9746"><a href="#cb385-9746" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-9747"><a href="#cb385-9747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9748"><a href="#cb385-9748" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-9749"><a href="#cb385-9749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9750"><a href="#cb385-9750" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Make a function for later use.</span>
<span id="cb385-9751"><a href="#cb385-9751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9752"><a href="#cb385-9752" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 23.4e}</span></span>
<span id="cb385-9753"><a href="#cb385-9753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9754"><a href="#cb385-9754" aria-hidden="true" tabindex="-1"></a><span class="in">plot_PLS_chill_force &lt;- function(plscf,</span></span>
<span id="cb385-9755"><a href="#cb385-9755" aria-hidden="true" tabindex="-1"></a><span class="in">                                 chill_metric = "Chill_Portions",</span></span>
<span id="cb385-9756"><a href="#cb385-9756" aria-hidden="true" tabindex="-1"></a><span class="in">                                 heat_metric = "GDH",</span></span>
<span id="cb385-9757"><a href="#cb385-9757" aria-hidden="true" tabindex="-1"></a><span class="in">                                 chill_label = "CP",</span></span>
<span id="cb385-9758"><a href="#cb385-9758" aria-hidden="true" tabindex="-1"></a><span class="in">                                 heat_label = "GDH",</span></span>
<span id="cb385-9759"><a href="#cb385-9759" aria-hidden="true" tabindex="-1"></a><span class="in">                                 chill_phase = c(-48, 62),</span></span>
<span id="cb385-9760"><a href="#cb385-9760" aria-hidden="true" tabindex="-1"></a><span class="in">                                 heat_phase = c(3, 105.5))</span></span>
<span id="cb385-9761"><a href="#cb385-9761" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb385-9762"><a href="#cb385-9762" aria-hidden="true" tabindex="-1"></a><span class="in">  PLS_gg &lt;- plscf[[chill_metric]][[heat_metric]]$PLS_summary %&gt;%</span></span>
<span id="cb385-9763"><a href="#cb385-9763" aria-hidden="true" tabindex="-1"></a><span class="in">    mutate(Month = trunc(Date/100),</span></span>
<span id="cb385-9764"><a href="#cb385-9764" aria-hidden="true" tabindex="-1"></a><span class="in">           Day = Date - Month * 100,</span></span>
<span id="cb385-9765"><a href="#cb385-9765" aria-hidden="true" tabindex="-1"></a><span class="in">           Date = ISOdate(2002,</span></span>
<span id="cb385-9766"><a href="#cb385-9766" aria-hidden="true" tabindex="-1"></a><span class="in">                          Month,</span></span>
<span id="cb385-9767"><a href="#cb385-9767" aria-hidden="true" tabindex="-1"></a><span class="in">                          Day))</span></span>
<span id="cb385-9768"><a href="#cb385-9768" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-9769"><a href="#cb385-9769" aria-hidden="true" tabindex="-1"></a><span class="in">  PLS_gg[PLS_gg$JDay &lt;= 0,"Date"]&lt;-</span></span>
<span id="cb385-9770"><a href="#cb385-9770" aria-hidden="true" tabindex="-1"></a><span class="in">    ISOdate(2001,</span></span>
<span id="cb385-9771"><a href="#cb385-9771" aria-hidden="true" tabindex="-1"></a><span class="in">            PLS_gg$Month[PLS_gg$JDay &lt;= 0],</span></span>
<span id="cb385-9772"><a href="#cb385-9772" aria-hidden="true" tabindex="-1"></a><span class="in">            PLS_gg$Day[PLS_gg$JDay &lt;= 0])</span></span>
<span id="cb385-9773"><a href="#cb385-9773" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-9774"><a href="#cb385-9774" aria-hidden="true" tabindex="-1"></a><span class="in">  PLS_gg &lt;- PLS_gg %&gt;%</span></span>
<span id="cb385-9775"><a href="#cb385-9775" aria-hidden="true" tabindex="-1"></a><span class="in">    mutate(VIP_importance = VIP &gt;= 0.8,</span></span>
<span id="cb385-9776"><a href="#cb385-9776" aria-hidden="true" tabindex="-1"></a><span class="in">           VIP_Coeff = factor(sign(Coef) * VIP_importance))</span></span>
<span id="cb385-9777"><a href="#cb385-9777" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-9778"><a href="#cb385-9778" aria-hidden="true" tabindex="-1"></a><span class="in">  chill_start_date &lt;- ISOdate(2001,</span></span>
<span id="cb385-9779"><a href="#cb385-9779" aria-hidden="true" tabindex="-1"></a><span class="in">                              12,</span></span>
<span id="cb385-9780"><a href="#cb385-9780" aria-hidden="true" tabindex="-1"></a><span class="in">                              31) + chill_phase[1] * 24 * 3600</span></span>
<span id="cb385-9781"><a href="#cb385-9781" aria-hidden="true" tabindex="-1"></a><span class="in">  chill_end_date &lt;- ISOdate(2001,</span></span>
<span id="cb385-9782"><a href="#cb385-9782" aria-hidden="true" tabindex="-1"></a><span class="in">                            12,</span></span>
<span id="cb385-9783"><a href="#cb385-9783" aria-hidden="true" tabindex="-1"></a><span class="in">                            31) + chill_phase[2] * 24 * 3600</span></span>
<span id="cb385-9784"><a href="#cb385-9784" aria-hidden="true" tabindex="-1"></a><span class="in">  heat_start_date &lt;- ISOdate(2001,</span></span>
<span id="cb385-9785"><a href="#cb385-9785" aria-hidden="true" tabindex="-1"></a><span class="in">                             12,</span></span>
<span id="cb385-9786"><a href="#cb385-9786" aria-hidden="true" tabindex="-1"></a><span class="in">                             31) + heat_phase[1] * 24 * 3600</span></span>
<span id="cb385-9787"><a href="#cb385-9787" aria-hidden="true" tabindex="-1"></a><span class="in">  heat_end_date &lt;- ISOdate(2001,</span></span>
<span id="cb385-9788"><a href="#cb385-9788" aria-hidden="true" tabindex="-1"></a><span class="in">                           12,</span></span>
<span id="cb385-9789"><a href="#cb385-9789" aria-hidden="true" tabindex="-1"></a><span class="in">                           31) + heat_phase[2] * 24 * 3600</span></span>
<span id="cb385-9790"><a href="#cb385-9790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9791"><a href="#cb385-9791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9792"><a href="#cb385-9792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9793"><a href="#cb385-9793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-9794"><a href="#cb385-9794" aria-hidden="true" tabindex="-1"></a><span class="in">  temp_plot &lt;- ggplot(PLS_gg) +</span></span>
<span id="cb385-9795"><a href="#cb385-9795" aria-hidden="true" tabindex="-1"></a><span class="in">    annotate("rect",</span></span>
<span id="cb385-9796"><a href="#cb385-9796" aria-hidden="true" tabindex="-1"></a><span class="in">             xmin = chill_start_date,</span></span>
<span id="cb385-9797"><a href="#cb385-9797" aria-hidden="true" tabindex="-1"></a><span class="in">             xmax = chill_end_date,</span></span>
<span id="cb385-9798"><a href="#cb385-9798" aria-hidden="true" tabindex="-1"></a><span class="in">             ymin = -Inf,</span></span>
<span id="cb385-9799"><a href="#cb385-9799" aria-hidden="true" tabindex="-1"></a><span class="in">             ymax = Inf,</span></span>
<span id="cb385-9800"><a href="#cb385-9800" aria-hidden="true" tabindex="-1"></a><span class="in">             alpha = .1,</span></span>
<span id="cb385-9801"><a href="#cb385-9801" aria-hidden="true" tabindex="-1"></a><span class="in">             fill = "blue") +</span></span>
<span id="cb385-9802"><a href="#cb385-9802" aria-hidden="true" tabindex="-1"></a><span class="in">    annotate("rect",</span></span>
<span id="cb385-9803"><a href="#cb385-9803" aria-hidden="true" tabindex="-1"></a><span class="in">             xmin = heat_start_date,</span></span>
<span id="cb385-9804"><a href="#cb385-9804" aria-hidden="true" tabindex="-1"></a><span class="in">             xmax = heat_end_date,</span></span>
<span id="cb385-9805"><a href="#cb385-9805" aria-hidden="true" tabindex="-1"></a><span class="in">             ymin = -Inf,</span></span>
<span id="cb385-9806"><a href="#cb385-9806" aria-hidden="true" tabindex="-1"></a><span class="in">             ymax = Inf,</span></span>
<span id="cb385-9807"><a href="#cb385-9807" aria-hidden="true" tabindex="-1"></a><span class="in">             alpha = .1,</span></span>
<span id="cb385-9808"><a href="#cb385-9808" aria-hidden="true" tabindex="-1"></a><span class="in">             fill = "red") +</span></span>
<span id="cb385-9809"><a href="#cb385-9809" aria-hidden="true" tabindex="-1"></a><span class="in">    annotate("rect",</span></span>
<span id="cb385-9810"><a href="#cb385-9810" aria-hidden="true" tabindex="-1"></a><span class="in">             xmin = ISOdate(2001,</span></span>
<span id="cb385-9811"><a href="#cb385-9811" aria-hidden="true" tabindex="-1"></a><span class="in">                            12,</span></span>
<span id="cb385-9812"><a href="#cb385-9812" aria-hidden="true" tabindex="-1"></a><span class="in">                            31) +</span></span>
<span id="cb385-9813"><a href="#cb385-9813" aria-hidden="true" tabindex="-1"></a><span class="in">               min(plscf$pheno$pheno,</span></span>
<span id="cb385-9814"><a href="#cb385-9814" aria-hidden="true" tabindex="-1"></a><span class="in">                   na.rm = TRUE) * 24 * 3600,</span></span>
<span id="cb385-9815"><a href="#cb385-9815" aria-hidden="true" tabindex="-1"></a><span class="in">             xmax = ISOdate(2001,</span></span>
<span id="cb385-9816"><a href="#cb385-9816" aria-hidden="true" tabindex="-1"></a><span class="in">                            12,</span></span>
<span id="cb385-9817"><a href="#cb385-9817" aria-hidden="true" tabindex="-1"></a><span class="in">                            31) +</span></span>
<span id="cb385-9818"><a href="#cb385-9818" aria-hidden="true" tabindex="-1"></a><span class="in">               max(plscf$pheno$pheno,</span></span>
<span id="cb385-9819"><a href="#cb385-9819" aria-hidden="true" tabindex="-1"></a><span class="in">                   na.rm = TRUE) * 24 * 3600,</span></span>
<span id="cb385-9820"><a href="#cb385-9820" aria-hidden="true" tabindex="-1"></a><span class="in">             ymin = -Inf,</span></span>
<span id="cb385-9821"><a href="#cb385-9821" aria-hidden="true" tabindex="-1"></a><span class="in">             ymax = Inf,</span></span>
<span id="cb385-9822"><a href="#cb385-9822" aria-hidden="true" tabindex="-1"></a><span class="in">             alpha = .1,</span></span>
<span id="cb385-9823"><a href="#cb385-9823" aria-hidden="true" tabindex="-1"></a><span class="in">             fill = "black") +</span></span>
<span id="cb385-9824"><a href="#cb385-9824" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_vline(xintercept = ISOdate(2001,</span></span>
<span id="cb385-9825"><a href="#cb385-9825" aria-hidden="true" tabindex="-1"></a><span class="in">                                    12,</span></span>
<span id="cb385-9826"><a href="#cb385-9826" aria-hidden="true" tabindex="-1"></a><span class="in">                                    31) +</span></span>
<span id="cb385-9827"><a href="#cb385-9827" aria-hidden="true" tabindex="-1"></a><span class="in">                 median(plscf$pheno$pheno,</span></span>
<span id="cb385-9828"><a href="#cb385-9828" aria-hidden="true" tabindex="-1"></a><span class="in">                        na.rm=TRUE) * 24 * 3600,</span></span>
<span id="cb385-9829"><a href="#cb385-9829" aria-hidden="true" tabindex="-1"></a><span class="in">               linetype = "dashed") +</span></span>
<span id="cb385-9830"><a href="#cb385-9830" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_ribbon(aes(x = Date,</span></span>
<span id="cb385-9831"><a href="#cb385-9831" aria-hidden="true" tabindex="-1"></a><span class="in">                    ymin = MetricMean - MetricStdev ,</span></span>
<span id="cb385-9832"><a href="#cb385-9832" aria-hidden="true" tabindex="-1"></a><span class="in">                    ymax = MetricMean + MetricStdev ),</span></span>
<span id="cb385-9833"><a href="#cb385-9833" aria-hidden="true" tabindex="-1"></a><span class="in">                fill = "grey") +</span></span>
<span id="cb385-9834"><a href="#cb385-9834" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_ribbon(aes(x = Date,</span></span>
<span id="cb385-9835"><a href="#cb385-9835" aria-hidden="true" tabindex="-1"></a><span class="in">                    ymin = MetricMean - MetricStdev * (VIP_Coeff == -1),</span></span>
<span id="cb385-9836"><a href="#cb385-9836" aria-hidden="true" tabindex="-1"></a><span class="in">                    ymax = MetricMean + MetricStdev * (VIP_Coeff == -1)),</span></span>
<span id="cb385-9837"><a href="#cb385-9837" aria-hidden="true" tabindex="-1"></a><span class="in">                fill = "red") +</span></span>
<span id="cb385-9838"><a href="#cb385-9838" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_ribbon(aes(x = Date,</span></span>
<span id="cb385-9839"><a href="#cb385-9839" aria-hidden="true" tabindex="-1"></a><span class="in">                    ymin = MetricMean - MetricStdev * (VIP_Coeff == 1),</span></span>
<span id="cb385-9840"><a href="#cb385-9840" aria-hidden="true" tabindex="-1"></a><span class="in">                    ymax = MetricMean + MetricStdev * (VIP_Coeff == 1)),</span></span>
<span id="cb385-9841"><a href="#cb385-9841" aria-hidden="true" tabindex="-1"></a><span class="in">                fill = "dark green") +</span></span>
<span id="cb385-9842"><a href="#cb385-9842" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_line(aes(x = Date,</span></span>
<span id="cb385-9843"><a href="#cb385-9843" aria-hidden="true" tabindex="-1"></a><span class="in">                  y = MetricMean)) +</span></span>
<span id="cb385-9844"><a href="#cb385-9844" aria-hidden="true" tabindex="-1"></a><span class="in">    facet_wrap(vars(Type),</span></span>
<span id="cb385-9845"><a href="#cb385-9845" aria-hidden="true" tabindex="-1"></a><span class="in">               scales = "free_y",</span></span>
<span id="cb385-9846"><a href="#cb385-9846" aria-hidden="true" tabindex="-1"></a><span class="in">               strip.position = "left",</span></span>
<span id="cb385-9847"><a href="#cb385-9847" aria-hidden="true" tabindex="-1"></a><span class="in">               labeller = </span></span>
<span id="cb385-9848"><a href="#cb385-9848" aria-hidden="true" tabindex="-1"></a><span class="in">                 labeller(</span></span>
<span id="cb385-9849"><a href="#cb385-9849" aria-hidden="true" tabindex="-1"></a><span class="in">                   Type =</span></span>
<span id="cb385-9850"><a href="#cb385-9850" aria-hidden="true" tabindex="-1"></a><span class="in">                     as_labeller(c(Chill = paste0("Chill (",</span></span>
<span id="cb385-9851"><a href="#cb385-9851" aria-hidden="true" tabindex="-1"></a><span class="in">                                                  chill_label,</span></span>
<span id="cb385-9852"><a href="#cb385-9852" aria-hidden="true" tabindex="-1"></a><span class="in">                                                  ")"),</span></span>
<span id="cb385-9853"><a href="#cb385-9853" aria-hidden="true" tabindex="-1"></a><span class="in">                                   Heat = paste0("Heat (",</span></span>
<span id="cb385-9854"><a href="#cb385-9854" aria-hidden="true" tabindex="-1"></a><span class="in">                                                 heat_label,</span></span>
<span id="cb385-9855"><a href="#cb385-9855" aria-hidden="true" tabindex="-1"></a><span class="in">                                                 ")"))))) +</span></span>
<span id="cb385-9856"><a href="#cb385-9856" aria-hidden="true" tabindex="-1"></a><span class="in">    ggtitle("Daily chill and heat accumulation rates") +</span></span>
<span id="cb385-9857"><a href="#cb385-9857" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_bw(base_size = 15) + </span></span>
<span id="cb385-9858"><a href="#cb385-9858" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(strip.background = element_blank(),</span></span>
<span id="cb385-9859"><a href="#cb385-9859" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.placement = "outside",</span></span>
<span id="cb385-9860"><a href="#cb385-9860" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.text.y = element_text(size = 12),</span></span>
<span id="cb385-9861"><a href="#cb385-9861" aria-hidden="true" tabindex="-1"></a><span class="in">          plot.title = element_text(hjust = 0.5),</span></span>
<span id="cb385-9862"><a href="#cb385-9862" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.title.y = element_blank()</span></span>
<span id="cb385-9863"><a href="#cb385-9863" aria-hidden="true" tabindex="-1"></a><span class="in">          )</span></span>
<span id="cb385-9864"><a href="#cb385-9864" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-9865"><a href="#cb385-9865" aria-hidden="true" tabindex="-1"></a><span class="in">  VIP_plot &lt;- ggplot(PLS_gg,</span></span>
<span id="cb385-9866"><a href="#cb385-9866" aria-hidden="true" tabindex="-1"></a><span class="in">                     aes(x = Date,</span></span>
<span id="cb385-9867"><a href="#cb385-9867" aria-hidden="true" tabindex="-1"></a><span class="in">                         y = VIP)) +</span></span>
<span id="cb385-9868"><a href="#cb385-9868" aria-hidden="true" tabindex="-1"></a><span class="in">    annotate("rect",</span></span>
<span id="cb385-9869"><a href="#cb385-9869" aria-hidden="true" tabindex="-1"></a><span class="in">             xmin = chill_start_date,</span></span>
<span id="cb385-9870"><a href="#cb385-9870" aria-hidden="true" tabindex="-1"></a><span class="in">             xmax = chill_end_date,</span></span>
<span id="cb385-9871"><a href="#cb385-9871" aria-hidden="true" tabindex="-1"></a><span class="in">             ymin = -Inf,</span></span>
<span id="cb385-9872"><a href="#cb385-9872" aria-hidden="true" tabindex="-1"></a><span class="in">             ymax = Inf,</span></span>
<span id="cb385-9873"><a href="#cb385-9873" aria-hidden="true" tabindex="-1"></a><span class="in">             alpha = .1,</span></span>
<span id="cb385-9874"><a href="#cb385-9874" aria-hidden="true" tabindex="-1"></a><span class="in">             fill = "blue") +</span></span>
<span id="cb385-9875"><a href="#cb385-9875" aria-hidden="true" tabindex="-1"></a><span class="in">    annotate("rect",</span></span>
<span id="cb385-9876"><a href="#cb385-9876" aria-hidden="true" tabindex="-1"></a><span class="in">             xmin = heat_start_date,</span></span>
<span id="cb385-9877"><a href="#cb385-9877" aria-hidden="true" tabindex="-1"></a><span class="in">             xmax = heat_end_date,</span></span>
<span id="cb385-9878"><a href="#cb385-9878" aria-hidden="true" tabindex="-1"></a><span class="in">             ymin = -Inf,</span></span>
<span id="cb385-9879"><a href="#cb385-9879" aria-hidden="true" tabindex="-1"></a><span class="in">             ymax = Inf,</span></span>
<span id="cb385-9880"><a href="#cb385-9880" aria-hidden="true" tabindex="-1"></a><span class="in">             alpha = .1,</span></span>
<span id="cb385-9881"><a href="#cb385-9881" aria-hidden="true" tabindex="-1"></a><span class="in">             fill = "red") +</span></span>
<span id="cb385-9882"><a href="#cb385-9882" aria-hidden="true" tabindex="-1"></a><span class="in">    annotate("rect",</span></span>
<span id="cb385-9883"><a href="#cb385-9883" aria-hidden="true" tabindex="-1"></a><span class="in">             xmin = ISOdate(2001,</span></span>
<span id="cb385-9884"><a href="#cb385-9884" aria-hidden="true" tabindex="-1"></a><span class="in">                            12,</span></span>
<span id="cb385-9885"><a href="#cb385-9885" aria-hidden="true" tabindex="-1"></a><span class="in">                            31) + min(plscf$pheno$pheno,</span></span>
<span id="cb385-9886"><a href="#cb385-9886" aria-hidden="true" tabindex="-1"></a><span class="in">                                      na.rm = TRUE) * 24 * 3600,</span></span>
<span id="cb385-9887"><a href="#cb385-9887" aria-hidden="true" tabindex="-1"></a><span class="in">             xmax = ISOdate(2001,</span></span>
<span id="cb385-9888"><a href="#cb385-9888" aria-hidden="true" tabindex="-1"></a><span class="in">                            12,</span></span>
<span id="cb385-9889"><a href="#cb385-9889" aria-hidden="true" tabindex="-1"></a><span class="in">                            31) + max(plscf$pheno$pheno,</span></span>
<span id="cb385-9890"><a href="#cb385-9890" aria-hidden="true" tabindex="-1"></a><span class="in">                                      na.rm = TRUE) * 24 * 3600,</span></span>
<span id="cb385-9891"><a href="#cb385-9891" aria-hidden="true" tabindex="-1"></a><span class="in">             ymin = -Inf,</span></span>
<span id="cb385-9892"><a href="#cb385-9892" aria-hidden="true" tabindex="-1"></a><span class="in">             ymax = Inf,</span></span>
<span id="cb385-9893"><a href="#cb385-9893" aria-hidden="true" tabindex="-1"></a><span class="in">             alpha = .1,</span></span>
<span id="cb385-9894"><a href="#cb385-9894" aria-hidden="true" tabindex="-1"></a><span class="in">             fill = "black") +</span></span>
<span id="cb385-9895"><a href="#cb385-9895" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_vline(xintercept = ISOdate(2001,</span></span>
<span id="cb385-9896"><a href="#cb385-9896" aria-hidden="true" tabindex="-1"></a><span class="in">                                    12,</span></span>
<span id="cb385-9897"><a href="#cb385-9897" aria-hidden="true" tabindex="-1"></a><span class="in">                                    31) + median(plscf$pheno$pheno,</span></span>
<span id="cb385-9898"><a href="#cb385-9898" aria-hidden="true" tabindex="-1"></a><span class="in">                                                 na.rm = TRUE) * 24 * 3600,</span></span>
<span id="cb385-9899"><a href="#cb385-9899" aria-hidden="true" tabindex="-1"></a><span class="in">               linetype = "dashed") +</span></span>
<span id="cb385-9900"><a href="#cb385-9900" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_bar(stat = 'identity',</span></span>
<span id="cb385-9901"><a href="#cb385-9901" aria-hidden="true" tabindex="-1"></a><span class="in">             aes(fill = VIP&gt;0.8)) +</span></span>
<span id="cb385-9902"><a href="#cb385-9902" aria-hidden="true" tabindex="-1"></a><span class="in">    facet_wrap(vars(Type), </span></span>
<span id="cb385-9903"><a href="#cb385-9903" aria-hidden="true" tabindex="-1"></a><span class="in">               scales = "free",</span></span>
<span id="cb385-9904"><a href="#cb385-9904" aria-hidden="true" tabindex="-1"></a><span class="in">               strip.position = "left",</span></span>
<span id="cb385-9905"><a href="#cb385-9905" aria-hidden="true" tabindex="-1"></a><span class="in">               labeller = </span></span>
<span id="cb385-9906"><a href="#cb385-9906" aria-hidden="true" tabindex="-1"></a><span class="in">                 labeller(</span></span>
<span id="cb385-9907"><a href="#cb385-9907" aria-hidden="true" tabindex="-1"></a><span class="in">                   Type = as_labeller(c(Chill="VIP for chill",</span></span>
<span id="cb385-9908"><a href="#cb385-9908" aria-hidden="true" tabindex="-1"></a><span class="in">                                        Heat="VIP for heat")))) +</span></span>
<span id="cb385-9909"><a href="#cb385-9909" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_y_continuous(</span></span>
<span id="cb385-9910"><a href="#cb385-9910" aria-hidden="true" tabindex="-1"></a><span class="in">      limits = c(0,</span></span>
<span id="cb385-9911"><a href="#cb385-9911" aria-hidden="true" tabindex="-1"></a><span class="in">                 max(plscf[[chill_metric]][[heat_metric]]$PLS_summary$VIP))) +</span></span>
<span id="cb385-9912"><a href="#cb385-9912" aria-hidden="true" tabindex="-1"></a><span class="in">    ggtitle("Variable Importance in the Projection (VIP) scores") +</span></span>
<span id="cb385-9913"><a href="#cb385-9913" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_bw(base_size = 15) + </span></span>
<span id="cb385-9914"><a href="#cb385-9914" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(strip.background = element_blank(),</span></span>
<span id="cb385-9915"><a href="#cb385-9915" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.placement = "outside",</span></span>
<span id="cb385-9916"><a href="#cb385-9916" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.text.y = element_text(size = 12),</span></span>
<span id="cb385-9917"><a href="#cb385-9917" aria-hidden="true" tabindex="-1"></a><span class="in">          plot.title = element_text(hjust = 0.5),</span></span>
<span id="cb385-9918"><a href="#cb385-9918" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.title.y = element_blank()</span></span>
<span id="cb385-9919"><a href="#cb385-9919" aria-hidden="true" tabindex="-1"></a><span class="in">          ) +</span></span>
<span id="cb385-9920"><a href="#cb385-9920" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_fill_manual(name = "VIP", </span></span>
<span id="cb385-9921"><a href="#cb385-9921" aria-hidden="true" tabindex="-1"></a><span class="in">                      labels = c("&lt;0.8", "&gt;0.8"), </span></span>
<span id="cb385-9922"><a href="#cb385-9922" aria-hidden="true" tabindex="-1"></a><span class="in">                      values = c("FALSE" = "grey",</span></span>
<span id="cb385-9923"><a href="#cb385-9923" aria-hidden="true" tabindex="-1"></a><span class="in">                                 "TRUE" = "blue")) +</span></span>
<span id="cb385-9924"><a href="#cb385-9924" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(axis.text.x = element_blank(),</span></span>
<span id="cb385-9925"><a href="#cb385-9925" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.ticks.x = element_blank(),</span></span>
<span id="cb385-9926"><a href="#cb385-9926" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.title.x = element_blank(),</span></span>
<span id="cb385-9927"><a href="#cb385-9927" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.title.y = element_blank())</span></span>
<span id="cb385-9928"><a href="#cb385-9928" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-9929"><a href="#cb385-9929" aria-hidden="true" tabindex="-1"></a><span class="in">  coeff_plot &lt;- ggplot(PLS_gg,</span></span>
<span id="cb385-9930"><a href="#cb385-9930" aria-hidden="true" tabindex="-1"></a><span class="in">                       aes(x = Date,</span></span>
<span id="cb385-9931"><a href="#cb385-9931" aria-hidden="true" tabindex="-1"></a><span class="in">                           y = Coef)) +</span></span>
<span id="cb385-9932"><a href="#cb385-9932" aria-hidden="true" tabindex="-1"></a><span class="in">    annotate("rect",</span></span>
<span id="cb385-9933"><a href="#cb385-9933" aria-hidden="true" tabindex="-1"></a><span class="in">             xmin = chill_start_date,</span></span>
<span id="cb385-9934"><a href="#cb385-9934" aria-hidden="true" tabindex="-1"></a><span class="in">             xmax = chill_end_date,</span></span>
<span id="cb385-9935"><a href="#cb385-9935" aria-hidden="true" tabindex="-1"></a><span class="in">             ymin = -Inf,</span></span>
<span id="cb385-9936"><a href="#cb385-9936" aria-hidden="true" tabindex="-1"></a><span class="in">             ymax = Inf,</span></span>
<span id="cb385-9937"><a href="#cb385-9937" aria-hidden="true" tabindex="-1"></a><span class="in">             alpha = .1,</span></span>
<span id="cb385-9938"><a href="#cb385-9938" aria-hidden="true" tabindex="-1"></a><span class="in">             fill = "blue") +</span></span>
<span id="cb385-9939"><a href="#cb385-9939" aria-hidden="true" tabindex="-1"></a><span class="in">    annotate("rect",</span></span>
<span id="cb385-9940"><a href="#cb385-9940" aria-hidden="true" tabindex="-1"></a><span class="in">             xmin = heat_start_date,</span></span>
<span id="cb385-9941"><a href="#cb385-9941" aria-hidden="true" tabindex="-1"></a><span class="in">             xmax = heat_end_date,</span></span>
<span id="cb385-9942"><a href="#cb385-9942" aria-hidden="true" tabindex="-1"></a><span class="in">             ymin = -Inf,</span></span>
<span id="cb385-9943"><a href="#cb385-9943" aria-hidden="true" tabindex="-1"></a><span class="in">             ymax = Inf,</span></span>
<span id="cb385-9944"><a href="#cb385-9944" aria-hidden="true" tabindex="-1"></a><span class="in">             alpha = .1,</span></span>
<span id="cb385-9945"><a href="#cb385-9945" aria-hidden="true" tabindex="-1"></a><span class="in">             fill = "red") +</span></span>
<span id="cb385-9946"><a href="#cb385-9946" aria-hidden="true" tabindex="-1"></a><span class="in">    annotate("rect",</span></span>
<span id="cb385-9947"><a href="#cb385-9947" aria-hidden="true" tabindex="-1"></a><span class="in">             xmin = ISOdate(2001,</span></span>
<span id="cb385-9948"><a href="#cb385-9948" aria-hidden="true" tabindex="-1"></a><span class="in">                            12,</span></span>
<span id="cb385-9949"><a href="#cb385-9949" aria-hidden="true" tabindex="-1"></a><span class="in">                            31) + min(plscf$pheno$pheno,</span></span>
<span id="cb385-9950"><a href="#cb385-9950" aria-hidden="true" tabindex="-1"></a><span class="in">                                      na.rm = TRUE) * 24 * 3600,</span></span>
<span id="cb385-9951"><a href="#cb385-9951" aria-hidden="true" tabindex="-1"></a><span class="in">             xmax = ISOdate(2001,</span></span>
<span id="cb385-9952"><a href="#cb385-9952" aria-hidden="true" tabindex="-1"></a><span class="in">                            12,</span></span>
<span id="cb385-9953"><a href="#cb385-9953" aria-hidden="true" tabindex="-1"></a><span class="in">                            31) + max(plscf$pheno$pheno,</span></span>
<span id="cb385-9954"><a href="#cb385-9954" aria-hidden="true" tabindex="-1"></a><span class="in">                                      na.rm = TRUE) * 24 * 3600,</span></span>
<span id="cb385-9955"><a href="#cb385-9955" aria-hidden="true" tabindex="-1"></a><span class="in">             ymin = -Inf,</span></span>
<span id="cb385-9956"><a href="#cb385-9956" aria-hidden="true" tabindex="-1"></a><span class="in">             ymax = Inf,</span></span>
<span id="cb385-9957"><a href="#cb385-9957" aria-hidden="true" tabindex="-1"></a><span class="in">             alpha = .1,</span></span>
<span id="cb385-9958"><a href="#cb385-9958" aria-hidden="true" tabindex="-1"></a><span class="in">             fill = "black") +</span></span>
<span id="cb385-9959"><a href="#cb385-9959" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_vline(xintercept = ISOdate(2001,</span></span>
<span id="cb385-9960"><a href="#cb385-9960" aria-hidden="true" tabindex="-1"></a><span class="in">                                    12,</span></span>
<span id="cb385-9961"><a href="#cb385-9961" aria-hidden="true" tabindex="-1"></a><span class="in">                                    31) + median(plscf$pheno$pheno,</span></span>
<span id="cb385-9962"><a href="#cb385-9962" aria-hidden="true" tabindex="-1"></a><span class="in">                                                 na.rm = TRUE) * 24 * 3600,</span></span>
<span id="cb385-9963"><a href="#cb385-9963" aria-hidden="true" tabindex="-1"></a><span class="in">               linetype = "dashed") +</span></span>
<span id="cb385-9964"><a href="#cb385-9964" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_bar(stat = 'identity',</span></span>
<span id="cb385-9965"><a href="#cb385-9965" aria-hidden="true" tabindex="-1"></a><span class="in">             aes(fill = VIP_Coeff)) +</span></span>
<span id="cb385-9966"><a href="#cb385-9966" aria-hidden="true" tabindex="-1"></a><span class="in">    facet_wrap(vars(Type),</span></span>
<span id="cb385-9967"><a href="#cb385-9967" aria-hidden="true" tabindex="-1"></a><span class="in">               scales = "free",</span></span>
<span id="cb385-9968"><a href="#cb385-9968" aria-hidden="true" tabindex="-1"></a><span class="in">               strip.position = "left",</span></span>
<span id="cb385-9969"><a href="#cb385-9969" aria-hidden="true" tabindex="-1"></a><span class="in">               labeller =</span></span>
<span id="cb385-9970"><a href="#cb385-9970" aria-hidden="true" tabindex="-1"></a><span class="in">                 labeller(</span></span>
<span id="cb385-9971"><a href="#cb385-9971" aria-hidden="true" tabindex="-1"></a><span class="in">                   Type = as_labeller(c(Chill = "MC for chill",</span></span>
<span id="cb385-9972"><a href="#cb385-9972" aria-hidden="true" tabindex="-1"></a><span class="in">                                        Heat = "MC for heat")))) +</span></span>
<span id="cb385-9973"><a href="#cb385-9973" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_y_continuous(</span></span>
<span id="cb385-9974"><a href="#cb385-9974" aria-hidden="true" tabindex="-1"></a><span class="in">      limits = c(min(plscf[[chill_metric]][[heat_metric]]$PLS_summary$Coef),</span></span>
<span id="cb385-9975"><a href="#cb385-9975" aria-hidden="true" tabindex="-1"></a><span class="in">                 max(plscf[[chill_metric]][[heat_metric]]$PLS_summary$Coef))) +</span></span>
<span id="cb385-9976"><a href="#cb385-9976" aria-hidden="true" tabindex="-1"></a><span class="in">    ggtitle("Model coefficients (MC)") +</span></span>
<span id="cb385-9977"><a href="#cb385-9977" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_bw(base_size = 15) + </span></span>
<span id="cb385-9978"><a href="#cb385-9978" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(strip.background = element_blank(),</span></span>
<span id="cb385-9979"><a href="#cb385-9979" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.placement = "outside",</span></span>
<span id="cb385-9980"><a href="#cb385-9980" aria-hidden="true" tabindex="-1"></a><span class="in">          strip.text.y = element_text(size = 12),</span></span>
<span id="cb385-9981"><a href="#cb385-9981" aria-hidden="true" tabindex="-1"></a><span class="in">          plot.title = element_text(hjust = 0.5),</span></span>
<span id="cb385-9982"><a href="#cb385-9982" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.title.y = element_blank()</span></span>
<span id="cb385-9983"><a href="#cb385-9983" aria-hidden="true" tabindex="-1"></a><span class="in">          ) +</span></span>
<span id="cb385-9984"><a href="#cb385-9984" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_fill_manual(name = "Effect direction", </span></span>
<span id="cb385-9985"><a href="#cb385-9985" aria-hidden="true" tabindex="-1"></a><span class="in">                      labels = c("Advancing",</span></span>
<span id="cb385-9986"><a href="#cb385-9986" aria-hidden="true" tabindex="-1"></a><span class="in">                                 "Unimportant",</span></span>
<span id="cb385-9987"><a href="#cb385-9987" aria-hidden="true" tabindex="-1"></a><span class="in">                                 "Delaying"), </span></span>
<span id="cb385-9988"><a href="#cb385-9988" aria-hidden="true" tabindex="-1"></a><span class="in">                      values = c("-1" = "red",</span></span>
<span id="cb385-9989"><a href="#cb385-9989" aria-hidden="true" tabindex="-1"></a><span class="in">                                 "0" = "grey",</span></span>
<span id="cb385-9990"><a href="#cb385-9990" aria-hidden="true" tabindex="-1"></a><span class="in">                                 "1" = "dark green")) +</span></span>
<span id="cb385-9991"><a href="#cb385-9991" aria-hidden="true" tabindex="-1"></a><span class="in">    ylab("PLS coefficient") +</span></span>
<span id="cb385-9992"><a href="#cb385-9992" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(axis.text.x = element_blank(),</span></span>
<span id="cb385-9993"><a href="#cb385-9993" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.ticks.x = element_blank(),</span></span>
<span id="cb385-9994"><a href="#cb385-9994" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.title.x = element_blank(),</span></span>
<span id="cb385-9995"><a href="#cb385-9995" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.title.y = element_blank())</span></span>
<span id="cb385-9996"><a href="#cb385-9996" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-9997"><a href="#cb385-9997" aria-hidden="true" tabindex="-1"></a><span class="in">  library(patchwork)</span></span>
<span id="cb385-9998"><a href="#cb385-9998" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb385-9999"><a href="#cb385-9999" aria-hidden="true" tabindex="-1"></a><span class="in">  plot &lt;- (VIP_plot +</span></span>
<span id="cb385-10000"><a href="#cb385-10000" aria-hidden="true" tabindex="-1"></a><span class="in">             coeff_plot +</span></span>
<span id="cb385-10001"><a href="#cb385-10001" aria-hidden="true" tabindex="-1"></a><span class="in">             temp_plot +</span></span>
<span id="cb385-10002"><a href="#cb385-10002" aria-hidden="true" tabindex="-1"></a><span class="in">             plot_layout(ncol = 1,</span></span>
<span id="cb385-10003"><a href="#cb385-10003" aria-hidden="true" tabindex="-1"></a><span class="in">                         guides = "collect")</span></span>
<span id="cb385-10004"><a href="#cb385-10004" aria-hidden="true" tabindex="-1"></a><span class="in">           ) &amp; theme(legend.position = "right",</span></span>
<span id="cb385-10005"><a href="#cb385-10005" aria-hidden="true" tabindex="-1"></a><span class="in">                     legend.text = element_text(size = 8),</span></span>
<span id="cb385-10006"><a href="#cb385-10006" aria-hidden="true" tabindex="-1"></a><span class="in">                     legend.title = element_text(size = 10),</span></span>
<span id="cb385-10007"><a href="#cb385-10007" aria-hidden="true" tabindex="-1"></a><span class="in">                     axis.title.x = element_blank())</span></span>
<span id="cb385-10008"><a href="#cb385-10008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10009"><a href="#cb385-10009" aria-hidden="true" tabindex="-1"></a><span class="in">plot</span></span>
<span id="cb385-10010"><a href="#cb385-10010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10011"><a href="#cb385-10011" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb385-10012"><a href="#cb385-10012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10013"><a href="#cb385-10013" aria-hidden="true" tabindex="-1"></a><span class="in">plot_PLS_chill_force(plscf)</span></span>
<span id="cb385-10014"><a href="#cb385-10014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10015"><a href="#cb385-10015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10016"><a href="#cb385-10016" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-10017"><a href="#cb385-10017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10018"><a href="#cb385-10018" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-10019"><a href="#cb385-10019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10020"><a href="#cb385-10020" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now that we’ve automated the plot production, we can easily look at how useful other chill models would be in delineating chilling and forcing periods.</span>
<span id="cb385-10021"><a href="#cb385-10021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10022"><a href="#cb385-10022" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 23.4f}</span></span>
<span id="cb385-10023"><a href="#cb385-10023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10024"><a href="#cb385-10024" aria-hidden="true" tabindex="-1"></a><span class="in">daychill &lt;- daily_chill(hourtemps = temps_hourly,</span></span>
<span id="cb385-10025"><a href="#cb385-10025" aria-hidden="true" tabindex="-1"></a><span class="in">                        running_mean = 11,</span></span>
<span id="cb385-10026"><a href="#cb385-10026" aria-hidden="true" tabindex="-1"></a><span class="in">                        models = list(Chilling_Hours = Chilling_Hours,</span></span>
<span id="cb385-10027"><a href="#cb385-10027" aria-hidden="true" tabindex="-1"></a><span class="in">                                      Utah_Chill_Units = Utah_Model,</span></span>
<span id="cb385-10028"><a href="#cb385-10028" aria-hidden="true" tabindex="-1"></a><span class="in">                                      Chill_Portions = Dynamic_Model,</span></span>
<span id="cb385-10029"><a href="#cb385-10029" aria-hidden="true" tabindex="-1"></a><span class="in">                                      GDH = GDH)</span></span>
<span id="cb385-10030"><a href="#cb385-10030" aria-hidden="true" tabindex="-1"></a><span class="in">                        )</span></span>
<span id="cb385-10031"><a href="#cb385-10031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10032"><a href="#cb385-10032" aria-hidden="true" tabindex="-1"></a><span class="in">plscf &lt;- PLS_chill_force(daily_chill_obj = daychill,</span></span>
<span id="cb385-10033"><a href="#cb385-10033" aria-hidden="true" tabindex="-1"></a><span class="in">                         bio_data_frame = Alex_first,</span></span>
<span id="cb385-10034"><a href="#cb385-10034" aria-hidden="true" tabindex="-1"></a><span class="in">                         split_month = 6,</span></span>
<span id="cb385-10035"><a href="#cb385-10035" aria-hidden="true" tabindex="-1"></a><span class="in">                         chill_models = c("Chilling_Hours",</span></span>
<span id="cb385-10036"><a href="#cb385-10036" aria-hidden="true" tabindex="-1"></a><span class="in">                                          "Utah_Chill_Units",</span></span>
<span id="cb385-10037"><a href="#cb385-10037" aria-hidden="true" tabindex="-1"></a><span class="in">                                          "Chill_Portions"),</span></span>
<span id="cb385-10038"><a href="#cb385-10038" aria-hidden="true" tabindex="-1"></a><span class="in">                       heat_models = c("GDH"))</span></span>
<span id="cb385-10039"><a href="#cb385-10039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10040"><a href="#cb385-10040" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the Chilling Hours Model</span></span>
<span id="cb385-10041"><a href="#cb385-10041" aria-hidden="true" tabindex="-1"></a><span class="in">plot_PLS_chill_force(plscf,</span></span>
<span id="cb385-10042"><a href="#cb385-10042" aria-hidden="true" tabindex="-1"></a><span class="in">                     chill_metric = "Chilling_Hours",</span></span>
<span id="cb385-10043"><a href="#cb385-10043" aria-hidden="true" tabindex="-1"></a><span class="in">                     heat_metric = "GDH",</span></span>
<span id="cb385-10044"><a href="#cb385-10044" aria-hidden="true" tabindex="-1"></a><span class="in">                     chill_label = "CH",</span></span>
<span id="cb385-10045"><a href="#cb385-10045" aria-hidden="true" tabindex="-1"></a><span class="in">                     heat_label = "GDH",</span></span>
<span id="cb385-10046"><a href="#cb385-10046" aria-hidden="true" tabindex="-1"></a><span class="in">                     chill_phase = c(0,0),</span></span>
<span id="cb385-10047"><a href="#cb385-10047" aria-hidden="true" tabindex="-1"></a><span class="in">                     heat_phase = c(0,0)) # unspecified chill/heat period?</span></span>
<span id="cb385-10048"><a href="#cb385-10048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10049"><a href="#cb385-10049" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the Utah Model</span></span>
<span id="cb385-10050"><a href="#cb385-10050" aria-hidden="true" tabindex="-1"></a><span class="in">plot_PLS_chill_force(plscf,</span></span>
<span id="cb385-10051"><a href="#cb385-10051" aria-hidden="true" tabindex="-1"></a><span class="in">                     chill_metric = "Utah_Chill_Units",</span></span>
<span id="cb385-10052"><a href="#cb385-10052" aria-hidden="true" tabindex="-1"></a><span class="in">                     heat_metric = "GDH",</span></span>
<span id="cb385-10053"><a href="#cb385-10053" aria-hidden="true" tabindex="-1"></a><span class="in">                     chill_label = "CU",</span></span>
<span id="cb385-10054"><a href="#cb385-10054" aria-hidden="true" tabindex="-1"></a><span class="in">                     heat_label = "GDH",</span></span>
<span id="cb385-10055"><a href="#cb385-10055" aria-hidden="true" tabindex="-1"></a><span class="in">                     chill_phase = c(0,0),</span></span>
<span id="cb385-10056"><a href="#cb385-10056" aria-hidden="true" tabindex="-1"></a><span class="in">                     heat_phase = c(0,0))</span></span>
<span id="cb385-10057"><a href="#cb385-10057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10058"><a href="#cb385-10058" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb385-10059"><a href="#cb385-10059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10060"><a href="#cb385-10060" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-10061"><a href="#cb385-10061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10062"><a href="#cb385-10062" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>So the other two common models aren’t so great at picking up the chilling period either.</span>
<span id="cb385-10063"><a href="#cb385-10063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10064"><a href="#cb385-10064" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-10065"><a href="#cb385-10065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10066"><a href="#cb385-10066" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;23.5&lt;/span&gt;&amp;nbsp; Exercises on chill model comparison</span></span>
<span id="cb385-10067"><a href="#cb385-10067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10068"><a href="#cb385-10068" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb385-10069"><a href="#cb385-10069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10070"><a href="#cb385-10070" aria-hidden="true" tabindex="-1"></a>***1. Repeat the `PLS_chill_force` procedure for the ‘Roter Boskoop’ dataset. Include plots of daily chill and heat accumulation.***</span>
<span id="cb385-10071"><a href="#cb385-10071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10072"><a href="#cb385-10072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10073"><a href="#cb385-10073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10074"><a href="#cb385-10074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10075"><a href="#cb385-10075" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-10076"><a href="#cb385-10076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10077"><a href="#cb385-10077" aria-hidden="true" tabindex="-1"></a>***2. Run `PLS_chill_force` analyses for all three major chill models. Delineate your best estimates of chilling and forcing phases for all of them.***</span>
<span id="cb385-10078"><a href="#cb385-10078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10079"><a href="#cb385-10079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10080"><a href="#cb385-10080" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb385-10081"><a href="#cb385-10081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10082"><a href="#cb385-10082" aria-hidden="true" tabindex="-1"></a>***3. Plot results for all three analyses, including shaded plot areas for the chilling and forcing periods you estimated.***</span>
<span id="cb385-10083"><a href="#cb385-10083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10084"><a href="#cb385-10084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10085"><a href="#cb385-10085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10086"><a href="#cb385-10086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10087"><a href="#cb385-10087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10088"><a href="#cb385-10088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10089"><a href="#cb385-10089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10090"><a href="#cb385-10090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10091"><a href="#cb385-10091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-10092"><a href="#cb385-10092" aria-hidden="true" tabindex="-1"></a>---</span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



<script src="Tree_Phenology_Analysis_in_R_Logbook_files/libs/quarto-html/zenscroll-min.js"></script>
</body></html>