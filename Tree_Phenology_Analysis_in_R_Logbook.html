<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="SM">
<meta name="dcterms.date" content="2024-12-27">
<title>Tree Phenology Analysis with R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="Tree_Phenology_Analysis_in_R_Logbook_files/libs/clipboard/clipboard.min.js"></script>
<script src="Tree_Phenology_Analysis_in_R_Logbook_files/libs/quarto-html/quarto.js"></script>
<script src="Tree_Phenology_Analysis_in_R_Logbook_files/libs/quarto-html/popper.min.js"></script>
<script src="Tree_Phenology_Analysis_in_R_Logbook_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Tree_Phenology_Analysis_in_R_Logbook_files/libs/quarto-html/anchor.min.js"></script>
<link href="Tree_Phenology_Analysis_in_R_Logbook_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Tree_Phenology_Analysis_in_R_Logbook_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Tree_Phenology_Analysis_in_R_Logbook_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Tree_Phenology_Analysis_in_R_Logbook_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Tree_Phenology_Analysis_in_R_Logbook_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><style>html{ scroll-behavior: smooth; }</style>
<script src="Tree_Phenology_Analysis_in_R_Logbook_files/libs/kePrint-0.0.1/kePrint.js"></script><link href="Tree_Phenology_Analysis_in_R_Logbook_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Contents</h2>
   
  <ul>
<li>
<a href="#chapter-3-tree-dormancy" id="toc-chapter-3-tree-dormancy" class="nav-link active" data-scroll-target="#chapter-3-tree-dormancy">Chapter 3: Tree Dormancy</a>
  <ul>
<li><a href="#introduction-to-dormancy" id="toc-introduction-to-dormancy" class="nav-link" data-scroll-target="#introduction-to-dormancy"><span style="color:#71797E">3.1</span>&nbsp; Introduction to dormancy</a></li>
  <li><a href="#dormancy-physiology" id="toc-dormancy-physiology" class="nav-link" data-scroll-target="#dormancy-physiology"><span style="color:#71797E">3.2</span>&nbsp; Dormancy physiology</a></li>
  <li><a href="#experimental-and-statistical-determination-of-the-chilling-and-forcing-periods" id="toc-experimental-and-statistical-determination-of-the-chilling-and-forcing-periods" class="nav-link" data-scroll-target="#experimental-and-statistical-determination-of-the-chilling-and-forcing-periods"><span style="color:#71797E">3.3</span>&nbsp; Experimental and statistical determination of the chilling and forcing periods</a></li>
  <li><a href="#phenology-record-and-bbch-scale" id="toc-phenology-record-and-bbch-scale" class="nav-link" data-scroll-target="#phenology-record-and-bbch-scale"><span style="color:#71797E">3.4</span>&nbsp; Phenology record and BBCH scale</a></li>
  <li><a href="#exercises-on-tree-dormancy" id="toc-exercises-on-tree-dormancy" class="nav-link" data-scroll-target="#exercises-on-tree-dormancy"><span style="color:#71797E">3.5</span>&nbsp; Exercises on tree dormancy</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-4-climate-change-and-impact-projection" id="toc-chapter-4-climate-change-and-impact-projection" class="nav-link" data-scroll-target="#chapter-4-climate-change-and-impact-projection">Chapter 4: Climate change and impact projection</a>
  <ul>
<li><a href="#the-drivers-of-climate-change" id="toc-the-drivers-of-climate-change" class="nav-link" data-scroll-target="#the-drivers-of-climate-change"><span style="color:#71797E">4.1</span>&nbsp; The drivers of climate change</a></li>
  <li><a href="#what-weve-already-seen" id="toc-what-weve-already-seen" class="nav-link" data-scroll-target="#what-weve-already-seen"><span style="color:#71797E">4.2</span>&nbsp; What we’ve already seen</a></li>
  <li><a href="#future-scenarios" id="toc-future-scenarios" class="nav-link" data-scroll-target="#future-scenarios"><span style="color:#71797E">4.3</span>&nbsp; Future scenarios</a></li>
  <li><a href="#impact-projection-approaches" id="toc-impact-projection-approaches" class="nav-link" data-scroll-target="#impact-projection-approaches"><span style="color:#71797E">4.4</span>&nbsp; Impact projection approaches</a></li>
  <li><a href="#exercises-on-climate-change" id="toc-exercises-on-climate-change" class="nav-link" data-scroll-target="#exercises-on-climate-change"><span style="color:#71797E">4.5</span>&nbsp; Exercises on climate change</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-5-winter-chill-projections" id="toc-chapter-5-winter-chill-projections" class="nav-link" data-scroll-target="#chapter-5-winter-chill-projections">Chapter 5: Winter chill projections</a>
  <ul>
<li>
<a href="#winter-chill-projections" id="toc-winter-chill-projections" class="nav-link" data-scroll-target="#winter-chill-projections"><span style="color:#71797E">5.1</span>&nbsp; Winter chill projections</a>
  <ul>
<li><a href="#winter-chill-in-oman" id="toc-winter-chill-in-oman" class="nav-link" data-scroll-target="#winter-chill-in-oman"><span style="color:#71797E">5.1.1</span>&nbsp; Winter chill in Oman</a></li>
  <li><a href="#chill-model-sensitivity" id="toc-chill-model-sensitivity" class="nav-link" data-scroll-target="#chill-model-sensitivity"><span style="color:#71797E">5.1.2</span>&nbsp; Chill model sensitivity</a></li>
  <li><a href="#winter-chill-in-california" id="toc-winter-chill-in-california" class="nav-link" data-scroll-target="#winter-chill-in-california"><span style="color:#71797E">5.1.3</span>&nbsp; Winter chill in California</a></li>
  <li><a href="#winter-chill-ratios" id="toc-winter-chill-ratios" class="nav-link" data-scroll-target="#winter-chill-ratios"><span style="color:#71797E">5.1.4</span>&nbsp; Winter chill ratios</a></li>
  <li><a href="#a-global-pojection-of-future-winter-chill" id="toc-a-global-pojection-of-future-winter-chill" class="nav-link" data-scroll-target="#a-global-pojection-of-future-winter-chill"><span style="color:#71797E">5.1.5</span>&nbsp; A global pojection of future winter chill</a></li>
  <li><a href="#winter-chill-in-germany" id="toc-winter-chill-in-germany" class="nav-link" data-scroll-target="#winter-chill-in-germany"><span style="color:#71797E">5.1.6</span>&nbsp; Winter chill in Germany</a></li>
  <li><a href="#winter-chill-in-tunisia" id="toc-winter-chill-in-tunisia" class="nav-link" data-scroll-target="#winter-chill-in-tunisia"><span style="color:#71797E">5.1.7</span>&nbsp; Winter chill in Tunisia</a></li>
  <li><a href="#winter-chill-in-chile" id="toc-winter-chill-in-chile" class="nav-link" data-scroll-target="#winter-chill-in-chile"><span style="color:#71797E">5.1.8</span>&nbsp; Winter chill in Chile</a></li>
  <li><a href="#chill-projection-for-patagonia" id="toc-chill-projection-for-patagonia" class="nav-link" data-scroll-target="#chill-projection-for-patagonia"><span style="color:#71797E">5.1.9</span>&nbsp; Chill projection for Patagonia</a></li>
  <li><a href="#chill-model-comparison" id="toc-chill-model-comparison" class="nav-link" data-scroll-target="#chill-model-comparison"><span style="color:#71797E">5.1.10</span>&nbsp; Chill model comparison</a></li>
  <li><a href="#chill-projection-for-all-of-tunisia" id="toc-chill-projection-for-all-of-tunisia" class="nav-link" data-scroll-target="#chill-projection-for-all-of-tunisia"><span style="color:#71797E">5.1.11</span>&nbsp; Chill projection for all of Tunisia</a></li>
  <li><a href="#revisiting-chill-accumulation-in-oman" id="toc-revisiting-chill-accumulation-in-oman" class="nav-link" data-scroll-target="#revisiting-chill-accumulation-in-oman"><span style="color:#71797E">5.1.12</span>&nbsp; Revisiting chill accumulation in Oman</a></li>
  </ul>
</li>
  <li><a href="#exercises-on-past-chill-projections" id="toc-exercises-on-past-chill-projections" class="nav-link" data-scroll-target="#exercises-on-past-chill-projections"><span style="color:#71797E">5.2</span>&nbsp; Exercises on past chill projections</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-6-manual-chill-analysis" id="toc-chapter-6-manual-chill-analysis" class="nav-link" data-scroll-target="#chapter-6-manual-chill-analysis">Chapter 6: Manual chill analysis</a>
  <ul>
<li>
<a href="#computing-chilling-hours-from-hourly-temperature-data" id="toc-computing-chilling-hours-from-hourly-temperature-data" class="nav-link" data-scroll-target="#computing-chilling-hours-from-hourly-temperature-data"><span style="color:#71797E">6.1</span>&nbsp; Computing Chilling Hours from hourly temperature data</a>
  <ul>
<li><a href="#display-the-winters_hours_gaps-dataset-in-chillr-using-kable" id="toc-display-the-winters_hours_gaps-dataset-in-chillr-using-kable" class="nav-link" data-scroll-target="#display-the-winters_hours_gaps-dataset-in-chillr-using-kable"><em>Display the <code>Winters_hours_gaps</code> dataset in <code>chillR</code> using <code>kable</code></em></a></li>
  <li><a href="#remove-column-temp_gaps-and-create-a-new-dataset-hourtemps" id="toc-remove-column-temp_gaps-and-create-a-new-dataset-hourtemps" class="nav-link" data-scroll-target="#remove-column-temp_gaps-and-create-a-new-dataset-hourtemps"><em>Remove column <code>Temp_gaps</code> and create a new dataset (<code>hourtemps</code>)</em></a></li>
  <li><a href="#display-only-the-third-row-with-all-columns" id="toc-display-only-the-third-row-with-all-columns" class="nav-link" data-scroll-target="#display-only-the-third-row-with-all-columns"><em>Display only the third row with all columns</em></a></li>
  <li><a href="#display-the-temp-column-of-the-third-row-only" id="toc-display-the-temp-column-of-the-third-row-only" class="nav-link" data-scroll-target="#display-the-temp-column-of-the-third-row-only"><em>Display the <code>Temp</code> column of the third row only</em></a></li>
  <li><a href="#display-the-first-five-rows-of-temp-column" id="toc-display-the-first-five-rows-of-temp-column" class="nav-link" data-scroll-target="#display-the-first-five-rows-of-temp-column"><em>Display the first five rows of <code>Temp</code> column</em></a></li>
  <li><a href="#display-the-first-five-rows-and-all-columns-of-hourtemps-dataset" id="toc-display-the-first-five-rows-and-all-columns-of-hourtemps-dataset" class="nav-link" data-scroll-target="#display-the-first-five-rows-and-all-columns-of-hourtemps-dataset"><em>Display the first five rows and all columns of <code>hourtemps</code> dataset</em></a></li>
  <li>
<a href="#check-for-temperatures-that-fall-within-chilling-hours-range" id="toc-check-for-temperatures-that-fall-within-chilling-hours-range" class="nav-link" data-scroll-target="#check-for-temperatures-that-fall-within-chilling-hours-range"><em>Check for temperatures that fall within <code>Chilling Hours</code> range</em></a>
  <ul>
<li><a href="#using-simple-comparison-commands" id="toc-using-simple-comparison-commands" class="nav-link" data-scroll-target="#using-simple-comparison-commands"><em>Using simple comparison commands</em></a></li>
  <li><a href="#check-for-chilling-hours" id="toc-check-for-chilling-hours" class="nav-link" data-scroll-target="#check-for-chilling-hours"><em>Check for <code>Chilling Hours</code></em></a></li>
  </ul>
</li>
  </ul>
</li>
  <li><a href="#our-first-chill-function" id="toc-our-first-chill-function" class="nav-link" data-scroll-target="#our-first-chill-function"><span style="color:#71797E">6.2</span>&nbsp; Our first chill function</a></li>
  <li><a href="#exercise-on-basic-chill-modeling" id="toc-exercise-on-basic-chill-modeling" class="nav-link" data-scroll-target="#exercise-on-basic-chill-modeling"><span style="color:#71797E">6.3</span>&nbsp; Exercise on basic chill modeling</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-7-chill-models" id="toc-chapter-7-chill-models" class="nav-link" data-scroll-target="#chapter-7-chill-models">Chapter 7: Chill models</a>
  <ul>
<li>
<a href="#chill-models-in-chillr" id="toc-chill-models-in-chillr" class="nav-link" data-scroll-target="#chill-models-in-chillr"><span style="color:#71797E">7.1</span>&nbsp; Chill models in <code>chillR</code></a>
  <ul>
<li><a href="#chilling_hours-function" id="toc-chilling_hours-function" class="nav-link" data-scroll-target="#chilling_hours-function"><em><code>Chilling_Hours()</code> function</em></a></li>
  <li><a href="#the-utah-model" id="toc-the-utah-model" class="nav-link" data-scroll-target="#the-utah-model"><em>The Utah model</em></a></li>
  <li><a href="#the-dynamic-model" id="toc-the-dynamic-model" class="nav-link" data-scroll-target="#the-dynamic-model"><em>The dynamic model</em></a></li>
  <li><a href="#make_jday-and-tempresponse-functions" id="toc-make_jday-and-tempresponse-functions" class="nav-link" data-scroll-target="#make_jday-and-tempresponse-functions"><em><code>make_JDay()</code> and <code>tempResponse</code> functions</em></a></li>
  </ul>
</li>
  <li><a href="#exercise-on-chill-models" id="toc-exercise-on-chill-models" class="nav-link" data-scroll-target="#exercise-on-chill-models"><span style="color:#71797E">7.2</span>&nbsp; Exercise on chill models</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-8-making-hourly-temperatures" id="toc-chapter-8-making-hourly-temperatures" class="nav-link" data-scroll-target="#chapter-8-making-hourly-temperatures">Chapter 8: Making hourly temperatures</a>
  <ul>
<li>
<a href="#generating-hourly-temperatures" id="toc-generating-hourly-temperatures" class="nav-link" data-scroll-target="#generating-hourly-temperatures"><span style="color:#71797E">8.1</span>&nbsp; Generating hourly temperatures</a>
  <ul>
<li>
<a href="#idealized-daily-temperature-curves" id="toc-idealized-daily-temperature-curves" class="nav-link" data-scroll-target="#idealized-daily-temperature-curves"><span style="color:#71797E">8.1.1</span>&nbsp; Idealized daily temperature curves</a>
  <ul>
<li><a href="#calculate-hourly-temperatures" id="toc-calculate-hourly-temperatures" class="nav-link" data-scroll-target="#calculate-hourly-temperatures"><em>Calculate hourly temperatures</em></a></li>
  </ul>
</li>
  <li>
<a href="#empirical-daily-temperature-curves" id="toc-empirical-daily-temperature-curves" class="nav-link" data-scroll-target="#empirical-daily-temperature-curves"><span style="color:#71797E">8.1.2</span>&nbsp; Empirical daily temperature curves</a>
  <ul>
<li><a href="#make_all_day_table-function" id="toc-make_all_day_table-function" class="nav-link" data-scroll-target="#make_all_day_table-function"><em><code>make_all_day_table</code> function</em></a></li>
  </ul>
</li>
  </ul>
</li>
  <li><a href="#exercise-on-hourly-temperatures" id="toc-exercise-on-hourly-temperatures" class="nav-link" data-scroll-target="#exercise-on-hourly-temperatures"><span style="color:#71797E">8.2</span>&nbsp; Exercise on hourly temperatures</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-9-some-useful-tools-in-r" id="toc-chapter-9-some-useful-tools-in-r" class="nav-link" data-scroll-target="#chapter-9-some-useful-tools-in-r">Chapter 9: Some useful tools in R</a>
  <ul>
<li><a href="#an-evolving-language-and-a-lifelong-learning-process" id="toc-an-evolving-language-and-a-lifelong-learning-process" class="nav-link" data-scroll-target="#an-evolving-language-and-a-lifelong-learning-process"><span style="color:#71797E">9.1</span>&nbsp; An evolving language— and a lifelong learning process</a></li>
  <li><a href="#the-tidyverse" id="toc-the-tidyverse" class="nav-link" data-scroll-target="#the-tidyverse"><span style="color:#71797E">9.2</span>&nbsp; The <code>tidyverse</code></a></li>
  <li><a href="#the-ggplot2-package" id="toc-the-ggplot2-package" class="nav-link" data-scroll-target="#the-ggplot2-package"><span style="color:#71797E">9.3</span>&nbsp; The <code>ggplot2</code> package</a></li>
  <li><a href="#the-tibble-package" id="toc-the-tibble-package" class="nav-link" data-scroll-target="#the-tibble-package"><span style="color:#71797E">9.3</span>&nbsp; The <code>tibble</code> package</a></li>
  <li><a href="#the-magrittr-package-pipes" id="toc-the-magrittr-package-pipes" class="nav-link" data-scroll-target="#the-magrittr-package-pipes"><span style="color:#71797E">9.5</span>&nbsp; The <code>magrittr</code> package— pipes</a></li>
  <li>
<a href="#the-tidyr-package" id="toc-the-tidyr-package" class="nav-link" data-scroll-target="#the-tidyr-package"><span style="color:#71797E">9.6</span>&nbsp; The <code>tidyr</code> package</a>
  <ul>
<li><a href="#pivot_longer" id="toc-pivot_longer" class="nav-link" data-scroll-target="#pivot_longer"><span style="color:#71797E">9.6.1</span>&nbsp; <code>pivot_longer</code></a></li>
  <li><a href="#pivot_wider" id="toc-pivot_wider" class="nav-link" data-scroll-target="#pivot_wider"><span style="color:#71797E">9.6.2</span>&nbsp; <code>pivot_wider</code></a></li>
  <li><a href="#select" id="toc-select" class="nav-link" data-scroll-target="#select"><span style="color:#71797E">9.6.3</span>&nbsp; <code>select</code></a></li>
  <li><a href="#filter" id="toc-filter" class="nav-link" data-scroll-target="#filter"><span style="color:#71797E">9.6.4</span>&nbsp; <code>filter</code></a></li>
  <li><a href="#mutate" id="toc-mutate" class="nav-link" data-scroll-target="#mutate"><span style="color:#71797E">9.6.5</span>&nbsp; <code>mutate</code></a></li>
  <li><a href="#arrange" id="toc-arrange" class="nav-link" data-scroll-target="#arrange"><span style="color:#71797E">9.6.6</span>&nbsp; <code>arrange</code></a></li>
  </ul>
</li>
  <li>
<a href="#loops" id="toc-loops" class="nav-link" data-scroll-target="#loops"><span style="color:#71797E">9.7</span>&nbsp; Loops</a>
  <ul>
<li><a href="#for-loops" id="toc-for-loops" class="nav-link" data-scroll-target="#for-loops"><span style="color:#71797E">9.7.1</span>&nbsp; <code>for</code> loops</a></li>
  <li><a href="#while-loops" id="toc-while-loops" class="nav-link" data-scroll-target="#while-loops"><span style="color:#71797E">9.7.2</span>&nbsp; <code>while</code> loops</a></li>
  </ul>
</li>
  <li>
<a href="#apply-functions" id="toc-apply-functions" class="nav-link" data-scroll-target="#apply-functions"><span style="color:#71797E">9.8</span>&nbsp; <code>apply</code> functions</a>
  <ul>
<li><a href="#sapply" id="toc-sapply" class="nav-link" data-scroll-target="#sapply"><span style="color:#71797E">9.8.1</span>&nbsp; <code>sapply</code></a></li>
  <li><a href="#lapply" id="toc-lapply" class="nav-link" data-scroll-target="#lapply"><span style="color:#71797E">9.8.2</span>&nbsp; <code>lapply</code></a></li>
  <li><a href="#apply" id="toc-apply" class="nav-link" data-scroll-target="#apply"><span style="color:#71797E">9.8.3</span>&nbsp; <code>apply</code></a></li>
  </ul>
</li>
  <li><a href="#exercise-on-useful-r-tools" id="toc-exercise-on-useful-r-tools" class="nav-link" data-scroll-target="#exercise-on-useful-r-tools"><span style="color:#71797E">9.9</span>&nbsp; Exercise on useful R tools</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-10-getting-temperature-data" id="toc-chapter-10-getting-temperature-data" class="nav-link" data-scroll-target="#chapter-10-getting-temperature-data">Chapter 10: Getting temperature data</a>
  <ul>
<li><a href="#temperature-data-needs" id="toc-temperature-data-needs" class="nav-link" data-scroll-target="#temperature-data-needs"><span style="color:#71797E">10.1</span>&nbsp; Temperature data needs</a></li>
  <li>
<a href="#the-global-summary-of-the-day-database" id="toc-the-global-summary-of-the-day-database" class="nav-link" data-scroll-target="#the-global-summary-of-the-day-database"><span style="color:#71797E">10.2</span>&nbsp; The Global Summary of the Day database</a>
  <ul>
<li><a href="#actionlist_stations" id="toc-actionlist_stations" class="nav-link" data-scroll-target="#actionlist_stations"><span style="color:#71797E">10.2.1</span>&nbsp; <code>action=list_stations</code></a></li>
  <li><a href="#actiondownload_weather" id="toc-actiondownload_weather" class="nav-link" data-scroll-target="#actiondownload_weather"><span style="color:#71797E">10.2.2</span>&nbsp; <code>action="download_weather"</code></a></li>
  <li><a href="#downloaded-weather-as-action-argument" id="toc-downloaded-weather-as-action-argument" class="nav-link" data-scroll-target="#downloaded-weather-as-action-argument"><span style="color:#71797E">10.2.3</span>&nbsp; downloaded weather as <code>action</code> argument</a></li>
  </ul>
</li>
  <li><a href="#exercises-on-getting-temperature-data" id="toc-exercises-on-getting-temperature-data" class="nav-link" data-scroll-target="#exercises-on-getting-temperature-data"><span style="color:#71797E">10.3</span>&nbsp; Exercises on getting temperature data</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-11-filling-gaps-in-temperature-records" id="toc-chapter-11-filling-gaps-in-temperature-records" class="nav-link" data-scroll-target="#chapter-11-filling-gaps-in-temperature-records">Chapter 11: Filling gaps in temperature records</a>
  <ul>
<li><a href="#gaps" id="toc-gaps" class="nav-link" data-scroll-target="#gaps"><span style="color:#71797E">11.1</span>&nbsp; Gaps</a></li>
  <li><a href="#filling-short-gaps-in-daily-records" id="toc-filling-short-gaps-in-daily-records" class="nav-link" data-scroll-target="#filling-short-gaps-in-daily-records"><span style="color:#71797E">11.2</span>&nbsp; Filling short gaps in daily records</a></li>
  <li>
<a href="#filling-long-gaps-in-daily-records" id="toc-filling-long-gaps-in-daily-records" class="nav-link" data-scroll-target="#filling-long-gaps-in-daily-records"><span style="color:#71797E">11.3</span>&nbsp; Filling long gaps in daily records</a>
  <ul>
<li><a href="#bias-correction-for-shorter-intervals" id="toc-bias-correction-for-shorter-intervals" class="nav-link" data-scroll-target="#bias-correction-for-shorter-intervals"><span style="color:#71797E">11.3.1</span>&nbsp; Bias-correction for shorter intervals</a></li>
  <li><a href="#saving-the-data-for-later" id="toc-saving-the-data-for-later" class="nav-link" data-scroll-target="#saving-the-data-for-later"><span style="color:#71797E">11.3.2</span>&nbsp; Saving the data for later</a></li>
  </ul>
</li>
  <li>
<a href="#filling-gaps-in-hourly-records" id="toc-filling-gaps-in-hourly-records" class="nav-link" data-scroll-target="#filling-gaps-in-hourly-records"><span style="color:#71797E">11.4</span>&nbsp; Filling gaps in hourly records</a>
  <ul>
<li>
<a href="#accuracy-assessment" id="toc-accuracy-assessment" class="nav-link" data-scroll-target="#accuracy-assessment"><span style="color:#71797E">11.4.1</span>&nbsp; Accuracy assessment</a>
  <ul>
<li><a href="#root-mean-square-error-of-the-prediction-rmsep" id="toc-root-mean-square-error-of-the-prediction-rmsep" class="nav-link" data-scroll-target="#root-mean-square-error-of-the-prediction-rmsep"><em>Root Mean Square Error of the Prediction (RMSEP)</em></a></li>
  <li><a href="#residual-prediction-deviation-rpd" id="toc-residual-prediction-deviation-rpd" class="nav-link" data-scroll-target="#residual-prediction-deviation-rpd"><em>Residual Prediction Deviation (RPD)</em></a></li>
  <li><a href="#ratio-of-performance-to-interquartile-distance-rpiq" id="toc-ratio-of-performance-to-interquartile-distance-rpiq" class="nav-link" data-scroll-target="#ratio-of-performance-to-interquartile-distance-rpiq"><em>Ratio of Performance to InterQuartile distance (RPIQ)</em></a></li>
  </ul>
</li>
  <li><a href="#computing-agroclimatic-metrics" id="toc-computing-agroclimatic-metrics" class="nav-link" data-scroll-target="#computing-agroclimatic-metrics"><span style="color:#71797E">11.4.2</span>&nbsp; Computing agroclimatic metrics</a></li>
  </ul>
</li>
  <li><a href="#exercises-on-filling-gaps" id="toc-exercises-on-filling-gaps" class="nav-link" data-scroll-target="#exercises-on-filling-gaps"><span style="color:#71797E">11.5</span>&nbsp; Exercises on filling gaps</a></li>
  </ul>
</li>
  <li>
<a href="#chapter-12-generating-temperature-scenarios" id="toc-chapter-12-generating-temperature-scenarios" class="nav-link" data-scroll-target="#chapter-12-generating-temperature-scenarios">Chapter 12: Generating temperature scenarios</a>
  <ul>
<li><a href="#chill-scenarios" id="toc-chill-scenarios" class="nav-link" data-scroll-target="#chill-scenarios"><span style="color:#71797E">12.1</span>&nbsp; Chill scenarios</a></li>
  <li><a href="#risk-assessment-in-orchard-planning" id="toc-risk-assessment-in-orchard-planning" class="nav-link" data-scroll-target="#risk-assessment-in-orchard-planning"><span style="color:#71797E">12.2</span>&nbsp; Risk assessment in orchard planning</a></li>
  </ul>
</li>
  </ul></nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Tree Phenology Analysis with R</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead"><strong><em>A Learning Logbook</em></strong></p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>SM </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 27, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header><style>
    body { background-color:  #F0FFFF; }
    pre, pre:not([class]) { background-color: #d7f4f4; }
</style>
<p><br></p>
<p><strong><em>This document records my notes and progress in the course titled “Tree Phenology Analysis with R.”</em></strong></p>
<p><br></p>
<section id="chapter-3-tree-dormancy" class="level2"><h2 class="anchored" data-anchor-id="chapter-3-tree-dormancy">Chapter 3: Tree Dormancy</h2>
<section id="introduction-to-dormancy" class="level3"><h3 class="anchored" data-anchor-id="introduction-to-dormancy">
<span style="color:#71797E">3.1</span>&nbsp; Introduction to dormancy</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>Fruit trees go into dormant state to survive unfavorable conditions in winter</p></li>
<li>
<p>Dormancy phases:</p>
<ul>
<li>
<strong>Dormancy establishment</strong> (controlled by environmental signals— Day length/photoperiod, Temperature)</li>
<li>
<strong>Endo-dormancy</strong> (controlled by plants’ endogenous factors— their abilities to grow even in unfavorable conditions; a period of rest and then regrow/ endo-dormancy is overcome once the trees have experienced a certain level of chill but they don’t immediately resume growth)</li>
<li>
<strong>Eco-dormancy</strong> (trees are acclimated— no morphological changes, but not deeply dormant; (warm) temp is the main environmental driver)</li>
<li>
<strong>Growth resumption</strong> (first apparent morphological changes occur in end of winter or earliest spring depending on species and cultivars— trees quickly un-acclimatized to grow and become sensitive to freezing temperature before buds burst? Warm temp promotes growth)</li>
</ul>
</li>
</ul>
<ul>
<li>Physiological processes that regulate dormancy
<ul>
<li>
<strong>Transport at both whole-plant and cellular level:</strong> The transport of water and solutes stop during dormancy both at the whole plant and cellular levels within the meristems.</li>
<li>
<strong>Phytohormone dynamics:</strong> Plant hormones are short and long distance signalling compounds acting in a very low concentrations. Myoregulators for plants growth and development, as well as mediate responses to biotic and abiotic stressors.</li>
<li>
<strong>Genetic and epigenetic regulation:</strong> A group of genes related to dormancy— regulation of bad dormancy.</li>
<li>
<strong>Dynamics of nonstructural carbohydrates:</strong> Non-structural carbohydrates have three main functions‐ energy esterase?, transport and supply, and osmotic regulation and signaling (these varies within and between seasons).</li>
</ul>
</li>
</ul>
<p><br></p>
</section><section id="dormancy-physiology" class="level3"><h3 class="anchored" data-anchor-id="dormancy-physiology">
<span style="color:#71797E">3.2</span>&nbsp; Dormancy physiology</h3>
<div style="height: 18px;">

</div>
<p><img src="./pic/ch3_1.png" class="img-fluid"></p>
<p>Reference: <a href="https://www.mdpi.com/2073-4395/10/2/241"><em>A Conceptual Framework for Winter Dormancy in Deciduous Trees (Fadón et al., 2020)</em></a></p>
<p><br></p>
</section><section id="experimental-and-statistical-determination-of-the-chilling-and-forcing-periods" class="level3"><h3 class="anchored" data-anchor-id="experimental-and-statistical-determination-of-the-chilling-and-forcing-periods">
<span style="color:#71797E">3.3</span>&nbsp; Experimental and statistical determination of the chilling and forcing periods</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>High chill accumulation during endodormancy advances flowering dates, but similarly cool temperatures during ecodormancy may cause flowering delays.</p></li>
<li><p>Endo- and eco- dormancy occur under the same phenological stage, but the temperatures have the opposite effect on flowering according to the dormancy phase.</p></li>
<li>
<p>Endo- Vs. Eco- dormancy phase differentiation:</p>
<ul>
<li>
<strong>Empirically</strong> (See if there is growth after chilling period— whether the chill period is overcome to allow forcing period)</li>
<li>
<strong>Statistically</strong> (Long phenological data sets and temperature records— estimate the date of chilling fulfillment based on the long series of phenological observations, flowering dates and relating them with previous temperature records)</li>
</ul>
</li>
</ul>
<ul>
<li>
<code>chillR</code> package to perform PLS analysis with phenology data and temperature, which gives two outputs:
<ul>
<li>
<strong>Model coefficients</strong> which indicate the strength and the sense of the influence</li>
<li>
<strong>Variable important in the projections (VIP)</strong>, which points out the significant importance of the model coefficient values— values from 0.8 are considered significant??</li>
</ul>
</li>
</ul>
<p><br></p>
</section><section id="phenology-record-and-bbch-scale" class="level3"><h3 class="anchored" data-anchor-id="phenology-record-and-bbch-scale">
<span style="color:#71797E">3.4</span>&nbsp; Phenology record and BBCH scale</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p><strong>Phenology</strong> is the study of periodic events in <strong>biological life cycles</strong> (e.g.&nbsp;seasonal changes in trees) and how these are influenced <strong>by seasonal and interannual variations</strong> in climate.</p></li>
<li>
<p>Application of phenology in agriculture:</p>
<ul>
<li>Select suitable crops and varieties (to organize the cropping schedules, organize the crop rotation)</li>
<li>Forecasts of plant development and harvest dates (e.g.&nbsp;to evaluate the risk of frost damage)</li>
<li>Timing of the agricultural practices— irrigation, fertilization, crop protection, etc.</li>
</ul>
</li>
</ul>
<ul>
<li>
<p>Trees go through many developmental stages over the course of the year, and these are usually referred to by a two-digit code. <span style="color:grey"><em>(Read more <a href="https://www.openagrar.de/servlets/MCRFileNodeServlet/openagrar_derivate_00010428/BBCH-Skala_en.pdf">here.</a>)</em></span></p>
<ul>
<li>Principal growth stages— describe time spans (0-9)</li>
<li>Secondary growth stages— precise steps in plant development (0-9)</li>
</ul>
</li>
</ul>
<p><br></p>
</section><section id="exercises-on-tree-dormancy" class="level3"><h3 class="anchored" data-anchor-id="exercises-on-tree-dormancy">
<span style="color:#71797E">3.5</span>&nbsp; Exercises on tree dormancy</h3>
<div style="height: 18px;">

</div>
<p><strong><em>1. Put yourself in the place of a breeder who wants to calculate the temperature requirements of a newly released cultivar. Which method will you use to calculate the chilling and forcing periods? Please justify your answer.</em></strong></p>
<p>As a breeder, I will use the empirical method rather than the statistical method to calculate the chilling and forcing periods in this particular case, for two reasons:</p>
<ul>
<li><p>It requires little statistical expertise, as many breeders may not have in-depth statistical expertise, and hiring an expert could incur extra costs.</p></li>
<li><p>The statistical method relies on long phenological data sets and temperature records. Since this cultivar is newly released, such longitudinal data sets and records may not be available for statistical computation.</p></li>
</ul>
<p>Anyway, after I looked up the definition of plant breeder, they are scientists, so statistics may not be a problem. In that case, start with empirical first and then combine with statistical method as more data accumulates. 😁</p>
<p><br></p>
<p><strong><em>2. Which are the advantages (2) of the BBCH scale compared with earlier scales?</em></strong></p>
<ul>
<li><p>Covers the whole development of the plant, rather than development of only the flower buds as in the traditional scale</p></li>
<li><p>Provides a general frame for all the species, while the traditional scale is species specific</p></li>
</ul>
<p><br></p>
<p><strong><em>3. Classify the following phenological stages of sweet cherry according to the BBCH scale:</em></strong></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./pic/ch3_2.png" class="img-fluid figure-img"></p>
<figcaption><strong><em>Phenological stages of cherry</em></strong></figcaption></figure>
</div>
<p>From left to right:</p>
<ul>
<li><p>BBCH stage 54 (Inflorescence enclosed by light green scales)</p></li>
<li><p>BBCH stage 65 (Full flowering: at least 50% of flowers open, first petals falling)</p></li>
<li>
<p>BBCH stage 89 (Fruit ripe for harvesting for immediate consumption— fruit have typical taste and firmness)</p>
<ul>
<li><span style="color:grey"><em>I chose stage 89, rather than the fruit-picking stage 87, due to the cherries’ uniform and rich red color. However, further assessment of their firmness, taste, and aroma is required to accurately confirm the stage.</em></span></li>
</ul>
</li>
</ul>
<p><br></p>
</section></section><section id="chapter-4-climate-change-and-impact-projection" class="level2"><h2 class="anchored" data-anchor-id="chapter-4-climate-change-and-impact-projection">Chapter 4: Climate change and impact projection</h2>
<section id="the-drivers-of-climate-change" class="level3"><h3 class="anchored" data-anchor-id="the-drivers-of-climate-change">
<span style="color:#71797E">4.1</span>&nbsp; The drivers of climate change</h3>
<div style="height: 18px;">

</div>
<p>In this lecture, I learned about how the climate changes occurs, as well as the main and long-term drivers of climate change. I also learned about the impact of greenhouse gases on recent global warming— particularly CO<sub>2</sub>, CH<sub>4</sub> and N<sub>2</sub>O in the atmosphere.</p>
<p><br></p>
</section><section id="what-weve-already-seen" class="level3"><h3 class="anchored" data-anchor-id="what-weve-already-seen">
<span style="color:#71797E">4.2</span>&nbsp; What we’ve already seen</h3>
<div style="height: 18px;">

</div>
<p>This lecture taught me about the alarming increase in global temperatures in recent decades due to human activities, and how even a slight rise in temperature can cause significant shifts in the Earth’s land areas. The lecture also discussed these trends on a global scale, as well as specifically in Germany. Additionally, there was a brief discussion on precipitation trends in Germany.</p>
<p><br></p>
</section><section id="future-scenarios" class="level3"><h3 class="anchored" data-anchor-id="future-scenarios">
<span style="color:#71797E">4.3</span>&nbsp; Future scenarios</h3>
<div style="height: 18px;">

</div>
<p>I learned a lot about future climate projections and the process to make those projections (RCP, GCM, downscaling, etc) in this lecture. I also learned about the importance of impact models— even after we achieved perfect climate projections, there is a need for multiple impact models, as there will still be uncertainty about the biological responses and how we should describe them. There was also a nice discussion on how the changes in the ocean circulation and other tipping points can drive climate change. The lecture also emphasized the importance of being concerned about the future and taking action now to ensure future generations can experience the same world we live in.</p>
<p><br></p>
</section><section id="impact-projection-approaches" class="level3"><h3 class="anchored" data-anchor-id="impact-projection-approaches">
<span style="color:#71797E">4.4</span>&nbsp; Impact projection approaches</h3>
<div style="height: 18px;">

</div>
<p>I learned about different models in making predictions for the future. The lecture compares between the four climate project models, and discussed in details the advantages and the disadvantages of each. There is also a nice instruction on how we should build a model in the beginning— we may not want to go into detail for each aspect, but try to cover all aspects in a broader sense.</p>
<p><br></p>
</section><section id="exercises-on-climate-change" class="level3"><h3 class="anchored" data-anchor-id="exercises-on-climate-change">
<span style="color:#71797E">4.5</span>&nbsp; Exercises on climate change</h3>
<div style="height: 18px;">

</div>
<p><strong><em>1. List the main drivers of climate change at the decade to century scale, and briefly explain the mechanism through which the currently most important driver affects our climate.</em></strong></p>
<p><br></p>
<p><strong><em>2. Explain briefly what is special about temperature dynamics of recent decades, and why we have good reasons to be concerned.</em></strong></p>
<p><br></p>
<p><strong><em>3. What does the abbreviation ‘RCP’ stand for, how are RCPs defined, and what is their role in projecting future climates?</em></strong></p>
<p><br></p>
<p><strong><em>4. Briefly describe the 4 climate impact projection methods described in the fourth video.</em></strong></p>
<p><br></p>
</section></section><section id="chapter-5-winter-chill-projections" class="level2"><h2 class="anchored" data-anchor-id="chapter-5-winter-chill-projections">Chapter 5: Winter chill projections</h2>
<section id="winter-chill-projections" class="level3"><h3 class="anchored" data-anchor-id="winter-chill-projections">
<span style="color:#71797E">5.1</span>&nbsp; Winter chill projections</h3>
<section id="winter-chill-in-oman" class="level4"><h4 class="anchored" data-anchor-id="winter-chill-in-oman">
<span style="color:#71797E">5.1.1</span>&nbsp; Winter chill in Oman</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>To calculate nutrient budgets for the oases in the Sultanate of Oman, by measuring the yields of the various fruit trees there</p></li>
<li><p>But, many of the trees in the oasis system did not produce fruits in the years of analysis</p></li>
<li><p>A hypothesis for that was “the lack of chilling,” due to most of the trees in these high-altitude oases were not the typical species of the Arabian Peninsula, but temperate trees</p></li>
<li><p>So, from focusing on nutrient budget to chilling hours</p></li>
<li>
<p>Chilling Hours model— this model can’t really be trusted, especially in a warm location</p>
<ul>
<li>Placed temperature loggers in three oases at different levels of elevation, which allowed studying chill accumulation along an elevation gradient (can’t collect meaningful data for a reasonable period of time )</li>
<li>So, obtain data from an official long-term weather station is located in the vicinity, near the top of the valley, roughly 1000 m above the lowest oasis— data not representative of all the locations along the elevation gradient</li>
<li>So, use the records from the oases to define transfer functions that allowed deriving oasis temperatures from long-term data</li>
<li>Set the transfer functions up (using PLS— not a good idea?) to directly calculate hourly temperatures in the oases from the daily records of the official station at Saiq</li>
<li>Regression between temperature at Saiq and temperature in three oases to calculate winter chill dynamics over the entire time span covered by the official weather station (Hourly data were needed to calculate the number of Chilling Hours)</li>
</ul>
</li>
</ul>
<ul>
<li>Weather generators to add future climate scenarios
<ul>
<li><em>Weather generators are tools that can produce random draws of plausible weather, based on observed weather for a particular location.</em></li>
<li>Fed the LARS-WG weather generator with the data (we had) for the highest-elevation oasis and told it to generate plausible weather for a number of years
<ul>
<li>Request the generator to produce the highest-elevation oasis and told it to generate plausible weather for a number of years</li>
<li>Result: Chill prospects for 1°C and 2°C warming scenarios</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><br></p>
</section><section id="chill-model-sensitivity" class="level4"><h4 class="anchored" data-anchor-id="chill-model-sensitivity">
<span style="color:#71797E">5.1.2</span>&nbsp; Chill model sensitivity</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>In projecting climate change impacts on winter chill in the Central Valley, one of the world’s most productive regions for temperate fruit trees, <strong>the choice of chill model matters a lot</strong></p></li>
<li>
<p>Created a bunch of temperature scenarios for multiple locations and calculated how chill accumulation was likely to change in the future, according to multiple chill models</p>
<ul>
<li>Looked at what changes the various models predicted for the same locations and the same future scenarios</li>
<li>The chill projection results varied considerably across the four models— <strong>strong indication that not all models can be right</strong>
</li>
<li>Based on the literature, as well as on another study <a href="https://www.sciencedirect.com/science/article/pii/S0168192309001580">(Luedeling et al., 2009d)</a>, Dynamic Model was concluded to be the most reliable one— used mostly in this course - But, the Dynamic model is too complicated (cumbersome, error-prone and boring)</li>
</ul>
</li>
</ul>
<p><br></p>
</section><section id="winter-chill-in-california" class="level4"><h4 class="anchored" data-anchor-id="winter-chill-in-california">
<span style="color:#71797E">5.1.3</span>&nbsp; Winter chill in California</h4>
<div style="height: 18px;">

</div>
<ul>
<li>To produce a winter chill projection for California’s fruit and nut growing region— the Central Valley
<ul>
<li>Multiple scenarios (20 or so) for records of all 100+ weather stations in California (automate processing steps)</li>
</ul>
</li>
</ul>
<ul>
<li><p>Result: produce projections for all stations, which consisted of chill accumulation over 100 plausible winter seasons per scenario, generated with a weather generator</p></li>
<li>
<p>Summarize the data by defining a metric called ‘Safe Winter Chill’.</p>
<ul>
<li>This is the 10th percentile of the chill distribution, i.e.&nbsp;the amount of chill that is exceeded in 90% of all years, derived from the ‘replicates’ of annual temperature dynamics produced by the weather generator</li>
<li>Economically, it may be feasible to grow a tree cultivar that requires this much chill.</li>
</ul>
</li>
</ul>
<ul>
<li>Source: <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0006166">(Luedeling et al.,2009d)</a>
</li>
</ul>
<p><br></p>
</section><section id="winter-chill-ratios" class="level4"><h4 class="anchored" data-anchor-id="winter-chill-ratios">
<span style="color:#71797E">5.1.4</span>&nbsp; Winter chill ratios</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>To produce a chill projection for the whole planet, using data from the Global Summary of the Day database</p></li>
<li><p>Processed data for about 5000 globally distributed weather stations, for which multiple chill metrics were calculated</p></li>
<li>
<p>To compare chill models, the ratio between various chill metrics was calculated for each weather station in the data set.</p>
<ul>
<li>Had these ratios been largely constant all over the planet (e.g.&nbsp;one Chill Portion always corresponds to 10 Chilling Hours), we would have been fairly safe using any of the chill models.</li>
<li>Unfortunately, this wasn’t the case, with enormous variation in chill metric ratios around the world.</li>
</ul>
</li>
</ul>
<ul>
<li>Source: <a href="https://link.springer.com/article/10.1007/s00484-010-0352-y">(Luedeling &amp; Brown, 2011a)</a>
</li>
</ul>
<p><br></p>
</section><section id="a-global-pojection-of-future-winter-chill" class="level4"><h4 class="anchored" data-anchor-id="a-global-pojection-of-future-winter-chill">
<span style="color:#71797E">5.1.5</span>&nbsp; A global pojection of future winter chill</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>Produce a global projection of the likely impacts of climate change on winter chill</p></li>
<li><p>Projected decline in winter chill— it seems unlikely that growers will remain able to grow the tree cultivars they currently rely on with such dramatic chill losses</p></li>
<li><p>Source: <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0020155">(Luedeling et al., 2011b)</a></p></li>
</ul>
<p><br></p>
</section><section id="winter-chill-in-germany" class="level4"><h4 class="anchored" data-anchor-id="winter-chill-in-germany">
<span style="color:#71797E">5.1.6</span>&nbsp; Winter chill in Germany</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>Germany is not highlighted as particularly vulnerable to chill losses.</p></li>
<li><p>The reason for this lack of major changes is that current winter temperatures in Germany are right in the middle of what appears to be the most effective temperature range for chill accumulation.</p></li>
<li><p>Source: <a href="https://link.springer.com/article/10.1007/s10341-009-0085-4">(Luedeling et al., 2009a)</a></p></li>
</ul>
<p><br></p>
</section><section id="winter-chill-in-tunisia" class="level4"><h4 class="anchored" data-anchor-id="winter-chill-in-tunisia">
<span style="color:#71797E">5.1.7</span>&nbsp; Winter chill in Tunisia</h4>
<div style="height: 18px;">

</div>
<ul>
<li>Models: SRES, GCMs, RCPs
<ul>
<li>The so-called SRES emissions scenarios (named after the IPCC Special Report on Emissions Scenarios), usually focusing on the three most commonly used scenarios B2, A1B and A2</li>
<li>‘General Circulation Models’ (GCMs; many people also use an alternative long form: ‘Global Climate Models’)</li>
<li>‘Representative Concentration Pathways’ (RCPs) to replace the SRES scenarios</li>
</ul>
</li>
</ul>
<ul>
<li><p>No way of deciding which of these models, if any, is right— should produce <em>ensemble</em> forecasts, i.e.&nbsp;project changes using outputs from all the available models (that are considered credible)</p></li>
<li>
<p>Produce chill distribution at a particular point in time using a weather generator that is accessed by <code>chillR</code>.</p>
<ul>
<li>This weather generator is calibrated with observed weather data and provided with an estimate of how various climate metrics differed from the long-term average climate in 1975, 2000 and 2015.</li>
<li>With this information, we can generate a large number of artificial yearly weather records that might have occurred at these points in time.</li>
</ul>
</li>
</ul>
<ul>
<li>The weather generator was also used to produce future scenarios.
<ul>
<li>In the case of Pistachios in Tunisia, the tool is calibrated with observed data, but the scenarios that were added were not derived from the historic record, but extracted from the AFRICLIM database.</li>
</ul>
</li>
</ul>
<p><br></p>
</section><section id="winter-chill-in-chile" class="level4"><h4 class="anchored" data-anchor-id="winter-chill-in-chile">
<span style="color:#71797E">5.1.8</span>&nbsp; Winter chill in Chile</h4>
<div style="height: 18px;">

</div>
<ul>
<li>A tool that could quickly access single-location data for weather stations anywhere on the planet: ClimateWizard</li>
</ul>
<p><br></p>
</section><section id="chill-projection-for-patagonia" class="level4"><h4 class="anchored" data-anchor-id="chill-projection-for-patagonia">
<span style="color:#71797E">5.1.9</span>&nbsp; Chill projection for Patagonia</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>Looked into the climatic suitability for fruit and nut trees near agriculture’s southern frontier - in Patagonia, in southern Argentina <a href="https://rmets.onlinelibrary.wiley.com/doi/pdf/10.1002/joc.6649">(del Barrio et al., 2020)</a>.</p></li>
<li>
<p>Used the weather station records to calibrate weather generator and downloaded climate projections from the ClimateWizard database.</p>
<ul>
<li>to make past and future temperature scenarios for all stations</li>
<li>to compute winter chill and a few other agroclimatic metrics</li>
</ul>
</li>
</ul>
<p><br></p>
</section><section id="chill-model-comparison" class="level4"><h4 class="anchored" data-anchor-id="chill-model-comparison">
<span style="color:#71797E">5.1.10</span>&nbsp; Chill model comparison</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>Used climate change analysis framework to compare chill models <a href="https://www.sciencedirect.com/science/article/pii/S1161030120301106">(Fernandez et al., 2020b)</a></p></li>
<li><p>Model choice matters!</p></li>
</ul>
<p><br></p>
</section><section id="chill-projection-for-all-of-tunisia" class="level4"><h4 class="anchored" data-anchor-id="chill-projection-for-all-of-tunisia">
<span style="color:#71797E">5.1.11</span>&nbsp; Chill projection for all of Tunisia</h4>
<div style="height: 18px;">

</div>
<ul>
<li>Mapped chill accumulation across Tunisia, based on the previous framework
<ul>
<li>Applied the analysis framework developed to each of the 20 weather station locations across Tunisia and neighboring countries</li>
<li>Interpolated results to produce chill maps that track chill availability in Tunisia over the past few decades</li>
</ul>
</li>
</ul>
<ul>
<li>How to interpolate the site-specific results into a map that covers the whole country
<ul>
<li>Take the site-specific predictions of Safe Winter Chill and interpolate a surface through them (using the Kriging technique)</li>
<li>Repeat the same for the elevations of the locations</li>
<li>Then, fitted a linear model to relate chill accumulation to elevation</li>
<li>Calculate the difference between the elevation model derived from the weather station elevations and the true elevations of each location of the country, using a Digital Elevation Model (DEM)</li>
<li>Considering that this difference is not yet accounted for by the chill surface that was derived by interpolating chill data for the weather stations, we used the elevation~chill relationship we determined to correct chill predictions.</li>
<li>Will only work in places with a linear relationship between elevation and chill availability</li>
</ul>
</li>
</ul>
<p><br></p>
</section><section id="revisiting-chill-accumulation-in-oman" class="level4"><h4 class="anchored" data-anchor-id="revisiting-chill-accumulation-in-oman">
<span style="color:#71797E">5.1.12</span>&nbsp; Revisiting chill accumulation in Oman</h4>
<div style="height: 18px;">

</div>
<ul>
<li>Adding some new ideas on how to convert daily into hourly temperatures in a place like the oases of Oman we were interested in, we produced updated assessments of past winter chill and forecasts of future chill for the oases of Al Jabal Al Akhdar. <a href="https://link.springer.com/article/10.1007/s10584-020-02862-8">(Buerkert et al., 2020)</a>
</li>
</ul>
<p><br></p>
</section></section><section id="exercises-on-past-chill-projections" class="level3"><h3 class="anchored" data-anchor-id="exercises-on-past-chill-projections">
<span style="color:#71797E">5.2</span>&nbsp; Exercises on past chill projections</h3>
<div style="height: 18px;">

</div>
<p><strong><em>1. Sketch out three data access and processing challenges that had to be overcome in order to produce chill projections with state-of-the-art methodology.</em></strong></p>
<ul>
<li>
<p>Not all models are credible (Chilling Hours model- to quantify chill- can’t really be trusted, especially in warm locations)</p>
<ul>
<li>Complicated model- the Dynamic model- I could only calculate Chill Portions (the unit of this model) with a decades-old Excel sheet</li>
</ul>
</li>
<li>
<p>The need to automate the process to create multiple climate scenarios for large number of weather stations and to handle large data output of simulation scenarios.</p>
<ul>
<li>Challenge in data transfer when replacing old scenarios (SRES) with the new (RCPs)</li>
</ul>
</li>
<li>
<p>Scarcity of source to find appropriate information/ data on future climates that can easily be used for the purposes of chill modeling. For example,</p>
<ul>
<li>Data (e.g.&nbsp;temperature records) available may not be representative of all locations of interest (use transfer functions to derive temperatures of specific locations from long-term data )</li>
<li>The need for hourly records</li>
<li>
</li></ul>
</li>
<li><p>For some reason, most future climate projections were mostly disseminated as spatial grids covering various extents. The dataset I typically worked with included 20 GCMs. To make matters worse, I typically wanted to project gradual changes over time by including multiple years in an analysis, e.g.&nbsp;the 2020s, the 2050s and the 2080s. You can probably see where this is headed. When we multiply all these numbers, we realize that we need 4320 grids. The disk space required to store these data (in uncompressed form) is more than 700 GB. This is not impossible to find, but processing this amount of data is cumbersome and time-consuming. Still, I actually managed to set up a data processing structure for this and download all the data to an external hard drive.Soon after I had set up this structure, the IPCC came up with a new report that introduced the ‘Representative Concentration Pathways’ (RCPs) to replace the SRES scenarios. For a few years, it was still ok to work with the old scenarios, but eventually it got harder and harder to get such studies through the peer-review process. The scenarios simply weren’t up to date any more. However, I was not excited by the prospect of downloading another massive dataset and starting all over again… What made this particularly difficult for me was that I was based in Kenya then, with fairly poor data transfer rates.</p></li>
<li><p>It turned out that in the meantime, some climate scientists had produced a future climate database specifically for Africa - AFRICLIM (Platts et al., 2015), which contained exactly what we needed. Since this database didn’t include the whole planet, it was much easier to download and store, and processing the data was much less cumbersome. So I added functions to chillR to implement procedures to sample from the AFRICLIM grids and produce ensembles of climate scenarios. I also started putting together a framework to automatically produce the kind of plots that are shown below.</p></li>
<li><p>AFRICLIM solved the future climate data problem for locations in Africa. However, this dataset fell short of what was needed in order to add climate change projection capability to chillR. First, it was unsatisfying that this dataset only covered Africa. Second, users who are only interested in data for a single location, which is what chillR is designed for, shouldn’t have to download a large dataset, before they can run analyses. What was needed was a tool that could quickly access single-location data for weather stations anywhere on the planet. One of my early sources of climate information was a tool called ‘ClimateWizard’, put together by my friend and collaborator Evan Girvetz, who now works for the International Centre for Tropical Agriculture (CIAT) in Nairobi. This tool initially only made gridded data available, but already for the California study cited above (Luedeling et al., 2009d) (Link), Evan had written a script to quickly extract information for single locations, which is really all that’s needed for single-site studies. Eventually, at CIAT, he made this function available to a wider audience through an application programming interface (API), to allow accessing outputs from 15 climate models for state-of-the-art RCP scenarios.</p></li>
<li><p>Interpolating site-specific results into a map that covers the whole country (current procedure needs improvement- will only work in places with a linear relationship between elevation and chill availability. This seems a fairly reasonable assumption in Tunisia, but it would not work in many cooler locations, such as Germany.)</p></li>
<li><p>I also didn’t have proper data on projected future climates then, and the process that converted daily to hourly temperatures was quite a bit less than ideal.With our climate change analysis framework, we could finally do it. Adding some new ideas on how to convert daily into hourly temperatures in a place like the oases of Oman we were interested in</p></li>
</ul>
<p>After a decade of foraging in other parts of the world, let’s come back to Oman. I’d long been a bit dissatisfied with the initial work we did there. Note that the first analysis was my first study on chill accumulation. At the time, I did not know about the hazards involved in model choice. (you’ll learn about these ideas later in this module), we produced updated assessments of past winter chill and forecasts of future chill for the oases of Al Jabal Al Akhdar. The results appeared once again in Climatic Change <br></p>
<p><strong><em>2. Outline, in your understanding, the basic steps that are necessary to make such projections.</em></strong></p>
<p><br></p>
</section></section><section id="chapter-6-manual-chill-analysis" class="level2"><h2 class="anchored" data-anchor-id="chapter-6-manual-chill-analysis">Chapter 6: Manual chill analysis</h2>
<section id="computing-chilling-hours-from-hourly-temperature-data" class="level3"><h3 class="anchored" data-anchor-id="computing-chilling-hours-from-hourly-temperature-data">
<span style="color:#71797E">6.1</span>&nbsp; Computing Chilling Hours from hourly temperature data</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>Need hourly temperature data to compute Chilling Hours</p></li>
<li><p><code>chillR</code> offers a few neat tools to make pretty good approximations of hourly temperature data from daily records</p></li>
</ul>
<p><br></p>
<section id="display-the-winters_hours_gaps-dataset-in-chillr-using-kable" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="display-the-winters_hours_gaps-dataset-in-chillr-using-kable"><em>Display the <code>Winters_hours_gaps</code> dataset in <code>chillR</code> using <code>kable</code></em></h4>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Display the Winters_hours_gaps dataset in chillR using kable</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Hour</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp_gaps</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">15.127</td>
<td style="text-align: right;">15.127</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">17.153</td>
<td style="text-align: right;">17.153</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">18.699</td>
<td style="text-align: right;">18.699</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">18.699</td>
<td style="text-align: right;">18.699</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">18.842</td>
<td style="text-align: right;">18.842</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">19.508</td>
<td style="text-align: right;">19.508</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">19.318</td>
<td style="text-align: right;">19.318</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">17.701</td>
<td style="text-align: right;">17.701</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">15.414</td>
<td style="text-align: right;">15.414</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">12.727</td>
<td style="text-align: right;">12.727</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
</section><section id="remove-column-temp_gaps-and-create-a-new-dataset-hourtemps" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="remove-column-temp_gaps-and-create-a-new-dataset-hourtemps"><em>Remove column <code>Temp_gaps</code> and create a new dataset (<code>hourtemps</code>)</em></h4>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Remove column Temp_gaps and create a new dataset (hourtemps)</span></span>
<span><span class="va">hourtemps</span> <span class="op">&lt;-</span> <span class="va">Winters_hours_gaps</span><span class="op">[</span>,</span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span>,</span>
<span>                                  <span class="st">"Month"</span>,</span>
<span>                                  <span class="st">"Day"</span>,</span>
<span>                                  <span class="st">"Hour"</span>,</span>
<span>                                  <span class="st">"Temp"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">hourtemps</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Hour</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">15.127</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">17.153</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">18.699</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">18.699</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">18.842</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">19.508</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">19.318</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">17.701</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">15.414</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">12.727</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
</section><section id="display-only-the-third-row-with-all-columns" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="display-only-the-third-row-with-all-columns"><em>Display only the third row with all columns</em></h4>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Display only the third row with all columns</span></span>
<span><span class="va">hourtemps</span><span class="op">[</span><span class="fl">3</span>, <span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>  Year Month Day Hour   Temp
3 2008     3   3   12 18.699</code></pre>
</div>
</div>
<p><br></p>
</section><section id="display-the-temp-column-of-the-third-row-only" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="display-the-temp-column-of-the-third-row-only"><em>Display the <code>Temp</code> column of the third row only</em></h4>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Display the temp column of the third row only</span></span>
<span><span class="va">hourtemps</span><span class="op">[</span><span class="fl">3</span>, <span class="st">"Temp"</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 18.699</code></pre>
</div>
</div>
<p><br></p>
</section><section id="display-the-first-five-rows-of-temp-column" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="display-the-first-five-rows-of-temp-column"><em>Display the first five rows of <code>Temp</code> column</em></h4>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Display the first five rows of Temp column</span></span>
<span><span class="va">hourtemps</span><span class="op">$</span><span class="va">Temp</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 15.127 17.153 18.699 18.699 18.842</code></pre>
</div>
</div>
<p><br></p>
</section><section id="display-the-first-five-rows-and-all-columns-of-hourtemps-dataset" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="display-the-first-five-rows-and-all-columns-of-hourtemps-dataset"><em>Display the first five rows and all columns of <code>hourtemps</code> dataset</em></h4>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Display the first five rows and all columns of hourtemps dataset</span></span>
<span><span class="va">hourtemps</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>  Year Month Day Hour   Temp
1 2008     3   3   10 15.127
2 2008     3   3   11 17.153
3 2008     3   3   12 18.699
4 2008     3   3   13 18.699
5 2008     3   3   14 18.842</code></pre>
</div>
</div>
<p><br></p>
</section><section id="check-for-temperatures-that-fall-within-chilling-hours-range" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="check-for-temperatures-that-fall-within-chilling-hours-range"><em>Check for temperatures that fall within <code>Chilling Hours</code> range</em></h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>Every hour with temperatures above (and including) 0°C and below (and including) 7.2°C is considered a Chilling Hour.</p></li>
<li><p>Check for every hour whether temperatures fall in this range, using simple comparison commands (<code>&lt;</code>, <code>&lt;=</code>, <code>==</code>, <code>=&gt;</code> and <code>&gt;</code>) in R</p></li>
</ul>
<p><br></p>
<section id="using-simple-comparison-commands" class="level5 unnumbered"><h5 class="unnumbered anchored" data-anchor-id="using-simple-comparison-commands"><em>Using simple comparison commands</em></h5>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use == command</span></span>
<span><span class="fl">1</span> <span class="op">==</span> <span class="fl">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">1</span> <span class="op">==</span> <span class="fl">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Test &gt; command</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE FALSE  TRUE</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use &gt;= command</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">c</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, <span class="va">c</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE  TRUE  TRUE</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use &amp; command</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, <span class="va">c</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, <span class="va">c</span><span class="op">)</span> <span class="op">&lt;</span><span class="fl">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE  TRUE FALSE</code></pre>
</div>
</div>
<p><br></p>
</section><section id="check-for-chilling-hours" class="level5 unnumbered"><h5 class="unnumbered anchored" data-anchor-id="check-for-chilling-hours"><em>Check for <code>Chilling Hours</code></em></h5>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Assign new column Chiling_Hour </span></span>
<span><span class="va">hourtemps</span><span class="op">[</span>,<span class="st">"Chilling_Hour"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">hourtemps</span><span class="op">$</span><span class="va">Temp</span> <span class="op">&gt;=</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">hourtemps</span><span class="op">$</span><span class="va">Temp</span> <span class="op">&lt;=</span> <span class="fl">7.2</span></span>
<span></span>
<span><span class="co"># Check if the temperatures fall within Chilling_Hour for row 13 to 20</span></span>
<span><span class="va">hourtemps</span><span class="op">[</span><span class="fl">13</span><span class="op">:</span><span class="fl">20</span>, <span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>   Year Month Day Hour  Temp Chilling_Hour
13 2008     3   3   22 9.040         FALSE
14 2008     3   3   23 7.920         FALSE
15 2008     3   4    0 6.535          TRUE
16 2008     3   4    1 6.687          TRUE
17 2008     3   4    2 8.767         FALSE
18 2008     3   4    3 9.139         FALSE
19 2008     3   4    4 6.788          TRUE
20 2008     3   4    5 5.076          TRUE</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Find total chilling hour for a particular period by defining rows (3-4 March 2008)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">hourtemps</span><span class="op">$</span><span class="va">Chilling_Hour</span><span class="op">[</span><span class="fl">13</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use `which` function to set the dates for total chilling hours calculation</span></span>
<span><span class="va">Start_Date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">hourtemps</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="fl">2008</span> <span class="op">&amp;</span></span>
<span>                      <span class="va">hourtemps</span><span class="op">$</span><span class="va">Month</span> <span class="op">==</span> <span class="fl">10</span> <span class="op">&amp;</span></span>
<span>                      <span class="va">hourtemps</span><span class="op">$</span><span class="va">Day</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span></span>
<span>                      <span class="va">hourtemps</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span> <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="va">End_Date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">hourtemps</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="fl">2008</span> <span class="op">&amp;</span></span>
<span>                    <span class="va">hourtemps</span><span class="op">$</span><span class="va">Month</span> <span class="op">==</span> <span class="fl">10</span> <span class="op">&amp;</span></span>
<span>                    <span class="va">hourtemps</span><span class="op">$</span><span class="va">Day</span> <span class="op">==</span> <span class="fl">31</span> <span class="op">&amp;</span></span>
<span>                    <span class="va">hourtemps</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span> <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">hourtemps</span><span class="op">$</span><span class="va">Chilling_Hour</span><span class="op">[</span><span class="va">Start_Date</span><span class="op">:</span><span class="va">End_Date</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 28</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># So in October of 2008, Winters experienced 28 Chilling Hours.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section></section></section><section id="our-first-chill-function" class="level3"><h3 class="anchored" data-anchor-id="our-first-chill-function">
<span style="color:#71797E">6.2</span>&nbsp; Our first chill function</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>A function consists of a name, some arguments that are passed to the function, and some code that should be executed.</p></li>
<li><p>We can define is as <code>OurFunctionName &lt;- function(argument1, argument2, ...) {ourCode}</code>.</p></li>
<li><p>What’s returned is either the last object that’s mentioned in the function code or some content specified by the <code><a href="https://rdrr.io/r/base/function.html">return()</a></code> function.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Example function for Chilling_Hour calculation</span></span>
<span><span class="co"># Function that adds Chilling_Hour column to dataframe</span></span>
<span><span class="va">CH</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">hourtemps</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">hourtemps</span><span class="op">[</span>, <span class="st">"Chilling_Hour"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">hourtemps</span><span class="op">$</span><span class="va">Temp</span> <span class="op">&gt;=</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">hourtemps</span><span class="op">$</span><span class="va">Temp</span> <span class="op">&lt;=</span> <span class="fl">7.2</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">hourtemps</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Check chilling hour `yes or no` for rows 13-20</span></span>
<span><span class="fu">CH</span><span class="op">(</span><span class="va">hourtemps</span><span class="op">)</span><span class="op">[</span><span class="fl">13</span><span class="op">:</span><span class="fl">20</span>, <span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>   Year Month Day Hour  Temp Chilling_Hour
13 2008     3   3   22 9.040         FALSE
14 2008     3   3   23 7.920         FALSE
15 2008     3   4    0 6.535          TRUE
16 2008     3   4    1 6.687          TRUE
17 2008     3   4    2 8.767         FALSE
18 2008     3   4    3 9.139         FALSE
19 2008     3   4    4 6.788          TRUE
20 2008     3   4    5 5.076          TRUE</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create more complex functions, e.g. to calculate the number of Chilling Hours</span></span>
<span><span class="co"># between two dates, which we can specify in the YEARMODA format </span></span>
<span><span class="co"># (i.e. year, month and day, combined in one number).</span></span>
<span><span class="va">sum_CH</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">hourtemps</span>,</span>
<span>                   <span class="va">Start_YEARMODA</span>,</span>
<span>                   <span class="va">End_YEARMODA</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">Start_Year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">trunc</a></span><span class="op">(</span><span class="va">Start_YEARMODA</span> <span class="op">/</span> <span class="fl">10000</span><span class="op">)</span> <span class="co"># "trunc" removes all decimals</span></span>
<span>  <span class="va">Start_Month</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html">trunc</a></span><span class="op">(</span><span class="op">(</span><span class="va">Start_YEARMODA</span> <span class="op">-</span> <span class="va">Start_Year</span><span class="op">*</span><span class="fl">10000</span><span class="op">)</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="va">Start_Day</span> <span class="op">&lt;-</span> </span>
<span>    <span class="va">Start_YEARMODA</span> <span class="op">-</span> <span class="va">Start_Year</span> <span class="op">*</span> <span class="fl">10000</span> <span class="op">-</span> <span class="va">Start_Month</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="va">Start_Hour</span> <span class="op">&lt;-</span> <span class="fl">12</span> <span class="co"># This could also be flexible, but let's skip this for now</span></span>
<span>  <span class="va">End_Year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">trunc</a></span><span class="op">(</span><span class="va">End_YEARMODA</span> <span class="op">/</span> <span class="fl">10000</span><span class="op">)</span></span>
<span>  <span class="va">End_Month</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">trunc</a></span><span class="op">(</span><span class="op">(</span><span class="va">End_YEARMODA</span> <span class="op">-</span> <span class="va">End_Year</span> <span class="op">*</span> <span class="fl">10000</span><span class="op">)</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="va">End_Day</span> <span class="op">&lt;-</span> <span class="va">End_YEARMODA</span> <span class="op">-</span> <span class="va">End_Year</span> <span class="op">*</span> <span class="fl">10000</span> <span class="op">-</span> <span class="va">End_Month</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="va">End_Hour</span> <span class="op">&lt;-</span> <span class="fl">12</span> <span class="co"># This could also be flexible, but let's skip this for now</span></span>
<span></span>
<span>  <span class="va">Start_Date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">hourtemps</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="va">Start_Year</span> <span class="op">&amp;</span></span>
<span>                        <span class="va">hourtemps</span><span class="op">$</span><span class="va">Month</span> <span class="op">==</span> <span class="va">Start_Month</span> <span class="op">&amp;</span></span>
<span>                        <span class="va">hourtemps</span><span class="op">$</span><span class="va">Day</span> <span class="op">==</span> <span class="va">Start_Day</span> <span class="op">&amp;</span></span>
<span>                        <span class="va">hourtemps</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span> <span class="va">Start_Hour</span><span class="op">)</span></span>
<span>  <span class="va">End_Date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">hourtemps</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="va">End_Year</span> <span class="op">&amp;</span></span>
<span>                    <span class="va">hourtemps</span><span class="op">$</span><span class="va">Month</span> <span class="op">==</span> <span class="va">End_Month</span> <span class="op">&amp;</span></span>
<span>                    <span class="va">hourtemps</span><span class="op">$</span><span class="va">Day</span> <span class="op">==</span> <span class="va">End_Day</span> <span class="op">&amp;</span></span>
<span>                    <span class="va">hourtemps</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span> <span class="va">End_Hour</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">Chill_hours</span> <span class="op">&lt;-</span> <span class="fu">CH</span><span class="op">(</span><span class="va">hourtemps</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Chill_hours</span><span class="op">$</span><span class="va">Chilling_Hour</span><span class="op">[</span><span class="va">Start_Date</span><span class="op">:</span><span class="va">End_Date</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Check the total chilling hours from March 1 to October 11, 2008</span></span>
<span><span class="co"># Note that the dataset only goes from 3rd March to 11th November 2008, </span></span>
<span><span class="co"># so use of any dates outside that range will generate an error message. </span></span>
<span><span class="fu">sum_CH</span><span class="op">(</span><span class="va">hourtemps</span>, <span class="fl">20080401</span>, <span class="fl">20081011</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 77</code></pre>
</div>
</div>
<p><br></p>
</section><section id="exercise-on-basic-chill-modeling" class="level3"><h3 class="anchored" data-anchor-id="exercise-on-basic-chill-modeling">
<span style="color:#71797E">6.3</span>&nbsp; Exercise on basic chill modeling</h3>
<div style="height: 18px;">

</div>
<p><strong><em>1. Write a basic function that calculates warm hours (&gt;25°C)</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Check for warm hours above 25 degree C in Winters_hours_gaps dataset</span></span>
<span><span class="co"># Create a dataset without temperature gaps</span></span>
<span><span class="va">W_data</span> <span class="op">&lt;-</span> <span class="va">Winters_hours_gaps</span><span class="op">[</span>,</span>
<span>                             <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span>,</span>
<span>                               <span class="st">"Month"</span>,</span>
<span>                               <span class="st">"Day"</span>,</span>
<span>                               <span class="st">"Hour"</span>,</span>
<span>                               <span class="st">"Temp"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Write function that calculates warm hours above 25 degree C</span></span>
<span><span class="va">WH</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">W_data</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">W_data</span><span class="op">[</span>, <span class="st">"Warm_Hour"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">W_data</span><span class="op">$</span><span class="va">Temp</span> <span class="op">&gt;</span> <span class="fl">25</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">W_data</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Show the the first 4 rows</span></span>
<span><span class="fu">WH</span><span class="op">(</span><span class="va">W_data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>  Year Month Day Hour   Temp Warm_Hour
1 2008     3   3   10 15.127     FALSE
2 2008     3   3   11 17.153     FALSE
3 2008     3   3   12 18.699     FALSE
4 2008     3   3   13 18.699     FALSE</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calculate total warm hours for the dataset</span></span>
<span><span class="va">WH_sum</span> <span class="op">&lt;-</span> <span class="fu">WH</span><span class="op">(</span><span class="va">W_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">WH_sum</span><span class="op">$</span><span class="va">Warm_Hour</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 1275</code></pre>
</div>
</div>
<p><br></p>
<p><strong><em>2. Apply this function to the Winters_hours_gaps dataset</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Apply the function to original Winters_hours_gaps dataset</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu">WH</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">[</span><span class="fl">961</span><span class="op">:</span><span class="fl">970</span>, <span class="op">]</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Hour</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp_gaps</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Warm_Hour</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">25.501</td>
<td style="text-align: right;">25.501</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">27.653</td>
<td style="text-align: right;">27.653</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">29.015</td>
<td style="text-align: right;">29.015</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">29.890</td>
<td style="text-align: right;">29.890</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">30.748</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">30.117</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">29.090</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">28.221</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">25.744</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">21.604</td>
<td style="text-align: left;">FALSE</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p><strong><em>3. Extend this function, so that it can take start and end dates as inputs and sums up warm hours between these dates</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sum_WH</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">W_data</span>,</span>
<span>                   <span class="va">Start_YEARMODA</span>,</span>
<span>                   <span class="va">End_YEARMODA</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># See in-class script for setting year, month and date with substr </span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">Start_Year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">trunc</a></span><span class="op">(</span><span class="va">Start_YEARMODA</span> <span class="op">/</span> <span class="fl">10000</span><span class="op">)</span></span>
<span>  <span class="va">Start_Month</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">trunc</a></span><span class="op">(</span><span class="op">(</span><span class="va">Start_YEARMODA</span> <span class="op">-</span> <span class="va">Start_Year</span> <span class="op">*</span> <span class="fl">10000</span><span class="op">)</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="va">Start_Day</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">trunc</a></span><span class="op">(</span><span class="op">(</span><span class="va">Start_YEARMODA</span> <span class="op">-</span> <span class="va">Start_Year</span> <span class="op">*</span><span class="fl">10000</span><span class="op">)</span> <span class="op">-</span> </span>
<span>                         <span class="va">Start_Month</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="va">Start_Hour</span> <span class="op">&lt;-</span> <span class="fl">12</span></span>
<span>  </span>
<span>  <span class="va">End_Year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">trunc</a></span><span class="op">(</span><span class="va">End_YEARMODA</span> <span class="op">/</span> <span class="fl">10000</span><span class="op">)</span></span>
<span>  <span class="va">End_Month</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">trunc</a></span><span class="op">(</span><span class="op">(</span><span class="va">End_YEARMODA</span> <span class="op">-</span> <span class="va">Start_Year</span> <span class="op">*</span> <span class="fl">10000</span><span class="op">)</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="va">End_Day</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">trunc</a></span><span class="op">(</span><span class="op">(</span><span class="va">End_YEARMODA</span> <span class="op">-</span> <span class="va">Start_Year</span> <span class="op">*</span><span class="fl">10000</span><span class="op">)</span> <span class="op">-</span> </span>
<span>                         <span class="va">End_Month</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="va">End_Hour</span> <span class="op">&lt;-</span> <span class="fl">12</span></span>
<span>  </span>
<span>  <span class="va">Start_Date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">W_data</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="va">Start_Year</span> <span class="op">&amp;</span></span>
<span>                        <span class="va">W_data</span><span class="op">$</span><span class="va">Month</span> <span class="op">==</span> <span class="va">Start_Month</span> <span class="op">&amp;</span></span>
<span>                        <span class="va">W_data</span><span class="op">$</span><span class="va">Day</span> <span class="op">==</span> <span class="va">Start_Day</span> <span class="op">&amp;</span></span>
<span>                        <span class="va">W_data</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span> <span class="va">Start_Hour</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">End_Date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">W_data</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="va">End_Year</span> <span class="op">&amp;</span></span>
<span>                        <span class="va">W_data</span><span class="op">$</span><span class="va">Month</span> <span class="op">==</span> <span class="va">End_Month</span> <span class="op">&amp;</span></span>
<span>                        <span class="va">W_data</span><span class="op">$</span><span class="va">Day</span> <span class="op">==</span> <span class="va">End_Day</span> <span class="op">&amp;</span></span>
<span>                        <span class="va">W_data</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span> <span class="va">End_Hour</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">Warm_Hours</span> <span class="op">&lt;-</span> <span class="fu">WH</span><span class="op">(</span><span class="va">W_data</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Warm_Hours</span><span class="op">$</span><span class="va">Warm_Hour</span><span class="op">[</span><span class="va">Start_Date</span><span class="op">:</span><span class="va">End_Date</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Total warm hours for the whole period of dataset </span></span>
<span><span class="fu">sum_WH</span><span class="op">(</span><span class="va">W_data</span>, <span class="fl">20080303</span>, <span class="fl">20081110</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 1275</code></pre>
</div>
</div>
<p><br></p>
</section></section><section id="chapter-7-chill-models" class="level2"><h2 class="anchored" data-anchor-id="chapter-7-chill-models">Chapter 7: Chill models</h2>
<section id="chill-models-in-chillr" class="level3"><h3 class="anchored" data-anchor-id="chill-models-in-chillr">
<span style="color:#71797E">7.1</span>&nbsp; Chill models in <code>chillR</code>
</h3>
<section id="chilling_hours-function" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="chilling_hours-function"><em><code>Chilling_Hours()</code> function</em></h4>
<div style="height: 18px;">

</div>
<ul>
<li>Chilling Hours are great for an entry-level tutorial on chill modeling, but they’re not a particularly credible metric, so I suggest you forget them right away.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Chilling_Hours() function in chillR to calculate chilling hours</span></span>
<span><span class="va">Chilling_Hours</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>function (HourTemp, summ = TRUE) 
{
    CH_range &lt;- which(HourTemp &lt;= 7.2 &amp; HourTemp &gt;= 0)
    CH_weights &lt;- rep(0, length(HourTemp))
    CH_weights[CH_range] &lt;- 1
    if (summ == TRUE) 
        return(cumsum(CH_weights))
    else return(CH_weights)
}
&lt;bytecode: 0x12c9b4780&gt;
&lt;environment: namespace:chillR&gt;</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Apply Chilling_Hours() function to Winters_hours_gap dataset</span></span>
<span><span class="fu">Chilling_Hours</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">$</span><span class="va">Temp</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>  [1]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1  2  2  2  3  4  5  6  6  6  6
 [26]  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6  6
 [51]  6  6  6  6  6  6  6  6  6  6  6  7  8  9 10 11 12 13 14 15 16 16 16 16 16
 [76] 16 16 16 16 16 16 16 16 16 16 17 18 19 20 21 22 23 24 25 25 25 25 25 25 25</code></pre>
</div>
</div>
<p><br></p>
</section><section id="the-utah-model" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="the-utah-model"><em>The Utah model</em></h4>
<div style="height: 18px;">

</div>
<ul>
<li><p><code>step_model()</code> function allows you to define your own model, based on temperature thresholds and weights.</p></li>
<li><p>To implement various variations of the Utah Model that have been developed for different locations</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Utah_Model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>function (HourTemp, summ = TRUE) 
return(step_model(HourTemp, df = data.frame(lower = c(-1000, 
    1.4, 2.4, 9.1, 12.4, 15.9, 18), upper = c(1.4, 2.4, 9.1, 
    12.4, 15.9, 18, 1000), weight = c(0, 0.5, 1, 0.5, 0, -0.5, 
    -1)), summ = summ))
&lt;bytecode: 0x11c548278&gt;
&lt;environment: namespace:chillR&gt;</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">Utah_Model</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">$</span><span class="va">Temp</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>  [1]  0.0 -0.5 -1.5 -2.5 -3.5 -4.5 -5.5 -6.0 -6.0 -6.0 -5.5 -5.0 -4.0 -3.0 -2.0
 [16] -1.0  0.0  0.5  1.5  2.5  3.5  4.5  5.0  5.0  5.0  4.0  3.0  2.0  1.0  0.0
 [31] -1.0 -2.0 -2.5 -2.5 -2.0 -1.5 -1.0 -0.5  0.5  1.0  1.5  2.0  2.0  2.5  3.0
 [46]  3.5  4.0  4.0  4.0  3.5  2.5  1.5  0.5 -0.5 -1.5 -2.5 -3.0 -3.0 -2.5 -1.5
 [61] -0.5  0.5  1.5  2.5  3.5  4.5  5.5  6.5  7.5  8.5  9.5 10.0 10.0  9.5  9.0
 [76]  8.5  8.0  7.5  7.0  6.5  6.5  7.0  7.5  8.5  9.5 10.5 11.5 12.5 13.5 14.5
 [91] 15.5 16.5 17.5 18.5 19.0 19.0 19.0 18.5 17.5 16.5</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create a data.frame for temperatures with weights</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  lower  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1000</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>,    <span class="fl">6</span><span class="op">)</span>,</span>
<span>  upper  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>    <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">1000</span><span class="op">)</span>,</span>
<span>  weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>    <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1</span>,    <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">lower</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">upper</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">weight</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">-1000</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">1000</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use custom() function to implement a chill model based on df</span></span>
<span><span class="va">custom</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">step_model</span><span class="op">(</span><span class="va">x</span>, <span class="va">df</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">custom</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">$</span><span class="va">Temp</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>  [1]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1  4  7  7  7  7
 [26]  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7  7
 [51]  7  7  7  7  7  7  7  7  7  7  7  7  7  7  8 10 13 16 19 22 22 22 22 22 22
 [76] 22 22 22 22 22 22 22 22 22 22 22 22 23 25 27 29 31 34 37 37 37 37 37 37 37</code></pre>
</div>
</div>
<p><br></p>
</section><section id="the-dynamic-model" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="the-dynamic-model"><em>The dynamic model</em></h4>
<div style="height: 18px;">

</div>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Dynamic_Model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>function (HourTemp, summ = TRUE, E0 = 4153.5, E1 = 12888.8, A0 = 139500, 
    A1 = 2.567e+18, slope = 1.6, Tf = 277) 
{
    if (missing(HourTemp)) {
        stop("HourTemp must be present! Aborting.")
    }
    TK &lt;- HourTemp + 273
    aa &lt;- A0/A1
    ee &lt;- E1 - E0
    sr &lt;- exp(slope * Tf * (TK - Tf)/TK)
    xi &lt;- sr/(1 + sr)
    xs &lt;- aa * exp(ee/TK)
    eak1 &lt;- exp(-A1 * exp(-E1/TK))
    x = 0
    for (l in c(2:length(HourTemp))) {
        S &lt;- x[l - 1]
        if (x[l - 1] &gt;= 1) {
            S &lt;- S * (1 - xi[l - 2])
        }
        x[l] &lt;- xs[l - 1] - (xs[l - 1] - S) * eak1[l - 1]
    }
    delta &lt;- rep(0, length(HourTemp))
    ii &lt;- which(x &gt;= 1)
    delta[ii] &lt;- x[ii] * xi[ii - 1]
    if (summ) 
        return(cumsum(delta))
    return(delta)
}
&lt;bytecode: 0x11b4962b0&gt;
&lt;environment: namespace:chillR&gt;</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">Dynamic_Model</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">$</span><span class="va">Temp</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>  [1] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
  [8] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
 [15] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
 [22] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
 [29] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
 [36] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
 [43] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
 [50] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
 [57] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
 [64] 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000
 [71] 0.0000000 0.9698435 0.9698435 0.9698435 0.9698435 0.9698435 0.9698435
 [78] 0.9698435 0.9698435 0.9698435 0.9698435 0.9698435 0.9698435 0.9698435
 [85] 0.9698435 0.9698435 0.9698435 0.9698435 0.9698435 0.9698435 0.9698435
 [92] 0.9698435 0.9698435 0.9698435 0.9698435 0.9698435 0.9698435 0.9698435
 [99] 0.9698435 0.9698435</code></pre>
</div>
</div>
<p><br></p>
</section><section id="make_jday-and-tempresponse-functions" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="make_jday-and-tempresponse-functions"><em><code>make_JDay()</code> and <code>tempResponse</code> functions</em></h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>Add the Julian dates (counts the days of the year) to the dataset</p></li>
<li><p>The <code>chilling()</code> function implements the Chilling Hours, Utah and Dynamic Models, and it also calculates Growing Degree Days (GDH); use <code>tempResponse</code> function otherwise</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use chilling() function</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">chilling</span><span class="op">(</span><span class="fu">make_JDay</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">)</span>,</span>
<span>                   Start_JDay <span class="op">=</span> <span class="fl">90</span>,</span>
<span>                   End_JDay <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">output</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, </span>
<span>                position <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>                font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Chilling_Hours</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Utah_Model</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Chill_portions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">GDH</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: left;">2007/2008</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">15.5</td>
<td style="text-align: right;">2.009147</td>
<td style="text-align: right;">2406.52</td>
</tr></tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use tempResponse function</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">tempResponse</span><span class="op">(</span><span class="fu">make_JDay</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">)</span>,</span>
<span>                       Start_JDay <span class="op">=</span> <span class="fl">90</span>,</span>
<span>                       End_JDay <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                       models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Chill_Portions <span class="op">=</span> <span class="va">Dynamic_Model</span>,</span>
<span>                                     GDH <span class="op">=</span> <span class="va">GDH</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">output</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>,</span>
<span>                position <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>                font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Chill_Portions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">GDH</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: left;">2007/2008</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">2.009147</td>
<td style="text-align: right;">2406.52</td>
</tr></tbody>
</table>
</div>
</div>
<p><br></p>
</section></section><section id="exercise-on-chill-models" class="level3"><h3 class="anchored" data-anchor-id="exercise-on-chill-models">
<span style="color:#71797E">7.2</span>&nbsp; Exercise on chill models</h3>
<div style="height: 18px;">

</div>
<p><strong><em>1. Run the <code>chilling()</code> function on the <code>Winters_hours_gap</code> dataset</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Check JDay for start and end of dataset period</span></span>
<span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2008</span>, <span class="fl">2008</span><span class="op">)</span>,</span>
<span>                    Month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">11</span><span class="op">)</span>,</span>
<span>                    Day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">11</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu">make_JDay</span><span class="op">(</span><span class="va">dates</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>,</span>
<span>                position <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>                font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">JDay</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">63</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">316</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Apply chilling() function on Winters_hours_gap dataset</span></span>
<span><span class="va">c_output</span> <span class="op">&lt;-</span> <span class="fu">chilling</span><span class="op">(</span><span class="fu">make_JDay</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">)</span>,</span>
<span>                     Start_JDay <span class="op">=</span> <span class="fl">63</span>,</span>
<span>                     End_JDay <span class="op">=</span> <span class="fl">316</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">c_output</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>,</span>
<span>                position <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>                font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Chilling_Hours</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Utah_Model</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Chill_portions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">GDH</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: left;">2007/2008</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">254</td>
<td style="text-align: right;">253.0833</td>
<td style="text-align: right;">99.63911</td>
<td style="text-align: right;">203</td>
<td style="text-align: right;">-2492</td>
<td style="text-align: right;">12.22258</td>
<td style="text-align: right;">72925.48</td>
</tr></tbody>
</table>
</div>
</div>
<p><br></p>
<p><strong><em>2. Create your own temperature-weighting chill model using the <code>step_model()</code> function</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">t_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  lower  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1000</span>, <span class="fl">2</span>, <span class="fl">8</span>, <span class="fl">12</span>, <span class="fl">15</span>, <span class="fl">18</span>, <span class="fl">20</span>, <span class="fl">25</span><span class="op">)</span>,</span>
<span>  upper  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">8</span>, <span class="fl">12</span>, <span class="fl">15</span>, <span class="fl">18</span>, <span class="fl">20</span>, <span class="fl">25</span>, <span class="fl">1000</span><span class="op">)</span>,</span>
<span>  weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">t_data</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">lower</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">upper</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">weight</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">-1000</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">8</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1.0</td>
</tr>
<tr class="even">
<td style="text-align: right;">12</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">2.0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">0.5</td>
</tr>
<tr class="even">
<td style="text-align: right;">18</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">-0.5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">-1.0</td>
</tr>
<tr class="even">
<td style="text-align: right;">25</td>
<td style="text-align: right;">1000</td>
<td style="text-align: right;">-2.0</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">custom</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">step_model</span><span class="op">(</span><span class="va">x</span>, <span class="va">t_data</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
<p><strong><em>3. Run this model on the <code>Winters_hours_gaps</code> dataset using the <code>tempResponse()</code> function.</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">t_output</span> <span class="op">&lt;-</span> <span class="fu">tempResponse</span><span class="op">(</span><span class="fu">make_JDay</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">)</span>,</span>
<span>                         Start_JDay <span class="op">=</span> <span class="fl">63</span>,</span>
<span>                         End_JDay <span class="op">=</span> <span class="fl">316</span>,</span>
<span>                         models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span> <span class="op">(</span>Cumulative_Temp <span class="op">=</span> <span class="va">custom</span>,</span>
<span>                                        Chilling_Hours <span class="op">=</span> <span class="va">Chilling_Hours</span>,</span>
<span>                                        Chill_Portions <span class="op">=</span> <span class="va">Dynamic_Model</span>,</span>
<span>                                        Utah_Model <span class="op">=</span> <span class="va">Utah_Model</span>,</span>
<span>                                        GDH <span class="op">=</span> <span class="va">GDH</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">t_output</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Cumulative_Temp</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Chilling_Hours</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Chill_Portions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Utah_Model</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">GDH</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: left;">2007/2008</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">254</td>
<td style="text-align: right;">253.0833</td>
<td style="text-align: right;">99.63911</td>
<td style="text-align: right;">-682</td>
<td style="text-align: right;">203</td>
<td style="text-align: right;">12.2227</td>
<td style="text-align: right;">-2492</td>
<td style="text-align: right;">72925.48</td>
</tr></tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Here we see a big difference between the outputs of various models, </span></span>
<span><span class="co"># due to the different parameters chosen? </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section></section><section id="chapter-8-making-hourly-temperatures" class="level2"><h2 class="anchored" data-anchor-id="chapter-8-making-hourly-temperatures">Chapter 8: Making hourly temperatures</h2>
<section id="generating-hourly-temperatures" class="level3"><h3 class="anchored" data-anchor-id="generating-hourly-temperatures">
<span style="color:#71797E">8.1</span>&nbsp; Generating hourly temperatures</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>Most sources only provide daily data, usually including minimum and maximum temperature of the day, from which we can’t directly calculate Chilling Hours.</p></li>
<li>
<p>The rate of temperature increase in the morning is not the same as the rate of decrease in the evening. Besides, in particular the time of the lowest daily temperature varies considerably throughout the year (unless you’re close to the equator), and it would be good to consider this.</p>
<ul>
<li>‘Triangular’ daily temperature pattern, achieved by interpolating linearly for hours between daily minimum temperature recorded at a certain time of day, and the maximum temperature at another time, is not realistic.</li>
</ul>
</li>
</ul>
<p><br></p>
<section id="idealized-daily-temperature-curves" class="level4"><h4 class="anchored" data-anchor-id="idealized-daily-temperature-curves">
<span style="color:#71797E">8.1.1</span>&nbsp; Idealized daily temperature curves</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p><a href="https://journals.ashs.org/hortsci/view/journals/hortsci/25/1/article-p14.xml">(Linvill, 1990)</a> described the daily temperature curve using a combination of two mathematical equations: a sine curve to describe daytime warming, and a logarithmic decay function for nighttime cooling.</p></li>
<li><p>The transition points between the two parts were determined by sunrise and sunset, and the duration of the parts was related to daylength.</p></li>
<li><p>One aspect that made Linvill’s equations hard to use across different locations was the dependency on sunrise and sunset times.</p></li>
<li><p>Fortunately, at least for locations without major topographic features, sunrise and sunset times can be calculated based on what we know about the geometry of our solar system.</p></li>
<li><p>Use <code>daylength</code> function to produce daily temperature curves.</p></li>
<li><p>January 1st ist JDay 1, and December 31st either JDay 365 (in normal years) or JDay 366 (in leap years).</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Make plots of the sunrise time, sunset time and daylength </span></span>
<span><span class="co"># at Klein-Altendorf (Latitude: 50.4°N) over the course of the year</span></span>
<span><span class="va">Days</span> <span class="op">&lt;-</span> <span class="fu">daylength</span><span class="op">(</span>latitude <span class="op">=</span> <span class="fl">50.4</span>, JDay <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">365</span><span class="op">)</span></span>
<span><span class="va">Days_df</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    JDay <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">365</span>,</span>
<span>    Sunrise <span class="op">=</span> <span class="va">Days</span><span class="op">$</span><span class="va">Sunrise</span>,</span>
<span>    Sunset <span class="op">=</span> <span class="va">Days</span><span class="op">$</span><span class="va">Sunset</span>,</span>
<span>    Daylength <span class="op">=</span> <span class="va">Days</span><span class="op">$</span><span class="va">Daylength</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Use pivot_longer from tidyr to convert the data.frame, </span></span>
<span><span class="co"># so that the three time series (Sunrise, Sunset and Daylength) </span></span>
<span><span class="co"># were stacked on top of each other.</span></span>
<span><span class="va">Days_df</span> <span class="op">&lt;-</span> <span class="fu">pivot_longer</span><span class="op">(</span><span class="va">Days_df</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Sunrise</span><span class="op">:</span><span class="va">Daylength</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">Days_df</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">JDay</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Time of Day / Daylength (Hours)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/8.1.1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<section id="calculate-hourly-temperatures" class="level5 unnumbered"><h5 class="unnumbered anchored" data-anchor-id="calculate-hourly-temperatures"><em>Calculate hourly temperatures</em></h5>
<div style="height: 18px;">

</div>
<ul>
<li>
<code>stack_hourly_temps()</code> function takes as input a dataset of daily minimum and maximum temperatures
<ul>
<li>Columns: <code>Tmin</code>, <code>Tmax</code>, <code>Year</code>, <code>Month</code>, <code>Day</code>
</li>
<li>Need the latitude of the place of interest</li>
<li>Can also output the sunrise and sunset times</li>
</ul>
</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use KA_weather dataset to demonstrate stack_hourly_temps() function</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu">chillR</span><span class="fu">::</span> <span class="va"><a href="https://rdrr.io/pkg/chillR/man/KA_weather.html">KA_weather</a></span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8.2</td>
<td style="text-align: right;">5.1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">9.1</td>
<td style="text-align: right;">5.0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">10.4</td>
<td style="text-align: right;">3.3</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">8.4</td>
<td style="text-align: right;">4.5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">8.1</td>
<td style="text-align: right;">4.4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">12.0</td>
<td style="text-align: right;">6.9</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">11.2</td>
<td style="text-align: right;">8.6</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">13.9</td>
<td style="text-align: right;">8.5</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">14.5</td>
<td style="text-align: right;">3.6</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Adrian's codes </span></span>
<span><span class="co"># i recommend getting the prior day as well - because it will affect </span></span>
<span><span class="co"># the idealized curve pattern </span></span>
<span><span class="va">KA_weather_subset</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">KA_weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Year</span> <span class="op">==</span> <span class="fl">1998</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Month</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Day</span> <span class="op">==</span> <span class="fl">4</span></span>
<span>         <span class="op">|</span> <span class="va">Day</span> <span class="op">==</span> <span class="fl">5</span></span>
<span>         <span class="op">|</span> <span class="va">Day</span> <span class="op">==</span> <span class="fl">6</span></span>
<span>         <span class="op">)</span></span>
<span></span>
<span><span class="va">sh_data</span> <span class="op">&lt;-</span> <span class="fu">stack_hourly_temps</span><span class="op">(</span><span class="va">KA_weather_subset</span>, latitude <span class="op">=</span> <span class="fl">50.4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># stack_hourly_temps produces a list with 2 elements - the data and </span></span>
<span><span class="co"># a quality control table - select the hourtemps element to get the actual data</span></span>
<span><span class="va">sh_data</span> <span class="op">&lt;-</span> <span class="va">sh_data</span><span class="op">[[</span><span class="st">"hourtemps"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># filter by day if you want to</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">sh_data</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Day</span> <span class="op">==</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">JDay</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Hour</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5.195369</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5.066660</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4.950314</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4.844164</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4.746566</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4.656244</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">4.572187</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">4.493583</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">4.569464</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.384001</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">6.139939</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">6.787169</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">7.282787</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">7.593939</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">7.700000</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">7.593939</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">7.282787</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">6.591821</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">6.168074</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">5.870570</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">5.641106</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">5.454280</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">5.296704</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7.7</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">5.160445</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p>Here, I will try to recreate the line graph shown in the coursebook.</p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Here I select from day 1 to 6 because the graph in the coursebook starts from</span></span>
<span><span class="co"># day 2. I found the graph lies flat if I started from day 2, so need to select</span></span>
<span><span class="co"># one day before and one day after to show the direction of the graph better</span></span>
<span><span class="va">KA_weather_subset</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">KA_weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Year</span> <span class="op">==</span> <span class="fl">1998</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Month</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Day</span> <span class="op">==</span> <span class="fl">1</span></span>
<span>         <span class="op">|</span> <span class="va">Day</span> <span class="op">==</span> <span class="fl">2</span></span>
<span>         <span class="op">|</span> <span class="va">Day</span> <span class="op">==</span> <span class="fl">3</span></span>
<span>         <span class="op">|</span> <span class="va">Day</span> <span class="op">==</span> <span class="fl">4</span></span>
<span>         <span class="op">|</span> <span class="va">Day</span> <span class="op">==</span> <span class="fl">5</span></span>
<span>         <span class="op">|</span> <span class="va">Day</span> <span class="op">==</span> <span class="fl">6</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">sh_data</span> <span class="op">&lt;-</span> <span class="fu">stack_hourly_temps</span><span class="op">(</span><span class="va">KA_weather_subset</span>, latitude <span class="op">=</span> <span class="fl">50.4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sh_data</span> <span class="op">&lt;-</span> <span class="va">sh_data</span><span class="op">[[</span><span class="st">"hourtemps"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Choose from day 1 to 5 to show x-axis from day 2 to 5</span></span>
<span><span class="va">sh_data_plot</span> <span class="op">&lt;-</span> <span class="va">sh_data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Day</span> <span class="op">&gt;=</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">Day</span> <span class="op">&lt;=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>DateTime <span class="op">=</span> <span class="fu">ymd_h</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">Year</span>, <span class="va">Month</span>, <span class="va">Day</span>, <span class="va">Hour</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the data with DateTime on the x-axis for continuous plotting and use</span></span>
<span><span class="co"># POSIXct to extend the curve a bit before day 2 and beyond day 5 like the graph</span></span>
<span><span class="co"># in the coursebook </span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">sh_data_plot</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">DateTime</span>, y <span class="op">=</span> <span class="va">Temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_datetime</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="st">"1998-01-01 20:00:00"</span><span class="op">)</span>, </span>
<span>                              <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="st">"1998-01-05 07:00:00"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date"</span>, y <span class="op">=</span> <span class="st">"Temperature (°C)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/8.1.1b-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section></section><section id="empirical-daily-temperature-curves" class="level4"><h4 class="anchored" data-anchor-id="empirical-daily-temperature-curves">
<span style="color:#71797E">8.1.2</span>&nbsp; Empirical daily temperature curves</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>There are some locations where idealized daily temperature curves don’t work, e.g., rugged topography— trees maybe shaded for part of the day.</p></li>
<li><p>Also the temperature curve in an orchard, which may feature its own microclimate, with shaded and sunny spots, with dew-covered grass or bare ground etc., may not closely resemble the curve drawn up by <a href="https://journals.ashs.org/hortsci/view/journals/hortsci/25/1/article-p14.xml">Linvill (1990)</a></p></li>
<li>
<p>Addressing the issue with <a href="https://link.springer.com/article/10.1007/s10584-020-02862-8">(Buerkert et al., 2020)</a></p>
<ul>
<li>Obtain a dataset of hourly temperature data for the location interest (at least a full year, ideally multiple years)</li>
<li>Then, use <code>Empirical_daily_temperature_curve()</code> function to determine the typical pattern of hourly temperatures at this location— done separately for each month of the year (could be continuous?)</li>
<li>Then, apply the obtained set of coefficients to a daily dataset from the same location to get a reasonable hourly temperature record. Use <code>Empirical_hourly_temperatures</code> function which requires as inputs a set of hourly coefficients, and a daily temperature record (which includes <code>Tmin</code> and <code>Tmax</code> columns).</li>
</ul>
</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">empi_curve</span> <span class="op">&lt;-</span> <span class="fu">Empirical_daily_temperature_curve</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show results in a table </span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">empi_curve</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">48</span>, <span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Hour</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Prediction_coefficient</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1774859</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.1550693</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.1285651</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.1145597</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.0696064</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.0339583</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.0313115</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0.3121959</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0.4953232</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0.6819674</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0.8227423</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0.9506491</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">0.9662604</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0.9915996</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1.0000000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">0.9490319</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">0.8483098</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">0.6864529</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">0.4945415</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0.3636642</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0.2972377</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">0.2360349</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">0.1794802</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1960789</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.1407018</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.1283250</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.0819307</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.0541415</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.0188241</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.1697052</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0.4442722</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0.5939797</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0.7363923</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0.8399804</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0.9245702</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">0.9770693</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0.9963131</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1.0000000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">0.9568107</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">0.8698369</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">0.7343896</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">0.5330597</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0.3941038</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0.3186075</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">0.2594569</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">0.2114486</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Show results in a figure</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">empi_curve</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">96</span>, <span class="op">]</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span><span class="va">Hour</span>, <span class="va">Prediction_coefficient</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">1.3</span>,</span>
<span>            col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span>rows <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">Month</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Hour of the day"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Prediction coefficient"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># hourly coefficients needed as inputs for step 3</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/8.1.2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<section id="make_all_day_table-function" class="level5 unnumbered"><h5 class="unnumbered anchored" data-anchor-id="make_all_day_table-function"><em><code>make_all_day_table</code> function</em></h5>
<div style="height: 18px;">

</div>
<ul>
<li><p>Fill gaps in daily or hourly temperature records</p></li>
<li><p>Summarize hourly records into daily minimum and maximum temperatures</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Summarize hourly records into daily minimum and maximum temperatures</span></span>
<span><span class="va">coeffs</span> <span class="op">&lt;-</span> <span class="fu">Empirical_daily_temperature_curve</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">)</span></span>
<span><span class="va">Winters_daily</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">make_all_day_table</span><span class="op">(</span><span class="va">Winters_hours_gaps</span>, input_timestep <span class="op">=</span> <span class="st">"hour"</span><span class="op">)</span></span>
<span><span class="va">Winters_hours</span> <span class="op">&lt;-</span> <span class="fu">Empirical_hourly_temperatures</span><span class="op">(</span><span class="va">Winters_daily</span>, <span class="va">coeffs</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simplify data a bit to make it easier to use</span></span>
<span><span class="co"># require(reshape2)</span></span>
<span><span class="va">Winters_hours</span> <span class="op">&lt;-</span> <span class="va">Winters_hours</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span>, <span class="st">"Month"</span>, <span class="st">"Day"</span>, <span class="st">"Hour"</span>, <span class="st">"Temp"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">Winters_hours</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">Winters_hours</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Temp_empirical"</span></span>
<span><span class="va">Winters_ideal</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">stack_hourly_temps</span><span class="op">(</span><span class="va">Winters_daily</span>, latitude <span class="op">=</span> <span class="fl">38.5</span><span class="op">)</span><span class="op">$</span><span class="va">hourtemps</span></span>
<span><span class="va">Winters_ideal</span> <span class="op">&lt;-</span> <span class="va">Winters_ideal</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span>, <span class="st">"Month"</span>, <span class="st">"Day"</span>, <span class="st">"Hour"</span>, <span class="st">"Temp"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">Winters_ideal</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">Winters_ideal</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Temp_ideal"</span></span>
<span></span>
<span><span class="co"># Make triangular dataset to understand how it works</span></span>
<span><span class="va">Winters_triangle</span> <span class="op">&lt;-</span> <span class="va">Winters_daily</span></span>
<span><span class="va">Winters_triangle</span><span class="op">[</span>, <span class="st">"Hour"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Hour</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">Winters_triangle</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">23</span></span>
<span><span class="va">Winters_triangle</span><span class="op">[</span>, <span class="st">"Temp"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">Winters_triangle</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">make_all_day_table</span><span class="op">(</span><span class="va">Winters_triangle</span>, timestep <span class="op">=</span> <span class="st">"hour"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">Winters_triangle</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">Winters_triangle</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"Temp_triangular"</span></span>
<span></span>
<span><span class="co"># with the following loop, we fill in the daily Tmin and Tmax values for every</span></span>
<span><span class="co"># hour of the dataset</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">Winters_triangle</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Tmin</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Tmin</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Tmin</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Tmax</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Tmax</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Tmax</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Temp_triangular</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="co"># now we assign the daily Tmin value to the 6th hour of every day</span></span>
<span><span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Temp_triangular</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Tmin</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># we also assign the daily Tmax value to the 18th hour of every day</span></span>
<span><span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Temp_triangular</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span> <span class="fl">18</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Tmax</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span> <span class="fl">18</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># in the following step, we use the chillR function "interpolate_gaps"</span></span>
<span><span class="co"># to fill in all the gaps in the hourly record with straight lines</span></span>
<span><span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Temp_triangular</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">interpolate_gaps</span><span class="op">(</span><span class="va">Winters_triangle</span><span class="op">$</span><span class="va">Temp_triangular</span><span class="op">)</span><span class="op">$</span><span class="va">interp</span></span>
<span><span class="va">Winters_triangle</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">Winters_triangle</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span>, <span class="st">"Month"</span>, <span class="st">"Day"</span>, <span class="st">"Hour"</span>, <span class="st">"Temp_triangular"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Now, merge all these into data.frames to display them easily</span></span>
<span><span class="va">Winters_temps</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">Winters_hours_gaps</span>,</span>
<span>        <span class="va">Winters_hours</span>,</span>
<span>        by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span>, <span class="st">"Month"</span>, <span class="st">"Day"</span>, <span class="st">"Hour"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Winters_temps</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">Winters_temps</span>,</span>
<span>        <span class="va">Winters_triangle</span>,</span>
<span>        by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span>, <span class="st">"Month"</span>, <span class="st">"Day"</span>, <span class="st">"Hour"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Winters_temps</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">Winters_temps</span>,</span>
<span>        <span class="va">Winters_ideal</span>,</span>
<span>        by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span>, <span class="st">"Month"</span>, <span class="st">"Day"</span>, <span class="st">"Hour"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now we have a dataset with the observed temperatures and the three </span></span>
<span><span class="co"># approximations (triangular, idealized curve and empirical curve). </span></span>
<span><span class="co"># To plot this effectively, let’s convert the Year, Month, Day and Hour columns </span></span>
<span><span class="co"># into R’s date format (using ISOdate) and reorganize the data.frame a bit.</span></span>
<span><span class="va">Winters_temps</span><span class="op">[</span>, <span class="st">"DATE"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="va">Winters_temps</span><span class="op">$</span><span class="va">Year</span>,</span>
<span>          <span class="va">Winters_temps</span><span class="op">$</span><span class="va">Month</span>,</span>
<span>          <span class="va">Winters_temps</span><span class="op">$</span><span class="va">Day</span>,</span>
<span>          <span class="va">Winters_temps</span><span class="op">$</span><span class="va">Hour</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">Winters_temps_to_plot</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">Winters_temps</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DATE"</span>,</span>
<span>                    <span class="st">"Temp"</span>,</span>
<span>                    <span class="st">"Temp_empirical"</span>,</span>
<span>                    <span class="st">"Temp_triangular"</span>,</span>
<span>                    <span class="st">"Temp_ideal"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">Winters_temps_to_plot</span> <span class="op">&lt;-</span> <span class="va">Winters_temps_to_plot</span><span class="op">[</span><span class="fl">100</span><span class="op">:</span><span class="fl">200</span>, <span class="op">]</span></span>
<span><span class="va">Winters_temps_to_plot</span> <span class="op">&lt;-</span> <span class="fu">pivot_longer</span><span class="op">(</span><span class="va">Winters_temps_to_plot</span>, cols<span class="op">=</span><span class="va">Temp</span><span class="op">:</span><span class="va">Temp_ideal</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">Winters_temps_to_plot</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DATE"</span>, <span class="st">"Method"</span>, <span class="st">"Temperature"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">Winters_temps_to_plot</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">DATE</span>, <span class="va">Temperature</span>, colour <span class="op">=</span> <span class="va">Method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Temperature (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/8.1.2a-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># This plots shows that the triangular curve is quite far off the mark. </span></span>
<span><span class="co"># Temp_empirical and Temp_ideal look pretty similar and are hard to distinguish.</span></span>
<span></span>
<span><span class="co"># Use the `Root Mean Square Error` function-- useful for quantifying the </span></span>
<span><span class="co"># correspondence between predicted and observed values-- to compare these curves</span></span>
<span><span class="co"># a bit more thoroughly by computing</span></span>
<span></span>
<span><span class="co"># here's the RMSE for the triangular method:</span></span>
<span><span class="fu">RMSEP</span><span class="op">(</span><span class="va">Winters_temps</span><span class="op">$</span><span class="va">Temp_triangular</span>, <span class="va">Winters_temps</span><span class="op">$</span><span class="va">Temp</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 4.695289</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># here's the RMSE for the idealized-curve method:</span></span>
<span><span class="fu">RMSEP</span><span class="op">(</span><span class="va">Winters_temps</span><span class="op">$</span><span class="va">Temp_ideal</span>, <span class="va">Winters_temps</span><span class="op">$</span><span class="va">Temp</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 1.630714</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb73"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># and here's the RMSE for the empirical-curve method:</span></span>
<span><span class="fu">RMSEP</span><span class="op">(</span><span class="va">Winters_temps</span><span class="op">$</span><span class="va">Temp_empirical</span>, <span class="va">Winters_temps</span><span class="op">$</span><span class="va">Temp</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 1.410625</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># RMSE of 4.7 for the triangular method, an RMSE of 1.63 for the </span></span>
<span><span class="co"># idealized-curve method, and an RMSE of 1.41 for the empirical-curve method.</span></span>
<span><span class="co"># Since this metric should be low, we see that calibrating the prediction </span></span>
<span><span class="co"># function with observed hourly data brought some advantages, in particular </span></span>
<span><span class="co"># when compared with the triangular method.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section></section></section><section id="exercise-on-hourly-temperatures" class="level3"><h3 class="anchored" data-anchor-id="exercise-on-hourly-temperatures">
<span style="color:#71797E">8.2</span>&nbsp; Exercise on hourly temperatures</h3>
<div style="height: 18px;">

</div>
<p><strong><em>1. Choose a location of interest, find out its latitude and produce plots of daily sunrise, sunset and daylength.</em></strong></p>
<p>My location of interest is Mössigen, an orchard town in Baden-Württemberg, which is a state that ranks highest among regions for cultivation of top fruits, according to the <a href="https://www.destatis.de/EN/Themes/Economic-Sectors-Enterprises/Agriculture-Forestry-Fisheries/Fruit-Vegetables-Horticulture/Tables/2-2-area-of-tree-fruits-laender.html">report</a> by Statistisches Bundesmat. The GPS coordinates of Mössigen are 48.40567° N latitude, and 9.05419° E longitude, as stated in <a href="https://database.earth/countries/germany/regions/baden-wurttemberg/cities/mossingen">database.earth</a>.</p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb76"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Compute daylength</span></span>
<span><span class="va">MS_days</span> <span class="op">&lt;-</span> <span class="fu">daylength</span><span class="op">(</span>latitude <span class="op">=</span> <span class="fl">48.4</span>, JDay <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">365</span><span class="op">)</span></span>
<span><span class="va">MS_days_df</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    JDay <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">365</span>,</span>
<span>    Sunrise <span class="op">=</span> <span class="va">MS_days</span><span class="op">$</span><span class="va">Sunrise</span>,</span>
<span>    Sunset <span class="op">=</span> <span class="va">MS_days</span><span class="op">$</span><span class="va">Sunset</span>,</span>
<span>    Daylength <span class="op">=</span> <span class="va">MS_days</span><span class="op">$</span><span class="va">Daylength</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert data.frame for ggplot</span></span>
<span><span class="va">MS_days_df</span> <span class="op">&lt;-</span> <span class="fu">pivot_longer</span><span class="op">(</span><span class="va">MS_days_df</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Sunrise</span><span class="op">:</span><span class="va">Daylength</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">MS_days_df</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">JDay</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Time of Day / Daylength (Hours)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/8.2.1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p><strong><em>2. Produce an hourly dataset, based on idealized daily curves, for the <code>KA_weather</code> dataset (included in <code>chillR</code>)</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># I want to produce an hourly dataset for 4 October 1998</span></span>
<span><span class="co"># Chose values for one day before and one day after as they can impact the curve</span></span>
<span><span class="va">KA_weather_subset</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">KA_weather</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Year</span> <span class="op">==</span> <span class="fl">1998</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Month</span> <span class="op">==</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Day</span> <span class="op">==</span> <span class="fl">3</span></span>
<span>         <span class="op">|</span> <span class="va">Day</span> <span class="op">==</span> <span class="fl">4</span></span>
<span>         <span class="op">|</span> <span class="va">Day</span> <span class="op">==</span> <span class="fl">5</span></span>
<span>         <span class="op">)</span></span>
<span></span>
<span><span class="co"># Produce hourly dataset</span></span>
<span><span class="va">MS_sh_data</span> <span class="op">&lt;-</span> <span class="fu">stack_hourly_temps</span><span class="op">(</span><span class="va">KA_weather_subset</span>, latitude <span class="op">=</span> <span class="fl">48.4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select the hourtemps output only </span></span>
<span><span class="va">MS_sh_data</span> <span class="op">&lt;-</span> <span class="va">MS_sh_data</span><span class="op">[[</span><span class="st">"hourtemps"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Filter for day 4</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">MS_sh_data</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Day</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">JDay</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Hour</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5.333759</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5.277981</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5.228638</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5.184396</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5.144299</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5.107636</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">5.073866</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">5.712152</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">6.472033</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">7.176185</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">7.796004</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">8.306316</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">8.686392</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">8.920794</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">9.000000</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">8.920794</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">8.686392</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">8.306316</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">7.764207</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">7.299387</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">7.010700</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">6.800761</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">6.635690</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">277</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">6.499645</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p><strong><em>3. Produce empirical temperature curve parameters for the <code>Winters_hours_gaps</code> dataset, and use them to predict hourly values from daily temperatures (this is very similar to the example above, but please make sure you understand what’s going on)</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb78"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Produce empirical daily temperature coefficients from observed hourly data</span></span>
<span><span class="va">WH_empi_temp_coeff</span> <span class="op">&lt;-</span> <span class="fu">Empirical_daily_temperature_curve</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fill the missing gaps in hourly data of daily records</span></span>
<span><span class="va">WH_daily</span> <span class="op">&lt;-</span> <span class="fu">make_all_day_table</span><span class="op">(</span><span class="va">Winters_hours_gaps</span>, input_timestep <span class="op">=</span> <span class="st">"hour"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Predict hourly temperatures from daily dataset using the obtained coefficients</span></span>
<span><span class="va">WH_hours</span> <span class="op">&lt;-</span> <span class="fu">Empirical_hourly_temperatures</span><span class="op">(</span><span class="va">WH_daily</span>, <span class="va">WH_empi_temp_coeff</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select necessary columns from WH_hours dataset</span></span>
<span><span class="va">WH_hours</span> <span class="op">&lt;-</span> <span class="va">WH_hours</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span>, <span class="st">"Month"</span>, <span class="st">"Day"</span>, <span class="st">"Hour"</span>, <span class="st">"Temp"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Rename the last column "Temp" to "Temp_empirical"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">WH_hours</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">WH_hours</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Temp_empirical"</span></span>
<span></span>
<span><span class="co"># Merge predicted WH_hours with Winter_hours_gaps dataset to display</span></span>
<span><span class="co"># observed vs. approximated temperatures</span></span>
<span><span class="va">WH_temps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">Winters_hours_gaps</span>,</span>
<span>                  <span class="va">WH_hours</span>,</span>
<span>                  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span>, <span class="st">"Month"</span>, <span class="st">"Day"</span>, <span class="st">"Hour"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add a new "DATE" column with R's date format for plotting purpose</span></span>
<span><span class="va">WH_temps</span><span class="op">[</span>, <span class="st">"DATE"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="va">WH_temps</span><span class="op">$</span><span class="va">Year</span>,</span>
<span>                              <span class="va">WH_temps</span><span class="op">$</span><span class="va">Month</span>,</span>
<span>                              <span class="va">WH_temps</span><span class="op">$</span><span class="va">Day</span>,</span>
<span>                              <span class="va">WH_temps</span><span class="op">$</span><span class="va">Hour</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select the necessary columns and add into a new data.frame</span></span>
<span><span class="va">WH_temps_to_plot</span> <span class="op">&lt;-</span> <span class="va">WH_temps</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DATE"</span>,</span>
<span>                                 <span class="st">"Temp"</span>,</span>
<span>                                 <span class="st">"Temp_empirical"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Specify rows 300-400 (October 20-25) to plot</span></span>
<span><span class="va">WH_temps_to_plot</span> <span class="op">&lt;-</span> <span class="va">WH_temps_to_plot</span><span class="op">[</span><span class="fl">300</span><span class="op">:</span><span class="fl">400</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Stack columns into rows for plotting</span></span>
<span><span class="va">WH_temps_to_plot</span> <span class="op">&lt;-</span> <span class="fu">pivot_longer</span><span class="op">(</span><span class="va">WH_temps_to_plot</span>, cols <span class="op">=</span> <span class="va">Temp</span><span class="op">:</span><span class="va">Temp_empirical</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Rename columns for graph display </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">WH_temps_to_plot</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DATE"</span>, <span class="st">"Method"</span>, <span class="st">"Temperature"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">WH_temps_to_plot</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">DATE</span>, <span class="va">Temperature</span>, colour <span class="op">=</span> <span class="va">Method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Temperature (°C)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/8.2.3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section></section><section id="chapter-9-some-useful-tools-in-r" class="level2"><h2 class="anchored" data-anchor-id="chapter-9-some-useful-tools-in-r">Chapter 9: Some useful tools in R</h2>
<section id="an-evolving-language-and-a-lifelong-learning-process" class="level3"><h3 class="anchored" data-anchor-id="an-evolving-language-and-a-lifelong-learning-process">
<span style="color:#71797E">9.1</span>&nbsp; An evolving language— and a lifelong learning process</h3>
<div style="height: 18px;">

</div>
<ul>
<li>Possible to solve most problems with <code>base R</code> functions</li>
</ul>
<p><br></p>
</section><section id="the-tidyverse" class="level3"><h3 class="anchored" data-anchor-id="the-tidyverse">
<span style="color:#71797E">9.2</span>&nbsp; The <code>tidyverse</code>
</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>Access the whole collection of the <code>tidyverse</code> package <a href="https://www.tidyverse.org/">here.</a></p></li>
<li><p>Load <code><a href="https://tidyverse.tidyverse.org">library(tidyverse)</a></code> to access the package</p></li>
</ul>
<p><br></p>
</section><section id="the-ggplot2-package" class="level3"><h3 class="anchored" data-anchor-id="the-ggplot2-package">
<span style="color:#71797E">9.3</span>&nbsp; The <code>ggplot2</code> package</h3>
<div style="height: 18px;">

</div>
<ul>
<li>A great introduction to ggplot2 and links to various tutorials etc. can be accessed <a href="https://ggplot2.tidyverse.org/">here.</a>
</li>
</ul>
<p><br></p>
</section><section id="the-tibble-package" class="level3"><h3 class="anchored" data-anchor-id="the-tibble-package">
<span style="color:#71797E">9.3</span>&nbsp; The <code>tibble</code> package</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>A <code>tibble</code> is an advanced version of a <code>data.frame</code>, which includes several improvements.</p></li>
<li><p>A <code>tibble</code> doesn’t follow the classic <code>data.frame</code> habit of converting strings to factors at times when you don’t expect it.</p></li>
<li><p>Read more <a href="https://tibble.tidyverse.org/">here.</a></p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use as_tibble command to create a normal data.frame (or a similar structure)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>                  b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
      a     b
  &lt;dbl&gt; &lt;dbl&gt;
1     1     4
2     2     5
3     3     6</code></pre>
</div>
</div>
<p><br></p>
</section><section id="the-magrittr-package-pipes" class="level3"><h3 class="anchored" data-anchor-id="the-magrittr-package-pipes">
<span style="color:#71797E">9.5</span>&nbsp; The <code>magrittr</code> package— pipes</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>The main thing <code>magrittr</code> adds is a structure to organize workflows that are applied to the same dataset.</p></li>
<li><p>A data structure such as a <code>tibble</code> can be subjected to one or multiple operations organized in a pipe— <code>%&gt;%</code></p></li>
<li><p>After a pipe, the following function always assumes that the first input to the function is the product received through the pipe.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb81"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calculate the sum of all numbers in the tibble "d" created above</span></span>
<span><span class="va">d</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 21</code></pre>
</div>
</div>
<p><br></p>
</section><section id="the-tidyr-package" class="level3"><h3 class="anchored" data-anchor-id="the-tidyr-package">
<span style="color:#71797E">9.6</span>&nbsp; The <code>tidyr</code> package</h3>
<div style="height: 18px;">

</div>
<ul>
<li>Provides useful functions for organizing data.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb83"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use KA_weather dataset to see how it works</span></span>
<span><span class="va">KAw</span> <span class="op">&lt;-</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="va">KA_weather</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="va">KAw</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
    Year Month   Day  Tmax  Tmin
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  1998     1     1   8.2   5.1
 2  1998     1     2   9.1   5  
 3  1998     1     3  10.4   3.3
 4  1998     1     4   8.4   4.5
 5  1998     1     5   7.7   4.5
 6  1998     1     6   8.1   4.4
 7  1998     1     7  12     6.9
 8  1998     1     8  11.2   8.6
 9  1998     1     9  13.9   8.5
10  1998     1    10  14.5   3.6</code></pre>
</div>
</div>
<p><br></p>
<section id="pivot_longer" class="level4"><h4 class="anchored" data-anchor-id="pivot_longer">
<span style="color:#71797E">9.6.1</span>&nbsp; <code>pivot_longer</code>
</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>Use <code>pivot_longer</code> to transfer data from separate columns into distinct rows.</p></li>
<li><p>Stack one row of a column over another row of another column— often necessary, for instance, when using <code>ggplot2</code> package for plotting data.</p></li>
<li><p><code>pivot_longer</code> fulfills a similar function to the <code>melt</code> function of the <code>reshape2</code> package</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb85"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Generate a table with one row containing Tmin and one row for Tmax for </span></span>
<span><span class="co"># each day of the record (with a pipe)</span></span>
<span><span class="va">KAwlong</span> <span class="op">&lt;-</span> <span class="va">KAw</span> <span class="op">%&gt;%</span> <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="va">Tmax</span><span class="op">:</span><span class="va">Tmin</span><span class="op">)</span> <span class="co"># specify column we want to stack up </span></span>
<span></span>
<span><span class="va">KAwlong</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 5
    Year Month   Day name  value
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;dbl&gt;
 1  1998     1     1 Tmax    8.2
 2  1998     1     1 Tmin    5.1
 3  1998     1     2 Tmax    9.1
 4  1998     1     2 Tmin    5  
 5  1998     1     3 Tmax   10.4
 6  1998     1     3 Tmin    3.3
 7  1998     1     4 Tmax    8.4
 8  1998     1     4 Tmin    4.5
 9  1998     1     5 Tmax    7.7
10  1998     1     5 Tmin    4.5
11  1998     1     6 Tmax    8.1
12  1998     1     6 Tmin    4.4
13  1998     1     7 Tmax   12  
14  1998     1     7 Tmin    6.9
15  1998     1     8 Tmax   11.2
16  1998     1     8 Tmin    8.6
17  1998     1     9 Tmax   13.9
18  1998     1     9 Tmin    8.5
19  1998     1    10 Tmax   14.5
20  1998     1    10 Tmin    3.6</code></pre>
</div>
</div>
<p><br></p>
</section><section id="pivot_wider" class="level4"><h4 class="anchored" data-anchor-id="pivot_wider">
<span style="color:#71797E">9.6.2</span>&nbsp; <code>pivot_wider</code>
</h4>
<div style="height: 18px;">

</div>
<ul>
<li>We can also do an opposite conversion to the one implemented by <code>pivot_longer</code> by using the <code>pivot_wider</code> command.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb87"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">KAwwide</span> <span class="op">&lt;-</span> <span class="va">KAwlong</span> <span class="op">%&gt;%</span> <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">name</span><span class="op">)</span> <span class="co">#can work without () `here`</span></span>
<span><span class="co"># name_from specifies the column that contains new column header</span></span>
<span></span>
<span><span class="va">KAwwide</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
    Year Month   Day  Tmax  Tmin
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  1998     1     1   8.2   5.1
 2  1998     1     2   9.1   5  
 3  1998     1     3  10.4   3.3
 4  1998     1     4   8.4   4.5
 5  1998     1     5   7.7   4.5
 6  1998     1     6   8.1   4.4
 7  1998     1     7  12     6.9
 8  1998     1     8  11.2   8.6
 9  1998     1     9  13.9   8.5
10  1998     1    10  14.5   3.6</code></pre>
</div>
</div>
<p><br></p>
</section><section id="select" class="level4"><h4 class="anchored" data-anchor-id="select">
<span style="color:#71797E">9.6.3</span>&nbsp; <code>select</code>
</h4>
<div style="height: 18px;">

</div>
<ul>
<li>
<code>select</code> function picks out a subset of the columns of a <code>data.frame</code> or <code>tibble</code>.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb89"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">KAw</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Month</span>, <span class="va">Day</span>, <span class="va">Tmax</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   Month   Day  Tmax
   &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
 1     1     1   8.2
 2     1     2   9.1
 3     1     3  10.4
 4     1     4   8.4
 5     1     5   7.7
 6     1     6   8.1
 7     1     7  12  
 8     1     8  11.2
 9     1     9  13.9
10     1    10  14.5</code></pre>
</div>
</div>
<p><br></p>
</section><section id="filter" class="level4"><h4 class="anchored" data-anchor-id="filter">
<span style="color:#71797E">9.6.4</span>&nbsp; <code>filter</code>
</h4>
<div style="height: 18px;">

</div>
<ul>
<li>The <code>filter</code> function reduces a <code>data.frame</code> or <code>tibble</code> to just the rows that fulfill certain conditions.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb91"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">KAw</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Tmax</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
   Year Month   Day  Tmax  Tmin
  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
1  1998     1     3  10.4   3.3
2  1998     1     7  12     6.9
3  1998     1     8  11.2   8.6
4  1998     1     9  13.9   8.5
5  1998     1    10  14.5   3.6</code></pre>
</div>
</div>
<p><br></p>
</section><section id="mutate" class="level4"><h4 class="anchored" data-anchor-id="mutate">
<span style="color:#71797E">9.6.5</span>&nbsp; <code>mutate</code>
</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>The <code>mutate</code> function creates, modifies, and deletes columns from a <code>data.frame</code> or <code>tibble</code>.</p></li>
<li><p>Check out <a href="https://dplyr.tidyverse.org/reference/mutate.html">help file</a> for more options that can be done with <code>mutate</code>.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb93"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create two new columns that contain Tmin and Tmax in Kelvin </span></span>
<span><span class="va">KAw_K</span> <span class="op">&lt;-</span> <span class="va">KAw</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>Tmax_K <span class="op">=</span> <span class="va">Tmax</span> <span class="op">+</span> <span class="fl">273.5</span>, Tmin_K <span class="op">=</span> <span class="va">Tmin</span> <span class="op">+</span> <span class="fl">273.15</span><span class="op">)</span></span>
<span></span>
<span><span class="va">KAw_K</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 7
    Year Month   Day  Tmax  Tmin Tmax_K Tmin_K
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1  1998     1     1   8.2   5.1   282.   278.
 2  1998     1     2   9.1   5     283.   278.
 3  1998     1     3  10.4   3.3   284.   276.
 4  1998     1     4   8.4   4.5   282.   278.
 5  1998     1     5   7.7   4.5   281.   278.
 6  1998     1     6   8.1   4.4   282.   278.
 7  1998     1     7  12     6.9   286.   280.
 8  1998     1     8  11.2   8.6   285.   282.
 9  1998     1     9  13.9   8.5   287.   282.
10  1998     1    10  14.5   3.6   288    277.</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb95"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Delete these columns again, by setting them to NULL</span></span>
<span><span class="va">KAw_K</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>Tmin_K <span class="op">=</span> <span class="cn">NULL</span>, Tmax_K <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
    Year Month   Day  Tmax  Tmin
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  1998     1     1   8.2   5.1
 2  1998     1     2   9.1   5  
 3  1998     1     3  10.4   3.3
 4  1998     1     4   8.4   4.5
 5  1998     1     5   7.7   4.5
 6  1998     1     6   8.1   4.4
 7  1998     1     7  12     6.9
 8  1998     1     8  11.2   8.6
 9  1998     1     9  13.9   8.5
10  1998     1    10  14.5   3.6</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb97"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Replace the original temperature values directly with the Kelvin values.</span></span>
<span><span class="va">KAw</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>Tmin <span class="op">=</span> <span class="va">Tmin</span> <span class="op">+</span> <span class="fl">273.15</span>, Tmax <span class="op">=</span> <span class="va">Tmax</span> <span class="op">+</span> <span class="fl">273.15</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
    Year Month   Day  Tmax  Tmin
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  1998     1     1  281.  278.
 2  1998     1     2  282.  278.
 3  1998     1     3  284.  276.
 4  1998     1     4  282.  278.
 5  1998     1     5  281.  278.
 6  1998     1     6  281.  278.
 7  1998     1     7  285.  280.
 8  1998     1     8  284.  282.
 9  1998     1     9  287.  282.
10  1998     1    10  288.  277.</code></pre>
</div>
</div>
<p><br></p>
</section><section id="arrange" class="level4"><h4 class="anchored" data-anchor-id="arrange">
<span style="color:#71797E">9.6.6</span>&nbsp; <code>arrange</code>
</h4>
<div style="height: 18px;">

</div>
<ul>
<li>
<code>arrange</code> is a function to sort data in <code>data.frames</code> or <code>tibbles</code>.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb99"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">KAw</span> <span class="op">%&gt;%</span> <span class="fu">arrange</span><span class="op">(</span><span class="va">Tmax</span>, <span class="va">Tmin</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
    Year Month   Day  Tmax  Tmin
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  1998     1     5   7.7   4.5
 2  1998     1     6   8.1   4.4
 3  1998     1     1   8.2   5.1
 4  1998     1     4   8.4   4.5
 5  1998     1     2   9.1   5  
 6  1998     1     3  10.4   3.3
 7  1998     1     8  11.2   8.6
 8  1998     1     7  12     6.9
 9  1998     1     9  13.9   8.5
10  1998     1    10  14.5   3.6</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb101"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Sort in descending order</span></span>
<span><span class="va">KAw</span> <span class="op">%&gt;%</span> <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">Tmax</span><span class="op">)</span>, <span class="va">Tmin</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
    Year Month   Day  Tmax  Tmin
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  1998     1    10  14.5   3.6
 2  1998     1     9  13.9   8.5
 3  1998     1     7  12     6.9
 4  1998     1     8  11.2   8.6
 5  1998     1     3  10.4   3.3
 6  1998     1     2   9.1   5  
 7  1998     1     4   8.4   4.5
 8  1998     1     1   8.2   5.1
 9  1998     1     6   8.1   4.4
10  1998     1     5   7.7   4.5</code></pre>
</div>
</div>
<p><br></p>
</section></section><section id="loops" class="level3"><h3 class="anchored" data-anchor-id="loops">
<span style="color:#71797E">9.7</span>&nbsp; Loops</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>A loop repeats the same operation many times without having to explicitly retype (or copy and paste) the code.</p></li>
<li><p>More importantly, it also runs the same code while introducing certain modifications in every run.</p></li>
<li><p>Two basic types of loops: <code>for</code> loops and <code>while</code> loops— both functions need instructions that regulate the number of runs, as well as instructions on what to do in each of the runs.</p></li>
<li><p>Read detailed explanations on loops <a href="https://intro2r.com/loops.html">here.</a></p></li>
</ul>
<p><br></p>
<section id="for-loops" class="level4"><h4 class="anchored" data-anchor-id="for-loops">
<span style="color:#71797E">9.7.1</span>&nbsp; <code>for</code> loops</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>A <code>for</code> loop requires explicit instructions on how many times the code within the loop should be run.</p></li>
<li><p>This is usually specified by providing a vector or list of elements and instructing R to run the code for each of these elements.</p></li>
<li><p>This means that the number of times the code is run equals the number of elements in the vector or list.</p></li>
<li><p>We need a <em>counter</em> (often called <code>i</code> but can also be any other variable name) to keep track of which run we’re in.</p></li>
<li><p>The <em>counter</em> doesn’t have to be numeric, but it can assume many other shapes, e.g.&nbsp;that of a string.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb103"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Run the code three times with for command</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Hello"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] "Hello"
[1] "Hello"
[1] "Hello"</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb105"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Make the structure more complex by providing multiple lines of code within</span></span>
<span><span class="co"># winged brackets</span></span>
<span><span class="va">addition</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="co"># operation is embedded in a loop</span></span>
<span><span class="op">{</span> </span>
<span>  <span class="va">addition</span> <span class="op">&lt;-</span> <span class="va">addition</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">addition</span><span class="op">)</span> <span class="co"># need to instruct R to print value</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 2
[1] 3
[1] 4</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb107"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use i in more creative ways</span></span>
<span><span class="va">names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Paul"</span>, <span class="st">"Mary"</span>, <span class="st">"John"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Hello"</span>, <span class="va">names</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] "Hello Paul"
[1] "Hello Mary"
[1] "Hello John"</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb109"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Non-numerical counter</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Paul"</span>, <span class="st">"Mary"</span>, <span class="st">"John"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Hello"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] "Hello Paul"
[1] "Hello Mary"
[1] "Hello John"</code></pre>
</div>
</div>
<p><br></p>
</section><section id="while-loops" class="level4"><h4 class="anchored" data-anchor-id="while-loops">
<span style="color:#71797E">9.7.2</span>&nbsp; <code>while</code> loops</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>A loop with a <code>while</code> statement will run, until the specified condition is no longer fulfilled.</p></li>
<li><p>This only makes sense, of course, if the condition can change as a result of what happens inside the loop.</p></li>
<li><p>Note that <code>while</code> loops can easily cause problems if the condition remains fulfilled regardless of what happens in the code block. Your code will then get hung up and needs to be cancelled manually.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb111"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Run the `while` loop till the condition is met--</span></span>
<span><span class="co"># stop running when cond reaches 0 (no longer fulfilled)</span></span>
<span><span class="va">cond</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="kw">while</span> <span class="op">(</span><span class="va">cond</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> </span>
<span>  <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">cond</span><span class="op">)</span></span>
<span>  <span class="va">cond</span> <span class="op">&lt;-</span> <span class="va">cond</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 5
[1] 4
[1] 3
[1] 2
[1] 1</code></pre>
</div>
</div>
<p><br></p>
</section></section><section id="apply-functions" class="level3"><h3 class="anchored" data-anchor-id="apply-functions">
<span style="color:#71797E">9.8</span>&nbsp; <code>apply</code> functions</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>The functions from the <code>apply</code> family— <code>apply</code>, <code>lapply</code> and <code>sapply</code>— are often a much faster way to apply certain operations to multiple elements at the same time.</p></li>
<li><p>The two central arguments that need to be provided to these functions are the list of items to apply the operation to, and the operation itself.</p></li>
</ul>
<p><br></p>
<section id="sapply" class="level4"><h4 class="anchored" data-anchor-id="sapply">
<span style="color:#71797E">9.8.1</span>&nbsp; <code>sapply</code>
</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>The easiest function to apply an operation to a vector of elements is <code>sapply</code>.</p></li>
<li><p>It only needs two arguments: the vector (<code>X</code>), and the function to be applied (<code>FUN</code>).</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb113"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create a simple function `func` which just adds 1 to an object</span></span>
<span><span class="va">func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">+</span> <span class="fl">1</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="va">func</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 2 3 4 5 6</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb115"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># If we apply this function to a list of numbers, the output is a matrix </span></span>
<span><span class="co"># (but the values are the same).</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, <span class="va">func</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>     [,1]
[1,]    2
[2,]    3
[3,]    4
[4,]    5
[5,]    6</code></pre>
</div>
</div>
<p><br></p>
</section><section id="lapply" class="level4"><h4 class="anchored" data-anchor-id="lapply">
<span style="color:#71797E">9.8.2</span>&nbsp; <code>lapply</code>
</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p><code>lapply</code> function produces output as a list.</p></li>
<li><p>It interprets the input element <code>X</code> as a list and returns a list with as many elements as were provided in that list, with each one containing the output of applying <code>FUN</code> to the respective element.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb117"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="va">func</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 2

[[2]]
[1] 3

[[3]]
[1] 4

[[4]]
[1] 5

[[5]]
[1] 6</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb119"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Note that if the input element X is itself a list, this list is treated as </span></span>
<span><span class="co"># one input element, with FUN applied to the entire list and the result returned</span></span>
<span><span class="co"># as a single list element.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, <span class="va">func</span><span class="op">)</span> <span class="co"># example to understand how it works</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 2 3 4 5 6</code></pre>
</div>
</div>
<p><br></p>
</section><section id="apply" class="level4"><h4 class="anchored" data-anchor-id="apply">
<span style="color:#71797E">9.8.3</span>&nbsp; <code>apply</code>
</h4>
<div style="height: 18px;">

</div>
<ul>
<li>The basic <code>apply</code> function is for applying functions to arrays, where we can operate either on the rows (<code>MARGIN = 1</code>) or on the columns (<code>MARGIN = 1</code>) of the array. <em>(Not use much)</em>
</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb121"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mat</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    1    2    3
[2,]    1    2    3
[3,]    1    2    3</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb123"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">mat</span>, MARGIN <span class="op">=</span> <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span> <span class="co"># adding up all the data in each row</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 6 6 6</code></pre>
</div>
</div>
<p><br></p>
</section></section><section id="exercise-on-useful-r-tools" class="level3"><h3 class="anchored" data-anchor-id="exercise-on-useful-r-tools">
<span style="color:#71797E">9.9</span>&nbsp; Exercise on useful R tools</h3>
<div style="height: 18px;">

</div>
<p><strong><em>1. Based on the <code>Winters_hours_gaps</code> dataset, use <code>magrittr</code> pipes and functions of the <code>tidyverse</code> to accomplish the following:</em></strong></p>
<p><strong>a. Convert the dataset into a <code>tibble</code>.</strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb125"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">WHG_tibble</span> <span class="op">&lt;-</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">WHG_tibble</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 6
   Year Month   Day  Hour Temp_gaps  Temp
  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;
1  2008     3     3    10      15.1  15.1
2  2008     3     3    11      17.2  17.2
3  2008     3     3    12      18.7  18.7
4  2008     3     3    13      18.7  18.7
5  2008     3     3    14      18.8  18.8</code></pre>
</div>
</div>
<p><br></p>
<p><strong>b. Select only the top 10 rows of the dataset</strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb127"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">WHG_data</span> <span class="op">&lt;-</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="va">Winters_hours_gaps</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">WHG_data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 6
    Year Month   Day  Hour Temp_gaps  Temp
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1  2008     3     3    10      15.1  15.1
 2  2008     3     3    11      17.2  17.2
 3  2008     3     3    12      18.7  18.7
 4  2008     3     3    13      18.7  18.7
 5  2008     3     3    14      18.8  18.8
 6  2008     3     3    15      19.5  19.5
 7  2008     3     3    16      19.3  19.3
 8  2008     3     3    17      17.7  17.7
 9  2008     3     3    18      15.4  15.4
10  2008     3     3    19      12.7  12.7</code></pre>
</div>
</div>
<p><br></p>
<p><strong>c.&nbsp;Convert the <code>tibble</code> to a <code>long</code> format, with separate rows for <code>Temp_gaps</code> and <code>Temp</code></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb129"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">WHG_data_long</span> <span class="op">&lt;-</span> <span class="va">WHG_tibble</span> <span class="op">%&gt;%</span> <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="va">Temp_gaps</span><span class="op">:</span><span class="va">Temp</span><span class="op">)</span></span>
<span></span>
<span><span class="va">WHG_data_long</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 6
    Year Month   Day  Hour name      value
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;
 1  2008     3     3    10 Temp_gaps  15.1
 2  2008     3     3    10 Temp       15.1
 3  2008     3     3    11 Temp_gaps  17.2
 4  2008     3     3    11 Temp       17.2
 5  2008     3     3    12 Temp_gaps  18.7
 6  2008     3     3    12 Temp       18.7
 7  2008     3     3    13 Temp_gaps  18.7
 8  2008     3     3    13 Temp       18.7
 9  2008     3     3    14 Temp_gaps  18.8
10  2008     3     3    14 Temp       18.8
11  2008     3     3    15 Temp_gaps  19.5
12  2008     3     3    15 Temp       19.5
13  2008     3     3    16 Temp_gaps  19.3
14  2008     3     3    16 Temp       19.3
15  2008     3     3    17 Temp_gaps  17.7
16  2008     3     3    17 Temp       17.7
17  2008     3     3    18 Temp_gaps  15.4
18  2008     3     3    18 Temp       15.4
19  2008     3     3    19 Temp_gaps  12.7
20  2008     3     3    19 Temp       12.7</code></pre>
</div>
</div>
<p><br></p>
<p><strong>d.&nbsp;Use <code>ggplot2</code> to plot <code>Temp_gaps</code> and <code>Temp</code> as facets (point or line plot)</strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb131"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Point plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">WHG_data_long</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">28</span>, <span class="op">]</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">Hour</span>, <span class="va">value</span>, colour <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Hour (JDay 63)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Temperature (°C)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>colour <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Point plot"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/9.9.1d-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb132"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># The first 28 rows is for JDay 63 and there is no missing data in Temp_gaps</span></span>
<span></span>
<span><span class="co">## Line plot</span></span>
<span></span>
<span><span class="co"># So, for the line plot I will choose the JDay with gaps in temperature</span></span>
<span><span class="co"># After checking the dataset, I found JDay 78 has some missing Temp_gaps values</span></span>
<span><span class="co"># JDay 78 (18 MAR 2008) is rows 701:748</span></span>
<span></span>
<span><span class="co"># Line plot of Temp and Temp_gaps for JDay 78</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">WHG_data_long</span><span class="op">[</span><span class="fl">701</span><span class="op">:</span><span class="fl">748</span>, <span class="op">]</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">Hour</span>, <span class="va">value</span>, colour <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Hour (JDay 78)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Temperature (°C)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>colour <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Line plot"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/9.9.1d-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p><strong>e. Convert the dataset back to the <code>wide</code> format</strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb133"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">WHG_data_wide</span> <span class="op">&lt;-</span> <span class="va">WHG_data_long</span> <span class="op">%&gt;%</span> <span class="fu">pivot_wider</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display for JDay 78</span></span>
<span><span class="va">WHG_data_wide</span><span class="op">[</span><span class="fl">351</span><span class="op">:</span><span class="fl">374</span>, <span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 6
    Year Month   Day  Hour Temp_gaps  Temp
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1  2008     3    18     0     NA    11.4 
 2  2008     3    18     1     NA    11.2 
 3  2008     3    18     2     NA    10.9 
 4  2008     3    18     3     NA     9.58
 5  2008     3    18     4      8.17  8.17
 6  2008     3    18     5      7.04  7.04
 7  2008     3    18     6      6.08  6.08
 8  2008     3    18     7     NA     7.19
 9  2008     3    18     8     NA    12.8 
10  2008     3    18     9     NA    16.0 
# ℹ 14 more rows</code></pre>
</div>
</div>
<p><br></p>
<p><strong>f.&nbsp;Select only the following columns: <code>Year</code>, <code>Month</code>, <code>Day</code> and <code>Temp</code></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb135"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">WHG_data_wide</span><span class="op">[</span><span class="fl">351</span><span class="op">:</span><span class="fl">374</span>, <span class="op">]</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Year</span>, <span class="va">Month</span>, <span class="va">Day</span>, <span class="va">Temp</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 4
    Year Month   Day  Temp
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
 1  2008     3    18 11.4 
 2  2008     3    18 11.2 
 3  2008     3    18 10.9 
 4  2008     3    18  9.58
 5  2008     3    18  8.17
 6  2008     3    18  7.04
 7  2008     3    18  6.08
 8  2008     3    18  7.19
 9  2008     3    18 12.8 
10  2008     3    18 16.0 
# ℹ 14 more rows</code></pre>
</div>
</div>
<p><br></p>
<p><strong>g. Sort the dataset by the <code>Temp</code> column, in descending order</strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb137"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">WHG_data_wide</span><span class="op">[</span><span class="fl">351</span><span class="op">:</span><span class="fl">374</span>, <span class="op">]</span> <span class="op">%&gt;%</span> <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">Temp</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 6
    Year Month   Day  Hour Temp_gaps  Temp
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1  2008     3    18    15      NA    24.7
 2  2008     3    18    14      NA    24.1
 3  2008     3    18    13      NA    23.6
 4  2008     3    18    16      NA    23.6
 5  2008     3    18    12      23.1  23.1
 6  2008     3    18    17      NA    22.0
 7  2008     3    18    11      21.4  21.4
 8  2008     3    18    18      20.1  20.1
 9  2008     3    18    10      19.3  19.3
10  2008     3    18    19      16.9  16.9
# ℹ 14 more rows</code></pre>
</div>
</div>
<p><br></p>
<p><strong><em>2. For the <code>Winter_hours_gaps</code> dataset, write a <code>for</code> loop to convert all temperatures (Temp column) to degrees Fahrenheit</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb139"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># I want this output to match the output from 1.g</span></span>
<span><span class="va">WHG_JDay78</span> <span class="op">&lt;-</span> <span class="va">WHG_data_wide</span><span class="op">[</span><span class="fl">351</span><span class="op">:</span><span class="fl">374</span>, <span class="op">]</span> <span class="op">%&gt;%</span> <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">Temp</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">WHG_JDay78</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="op">{</span></span>
<span>  <span class="va">WHG_JDay78</span><span class="op">$</span><span class="va">Temp</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">WHG_JDay78</span><span class="op">$</span><span class="va">Temp</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="fl">1.8</span> <span class="op">+</span> <span class="fl">32</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">WHG_JDay78</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 6
    Year Month   Day  Hour Temp_gaps  Temp
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1  2008     3    18    15      NA    76.5
 2  2008     3    18    14      NA    75.4
 3  2008     3    18    13      NA    74.6
 4  2008     3    18    16      NA    74.4
 5  2008     3    18    12      23.1  73.5
 6  2008     3    18    17      NA    71.6
 7  2008     3    18    11      21.4  70.5
 8  2008     3    18    18      20.1  68.2
 9  2008     3    18    10      19.3  66.8
10  2008     3    18    19      16.9  62.5
# ℹ 14 more rows</code></pre>
</div>
</div>
<p><br></p>
<p><strong><em>3. Execute the same operation with a function from the <code>apply</code> family</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb141"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">WHG_JDay78_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span> <span class="va">x</span> <span class="op">*</span> <span class="fl">1.8</span> <span class="op">+</span> <span class="fl">32</span></span>
<span></span>
<span><span class="co"># Apply function to Temp column only</span></span>
<span><span class="va">WHG_data_wide</span><span class="op">$</span><span class="va">Temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">WHG_data_wide</span><span class="op">$</span><span class="va">Temp</span>, <span class="va">WHG_JDay78_function</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print in descending order</span></span>
<span><span class="va">WHG_data_wide</span><span class="op">[</span><span class="fl">351</span><span class="op">:</span><span class="fl">374</span>, <span class="op">]</span> <span class="op">%&gt;%</span> <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">Temp</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 6
    Year Month   Day  Hour Temp_gaps  Temp
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1  2008     3    18    15      NA    76.5
 2  2008     3    18    14      NA    75.4
 3  2008     3    18    13      NA    74.6
 4  2008     3    18    16      NA    74.4
 5  2008     3    18    12      23.1  73.5
 6  2008     3    18    17      NA    71.6
 7  2008     3    18    11      21.4  70.5
 8  2008     3    18    18      20.1  68.2
 9  2008     3    18    10      19.3  66.8
10  2008     3    18    19      16.9  62.5
# ℹ 14 more rows</code></pre>
</div>
</div>
<p><br></p>
<p><strong><em>4. Now use the <code>tidyverse</code> function <code>mutate</code> to achieve the same outcome</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb143"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Call the WHG_data_wide again to run the original values</span></span>
<span><span class="va">WHG_data_wide</span> <span class="op">&lt;-</span> <span class="va">WHG_data_long</span> <span class="op">%&gt;%</span> <span class="fu">pivot_wider</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">WHG_mutate</span> <span class="op">&lt;-</span> <span class="va">WHG_data_wide</span><span class="op">[</span><span class="fl">351</span><span class="op">:</span><span class="fl">374</span>, <span class="op">]</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>Temp_C <span class="op">=</span> <span class="va">Temp</span>, Temp_F <span class="op">=</span> <span class="va">Temp</span> <span class="op">*</span> <span class="fl">1.8</span> <span class="op">+</span> <span class="fl">32</span>, Temp <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="va">WHG_mutate</span> <span class="op">&lt;-</span> <span class="va">WHG_mutate</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">Temp_F</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">WHG_mutate</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 7
    Year Month   Day  Hour Temp_gaps Temp_C Temp_F
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1  2008     3    18    15      NA     24.7   76.5
 2  2008     3    18    14      NA     24.1   75.4
 3  2008     3    18    13      NA     23.6   74.6
 4  2008     3    18    16      NA     23.6   74.4
 5  2008     3    18    12      23.1   23.1   73.5
 6  2008     3    18    17      NA     22.0   71.6
 7  2008     3    18    11      21.4   21.4   70.5
 8  2008     3    18    18      20.1   20.1   68.2
 9  2008     3    18    10      19.3   19.3   66.8
10  2008     3    18    19      16.9   16.9   62.5
# ℹ 14 more rows</code></pre>
</div>
</div>
<p><br></p>
<p><strong><em>5. Voluntary: consider taking a look at the instruction materials on all these functions, which I linked above, as well as at other sources on the internet. There’s a lot more to discover here, with lots of potential for making your coding more elegant and easier - and possibly even more fun!</em></strong></p>
<p><br></p>
</section></section><section id="chapter-10-getting-temperature-data" class="level2"><h2 class="anchored" data-anchor-id="chapter-10-getting-temperature-data">Chapter 10: Getting temperature data</h2>
<section id="temperature-data-needs" class="level3"><h3 class="anchored" data-anchor-id="temperature-data-needs">
<span style="color:#71797E">10.1</span>&nbsp; Temperature data needs</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>It is preferable to have a high-quality dataset collected in the exact place that you want to analyze.</p></li>
<li><p>If we don’t have such data, however, there are a few databases out there that we can draw on as an alternative option— <code>chillR</code> has access to one global database and one for California.</p></li>
</ul>
<p><br></p>
</section><section id="the-global-summary-of-the-day-database" class="level3"><h3 class="anchored" data-anchor-id="the-global-summary-of-the-day-database">
<span style="color:#71797E">10.2</span>&nbsp; The Global Summary of the Day database</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>An invaluable source of temperature data: <a href="https://www.geoplatform.gov/metadata/89cd9f7c-c14a-4ec2-a51d-7f69dc46ea41">Global Summary of the Day (GSOD) database</a> by the <a href="https://www.ncei.noaa.gov/">National Centers for Environmental Information (NCEI), formerly the National Climatic Data Center (NCDC)</a> of the <a href="https://www.noaa.gov/">United States National Oceanic and Atmospheric Administration (NOAA)</a>— direct access to the weather data <a href="https://www.ncei.noaa.gov/data/global-summary-of-the-day/access/">here.</a></p></li>
<li><p><code>chillR</code> automates the tedious data download and assembling process</p></li>
<li><p><code>handle_gsod()</code> can take care of all data retrieval steps by telling the function’s <code>action</code> parameter on what to do, since there are multiple steps involved.</p></li>
</ul>
<p><br></p>
<section id="actionlist_stations" class="level4"><h4 class="anchored" data-anchor-id="actionlist_stations">
<span style="color:#71797E">10.2.1</span>&nbsp; <code>action=list_stations</code>
</h4>
<div style="height: 18px;">

</div>
<ul>
<li>
<code>handle_gsod()</code> retrieves the station list and sorts the station based on their proximity to a set of coordinates we specify.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb145"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Search for stations near Bonn (Latitude: 50.73, Longitude: 7.10)</span></span>
<span><span class="va">station_list</span> <span class="op">&lt;-</span> <span class="fu">handle_gsod</span><span class="op">(</span>action <span class="op">=</span> <span class="st">"list_stations"</span>,</span>
<span>                            location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>long <span class="op">=</span> <span class="fl">7.10</span>, lat <span class="op">=</span> <span class="fl">50.73</span><span class="op">)</span>,</span>
<span>                            time_interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1990</span>, <span class="fl">2020</span><span class="op">)</span><span class="op">)</span> <span class="co"># limit search data</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">station_list</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">chillR_code</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">STATION.NAME</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">CTRY</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Lat</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Long</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BEGIN</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">END</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Distance</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Overlap_years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_interval_covered</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">10517099999</td>
<td style="text-align: left;">BONN/FRIESDORF(AUT)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.700</td>
<td style="text-align: right;">7.150</td>
<td style="text-align: right;">19360102</td>
<td style="text-align: right;">19921231</td>
<td style="text-align: right;">4.86</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">10518099999</td>
<td style="text-align: left;">BONN-HARDTHOEHE</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.700</td>
<td style="text-align: right;">7.033</td>
<td style="text-align: right;">19750523</td>
<td style="text-align: right;">19971223</td>
<td style="text-align: right;">5.78</td>
<td style="text-align: right;">7.98</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10519099999</td>
<td style="text-align: left;">BONN-ROLEBER</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.733</td>
<td style="text-align: right;">7.200</td>
<td style="text-align: right;">20010705</td>
<td style="text-align: right;">20081231</td>
<td style="text-align: right;">7.05</td>
<td style="text-align: right;">7.49</td>
<td style="text-align: right;">24</td>
</tr>
<tr class="even">
<td style="text-align: left;">10513099999</td>
<td style="text-align: left;">KOLN BONN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.866</td>
<td style="text-align: right;">7.143</td>
<td style="text-align: right;">19310101</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">15.44</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10509099999</td>
<td style="text-align: left;">BUTZWEILERHOF(BAFB)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.983</td>
<td style="text-align: right;">6.900</td>
<td style="text-align: right;">19780901</td>
<td style="text-align: right;">19950823</td>
<td style="text-align: right;">31.48</td>
<td style="text-align: right;">5.64</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="even">
<td style="text-align: left;">10502099999</td>
<td style="text-align: left;">NORVENICH</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.831</td>
<td style="text-align: right;">6.658</td>
<td style="text-align: right;">19730101</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">33.08</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10514099999</td>
<td style="text-align: left;">MENDIG</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.366</td>
<td style="text-align: right;">7.315</td>
<td style="text-align: right;">19730102</td>
<td style="text-align: right;">19971231</td>
<td style="text-align: right;">43.28</td>
<td style="text-align: right;">8.00</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: left;">10506099999</td>
<td style="text-align: left;">NUERBURG-BARWEILER</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.367</td>
<td style="text-align: right;">6.867</td>
<td style="text-align: right;">19950401</td>
<td style="text-align: right;">19971231</td>
<td style="text-align: right;">43.64</td>
<td style="text-align: right;">2.75</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10508099999</td>
<td style="text-align: left;">BLANKENHEIM</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.450</td>
<td style="text-align: right;">6.650</td>
<td style="text-align: right;">19781002</td>
<td style="text-align: right;">19840504</td>
<td style="text-align: right;">44.53</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">10510099999</td>
<td style="text-align: left;">NUERBURG</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.333</td>
<td style="text-align: right;">6.950</td>
<td style="text-align: right;">19300901</td>
<td style="text-align: right;">19921231</td>
<td style="text-align: right;">45.45</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10515099999</td>
<td style="text-align: left;">BENDORF</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.417</td>
<td style="text-align: right;">7.583</td>
<td style="text-align: right;">19310102</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">48.79</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="even">
<td style="text-align: left;">10504099999</td>
<td style="text-align: left;">EIFEL</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.650</td>
<td style="text-align: right;">6.283</td>
<td style="text-align: right;">20040501</td>
<td style="text-align: right;">20040501</td>
<td style="text-align: right;">58.30</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10526099999</td>
<td style="text-align: left;">BAD MARIENBERG</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.667</td>
<td style="text-align: right;">7.967</td>
<td style="text-align: right;">19730101</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">61.54</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="even">
<td style="text-align: left;">10613099999</td>
<td style="text-align: left;">BUCHEL</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.174</td>
<td style="text-align: right;">7.063</td>
<td style="text-align: right;">19730101</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">61.95</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10503099999</td>
<td style="text-align: left;">AACHEN/MERZBRUCK</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.817</td>
<td style="text-align: right;">6.183</td>
<td style="text-align: right;">19780901</td>
<td style="text-align: right;">19971212</td>
<td style="text-align: right;">65.28</td>
<td style="text-align: right;">7.95</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: left;">10419099999</td>
<td style="text-align: left;">LUDENSCHEID &amp;</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">51.233</td>
<td style="text-align: right;">7.600</td>
<td style="text-align: right;">19270906</td>
<td style="text-align: right;">20030306</td>
<td style="text-align: right;">66.06</td>
<td style="text-align: right;">13.18</td>
<td style="text-align: right;">43</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10400099999</td>
<td style="text-align: left;">DUSSELDORF</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">51.289</td>
<td style="text-align: right;">6.767</td>
<td style="text-align: right;">19310102</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">66.46</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">10616299999</td>
<td style="text-align: left;">SIEGERLAND</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.708</td>
<td style="text-align: right;">8.083</td>
<td style="text-align: right;">20040510</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">69.33</td>
<td style="text-align: right;">16.65</td>
<td style="text-align: right;">54</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10418099999</td>
<td style="text-align: left;">LUEDENSCHEID</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">51.250</td>
<td style="text-align: right;">7.650</td>
<td style="text-align: right;">19940301</td>
<td style="text-align: right;">19971231</td>
<td style="text-align: right;">69.54</td>
<td style="text-align: right;">3.84</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="even">
<td style="text-align: left;">10437499999</td>
<td style="text-align: left;">MONCHENGLADBACH</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">51.230</td>
<td style="text-align: right;">6.504</td>
<td style="text-align: right;">19960715</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">69.59</td>
<td style="text-align: right;">24.47</td>
<td style="text-align: right;">79</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10403099999</td>
<td style="text-align: left;">MOENCHENGLADBACH</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">51.233</td>
<td style="text-align: right;">6.500</td>
<td style="text-align: right;">19381001</td>
<td style="text-align: right;">19421031</td>
<td style="text-align: right;">70.03</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">10501099999</td>
<td style="text-align: left;">AACHEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.783</td>
<td style="text-align: right;">6.100</td>
<td style="text-align: right;">19280101</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">70.67</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">06496099999</td>
<td style="text-align: left;">ELSENBORN (MIL)</td>
<td style="text-align: left;">BE</td>
<td style="text-align: right;">50.467</td>
<td style="text-align: right;">6.183</td>
<td style="text-align: right;">19840501</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">71.10</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">06495099999</td>
<td style="text-align: left;">BOTRANGE (MOUNT)</td>
<td style="text-align: left;">BE</td>
<td style="text-align: right;">50.500</td>
<td style="text-align: right;">6.100</td>
<td style="text-align: right;">19510201</td>
<td style="text-align: right;">20011015</td>
<td style="text-align: right;">75.13</td>
<td style="text-align: right;">11.79</td>
<td style="text-align: right;">38</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10409099999</td>
<td style="text-align: left;">ESSEN/MUELHEIM</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">51.400</td>
<td style="text-align: right;">6.967</td>
<td style="text-align: right;">19300414</td>
<td style="text-align: right;">19431231</td>
<td style="text-align: right;">75.17</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb146"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#  25 closest stations to the location set, ordered by their </span></span>
<span><span class="co"># distance to the target coordinates</span></span>
<span></span>
<span><span class="co"># Overlap_years column: the number of years that are available</span></span>
<span></span>
<span><span class="co"># Perc_interval_covered column: the percentage of the target interval </span></span>
<span><span class="co"># that is covered based on BEGIN and END dates in the table - </span></span>
<span><span class="co"># it’s quite possible (and usually the case) that the dataset contains gaps, </span></span>
<span><span class="co"># which sometimes cover almost the entire record.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section><section id="actiondownload_weather" class="level4"><h4 class="anchored" data-anchor-id="actiondownload_weather">
<span style="color:#71797E">10.2.2</span>&nbsp; <code>action="download_weather"</code>
</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>When used with this option, the <code>handle_gsod()</code> function downloads the weather data for a particular station, based on a station-specific <code>chillR_code</code>.</p></li>
<li><p>Rather than typing the code manually, we can refer to the code in the station_list.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb147"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Download for the 4th entry in the list, which covers most of our period of interest</span></span>
<span>  <span class="va">weather</span> <span class="op">&lt;-</span> <span class="fu">handle_gsod</span><span class="op">(</span>action <span class="op">=</span> <span class="st">"download_weather"</span>,</span>
<span>                       location <span class="op">=</span> <span class="va">station_list</span><span class="op">$</span><span class="va">chillR_code</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, <span class="co">#Koln_bonn airport</span></span>
<span>                       time_interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1990</span>, <span class="fl">2020</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Loading data for 31 years from station 'KOLN BONN'
================================================================================</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb149"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Result is a list of two elements:</span></span>
<span><span class="co"># Element 1 (weather[[1]]) - an indication of the database the data come from</span></span>
<span><span class="co"># Element 2 (weather[[2]]) - the actual dataset</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">weather</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">STATION</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">DATE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LATITUDE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LONGITUDE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ELEVATION</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">NAME</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">TEMP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">TEMP_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">DEWP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">DEWP_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SLP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SLP_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">STP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">STP_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">VISIB</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">VISIB_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">WDSP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">WDSP_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MXSPD</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">GUST</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MAX</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">MAX_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MIN</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">MIN_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">PRCP</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">PRCP_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SNDP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">FRSHTT</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-01</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">32.0</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">30.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">5.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">8.9</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">33.8</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">30.2</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-02</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">33.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">31.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9.9</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">35.6</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">32.0</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">110000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-03</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">33.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">29.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">10.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">15.9</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">35.6</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">31.3</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">100000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-04</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">31.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">27.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">10.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">17.1</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">35.6</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">30.0</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-05</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">34.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">31.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4.4</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">3.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">6.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">37.6</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">30.0</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-06</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">34.4</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">31.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">11.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">15.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">36.3</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">32.0</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-07</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">33.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">29.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">10.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">15.9</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">39.7</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">31.8</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-08</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">37.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">34.0</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6.0</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">7.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9.9</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">44.6</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">31.8</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-09</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">41.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">38.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5.4</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">5.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">11.1</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">46.4</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">38.8</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.02</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-10</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">40.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">37.4</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">5.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">8.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">42.8</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">37.4</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10010</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-11</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">41.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">35.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">6.4</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">8.9</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">44.6</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">37.9</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.01</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-12</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">35.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">31.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">8.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">13.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">41.4</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">30.2</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-13</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">34.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">31.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1028.1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">15.5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">6.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">6.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">11.1</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">39.2</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">29.7</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-14</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">37.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">35.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">4.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">8.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">41.0</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">31.6</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">C</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-15</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">40.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">37.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">7.4</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">11.1</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">48.2</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">33.6</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.04</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-16</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">49.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">45.0</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">7.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">14.0</td>
<td style="text-align: right;">27.0</td>
<td style="text-align: right;">51.8</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">43.2</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-17</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">47.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">40.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">10.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">17.1</td>
<td style="text-align: right;">35.0</td>
<td style="text-align: right;">51.8</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">33.8</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-18</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">36.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">32.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">5.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">12.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">44.6</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">30.2</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-19</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">40.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">33.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">7.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">14.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">44.8</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">35.6</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10513099999</td>
<td style="text-align: left;">1990-01-20</td>
<td style="text-align: right;">50.86592</td>
<td style="text-align: right;">7.142744</td>
<td style="text-align: right;">92.04</td>
<td style="text-align: left;">KOLN BONN, GM</td>
<td style="text-align: right;">42.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">38.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1024.9</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">12.5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">8.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">14.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">47.3</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">39.2</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.09</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
</tbody>
</table>
</div>
</div>
<div style="height: 18px;">

</div>
<ul>
<li><p>The output looks pretty complicated, and it contains a lot of information we don’t need.</p></li>
<li>
<p><code>chillR</code> has a function to simplify this record. But,</p>
<ul>
<li>This removes a lot of variables you may be interested in.</li>
<li>More importantly, this also removes quality flags, which may indicate that particular records aren’t reliable.</li>
</ul>
</li>
</ul>
<p><br></p>
</section><section id="downloaded-weather-as-action-argument" class="level4"><h4 class="anchored" data-anchor-id="downloaded-weather-as-action-argument">
<span style="color:#71797E">10.2.3</span>&nbsp; downloaded weather as <code>action</code> argument</h4>
<div style="height: 18px;">

</div>
<ul>
<li>This way of calling <code>handle_gsod()</code> serves to clean the dataset and convert it into a format that <code>chillR</code> can easily handle</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb150"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Clean dataset</span></span>
<span><span class="va">cleaned_weather</span> <span class="op">&lt;-</span> <span class="fu">handle_gsod</span><span class="op">(</span><span class="va">weather</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">cleaned_weather</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Date</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Prec</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1990-01-01 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1.000</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-02 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">2.000</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-03 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">-0.389</td>
<td style="text-align: right;">2.000</td>
<td style="text-align: right;">0.722</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-04 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">-1.111</td>
<td style="text-align: right;">2.000</td>
<td style="text-align: right;">-0.056</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-05 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">-1.111</td>
<td style="text-align: right;">3.111</td>
<td style="text-align: right;">1.556</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-06 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">2.389</td>
<td style="text-align: right;">1.333</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-07 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">-0.111</td>
<td style="text-align: right;">4.278</td>
<td style="text-align: right;">1.056</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-08 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">-0.111</td>
<td style="text-align: right;">7.000</td>
<td style="text-align: right;">3.278</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-09 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">3.778</td>
<td style="text-align: right;">8.000</td>
<td style="text-align: right;">5.333</td>
<td style="text-align: right;">0.508</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-10 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">3.000</td>
<td style="text-align: right;">6.000</td>
<td style="text-align: right;">4.556</td>
<td style="text-align: right;">1.016</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-11 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">3.278</td>
<td style="text-align: right;">7.000</td>
<td style="text-align: right;">5.167</td>
<td style="text-align: right;">0.254</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-12 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">-1.000</td>
<td style="text-align: right;">5.222</td>
<td style="text-align: right;">1.778</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-13 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">-1.278</td>
<td style="text-align: right;">4.000</td>
<td style="text-align: right;">1.389</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-14 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">-0.222</td>
<td style="text-align: right;">5.000</td>
<td style="text-align: right;">3.167</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-15 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">0.889</td>
<td style="text-align: right;">9.000</td>
<td style="text-align: right;">4.556</td>
<td style="text-align: right;">1.016</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-16 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">6.222</td>
<td style="text-align: right;">11.000</td>
<td style="text-align: right;">9.944</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-17 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">11.000</td>
<td style="text-align: right;">8.500</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-18 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">-1.000</td>
<td style="text-align: right;">7.000</td>
<td style="text-align: right;">2.722</td>
<td style="text-align: right;">0.254</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-19 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">2.000</td>
<td style="text-align: right;">7.111</td>
<td style="text-align: right;">4.611</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-20 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">4.000</td>
<td style="text-align: right;">8.500</td>
<td style="text-align: right;">6.056</td>
<td style="text-align: right;">2.286</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb151"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Save the output files generated, so that we can use in the next chapters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="st">"data/Bonn"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">station_list</span>,<span class="st">"data/Bonn/station_list.csv"</span>,row.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">weather</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,<span class="st">"data/Bonn/Bonn_raw_weather.csv"</span>,row.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">cleaned_weather</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,<span class="st">"data/Bonn/Bonn_chillR_weather.csv"</span>,row.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div style="height: 18px;">

</div>
<ul>
<li><p>The output record contains many strange numbers— degrees Fahrenheit values in origianl database are converted to degrees Celsius</p></li>
<li><p><span class="math inline">\(Temperature[^\circ C] = (Temperature[^\circ F] - 32) . \frac{5}{9}\)</span></p></li>
<li><p>The dataset still has pretty substantial gaps, including several entire years of missing data— Filling gaps in temperature records</p></li>
<li><p><code>chillR</code> has a pretty similar function to download data from the <a href="https://cimis.water.ca.gov/">California Irrigation Management Information System (CIMIS).</a></p></li>
</ul>
<p><br></p>
</section></section><section id="exercises-on-getting-temperature-data" class="level3"><h3 class="anchored" data-anchor-id="exercises-on-getting-temperature-data">
<span style="color:#71797E">10.3</span>&nbsp; Exercises on getting temperature data</h3>
<div style="height: 18px;">

</div>
<p><strong><em>1. Choose a location of interest and find the 25 closest weather stations using the <code>handle_gsod</code> function</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb152"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Look for stations near M&amp;ouml;ssigen (48.40567° N, 9.05419° E)</span></span>
<span><span class="va">MS_station_list</span> <span class="op">&lt;-</span> <span class="fu">handle_gsod</span><span class="op">(</span>action <span class="op">=</span> <span class="st">"list_stations"</span>,</span>
<span>                               location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>long <span class="op">=</span> <span class="fl">9.05</span>, lat <span class="op">=</span> <span class="fl">48.40</span><span class="op">)</span>,</span>
<span>                               time_interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1990</span>, <span class="fl">2020</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">MS_station_list</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">chillR_code</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">STATION.NAME</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">CTRY</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Lat</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Long</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BEGIN</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">END</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Distance</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Overlap_years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_interval_covered</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">10826099999</td>
<td style="text-align: left;">TUBINGEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.517</td>
<td style="text-align: right;">9.050</td>
<td style="text-align: right;">19730101</td>
<td style="text-align: right;">19790809</td>
<td style="text-align: right;">13.02</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">10827099999</td>
<td style="text-align: left;">MESSSTETTEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.183</td>
<td style="text-align: right;">9.000</td>
<td style="text-align: right;">19740820</td>
<td style="text-align: right;">19971231</td>
<td style="text-align: right;">24.44</td>
<td style="text-align: right;">8.00</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10738099999</td>
<td style="text-align: left;">STUTTGART</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.690</td>
<td style="text-align: right;">9.222</td>
<td style="text-align: right;">19390902</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">34.68</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">10828099999</td>
<td style="text-align: left;">SIGMARINGEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.100</td>
<td style="text-align: right;">9.250</td>
<td style="text-align: right;">19950201</td>
<td style="text-align: right;">19971230</td>
<td style="text-align: right;">36.54</td>
<td style="text-align: right;">2.91</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10818099999</td>
<td style="text-align: left;">KLIPPENECK (CLIFF)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.100</td>
<td style="text-align: right;">8.750</td>
<td style="text-align: right;">19300903</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">40.12</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="even">
<td style="text-align: left;">10737099999</td>
<td style="text-align: left;">STUTTGART</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.767</td>
<td style="text-align: right;">9.183</td>
<td style="text-align: right;">19360701</td>
<td style="text-align: right;">20030425</td>
<td style="text-align: right;">42.01</td>
<td style="text-align: right;">13.31</td>
<td style="text-align: right;">43</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10834099999</td>
<td style="text-align: left;">RIEDLINGEN (AUT)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.167</td>
<td style="text-align: right;">9.500</td>
<td style="text-align: right;">19880105</td>
<td style="text-align: right;">19921231</td>
<td style="text-align: right;">42.24</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">10815099999</td>
<td style="text-align: left;">FREUDENSTADT</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.450</td>
<td style="text-align: right;">8.417</td>
<td style="text-align: right;">19730101</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">47.09</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10921099999</td>
<td style="text-align: left;">NEUHAUSEN OB ECK</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">47.983</td>
<td style="text-align: right;">8.900</td>
<td style="text-align: right;">19730102</td>
<td style="text-align: right;">19950228</td>
<td style="text-align: right;">47.74</td>
<td style="text-align: right;">5.16</td>
<td style="text-align: right;">17</td>
</tr>
<tr class="even">
<td style="text-align: left;">10739099999</td>
<td style="text-align: left;">STUTTGART/SCHNARREN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.833</td>
<td style="text-align: right;">9.200</td>
<td style="text-align: right;">19840807</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">49.45</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10832099999</td>
<td style="text-align: left;">TUERKHEIM</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.583</td>
<td style="text-align: right;">9.783</td>
<td style="text-align: right;">20040818</td>
<td style="text-align: right;">20040818</td>
<td style="text-align: right;">57.79</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">10835099999</td>
<td style="text-align: left;">GOPPINGEN(US ARMY)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.717</td>
<td style="text-align: right;">9.700</td>
<td style="text-align: right;">19730102</td>
<td style="text-align: right;">19750214</td>
<td style="text-align: right;">59.49</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10835499999</td>
<td style="text-align: left;">GOPPINGEN (USA-AF)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.717</td>
<td style="text-align: right;">9.700</td>
<td style="text-align: right;">19370104</td>
<td style="text-align: right;">19900201</td>
<td style="text-align: right;">59.49</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">10912099999</td>
<td style="text-align: left;">DONAUESCHINGEN VILLINGEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">47.973</td>
<td style="text-align: right;">8.522</td>
<td style="text-align: right;">20040406</td>
<td style="text-align: right;">20191118</td>
<td style="text-align: right;">61.61</td>
<td style="text-align: right;">15.62</td>
<td style="text-align: right;">50</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10736099999</td>
<td style="text-align: left;">MUEHLACKER (AUT)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.967</td>
<td style="text-align: right;">8.867</td>
<td style="text-align: right;">19790314</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">64.54</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="even">
<td style="text-align: left;">10838099999</td>
<td style="text-align: left;">ULM (MIL/MET)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.383</td>
<td style="text-align: right;">9.950</td>
<td style="text-align: right;">19490101</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">66.56</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10837099999</td>
<td style="text-align: left;">LAUPHEIM</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.220</td>
<td style="text-align: right;">9.910</td>
<td style="text-align: right;">19730102</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">66.75</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">10836099999</td>
<td style="text-align: left;">STOETTEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.667</td>
<td style="text-align: right;">9.867</td>
<td style="text-align: right;">19490101</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">67.16</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10839099999</td>
<td style="text-align: left;">ULM/WILHELMSBURG &amp;</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.400</td>
<td style="text-align: right;">9.983</td>
<td style="text-align: right;">19410116</td>
<td style="text-align: right;">19430430</td>
<td style="text-align: right;">68.96</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">10805199999</td>
<td style="text-align: left;">BADEN OOS</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.791</td>
<td style="text-align: right;">8.187</td>
<td style="text-align: right;">20171201</td>
<td style="text-align: right;">20180522</td>
<td style="text-align: right;">77.02</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10725099999</td>
<td style="text-align: left;">BADEN-OOS</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.800</td>
<td style="text-align: right;">8.183</td>
<td style="text-align: right;">19770803</td>
<td style="text-align: right;">20020311</td>
<td style="text-align: right;">77.83</td>
<td style="text-align: right;">12.19</td>
<td style="text-align: right;">39</td>
</tr>
<tr class="even">
<td style="text-align: left;">10929099999</td>
<td style="text-align: left;">KONSTANZ</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">47.683</td>
<td style="text-align: right;">9.183</td>
<td style="text-align: right;">19360102</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">80.43</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">06671099999</td>
<td style="text-align: left;">STECKBORN</td>
<td style="text-align: left;">CH</td>
<td style="text-align: right;">47.667</td>
<td style="text-align: right;">8.983</td>
<td style="text-align: right;">20120209</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">81.75</td>
<td style="text-align: right;">8.90</td>
<td style="text-align: right;">29</td>
</tr>
<tr class="even">
<td style="text-align: left;">10727599999</td>
<td style="text-align: left;">KARLSRUHE BADEN BADEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.779</td>
<td style="text-align: right;">8.081</td>
<td style="text-align: right;">19970723</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">82.89</td>
<td style="text-align: right;">23.44</td>
<td style="text-align: right;">76</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10702099999</td>
<td style="text-align: left;">KARLSRUHE/BADEN-B</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.783</td>
<td style="text-align: right;">8.083</td>
<td style="text-align: right;">19860107</td>
<td style="text-align: right;">20010918</td>
<td style="text-align: right;">82.99</td>
<td style="text-align: right;">11.72</td>
<td style="text-align: right;">38</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p><strong><em>2. Download weather data for the most promising station on the list</em></strong></p>
<p>The most promising station in my case is the STUTTGART (airport) weather station (<code>chillR_code</code>: 10738099999), which is 34.68 km away from our location of interest.</p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb153"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Download weather data for STUTTGART</span></span>
<span><span class="va">STG_weather</span> <span class="op">&lt;-</span> <span class="fu">handle_gsod</span><span class="op">(</span>action <span class="op">=</span> <span class="st">"download_weather"</span>,</span>
<span>                           location <span class="op">=</span> <span class="va">MS_station_list</span><span class="op">$</span><span class="va">chillR_code</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>                           time_interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1990</span>, <span class="fl">2020</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Loading data for 31 years from station 'STUTTGART'
================================================================================</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb155"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Show output in table</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">STG_weather</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">STATION</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">DATE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LATITUDE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LONGITUDE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ELEVATION</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">NAME</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">TEMP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">TEMP_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">DEWP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">DEWP_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SLP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SLP_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">STP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">STP_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">VISIB</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">VISIB_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">WDSP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">WDSP_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MXSPD</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">GUST</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MAX</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">MAX_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MIN</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">MIN_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">PRCP</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">PRCP_ATTRIBUTES</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SNDP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">FRSHTT</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-01</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">23.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">22.0</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">0.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1.9</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">35.6</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">15.8</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">100000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-02</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">24.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">23.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">35.6</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">16.9</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">100000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-03</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">29.4</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">28.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">3.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">7.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">30.7</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">24.1</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-04</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">28.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">24.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">3.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">6.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">32.0</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">19.4</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-05</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">27.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">25.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">32.0</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">18.5</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">E</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">111000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-06</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">31.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">30.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2.4</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">39.2</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">26.6</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">1.2</td>
<td style="text-align: right;">1000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-07</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">29.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">27.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">36.3</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">23.0</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">0.8</td>
<td style="text-align: right;">100000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-08</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">29.0</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">27.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2.4</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">2.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">4.1</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">33.8</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">22.6</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">0.8</td>
<td style="text-align: right;">110000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-09</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">30.4</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">30.0</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">4.1</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">32.5</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">24.8</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">100000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-10</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">28.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">28.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">2.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">6.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">30.2</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">27.7</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">100000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-11</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">27.0</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">26.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">3.4</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">6.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">28.8</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">23.0</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">E</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">100000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-12</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">23.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">22.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">4.1</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">32.0</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">19.0</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">100000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-13</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">23.4</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">21.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">0.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1.9</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">34.5</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">14.0</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">100000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-14</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">24.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">23.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">2.9</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">35.6</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">15.8</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">H</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">101000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-15</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">34.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">29.0</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">4.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9.9</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">44.6</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">22.8</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">C</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">110000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-16</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">43.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">38.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7.0</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">5.3</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9.9</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">46.8</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">37.4</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">11000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-17</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">43.1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">39.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">6.4</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">11.1</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">46.4</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">35.6</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">10000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-18</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">35.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">31.5</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">2.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">8.9</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">41.0</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">26.6</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">100000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-19</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">31.0</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">26.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6.6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">2.7</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">8.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">39.6</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">23.0</td>
<td style="text-align: left;">*</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">G</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">10738099999</td>
<td style="text-align: left;">1990-01-20</td>
<td style="text-align: right;">48.68988</td>
<td style="text-align: right;">9.221964</td>
<td style="text-align: right;">388.92</td>
<td style="text-align: left;">STUTTGART, GM</td>
<td style="text-align: right;">38.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">28.9</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">9999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7.8</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">7.2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">13.0</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">43.2</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">29.8</td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">999.9</td>
<td style="text-align: right;">11000</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p><strong><em>3. Convert the weather data into <code>chillR</code> format</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb156"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Clean the dataset and convert to chillR format</span></span>
<span><span class="va">STG_cleaned_weather</span> <span class="op">&lt;-</span> <span class="fu">handle_gsod</span><span class="op">(</span><span class="va">STG_weather</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">STG_cleaned_weather</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Date</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Prec</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1990-01-01 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-9.000</td>
<td style="text-align: right;">2.000</td>
<td style="text-align: right;">-4.556</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-02 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">-8.389</td>
<td style="text-align: right;">2.000</td>
<td style="text-align: right;">-4.056</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-03 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">-4.389</td>
<td style="text-align: right;">-0.722</td>
<td style="text-align: right;">-1.444</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-04 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">-7.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">-2.056</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-05 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">-7.500</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">-2.611</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-06 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">-3.000</td>
<td style="text-align: right;">4.000</td>
<td style="text-align: right;">-0.278</td>
<td style="text-align: right;">4.826</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-07 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">-5.000</td>
<td style="text-align: right;">2.389</td>
<td style="text-align: right;">-1.167</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-08 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">-5.222</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">-1.667</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-09 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">-4.000</td>
<td style="text-align: right;">0.278</td>
<td style="text-align: right;">-0.889</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-10 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">-2.389</td>
<td style="text-align: right;">-1.000</td>
<td style="text-align: right;">-1.778</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-11 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">-5.000</td>
<td style="text-align: right;">-1.778</td>
<td style="text-align: right;">-2.778</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-12 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">-7.222</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">-4.611</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-13 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">-10.000</td>
<td style="text-align: right;">1.389</td>
<td style="text-align: right;">-4.778</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-14 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">-9.000</td>
<td style="text-align: right;">2.000</td>
<td style="text-align: right;">-4.111</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-15 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">-5.111</td>
<td style="text-align: right;">7.000</td>
<td style="text-align: right;">1.611</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-16 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">3.000</td>
<td style="text-align: right;">8.222</td>
<td style="text-align: right;">6.222</td>
<td style="text-align: right;">2.032</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-17 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">2.000</td>
<td style="text-align: right;">8.000</td>
<td style="text-align: right;">6.167</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-18 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">-3.000</td>
<td style="text-align: right;">5.000</td>
<td style="text-align: right;">1.944</td>
<td style="text-align: right;">1.778</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1990-01-19 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">-5.000</td>
<td style="text-align: right;">4.222</td>
<td style="text-align: right;">-0.556</td>
<td style="text-align: right;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990-01-20 12:00:00</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">-1.222</td>
<td style="text-align: right;">6.222</td>
<td style="text-align: right;">3.833</td>
<td style="text-align: right;">0.000</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb157"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Save the output </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="st">"data/MS"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">MS_station_list</span>,<span class="st">"data/MS/MS_station_list.csv"</span>,row.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">STG_weather</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,<span class="st">"data/MS/STG_raw_weather.csv"</span>,row.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">STG_cleaned_weather</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,<span class="st">"data/MS/STG_chillR_weather.csv"</span>,row.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section></section><section id="chapter-11-filling-gaps-in-temperature-records" class="level2"><h2 class="anchored" data-anchor-id="chapter-11-filling-gaps-in-temperature-records">Chapter 11: Filling gaps in temperature records</h2>
<section id="gaps" class="level3"><h3 class="anchored" data-anchor-id="gaps">
<span style="color:#71797E">11.1</span>&nbsp; Gaps</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>Lots of things can go wrong when recording temperature data, including malfunctioning equipment, flat batteries, power cuts or lack of maintenance. Data archiving, transmission and storage in a database presents the next hurdle.</p></li>
<li><p>Many datasets therefore have gaps— many scientific methods don’t deal very well with missing data, so we need ways of filling such gaps.</p></li>
</ul>
<p><br></p>
</section><section id="filling-short-gaps-in-daily-records" class="level3"><h3 class="anchored" data-anchor-id="filling-short-gaps-in-daily-records">
<span style="color:#71797E">11.2</span>&nbsp; Filling short gaps in daily records</h3>
<div style="height: 18px;">

</div>
<ul>
<li>
<p>Simple linear interpolation is good enough for largely complete weather records, except for isolated incidences of missing daily minimum or maximum temperatures.</p>
<ul>
<li>Take the last recorded value before a gaps and the first after the gap and compute the average</li>
<li>Also use for slightly longer gaps (e.g.&nbsp;2-3 days) or maybe a few days more, but it will be dubious</li>
</ul>
</li>
<li><p>In case gaps extend to several weeks or even months, linear interpolation, which simply connects the start and end points of the gap by a straight line, may miss important features of the local temperature dynamics.</p></li>
<li><p>In the extreme case, where we’re missing an entire year of data, such linear interpolation would miss entire seasons, producing unacceptable errors.</p></li>
<li>
<p>Other options:</p>
<ul>
<li>
<code>fix_weather()</code> function, without additional argument, linearly interpolates all gaps in the Tmin and Tmax columns</li>
<li>
<code>make_all_day_table()</code> function adds news lines for the entire days missing in the records</li>
<li>
<code>start_year</code> and <code>end_year</code> to specify the range of years to apply this procedure for; <code>start_date</code> and <code>end_date</code> in Julian days for the dates to work on; and names of the columns to work on if these are different from <code>Tmin</code> and <code>Tmax</code>
</li>
</ul>
</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb158"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># This add DATE column in R format</span></span>
<span><span class="va">weather</span> <span class="op">&lt;-</span> <span class="va">KA_weather</span> <span class="op">%&gt;%</span> <span class="fu">make_all_day_table</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Interpolate the gaps for Tmin (output: interp- numeric vector with all gaps </span></span>
<span><span class="co"># linearly interpolated and </span></span>
<span><span class="co"># missing- boolean vector, either TRUE (gap) or FALSE (no gap))</span></span>
<span><span class="va">Tmin_int</span> <span class="op">&lt;-</span> <span class="fu">interpolate_gaps</span><span class="op">(</span><span class="va">weather</span><span class="op">[</span>,<span class="st">"Tmin"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add Tmin and Tmin_interpolated to weather dataset</span></span>
<span><span class="va">weather</span> <span class="op">&lt;-</span> <span class="va">weather</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>Tmin <span class="op">=</span> <span class="va">Tmin_int</span><span class="op">$</span><span class="va">interp</span>,</span>
<span>                              Tmin_interpolated <span class="op">=</span> <span class="va">Tmin_int</span><span class="op">$</span><span class="va">missing</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Interpolate the gaps for Tmax</span></span>
<span><span class="va">Tmax_int</span> <span class="op">&lt;-</span> <span class="fu">interpolate_gaps</span><span class="op">(</span><span class="va">weather</span><span class="op">[</span>,<span class="st">"Tmax"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add Tmax and Tmax_interpolated to weather dataset</span></span>
<span><span class="va">weather</span> <span class="op">&lt;-</span> <span class="va">weather</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>Tmax <span class="op">=</span> <span class="va">Tmax_int</span><span class="op">$</span><span class="va">interp</span>,</span>
<span>                              Tmax_interpolated <span class="op">=</span> <span class="va">Tmax_int</span><span class="op">$</span><span class="va">missing</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add an extra day to the KA_weather dataset that is not connected to </span></span>
<span><span class="co"># the days that are already there.</span></span>
<span><span class="co"># this creates a large gap, which we can then interpolate</span></span>
<span><span class="va">KA_weather_gap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">KA_weather</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Year <span class="op">=</span> <span class="fl">2011</span>,</span>
<span>                                      Month <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                      Day <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                      Tmax <span class="op">=</span> <span class="fl">26</span>,</span>
<span>                                      Tmin <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># fill in the gaps between Julian date 300 (late October) and 100 (early April), </span></span>
<span><span class="co"># only returning data between 2000 and 2011</span></span>
<span><span class="va">fixed_winter_days</span> <span class="op">&lt;-</span> <span class="va">KA_weather_gap</span> <span class="op">%&gt;%</span> <span class="fu">fix_weather</span><span class="op">(</span>start_year <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>                                                    end_year <span class="op">=</span> <span class="fl">2011</span>,</span>
<span>                                                    start_date <span class="op">=</span> <span class="fl">300</span>,</span>
<span>                                                    end_date <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fill in all gaps</span></span>
<span><span class="va">fixed_all_days</span> <span class="op">&lt;-</span> <span class="va">KA_weather_gap</span> <span class="op">%&gt;%</span> <span class="fu">fix_weather</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>
<code>fix_weather()</code> function produces a list of two outputs:
<ul>
<li>
<code>weather</code>: a <code>data.frame</code> with the interpolated weather data, now including columns <code>no_Tmin</code> and <code>no_Tmax</code>, which contain <code>TRUE</code> for rows where the respective values were originally missing (<code>FALSE</code> otherwise).</li>
<li>
<code>QC</code>: a quality control object that summarizes how many values were interpolated for each season.</li>
</ul>
</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb159"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># QC elements for interpolated fixed_winter_days dataset</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">fixed_winter_days</span><span class="op">$</span><span class="va">QC</span>, </span>
<span>      caption <span class="op">=</span> </span>
<span>      <span class="st">"Table 11.2a: Quality control summary produced by fixed_weather(), with</span></span>
<span><span class="st">      only winter days interpolated"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.2a: Quality control summary produced by fixed_weather(), with only winter days interpolated</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Incomplete_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1999/2000</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">60.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">2000/2001</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">167</td>
<td style="text-align: right;">167</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2001/2002</td>
<td style="text-align: right;">2002</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2002/2003</td>
<td style="text-align: right;">2003</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2003/2004</td>
<td style="text-align: right;">2004</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2004/2005</td>
<td style="text-align: right;">2005</td>
<td style="text-align: right;">167</td>
<td style="text-align: right;">167</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2005/2006</td>
<td style="text-align: right;">2006</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2006/2007</td>
<td style="text-align: right;">2007</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2007/2008</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2008/2009</td>
<td style="text-align: right;">2009</td>
<td style="text-align: right;">167</td>
<td style="text-align: right;">167</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2009/2010</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2010/2011</td>
<td style="text-align: right;">2011</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">128</td>
<td style="text-align: right;">165</td>
<td style="text-align: right;">165</td>
<td style="text-align: right;">165</td>
<td style="text-align: right;">0.6</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb160"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># QC elements for interpolated fixed_all_days dataset</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">fixed_all_days</span><span class="op">$</span><span class="va">QC</span>,</span>
<span>      caption <span class="op">=</span> </span>
<span>      <span class="st">"Table 11.2b: Quality control summary produced by fix_weather(),</span></span>
<span><span class="st">      with all days interpolated"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.2b: Quality control summary produced by fix_weather(), with all days interpolated</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Incomplete_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1997/1998</td>
<td style="text-align: right;">1998</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1998/1999</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1999/2000</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2000/2001</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2001/2002</td>
<td style="text-align: right;">2002</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2002/2003</td>
<td style="text-align: right;">2003</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2003/2004</td>
<td style="text-align: right;">2004</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2004/2005</td>
<td style="text-align: right;">2005</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2005/2006</td>
<td style="text-align: right;">2006</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2006/2007</td>
<td style="text-align: right;">2007</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2007/2008</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2008/2009</td>
<td style="text-align: right;">2009</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2009/2010</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">214</td>
<td style="text-align: right;">214</td>
<td style="text-align: right;">214</td>
<td style="text-align: right;">41.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">2010/2011</td>
<td style="text-align: right;">2011</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">62</td>
<td style="text-align: right;">364</td>
<td style="text-align: right;">364</td>
<td style="text-align: right;">364</td>
<td style="text-align: right;">0.3</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>Linear interpolation is usually acceptable for short gaps in the records, but it gets increasingly less convincing, when the gaps are longer. Here’s a quick demonstration of this:</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb161"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create gap_weather dataset with rows 200:305 of KA_weather dataset</span></span>
<span><span class="va">gap_weather</span> <span class="op">&lt;-</span> <span class="va">KA_weather</span><span class="op">[</span><span class="fl">200</span><span class="op">:</span><span class="fl">305</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Add a new Tmin_observed column which copies Tmin values</span></span>
<span><span class="va">gap_weather</span><span class="op">[</span>,<span class="st">"Tmin_observed"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">gap_weather</span><span class="op">$</span><span class="va">Tmin</span></span>
<span></span>
<span><span class="co"># Replace with NA for Tmin values in selected rows (Create gaps)</span></span>
<span><span class="va">gap_weather</span><span class="op">$</span><span class="va">Tmin</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">9</span>,<span class="fl">11</span><span class="op">:</span><span class="fl">14</span>,<span class="fl">16</span><span class="op">:</span><span class="fl">20</span>,<span class="fl">22</span><span class="op">:</span><span class="fl">27</span>,<span class="fl">29</span><span class="op">:</span><span class="fl">35</span>,</span>
<span>                   <span class="fl">37</span><span class="op">:</span><span class="fl">44</span>,<span class="fl">46</span><span class="op">:</span><span class="fl">54</span>,<span class="fl">56</span><span class="op">:</span><span class="fl">65</span>,<span class="fl">67</span><span class="op">:</span><span class="fl">77</span>,<span class="fl">79</span><span class="op">:</span><span class="fl">90</span>,<span class="fl">92</span><span class="op">:</span><span class="fl">104</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="co"># Interpolate the gaps with fix_weather function</span></span>
<span><span class="va">fixed_gaps</span> <span class="op">&lt;-</span> <span class="fu">fix_weather</span><span class="op">(</span><span class="va">gap_weather</span><span class="op">)</span><span class="op">$</span><span class="va">weather</span> <span class="co"># only select weather output</span></span>
<span></span>
<span><span class="co"># Plot the result</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">fixed_gaps</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">DATE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">Tmin_observed</span>, color <span class="op">=</span> <span class="st">"Tmin Observed"</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">Tmin</span>, color <span class="op">=</span> <span class="st">"Tmin Interpolated"</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tmin Observed"</span> <span class="op">=</span> <span class="st">"black"</span>, <span class="st">"Tmin Interpolated"</span> <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Legend"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Daily minimum temperature (°C)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/11.2b-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb162"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calculate absolute difference between Tmin_iterpolated and Tmin_observed</span></span>
<span><span class="va">fixed_gaps</span><span class="op">[</span>,<span class="st">"error"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">fixed_gaps</span><span class="op">$</span><span class="va">Tmin</span> <span class="op">-</span> <span class="va">fixed_gaps</span><span class="op">$</span><span class="va">Tmin_observed</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data<span class="op">=</span><span class="va">fixed_gaps</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span><span class="va">DATE</span>,<span class="va">error</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>lwd<span class="op">=</span><span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Error introduced by interpolation (°C)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Show in cex=3 size dots the dates where observed Tmin is available</span></span>
<span>  <span class="co"># Only include rows where no_Tmin is FALSE</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>data<span class="op">=</span><span class="va">fixed_gaps</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">fixed_gaps</span><span class="op">$</span><span class="va">no_Tmin</span><span class="op">)</span>,<span class="op">]</span>,</span>
<span>             <span class="fu">aes</span><span class="op">(</span><span class="va">DATE</span>,<span class="va">error</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"red"</span>,cex<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/11.2c-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb163"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Gaps of length == 1 only on the left, and gaps of length == 13 on the right -</span></span>
<span><span class="co"># temperature dynamics are captured quite well on the left, but </span></span>
<span><span class="co"># no longer very well on the right. </span></span>
<span></span>
<span><span class="co"># How big the errors get obviously depends on the nature of the dataset - </span></span>
<span><span class="co"># was there a lot of variation during the period of interest, or not? </span></span>
<span><span class="co"># Yet we see a tendency here of errors getting bigger and bigger with </span></span>
<span><span class="co"># increasing gap sizes. Of course for the non-gap points (shown in red in </span></span>
<span><span class="co"># the plot), the error is zero, but especially in the middle of the larger gaps, </span></span>
<span><span class="co"># we can be quite far off from what actually happened.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section><section id="filling-long-gaps-in-daily-records" class="level3"><h3 class="anchored" data-anchor-id="filling-long-gaps-in-daily-records">
<span style="color:#71797E">11.3</span>&nbsp; Filling long gaps in daily records</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>For longer gaps, we can experiment with more complex interpolation algorithms, or try to look for additional data— find another weather station that is close enough to be in a climatically comparable setting and use the data from there to fill gaps for the site of interest.</p></li>
<li>
<p>This may work ok, if the auxiliary station is in a very similar climatic setting, but it will already introduce an error if we’re dealing with some elevation differences, or with other landscape features that have climatic effects (e.g.&nbsp;lakes, sea, forest).</p>
<ul>
<li>Such features, as well as topography, can modulate temperatures at a particular place in a way that makes them poor proxies of temperatures in another location.</li>
</ul>
</li>
</ul>
<ul>
<li>
<code>patch_weather()</code> function can fill gaps in a weather record based on a list of weather datasets from auxiliary stations.
<ul>
<li>The function can also test for (some) biases, correct data for bias in mean temperatures, and use the result to fill gaps in the record for the location of interest.</li>
</ul>
</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb164"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fill gaps in dataset for Bonn that was downloaded in Ch. 10</span></span>
<span><span class="va">Bonn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/Bonn/Bonn_chillR_weather.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check the quality control summary with fix_weather()</span></span>
<span><span class="va">Bonn_QC</span> <span class="op">&lt;-</span> <span class="fu">fix_weather</span><span class="op">(</span><span class="va">Bonn</span><span class="op">)</span><span class="op">$</span><span class="va">QC</span></span>
<span></span>
<span><span class="co"># Display the QC summary</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">Bonn_QC</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Table 11.3a: Quality control summary produced by fix_weather()"</span>,<span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.3a: Quality control summary produced by fix_weather()</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Incomplete_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1989/1990</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990/1991</td>
<td style="text-align: right;">1991</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1991/1992</td>
<td style="text-align: right;">1992</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1992/1993</td>
<td style="text-align: right;">1993</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1993/1994</td>
<td style="text-align: right;">1994</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1994/1995</td>
<td style="text-align: right;">1995</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1995/1996</td>
<td style="text-align: right;">1996</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1996/1997</td>
<td style="text-align: right;">1997</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1997/1998</td>
<td style="text-align: right;">1998</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">98.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">1998/1999</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1999/2000</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2000/2001</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2001/2002</td>
<td style="text-align: right;">2002</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2002/2003</td>
<td style="text-align: right;">2003</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">316</td>
<td style="text-align: right;">316</td>
<td style="text-align: right;">316</td>
<td style="text-align: right;">13.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2003/2004</td>
<td style="text-align: right;">2004</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2004/2005</td>
<td style="text-align: right;">2005</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2005/2006</td>
<td style="text-align: right;">2006</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2006/2007</td>
<td style="text-align: right;">2007</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2007/2008</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2008/2009</td>
<td style="text-align: right;">2009</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2009/2010</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2010/2011</td>
<td style="text-align: right;">2011</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2011/2012</td>
<td style="text-align: right;">2012</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2012/2013</td>
<td style="text-align: right;">2013</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2013/2014</td>
<td style="text-align: right;">2014</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2014/2015</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2015/2016</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2016/2017</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2017/2018</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2018/2019</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2019/2020</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li><p>The dataset has substantial gaps between 1998 and 2004 and in 2008 (almost all values missing), and some shorter gaps in 2015, 2018 and 2020.</p></li>
<li><p>We will use data from neighbouring weather stations to patch the dataset.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb165"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Find nearby weather stations using handle_gsod()</span></span>
<span><span class="va">station_list</span> <span class="op">&lt;-</span> <span class="fu">handle_gsod</span><span class="op">(</span>action <span class="op">=</span> <span class="st">"list_stations"</span>,</span>
<span>                            location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7.10</span>, <span class="fl">50.73</span><span class="op">)</span>,</span>
<span>                            time_interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1990</span>, <span class="fl">2020</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">station_list</span>,</span>
<span>      caption <span class="op">=</span> <span class="st">"Table 11.3b: List of GSOD weather stations close to Bonn"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.3b: List of GSOD weather stations close to Bonn</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">chillR_code</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">STATION.NAME</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">CTRY</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Lat</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Long</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BEGIN</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">END</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Distance</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Overlap_years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_interval_covered</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">10517099999</td>
<td style="text-align: left;">BONN/FRIESDORF(AUT)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.700</td>
<td style="text-align: right;">7.150</td>
<td style="text-align: right;">19360102</td>
<td style="text-align: right;">19921231</td>
<td style="text-align: right;">4.86</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">10518099999</td>
<td style="text-align: left;">BONN-HARDTHOEHE</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.700</td>
<td style="text-align: right;">7.033</td>
<td style="text-align: right;">19750523</td>
<td style="text-align: right;">19971223</td>
<td style="text-align: right;">5.78</td>
<td style="text-align: right;">7.98</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10519099999</td>
<td style="text-align: left;">BONN-ROLEBER</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.733</td>
<td style="text-align: right;">7.200</td>
<td style="text-align: right;">20010705</td>
<td style="text-align: right;">20081231</td>
<td style="text-align: right;">7.05</td>
<td style="text-align: right;">7.49</td>
<td style="text-align: right;">24</td>
</tr>
<tr class="even">
<td style="text-align: left;">10513099999</td>
<td style="text-align: left;">KOLN BONN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.866</td>
<td style="text-align: right;">7.143</td>
<td style="text-align: right;">19310101</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">15.44</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10509099999</td>
<td style="text-align: left;">BUTZWEILERHOF(BAFB)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.983</td>
<td style="text-align: right;">6.900</td>
<td style="text-align: right;">19780901</td>
<td style="text-align: right;">19950823</td>
<td style="text-align: right;">31.48</td>
<td style="text-align: right;">5.64</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="even">
<td style="text-align: left;">10502099999</td>
<td style="text-align: left;">NORVENICH</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.831</td>
<td style="text-align: right;">6.658</td>
<td style="text-align: right;">19730101</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">33.08</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10514099999</td>
<td style="text-align: left;">MENDIG</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.366</td>
<td style="text-align: right;">7.315</td>
<td style="text-align: right;">19730102</td>
<td style="text-align: right;">19971231</td>
<td style="text-align: right;">43.28</td>
<td style="text-align: right;">8.00</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: left;">10506099999</td>
<td style="text-align: left;">NUERBURG-BARWEILER</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.367</td>
<td style="text-align: right;">6.867</td>
<td style="text-align: right;">19950401</td>
<td style="text-align: right;">19971231</td>
<td style="text-align: right;">43.64</td>
<td style="text-align: right;">2.75</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10508099999</td>
<td style="text-align: left;">BLANKENHEIM</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.450</td>
<td style="text-align: right;">6.650</td>
<td style="text-align: right;">19781002</td>
<td style="text-align: right;">19840504</td>
<td style="text-align: right;">44.53</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">10510099999</td>
<td style="text-align: left;">NUERBURG</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.333</td>
<td style="text-align: right;">6.950</td>
<td style="text-align: right;">19300901</td>
<td style="text-align: right;">19921231</td>
<td style="text-align: right;">45.45</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10515099999</td>
<td style="text-align: left;">BENDORF</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.417</td>
<td style="text-align: right;">7.583</td>
<td style="text-align: right;">19310102</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">48.79</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="even">
<td style="text-align: left;">10504099999</td>
<td style="text-align: left;">EIFEL</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.650</td>
<td style="text-align: right;">6.283</td>
<td style="text-align: right;">20040501</td>
<td style="text-align: right;">20040501</td>
<td style="text-align: right;">58.30</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10526099999</td>
<td style="text-align: left;">BAD MARIENBERG</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.667</td>
<td style="text-align: right;">7.967</td>
<td style="text-align: right;">19730101</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">61.54</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="even">
<td style="text-align: left;">10613099999</td>
<td style="text-align: left;">BUCHEL</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.174</td>
<td style="text-align: right;">7.063</td>
<td style="text-align: right;">19730101</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">61.95</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10503099999</td>
<td style="text-align: left;">AACHEN/MERZBRUCK</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.817</td>
<td style="text-align: right;">6.183</td>
<td style="text-align: right;">19780901</td>
<td style="text-align: right;">19971212</td>
<td style="text-align: right;">65.28</td>
<td style="text-align: right;">7.95</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="even">
<td style="text-align: left;">10419099999</td>
<td style="text-align: left;">LUDENSCHEID &amp;</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">51.233</td>
<td style="text-align: right;">7.600</td>
<td style="text-align: right;">19270906</td>
<td style="text-align: right;">20030306</td>
<td style="text-align: right;">66.06</td>
<td style="text-align: right;">13.18</td>
<td style="text-align: right;">43</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10400099999</td>
<td style="text-align: left;">DUSSELDORF</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">51.289</td>
<td style="text-align: right;">6.767</td>
<td style="text-align: right;">19310102</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">66.46</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">10616299999</td>
<td style="text-align: left;">SIEGERLAND</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.708</td>
<td style="text-align: right;">8.083</td>
<td style="text-align: right;">20040510</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">69.33</td>
<td style="text-align: right;">16.65</td>
<td style="text-align: right;">54</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10418099999</td>
<td style="text-align: left;">LUEDENSCHEID</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">51.250</td>
<td style="text-align: right;">7.650</td>
<td style="text-align: right;">19940301</td>
<td style="text-align: right;">19971231</td>
<td style="text-align: right;">69.54</td>
<td style="text-align: right;">3.84</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="even">
<td style="text-align: left;">10437499999</td>
<td style="text-align: left;">MONCHENGLADBACH</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">51.230</td>
<td style="text-align: right;">6.504</td>
<td style="text-align: right;">19960715</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">69.59</td>
<td style="text-align: right;">24.47</td>
<td style="text-align: right;">79</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10403099999</td>
<td style="text-align: left;">MOENCHENGLADBACH</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">51.233</td>
<td style="text-align: right;">6.500</td>
<td style="text-align: right;">19381001</td>
<td style="text-align: right;">19421031</td>
<td style="text-align: right;">70.03</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">10501099999</td>
<td style="text-align: left;">AACHEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">50.783</td>
<td style="text-align: right;">6.100</td>
<td style="text-align: right;">19280101</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">70.67</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">06496099999</td>
<td style="text-align: left;">ELSENBORN (MIL)</td>
<td style="text-align: left;">BE</td>
<td style="text-align: right;">50.467</td>
<td style="text-align: right;">6.183</td>
<td style="text-align: right;">19840501</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">71.10</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">06495099999</td>
<td style="text-align: left;">BOTRANGE (MOUNT)</td>
<td style="text-align: left;">BE</td>
<td style="text-align: right;">50.500</td>
<td style="text-align: right;">6.100</td>
<td style="text-align: right;">19510201</td>
<td style="text-align: right;">20011015</td>
<td style="text-align: right;">75.13</td>
<td style="text-align: right;">11.79</td>
<td style="text-align: right;">38</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10409099999</td>
<td style="text-align: left;">ESSEN/MUELHEIM</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">51.400</td>
<td style="text-align: right;">6.967</td>
<td style="text-align: right;">19300414</td>
<td style="text-align: right;">19431231</td>
<td style="text-align: right;">75.17</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li><p>Many of these stations are not very useful because they only overlap with the record we already have for a few years, in some cases not at all.</p></li>
<li><p>Maybe we can combine data from multiple auxiliary stations to close all the gaps.</p></li>
<li><p>Stations that look promising are BONN-HARDTHOEHE, BONN-ROLEBER, and NORVENICH.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb166"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Download data for promising stations (position 2, 3, 6 in station_list) </span></span>
<span><span class="co"># and store them in a list.</span></span>
<span></span>
<span><span class="co"># The handle_gsod function can download multiple files at ones, returning </span></span>
<span><span class="co"># a named list of station records.</span></span>
<span><span class="va">patch_weather</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">handle_gsod</span><span class="op">(</span>action <span class="op">=</span> <span class="st">"download_weather"</span>,</span>
<span>              location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">station_list</span><span class="op">$</span><span class="va">chillR_code</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">6</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>              time_interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1990</span>, <span class="fl">2020</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">handle_gsod</span><span class="op">(</span><span class="op">)</span> <span class="co"># clean the downloaded data ?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Loading data for 31 years from station 'NORVENICH'
================================================================================

Loading data for 31 years from station 'BONN-HARDTHOEHE'
================================================================================

Loading data for 31 years from station 'BONN-ROLEBER'
================================================================================</code></pre>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb168"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use the list of dowloaded weather records to fill gaps in record for Bonn</span></span>
<span><span class="va">patched</span> <span class="op">&lt;-</span> <span class="fu">patch_daily_temperatures</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">Bonn</span>,</span>
<span>                                    patch_weather <span class="op">=</span> <span class="va">patch_weather</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Look at what happened by looking at `statistics` of the `patched` object</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">patched</span><span class="op">$</span><span class="va">statistics</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, </span>
<span>      caption <span class="op">=</span> <span class="st">"Table 11.3c: Patch statistics for NORVENICH"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.3c: Patch statistics for NORVENICH</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stdev_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">filled</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">gaps_remain</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Tmin</td>
<td style="text-align: right;">-0.307</td>
<td style="text-align: right;">1.304</td>
<td style="text-align: right;">2146</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tmax</td>
<td style="text-align: right;">0.202</td>
<td style="text-align: right;">1.154</td>
<td style="text-align: right;">2146</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb169"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">kable</span><span class="op">(</span><span class="va">patched</span><span class="op">$</span><span class="va">statistics</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, </span>
<span>      caption <span class="op">=</span> <span class="st">"Table 11.3d: Patch statistics for BONN-HARDTHOEHE"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.3d: Patch statistics for BONN-HARDTHOEHE</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stdev_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">filled</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">gaps_remain</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Tmin</td>
<td style="text-align: right;">-1.871</td>
<td style="text-align: right;">2.080</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tmax</td>
<td style="text-align: right;">1.466</td>
<td style="text-align: right;">1.427</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb170"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">kable</span><span class="op">(</span><span class="va">patched</span><span class="op">$</span><span class="va">statistics</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, </span>
<span>      caption <span class="op">=</span> <span class="st">"Table 11.3e: Patch statistics for BONN-ROLEBER"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.3e: Patch statistics for BONN-ROLEBER</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stdev_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">filled</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">gaps_remain</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Tmin</td>
<td style="text-align: right;">-0.546</td>
<td style="text-align: right;">1.186</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tmax</td>
<td style="text-align: right;">1.314</td>
<td style="text-align: right;">1.089</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li><p>Here we see an analysis of how similar the temperature records (separately for Tmin and Tmax) were between each auxiliary station and our station of interest in Bonn, based on days for which both stations had data.</p></li>
<li>
<p>Besides the number of days for which information was taken from each auxiliary station (<code>filled</code>) and the number of gaps that remained afterwards (<code>gaps_remain</code>), we see two quality statistics:</p>
<ul>
<li>the mean bias (<code>mean_bias</code>), i.e.&nbsp;the mean temperature difference— easy to address by setting threshold</li>
<li>the standard deviation of the daily differences (<code>stdev_bias</code>)— more problematic as this indicates the extent of additional (possibly unsystematic) differences between stations (not sure this can be adjusted or not); so for now we should treat this as an exclusion criterion (i.e.&nbsp;if stdev_bias is above a certain value, we reject the station)</li>
</ul>
</li>
</ul>
<ul>
<li><p>Let’s set some limits for both metrics, which we can pass as arguments to <code>patch_daily_temperatures()</code> (using the max_mean_bias and max_stdev_bias parameters).</p></li>
<li><p>Let’s cap the <code>mean_bias</code> at 1 °C and the <code>stdev_bias</code> at 2°C, and then look at the statistics again.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb171"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">patched</span> <span class="op">&lt;-</span> <span class="fu">patch_daily_temperatures</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">Bonn</span>,</span>
<span>                                    patch_weather <span class="op">=</span> <span class="va">patch_weather</span>,</span>
<span>                                    max_mean_bias <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                    max_stdev_bias <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">patched</span><span class="op">$</span><span class="va">statistics</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, </span>
<span>      caption <span class="op">=</span> <span class="st">"Table 11.3f: Patch statistics for NORVENICH"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.3f: Patch statistics for NORVENICH</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stdev_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">filled</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">gaps_remain</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Tmin</td>
<td style="text-align: right;">-0.307</td>
<td style="text-align: right;">1.304</td>
<td style="text-align: right;">2146</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tmax</td>
<td style="text-align: right;">0.202</td>
<td style="text-align: right;">1.154</td>
<td style="text-align: right;">2146</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb172"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">kable</span><span class="op">(</span><span class="va">patched</span><span class="op">$</span><span class="va">statistics</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, </span>
<span>      caption <span class="op">=</span> <span class="st">"Table 11.3g: Patch statistics for BONN-HARDTHOEHE"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.3g: Patch statistics for BONN-HARDTHOEHE</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stdev_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">filled</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">gaps_remain</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Tmin</td>
<td style="text-align: right;">-1.871</td>
<td style="text-align: right;">2.080</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tmax</td>
<td style="text-align: right;">1.466</td>
<td style="text-align: right;">1.427</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb173"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">kable</span><span class="op">(</span><span class="va">patched</span><span class="op">$</span><span class="va">statistics</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, </span>
<span>      caption <span class="op">=</span> <span class="st">"Table 11.3h: Patch statistics for BONN-ROLEBER"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.3h: Patch statistics for BONN-ROLEBER</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stdev_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">filled</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">gaps_remain</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Tmin</td>
<td style="text-align: right;">-0.546</td>
<td style="text-align: right;">1.186</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tmax</td>
<td style="text-align: right;">1.314</td>
<td style="text-align: right;">1.089</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li><p>All records from BONN-HARDTHOEHE, as well as the <code>Tmax</code> records from BONN-ROLEBER were rejected, because they didn’t pass the <code>mean_bias</code> filter.</p></li>
<li><p>Data from NORVENICH are pretty good— fill 2146 gaps for <code>Tmin</code> and 2146 for <code>Tmax</code>. Only 1 and 1 gaps remain for Tmin and Tmax, respectively.</p></li>
<li><p>Use <code>fix_weather()</code> function to take a look at where the remaining gaps are:</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb174"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">post_patch_stats</span> <span class="op">&lt;-</span> <span class="fu">fix_weather</span><span class="op">(</span><span class="va">patched</span><span class="op">)</span><span class="op">$</span><span class="va">QC</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">post_patch_stats</span>, </span>
<span>      caption <span class="op">=</span> <span class="st">"Table 11.3i: Data completeness table for the weather record </span></span>
<span><span class="st">      from Bonn, after applying the patch procedure"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.3i: Data completeness table for the weather record from Bonn, after applying the patch procedure</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Incomplete_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1989/1990</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990/1991</td>
<td style="text-align: right;">1991</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1991/1992</td>
<td style="text-align: right;">1992</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1992/1993</td>
<td style="text-align: right;">1993</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1993/1994</td>
<td style="text-align: right;">1994</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1994/1995</td>
<td style="text-align: right;">1995</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1995/1996</td>
<td style="text-align: right;">1996</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1996/1997</td>
<td style="text-align: right;">1997</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1997/1998</td>
<td style="text-align: right;">1998</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1998/1999</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">99.7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1999/2000</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2000/2001</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2001/2002</td>
<td style="text-align: right;">2002</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2002/2003</td>
<td style="text-align: right;">2003</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2003/2004</td>
<td style="text-align: right;">2004</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2004/2005</td>
<td style="text-align: right;">2005</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2005/2006</td>
<td style="text-align: right;">2006</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2006/2007</td>
<td style="text-align: right;">2007</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2007/2008</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2008/2009</td>
<td style="text-align: right;">2009</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2009/2010</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2010/2011</td>
<td style="text-align: right;">2011</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2011/2012</td>
<td style="text-align: right;">2012</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2012/2013</td>
<td style="text-align: right;">2013</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2013/2014</td>
<td style="text-align: right;">2014</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2014/2015</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2015/2016</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2016/2017</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2017/2018</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2018/2019</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2019/2020</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>Almost all gaps are filled, with only data for 1 day missing after the patching. It seems safe to use linear interpolation for such a short gap, by applying the <code>fix_weather()</code> function.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb175"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Linear interpoloation to fix a short gap of one day</span></span>
<span><span class="va">Bonn_weather</span> <span class="op">&lt;-</span> <span class="fu">fix_weather</span><span class="op">(</span><span class="va">patched</span><span class="op">)</span></span>
<span></span>
<span><span class="va">post_patch_stats_2</span> <span class="op">&lt;-</span> <span class="fu">fix_weather</span><span class="op">(</span><span class="va">Bonn_weather</span><span class="op">)</span><span class="op">$</span><span class="va">QC</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">post_patch_stats_2</span>, </span>
<span>      caption <span class="op">=</span> <span class="st">"Table 11.3j: Data completeness table for the weather record </span></span>
<span><span class="st">      from Bonn, after applying the linear interpolation"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.3j: Data completeness table for the weather record from Bonn, after applying the linear interpolation</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Incomplete_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1989/1990</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990/1991</td>
<td style="text-align: right;">1991</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1991/1992</td>
<td style="text-align: right;">1992</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">1992/1993</td>
<td style="text-align: right;">1993</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1993/1994</td>
<td style="text-align: right;">1994</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">1994/1995</td>
<td style="text-align: right;">1995</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1995/1996</td>
<td style="text-align: right;">1996</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">1996/1997</td>
<td style="text-align: right;">1997</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1997/1998</td>
<td style="text-align: right;">1998</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">1998/1999</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1999/2000</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">2000/2001</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2001/2002</td>
<td style="text-align: right;">2002</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">2002/2003</td>
<td style="text-align: right;">2003</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2003/2004</td>
<td style="text-align: right;">2004</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">2004/2005</td>
<td style="text-align: right;">2005</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2005/2006</td>
<td style="text-align: right;">2006</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">2006/2007</td>
<td style="text-align: right;">2007</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2007/2008</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">2008/2009</td>
<td style="text-align: right;">2009</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2009/2010</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">2010/2011</td>
<td style="text-align: right;">2011</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2011/2012</td>
<td style="text-align: right;">2012</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">2012/2013</td>
<td style="text-align: right;">2013</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2013/2014</td>
<td style="text-align: right;">2014</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">2014/2015</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2015/2016</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">2016/2017</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2017/2018</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">2018/2019</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2019/2020</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<section id="bias-correction-for-shorter-intervals" class="level4"><h4 class="anchored" data-anchor-id="bias-correction-for-shorter-intervals">
<span style="color:#71797E">11.3.1</span>&nbsp; Bias-correction for shorter intervals</h4>
<div style="height: 18px;">

</div>
<ul>
<li>In the <code>patch_daily_temperatures</code> function, the bias correction is based on the average difference between the temperatures of a pair of weather stations over the entire year.
<ul>
<li>The between-station bias can varies throughout the year.</li>
<li>A particular station is useful data source for temperatures in certain seasons but not in others.</li>
<li>So, different bias corrections during different parts of the year give better approximations (smaller biases) than the bias correction for the entire year— use <code>patch_daily_temps</code> (not <code>patch_daily_temperatures</code>)</li>
</ul>
</li>
</ul>
<ul>
<li><p>The <code>patch_daily_temps</code> function, as a default, evaluates temperature records on a monthly basis, i.e.&nbsp;it makes separate between-station comparisons for the temperatures of each calendar month.</p></li>
<li><p>It can then take separate decisions on whether a potential auxiliary station is a useful proxy for temperatures in this monthly interval, and it can apply month-specific bias correction.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb176"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">patched_monthly</span> <span class="op">&lt;-</span> <span class="fu">patch_daily_temps</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">Bonn</span>,</span>
<span>                                     patch_weather <span class="op">=</span> <span class="va">patch_weather</span>,</span>
<span>                                     max_mean_bias <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                     max_stdev_bias <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                     time_interval <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Finding for minimum temperatures for the NORVENICH station</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">patched_monthly</span><span class="op">$</span><span class="va">statistics</span><span class="op">$</span><span class="va">Tmin</span><span class="op">$</span><span class="va">NORVENICH</span>,</span>
<span>      caption <span class="op">=</span> <span class="st">"Table 11.3.1a: Bias analysis table for the first station in the</span></span>
<span><span class="st">      proxy station list, showing biases on a monthly level"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.3.1a: Bias analysis table for the first station in the proxy station list, showing biases on a monthly level</caption>
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Interval</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Total_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Overlap_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mean_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Stdev_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Gaps_before</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Filled</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Gaps_remain</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">961</td>
<td style="text-align: right;">773</td>
<td style="text-align: right;">0.184</td>
<td style="text-align: right;">1.260</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">185</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">961</td>
<td style="text-align: right;">774</td>
<td style="text-align: right;">0.281</td>
<td style="text-align: right;">1.242</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">876</td>
<td style="text-align: right;">706</td>
<td style="text-align: right;">0.269</td>
<td style="text-align: right;">1.248</td>
<td style="text-align: right;">170</td>
<td style="text-align: right;">170</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">961</td>
<td style="text-align: right;">775</td>
<td style="text-align: right;">0.253</td>
<td style="text-align: right;">1.427</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">930</td>
<td style="text-align: right;">758</td>
<td style="text-align: right;">0.509</td>
<td style="text-align: right;">1.431</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">961</td>
<td style="text-align: right;">801</td>
<td style="text-align: right;">0.373</td>
<td style="text-align: right;">1.238</td>
<td style="text-align: right;">158</td>
<td style="text-align: right;">158</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">930</td>
<td style="text-align: right;">749</td>
<td style="text-align: right;">0.396</td>
<td style="text-align: right;">1.210</td>
<td style="text-align: right;">180</td>
<td style="text-align: right;">180</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">961</td>
<td style="text-align: right;">781</td>
<td style="text-align: right;">0.480</td>
<td style="text-align: right;">1.305</td>
<td style="text-align: right;">179</td>
<td style="text-align: right;">179</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: right;">961</td>
<td style="text-align: right;">774</td>
<td style="text-align: right;">0.529</td>
<td style="text-align: right;">1.302</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: right;">930</td>
<td style="text-align: right;">750</td>
<td style="text-align: right;">0.205</td>
<td style="text-align: right;">1.264</td>
<td style="text-align: right;">180</td>
<td style="text-align: right;">180</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11</td>
<td style="text-align: right;">961</td>
<td style="text-align: right;">775</td>
<td style="text-align: right;">0.098</td>
<td style="text-align: right;">1.307</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">186</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">12</td>
<td style="text-align: right;">930</td>
<td style="text-align: right;">745</td>
<td style="text-align: right;">0.101</td>
<td style="text-align: right;">1.308</td>
<td style="text-align: right;">184</td>
<td style="text-align: right;">184</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb177"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># The mean bias really varies quite a bit here- probably benefit from a </span></span>
<span><span class="co"># month-specific bias correction. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li><p>The <code>time_interval</code> parameter of the <code>patch_daily_temps</code> function allows us to specify the interval, i.e.&nbsp;either month or week or multiple of these, such as <code>10 days</code> or <code>2 weeks</code>.</p></li>
<li><p>Note that the function starts counting these intervals on 1<sup>st</sup> January in each year— lead to intervals at the end of the year that are smaller than the interval you selected <strong><em>(this generates warnings, as you can see below).</em></strong></p></li>
<li><p>Note also that the smaller these intervals get, the less data can be used for determining the bias. Especially for short time series, a very short interval may therefore not be desirable.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb178"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Warning for very short interval (shorter than specified)</span></span>
<span><span class="va">patch_2weeks</span> <span class="op">&lt;-</span> <span class="fu">patch_daily_temps</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">Bonn</span>,</span>
<span>                                  patch_weather <span class="op">=</span> <span class="va">patch_weather</span>,</span>
<span>                                  max_mean_bias <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                  max_stdev_bias <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                  time_interval <span class="op">=</span> <span class="st">"2 weeks"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Warning in patch_daily_temps(weather = Bonn, patch_weather = patch_weather, :
The number of days in the last interval is often a lot smaller than in other
intervals. Consider changing the time interval.
Warning in patch_daily_temps(weather = Bonn, patch_weather = patch_weather, :
The number of days in the last interval is often a lot smaller than in other
intervals. Consider changing the time interval.
Warning in patch_daily_temps(weather = Bonn, patch_weather = patch_weather, :
The number of days in the last interval is often a lot smaller than in other
intervals. Consider changing the time interval.</code></pre>
</div>
</div>
<ul>
<li>To illustrate the effects of this, let’s create 5000 gaps in the Bonn weather record and fill them with proxy data using annual, monthly and bi-weekly intervals for the bias evaluation.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb180"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Gaps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">Bonn</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">5000</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># no duplicate indices</span></span>
<span></span>
<span><span class="va">Bonn_gaps</span> <span class="op">&lt;-</span> <span class="va">Bonn</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>obs_Tmin <span class="op">=</span> <span class="va">Tmin</span>,</span>
<span>                             obs_Tmax <span class="op">=</span> <span class="va">Tmax</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmin</span><span class="op">[</span><span class="va">Gaps</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmax</span><span class="op">[</span><span class="va">Gaps</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="va">patch_annual</span> <span class="op">&lt;-</span> <span class="fu">patch_daily_temps</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">Bonn_gaps</span>,</span>
<span>                                  patch_weather <span class="op">=</span> <span class="va">patch_weather</span>,</span>
<span>                                  max_mean_bias <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                  max_stdev_bias <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                  time_interval <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">patch_month</span> <span class="op">&lt;-</span> <span class="fu">patch_daily_temps</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">Bonn_gaps</span>,</span>
<span>                                 patch_weather <span class="op">=</span> <span class="va">patch_weather</span>,</span>
<span>                                 max_mean_bias <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                 max_stdev_bias <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                 time_interval <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">patch_2weeks</span> <span class="op">&lt;-</span> <span class="fu">patch_daily_temps</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">Bonn_gaps</span>,</span>
<span>                                  patch_weather <span class="op">=</span> <span class="va">patch_weather</span>,</span>
<span>                                  max_mean_bias <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                  max_stdev_bias <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                  time_interval <span class="op">=</span> <span class="st">"2 weeks"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add new column values of difference between observed and patched values</span></span>
<span><span class="va">Bonn_gaps</span><span class="op">[</span>,<span class="st">"Tmin_annual"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">obs_Tmin</span> <span class="op">-</span> <span class="va">patch_annual</span><span class="op">$</span><span class="va">weather</span><span class="op">$</span><span class="va">Tmin</span></span>
<span><span class="va">Bonn_gaps</span><span class="op">[</span>,<span class="st">"Tmax_annual"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">obs_Tmax</span> <span class="op">-</span> <span class="va">patch_annual</span><span class="op">$</span><span class="va">weather</span><span class="op">$</span><span class="va">Tmax</span></span>
<span><span class="va">Bonn_gaps</span><span class="op">[</span>,<span class="st">"Tmin_month"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">obs_Tmin</span> <span class="op">-</span> <span class="va">patch_month</span><span class="op">$</span><span class="va">weather</span><span class="op">$</span><span class="va">Tmin</span></span>
<span><span class="va">Bonn_gaps</span><span class="op">[</span>,<span class="st">"Tmax_month"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">obs_Tmax</span> <span class="op">-</span> <span class="va">patch_month</span><span class="op">$</span><span class="va">weather</span><span class="op">$</span><span class="va">Tmax</span></span>
<span><span class="va">Bonn_gaps</span><span class="op">[</span>,<span class="st">"Tmin_2weeks"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">obs_Tmin</span> <span class="op">-</span> <span class="va">patch_2weeks</span><span class="op">$</span><span class="va">weather</span><span class="op">$</span><span class="va">Tmin</span></span>
<span><span class="va">Bonn_gaps</span><span class="op">[</span>,<span class="st">"Tmax_2weeks"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">obs_Tmax</span> <span class="op">-</span> <span class="va">patch_2weeks</span><span class="op">$</span><span class="va">weather</span><span class="op">$</span><span class="va">Tmax</span></span>
<span></span>
<span><span class="co"># Modify data for ggplotting</span></span>
<span><span class="va">Interval_eval</span> <span class="op">&lt;-</span> <span class="va">Bonn_gaps</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Tmin</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># only choose when Tmin is NA</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="va">Tmin_annual</span><span class="op">:</span><span class="va">Tmax_2weeks</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># stack columns into rows under name</span></span>
<span>    <span class="co"># create a new Type column as a factor to have specific order for plotting,</span></span>
<span>    <span class="co"># rather than default alphabetical sorting</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>Type<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">name</span>,</span>
<span>                     levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tmin_annual"</span>,</span>
<span>                                <span class="st">"Tmin_month"</span>,</span>
<span>                                <span class="st">"Tmin_2weeks"</span>,</span>
<span>                                <span class="st">"Tmax_annual"</span>,</span>
<span>                                <span class="st">"Tmax_month"</span>,</span>
<span>                                <span class="st">"Tmax_2weeks"</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the resulting errors with ggplot2 using a violin plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">Interval_eval</span>,</span>
<span>       <span class="fu">aes</span><span class="op">(</span><span class="va">Type</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_violin</span><span class="op">(</span>draw_quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Variable and bias evaluation interval"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Prediction error"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/11.3.1c-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb181"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Also evaluate the mean daily error</span></span>
<span><span class="va">error_eval</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Tmin"</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Tmax"</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             Interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Year"</span>, <span class="st">"Month"</span>, <span class="st">"Two weeks"</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>             Error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="co"># Get absolute mean of temps differences for rows with missing values in Tmin/max</span></span>
<span>               <span class="co"># na.rm set to TRUE to ignore any NA values in the vector</span></span>
<span>               <span class="co"># na.rm set to FALSE will return NA if there are NA values in data</span></span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmin_annual</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmin</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmin_month</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmin</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmin_2weeks</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmin</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmax_annual</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmin</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmax_month</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmin</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmax_2weeks</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">Bonn_gaps</span><span class="op">$</span><span class="va">Tmin</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">error_eval</span>, </span>
<span>      caption <span class="op">=</span> <span class="st">"Table 11.3.1b: Mean absolute prediction error for minimun and </span></span>
<span><span class="st">      maximum temperature when using different time intervals as a basis for</span></span>
<span><span class="st">      correcting for between-station biases"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Table 11.3.1b: Mean absolute prediction error for minimun and maximum temperature when using different time intervals as a basis for correcting for between-station biases</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Interval</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Error</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Tmin</td>
<td style="text-align: left;">Year</td>
<td style="text-align: right;">0.9933349</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tmin</td>
<td style="text-align: left;">Month</td>
<td style="text-align: right;">0.9873087</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tmin</td>
<td style="text-align: left;">Two weeks</td>
<td style="text-align: right;">0.9883714</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tmax</td>
<td style="text-align: left;">Year</td>
<td style="text-align: right;">0.8479202</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tmax</td>
<td style="text-align: left;">Month</td>
<td style="text-align: right;">0.8253971</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tmax</td>
<td style="text-align: left;">Two weeks</td>
<td style="text-align: right;">0.8252075</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb182"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># The improvement isn't very impressive here, possibly because the stations used</span></span>
<span><span class="co"># are quite close to each other and the weather doesn't differ much between them.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section><section id="saving-the-data-for-later" class="level4"><h4 class="anchored" data-anchor-id="saving-the-data-for-later">
<span style="color:#71797E">11.3.2</span>&nbsp; Saving the data for later</h4>
<div style="height: 18px;">

</div>
<ul>
<li>Save for later the fairly convincing long-term record (from 1990 to 2020) for Bonn, with no remaining gaps.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb183"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Choose the dataset with bias correction on monthly intervals-</span></span>
<span><span class="co"># still need to interpolate the one missing day, before saving the record</span></span>
<span><span class="va">monthly_bias_fixed</span> <span class="op">&lt;-</span> <span class="fu">fix_weather</span><span class="op">(</span><span class="va">patched_monthly</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save the record for weather element only- the data.frame that can easily be</span></span>
<span><span class="co"># saved as a spreadsheet table (.csv file).</span></span>
<span><span class="co"># We can also save list (including the QC element) but it is a bit more</span></span>
<span><span class="co"># complicated- save it for later.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">monthly_bias_fixed</span><span class="op">$</span><span class="va">weather</span>,</span>
<span>          <span class="st">"data/Bonn/Bonn_weather.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
</section></section><section id="filling-gaps-in-hourly-records" class="level3"><h3 class="anchored" data-anchor-id="filling-gaps-in-hourly-records">
<span style="color:#71797E">11.4</span>&nbsp; Filling gaps in hourly records</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>Gaps in hourly records are a lot harder to handle, because linear interpolation usually isn’t an option.</p></li>
<li><p>This works for very short gaps only, but it’s probably quite obvious that for gaps that extend over multiple days, you can’t just connect the start and end points with a straight line— makes it hard to use hourly records, even when they are available.</p></li>
<li><p><a href="https://link.springer.com/article/10.1007/s00484-018-1582-7">(Luedeling, 2018)</a> found a solution to make use of hourly data in such cases.</p></li>
<li><p>In principle, having an actual record of hourly temperatures is preferable to deriving hourly data from daily records, but it may cause problems when the record isn’t complete, e.g.&nbsp;<code>Winters_hours_gaps</code> dataset.</p></li>
<li><p>Such situations arise quite often, because temperature loggers can temporarily fail for many reasons.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb184"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># See what happens when we use linear interpolation for Winters_hours_gaps</span></span>
<span><span class="co"># Select rows to match the chart in coursebook</span></span>
<span><span class="va">gap_Winters</span> <span class="op">&lt;-</span> <span class="va">Winters_hours_gaps</span><span class="op">[</span><span class="fl">39</span><span class="op">:</span><span class="fl">350</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Add date in chillR format (for plotting)</span></span>
<span><span class="va">gap_Winters</span> <span class="op">&lt;-</span> <span class="fu">add_date</span><span class="op">(</span><span class="va">gap_Winters</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View(gap_Winters)</span></span>
<span></span>
<span><span class="co"># Create Tmin and Tmax columns to comply with chillR data format</span></span>
<span><span class="va">gap_Winters</span><span class="op">[</span>, <span class="st">"Tmin"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">gap_Winters</span><span class="op">$</span><span class="va">Temp_gaps</span></span>
<span><span class="va">gap_Winters</span><span class="op">[</span>, <span class="st">"Tmin_observed"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">gap_Winters</span><span class="op">$</span><span class="va">Temp</span></span>
<span><span class="va">gap_Winters</span><span class="op">[</span>, <span class="st">"Tmax"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">gap_Winters</span><span class="op">$</span><span class="va">Temp</span> <span class="co"># just placeholder</span></span>
<span></span>
<span><span class="co"># View(gap_Winters)</span></span>
<span></span>
<span><span class="co"># Interpolate the gaps in Temp_gaps</span></span>
<span><span class="va">Temp_int</span> <span class="op">&lt;-</span> <span class="fu">interpolate_gaps</span><span class="op">(</span><span class="va">gap_Winters</span><span class="op">[</span>, <span class="st">"Tmin"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add interpolated Temp to the dataset</span></span>
<span><span class="va">weather_Winters</span> <span class="op">&lt;-</span> <span class="va">gap_Winters</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>Temp_interpolated <span class="op">=</span> <span class="va">Temp_int</span><span class="op">$</span><span class="va">interp</span>,</span>
<span>         Temps_interpolated <span class="op">=</span> <span class="va">Temp_int</span><span class="op">$</span><span class="va">missing</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View(weather_Winters)</span></span>
<span></span>
<span><span class="co"># Plot the result</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">weather_Winters</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">260</span>, <span class="op">]</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">Date</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">Tmin_observed</span>, color <span class="op">=</span> <span class="st">"Temp Observed"</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">Temp_interpolated</span>, color <span class="op">=</span> <span class="st">"Temp Interpolated"</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Temp Observed"</span> <span class="op">=</span> <span class="st">"black"</span>, <span class="st">"Temp Interpolated"</span> <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Legend"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Temperature (°C)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/11.4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb185"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># In this interpolation, some daytime or nighttime cycles were missed entirely, </span></span>
<span><span class="co"># which can lead to substantial errors when calculating agroclimatic metrics, </span></span>
<span><span class="co"># such as chill or heat stress, that are of particular concern during the </span></span>
<span><span class="co"># warmest and coolest parts of the day.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>
<code>interpolate_gaps_hourly()</code> can produce credible and continuous hourly records from a patchy dataset. It can also derive daily temperature extremes from hourly data that were recorded. Rough mode of operation:
<ul>
<li>Express temperatures for each hour as a function of daily temperature extremes using the functions of <a href="https://journals.ashs.org/hortsci/view/journals/hortsci/25/1/article-p14.xml">Linvill (1990).</a> According to this idealized curve, all hourly temperatures can be expressed as a function of <code>Tmin</code> and <code>Tmax</code> on the previous, same or next day of the temperature record (depending on which hour is of interest). For a day with a complete record, 24 equations can be set up.</li>
<li>For each daily temperature extreme, empirically solve the system of all equations that contain the respective <code>Tmin</code> or <code>Tmax</code> variable (this is only attempted, when a minimum of 5 equations are available, to avoid spurious results).</li>
<li>Close gaps in the resulting dataset of daily Tmin and Tmax using data from proxy stations or, as a last resort, linear interpolation.</li>
<li>Compute idealized temperature curves from the now continuous record of daily <code>Tmin</code> and <code>Tmax</code> values.</li>
<li>Calculate the difference between recorded temperatures and this idealized curve.</li>
<li>Linearly interpolate this difference and add then result to the idealized temperature curve.</li>
</ul>
</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb186"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># See how this function works on the Winters dataset, using daily data from </span></span>
<span><span class="co"># a nearby station of the California Irrigation Management Information System </span></span>
<span><span class="co"># (CIMIS) as a proxy.  </span></span>
<span><span class="co"># Usually can't download coz of server fails to connect</span></span>
<span><span class="va">stations</span> <span class="op">&lt;-</span> <span class="fu">handle_cimis</span><span class="op">(</span><span class="st">"list_stations"</span>, <span class="co"># handle_cimis is similar to handle_gsod</span></span>
<span>                         location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">122</span>,<span class="fl">38.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">downloaded_winters</span> <span class="op">&lt;-</span> <span class="fu">handle_cimis</span><span class="op">(</span><span class="st">"download_weather"</span>,</span>
<span>                                   <span class="va">stations</span><span class="op">$</span><span class="va">chillR_code</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                                   time_interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2008</span>,<span class="fl">2008</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">winters_daily</span> <span class="op">&lt;-</span> <span class="fu">handle_cimis</span><span class="op">(</span><span class="va">downloaded_winters</span><span class="op">)</span><span class="op">$</span><span class="va">weather</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>We will use a provided dataset instead.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb187"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># So, we use a ready-made dataset</span></span>
<span><span class="va">winters_daily</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/OT/winters_daily.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the dataset</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">winters_daily</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Prec</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">-1.7</td>
<td style="text-align: right;">13.6</td>
<td style="text-align: right;">5.0</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">12.2</td>
<td style="text-align: right;">6.9</td>
<td style="text-align: right;">12.0</td>
</tr>
<tr class="even">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">8.0</td>
<td style="text-align: right;">11.0</td>
<td style="text-align: right;">9.2</td>
<td style="text-align: right;">132.8</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2008</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5.3</td>
<td style="text-align: right;">9.5</td>
<td style="text-align: right;">7.2</td>
<td style="text-align: right;">10.3</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb188"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Use interpolate_gaps_hourly() function to patch</span></span>
<span><span class="co"># Call dataset to patch</span></span>
<span><span class="va">to_interp</span> <span class="op">&lt;-</span> <span class="va">Winters_hours_gaps</span></span>
<span></span>
<span><span class="co"># Add Temp data to new Temp_recorded column</span></span>
<span><span class="va">to_interp</span><span class="op">[</span>, <span class="st">"Temp_recorded"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">to_interp</span><span class="op">[</span>, <span class="st">"Temp"</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Add Temp_gaps data to the Temp column</span></span>
<span><span class="va">to_interp</span><span class="op">[</span>, <span class="st">"Temp"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">to_interp</span><span class="op">[</span>, <span class="st">"Temp_gaps"</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Generate continous hourly records</span></span>
<span><span class="va">interp</span> <span class="op">&lt;-</span> <span class="fu">interpolate_gaps_hourly</span><span class="op">(</span>hourtemps <span class="op">=</span> <span class="va">to_interp</span>, </span>
<span>                                  latitude <span class="op">=</span> <span class="fl">38.5</span>,</span>
<span>                                  daily_temps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Winters <span class="op">=</span> <span class="va">winters_daily</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># hourtemps: data.frame containing hourly temperatures. </span></span>
<span>  <span class="co"># This has to contain columns c("Year","Month","Day","Hour","Temp").</span></span>
<span><span class="co"># latitude: location of interest</span></span>
<span><span class="co"># daily_temps: list of (chillR compliant) daily temperature data sets </span></span>
<span>  <span class="co"># for patching gaps in the record.</span></span>
<span><span class="co"># Winters = : give name to the station, otherwise report as station_x in result</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The resulting dataset has two elements: $weather and daily_patch_report. Let’s first look at the <code>daily_patch_report</code> element.</p>
<ul>
<li>The resulting table of the <code>daily_patch_report</code> element contains information on
<ul>
<li>how many gaps in the daily record were filled by solving the system of hourly equations (‘solved’),</li>
<li>how many <code>Tmin</code> and <code>Tmax</code> values were derived from proxy stations (listed by name, if names were provided in the call to <code>interpolate_gaps_hourly</code>; otherwise as station_x),</li>
<li>how many were filled by linear interpolation (this option can be turned off using the <code>interpolate_remaining</code> parameter).</li>
</ul>
</li>
</ul>
<ul>
<li>For proxy stations, it also provides the bias in mean Tmin and Tmax, which has been corrected, as well as the bias in the standard deviation of Tmin and Tmax (which was not corrected).</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb189"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">kable</span><span class="op">(</span><span class="va">interp</span><span class="op">$</span><span class="va">daily_patch_report</span>,</span>
<span>      caption <span class="op">=</span> <span class="st">"The element of `daily_patch_report`"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>The element of `daily_patch_report`</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Var</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Proxy</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">mean_bias</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">stdev_bias</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">filled</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">gaps_remain</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Tmin</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">193</td>
<td style="text-align: left;">61</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tmin</td>
<td style="text-align: left;">Winters</td>
<td style="text-align: left;">0.282</td>
<td style="text-align: left;">1.908</td>
<td style="text-align: left;">61</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tmin</td>
<td style="text-align: left;">interpolated</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tmax</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">204</td>
<td style="text-align: left;">50</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tmax</td>
<td style="text-align: left;">Winters</td>
<td style="text-align: left;">-1.835</td>
<td style="text-align: left;">2.393</td>
<td style="text-align: left;">50</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tmax</td>
<td style="text-align: left;">interpolated</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p>The <code>$weather</code> element of the interpolation result contains the table of interpolated temperatures.</p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb190"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Show only Day 6 of the dataset </span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">interp</span><span class="op">$</span><span class="va">weather</span><span class="op">[</span><span class="fl">63</span><span class="op">:</span><span class="fl">86</span>, <span class="op">]</span>,</span>
<span>      caption <span class="op">=</span> <span class="st">"The element of `weather`"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>The element of `weather`</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Hour</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp_gaps</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp_measured</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp_recorded</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Tmin_source</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Tmax_source</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">63</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6.611</td>
<td style="text-align: right;">6.611</td>
<td style="text-align: right;">6.611</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">6.611000</td>
</tr>
<tr class="even">
<td style="text-align: left;">64</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">6.585</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">solved</td>
<td style="text-align: right;">6.127331</td>
</tr>
<tr class="odd">
<td style="text-align: left;">65</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">5.231</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">solved</td>
<td style="text-align: right;">5.721483</td>
</tr>
<tr class="even">
<td style="text-align: left;">66</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">4.844</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">solved</td>
<td style="text-align: right;">5.377439</td>
</tr>
<tr class="odd">
<td style="text-align: left;">67</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">3.643</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">solved</td>
<td style="text-align: right;">5.083670</td>
</tr>
<tr class="even">
<td style="text-align: left;">68</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">3.459</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">solved</td>
<td style="text-align: right;">4.831597</td>
</tr>
<tr class="odd">
<td style="text-align: left;">69</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">3.063</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">solved</td>
<td style="text-align: right;">4.614667</td>
</tr>
<tr class="even">
<td style="text-align: left;">70</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">3.670</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">7.187229</td>
</tr>
<tr class="odd">
<td style="text-align: left;">71</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">6.128</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">9.961071</td>
</tr>
<tr class="even">
<td style="text-align: left;">72</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">11.248</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">12.546187</td>
</tr>
<tr class="odd">
<td style="text-align: left;">73</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">15.581</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">14.845358</td>
</tr>
<tr class="even">
<td style="text-align: left;">74</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">16.773</td>
<td style="text-align: right;">16.773</td>
<td style="text-align: right;">16.773</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">16.773000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">75</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">17.534</td>
<td style="text-align: right;">17.534</td>
<td style="text-align: right;">17.534</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">17.534000</td>
</tr>
<tr class="even">
<td style="text-align: left;">76</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">16.606</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">18.169898</td>
</tr>
<tr class="odd">
<td style="text-align: left;">77</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">17.177</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">18.278931</td>
</tr>
<tr class="even">
<td style="text-align: left;">78</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">17.819</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">17.850162</td>
</tr>
<tr class="odd">
<td style="text-align: left;">79</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">17.701</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">16.894530</td>
</tr>
<tr class="even">
<td style="text-align: left;">80</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">17.510</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">15.444406</td>
</tr>
<tr class="odd">
<td style="text-align: left;">81</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">15.485</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">13.722715</td>
</tr>
<tr class="even">
<td style="text-align: left;">82</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">12.050</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">11.612484</td>
</tr>
<tr class="odd">
<td style="text-align: left;">83</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">9.756</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">10.239534</td>
</tr>
<tr class="even">
<td style="text-align: left;">84</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">9.064</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">9.196937</td>
</tr>
<tr class="odd">
<td style="text-align: left;">85</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">8.020</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">8.342747</td>
</tr>
<tr class="even">
<td style="text-align: left;">86</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">6.889</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: right;">7.610517</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p>Here I will try to plot the result like in the coursebook.</p>
<ul>
<li>This illustration shows that the <code>interpolate_gaps_hourly()</code> function produced a pretty good approximation (red lines) to the actual temperatures (gray line).</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb191"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Add date in chillR format</span></span>
<span><span class="va">interp_plot</span> <span class="op">&lt;-</span> <span class="fu">add_date</span><span class="op">(</span><span class="va">interp</span><span class="op">$</span><span class="va">weather</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Use codes from package example</span></span>
<span><span class="co"># Interpolated temperatures are shown in red, measured temperatures in black.</span></span>
<span><span class="co"># plot(interp_plot$Temp[45:320]~c(interp_plot$Date[45:320]),type="l",</span></span>
<span><span class="co">#   col="RED",lwd=2,xlab="Date",ylab="Temperature")</span></span>
<span><span class="co"># lines(interp_plot$Temp_measured[45:320]~c(interp_plot$Date[45:320]),lwd=2)</span></span>
<span></span>
<span><span class="co"># Create a subset of the data for the range between March 6-16</span></span>
<span><span class="va">interp_subset</span> <span class="op">&lt;-</span> <span class="va">interp_plot</span><span class="op">[</span><span class="fl">45</span><span class="op">:</span><span class="fl">320</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Use ggplot </span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">interp_subset</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Add the fist line for recorded temperatures as a gray line</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">Temp_recorded</span>, color <span class="op">=</span> <span class="st">"Temp Recorded"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Add the second line for interpolated temperatures as a red line</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">Temp</span>, color <span class="op">=</span> <span class="st">"Temp Interpolated"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Add the third line for measured temperatures as a black line (this is choppy)</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">Temp_measured</span>, color <span class="op">=</span> <span class="st">"Temp Measured"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"Temp Interpolated"</span> <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>      <span class="st">"Temp Measured"</span> <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      <span class="st">"Temp Recorded"</span> <span class="op">=</span> <span class="st">"grey"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Legend"</span> </span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date"</span>, y <span class="op">=</span> <span class="st">"Temperature (°C)"</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/11.4e-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<section id="accuracy-assessment" class="level4"><h4 class="anchored" data-anchor-id="accuracy-assessment">
<span style="color:#71797E">11.4.1</span>&nbsp; Accuracy assessment</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>Since the actual hourly temperatures are known, the accuracy of the predictions produced by the various interpolation methods can be evaluated.</p></li>
<li><p>A common measure for validating predictions is the Root Mean Square Error of the Prediction (RMSEP).</p></li>
</ul>
<p><br></p>
<section id="root-mean-square-error-of-the-prediction-rmsep" class="level5 unnumbered"><h5 class="unnumbered anchored" data-anchor-id="root-mean-square-error-of-the-prediction-rmsep"><em>Root Mean Square Error of the Prediction (RMSEP)</em></h5>
<div style="height: 18px;">

</div>
<p><span class="math display">\[
RMSEP = \sqrt{\frac{1}{n} \sum_{i=1}^{n} (y_i - \hat{y}_i)^2}
\]</span></p>
<p>, with <span class="math inline">\(\hat{y}_i\)</span> being the observed values, <span class="math inline">\(y_i\)</span> the predicted values, and <span class="math inline">\(n\)</span> the number of values.</p>
<ul>
<li><p>The RMSEP provides an indication of how far each predicted value deviates, on average, from the actual values.</p></li>
<li>
<p>It is, however, quite difficult to interpret RMSEP values alone, because whether they indicate a good or poor model fit depends on how variable the actual values are.</p>
<ul>
<li>For instance, an RMSEP of 5 days for a phenology model (which is close to, but not quite the same as a mean error of 5 days), could indicate a very good model, if observed dates vary by several weeks or months (e.g.&nbsp;for bloom dates of deciduous trees), but a terrible model, if the phenological stage of interest occurs on the same day every year (e.g.&nbsp;the ‘phenological’ event of candles lighting up on ‘festive indoor conifers’).</li>
</ul>
</li>
</ul>
<ul>
<li><p>This is why it makes sense to include in such accuracy assessment the variation in observed values.</p></li>
<li><p>This can be achieved by dividing the standard deviation of the observed data by the RMSEP to calculate the Residual Prediction Deviation (RPD).</p></li>
</ul>
<p><br></p>
</section><section id="residual-prediction-deviation-rpd" class="level5 unnumbered"><h5 class="unnumbered anchored" data-anchor-id="residual-prediction-deviation-rpd"><em>Residual Prediction Deviation (RPD)</em></h5>
<div style="height: 18px;">

</div>
<p><span class="math display">\[
RPD = \frac{sd_y}{RMSEP}
\]</span> </p>
<ul>
<li>This equation contains the RMSEP as computed above as well as the standard deviation of the observed values from their mean, defined as:</li>
</ul>
<p><span class="math display">\[
sd_y = \sqrt{\frac{\sum_{i=1}^n (y_i - \bar{y})^2}{n-1}}
\]</span></p>
<p>, with <span class="math inline">\(\bar{y}\)</span> being the mean over all observations.</p>
<ul>
<li><p>The RPD is more useful than the RMSEP, but its use of the standard deviation can be a problem, when actual values of <span class="math inline">\(y\)</span> aren’t normally distributed (then the standard deviation can be a poor measure of variation).</p></li>
<li><p>A more robust approach is use the interquartile range instead of the standard deviation. This metric is called the Ratio of Performance to InterQuartile distance (RPIQ).</p></li>
</ul>
<p><br></p>
</section><section id="ratio-of-performance-to-interquartile-distance-rpiq" class="level5 unnumbered"><h5 class="unnumbered anchored" data-anchor-id="ratio-of-performance-to-interquartile-distance-rpiq"><em>Ratio of Performance to InterQuartile distance (RPIQ)</em></h5>
<div style="height: 18px;">

</div>
<p><span class="math display">\[
RPIQ = \frac{IQ}{RMSEP}
\]</span></p>
<ul>
<li>IQ is calculated by subtracting the 75<sup>th</sup> percentile of the distribution of all <span class="math inline">\(y\)</span> from the 25<sup>th</sup> percentile.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb192"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># require(stats)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">IQ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">IQ</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>     75% 
1.432822 </code></pre>
</div>
</div>
<p><br></p>
<ul>
<li><p>The RPIQ score is a bit harder to evaluate than the RMSEP, with different quality thresholds in use and a very high context dependency.</p></li>
<li><p>Quite commonly, values above 2 are considered ‘good’ or even ‘excellent’, though some studies use substantially higher thresholds (up to 8 for excellence).</p></li>
<li>
<p>Since the RPIQ makes no assumption about the distribution of <span class="math inline">\(y\)</span>, let’s use this for assessing the accuracy of the various interpolation methods. We have a total of four methods to evaluate:</p>
<ul>
<li>
<strong>idealized</strong> temperature curves from <strong>daily</strong> records of <code>Tmin</code> and <code>Tmax</code>, based on records from a <strong>nearby weather station</strong>
</li>
<li>
<strong>idealized</strong> temperature curves from <strong>daily</strong> records of <code>Tmin</code> and <code>Tmax</code>, based on records from <strong>the same location</strong>
</li>
<li>
<strong>linear</strong> interpolation of <strong>hourly</strong> temperatures</li>
<li>interpolation of <strong>hourly</strong> temperatures with <code>interpolate_gaps_hourly</code>
</li>
</ul>
</li>
</ul>
<ul>
<li>Use the <code>make_all_day_table()</code> function to generate a dataset of daily minimum and maximum temperatures from the hourly records for option 2.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb194"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Call dataset</span></span>
<span><span class="va">inter</span> <span class="op">&lt;-</span> <span class="va">interp</span><span class="op">$</span><span class="va">weather</span></span>
<span></span>
<span><span class="co"># Add date column in chillR format</span></span>
<span><span class="va">inter</span><span class="op">[</span>, <span class="st">"DATE"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html">ISOdate</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Year</span>,</span>
<span>                           <span class="va">inter</span><span class="op">$</span><span class="va">Month</span>,</span>
<span>                           <span class="va">inter</span><span class="op">$</span><span class="va">Day</span>,</span>
<span>                           <span class="va">inter</span><span class="op">$</span><span class="va">Hour</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Aggregate hourly records to daily Tmin, Tmean and Tmax </span></span>
<span><span class="va">orchard_extremes</span> <span class="op">&lt;-</span> <span class="fu">make_all_day_table</span><span class="op">(</span><span class="va">inter</span>,</span>
<span>                                       timestep <span class="op">=</span> <span class="st">"day"</span>,</span>
<span>                                       input_timestep <span class="op">=</span> <span class="st">"hour"</span><span class="op">)</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">orchard_extremes</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">DATE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp_gaps</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp_measured</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Temp_recorded</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Tmin_source</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Tmax_source</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">DATE.1</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmax</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2008-03-03 12:00:00</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">15.01593</td>
<td style="text-align: right;">15.01593</td>
<td style="text-align: right;">15.01593</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2008-03-03 12:00:00</td>
<td style="text-align: right;">7.920000</td>
<td style="text-align: right;">15.01593</td>
<td style="text-align: right;">19.50800</td>
</tr>
<tr class="even">
<td style="text-align: left;">2008-03-04 12:00:00</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">12.81204</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2008-03-04 12:00:00</td>
<td style="text-align: right;">3.775000</td>
<td style="text-align: right;">12.90918</td>
<td style="text-align: right;">21.86700</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2008-03-05 12:00:00</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">13.75604</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">2008-03-05 12:00:00</td>
<td style="text-align: right;">6.611000</td>
<td style="text-align: right;">13.18230</td>
<td style="text-align: right;">20.79300</td>
</tr>
<tr class="even">
<td style="text-align: left;">2008-03-06 12:00:00</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">10.51863</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2008-03-06 12:00:00</td>
<td style="text-align: right;">4.614667</td>
<td style="text-align: right;">11.02404</td>
<td style="text-align: right;">18.27893</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2008-03-07 12:00:00</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">12.43037</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: left;">2008-03-07 12:00:00</td>
<td style="text-align: right;">3.248000</td>
<td style="text-align: right;">12.42736</td>
<td style="text-align: right;">21.10300</td>
</tr>
<tr class="even">
<td style="text-align: left;">2008-03-08 12:00:00</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">14.63242</td>
<td style="text-align: left;">daily_Winters</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">2008-03-08 12:00:00</td>
<td style="text-align: right;">9.192859</td>
<td style="text-align: right;">13.79199</td>
<td style="text-align: right;">19.34624</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2008-03-09 12:00:00</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">14.59242</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2008-03-09 12:00:00</td>
<td style="text-align: right;">9.594037</td>
<td style="text-align: right;">15.64157</td>
<td style="text-align: right;">23.74003</td>
</tr>
<tr class="even">
<td style="text-align: left;">2008-03-10 12:00:00</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">14.54471</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">2008-03-10 12:00:00</td>
<td style="text-align: right;">3.844381</td>
<td style="text-align: right;">14.35162</td>
<td style="text-align: right;">23.42400</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2008-03-11 12:00:00</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">14.59100</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2008-03-11 12:00:00</td>
<td style="text-align: right;">6.788000</td>
<td style="text-align: right;">14.57792</td>
<td style="text-align: right;">21.41300</td>
</tr>
<tr class="even">
<td style="text-align: left;">2008-03-12 12:00:00</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">15.14142</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">solved</td>
<td style="text-align: left;">2008-03-12 12:00:00</td>
<td style="text-align: right;">5.194364</td>
<td style="text-align: right;">14.66290</td>
<td style="text-align: right;">22.36900</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<ul>
<li>Let’s first look at the performance of the four methods for the periods that were missing in the hourly temperature record:</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb195"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Interpolate gaps in daily records and generate hourly temperatures</span></span>
<span><span class="va">winters_hours</span> <span class="op">&lt;-</span> <span class="fu">stack_hourly_temps</span><span class="op">(</span><span class="fu">fix_weather</span><span class="op">(</span><span class="va">winters_daily</span><span class="op">)</span>,</span>
<span>                                    latitude <span class="op">=</span> <span class="fl">38</span><span class="op">)</span><span class="op">$</span><span class="va">hourtemps</span></span>
<span></span>
<span><span class="co"># Identify the date in winters_hours correspond to the first date of </span></span>
<span><span class="co"># missing period in inter dataset? </span></span>
<span><span class="co"># The output is 1499- row in the dataset???</span></span>
<span><span class="va">start_hour_winters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">winters_hours</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Year</span>,<span class="fl">1</span><span class="op">)</span><span class="op">&amp;</span></span>
<span>                              <span class="va">winters_hours</span><span class="op">$</span><span class="va">Month</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Month</span>,<span class="fl">1</span><span class="op">)</span><span class="op">&amp;</span></span>
<span>                              <span class="va">winters_hours</span><span class="op">$</span><span class="va">Day</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Day</span>,<span class="fl">1</span><span class="op">)</span><span class="op">&amp;</span></span>
<span>                              <span class="va">winters_hours</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Hour</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Identify the date in winters_hours correspond to the end date of </span></span>
<span><span class="co"># missing period in inter dataset? </span></span>
<span><span class="co"># The output is 7572- row in the dataset???</span></span>
<span><span class="va">end_hour_winters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">winters_hours</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Year</span>,<span class="fl">1</span><span class="op">)</span><span class="op">&amp;</span></span>
<span>                            <span class="va">winters_hours</span><span class="op">$</span><span class="va">Month</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Month</span>,<span class="fl">1</span><span class="op">)</span><span class="op">&amp;</span></span>
<span>                            <span class="va">winters_hours</span><span class="op">$</span><span class="va">Day</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Day</span>,<span class="fl">1</span><span class="op">)</span><span class="op">&amp;</span></span>
<span>                            <span class="va">winters_hours</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Hour</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Follow same process for orchard dataset?</span></span>
<span><span class="va">orchard_hours</span> <span class="op">&lt;-</span> <span class="fu">stack_hourly_temps</span><span class="op">(</span><span class="va">orchard_extremes</span>,</span>
<span>                                    latitude <span class="op">=</span> <span class="fl">38</span><span class="op">)</span><span class="op">$</span><span class="va">hourtemps</span></span>
<span></span>
<span><span class="va">start_hour_orchard</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">orchard_hours</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Year</span>,<span class="fl">1</span><span class="op">)</span><span class="op">&amp;</span></span>
<span>                              <span class="va">orchard_hours</span><span class="op">$</span><span class="va">Month</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Month</span>,<span class="fl">1</span><span class="op">)</span><span class="op">&amp;</span></span>
<span>                              <span class="va">orchard_hours</span><span class="op">$</span><span class="va">Day</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Day</span>,<span class="fl">1</span><span class="op">)</span><span class="op">&amp;</span></span>
<span>                              <span class="va">orchard_hours</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Hour</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">end_hour_orchard</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">orchard_hours</span><span class="op">$</span><span class="va">Year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Year</span>,<span class="fl">1</span><span class="op">)</span><span class="op">&amp;</span></span>
<span>                            <span class="va">orchard_hours</span><span class="op">$</span><span class="va">Month</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Month</span>,<span class="fl">1</span><span class="op">)</span><span class="op">&amp;</span></span>
<span>                            <span class="va">orchard_hours</span><span class="op">$</span><span class="va">Day</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Day</span>,<span class="fl">1</span><span class="op">)</span><span class="op">&amp;</span></span>
<span>                            <span class="va">orchard_hours</span><span class="op">$</span><span class="va">Hour</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Hour</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Extract data for each option</span></span>
<span><span class="co"># Actual temp?</span></span>
<span><span class="va">observed</span> <span class="op">&lt;-</span> <span class="va">inter</span><span class="op">$</span><span class="va">Temp_recorded</span></span>
<span></span>
<span><span class="co"># Use proxy data "winters"</span></span>
<span><span class="va">option1</span> <span class="op">&lt;-</span> <span class="va">winters_hours</span><span class="op">$</span><span class="va">Temp</span><span class="op">[</span><span class="va">start_hour_winters</span><span class="op">:</span><span class="va">end_hour_winters</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Use orchard_extremes data (same location)</span></span>
<span><span class="va">option2</span> <span class="op">&lt;-</span> <span class="va">orchard_hours</span><span class="op">$</span><span class="va">Temp</span><span class="op">[</span><span class="va">start_hour_orchard</span><span class="op">:</span><span class="va">end_hour_orchard</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Use liner interpolation</span></span>
<span><span class="va">option3</span> <span class="op">&lt;-</span> <span class="fu">interpolate_gaps</span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Temp_gaps</span><span class="op">)</span><span class="op">$</span><span class="va">interp</span></span>
<span></span>
<span><span class="co"># Use interpolate_gap_hourly() function</span></span>
<span><span class="va">option4</span> <span class="op">&lt;-</span> <span class="va">inter</span><span class="op">$</span><span class="va">Temp</span></span>
<span></span>
<span><span class="co"># Create a data.frame for output, under two names of dataset</span></span>
<span><span class="va">eval_table</span> <span class="op">&lt;-</span> <span class="co"># This line might not be needed as eval_table is set again below?</span></span>
<span>  <span class="va">eval_table_gaps</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Option <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>             Input_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"daily"</span>,<span class="st">"daily"</span>,<span class="st">"hourly"</span>,<span class="st">"hourly"</span><span class="op">)</span>,</span>
<span>             Interpolation_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"from proxy"</span>,<span class="st">"local extremes"</span>,</span>
<span>                                      <span class="st">"linear"</span>,<span class="st">"hourly interpolation"</span><span class="op">)</span>,</span>
<span>             RMSEP <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>             RPIQ <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the values in each option that correspond with the missing gaps</span></span>
<span><span class="va">observed_gaps</span> <span class="op">&lt;-</span> <span class="va">observed</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Temp_gaps</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">option1_gaps</span> <span class="op">&lt;-</span> <span class="va">option1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Temp_gaps</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">option2_gaps</span> <span class="op">&lt;-</span> <span class="va">option2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Temp_gaps</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">option3_gaps</span> <span class="op">&lt;-</span> <span class="va">option3</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Temp_gaps</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">option4_gaps</span> <span class="op">&lt;-</span> <span class="va">option4</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Temp_gaps</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Add result for RMSEP in the output table created above</span></span>
<span><span class="co"># Comparison between data from each option and the recorded data</span></span>
<span><span class="va">eval_table_gaps</span><span class="op">[</span>,<span class="st">"RMSEP"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">RMSEP</span><span class="op">(</span><span class="va">option1_gaps</span>, <span class="va">observed_gaps</span><span class="op">)</span>,</span>
<span>                                     <span class="fu">RMSEP</span><span class="op">(</span><span class="va">option2_gaps</span>, <span class="va">observed_gaps</span><span class="op">)</span>,</span>
<span>                                     <span class="fu">RMSEP</span><span class="op">(</span><span class="va">option3_gaps</span>, <span class="va">observed_gaps</span><span class="op">)</span>,</span>
<span>                                     <span class="fu">RMSEP</span><span class="op">(</span><span class="va">option4_gaps</span>, <span class="va">observed_gaps</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                   <span class="fl">1</span><span class="op">)</span> <span class="co"># round to 1 decimal point</span></span>
<span></span>
<span><span class="co"># Add result for RPIQ in the output table created above</span></span>
<span><span class="va">eval_table_gaps</span><span class="op">[</span>,<span class="st">"RPIQ"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">RPIQ</span><span class="op">(</span><span class="va">option1_gaps</span>, <span class="va">observed_gaps</span><span class="op">)</span>,</span>
<span>                                    <span class="fu">RPIQ</span><span class="op">(</span><span class="va">option2_gaps</span>, <span class="va">observed_gaps</span><span class="op">)</span>,</span>
<span>                                    <span class="fu">RPIQ</span><span class="op">(</span><span class="va">option3_gaps</span>, <span class="va">observed_gaps</span><span class="op">)</span>,</span>
<span>                                    <span class="fu">RPIQ</span><span class="op">(</span><span class="va">option4_gaps</span>, <span class="va">observed_gaps</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                  <span class="fl">1</span><span class="op">)</span> <span class="co"># round to 1 decimal point</span></span>
<span></span>
<span><span class="co"># Display the output table</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">eval_table_gaps</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Option</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Input_data</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Interpolation_method</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">RMSEP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">RPIQ</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">daily</td>
<td style="text-align: left;">from proxy</td>
<td style="text-align: right;">2.6</td>
<td style="text-align: right;">4.1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">daily</td>
<td style="text-align: left;">local extremes</td>
<td style="text-align: right;">2.1</td>
<td style="text-align: right;">5.0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">hourly</td>
<td style="text-align: left;">linear</td>
<td style="text-align: right;">5.3</td>
<td style="text-align: right;">2.0</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">hourly</td>
<td style="text-align: left;">hourly interpolation</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: right;">5.4</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb196"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># This table shows that the interpolate_gaps_hourly function produced the </span></span>
<span><span class="co"># best results, with an RMSEP of 2 and an RPIQ of 5.4.</span></span>
<span></span>
<span><span class="co"># Option 3, where hourly records collected in the orchard were interpolated </span></span>
<span><span class="co"># linearly, produced the worst fit. </span></span>
<span></span>
<span><span class="co"># This highlights that, at least in this case, using an idealized temperature </span></span>
<span><span class="co"># curve to close gaps in daily temperatures from the orchard (option 2) </span></span>
<span><span class="co"># and even from the proxy station (option 1) produced more accurate results.</span></span>
<span></span>
<span><span class="co"># The quality of option 1 will depend on the similarity between weather at the </span></span>
<span><span class="co"># proxy station and in the orchard (in this case, this should be quite similar).</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li><p>Restricting the comparison to only the gaps in the record is a bit unfair, because of course records produced by option 3 (linear interpolation of hourly records from the orchard) are completely accurate for hours, when temperatures were recorded.</p></li>
<li><p>So let’s also compare the relative performance of the four methods across all hours of the record.</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb197"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create data.frame for output table again</span></span>
<span><span class="va">eval_table</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Option <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>             Input_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"daily"</span>,<span class="st">"daily"</span>,<span class="st">"hourly"</span>,<span class="st">"hourly"</span><span class="op">)</span>,</span>
<span>             Interpolation_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"from proxy"</span>,<span class="st">"local extremes"</span>,</span>
<span>                                      <span class="st">"linear"</span>,<span class="st">"hourly interpolation"</span><span class="op">)</span>,</span>
<span>             RMSEP <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>             RPIQ <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Comparison between whole datasets- not just the gaps</span></span>
<span><span class="co"># Add values for RMSEP </span></span>
<span><span class="va">eval_table</span><span class="op">[</span>,<span class="st">"RMSEP"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">RMSEP</span><span class="op">(</span><span class="va">option1</span>, <span class="va">observed</span><span class="op">)</span>,</span>
<span>                                <span class="fu">RMSEP</span><span class="op">(</span><span class="va">option2</span>, <span class="va">observed</span><span class="op">)</span>,</span>
<span>                                <span class="fu">RMSEP</span><span class="op">(</span><span class="va">option3</span>, <span class="va">observed</span><span class="op">)</span>,</span>
<span>                                <span class="fu">RMSEP</span><span class="op">(</span><span class="va">option4</span>, <span class="va">observed</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                              <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add values for RPIQ</span></span>
<span><span class="va">eval_table</span><span class="op">[</span>,<span class="st">"RPIQ"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">RPIQ</span><span class="op">(</span><span class="va">option1</span>, <span class="va">observed</span><span class="op">)</span>,</span>
<span>                               <span class="fu">RPIQ</span><span class="op">(</span><span class="va">option2</span>, <span class="va">observed</span><span class="op">)</span>,</span>
<span>                               <span class="fu">RPIQ</span><span class="op">(</span><span class="va">option3</span>, <span class="va">observed</span><span class="op">)</span>,</span>
<span>                               <span class="fu">RPIQ</span><span class="op">(</span><span class="va">option4</span>, <span class="va">observed</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                             <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Display output</span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">eval_table</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Option</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Input_data</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Interpolation_method</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">RMSEP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">RPIQ</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">daily</td>
<td style="text-align: left;">from proxy</td>
<td style="text-align: right;">2.5</td>
<td style="text-align: right;">4.2</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">daily</td>
<td style="text-align: left;">local extremes</td>
<td style="text-align: right;">1.9</td>
<td style="text-align: right;">5.7</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">hourly</td>
<td style="text-align: left;">linear</td>
<td style="text-align: right;">3.9</td>
<td style="text-align: right;">2.7</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">hourly</td>
<td style="text-align: left;">hourly interpolation</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">7.2</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb198"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># The quality of the proxy-based idealized temperature curves went down </span></span>
<span><span class="co"># slightly, while all other approaches saw improvements in quality </span></span>
<span><span class="co"># (lower RMSEP and higher RPIQ).</span></span>
<span></span>
<span><span class="co"># The RPIQ values for the two interpolations that were based on local data </span></span>
<span><span class="co"># (options 2 and 4) are very high, especially for option 4, which used the </span></span>
<span><span class="co"># interpolate_gaps_hourly function.</span></span>
<span></span>
<span><span class="co"># The RPIQ score for option 4 almost exceeds the ‘excellence’ threshold for </span></span>
<span><span class="co"># the most conservative RPIQ evaluation scheme (threshold of 8). This is quite </span></span>
<span><span class="co"># remarkable, given the variable nature of daily temperature fluctuations and </span></span>
<span><span class="co"># the fact that about half of the actually recorded values were removed before </span></span>
<span><span class="co"># running the interpolation.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li><strong><em>In conclusion, the <code>interpolate_gaps_hourly</code> function provided a very good approximation of hourly temperatures for times when no values were recorded.</em></strong></li>
</ul>
<p><br></p>
</section></section><section id="computing-agroclimatic-metrics" class="level4"><h4 class="anchored" data-anchor-id="computing-agroclimatic-metrics">
<span style="color:#71797E">11.4.2</span>&nbsp; Computing agroclimatic metrics</h4>
<div style="height: 18px;">

</div>
<ul>
<li><p>Finally, let’s look at the implication of the choice of interpolation method on chill and heat estimates.</p></li>
<li><p>If we’re interested in using the Dynamic Model for winter chill or the Growing Degree Hours model for heat, we can simply calculate this using the <code>Dynamic_Model</code> and <code>GDH()</code> functions in <code>chillR</code>.</p></li>
<li><p>For more functionality, see the <code>chilling()</code> and particularly the <code>tempResponse()</code> functions.</p></li>
<li><p>First, look at the implications of method choice on chill accumulation:</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb199"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Recall the dataset (just to make sure good knitting)</span></span>
<span><span class="va">observed</span> <span class="op">&lt;-</span> <span class="va">inter</span><span class="op">$</span><span class="va">Temp_recorded</span></span>
<span><span class="va">option1</span> <span class="op">&lt;-</span> <span class="va">winters_hours</span><span class="op">$</span><span class="va">Temp</span><span class="op">[</span><span class="va">start_hour_winters</span><span class="op">:</span><span class="va">end_hour_winters</span><span class="op">]</span></span>
<span><span class="va">option2</span> <span class="op">&lt;-</span> <span class="va">orchard_hours</span><span class="op">$</span><span class="va">Temp</span><span class="op">[</span><span class="va">start_hour_orchard</span><span class="op">:</span><span class="va">end_hour_orchard</span><span class="op">]</span></span>
<span><span class="va">option3</span> <span class="op">&lt;-</span> <span class="fu">interpolate_gaps</span><span class="op">(</span><span class="va">inter</span><span class="op">$</span><span class="va">Temp_gaps</span><span class="op">)</span><span class="op">$</span><span class="va">interp</span></span>
<span><span class="va">option4</span> <span class="op">&lt;-</span> <span class="va">inter</span><span class="op">$</span><span class="va">Temp</span></span>
<span></span>
<span><span class="co"># Create a data.frame with results for each option</span></span>
<span><span class="va">all_chill</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>DATE <span class="op">=</span> <span class="va">inter</span><span class="op">$</span><span class="va">DATE</span>,</span>
<span>                        <span class="st">"Obs"</span> <span class="op">=</span> <span class="fu">Dynamic_Model</span><span class="op">(</span><span class="va">observed</span><span class="op">)</span>,</span>
<span>                        <span class="st">"Opt1"</span> <span class="op">=</span> <span class="fu">Dynamic_Model</span><span class="op">(</span><span class="va">option1</span><span class="op">)</span>,</span>
<span>                        <span class="st">"Opt2"</span> <span class="op">=</span> <span class="fu">Dynamic_Model</span><span class="op">(</span><span class="va">option2</span><span class="op">)</span>,</span>
<span>                        <span class="st">"Opt3"</span> <span class="op">=</span> <span class="fu">Dynamic_Model</span><span class="op">(</span><span class="va">option3</span><span class="op">)</span>,</span>
<span>                        <span class="st">"Opt4"</span> <span class="op">=</span> <span class="fu">Dynamic_Model</span><span class="op">(</span><span class="va">option4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Collapse columns into rows</span></span>
<span><span class="va">all_chill</span> <span class="op">&lt;-</span> <span class="fu">pivot_longer</span><span class="op">(</span><span class="va">all_chill</span>, <span class="va">Obs</span><span class="op">:</span><span class="va">Opt4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add a method column with legend names for each option</span></span>
<span><span class="va">all_chill</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">all_chill</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Obs"</span><span class="op">)</span>,<span class="st">"Method"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"Observed temperatures"</span></span>
<span><span class="va">all_chill</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">all_chill</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Opt1"</span><span class="op">)</span>,<span class="st">"Method"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"Option 1 - idealized record from proxy data"</span></span>
<span><span class="va">all_chill</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">all_chill</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Opt2"</span><span class="op">)</span>,<span class="st">"Method"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"Option 2 - idealized record from daily orchard data"</span></span>
<span><span class="va">all_chill</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">all_chill</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Opt3"</span><span class="op">)</span>,<span class="st">"Method"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"Option 3 - linear interpolation of hourly data"</span></span>
<span><span class="va">all_chill</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">all_chill</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Opt4"</span><span class="op">)</span>,<span class="st">"Method"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"Option 4 - use of interpolate_gaps_hourly"</span></span>
<span></span>
<span><span class="co"># Plot the data</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">all_chill</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">DATE</span>, y <span class="op">=</span> <span class="va">value</span>, colour <span class="op">=</span> <span class="va">Method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date"</span>, y <span class="op">=</span> <span class="st">"Chill accumulation (Chill Portions)"</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">theme</span><span class="op">(</span></span>
<span>  legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.85</span><span class="op">)</span>, </span>
<span>  legend.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>  legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>  legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,</span>
<span>  legend.key.size <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1.2</span>, <span class="st">"lines"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/11.4.2a-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb200"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## I found another way to plot.</span></span>
<span><span class="co">## This is quite a roundabout but I will just save it here anyway.</span></span>
<span></span>
<span><span class="co"># Create a data.frame with results for each option</span></span>
<span><span class="co"># all_chill &lt;- data.frame(DATE = inter$DATE,</span></span>
<span><span class="co">#                         "Obs" = Dynamic_Model(observed),</span></span>
<span><span class="co">#                         "Opt1" = Dynamic_Model(option1),</span></span>
<span><span class="co">#                         "Opt2" = Dynamic_Model(option2),</span></span>
<span><span class="co">#                         "Opt3" = Dynamic_Model(option3),</span></span>
<span><span class="co">#                         "Opt4" = Dynamic_Model(option4))</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># The latter is not necessary but I just found out how to change names of column </span></span>
<span><span class="co"># all_chill_long &lt;- pivot_longer(all_chill, cols = Obs:Opt4, names_to = </span></span>
<span><span class="co">#                                  "Method", values_to = "Chill_Portion")</span></span>
<span></span>
<span><span class="co"># Fill missing values for each method (ggplot gives blank plot with NA values)</span></span>
<span><span class="co"># When I first run the coursebook codes, there were NA values and I couldn't plot</span></span>
<span><span class="co"># After I filled the missing values using tidyr, I tried running the original</span></span>
<span><span class="co"># codes again and there were no NA. Don't know why but maybe this filling step</span></span>
<span><span class="co"># is not necessary. </span></span>
<span><span class="co"># all_chill_long &lt;- all_chill_long %&gt;%</span></span>
<span><span class="co">#   group_by(Method) %&gt;% # group_by to fill values separately for each method</span></span>
<span>  <span class="co"># fill values in Chill_Portion using downup direction</span></span>
<span>  <span class="co"># for values missing above and below within a group</span></span>
<span>  <span class="co"># tidyr::fill(Chill_Portion, .direction = "downup") %&gt;%</span></span>
<span>  <span class="co"># ungroup() # ungroup to return data to original data.frame</span></span>
<span></span>
<span><span class="co"># Plot the results</span></span>
<span><span class="co"># ggplot(all_chill_long, aes(x = DATE, y = Chill_Portion, colour = Method)) +</span></span>
<span><span class="co">#   geom_line(size = 1.2) +</span></span>
<span><span class="co">#   labs(x = "Date", y = "Chill accumulation (Chill Portions)") +</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#   scale_color_discrete(name = "Method", labels = </span></span>
<span><span class="co">#                            c("Observed temperatures",</span></span>
<span><span class="co">#                              "Option 1 - idealized record from proxy data", </span></span>
<span><span class="co">#                              "Option 2 - idealized record from daily orchard data",</span></span>
<span><span class="co">#                              "Option 3 - linear interpolation of hourly data",</span></span>
<span><span class="co">#                              "Option 4 - use of interpolate_gaps_hourly")) +</span></span>
<span><span class="co">#   theme(</span></span>
<span><span class="co">#     legend.position = c(0.25, 0.85), </span></span>
<span><span class="co">#     legend.background = element_rect(fill = "white", size = 0.2),</span></span>
<span><span class="co">#     legend.text = element_text(size = 18),</span></span>
<span><span class="co">#     legend.title = element_text(size = 20),</span></span>
<span><span class="co">#     legend.key.size = unit(1.2, "lines")</span></span>
<span><span class="co">#   )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li><p>This figure shows that chill accumulation differed substantially between the options. Both the use of proxy data and the use of linear interpolation of hourly temperatures led to considerable overestimation of chill accumulation.</p></li>
<li><p>Do the same assessment for heat:</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb201"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">all_heat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>DATE <span class="op">=</span> <span class="va">inter</span><span class="op">$</span><span class="va">DATE</span>,</span>
<span>                       <span class="st">"Obs"</span> <span class="op">=</span> <span class="fu">GDH</span><span class="op">(</span><span class="va">observed</span><span class="op">)</span>,</span>
<span>                       <span class="st">"Opt1"</span> <span class="op">=</span> <span class="fu">GDH</span><span class="op">(</span><span class="va">option1</span><span class="op">)</span>,</span>
<span>                       <span class="st">"Opt2"</span> <span class="op">=</span> <span class="fu">GDH</span><span class="op">(</span><span class="va">option2</span><span class="op">)</span>,</span>
<span>                       <span class="st">"Opt3"</span> <span class="op">=</span> <span class="fu">GDH</span><span class="op">(</span><span class="va">option3</span><span class="op">)</span>,</span>
<span>                       <span class="st">"Opt4"</span> <span class="op">=</span> <span class="fu">GDH</span><span class="op">(</span><span class="va">option4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">all_heat</span> <span class="op">&lt;-</span> <span class="fu">pivot_longer</span><span class="op">(</span><span class="va">all_heat</span>, <span class="va">Obs</span><span class="op">:</span><span class="va">Opt4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">all_heat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">all_heat</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Obs"</span><span class="op">)</span>,<span class="st">"Method"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"Observed temperatures"</span></span>
<span><span class="va">all_heat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">all_heat</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Opt1"</span><span class="op">)</span>,<span class="st">"Method"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"Option 1 - idealized record from proxy data"</span></span>
<span><span class="va">all_heat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">all_heat</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Opt2"</span><span class="op">)</span>,<span class="st">"Method"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"Option 2 - idealized record from daily orchard data"</span></span>
<span><span class="va">all_heat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">all_heat</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Opt3"</span><span class="op">)</span>,<span class="st">"Method"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"Option 3 - linear interpolation of hourly data"</span></span>
<span><span class="va">all_heat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">all_heat</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Opt4"</span><span class="op">)</span>,<span class="st">"Method"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"Option 4 - use of interpolate_gaps_hourly"</span></span>
<span></span>
<span><span class="co"># Plot the data</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">all_heat</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">DATE</span>, y <span class="op">=</span> <span class="va">value</span>, colour <span class="op">=</span> <span class="va">Method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date"</span>, y <span class="op">=</span> <span class="st">"Heat accumulation (Growing Degree Hours)"</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">theme</span><span class="op">(</span></span>
<span>  legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.85</span><span class="op">)</span>, </span>
<span>  legend.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>  legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>  legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,</span>
<span>  legend.key.size <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">1.2</span>, <span class="st">"lines"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Tree_Phenology_Analysis_in_R_Logbook_files/figure-html/11.4.2b-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<ul>
<li><p>This comparison doesn’t look quite as bad as for chill accumulation, but also here, option 4 clearly provided the most accurate estimate (it almost coincides with the red line, making the difference hard to see).</p></li>
<li><p>This dataset didn’t cover the winter season, so the chill numbers aren’t too meaningful, but it is nevertheless instructive to compare the total accumulation of chill and heat over the whole temperature record:</p></li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb202"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">CH_table</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Option <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>             Input_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"observed"</span>,<span class="st">"daily"</span>,<span class="st">"daily"</span>,<span class="st">"hourly"</span>, <span class="st">"hourly"</span><span class="op">)</span>,</span>
<span>             Interpolation_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"from proxy"</span>,<span class="st">"local extremes"</span>,</span>
<span>                                      <span class="st">"linear"</span>,<span class="st">"hourly interpolation"</span><span class="op">)</span>,</span>
<span>             Chill_Portions <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>             Growing_Degree_Hours<span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span><span class="va">CH_table</span><span class="op">$</span><span class="va">Chill_Portions</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">all_chill</span> <span class="op">%&gt;%</span> </span>
<span>                          <span class="fu">group_by</span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                         <span class="fu">summarise</span><span class="op">(</span>total_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">value</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                         <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">$</span> <span class="va">total_value</span></span>
<span>                              </span>
<span></span>
<span></span>
<span><span class="va">CH_table</span><span class="op">$</span><span class="va">Growing_Degree_Hours</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">all_heat</span> <span class="op">%&gt;%</span> </span>
<span>                          <span class="fu">group_by</span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                         <span class="fu">summarise</span><span class="op">(</span>total_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">value</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                         <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">$</span> <span class="va">total_value</span></span>
<span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">CH_table</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Option</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Input_data</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Interpolation_method</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Chill_Portions</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Growing_Degree_Hours</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: left;">observed</td>
<td style="text-align: left;">none</td>
<td style="text-align: right;">39916.09</td>
<td style="text-align: right;">218539172</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">daily</td>
<td style="text-align: left;">from proxy</td>
<td style="text-align: right;">77422.85</td>
<td style="text-align: right;">194474355</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">daily</td>
<td style="text-align: left;">local extremes</td>
<td style="text-align: right;">42711.03</td>
<td style="text-align: right;">211997951</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">hourly</td>
<td style="text-align: left;">linear</td>
<td style="text-align: right;">70097.59</td>
<td style="text-align: right;">235056189</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: left;">hourly</td>
<td style="text-align: left;">hourly interpolation</td>
<td style="text-align: right;">45740.35</td>
<td style="text-align: right;">217147307</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<ul>
<li><p>This comparison shows that the choice of interpolation method can have substantial impact on our impression of accumulated chill and heat.</p></li>
<li><p>The <code>interpolate_gaps_hourly()</code> function in <code>chillR</code> outperformed all other methods evaluated here.</p></li>
</ul>
<p><br></p>
</section></section><section id="exercises-on-filling-gaps" class="level3"><h3 class="anchored" data-anchor-id="exercises-on-filling-gaps">
<span style="color:#71797E">11.5</span>&nbsp; Exercises on filling gaps</h3>
<div style="height: 18px;">

</div>
<p><em>You already downloaded some weather data in the exercises for the Getting temperatures lesson. You can keep working with this.</em></p>
<p><strong><em>1. Use <code>chillR</code> functions to find out how many gaps you have in this dataset (even if you have none, please still follow all further steps)</em></strong></p>
<p>There are large gaps in the dataset, particularly missing data for whole years between 1992 and 2002.</p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb203"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">MS_weather</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/MS/STG_chillR_weather.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MS_weather_gap_check</span> <span class="op">&lt;-</span> <span class="fu">fix_weather</span><span class="op">(</span><span class="va">MS_weather</span><span class="op">)</span><span class="op">$</span><span class="va">QC</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">MS_weather_gap_check</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Incomplete_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1989/1990</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1990/1991</td>
<td style="text-align: right;">1991</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1991/1992</td>
<td style="text-align: right;">1992</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1992/1993</td>
<td style="text-align: right;">1993</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1993/1994</td>
<td style="text-align: right;">1994</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1994/1995</td>
<td style="text-align: right;">1995</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1995/1996</td>
<td style="text-align: right;">1996</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1996/1997</td>
<td style="text-align: right;">1997</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1997/1998</td>
<td style="text-align: right;">1998</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">1998/1999</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1999/2000</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2000/2001</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2001/2002</td>
<td style="text-align: right;">2002</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2002/2003</td>
<td style="text-align: right;">2003</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">316</td>
<td style="text-align: right;">316</td>
<td style="text-align: right;">316</td>
<td style="text-align: right;">13.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2003/2004</td>
<td style="text-align: right;">2004</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2004/2005</td>
<td style="text-align: right;">2005</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2005/2006</td>
<td style="text-align: right;">2006</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2006/2007</td>
<td style="text-align: right;">2007</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2007/2008</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">99.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">2008/2009</td>
<td style="text-align: right;">2009</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2009/2010</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2010/2011</td>
<td style="text-align: right;">2011</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2011/2012</td>
<td style="text-align: right;">2012</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2012/2013</td>
<td style="text-align: right;">2013</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2013/2014</td>
<td style="text-align: right;">2014</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">99.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">2014/2015</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2015/2016</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2016/2017</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2017/2018</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2018/2019</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2019/2020</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100.0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p><strong><em>2. Create a list of the 25 closest weather stations using the <code>handle_gsod</code> function</em></strong></p>
<p>List of stations from GSOD database:</p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb204"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Look for stations near M&amp;ouml;ssigen (48.40567° N, 9.05419° E)</span></span>
<span><span class="va">MS_station_list</span> <span class="op">&lt;-</span> <span class="fu">handle_gsod</span><span class="op">(</span>action <span class="op">=</span> <span class="st">"list_stations"</span>,</span>
<span>                               location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>long <span class="op">=</span> <span class="fl">9.05</span>, lat <span class="op">=</span> <span class="fl">48.40</span><span class="op">)</span>,</span>
<span>                               time_interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1990</span>, <span class="fl">2020</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">MS_station_list</span>, </span>
<span>      caption <span class="op">=</span> <span class="st">"The 25 closet weather stations to Mössigen"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>The 25 closet weather stations to Mössigen</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">chillR_code</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">STATION.NAME</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">CTRY</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Lat</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Long</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BEGIN</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">END</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Distance</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Overlap_years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_interval_covered</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">10826099999</td>
<td style="text-align: left;">TUBINGEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.517</td>
<td style="text-align: right;">9.050</td>
<td style="text-align: right;">19730101</td>
<td style="text-align: right;">19790809</td>
<td style="text-align: right;">13.02</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">10827099999</td>
<td style="text-align: left;">MESSSTETTEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.183</td>
<td style="text-align: right;">9.000</td>
<td style="text-align: right;">19740820</td>
<td style="text-align: right;">19971231</td>
<td style="text-align: right;">24.44</td>
<td style="text-align: right;">8.00</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10738099999</td>
<td style="text-align: left;">STUTTGART</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.690</td>
<td style="text-align: right;">9.222</td>
<td style="text-align: right;">19390902</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">34.68</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">10828099999</td>
<td style="text-align: left;">SIGMARINGEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.100</td>
<td style="text-align: right;">9.250</td>
<td style="text-align: right;">19950201</td>
<td style="text-align: right;">19971230</td>
<td style="text-align: right;">36.54</td>
<td style="text-align: right;">2.91</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10818099999</td>
<td style="text-align: left;">KLIPPENECK (CLIFF)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.100</td>
<td style="text-align: right;">8.750</td>
<td style="text-align: right;">19300903</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">40.12</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="even">
<td style="text-align: left;">10737099999</td>
<td style="text-align: left;">STUTTGART</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.767</td>
<td style="text-align: right;">9.183</td>
<td style="text-align: right;">19360701</td>
<td style="text-align: right;">20030425</td>
<td style="text-align: right;">42.01</td>
<td style="text-align: right;">13.31</td>
<td style="text-align: right;">43</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10834099999</td>
<td style="text-align: left;">RIEDLINGEN (AUT)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.167</td>
<td style="text-align: right;">9.500</td>
<td style="text-align: right;">19880105</td>
<td style="text-align: right;">19921231</td>
<td style="text-align: right;">42.24</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">10815099999</td>
<td style="text-align: left;">FREUDENSTADT</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.450</td>
<td style="text-align: right;">8.417</td>
<td style="text-align: right;">19730101</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">47.09</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10921099999</td>
<td style="text-align: left;">NEUHAUSEN OB ECK</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">47.983</td>
<td style="text-align: right;">8.900</td>
<td style="text-align: right;">19730102</td>
<td style="text-align: right;">19950228</td>
<td style="text-align: right;">47.74</td>
<td style="text-align: right;">5.16</td>
<td style="text-align: right;">17</td>
</tr>
<tr class="even">
<td style="text-align: left;">10739099999</td>
<td style="text-align: left;">STUTTGART/SCHNARREN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.833</td>
<td style="text-align: right;">9.200</td>
<td style="text-align: right;">19840807</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">49.45</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10832099999</td>
<td style="text-align: left;">TUERKHEIM</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.583</td>
<td style="text-align: right;">9.783</td>
<td style="text-align: right;">20040818</td>
<td style="text-align: right;">20040818</td>
<td style="text-align: right;">57.79</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">10835099999</td>
<td style="text-align: left;">GOPPINGEN(US ARMY)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.717</td>
<td style="text-align: right;">9.700</td>
<td style="text-align: right;">19730102</td>
<td style="text-align: right;">19750214</td>
<td style="text-align: right;">59.49</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10835499999</td>
<td style="text-align: left;">GOPPINGEN (USA-AF)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.717</td>
<td style="text-align: right;">9.700</td>
<td style="text-align: right;">19370104</td>
<td style="text-align: right;">19900201</td>
<td style="text-align: right;">59.49</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">10912099999</td>
<td style="text-align: left;">DONAUESCHINGEN VILLINGEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">47.973</td>
<td style="text-align: right;">8.522</td>
<td style="text-align: right;">20040406</td>
<td style="text-align: right;">20191118</td>
<td style="text-align: right;">61.61</td>
<td style="text-align: right;">15.62</td>
<td style="text-align: right;">50</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10736099999</td>
<td style="text-align: left;">MUEHLACKER (AUT)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.967</td>
<td style="text-align: right;">8.867</td>
<td style="text-align: right;">19790314</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">64.54</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="even">
<td style="text-align: left;">10838099999</td>
<td style="text-align: left;">ULM (MIL/MET)</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.383</td>
<td style="text-align: right;">9.950</td>
<td style="text-align: right;">19490101</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">66.56</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10837099999</td>
<td style="text-align: left;">LAUPHEIM</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.220</td>
<td style="text-align: right;">9.910</td>
<td style="text-align: right;">19730102</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">66.75</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">10836099999</td>
<td style="text-align: left;">STOETTEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.667</td>
<td style="text-align: right;">9.867</td>
<td style="text-align: right;">19490101</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">67.16</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10839099999</td>
<td style="text-align: left;">ULM/WILHELMSBURG &amp;</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.400</td>
<td style="text-align: right;">9.983</td>
<td style="text-align: right;">19410116</td>
<td style="text-align: right;">19430430</td>
<td style="text-align: right;">68.96</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">10805199999</td>
<td style="text-align: left;">BADEN OOS</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.791</td>
<td style="text-align: right;">8.187</td>
<td style="text-align: right;">20171201</td>
<td style="text-align: right;">20180522</td>
<td style="text-align: right;">77.02</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10725099999</td>
<td style="text-align: left;">BADEN-OOS</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.800</td>
<td style="text-align: right;">8.183</td>
<td style="text-align: right;">19770803</td>
<td style="text-align: right;">20020311</td>
<td style="text-align: right;">77.83</td>
<td style="text-align: right;">12.19</td>
<td style="text-align: right;">39</td>
</tr>
<tr class="even">
<td style="text-align: left;">10929099999</td>
<td style="text-align: left;">KONSTANZ</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">47.683</td>
<td style="text-align: right;">9.183</td>
<td style="text-align: right;">19360102</td>
<td style="text-align: right;">20030816</td>
<td style="text-align: right;">80.43</td>
<td style="text-align: right;">13.62</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">06671099999</td>
<td style="text-align: left;">STECKBORN</td>
<td style="text-align: left;">CH</td>
<td style="text-align: right;">47.667</td>
<td style="text-align: right;">8.983</td>
<td style="text-align: right;">20120209</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">81.75</td>
<td style="text-align: right;">8.90</td>
<td style="text-align: right;">29</td>
</tr>
<tr class="even">
<td style="text-align: left;">10727599999</td>
<td style="text-align: left;">KARLSRUHE BADEN BADEN</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.779</td>
<td style="text-align: right;">8.081</td>
<td style="text-align: right;">19970723</td>
<td style="text-align: right;">20241102</td>
<td style="text-align: right;">82.89</td>
<td style="text-align: right;">23.44</td>
<td style="text-align: right;">76</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10702099999</td>
<td style="text-align: left;">KARLSRUHE/BADEN-B</td>
<td style="text-align: left;">GM</td>
<td style="text-align: right;">48.783</td>
<td style="text-align: right;">8.083</td>
<td style="text-align: right;">19860107</td>
<td style="text-align: right;">20010918</td>
<td style="text-align: right;">82.99</td>
<td style="text-align: right;">11.72</td>
<td style="text-align: right;">38</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p>I tried to patch data with stations from GSOD database, using the <code>handle_gsod()</code> function, but I could not patch the data. I think it could be problems with distance and the few overlap years— it didn’t work even when I used all stations in the list.</p>
<p>So, I looked around a bit and found <code>handle_dwd()</code> function, which draws data from the Deutscher Wetterdienst database. Since my location is in Germany, I decided to try it and it worked well.</p>
<p>Here is the list of 25 closest stations using <code>handle_dwd()</code></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb205"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">MS_station_list_dwd</span><span class="op">&lt;-</span><span class="fu">handle_dwd</span><span class="op">(</span>action<span class="op">=</span><span class="st">"list_stations"</span>,</span>
<span>                                location<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">9.05</span>, <span class="fl">48.40</span><span class="op">)</span>,</span>
<span>                             time_interval<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">19900101</span>,<span class="fl">20201231</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">MS_station_list_dwd</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Station_name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Region</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Station_ID</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Elevation</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Latitude</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Longitude</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Begin</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">End</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Distance</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">386</td>
<td style="text-align: left;">Hechingen</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">02074</td>
<td style="text-align: right;">518</td>
<td style="text-align: right;">48.3752</td>
<td style="text-align: right;">8.9800</td>
<td style="text-align: left;">19470101</td>
<td style="text-align: left;">20231231</td>
<td style="text-align: right;">5.87</td>
</tr>
<tr class="even">
<td style="text-align: left;">794</td>
<td style="text-align: left;">Rottenburg-Kiebingen</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">04294</td>
<td style="text-align: right;">360</td>
<td style="text-align: right;">48.4704</td>
<td style="text-align: right;">8.9687</td>
<td style="text-align: left;">19790701</td>
<td style="text-align: left;">20021031</td>
<td style="text-align: right;">9.87</td>
</tr>
<tr class="odd">
<td style="text-align: left;">7</td>
<td style="text-align: left;">Albstadt-Onstmettingen</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">00072</td>
<td style="text-align: right;">794</td>
<td style="text-align: right;">48.2766</td>
<td style="text-align: right;">9.0001</td>
<td style="text-align: left;">19780901</td>
<td style="text-align: left;">19950531</td>
<td style="text-align: right;">14.23</td>
</tr>
<tr class="even">
<td style="text-align: left;">775</td>
<td style="text-align: left;">Reutlingen-Betzingen</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">04166</td>
<td style="text-align: right;">360</td>
<td style="text-align: right;">48.5051</td>
<td style="text-align: right;">9.1833</td>
<td style="text-align: left;">19880501</td>
<td style="text-align: left;">20021231</td>
<td style="text-align: right;">15.29</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6</td>
<td style="text-align: left;">Albstadt-Badkap</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">00071</td>
<td style="text-align: right;">759</td>
<td style="text-align: right;">48.2156</td>
<td style="text-align: right;">8.9784</td>
<td style="text-align: left;">19861101</td>
<td style="text-align: left;">20191231</td>
<td style="text-align: right;">21.20</td>
</tr>
<tr class="even">
<td style="text-align: left;">943</td>
<td style="text-align: left;">Trochtelfingen-Wilsingen</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">05107</td>
<td style="text-align: right;">769</td>
<td style="text-align: right;">48.2814</td>
<td style="text-align: right;">9.3137</td>
<td style="text-align: left;">19880601</td>
<td style="text-align: left;">20031231</td>
<td style="text-align: right;">23.56</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1239</td>
<td style="text-align: left;">UrachBad/Erms</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">19580</td>
<td style="text-align: right;">471</td>
<td style="text-align: right;">48.4951</td>
<td style="text-align: right;">9.4003</td>
<td style="text-align: left;">19750101</td>
<td style="text-align: left;">20051231</td>
<td style="text-align: right;">27.95</td>
</tr>
<tr class="even">
<td style="text-align: left;">656</td>
<td style="text-align: left;">Nagold</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">03432</td>
<td style="text-align: right;">380</td>
<td style="text-align: right;">48.5675</td>
<td style="text-align: right;">8.7179</td>
<td style="text-align: left;">19490101</td>
<td style="text-align: left;">19950331</td>
<td style="text-align: right;">30.79</td>
</tr>
<tr class="odd">
<td style="text-align: left;">115</td>
<td style="text-align: left;">Böblingen</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">00576</td>
<td style="text-align: right;">445</td>
<td style="text-align: right;">48.6759</td>
<td style="text-align: right;">8.9732</td>
<td style="text-align: left;">19870801</td>
<td style="text-align: left;">20031231</td>
<td style="text-align: right;">31.23</td>
</tr>
<tr class="even">
<td style="text-align: left;">651</td>
<td style="text-align: left;">Münsingen-Apfelstetten</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">03402</td>
<td style="text-align: right;">755</td>
<td style="text-align: right;">48.3851</td>
<td style="text-align: right;">9.4837</td>
<td style="text-align: left;">19460101</td>
<td style="text-align: left;">20231231</td>
<td style="text-align: right;">32.10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">699</td>
<td style="text-align: left;">Nürtingen</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">03671</td>
<td style="text-align: right;">280</td>
<td style="text-align: right;">48.6321</td>
<td style="text-align: right;">9.3261</td>
<td style="text-align: left;">19550101</td>
<td style="text-align: left;">19910331</td>
<td style="text-align: right;">32.90</td>
</tr>
<tr class="even">
<td style="text-align: left;">908</td>
<td style="text-align: left;">Stuttgart-Echterdingen</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">04931</td>
<td style="text-align: right;">371</td>
<td style="text-align: right;">48.6883</td>
<td style="text-align: right;">9.2235</td>
<td style="text-align: left;">19530101</td>
<td style="text-align: left;">20231231</td>
<td style="text-align: right;">34.55</td>
</tr>
<tr class="odd">
<td style="text-align: left;">703</td>
<td style="text-align: left;">Oberndorf/Neckar-Aistaig</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">03705</td>
<td style="text-align: right;">475</td>
<td style="text-align: right;">48.3147</td>
<td style="text-align: right;">8.5735</td>
<td style="text-align: left;">19820701</td>
<td style="text-align: left;">20041231</td>
<td style="text-align: right;">36.50</td>
</tr>
<tr class="even">
<td style="text-align: left;">972</td>
<td style="text-align: left;">Waldachtal-Lützenhardt</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">05289</td>
<td style="text-align: right;">595</td>
<td style="text-align: right;">48.4918</td>
<td style="text-align: right;">8.5612</td>
<td style="text-align: left;">19830101</td>
<td style="text-align: left;">20080430</td>
<td style="text-align: right;">37.51</td>
</tr>
<tr class="odd">
<td style="text-align: left;">875</td>
<td style="text-align: left;">Sigmaringen-Laiz</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">04703</td>
<td style="text-align: right;">581</td>
<td style="text-align: right;">48.0719</td>
<td style="text-align: right;">9.1943</td>
<td style="text-align: left;">19510101</td>
<td style="text-align: left;">20231231</td>
<td style="text-align: right;">38.06</td>
</tr>
<tr class="even">
<td style="text-align: left;">552</td>
<td style="text-align: left;">Lenningen-Schopfloch</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">02949</td>
<td style="text-align: right;">758</td>
<td style="text-align: right;">48.5396</td>
<td style="text-align: right;">9.5275</td>
<td style="text-align: left;">19470801</td>
<td style="text-align: left;">20020131</td>
<td style="text-align: right;">38.52</td>
</tr>
<tr class="odd">
<td style="text-align: left;">795</td>
<td style="text-align: left;">Rottweil</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">04300</td>
<td style="text-align: right;">588</td>
<td style="text-align: right;">48.1815</td>
<td style="text-align: right;">8.6356</td>
<td style="text-align: left;">19570201</td>
<td style="text-align: left;">20231231</td>
<td style="text-align: right;">39.16</td>
</tr>
<tr class="even">
<td style="text-align: left;">774</td>
<td style="text-align: left;">Renningen-Ihinger Hof</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">04160</td>
<td style="text-align: right;">478</td>
<td style="text-align: right;">48.7425</td>
<td style="text-align: right;">8.9240</td>
<td style="text-align: left;">19701222</td>
<td style="text-align: left;">20231231</td>
<td style="text-align: right;">39.24</td>
</tr>
<tr class="odd">
<td style="text-align: left;">495</td>
<td style="text-align: left;">Klippeneck</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">02638</td>
<td style="text-align: right;">974</td>
<td style="text-align: right;">48.1054</td>
<td style="text-align: right;">8.7548</td>
<td style="text-align: left;">19470101</td>
<td style="text-align: left;">20231231</td>
<td style="text-align: right;">39.43</td>
</tr>
<tr class="even">
<td style="text-align: left;">904</td>
<td style="text-align: left;">Stuttgart (Neckartal)</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">04926</td>
<td style="text-align: right;">224</td>
<td style="text-align: right;">48.7896</td>
<td style="text-align: right;">9.2167</td>
<td style="text-align: left;">19460101</td>
<td style="text-align: left;">20130514</td>
<td style="text-align: right;">45.07</td>
</tr>
<tr class="odd">
<td style="text-align: left;">298</td>
<td style="text-align: left;">Freudenstadt-Kurgarten</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">01467</td>
<td style="text-align: right;">736</td>
<td style="text-align: right;">48.4607</td>
<td style="text-align: right;">8.4141</td>
<td style="text-align: left;">19480101</td>
<td style="text-align: left;">20091231</td>
<td style="text-align: right;">47.46</td>
</tr>
<tr class="even">
<td style="text-align: left;">299</td>
<td style="text-align: left;">Freudenstadt</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">01468</td>
<td style="text-align: right;">797</td>
<td style="text-align: right;">48.4538</td>
<td style="text-align: right;">8.4090</td>
<td style="text-align: left;">19490101</td>
<td style="text-align: left;">20231231</td>
<td style="text-align: right;">47.73</td>
</tr>
<tr class="odd">
<td style="text-align: left;">665</td>
<td style="text-align: left;">Neuhausen ob Eck</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">03518</td>
<td style="text-align: right;">793</td>
<td style="text-align: right;">47.9760</td>
<td style="text-align: right;">8.9101</td>
<td style="text-align: left;">19710101</td>
<td style="text-align: left;">19931231</td>
<td style="text-align: right;">48.33</td>
</tr>
<tr class="even">
<td style="text-align: left;">906</td>
<td style="text-align: left;">Stuttgart (Schnarrenberg)</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">04928</td>
<td style="text-align: right;">314</td>
<td style="text-align: right;">48.8281</td>
<td style="text-align: right;">9.2000</td>
<td style="text-align: left;">19580101</td>
<td style="text-align: left;">20231231</td>
<td style="text-align: right;">48.92</td>
</tr>
<tr class="odd">
<td style="text-align: left;">222</td>
<td style="text-align: left;">Ebersbach/Fils</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">01102</td>
<td style="text-align: right;">300</td>
<td style="text-align: right;">48.7201</td>
<td style="text-align: right;">9.5328</td>
<td style="text-align: left;">19871101</td>
<td style="text-align: left;">20021231</td>
<td style="text-align: right;">50.35</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p><strong><em>3. Identify suitable weather stations for patching gaps</em></strong></p>
<p>I chose the suitable weather stations based on the distance and start/end years. Here are the list of stations I chose for patching weather data:</p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb206"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">kable</span><span class="op">(</span><span class="va">MS_station_list_dwd</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">7</span><span class="op">)</span>,<span class="op">]</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"List of suitable weather stations for patching weather data"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>List of suitable weather stations for patching weather data</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Station_name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Region</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Station_ID</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Elevation</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Latitude</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Longitude</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Begin</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">End</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Distance</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">386</td>
<td style="text-align: left;">Hechingen</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">02074</td>
<td style="text-align: right;">518</td>
<td style="text-align: right;">48.3752</td>
<td style="text-align: right;">8.9800</td>
<td style="text-align: left;">19470101</td>
<td style="text-align: left;">20231231</td>
<td style="text-align: right;">5.87</td>
</tr>
<tr class="even">
<td style="text-align: left;">794</td>
<td style="text-align: left;">Rottenburg-Kiebingen</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">04294</td>
<td style="text-align: right;">360</td>
<td style="text-align: right;">48.4704</td>
<td style="text-align: right;">8.9687</td>
<td style="text-align: left;">19790701</td>
<td style="text-align: left;">20021031</td>
<td style="text-align: right;">9.87</td>
</tr>
<tr class="odd">
<td style="text-align: left;">775</td>
<td style="text-align: left;">Reutlingen-Betzingen</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">04166</td>
<td style="text-align: right;">360</td>
<td style="text-align: right;">48.5051</td>
<td style="text-align: right;">9.1833</td>
<td style="text-align: left;">19880501</td>
<td style="text-align: left;">20021231</td>
<td style="text-align: right;">15.29</td>
</tr>
<tr class="even">
<td style="text-align: left;">1239</td>
<td style="text-align: left;">UrachBad/Erms</td>
<td style="text-align: left;">Baden-Württemberg Frei</td>
<td style="text-align: left;">19580</td>
<td style="text-align: right;">471</td>
<td style="text-align: right;">48.4951</td>
<td style="text-align: right;">9.4003</td>
<td style="text-align: left;">19750101</td>
<td style="text-align: left;">20051231</td>
<td style="text-align: right;">27.95</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p><strong><em>4. Download weather data for promising stations, convert them to <code>chillR</code> format and compile them in a list</em></strong></p>
<p>Unlike the <code>handle_gsod()</code> function, there is no need to convert to <code>chillR</code> format with an additional line of code with the <code>handle_dwd()</code> function, as seen in the table below.</p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb207"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Download weather data for promising stations</span></span>
<span><span class="va">MS_patch_weather</span> <span class="op">&lt;-</span> <span class="fu">handle_dwd</span><span class="op">(</span>action <span class="op">=</span> <span class="st">"download_weather"</span>,</span>
<span>                            location <span class="op">=</span> <span class="va">MS_station_list_dwd</span><span class="op">$</span><span class="va">Station_ID</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">7</span>,<span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">MS_patch_weather</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span> <span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">YEARMODA</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Day</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Station_ID</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Wind_speed</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Wind_speed_max</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ATM_pressure</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Rainfall</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Snow</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin_5cm</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">RH</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">VPD</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">19160101</td>
<td style="text-align: right;">1916</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">02074</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">19160102</td>
<td style="text-align: right;">1916</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">02074</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19160103</td>
<td style="text-align: right;">1916</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">02074</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">19160104</td>
<td style="text-align: right;">1916</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">02074</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19160105</td>
<td style="text-align: right;">1916</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">02074</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">19160106</td>
<td style="text-align: right;">1916</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">02074</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19160107</td>
<td style="text-align: right;">1916</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">02074</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">19160108</td>
<td style="text-align: right;">1916</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">02074</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19160109</td>
<td style="text-align: right;">1916</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">02074</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">19160110</td>
<td style="text-align: right;">1916</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">02074</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p><strong><em>5. Use the <code>patch_daily_temperatures</code> function to fill gaps</em></strong></p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb208"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">MS_weather</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/MS/STG_chillR_weather.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MS_patched</span> <span class="op">&lt;-</span> <span class="fu">patch_daily_temperatures</span><span class="op">(</span>weather <span class="op">=</span> <span class="va">MS_weather</span>,</span>
<span>                                    patch_weather <span class="op">=</span> <span class="va">MS_patch_weather</span>,</span>
<span>                                    max_mean_bias <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                    max_stdev_bias <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine list elements into a data.frame to display patched statistics</span></span>
<span><span class="va">patched_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">MS_patched</span><span class="op">$</span><span class="va">statistics</span><span class="op">)</span>  </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">patched_stats</span>, <span class="st">"data/MS/patched_stats.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MS_patched_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/MS/patched_stats.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">MS_patched_stats</span>, caption <span class="op">=</span> <span class="st">"Patched Statistics for Mössigen"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Patched Statistics for Mössigen</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">X</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stdev_bias</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">filled</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">gaps_remain</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Rottenburg-Kiebingen.Tmin</td>
<td style="text-align: right;">0.334</td>
<td style="text-align: right;">1.684</td>
<td style="text-align: right;">3300</td>
<td style="text-align: right;">1036</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rottenburg-Kiebingen.Tmax</td>
<td style="text-align: right;">-0.523</td>
<td style="text-align: right;">1.101</td>
<td style="text-align: right;">3300</td>
<td style="text-align: right;">1036</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Reutlingen-Betzingen.Tmin</td>
<td style="text-align: right;">-0.627</td>
<td style="text-align: right;">1.126</td>
<td style="text-align: right;">352</td>
<td style="text-align: right;">684</td>
</tr>
<tr class="even">
<td style="text-align: left;">Reutlingen-Betzingen.Tmax</td>
<td style="text-align: right;">-0.328</td>
<td style="text-align: right;">0.935</td>
<td style="text-align: right;">352</td>
<td style="text-align: right;">684</td>
</tr>
<tr class="odd">
<td style="text-align: left;">UrachBad/Erms.Tmin</td>
<td style="text-align: right;">0.017</td>
<td style="text-align: right;">1.455</td>
<td style="text-align: right;">682</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">UrachBad/Erms.Tmax</td>
<td style="text-align: right;">0.304</td>
<td style="text-align: right;">1.256</td>
<td style="text-align: right;">682</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hechingen.Tmin</td>
<td style="text-align: right;">0.824</td>
<td style="text-align: right;">1.585</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hechingen.Tmax</td>
<td style="text-align: right;">0.355</td>
<td style="text-align: right;">1.205</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb209"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Save for later use</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">MS_patched</span><span class="op">$</span><span class="va">weather</span>, <span class="st">"data/MS/MS_patched_weather.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><br></p>
<p><strong><em>6. Investigate the results— have all gaps been filled?</em></strong></p>
<p>All gaps have been filled as shown in the table.</p>
<div class="cell">
<details class="code-fold"><summary>Show code</summary><div class="sourceCode" id="cb210"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">MS_QC</span> <span class="op">&lt;-</span> <span class="fu">fix_weather</span><span class="op">(</span><span class="va">MS_patched</span><span class="op">)</span><span class="op">$</span><span class="va">QC</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">MS_QC</span>,<span class="st">"data/MS/MS_QC.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MS_patched_QC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/MS/MS_QC.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">MS_patched_QC</span>,</span>
<span>      caption <span class="op">=</span> <span class="st">"Check gaps on patched weather dataset for Mössigen"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"striped"</span>, position <span class="op">=</span> <span class="st">"left"</span>, font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="table table-striped caption-top table-sm small" data-quarto-postprocess="true">
<caption>Check gaps on patched weather dataset for Mössigen</caption>
<thead><tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">X</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Season</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">End_year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Season_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Data_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing_Tmax</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Incomplete_days</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perc_complete</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">1989/1990</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">1990/1991</td>
<td style="text-align: right;">1991</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">1991/1992</td>
<td style="text-align: right;">1992</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">1992/1993</td>
<td style="text-align: right;">1993</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">1993/1994</td>
<td style="text-align: right;">1994</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: left;">1994/1995</td>
<td style="text-align: right;">1995</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: left;">1995/1996</td>
<td style="text-align: right;">1996</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: left;">1996/1997</td>
<td style="text-align: right;">1997</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: left;">1997/1998</td>
<td style="text-align: right;">1998</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: left;">1998/1999</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11</td>
<td style="text-align: left;">1999/2000</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">12</td>
<td style="text-align: left;">2000/2001</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">13</td>
<td style="text-align: left;">2001/2002</td>
<td style="text-align: right;">2002</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">14</td>
<td style="text-align: left;">2002/2003</td>
<td style="text-align: right;">2003</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15</td>
<td style="text-align: left;">2003/2004</td>
<td style="text-align: right;">2004</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">16</td>
<td style="text-align: left;">2004/2005</td>
<td style="text-align: right;">2005</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">17</td>
<td style="text-align: left;">2005/2006</td>
<td style="text-align: right;">2006</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">18</td>
<td style="text-align: left;">2006/2007</td>
<td style="text-align: right;">2007</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19</td>
<td style="text-align: left;">2007/2008</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">20</td>
<td style="text-align: left;">2008/2009</td>
<td style="text-align: right;">2009</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">21</td>
<td style="text-align: left;">2009/2010</td>
<td style="text-align: right;">2010</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">22</td>
<td style="text-align: left;">2010/2011</td>
<td style="text-align: right;">2011</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">23</td>
<td style="text-align: left;">2011/2012</td>
<td style="text-align: right;">2012</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">24</td>
<td style="text-align: left;">2012/2013</td>
<td style="text-align: right;">2013</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">25</td>
<td style="text-align: left;">2013/2014</td>
<td style="text-align: right;">2014</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">26</td>
<td style="text-align: left;">2014/2015</td>
<td style="text-align: right;">2015</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">27</td>
<td style="text-align: left;">2015/2016</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">28</td>
<td style="text-align: left;">2016/2017</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">29</td>
<td style="text-align: left;">2017/2018</td>
<td style="text-align: right;">2018</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="even">
<td style="text-align: right;">30</td>
<td style="text-align: left;">2018/2019</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">365</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
<tr class="odd">
<td style="text-align: right;">31</td>
<td style="text-align: left;">2019/2020</td>
<td style="text-align: right;">2020</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p><strong><em>7. If necessary, repeat until you have a dataset you can work with in further analyses</em></strong></p>
<p>I did repeat the process till I got the most suitable stations (in my opinion). The <code>handle_dwd()</code> ran faster than the <code>handle_gsod()</code>, so I could download all 25 stations within a few seconds. I downloaded all and check the statistics afterwards to see which stations filled the gaps. I initially chose the stations based on distance and overlap years, but then, I thought why not try all and see how it went?</p>
<p>This is what I found:</p>
<ul>
<li><p>The order to download the stations matters.</p></li>
<li><p>At first, I found station 1 is the best choice— closest in distance and it filled all the gaps if I didn’t set threshold for <code>max_mean_bias</code> and <code>max_stdev_bias</code>. So, only one station would have been needed to patch all the gaps if I didn’t mind <code>max_mean_bias</code> values of a few decimal points above 1. (Why one though?)</p></li>
<li><p>When I set those bias values, the station 1 could fill all gaps for <code>Tmin</code> but fill none for <code>Tmax</code>. Since it filled all gaps in <code>Tmin</code>, I think the program assumed that all gaps were filled (maybe the program consider <code>Tmin</code> and <code>Tmax</code> together?) and it would give <code>NA</code> values for all remaining stations I downloaded.</p></li>
<li><p>Since I want the dataset to be patched with values below the bias thresholds, I downloaded the station 1 last (<code>MS_station_list_dwd$Station_ID[c(2,4,7,1)]</code>), and it worked perfectly!</p></li>
</ul>
<p>Another thing I want to add here is I selected the best station from the list generated from the GSOD database, and patched that station with data from DWD database. Practically, I should have chosen the station 1 from the DWD list— I wouldn’t have any gaps and it would have been a better choice in terms of data quality. But, for the sake of doing the following exercises, I must either create gaps or use the station I chose from GSOD database. I chose the latter option because there might be times I could not go back to the past and redo everything— I guess it is a better practice to adapt and keep going.</p>
<p><br></p>
</section></section><section id="chapter-12-generating-temperature-scenarios" class="level2"><h2 class="anchored" data-anchor-id="chapter-12-generating-temperature-scenarios">Chapter 12: Generating temperature scenarios</h2>
<section id="chill-scenarios" class="level3"><h3 class="anchored" data-anchor-id="chill-scenarios">
<span style="color:#71797E">12.1</span>&nbsp; Chill scenarios</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>Information on chill availability (or other agroclimatic conditions) at a given site is crucial for orchard managers selecting tree species and cultivars for their orchards.</p></li>
<li><p>Looking at the historic record has already given us a lot of useful information, but this isn’t yet exactly the information that a grower making planting decisions needs.</p></li>
<li><p>What is really needed is a site-specific agroclimatic characterization that provides an impression of the range of conditions that we can reasonably expect at this location, i.e.&nbsp;how likely it is for the orchard to experience certain levels of chill, heat or whatever other metric we are interested in.</p></li>
</ul>
<p><br></p>
</section><section id="risk-assessment-in-orchard-planning" class="level3"><h3 class="anchored" data-anchor-id="risk-assessment-in-orchard-planning">
<span style="color:#71797E">12.2</span>&nbsp; Risk assessment in orchard planning</h3>
<div style="height: 18px;">

</div>
<ul>
<li><p>Since trees live and are (hopefully) productive for many years, they experience many different temperature dynamics during their productive lifetime.</p></li>
<li><p>For optimal production, trees should fulfill their climatic needs in all of these years.</p></li>
<li><p>This is why, when we select trees for planting, we need information on the plausible range of ‘weathers’ we can expect.</p></li>
<li><p>Based on this, we would be able to select trees that safely fulfill their chilling requirements in all plausible weather situations, or we could choose trees that strike a balance between early flowering and the risk of spring frost.</p></li>
<li><p>All such decisions require information on how likely it is for our orchard to experience certain conditions.</p></li>
<li><p>The plausible range of ‘weathers’ we can expect is defined by the local climate, which is the long-term average of the annually observed weather.</p></li>
<li><p>We can interpret this ‘climate’ as a virtual collection of all possible weather situations for a given location, from which we receive one random draw each year.</p></li>
<li><p>Annual weather can be interpreted as a random draw from the plausible distribution of all possible ‘weathers’.</p></li>
<li><p>For planning purposes, it would be much more useful to know this virtual distribution of possible ‘weathers’ than just looking at the random samples that happened to be drawn.</p></li>
<li><p>So far, we’ve only been able to get these samples - that was the historic analysis of observed chill.</p></li>
<li><p>We’ll try to get to the actual climate, and from there to ways to use this knowledge for producing temperature profiles for locations of interest that facilitate orchard planning.</p></li>
</ul>
<!-- -->
</section></section></main><!-- /main column --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb211" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Tree Phenology Analysis with R"</span></span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "***A Learning Logbook***"</span></span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "SM"</span></span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r format(Sys.time(), '%B %d, %Y')`"</span></span>
<span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb211-7"><a href="#cb211-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb211-8"><a href="#cb211-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb211-9"><a href="#cb211-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-float: true</span></span>
<span id="cb211-10"><a href="#cb211-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-title: "Contents"</span></span>
<span id="cb211-11"><a href="#cb211-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 9</span></span>
<span id="cb211-12"><a href="#cb211-12" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb211-13"><a href="#cb211-13" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: false</span></span>
<span id="cb211-14"><a href="#cb211-14" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-caption: true</span></span>
<span id="cb211-15"><a href="#cb211-15" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb211-16"><a href="#cb211-16" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb211-17"><a href="#cb211-17" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: 'Show code'</span></span>
<span id="cb211-18"><a href="#cb211-18" aria-hidden="true" tabindex="-1"></a><span class="co">    code-link: true</span></span>
<span id="cb211-19"><a href="#cb211-19" aria-hidden="true" tabindex="-1"></a><span class="co">    code-highlight: solarized-light</span></span>
<span id="cb211-20"><a href="#cb211-20" aria-hidden="true" tabindex="-1"></a><span class="co">    code-download: true</span></span>
<span id="cb211-21"><a href="#cb211-21" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: journal</span></span>
<span id="cb211-22"><a href="#cb211-22" aria-hidden="true" tabindex="-1"></a><span class="co">    highlight: solarized-light</span></span>
<span id="cb211-23"><a href="#cb211-23" aria-hidden="true" tabindex="-1"></a><span class="co">    smooth-scroll: true</span></span>
<span id="cb211-24"><a href="#cb211-24" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb211-25"><a href="#cb211-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-26"><a href="#cb211-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE, message  = FALSE, warning = F}</span></span>
<span id="cb211-27"><a href="#cb211-27" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(echo = TRUE,  message = FALSE,  warning = FALSE,  tidy = TRUE)</span></span>
<span id="cb211-28"><a href="#cb211-28" aria-hidden="true" tabindex="-1"></a><span class="in">library(chillR)</span></span>
<span id="cb211-29"><a href="#cb211-29" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb211-30"><a href="#cb211-30" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb211-31"><a href="#cb211-31" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyr)</span></span>
<span id="cb211-32"><a href="#cb211-32" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)</span></span>
<span id="cb211-33"><a href="#cb211-33" aria-hidden="true" tabindex="-1"></a><span class="in">library(pander)</span></span>
<span id="cb211-34"><a href="#cb211-34" aria-hidden="true" tabindex="-1"></a><span class="in">library(kableExtra)</span></span>
<span id="cb211-35"><a href="#cb211-35" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb211-36"><a href="#cb211-36" aria-hidden="true" tabindex="-1"></a><span class="in">library(tibble)</span></span>
<span id="cb211-37"><a href="#cb211-37" aria-hidden="true" tabindex="-1"></a><span class="in">library(lubridate)</span></span>
<span id="cb211-38"><a href="#cb211-38" aria-hidden="true" tabindex="-1"></a><span class="in">library(reshape2)</span></span>
<span id="cb211-39"><a href="#cb211-39" aria-hidden="true" tabindex="-1"></a><span class="in">library(downlit)</span></span>
<span id="cb211-40"><a href="#cb211-40" aria-hidden="true" tabindex="-1"></a><span class="in">library(xml2)</span></span>
<span id="cb211-41"><a href="#cb211-41" aria-hidden="true" tabindex="-1"></a><span class="in">library(stats)</span></span>
<span id="cb211-42"><a href="#cb211-42" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-43"><a href="#cb211-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-44"><a href="#cb211-44" aria-hidden="true" tabindex="-1"></a>&lt;style&gt;</span>
<span id="cb211-45"><a href="#cb211-45" aria-hidden="true" tabindex="-1"></a>    body { <span class="kw">background-color</span><span class="ch">:</span>  <span class="cn">#F0FFFF</span><span class="op">;</span> }</span>
<span id="cb211-46"><a href="#cb211-46" aria-hidden="true" tabindex="-1"></a>    pre<span class="op">,</span> pre<span class="in">:not(</span><span class="ex">[</span><span class="ss">class</span><span class="ex">]</span><span class="in">)</span> { <span class="kw">background-color</span><span class="ch">:</span> <span class="cn">#d7f4f4</span><span class="op">;</span> }</span>
<span id="cb211-47"><a href="#cb211-47" aria-hidden="true" tabindex="-1"></a>&lt;/style&gt;</span>
<span id="cb211-48"><a href="#cb211-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-49"><a href="#cb211-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-50"><a href="#cb211-50" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-51"><a href="#cb211-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-52"><a href="#cb211-52" aria-hidden="true" tabindex="-1"></a>***This document records my notes and progress in the course titled "Tree Phenology Analysis with R."***</span>
<span id="cb211-53"><a href="#cb211-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-54"><a href="#cb211-54" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-55"><a href="#cb211-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-56"><a href="#cb211-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-57"><a href="#cb211-57" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 3: Tree Dormancy</span></span>
<span id="cb211-58"><a href="#cb211-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-59"><a href="#cb211-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-60"><a href="#cb211-60" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;3.1&lt;/span&gt;&amp;nbsp; Introduction to dormancy</span></span>
<span id="cb211-61"><a href="#cb211-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-62"><a href="#cb211-62" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-63"><a href="#cb211-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-64"><a href="#cb211-64" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Fruit trees go into dormant state to survive unfavorable conditions in winter</span>
<span id="cb211-65"><a href="#cb211-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-66"><a href="#cb211-66" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Dormancy phases: </span>
<span id="cb211-67"><a href="#cb211-67" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**Dormancy establishment** (controlled by environmental signals<span class="dv">&amp;mdash;</span> Day length/photoperiod, Temperature)</span>
<span id="cb211-68"><a href="#cb211-68" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**Endo-dormancy** (controlled by plants' endogenous factors<span class="dv">&amp;mdash;</span> their abilities to grow even in unfavorable conditions; a period of rest and then regrow/ endo-dormancy is overcome once the trees have experienced a certain level of chill but they don't immediately resume growth)</span>
<span id="cb211-69"><a href="#cb211-69" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**Eco-dormancy** (trees are acclimated<span class="dv">&amp;mdash;</span> no morphological changes, but not deeply dormant; (warm) temp is the main environmental driver)</span>
<span id="cb211-70"><a href="#cb211-70" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**Growth resumption** (first apparent morphological changes occur in end of winter or earliest spring depending on species and cultivars<span class="dv">&amp;mdash;</span> trees quickly un-acclimatized to grow and become sensitive to freezing temperature before buds burst? Warm temp promotes growth)</span>
<span id="cb211-71"><a href="#cb211-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-72"><a href="#cb211-72" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-73"><a href="#cb211-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-74"><a href="#cb211-74" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Physiological processes that regulate dormancy</span>
<span id="cb211-75"><a href="#cb211-75" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**Transport at both whole-plant and cellular level:** The transport of water and solutes stop during dormancy both at the whole plant and cellular levels within the meristems.</span>
<span id="cb211-76"><a href="#cb211-76" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**Phytohormone dynamics:** Plant hormones are short and long distance signalling compounds acting in a very low concentrations. Myoregulators for plants growth and development, as well as mediate responses to biotic and abiotic stressors. </span>
<span id="cb211-77"><a href="#cb211-77" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**Genetic and epigenetic regulation:** A group of genes related to dormancy<span class="dv">&amp;mdash;</span> regulation of bad dormancy.</span>
<span id="cb211-78"><a href="#cb211-78" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**Dynamics of nonstructural carbohydrates:** Non-structural carbohydrates have three main functions<span class="dv">&amp;dash;</span> energy esterase?, transport and supply, and osmotic regulation and signaling (these varies within and between seasons).</span>
<span id="cb211-79"><a href="#cb211-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-80"><a href="#cb211-80" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-81"><a href="#cb211-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-82"><a href="#cb211-82" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;3.2&lt;/span&gt;&amp;nbsp; Dormancy physiology</span></span>
<span id="cb211-83"><a href="#cb211-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-84"><a href="#cb211-84" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-85"><a href="#cb211-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-86"><a href="#cb211-86" aria-hidden="true" tabindex="-1"></a><span class="al">![](./pic/ch3_1.png)</span></span>
<span id="cb211-87"><a href="#cb211-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-88"><a href="#cb211-88" aria-hidden="true" tabindex="-1"></a>Reference: <span class="co">[</span><span class="ot">*A Conceptual Framework for Winter Dormancy in Deciduous Trees (Fadón et al., 2020)*</span><span class="co">](https://www.mdpi.com/2073-4395/10/2/241)</span></span>
<span id="cb211-89"><a href="#cb211-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-90"><a href="#cb211-90" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-91"><a href="#cb211-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-92"><a href="#cb211-92" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;3.3&lt;/span&gt;&amp;nbsp; Experimental and statistical determination of the chilling and forcing periods</span></span>
<span id="cb211-93"><a href="#cb211-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-94"><a href="#cb211-94" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-95"><a href="#cb211-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-96"><a href="#cb211-96" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>High chill accumulation during endodormancy advances flowering dates, but similarly cool temperatures during ecodormancy may cause flowering delays. </span>
<span id="cb211-97"><a href="#cb211-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-98"><a href="#cb211-98" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Endo- and eco- dormancy occur under the same phenological stage, but the temperatures have the opposite effect on flowering according to the dormancy phase. </span>
<span id="cb211-99"><a href="#cb211-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-100"><a href="#cb211-100" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Endo- Vs. Eco- dormancy phase differentiation: </span>
<span id="cb211-101"><a href="#cb211-101" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**Empirically** (See if there is growth after chilling period<span class="dv">&amp;mdash;</span> whether the chill period is overcome to allow forcing period)</span>
<span id="cb211-102"><a href="#cb211-102" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**Statistically** (Long phenological data sets and temperature records<span class="dv">&amp;mdash;</span> estimate the date of chilling fulfillment based on the long series of phenological observations, flowering dates and relating them with previous temperature records)</span>
<span id="cb211-103"><a href="#cb211-103" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-104"><a href="#cb211-104" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-105"><a href="#cb211-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-106"><a href="#cb211-106" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`chillR`</span> package to perform PLS analysis with phenology data and temperature, which gives two outputs:</span>
<span id="cb211-107"><a href="#cb211-107" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**Model coefficients** which indicate the strength and the sense of the influence </span>
<span id="cb211-108"><a href="#cb211-108" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**Variable important in the projections (VIP)**, which points out the significant importance of the model coefficient values<span class="dv">&amp;mdash;</span> values from 0.8 are considered significant??</span>
<span id="cb211-109"><a href="#cb211-109" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb211-110"><a href="#cb211-110" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-111"><a href="#cb211-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-112"><a href="#cb211-112" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;3.4&lt;/span&gt;&amp;nbsp; Phenology record and BBCH scale</span></span>
<span id="cb211-113"><a href="#cb211-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-114"><a href="#cb211-114" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-115"><a href="#cb211-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-116"><a href="#cb211-116" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Phenology** is the study of periodic events in **biological life cycles** (e.g. seasonal changes in trees) and how these are influenced **by seasonal and interannual variations** in climate.</span>
<span id="cb211-117"><a href="#cb211-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-118"><a href="#cb211-118" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Application of phenology in agriculture:</span>
<span id="cb211-119"><a href="#cb211-119" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Select suitable crops and varieties (to organize the cropping schedules, organize the crop rotation)</span>
<span id="cb211-120"><a href="#cb211-120" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Forecasts of plant development and harvest dates (e.g. to evaluate the risk of frost damage)</span>
<span id="cb211-121"><a href="#cb211-121" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Timing of the agricultural practices<span class="dv">&amp;mdash;</span> irrigation, fertilization, crop protection, etc. </span>
<span id="cb211-122"><a href="#cb211-122" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-123"><a href="#cb211-123" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-124"><a href="#cb211-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-125"><a href="#cb211-125" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Trees go through many developmental stages over the course of the year, and these are usually referred to by a two-digit code. &lt;span style="color:grey"&gt;*(Read more [here.](https://www.openagrar.de/servlets/MCRFileNodeServlet/openagrar_derivate_00010428/BBCH-Skala_en.pdf))*&lt;/span&gt;</span>
<span id="cb211-126"><a href="#cb211-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-127"><a href="#cb211-127" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Principal growth stages<span class="dv">&amp;mdash;</span> describe time spans (0-9)</span>
<span id="cb211-128"><a href="#cb211-128" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Secondary growth stages<span class="dv">&amp;mdash;</span> precise steps in plant development (0-9)</span>
<span id="cb211-129"><a href="#cb211-129" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb211-130"><a href="#cb211-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-131"><a href="#cb211-131" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-132"><a href="#cb211-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-133"><a href="#cb211-133" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;3.5&lt;/span&gt;&amp;nbsp; Exercises on tree dormancy</span></span>
<span id="cb211-134"><a href="#cb211-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-135"><a href="#cb211-135" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-136"><a href="#cb211-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-137"><a href="#cb211-137" aria-hidden="true" tabindex="-1"></a>***1. Put yourself in the place of a breeder who wants to calculate the temperature requirements of a newly released cultivar. Which method will you use to calculate the chilling and forcing periods? Please justify your answer.***</span>
<span id="cb211-138"><a href="#cb211-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-139"><a href="#cb211-139" aria-hidden="true" tabindex="-1"></a>As a breeder, I will use the empirical method rather than the statistical method to calculate the chilling and forcing periods in this particular case, for two reasons:</span>
<span id="cb211-140"><a href="#cb211-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-141"><a href="#cb211-141" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It requires little statistical expertise, as many breeders may not have in-depth statistical expertise, and hiring an expert could incur extra costs.</span>
<span id="cb211-142"><a href="#cb211-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-143"><a href="#cb211-143" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The statistical method relies on long phenological data sets and temperature records. Since this cultivar is newly released, such longitudinal data sets and records may not be available for statistical computation.</span>
<span id="cb211-144"><a href="#cb211-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-145"><a href="#cb211-145" aria-hidden="true" tabindex="-1"></a>Anyway, after I looked up the definition of plant breeder, they are scientists, so statistics may not be a problem. In that case, start with empirical first and then combine with statistical method as more data accumulates. 😁</span>
<span id="cb211-146"><a href="#cb211-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-147"><a href="#cb211-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-148"><a href="#cb211-148" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-149"><a href="#cb211-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-150"><a href="#cb211-150" aria-hidden="true" tabindex="-1"></a>***2. Which are the advantages (2) of the BBCH scale compared with earlier scales?***</span>
<span id="cb211-151"><a href="#cb211-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-152"><a href="#cb211-152" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Covers the whole development of the plant, rather than development of only the flower buds as in the traditional scale</span>
<span id="cb211-153"><a href="#cb211-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-154"><a href="#cb211-154" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Provides a general frame for all the species, while the traditional scale is species specific</span>
<span id="cb211-155"><a href="#cb211-155" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb211-156"><a href="#cb211-156" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-157"><a href="#cb211-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-158"><a href="#cb211-158" aria-hidden="true" tabindex="-1"></a>***3. Classify the following phenological stages of sweet cherry according to the BBCH scale:***</span>
<span id="cb211-159"><a href="#cb211-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-160"><a href="#cb211-160" aria-hidden="true" tabindex="-1"></a><span class="al">![***Phenological stages of cherry***](./pic/ch3_2.png)</span></span>
<span id="cb211-161"><a href="#cb211-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-162"><a href="#cb211-162" aria-hidden="true" tabindex="-1"></a>From left to right:</span>
<span id="cb211-163"><a href="#cb211-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-164"><a href="#cb211-164" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>BBCH stage 54 (Inflorescence enclosed by light green scales)</span>
<span id="cb211-165"><a href="#cb211-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-166"><a href="#cb211-166" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>BBCH stage 65 (Full flowering: at least 50% of flowers open, first petals falling)</span>
<span id="cb211-167"><a href="#cb211-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-168"><a href="#cb211-168" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>BBCH stage 89 (Fruit ripe for harvesting for immediate consumption<span class="dv">&amp;mdash;</span> fruit have typical taste and firmness)</span>
<span id="cb211-169"><a href="#cb211-169" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>&lt;span style="color:grey"&gt;*I chose stage 89, rather than the fruit-picking stage 87, due to the cherries' uniform and rich red color. However, further assessment of their firmness, taste, and aroma is required to accurately confirm the stage.*&lt;/span&gt;</span>
<span id="cb211-170"><a href="#cb211-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-171"><a href="#cb211-171" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-172"><a href="#cb211-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-173"><a href="#cb211-173" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 4: Climate change and impact projection</span></span>
<span id="cb211-174"><a href="#cb211-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-175"><a href="#cb211-175" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;4.1&lt;/span&gt;&amp;nbsp; The drivers of climate change</span></span>
<span id="cb211-176"><a href="#cb211-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-177"><a href="#cb211-177" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-178"><a href="#cb211-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-179"><a href="#cb211-179" aria-hidden="true" tabindex="-1"></a>In this lecture, I learned about how the climate changes occurs, as well as the main and long-term drivers of climate change. I also learned about the impact of greenhouse gases on recent global warming<span class="dv">&amp;mdash;</span> particularly CO~2~, CH~4~ and N~2~O in the atmosphere.</span>
<span id="cb211-180"><a href="#cb211-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-181"><a href="#cb211-181" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-182"><a href="#cb211-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-183"><a href="#cb211-183" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;4.2&lt;/span&gt;&amp;nbsp; What we’ve already seen</span></span>
<span id="cb211-184"><a href="#cb211-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-185"><a href="#cb211-185" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-186"><a href="#cb211-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-187"><a href="#cb211-187" aria-hidden="true" tabindex="-1"></a>This lecture taught me about the alarming increase in global temperatures in recent decades due to human activities, and how even a slight rise in temperature can cause significant shifts in the Earth's land areas. The lecture also discussed these trends on a global scale, as well as specifically in Germany. Additionally, there was a brief discussion on precipitation trends in Germany.</span>
<span id="cb211-188"><a href="#cb211-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-189"><a href="#cb211-189" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-190"><a href="#cb211-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-191"><a href="#cb211-191" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;4.3&lt;/span&gt;&amp;nbsp; Future scenarios</span></span>
<span id="cb211-192"><a href="#cb211-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-193"><a href="#cb211-193" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-194"><a href="#cb211-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-195"><a href="#cb211-195" aria-hidden="true" tabindex="-1"></a>I learned a lot about future climate projections and the process to make those projections (RCP, GCM, downscaling, etc) in this lecture. I also learned about the importance of impact models<span class="dv">&amp;mdash;</span> even after we achieved perfect climate projections, there is a need for multiple impact models, as there will still be uncertainty about the biological responses and how we should describe them. There was also a nice discussion on how the changes in the ocean circulation and other tipping points can drive climate change. The lecture also emphasized the importance of being concerned about the future and taking action now to ensure future generations can experience the same world we live in.</span>
<span id="cb211-196"><a href="#cb211-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-197"><a href="#cb211-197" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-198"><a href="#cb211-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-199"><a href="#cb211-199" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;4.4&lt;/span&gt;&amp;nbsp; Impact projection approaches</span></span>
<span id="cb211-200"><a href="#cb211-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-201"><a href="#cb211-201" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-202"><a href="#cb211-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-203"><a href="#cb211-203" aria-hidden="true" tabindex="-1"></a>I learned about different models in making predictions for the future. The lecture compares between the four climate project models, and discussed in details the advantages and the disadvantages of each. There is also a nice instruction on how we should build a model in the beginning<span class="dv">&amp;mdash;</span> we may not want to go into detail for each aspect, but try to cover all aspects in a broader sense. </span>
<span id="cb211-204"><a href="#cb211-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-205"><a href="#cb211-205" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-206"><a href="#cb211-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-207"><a href="#cb211-207" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;4.5&lt;/span&gt;&amp;nbsp; Exercises on climate change</span></span>
<span id="cb211-208"><a href="#cb211-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-209"><a href="#cb211-209" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-210"><a href="#cb211-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-211"><a href="#cb211-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-212"><a href="#cb211-212" aria-hidden="true" tabindex="-1"></a>***1. List the main drivers of climate change at the decade to century scale, and briefly explain the mechanism through which the currently most important driver affects our climate.***</span>
<span id="cb211-213"><a href="#cb211-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-214"><a href="#cb211-214" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-215"><a href="#cb211-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-216"><a href="#cb211-216" aria-hidden="true" tabindex="-1"></a>***2. Explain briefly what is special about temperature dynamics of recent decades, and why we have good reasons to be concerned.***</span>
<span id="cb211-217"><a href="#cb211-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-218"><a href="#cb211-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-219"><a href="#cb211-219" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-220"><a href="#cb211-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-221"><a href="#cb211-221" aria-hidden="true" tabindex="-1"></a>***3. What does the abbreviation 'RCP' stand for, how are RCPs defined, and what is their role in projecting future climates?***</span>
<span id="cb211-222"><a href="#cb211-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-223"><a href="#cb211-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-224"><a href="#cb211-224" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-225"><a href="#cb211-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-226"><a href="#cb211-226" aria-hidden="true" tabindex="-1"></a>***4. Briefly describe the 4 climate impact projection methods described in the fourth video.***</span>
<span id="cb211-227"><a href="#cb211-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-228"><a href="#cb211-228" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-229"><a href="#cb211-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-230"><a href="#cb211-230" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 5: Winter chill projections</span></span>
<span id="cb211-231"><a href="#cb211-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-232"><a href="#cb211-232" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;5.1&lt;/span&gt;&amp;nbsp; Winter chill projections</span></span>
<span id="cb211-233"><a href="#cb211-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-234"><a href="#cb211-234" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;5.1.1&lt;/span&gt;&amp;nbsp; Winter chill in Oman</span></span>
<span id="cb211-235"><a href="#cb211-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-236"><a href="#cb211-236" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-237"><a href="#cb211-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-238"><a href="#cb211-238" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To calculate nutrient budgets for the oases in the Sultanate of Oman, by measuring the yields of the various fruit trees there</span>
<span id="cb211-239"><a href="#cb211-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-240"><a href="#cb211-240" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>But, many of the trees in the oasis system did not produce fruits in the years of analysis</span>
<span id="cb211-241"><a href="#cb211-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-242"><a href="#cb211-242" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A hypothesis for that was "the lack of chilling," due to most of the trees in these high-altitude oases were not the typical species of the Arabian Peninsula, but temperate trees</span>
<span id="cb211-243"><a href="#cb211-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-244"><a href="#cb211-244" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>So, from focusing on nutrient budget to chilling hours</span>
<span id="cb211-245"><a href="#cb211-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-246"><a href="#cb211-246" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Chilling Hours model<span class="dv">&amp;mdash;</span> this model can’t really be trusted, especially in a warm location</span>
<span id="cb211-247"><a href="#cb211-247" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Placed temperature loggers in three oases at different levels of elevation, which allowed studying chill accumulation along an elevation gradient (can't collect meaningful data for a reasonable period of time )</span>
<span id="cb211-248"><a href="#cb211-248" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>So, obtain data from an official long-term weather station is located in the vicinity, near the top of the valley, roughly 1000 m above the lowest oasis<span class="dv">&amp;mdash;</span> data not representative of all the locations along the elevation gradient</span>
<span id="cb211-249"><a href="#cb211-249" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>So, use the records from the oases to define transfer functions that allowed deriving oasis temperatures from long-term data</span>
<span id="cb211-250"><a href="#cb211-250" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Set the transfer functions up (using PLS<span class="dv">&amp;mdash;</span> not a good idea?) to directly calculate hourly temperatures in the oases from the daily records of the official station at Saiq</span>
<span id="cb211-251"><a href="#cb211-251" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Regression between temperature at Saiq and temperature in three oases to calculate winter chill dynamics over the entire time span covered by the official weather station (Hourly data were needed to calculate the number of Chilling Hours)</span>
<span id="cb211-252"><a href="#cb211-252" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-253"><a href="#cb211-253" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-254"><a href="#cb211-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-255"><a href="#cb211-255" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Weather generators to add future climate scenarios</span>
<span id="cb211-256"><a href="#cb211-256" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>*Weather generators are tools that can produce random draws of plausible weather, based on observed weather for a particular location.*</span>
<span id="cb211-257"><a href="#cb211-257" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Fed the LARS-WG weather generator with the data (we had) for the highest-elevation oasis and told it to generate plausible weather for a number of years</span>
<span id="cb211-258"><a href="#cb211-258" aria-hidden="true" tabindex="-1"></a><span class="ss">        - </span>Request the generator to produce the highest-elevation oasis and told it to generate plausible weather for a number of years</span>
<span id="cb211-259"><a href="#cb211-259" aria-hidden="true" tabindex="-1"></a><span class="ss">        - </span>Result: Chill prospects for 1°C and 2°C warming scenarios</span>
<span id="cb211-260"><a href="#cb211-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-261"><a href="#cb211-261" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-262"><a href="#cb211-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-263"><a href="#cb211-263" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-264"><a href="#cb211-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-265"><a href="#cb211-265" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;5.1.2&lt;/span&gt;&amp;nbsp; Chill model sensitivity</span></span>
<span id="cb211-266"><a href="#cb211-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-267"><a href="#cb211-267" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-268"><a href="#cb211-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-269"><a href="#cb211-269" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In projecting climate change impacts on winter chill in the Central Valley, one of the world’s most productive regions for temperate fruit trees, **the choice of chill model matters a lot**</span>
<span id="cb211-270"><a href="#cb211-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-271"><a href="#cb211-271" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Created a bunch of temperature scenarios for multiple locations and calculated how chill accumulation was likely to change in the future, according to multiple chill models</span>
<span id="cb211-272"><a href="#cb211-272" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Looked at what changes the various models predicted for the same locations and the same future scenarios</span>
<span id="cb211-273"><a href="#cb211-273" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>The chill projection results varied considerably across the four models<span class="dv">&amp;mdash;</span> **strong indication that not all models can be right**</span>
<span id="cb211-274"><a href="#cb211-274" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Based on the literature, as well as on another study <span class="co">[</span><span class="ot">(Luedeling et al., 2009d)</span><span class="co">](https://www.sciencedirect.com/science/article/pii/S0168192309001580)</span>, Dynamic Model was concluded to be the most reliable one<span class="dv">&amp;mdash;</span> used mostly in this course</span>
<span id="cb211-275"><a href="#cb211-275" aria-hidden="true" tabindex="-1"></a><span class="ss">          - </span>But, the Dynamic model is too complicated (cumbersome, error-prone and boring)</span>
<span id="cb211-276"><a href="#cb211-276" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb211-277"><a href="#cb211-277" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-278"><a href="#cb211-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-279"><a href="#cb211-279" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;5.1.3&lt;/span&gt;&amp;nbsp; Winter chill in California</span></span>
<span id="cb211-280"><a href="#cb211-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-281"><a href="#cb211-281" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-282"><a href="#cb211-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-283"><a href="#cb211-283" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To produce a winter chill projection for California's fruit and nut growing region<span class="dv">&amp;mdash;</span> the Central Valley</span>
<span id="cb211-284"><a href="#cb211-284" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Multiple scenarios (20 or so) for records of all 100+ weather stations in California (automate processing steps)</span>
<span id="cb211-285"><a href="#cb211-285" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-286"><a href="#cb211-286" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-287"><a href="#cb211-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-288"><a href="#cb211-288" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Result: produce projections for all stations, which consisted of chill accumulation over 100 plausible winter seasons per scenario, generated with a weather generator</span>
<span id="cb211-289"><a href="#cb211-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-290"><a href="#cb211-290" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Summarize the data by defining a metric called ‘Safe Winter Chill’. </span>
<span id="cb211-291"><a href="#cb211-291" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>This is the 10th percentile of the chill distribution, i.e. the amount of chill that is exceeded in 90% of all years, derived from the ‘replicates’ of annual temperature dynamics produced by the weather generator </span>
<span id="cb211-292"><a href="#cb211-292" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Economically, it may be feasible to grow a tree cultivar that requires this much chill. </span>
<span id="cb211-293"><a href="#cb211-293" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-294"><a href="#cb211-294" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-295"><a href="#cb211-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-296"><a href="#cb211-296" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Source: <span class="co">[</span><span class="ot">(Luedeling et al.,2009d)</span><span class="co">](https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0006166)</span></span>
<span id="cb211-297"><a href="#cb211-297" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-298"><a href="#cb211-298" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-299"><a href="#cb211-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-300"><a href="#cb211-300" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;5.1.4&lt;/span&gt;&amp;nbsp; Winter chill ratios</span></span>
<span id="cb211-301"><a href="#cb211-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-302"><a href="#cb211-302" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-303"><a href="#cb211-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-304"><a href="#cb211-304" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To produce a chill projection for the whole planet, using data from the Global Summary of the Day database</span>
<span id="cb211-305"><a href="#cb211-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-306"><a href="#cb211-306" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Processed data for about 5000 globally distributed weather stations, for which multiple chill metrics were calculated</span>
<span id="cb211-307"><a href="#cb211-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-308"><a href="#cb211-308" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To compare chill models, the ratio between various chill metrics was calculated for each weather station in the data set.</span>
<span id="cb211-309"><a href="#cb211-309" aria-hidden="true" tabindex="-1"></a><span class="ss">    -  </span>Had these ratios been largely constant all over the planet (e.g. one Chill Portion always corresponds to 10 Chilling Hours), we would have been fairly safe using any of the chill models.</span>
<span id="cb211-310"><a href="#cb211-310" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Unfortunately, this wasn’t the case, with enormous variation in chill metric ratios around the world.</span>
<span id="cb211-311"><a href="#cb211-311" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-312"><a href="#cb211-312" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-313"><a href="#cb211-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-314"><a href="#cb211-314" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Source: <span class="co">[</span><span class="ot">(Luedeling &amp; Brown, 2011a)</span><span class="co">](https://link.springer.com/article/10.1007/s00484-010-0352-y)</span></span>
<span id="cb211-315"><a href="#cb211-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-316"><a href="#cb211-316" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-317"><a href="#cb211-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-318"><a href="#cb211-318" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;5.1.5&lt;/span&gt;&amp;nbsp; A global pojection of future winter chill</span></span>
<span id="cb211-319"><a href="#cb211-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-320"><a href="#cb211-320" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-321"><a href="#cb211-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-322"><a href="#cb211-322" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Produce a global projection of the likely impacts of climate change on winter chill</span>
<span id="cb211-323"><a href="#cb211-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-324"><a href="#cb211-324" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Projected decline in winter chill<span class="dv">&amp;mdash;</span> it seems unlikely that growers will remain able to grow the tree cultivars they currently rely on with such dramatic chill losses</span>
<span id="cb211-325"><a href="#cb211-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-326"><a href="#cb211-326" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Source: <span class="co">[</span><span class="ot">(Luedeling et al., 2011b)</span><span class="co">](https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0020155)</span></span>
<span id="cb211-327"><a href="#cb211-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-328"><a href="#cb211-328" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-329"><a href="#cb211-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-330"><a href="#cb211-330" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;5.1.6&lt;/span&gt;&amp;nbsp; Winter chill in Germany</span></span>
<span id="cb211-331"><a href="#cb211-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-332"><a href="#cb211-332" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-333"><a href="#cb211-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-334"><a href="#cb211-334" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Germany is not highlighted as particularly vulnerable to chill losses.</span>
<span id="cb211-335"><a href="#cb211-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-336"><a href="#cb211-336" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The reason for this lack of major changes is that current winter temperatures in Germany are right in the middle of what appears to be the most effective temperature range for chill accumulation.</span>
<span id="cb211-337"><a href="#cb211-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-338"><a href="#cb211-338" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Source: <span class="co">[</span><span class="ot">(Luedeling et al., 2009a)</span><span class="co">](https://link.springer.com/article/10.1007/s10341-009-0085-4)</span></span>
<span id="cb211-339"><a href="#cb211-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-340"><a href="#cb211-340" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-341"><a href="#cb211-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-342"><a href="#cb211-342" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;5.1.7&lt;/span&gt;&amp;nbsp; Winter chill in Tunisia</span></span>
<span id="cb211-343"><a href="#cb211-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-344"><a href="#cb211-344" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-345"><a href="#cb211-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-346"><a href="#cb211-346" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Models: SRES, GCMs, RCPs</span>
<span id="cb211-347"><a href="#cb211-347" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>The so-called SRES emissions scenarios (named after the IPCC Special Report on Emissions Scenarios), usually focusing on the three most commonly used scenarios B2, A1B and A2</span>
<span id="cb211-348"><a href="#cb211-348" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>‘General Circulation Models’ (GCMs; many people also use an alternative long form: ‘Global Climate Models’)</span>
<span id="cb211-349"><a href="#cb211-349" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>‘Representative Concentration Pathways’ (RCPs) to replace the SRES scenarios</span>
<span id="cb211-350"><a href="#cb211-350" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-351"><a href="#cb211-351" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-352"><a href="#cb211-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-353"><a href="#cb211-353" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>No way of deciding which of these models, if any, is right<span class="dv">&amp;mdash;</span> should produce *ensemble* forecasts, i.e. project changes using outputs from all the available models (that are considered credible)</span>
<span id="cb211-354"><a href="#cb211-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-355"><a href="#cb211-355" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Produce chill distribution at a particular point in time using a weather generator that is accessed by <span class="in">`chillR`</span>. </span>
<span id="cb211-356"><a href="#cb211-356" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>This weather generator is calibrated with observed weather data and provided with an estimate of how various climate metrics differed from the long-term average climate in 1975, 2000 and 2015.</span>
<span id="cb211-357"><a href="#cb211-357" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>With this information, we can generate a large number of artificial yearly weather records that might have occurred at these points in time.</span>
<span id="cb211-358"><a href="#cb211-358" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-359"><a href="#cb211-359" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-360"><a href="#cb211-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-361"><a href="#cb211-361" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The weather generator was also used to produce future scenarios. </span>
<span id="cb211-362"><a href="#cb211-362" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>In the case of Pistachios in Tunisia, the tool is calibrated with observed data, but the scenarios that were added were not derived from the historic record, but extracted from the AFRICLIM database.</span>
<span id="cb211-363"><a href="#cb211-363" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-364"><a href="#cb211-364" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-365"><a href="#cb211-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-366"><a href="#cb211-366" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;5.1.8&lt;/span&gt;&amp;nbsp; Winter chill in Chile</span></span>
<span id="cb211-367"><a href="#cb211-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-368"><a href="#cb211-368" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-369"><a href="#cb211-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-370"><a href="#cb211-370" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A tool that could quickly access single-location data for weather stations anywhere on the planet: ClimateWizard</span>
<span id="cb211-371"><a href="#cb211-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-372"><a href="#cb211-372" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-373"><a href="#cb211-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-374"><a href="#cb211-374" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;5.1.9&lt;/span&gt;&amp;nbsp; Chill projection for Patagonia</span></span>
<span id="cb211-375"><a href="#cb211-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-376"><a href="#cb211-376" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-377"><a href="#cb211-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-378"><a href="#cb211-378" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Looked into the climatic suitability for fruit and nut trees near agriculture’s southern frontier - in Patagonia, in southern Argentina <span class="co">[</span><span class="ot">(del Barrio et al., 2020)</span><span class="co">](https://rmets.onlinelibrary.wiley.com/doi/pdf/10.1002/joc.6649)</span>.</span>
<span id="cb211-379"><a href="#cb211-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-380"><a href="#cb211-380" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Used the weather station records to calibrate weather generator and downloaded climate projections from the ClimateWizard database. </span>
<span id="cb211-381"><a href="#cb211-381" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>to make past and future temperature scenarios for all stations</span>
<span id="cb211-382"><a href="#cb211-382" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>to compute winter chill and a few other agroclimatic metrics</span>
<span id="cb211-383"><a href="#cb211-383" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-384"><a href="#cb211-384" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-385"><a href="#cb211-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-386"><a href="#cb211-386" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;5.1.10&lt;/span&gt;&amp;nbsp; Chill model comparison</span></span>
<span id="cb211-387"><a href="#cb211-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-388"><a href="#cb211-388" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-389"><a href="#cb211-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-390"><a href="#cb211-390" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Used climate change analysis framework to compare chill models <span class="co">[</span><span class="ot">(Fernandez et al., 2020b)</span><span class="co">](https://www.sciencedirect.com/science/article/pii/S1161030120301106)</span></span>
<span id="cb211-391"><a href="#cb211-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-392"><a href="#cb211-392" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Model choice matters!</span>
<span id="cb211-393"><a href="#cb211-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-394"><a href="#cb211-394" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-395"><a href="#cb211-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-396"><a href="#cb211-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-397"><a href="#cb211-397" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;5.1.11&lt;/span&gt;&amp;nbsp; Chill projection for all of Tunisia</span></span>
<span id="cb211-398"><a href="#cb211-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-399"><a href="#cb211-399" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-400"><a href="#cb211-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-401"><a href="#cb211-401" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Mapped chill accumulation across Tunisia, based on the previous framework</span>
<span id="cb211-402"><a href="#cb211-402" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Applied the analysis framework developed to each of the 20 weather station locations across Tunisia and neighboring countries</span>
<span id="cb211-403"><a href="#cb211-403" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Interpolated results to produce chill maps that track chill availability in Tunisia over the past few decades</span>
<span id="cb211-404"><a href="#cb211-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-405"><a href="#cb211-405" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-406"><a href="#cb211-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-407"><a href="#cb211-407" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>How to interpolate the site-specific results into a map that covers the whole country</span>
<span id="cb211-408"><a href="#cb211-408" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Take the site-specific predictions of Safe Winter Chill and interpolate a surface through them (using the Kriging technique)</span>
<span id="cb211-409"><a href="#cb211-409" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Repeat the same for the elevations of the locations</span>
<span id="cb211-410"><a href="#cb211-410" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Then, fitted a linear model to relate chill accumulation to elevation</span>
<span id="cb211-411"><a href="#cb211-411" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Calculate the difference between the elevation model derived from the weather station elevations and the true elevations of each location of the country, using a Digital Elevation Model (DEM)</span>
<span id="cb211-412"><a href="#cb211-412" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Considering that this difference is not yet accounted for by the chill surface that was derived by interpolating chill data for the weather stations, we used the elevation~chill relationship we determined to correct chill predictions.</span>
<span id="cb211-413"><a href="#cb211-413" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Will only work in places with a linear relationship between elevation and chill availability</span>
<span id="cb211-414"><a href="#cb211-414" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-415"><a href="#cb211-415" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-416"><a href="#cb211-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-417"><a href="#cb211-417" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;5.1.12&lt;/span&gt;&amp;nbsp; Revisiting chill accumulation in Oman</span></span>
<span id="cb211-418"><a href="#cb211-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-419"><a href="#cb211-419" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-420"><a href="#cb211-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-421"><a href="#cb211-421" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Adding some new ideas on how to convert daily into hourly temperatures in a place like the oases of Oman we were interested in, we produced updated assessments of past winter chill and forecasts of future chill for the oases of Al Jabal Al Akhdar. <span class="co">[</span><span class="ot">(Buerkert et al., 2020)</span><span class="co">](https://link.springer.com/article/10.1007/s10584-020-02862-8)</span></span>
<span id="cb211-422"><a href="#cb211-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-423"><a href="#cb211-423" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-424"><a href="#cb211-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-425"><a href="#cb211-425" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;5.2&lt;/span&gt;&amp;nbsp; Exercises on past chill projections</span></span>
<span id="cb211-426"><a href="#cb211-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-427"><a href="#cb211-427" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-428"><a href="#cb211-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-429"><a href="#cb211-429" aria-hidden="true" tabindex="-1"></a>***1. Sketch out three data access and processing challenges that had to be overcome in order to produce chill projections with state-of-the-art methodology.***</span>
<span id="cb211-430"><a href="#cb211-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-431"><a href="#cb211-431" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Not all models are credible (Chilling Hours model- to quantify chill- can't really be trusted, especially in warm locations)</span>
<span id="cb211-432"><a href="#cb211-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-433"><a href="#cb211-433" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Complicated model- the Dynamic model-  I could only calculate Chill Portions (the unit of this model) with a decades-old Excel sheet </span>
<span id="cb211-434"><a href="#cb211-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-435"><a href="#cb211-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-436"><a href="#cb211-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-437"><a href="#cb211-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-438"><a href="#cb211-438" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The need to automate the process to create multiple climate scenarios for large number of weather stations and to handle large data output of simulation scenarios.</span>
<span id="cb211-439"><a href="#cb211-439" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Challenge in data transfer when replacing old scenarios (SRES) with the new (RCPs) </span>
<span id="cb211-440"><a href="#cb211-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-441"><a href="#cb211-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-442"><a href="#cb211-442" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Scarcity of source to find appropriate information/ data on future climates that can easily be used for the purposes of chill modeling. For example, </span>
<span id="cb211-443"><a href="#cb211-443" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Data (e.g. temperature records) available may not be representative of all locations of interest (use transfer functions to derive temperatures of specific locations from long-term data )</span>
<span id="cb211-444"><a href="#cb211-444" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>The need for hourly records</span>
<span id="cb211-445"><a href="#cb211-445" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span></span>
<span id="cb211-446"><a href="#cb211-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-447"><a href="#cb211-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-448"><a href="#cb211-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-449"><a href="#cb211-449" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For some reason, most future climate projections were mostly disseminated as spatial grids covering various extents. The dataset I typically worked with included 20 GCMs. To make matters worse, I typically wanted to project gradual changes over time by including multiple years in an analysis, e.g. the 2020s, the 2050s and the 2080s. You can probably see where this is headed. When we multiply all these numbers, we realize that we need 4320 grids. The disk space required to store these data (in uncompressed form) is more than 700 GB. This is not impossible to find, but processing this amount of data is cumbersome and time-consuming. Still, I actually managed to set up a data processing structure for this and download all the data to an external hard drive.Soon after I had set up this structure, the IPCC came up with a new report that introduced the ‘Representative Concentration Pathways’ (RCPs) to replace the SRES scenarios. For a few years, it was still ok to work with the old scenarios, but eventually it got harder and harder to get such studies through the peer-review process. The scenarios simply weren’t up to date any more. However, I was not excited by the prospect of downloading another massive dataset and starting all over again… What made this particularly difficult for me was that I was based in Kenya then, with fairly poor data transfer rates.</span>
<span id="cb211-450"><a href="#cb211-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-451"><a href="#cb211-451" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It turned out that in the meantime, some climate scientists had produced a future climate database specifically for Africa - AFRICLIM (Platts et al., 2015), which contained exactly what we needed. Since this database didn’t include the whole planet, it was much easier to download and store, and processing the data was much less cumbersome. So I added functions to chillR to implement procedures to sample from the AFRICLIM grids and produce ensembles of climate scenarios. I also started putting together a framework to automatically produce the kind of plots that are shown below. </span>
<span id="cb211-452"><a href="#cb211-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-453"><a href="#cb211-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-454"><a href="#cb211-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-455"><a href="#cb211-455" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>AFRICLIM solved the future climate data problem for locations in Africa. However, this dataset fell short of what was needed in order to add climate change projection capability to chillR. First, it was unsatisfying that this dataset only covered Africa. Second, users who are only interested in data for a single location, which is what chillR is designed for, shouldn’t have to download a large dataset, before they can run analyses. What was needed was a tool that could quickly access single-location data for weather stations anywhere on the planet.</span>
<span id="cb211-456"><a href="#cb211-456" aria-hidden="true" tabindex="-1"></a>One of my early sources of climate information was a tool called ‘ClimateWizard’, put together by my friend and collaborator Evan Girvetz, who now works for the International Centre for Tropical Agriculture (CIAT) in Nairobi. This tool initially only made gridded data available, but already for the California study cited above (Luedeling et al., 2009d) (Link), Evan had written a script to quickly extract information for single locations, which is really all that’s needed for single-site studies. Eventually, at CIAT, he made this function available to a wider audience through an application programming interface (API), to allow accessing outputs from 15 climate models for state-of-the-art RCP scenarios.</span>
<span id="cb211-457"><a href="#cb211-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-458"><a href="#cb211-458" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Interpolating site-specific results into a map that covers the whole country (current procedure needs improvement- will only work in places with a linear relationship between elevation and chill availability. This seems a fairly reasonable assumption in Tunisia, but it would not work in many cooler locations, such as Germany.)</span>
<span id="cb211-459"><a href="#cb211-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-460"><a href="#cb211-460" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>I also didn’t have proper data on projected future climates then, and the process that converted daily to hourly temperatures was quite a bit less than ideal.With our climate change analysis framework, we could finally do it. Adding some new ideas on how to convert daily into hourly temperatures in a place like the oases of Oman we were interested in</span>
<span id="cb211-461"><a href="#cb211-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-462"><a href="#cb211-462" aria-hidden="true" tabindex="-1"></a>After a decade of foraging in other parts of the world, let’s come back to Oman. I’d long been a bit dissatisfied with the initial work we did there. Note that the first analysis was my first study on chill accumulation. At the time, I did not know about the hazards involved in model choice.  (you’ll learn about these ideas later in this module), we produced updated assessments of past winter chill and forecasts of future chill for the oases of Al Jabal Al Akhdar. The results appeared once again in Climatic Change</span>
<span id="cb211-463"><a href="#cb211-463" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-464"><a href="#cb211-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-465"><a href="#cb211-465" aria-hidden="true" tabindex="-1"></a>***2. Outline, in your understanding, the basic steps that are necessary to make such projections.***</span>
<span id="cb211-466"><a href="#cb211-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-467"><a href="#cb211-467" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-468"><a href="#cb211-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-469"><a href="#cb211-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-470"><a href="#cb211-470" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 6: Manual chill analysis</span></span>
<span id="cb211-471"><a href="#cb211-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-472"><a href="#cb211-472" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;6.1&lt;/span&gt;&amp;nbsp; Computing Chilling Hours from hourly temperature data</span></span>
<span id="cb211-473"><a href="#cb211-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-474"><a href="#cb211-474" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-475"><a href="#cb211-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-476"><a href="#cb211-476" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Need hourly temperature data to compute Chilling Hours</span>
<span id="cb211-477"><a href="#cb211-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-478"><a href="#cb211-478" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`chillR`</span> offers a few neat tools to make pretty good approximations of hourly temperature data from daily records</span>
<span id="cb211-479"><a href="#cb211-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-480"><a href="#cb211-480" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-481"><a href="#cb211-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-482"><a href="#cb211-482" aria-hidden="true" tabindex="-1"></a><span class="fu">#### *Display the `Winters_hours_gaps` dataset in `chillR` using `kable`* {.unnumbered}</span></span>
<span id="cb211-483"><a href="#cb211-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-484"><a href="#cb211-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-485"><a href="#cb211-485" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 6.1.1}</span></span>
<span id="cb211-486"><a href="#cb211-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-487"><a href="#cb211-487" aria-hidden="true" tabindex="-1"></a><span class="in"># Display the Winters_hours_gaps dataset in chillR using kable</span></span>
<span id="cb211-488"><a href="#cb211-488" aria-hidden="true" tabindex="-1"></a><span class="in">kable(Winters_hours_gaps[1:10,]) %&gt;%</span></span>
<span id="cb211-489"><a href="#cb211-489" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-490"><a href="#cb211-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-491"><a href="#cb211-491" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-492"><a href="#cb211-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-493"><a href="#cb211-493" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-494"><a href="#cb211-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-495"><a href="#cb211-495" aria-hidden="true" tabindex="-1"></a><span class="fu">#### *Remove column `Temp_gaps` and create a new dataset (`hourtemps`)* {.unnumbered}</span></span>
<span id="cb211-496"><a href="#cb211-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-497"><a href="#cb211-497" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 6.1.2}</span></span>
<span id="cb211-498"><a href="#cb211-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-499"><a href="#cb211-499" aria-hidden="true" tabindex="-1"></a><span class="in"># Remove column Temp_gaps and create a new dataset (hourtemps)</span></span>
<span id="cb211-500"><a href="#cb211-500" aria-hidden="true" tabindex="-1"></a><span class="in">hourtemps &lt;- Winters_hours_gaps[,</span></span>
<span id="cb211-501"><a href="#cb211-501" aria-hidden="true" tabindex="-1"></a><span class="in">                                c("Year",</span></span>
<span id="cb211-502"><a href="#cb211-502" aria-hidden="true" tabindex="-1"></a><span class="in">                                  "Month",</span></span>
<span id="cb211-503"><a href="#cb211-503" aria-hidden="true" tabindex="-1"></a><span class="in">                                  "Day",</span></span>
<span id="cb211-504"><a href="#cb211-504" aria-hidden="true" tabindex="-1"></a><span class="in">                                  "Hour",</span></span>
<span id="cb211-505"><a href="#cb211-505" aria-hidden="true" tabindex="-1"></a><span class="in">                                  "Temp")]</span></span>
<span id="cb211-506"><a href="#cb211-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-507"><a href="#cb211-507" aria-hidden="true" tabindex="-1"></a><span class="in">kable(hourtemps[1:10,]) %&gt;%</span></span>
<span id="cb211-508"><a href="#cb211-508" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-509"><a href="#cb211-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-510"><a href="#cb211-510" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-511"><a href="#cb211-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-512"><a href="#cb211-512" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-513"><a href="#cb211-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-514"><a href="#cb211-514" aria-hidden="true" tabindex="-1"></a><span class="fu">#### *Display only the third row with all columns* {.unnumbered}</span></span>
<span id="cb211-515"><a href="#cb211-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-516"><a href="#cb211-516" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 6.1.3}</span></span>
<span id="cb211-517"><a href="#cb211-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-518"><a href="#cb211-518" aria-hidden="true" tabindex="-1"></a><span class="in"># Display only the third row with all columns</span></span>
<span id="cb211-519"><a href="#cb211-519" aria-hidden="true" tabindex="-1"></a><span class="in">hourtemps[3, ]</span></span>
<span id="cb211-520"><a href="#cb211-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-521"><a href="#cb211-521" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-522"><a href="#cb211-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-523"><a href="#cb211-523" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-524"><a href="#cb211-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-525"><a href="#cb211-525" aria-hidden="true" tabindex="-1"></a><span class="fu">#### *Display the `Temp` column of the third row only* {.unnumbered}</span></span>
<span id="cb211-526"><a href="#cb211-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-527"><a href="#cb211-527" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 6.1.4}</span></span>
<span id="cb211-528"><a href="#cb211-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-529"><a href="#cb211-529" aria-hidden="true" tabindex="-1"></a><span class="in"># Display the temp column of the third row only</span></span>
<span id="cb211-530"><a href="#cb211-530" aria-hidden="true" tabindex="-1"></a><span class="in">hourtemps[3, "Temp"]</span></span>
<span id="cb211-531"><a href="#cb211-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-532"><a href="#cb211-532" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-533"><a href="#cb211-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-534"><a href="#cb211-534" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-535"><a href="#cb211-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-536"><a href="#cb211-536" aria-hidden="true" tabindex="-1"></a><span class="fu">#### *Display the first five rows of `Temp` column* {.unnumbered}</span></span>
<span id="cb211-537"><a href="#cb211-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-538"><a href="#cb211-538" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 6.1.5}</span></span>
<span id="cb211-539"><a href="#cb211-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-540"><a href="#cb211-540" aria-hidden="true" tabindex="-1"></a><span class="in"># Display the first five rows of Temp column</span></span>
<span id="cb211-541"><a href="#cb211-541" aria-hidden="true" tabindex="-1"></a><span class="in">hourtemps$Temp[1:5]</span></span>
<span id="cb211-542"><a href="#cb211-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-543"><a href="#cb211-543" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-544"><a href="#cb211-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-545"><a href="#cb211-545" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-546"><a href="#cb211-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-547"><a href="#cb211-547" aria-hidden="true" tabindex="-1"></a><span class="fu">#### *Display the first five rows and all columns of `hourtemps` dataset* {.unnumbered}</span></span>
<span id="cb211-548"><a href="#cb211-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-549"><a href="#cb211-549" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 6.1.6}</span></span>
<span id="cb211-550"><a href="#cb211-550" aria-hidden="true" tabindex="-1"></a><span class="in"># Display the first five rows and all columns of hourtemps dataset</span></span>
<span id="cb211-551"><a href="#cb211-551" aria-hidden="true" tabindex="-1"></a><span class="in">hourtemps[1:5, ]</span></span>
<span id="cb211-552"><a href="#cb211-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-553"><a href="#cb211-553" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-554"><a href="#cb211-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-555"><a href="#cb211-555" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-556"><a href="#cb211-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-557"><a href="#cb211-557" aria-hidden="true" tabindex="-1"></a><span class="fu">#### *Check for temperatures that fall within `Chilling Hours` range* {.unnumbered}</span></span>
<span id="cb211-558"><a href="#cb211-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-559"><a href="#cb211-559" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-560"><a href="#cb211-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-561"><a href="#cb211-561" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Every hour with temperatures above (and including) 0°C and below (and including) 7.2°C is considered a Chilling Hour.</span>
<span id="cb211-562"><a href="#cb211-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-563"><a href="#cb211-563" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Check for every hour whether temperatures fall in this range, using simple comparison commands (<span class="in">`&lt;`</span>, <span class="in">`&lt;=`</span>, <span class="in">`==`</span>, <span class="in">`=&gt;`</span> and <span class="in">`&gt;`</span>) in R</span>
<span id="cb211-564"><a href="#cb211-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-565"><a href="#cb211-565" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-566"><a href="#cb211-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-567"><a href="#cb211-567" aria-hidden="true" tabindex="-1"></a><span class="fu">#####  *Using simple comparison commands* {.unnumbered}</span></span>
<span id="cb211-568"><a href="#cb211-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-569"><a href="#cb211-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-570"><a href="#cb211-570" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 6.1.7.1}</span></span>
<span id="cb211-571"><a href="#cb211-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-572"><a href="#cb211-572" aria-hidden="true" tabindex="-1"></a><span class="in"># Use == command</span></span>
<span id="cb211-573"><a href="#cb211-573" aria-hidden="true" tabindex="-1"></a><span class="in">1 == 2</span></span>
<span id="cb211-574"><a href="#cb211-574" aria-hidden="true" tabindex="-1"></a><span class="in">1 == 1</span></span>
<span id="cb211-575"><a href="#cb211-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-576"><a href="#cb211-576" aria-hidden="true" tabindex="-1"></a><span class="in"># Test &gt; command</span></span>
<span id="cb211-577"><a href="#cb211-577" aria-hidden="true" tabindex="-1"></a><span class="in">c(1, 2, 3) &gt; 2</span></span>
<span id="cb211-578"><a href="#cb211-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-579"><a href="#cb211-579" aria-hidden="true" tabindex="-1"></a><span class="in"># Use &gt;= command</span></span>
<span id="cb211-580"><a href="#cb211-580" aria-hidden="true" tabindex="-1"></a><span class="in">a &lt;- 1</span></span>
<span id="cb211-581"><a href="#cb211-581" aria-hidden="true" tabindex="-1"></a><span class="in">b &lt;- 2</span></span>
<span id="cb211-582"><a href="#cb211-582" aria-hidden="true" tabindex="-1"></a><span class="in">c &lt;- 3</span></span>
<span id="cb211-583"><a href="#cb211-583" aria-hidden="true" tabindex="-1"></a><span class="in">c(a, b, c) &gt;= 2</span></span>
<span id="cb211-584"><a href="#cb211-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-585"><a href="#cb211-585" aria-hidden="true" tabindex="-1"></a><span class="in"># Use &amp; command</span></span>
<span id="cb211-586"><a href="#cb211-586" aria-hidden="true" tabindex="-1"></a><span class="in">c(a, b, c) &gt;= 2 &amp; c(a, b, c) &lt;3</span></span>
<span id="cb211-587"><a href="#cb211-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-588"><a href="#cb211-588" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-589"><a href="#cb211-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-590"><a href="#cb211-590" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-591"><a href="#cb211-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-592"><a href="#cb211-592" aria-hidden="true" tabindex="-1"></a><span class="fu">##### *Check for `Chilling Hours`* {.unnumbered}</span></span>
<span id="cb211-593"><a href="#cb211-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-594"><a href="#cb211-594" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 6.1.7.2}</span></span>
<span id="cb211-595"><a href="#cb211-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-596"><a href="#cb211-596" aria-hidden="true" tabindex="-1"></a><span class="in"># Assign new column Chiling_Hour </span></span>
<span id="cb211-597"><a href="#cb211-597" aria-hidden="true" tabindex="-1"></a><span class="in">hourtemps[,"Chilling_Hour"] &lt;-</span></span>
<span id="cb211-598"><a href="#cb211-598" aria-hidden="true" tabindex="-1"></a><span class="in">  hourtemps$Temp &gt;= 0 &amp; hourtemps$Temp &lt;= 7.2</span></span>
<span id="cb211-599"><a href="#cb211-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-600"><a href="#cb211-600" aria-hidden="true" tabindex="-1"></a><span class="in"># Check if the temperatures fall within Chilling_Hour for row 13 to 20</span></span>
<span id="cb211-601"><a href="#cb211-601" aria-hidden="true" tabindex="-1"></a><span class="in">hourtemps[13:20, ]</span></span>
<span id="cb211-602"><a href="#cb211-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-603"><a href="#cb211-603" aria-hidden="true" tabindex="-1"></a><span class="in"># Find total chilling hour for a particular period by defining rows (3-4 March 2008)</span></span>
<span id="cb211-604"><a href="#cb211-604" aria-hidden="true" tabindex="-1"></a><span class="in">sum(hourtemps$Chilling_Hour[13:20])</span></span>
<span id="cb211-605"><a href="#cb211-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-606"><a href="#cb211-606" aria-hidden="true" tabindex="-1"></a><span class="in"># Use `which` function to set the dates for total chilling hours calculation</span></span>
<span id="cb211-607"><a href="#cb211-607" aria-hidden="true" tabindex="-1"></a><span class="in">Start_Date &lt;- which(hourtemps$Year == 2008 &amp;</span></span>
<span id="cb211-608"><a href="#cb211-608" aria-hidden="true" tabindex="-1"></a><span class="in">                      hourtemps$Month == 10 &amp;</span></span>
<span id="cb211-609"><a href="#cb211-609" aria-hidden="true" tabindex="-1"></a><span class="in">                      hourtemps$Day == 1 &amp;</span></span>
<span id="cb211-610"><a href="#cb211-610" aria-hidden="true" tabindex="-1"></a><span class="in">                      hourtemps$Hour == 12)</span></span>
<span id="cb211-611"><a href="#cb211-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-612"><a href="#cb211-612" aria-hidden="true" tabindex="-1"></a><span class="in">End_Date &lt;- which(hourtemps$Year == 2008 &amp;</span></span>
<span id="cb211-613"><a href="#cb211-613" aria-hidden="true" tabindex="-1"></a><span class="in">                    hourtemps$Month == 10 &amp;</span></span>
<span id="cb211-614"><a href="#cb211-614" aria-hidden="true" tabindex="-1"></a><span class="in">                    hourtemps$Day == 31 &amp;</span></span>
<span id="cb211-615"><a href="#cb211-615" aria-hidden="true" tabindex="-1"></a><span class="in">                    hourtemps$Hour == 12)</span></span>
<span id="cb211-616"><a href="#cb211-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-617"><a href="#cb211-617" aria-hidden="true" tabindex="-1"></a><span class="in">sum(hourtemps$Chilling_Hour[Start_Date:End_Date])</span></span>
<span id="cb211-618"><a href="#cb211-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-619"><a href="#cb211-619" aria-hidden="true" tabindex="-1"></a><span class="in"># So in October of 2008, Winters experienced 28 Chilling Hours.</span></span>
<span id="cb211-620"><a href="#cb211-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-621"><a href="#cb211-621" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-622"><a href="#cb211-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-623"><a href="#cb211-623" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-624"><a href="#cb211-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-625"><a href="#cb211-625" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;6.2&lt;/span&gt;&amp;nbsp; Our first chill function</span></span>
<span id="cb211-626"><a href="#cb211-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-627"><a href="#cb211-627" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-628"><a href="#cb211-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-629"><a href="#cb211-629" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A function consists of a name, some arguments that are passed to the function, and some code that should be executed.</span>
<span id="cb211-630"><a href="#cb211-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-631"><a href="#cb211-631" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We can define is as <span class="in">`OurFunctionName &lt;- function(argument1, argument2, ...) {ourCode}`</span>.</span>
<span id="cb211-632"><a href="#cb211-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-633"><a href="#cb211-633" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>What’s returned is either the last object that’s mentioned in the function code or some content specified by the <span class="in">`return()`</span> function.</span>
<span id="cb211-634"><a href="#cb211-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-635"><a href="#cb211-635" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 6.2}</span></span>
<span id="cb211-636"><a href="#cb211-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-637"><a href="#cb211-637" aria-hidden="true" tabindex="-1"></a><span class="in"># Example function for Chilling_Hour calculation</span></span>
<span id="cb211-638"><a href="#cb211-638" aria-hidden="true" tabindex="-1"></a><span class="in"># Function that adds Chilling_Hour column to dataframe</span></span>
<span id="cb211-639"><a href="#cb211-639" aria-hidden="true" tabindex="-1"></a><span class="in">CH &lt;- function(hourtemps)</span></span>
<span id="cb211-640"><a href="#cb211-640" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb211-641"><a href="#cb211-641" aria-hidden="true" tabindex="-1"></a><span class="in">  hourtemps[, "Chilling_Hour"] &lt;-</span></span>
<span id="cb211-642"><a href="#cb211-642" aria-hidden="true" tabindex="-1"></a><span class="in">    hourtemps$Temp &gt;= 0 &amp; hourtemps$Temp &lt;= 7.2</span></span>
<span id="cb211-643"><a href="#cb211-643" aria-hidden="true" tabindex="-1"></a><span class="in">  return(hourtemps)</span></span>
<span id="cb211-644"><a href="#cb211-644" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb211-645"><a href="#cb211-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-646"><a href="#cb211-646" aria-hidden="true" tabindex="-1"></a><span class="in"># Check chilling hour `yes or no` for rows 13-20</span></span>
<span id="cb211-647"><a href="#cb211-647" aria-hidden="true" tabindex="-1"></a><span class="in">CH(hourtemps)[13:20, ]</span></span>
<span id="cb211-648"><a href="#cb211-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-649"><a href="#cb211-649" aria-hidden="true" tabindex="-1"></a><span class="in"># Create more complex functions, e.g. to calculate the number of Chilling Hours</span></span>
<span id="cb211-650"><a href="#cb211-650" aria-hidden="true" tabindex="-1"></a><span class="in"># between two dates, which we can specify in the YEARMODA format </span></span>
<span id="cb211-651"><a href="#cb211-651" aria-hidden="true" tabindex="-1"></a><span class="in"># (i.e. year, month and day, combined in one number).</span></span>
<span id="cb211-652"><a href="#cb211-652" aria-hidden="true" tabindex="-1"></a><span class="in">sum_CH &lt;- function(hourtemps,</span></span>
<span id="cb211-653"><a href="#cb211-653" aria-hidden="true" tabindex="-1"></a><span class="in">                   Start_YEARMODA,</span></span>
<span id="cb211-654"><a href="#cb211-654" aria-hidden="true" tabindex="-1"></a><span class="in">                   End_YEARMODA)</span></span>
<span id="cb211-655"><a href="#cb211-655" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb211-656"><a href="#cb211-656" aria-hidden="true" tabindex="-1"></a><span class="in">  Start_Year &lt;- trunc(Start_YEARMODA / 10000) # "trunc" removes all decimals</span></span>
<span id="cb211-657"><a href="#cb211-657" aria-hidden="true" tabindex="-1"></a><span class="in">  Start_Month &lt;-</span></span>
<span id="cb211-658"><a href="#cb211-658" aria-hidden="true" tabindex="-1"></a><span class="in">    trunc((Start_YEARMODA - Start_Year*10000) / 100)</span></span>
<span id="cb211-659"><a href="#cb211-659" aria-hidden="true" tabindex="-1"></a><span class="in">  Start_Day &lt;- </span></span>
<span id="cb211-660"><a href="#cb211-660" aria-hidden="true" tabindex="-1"></a><span class="in">    Start_YEARMODA - Start_Year * 10000 - Start_Month * 100</span></span>
<span id="cb211-661"><a href="#cb211-661" aria-hidden="true" tabindex="-1"></a><span class="in">  Start_Hour &lt;- 12 # This could also be flexible, but let's skip this for now</span></span>
<span id="cb211-662"><a href="#cb211-662" aria-hidden="true" tabindex="-1"></a><span class="in">  End_Year &lt;- trunc(End_YEARMODA / 10000)</span></span>
<span id="cb211-663"><a href="#cb211-663" aria-hidden="true" tabindex="-1"></a><span class="in">  End_Month &lt;- trunc((End_YEARMODA - End_Year * 10000) / 100)</span></span>
<span id="cb211-664"><a href="#cb211-664" aria-hidden="true" tabindex="-1"></a><span class="in">  End_Day &lt;- End_YEARMODA - End_Year * 10000 - End_Month * 100</span></span>
<span id="cb211-665"><a href="#cb211-665" aria-hidden="true" tabindex="-1"></a><span class="in">  End_Hour &lt;- 12 # This could also be flexible, but let's skip this for now</span></span>
<span id="cb211-666"><a href="#cb211-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-667"><a href="#cb211-667" aria-hidden="true" tabindex="-1"></a><span class="in">  Start_Date &lt;- which(hourtemps$Year == Start_Year &amp;</span></span>
<span id="cb211-668"><a href="#cb211-668" aria-hidden="true" tabindex="-1"></a><span class="in">                        hourtemps$Month == Start_Month &amp;</span></span>
<span id="cb211-669"><a href="#cb211-669" aria-hidden="true" tabindex="-1"></a><span class="in">                        hourtemps$Day == Start_Day &amp;</span></span>
<span id="cb211-670"><a href="#cb211-670" aria-hidden="true" tabindex="-1"></a><span class="in">                        hourtemps$Hour == Start_Hour)</span></span>
<span id="cb211-671"><a href="#cb211-671" aria-hidden="true" tabindex="-1"></a><span class="in">  End_Date &lt;- which(hourtemps$Year == End_Year &amp;</span></span>
<span id="cb211-672"><a href="#cb211-672" aria-hidden="true" tabindex="-1"></a><span class="in">                    hourtemps$Month == End_Month &amp;</span></span>
<span id="cb211-673"><a href="#cb211-673" aria-hidden="true" tabindex="-1"></a><span class="in">                    hourtemps$Day == End_Day &amp;</span></span>
<span id="cb211-674"><a href="#cb211-674" aria-hidden="true" tabindex="-1"></a><span class="in">                    hourtemps$Hour == End_Hour)</span></span>
<span id="cb211-675"><a href="#cb211-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-676"><a href="#cb211-676" aria-hidden="true" tabindex="-1"></a><span class="in">  Chill_hours &lt;- CH(hourtemps)</span></span>
<span id="cb211-677"><a href="#cb211-677" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb211-678"><a href="#cb211-678" aria-hidden="true" tabindex="-1"></a><span class="in">  return(sum(Chill_hours$Chilling_Hour[Start_Date:End_Date]))</span></span>
<span id="cb211-679"><a href="#cb211-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-680"><a href="#cb211-680" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb211-681"><a href="#cb211-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-682"><a href="#cb211-682" aria-hidden="true" tabindex="-1"></a><span class="in"># Check the total chilling hours from March 1 to October 11, 2008</span></span>
<span id="cb211-683"><a href="#cb211-683" aria-hidden="true" tabindex="-1"></a><span class="in"># Note that the dataset only goes from 3rd March to 11th November 2008, </span></span>
<span id="cb211-684"><a href="#cb211-684" aria-hidden="true" tabindex="-1"></a><span class="in"># so use of any dates outside that range will generate an error message. </span></span>
<span id="cb211-685"><a href="#cb211-685" aria-hidden="true" tabindex="-1"></a><span class="in">sum_CH(hourtemps, 20080401, 20081011)</span></span>
<span id="cb211-686"><a href="#cb211-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-687"><a href="#cb211-687" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-688"><a href="#cb211-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-689"><a href="#cb211-689" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-690"><a href="#cb211-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-691"><a href="#cb211-691" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;6.3&lt;/span&gt;&amp;nbsp; Exercise on basic chill modeling</span></span>
<span id="cb211-692"><a href="#cb211-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-693"><a href="#cb211-693" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-694"><a href="#cb211-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-695"><a href="#cb211-695" aria-hidden="true" tabindex="-1"></a>***1. Write a basic function that calculates warm hours (&gt;25°C)***</span>
<span id="cb211-696"><a href="#cb211-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-697"><a href="#cb211-697" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 6.3.1}</span></span>
<span id="cb211-698"><a href="#cb211-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-699"><a href="#cb211-699" aria-hidden="true" tabindex="-1"></a><span class="in">## Check for warm hours above 25 degree C in Winters_hours_gaps dataset</span></span>
<span id="cb211-700"><a href="#cb211-700" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a dataset without temperature gaps</span></span>
<span id="cb211-701"><a href="#cb211-701" aria-hidden="true" tabindex="-1"></a><span class="in">W_data &lt;- Winters_hours_gaps[,</span></span>
<span id="cb211-702"><a href="#cb211-702" aria-hidden="true" tabindex="-1"></a><span class="in">                             c("Year",</span></span>
<span id="cb211-703"><a href="#cb211-703" aria-hidden="true" tabindex="-1"></a><span class="in">                               "Month",</span></span>
<span id="cb211-704"><a href="#cb211-704" aria-hidden="true" tabindex="-1"></a><span class="in">                               "Day",</span></span>
<span id="cb211-705"><a href="#cb211-705" aria-hidden="true" tabindex="-1"></a><span class="in">                               "Hour",</span></span>
<span id="cb211-706"><a href="#cb211-706" aria-hidden="true" tabindex="-1"></a><span class="in">                               "Temp")]</span></span>
<span id="cb211-707"><a href="#cb211-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-708"><a href="#cb211-708" aria-hidden="true" tabindex="-1"></a><span class="in"># Write function that calculates warm hours above 25 degree C</span></span>
<span id="cb211-709"><a href="#cb211-709" aria-hidden="true" tabindex="-1"></a><span class="in">WH &lt;- function(W_data)</span></span>
<span id="cb211-710"><a href="#cb211-710" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb211-711"><a href="#cb211-711" aria-hidden="true" tabindex="-1"></a><span class="in">  W_data[, "Warm_Hour"] &lt;-</span></span>
<span id="cb211-712"><a href="#cb211-712" aria-hidden="true" tabindex="-1"></a><span class="in">    W_data$Temp &gt; 25</span></span>
<span id="cb211-713"><a href="#cb211-713" aria-hidden="true" tabindex="-1"></a><span class="in">  return(W_data)</span></span>
<span id="cb211-714"><a href="#cb211-714" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb211-715"><a href="#cb211-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-716"><a href="#cb211-716" aria-hidden="true" tabindex="-1"></a><span class="in"># Show the the first 4 rows</span></span>
<span id="cb211-717"><a href="#cb211-717" aria-hidden="true" tabindex="-1"></a><span class="in">WH(W_data)[1:4, ]</span></span>
<span id="cb211-718"><a href="#cb211-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-719"><a href="#cb211-719" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate total warm hours for the dataset</span></span>
<span id="cb211-720"><a href="#cb211-720" aria-hidden="true" tabindex="-1"></a><span class="in">WH_sum &lt;- WH(W_data)</span></span>
<span id="cb211-721"><a href="#cb211-721" aria-hidden="true" tabindex="-1"></a><span class="in">sum(WH_sum$Warm_Hour)</span></span>
<span id="cb211-722"><a href="#cb211-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-723"><a href="#cb211-723" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-724"><a href="#cb211-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-725"><a href="#cb211-725" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-726"><a href="#cb211-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-727"><a href="#cb211-727" aria-hidden="true" tabindex="-1"></a>***2. Apply this function to the Winters_hours_gaps dataset***</span>
<span id="cb211-728"><a href="#cb211-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-729"><a href="#cb211-729" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 6.3.2}</span></span>
<span id="cb211-730"><a href="#cb211-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-731"><a href="#cb211-731" aria-hidden="true" tabindex="-1"></a><span class="in"># Apply the function to original Winters_hours_gaps dataset</span></span>
<span id="cb211-732"><a href="#cb211-732" aria-hidden="true" tabindex="-1"></a><span class="in">kable(WH(Winters_hours_gaps[961:970, ]), row.names = FALSE) %&gt;%</span></span>
<span id="cb211-733"><a href="#cb211-733" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-734"><a href="#cb211-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-735"><a href="#cb211-735" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-736"><a href="#cb211-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-737"><a href="#cb211-737" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-738"><a href="#cb211-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-739"><a href="#cb211-739" aria-hidden="true" tabindex="-1"></a>***3. Extend this function, so that it can take start and end dates as inputs and sums up warm hours between these dates***</span>
<span id="cb211-740"><a href="#cb211-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-741"><a href="#cb211-741" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 6.3.3}</span></span>
<span id="cb211-742"><a href="#cb211-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-743"><a href="#cb211-743" aria-hidden="true" tabindex="-1"></a><span class="in">sum_WH &lt;- function(W_data,</span></span>
<span id="cb211-744"><a href="#cb211-744" aria-hidden="true" tabindex="-1"></a><span class="in">                   Start_YEARMODA,</span></span>
<span id="cb211-745"><a href="#cb211-745" aria-hidden="true" tabindex="-1"></a><span class="in">                   End_YEARMODA)</span></span>
<span id="cb211-746"><a href="#cb211-746" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb211-747"><a href="#cb211-747" aria-hidden="true" tabindex="-1"></a><span class="in">  # See in-class script for setting year, month and date with substr </span></span>
<span id="cb211-748"><a href="#cb211-748" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb211-749"><a href="#cb211-749" aria-hidden="true" tabindex="-1"></a><span class="in">  Start_Year &lt;- trunc(Start_YEARMODA / 10000)</span></span>
<span id="cb211-750"><a href="#cb211-750" aria-hidden="true" tabindex="-1"></a><span class="in">  Start_Month &lt;- trunc((Start_YEARMODA - Start_Year * 10000) / 100)</span></span>
<span id="cb211-751"><a href="#cb211-751" aria-hidden="true" tabindex="-1"></a><span class="in">  Start_Day &lt;- trunc((Start_YEARMODA - Start_Year *10000) - </span></span>
<span id="cb211-752"><a href="#cb211-752" aria-hidden="true" tabindex="-1"></a><span class="in">                         Start_Month * 100)</span></span>
<span id="cb211-753"><a href="#cb211-753" aria-hidden="true" tabindex="-1"></a><span class="in">  Start_Hour &lt;- 12</span></span>
<span id="cb211-754"><a href="#cb211-754" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb211-755"><a href="#cb211-755" aria-hidden="true" tabindex="-1"></a><span class="in">  End_Year &lt;- trunc(End_YEARMODA / 10000)</span></span>
<span id="cb211-756"><a href="#cb211-756" aria-hidden="true" tabindex="-1"></a><span class="in">  End_Month &lt;- trunc((End_YEARMODA - Start_Year * 10000) / 100)</span></span>
<span id="cb211-757"><a href="#cb211-757" aria-hidden="true" tabindex="-1"></a><span class="in">  End_Day &lt;- trunc((End_YEARMODA - Start_Year *10000) - </span></span>
<span id="cb211-758"><a href="#cb211-758" aria-hidden="true" tabindex="-1"></a><span class="in">                         End_Month * 100)</span></span>
<span id="cb211-759"><a href="#cb211-759" aria-hidden="true" tabindex="-1"></a><span class="in">  End_Hour &lt;- 12</span></span>
<span id="cb211-760"><a href="#cb211-760" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb211-761"><a href="#cb211-761" aria-hidden="true" tabindex="-1"></a><span class="in">  Start_Date &lt;- which(W_data$Year == Start_Year &amp;</span></span>
<span id="cb211-762"><a href="#cb211-762" aria-hidden="true" tabindex="-1"></a><span class="in">                        W_data$Month == Start_Month &amp;</span></span>
<span id="cb211-763"><a href="#cb211-763" aria-hidden="true" tabindex="-1"></a><span class="in">                        W_data$Day == Start_Day &amp;</span></span>
<span id="cb211-764"><a href="#cb211-764" aria-hidden="true" tabindex="-1"></a><span class="in">                        W_data$Hour == Start_Hour)</span></span>
<span id="cb211-765"><a href="#cb211-765" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb211-766"><a href="#cb211-766" aria-hidden="true" tabindex="-1"></a><span class="in">  End_Date &lt;- which(W_data$Year == End_Year &amp;</span></span>
<span id="cb211-767"><a href="#cb211-767" aria-hidden="true" tabindex="-1"></a><span class="in">                        W_data$Month == End_Month &amp;</span></span>
<span id="cb211-768"><a href="#cb211-768" aria-hidden="true" tabindex="-1"></a><span class="in">                        W_data$Day == End_Day &amp;</span></span>
<span id="cb211-769"><a href="#cb211-769" aria-hidden="true" tabindex="-1"></a><span class="in">                        W_data$Hour == End_Hour)</span></span>
<span id="cb211-770"><a href="#cb211-770" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb211-771"><a href="#cb211-771" aria-hidden="true" tabindex="-1"></a><span class="in">  Warm_Hours &lt;- WH(W_data)</span></span>
<span id="cb211-772"><a href="#cb211-772" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb211-773"><a href="#cb211-773" aria-hidden="true" tabindex="-1"></a><span class="in">  return(sum(Warm_Hours$Warm_Hour[Start_Date:End_Date]))</span></span>
<span id="cb211-774"><a href="#cb211-774" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb211-775"><a href="#cb211-775" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb211-776"><a href="#cb211-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-777"><a href="#cb211-777" aria-hidden="true" tabindex="-1"></a><span class="in"># Total warm hours for the whole period of dataset </span></span>
<span id="cb211-778"><a href="#cb211-778" aria-hidden="true" tabindex="-1"></a><span class="in">sum_WH(W_data, 20080303, 20081110)</span></span>
<span id="cb211-779"><a href="#cb211-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-780"><a href="#cb211-780" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-781"><a href="#cb211-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-782"><a href="#cb211-782" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-783"><a href="#cb211-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-784"><a href="#cb211-784" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 7: Chill models</span></span>
<span id="cb211-785"><a href="#cb211-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-786"><a href="#cb211-786" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;7.1&lt;/span&gt;&amp;nbsp; Chill models in `chillR`</span></span>
<span id="cb211-787"><a href="#cb211-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-788"><a href="#cb211-788" aria-hidden="true" tabindex="-1"></a><span class="fu">#### *`Chilling_Hours()` function* {.unnumbered}</span></span>
<span id="cb211-789"><a href="#cb211-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-790"><a href="#cb211-790" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-791"><a href="#cb211-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-792"><a href="#cb211-792" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Chilling Hours are great for an entry-level tutorial on chill modeling, but they’re not a particularly credible metric, so I suggest you forget them right away.    </span>
<span id="cb211-793"><a href="#cb211-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-794"><a href="#cb211-794" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-795"><a href="#cb211-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-796"><a href="#cb211-796" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 7.1.1}</span></span>
<span id="cb211-797"><a href="#cb211-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-798"><a href="#cb211-798" aria-hidden="true" tabindex="-1"></a><span class="in"># Chilling_Hours() function in chillR to calculate chilling hours</span></span>
<span id="cb211-799"><a href="#cb211-799" aria-hidden="true" tabindex="-1"></a><span class="in">Chilling_Hours</span></span>
<span id="cb211-800"><a href="#cb211-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-801"><a href="#cb211-801" aria-hidden="true" tabindex="-1"></a><span class="in"># Apply Chilling_Hours() function to Winters_hours_gap dataset</span></span>
<span id="cb211-802"><a href="#cb211-802" aria-hidden="true" tabindex="-1"></a><span class="in">Chilling_Hours(Winters_hours_gaps$Temp)[1:100]</span></span>
<span id="cb211-803"><a href="#cb211-803" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-804"><a href="#cb211-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-805"><a href="#cb211-805" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-806"><a href="#cb211-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-807"><a href="#cb211-807" aria-hidden="true" tabindex="-1"></a><span class="fu">#### *The Utah model* {.unnumbered}</span></span>
<span id="cb211-808"><a href="#cb211-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-809"><a href="#cb211-809" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-810"><a href="#cb211-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-811"><a href="#cb211-811" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`step_model()`</span> function allows you to define your own model, based on temperature thresholds and weights. </span>
<span id="cb211-812"><a href="#cb211-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-813"><a href="#cb211-813" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To implement various variations of the Utah Model that have been developed for different locations</span>
<span id="cb211-814"><a href="#cb211-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-815"><a href="#cb211-815" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 7.1.2}</span></span>
<span id="cb211-816"><a href="#cb211-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-817"><a href="#cb211-817" aria-hidden="true" tabindex="-1"></a><span class="in">Utah_Model</span></span>
<span id="cb211-818"><a href="#cb211-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-819"><a href="#cb211-819" aria-hidden="true" tabindex="-1"></a><span class="in">Utah_Model(Winters_hours_gaps$Temp)[1:100]</span></span>
<span id="cb211-820"><a href="#cb211-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-821"><a href="#cb211-821" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a data.frame for temperatures with weights</span></span>
<span id="cb211-822"><a href="#cb211-822" aria-hidden="true" tabindex="-1"></a><span class="in">df &lt;- data.frame(</span></span>
<span id="cb211-823"><a href="#cb211-823" aria-hidden="true" tabindex="-1"></a><span class="in">  lower  = c(-1000, 1, 2, 3, 4, 5,    6),</span></span>
<span id="cb211-824"><a href="#cb211-824" aria-hidden="true" tabindex="-1"></a><span class="in">  upper  = c(    1, 2, 3, 4, 5, 6, 1000),</span></span>
<span id="cb211-825"><a href="#cb211-825" aria-hidden="true" tabindex="-1"></a><span class="in">  weight = c(    0, 1, 2, 3, 2, 1,    0))</span></span>
<span id="cb211-826"><a href="#cb211-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-827"><a href="#cb211-827" aria-hidden="true" tabindex="-1"></a><span class="in">kable(df) %&gt;%</span></span>
<span id="cb211-828"><a href="#cb211-828" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-829"><a href="#cb211-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-830"><a href="#cb211-830" aria-hidden="true" tabindex="-1"></a><span class="in"># Use custom() function to implement a chill model based on df</span></span>
<span id="cb211-831"><a href="#cb211-831" aria-hidden="true" tabindex="-1"></a><span class="in">custom &lt;- function(x) step_model(x, df)</span></span>
<span id="cb211-832"><a href="#cb211-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-833"><a href="#cb211-833" aria-hidden="true" tabindex="-1"></a><span class="in">custom(Winters_hours_gaps$Temp)[1:100]</span></span>
<span id="cb211-834"><a href="#cb211-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-835"><a href="#cb211-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-836"><a href="#cb211-836" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-837"><a href="#cb211-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-838"><a href="#cb211-838" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-839"><a href="#cb211-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-840"><a href="#cb211-840" aria-hidden="true" tabindex="-1"></a><span class="fu">#### *The dynamic model* {.unnumbered} </span></span>
<span id="cb211-841"><a href="#cb211-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-842"><a href="#cb211-842" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-843"><a href="#cb211-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-844"><a href="#cb211-844" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 7.1.3}</span></span>
<span id="cb211-845"><a href="#cb211-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-846"><a href="#cb211-846" aria-hidden="true" tabindex="-1"></a><span class="in">Dynamic_Model</span></span>
<span id="cb211-847"><a href="#cb211-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-848"><a href="#cb211-848" aria-hidden="true" tabindex="-1"></a><span class="in">Dynamic_Model(Winters_hours_gaps$Temp)[1:100]</span></span>
<span id="cb211-849"><a href="#cb211-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-850"><a href="#cb211-850" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-851"><a href="#cb211-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-852"><a href="#cb211-852" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-853"><a href="#cb211-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-854"><a href="#cb211-854" aria-hidden="true" tabindex="-1"></a><span class="fu">#### *`make_JDay()` and `tempResponse` functions* {.unnumbered}</span></span>
<span id="cb211-855"><a href="#cb211-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-856"><a href="#cb211-856" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-857"><a href="#cb211-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-858"><a href="#cb211-858" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Add the Julian dates (counts the days of the year) to the dataset </span>
<span id="cb211-859"><a href="#cb211-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-860"><a href="#cb211-860" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The <span class="in">`chilling()`</span> function implements the Chilling Hours, Utah and Dynamic Models, and it also calculates Growing Degree Days (GDH); use <span class="in">`tempResponse`</span> function otherwise</span>
<span id="cb211-861"><a href="#cb211-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-862"><a href="#cb211-862" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 7.1.4}</span></span>
<span id="cb211-863"><a href="#cb211-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-864"><a href="#cb211-864" aria-hidden="true" tabindex="-1"></a><span class="in"># Use chilling() function</span></span>
<span id="cb211-865"><a href="#cb211-865" aria-hidden="true" tabindex="-1"></a><span class="in">output &lt;- chilling(make_JDay(Winters_hours_gaps),</span></span>
<span id="cb211-866"><a href="#cb211-866" aria-hidden="true" tabindex="-1"></a><span class="in">                   Start_JDay = 90,</span></span>
<span id="cb211-867"><a href="#cb211-867" aria-hidden="true" tabindex="-1"></a><span class="in">                   End_JDay = 100)</span></span>
<span id="cb211-868"><a href="#cb211-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-869"><a href="#cb211-869" aria-hidden="true" tabindex="-1"></a><span class="in">kable(output) %&gt;%</span></span>
<span id="cb211-870"><a href="#cb211-870" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", </span></span>
<span id="cb211-871"><a href="#cb211-871" aria-hidden="true" tabindex="-1"></a><span class="in">                position = "left",</span></span>
<span id="cb211-872"><a href="#cb211-872" aria-hidden="true" tabindex="-1"></a><span class="in">                font_size = 10)</span></span>
<span id="cb211-873"><a href="#cb211-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-874"><a href="#cb211-874" aria-hidden="true" tabindex="-1"></a><span class="in"># Use tempResponse function</span></span>
<span id="cb211-875"><a href="#cb211-875" aria-hidden="true" tabindex="-1"></a><span class="in">output &lt;- tempResponse(make_JDay(Winters_hours_gaps),</span></span>
<span id="cb211-876"><a href="#cb211-876" aria-hidden="true" tabindex="-1"></a><span class="in">                       Start_JDay = 90,</span></span>
<span id="cb211-877"><a href="#cb211-877" aria-hidden="true" tabindex="-1"></a><span class="in">                       End_JDay = 100,</span></span>
<span id="cb211-878"><a href="#cb211-878" aria-hidden="true" tabindex="-1"></a><span class="in">                       models = list(Chill_Portions = Dynamic_Model,</span></span>
<span id="cb211-879"><a href="#cb211-879" aria-hidden="true" tabindex="-1"></a><span class="in">                                     GDH = GDH))</span></span>
<span id="cb211-880"><a href="#cb211-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-881"><a href="#cb211-881" aria-hidden="true" tabindex="-1"></a><span class="in">kable(output) %&gt;%</span></span>
<span id="cb211-882"><a href="#cb211-882" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped",</span></span>
<span id="cb211-883"><a href="#cb211-883" aria-hidden="true" tabindex="-1"></a><span class="in">                position = "left",</span></span>
<span id="cb211-884"><a href="#cb211-884" aria-hidden="true" tabindex="-1"></a><span class="in">                font_size = 10)</span></span>
<span id="cb211-885"><a href="#cb211-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-886"><a href="#cb211-886" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-887"><a href="#cb211-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-888"><a href="#cb211-888" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-889"><a href="#cb211-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-890"><a href="#cb211-890" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;7.2&lt;/span&gt;&amp;nbsp; Exercise on chill models</span></span>
<span id="cb211-891"><a href="#cb211-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-892"><a href="#cb211-892" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-893"><a href="#cb211-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-894"><a href="#cb211-894" aria-hidden="true" tabindex="-1"></a>***1. Run the `chilling()` function on the `Winters_hours_gap` dataset***</span>
<span id="cb211-895"><a href="#cb211-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-896"><a href="#cb211-896" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 7.2.1}</span></span>
<span id="cb211-897"><a href="#cb211-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-898"><a href="#cb211-898" aria-hidden="true" tabindex="-1"></a><span class="in"># Check JDay for start and end of dataset period</span></span>
<span id="cb211-899"><a href="#cb211-899" aria-hidden="true" tabindex="-1"></a><span class="in">dates &lt;- data.frame(Year = c(2008, 2008),</span></span>
<span id="cb211-900"><a href="#cb211-900" aria-hidden="true" tabindex="-1"></a><span class="in">                    Month = c(3, 11),</span></span>
<span id="cb211-901"><a href="#cb211-901" aria-hidden="true" tabindex="-1"></a><span class="in">                    Day = c(3, 11))</span></span>
<span id="cb211-902"><a href="#cb211-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-903"><a href="#cb211-903" aria-hidden="true" tabindex="-1"></a><span class="in">kable(make_JDay(dates)) %&gt;%</span></span>
<span id="cb211-904"><a href="#cb211-904" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped",</span></span>
<span id="cb211-905"><a href="#cb211-905" aria-hidden="true" tabindex="-1"></a><span class="in">                position = "left",</span></span>
<span id="cb211-906"><a href="#cb211-906" aria-hidden="true" tabindex="-1"></a><span class="in">                font_size = 10)</span></span>
<span id="cb211-907"><a href="#cb211-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-908"><a href="#cb211-908" aria-hidden="true" tabindex="-1"></a><span class="in"># Apply chilling() function on Winters_hours_gap dataset</span></span>
<span id="cb211-909"><a href="#cb211-909" aria-hidden="true" tabindex="-1"></a><span class="in">c_output &lt;- chilling(make_JDay(Winters_hours_gaps),</span></span>
<span id="cb211-910"><a href="#cb211-910" aria-hidden="true" tabindex="-1"></a><span class="in">                     Start_JDay = 63,</span></span>
<span id="cb211-911"><a href="#cb211-911" aria-hidden="true" tabindex="-1"></a><span class="in">                     End_JDay = 316)</span></span>
<span id="cb211-912"><a href="#cb211-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-913"><a href="#cb211-913" aria-hidden="true" tabindex="-1"></a><span class="in">kable(c_output) %&gt;%</span></span>
<span id="cb211-914"><a href="#cb211-914" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped",</span></span>
<span id="cb211-915"><a href="#cb211-915" aria-hidden="true" tabindex="-1"></a><span class="in">                position = "left",</span></span>
<span id="cb211-916"><a href="#cb211-916" aria-hidden="true" tabindex="-1"></a><span class="in">                font_size = 10)</span></span>
<span id="cb211-917"><a href="#cb211-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-918"><a href="#cb211-918" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-919"><a href="#cb211-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-920"><a href="#cb211-920" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-921"><a href="#cb211-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-922"><a href="#cb211-922" aria-hidden="true" tabindex="-1"></a>***2. Create your own temperature-weighting chill model using the `step_model()` function***</span>
<span id="cb211-923"><a href="#cb211-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-924"><a href="#cb211-924" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 7.2.2}</span></span>
<span id="cb211-925"><a href="#cb211-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-926"><a href="#cb211-926" aria-hidden="true" tabindex="-1"></a><span class="in">t_data &lt;- data.frame(</span></span>
<span id="cb211-927"><a href="#cb211-927" aria-hidden="true" tabindex="-1"></a><span class="in">  lower  = c(-1000, 2, 8, 12, 15, 18, 20, 25),</span></span>
<span id="cb211-928"><a href="#cb211-928" aria-hidden="true" tabindex="-1"></a><span class="in">  upper  = c(2, 8, 12, 15, 18, 20, 25, 1000),</span></span>
<span id="cb211-929"><a href="#cb211-929" aria-hidden="true" tabindex="-1"></a><span class="in">  weight = c(0, 0.5, 1, 2, 0.5, -0.5, -1, -2)</span></span>
<span id="cb211-930"><a href="#cb211-930" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb211-931"><a href="#cb211-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-932"><a href="#cb211-932" aria-hidden="true" tabindex="-1"></a><span class="in">kable(t_data) %&gt;%</span></span>
<span id="cb211-933"><a href="#cb211-933" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-934"><a href="#cb211-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-935"><a href="#cb211-935" aria-hidden="true" tabindex="-1"></a><span class="in">custom &lt;- function(x) step_model(x, t_data)</span></span>
<span id="cb211-936"><a href="#cb211-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-937"><a href="#cb211-937" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-938"><a href="#cb211-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-939"><a href="#cb211-939" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-940"><a href="#cb211-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-941"><a href="#cb211-941" aria-hidden="true" tabindex="-1"></a>***3. Run this model on the `Winters_hours_gaps` dataset using the `tempResponse()` function.***</span>
<span id="cb211-942"><a href="#cb211-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-943"><a href="#cb211-943" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 7.2.3}</span></span>
<span id="cb211-944"><a href="#cb211-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-945"><a href="#cb211-945" aria-hidden="true" tabindex="-1"></a><span class="in">t_output &lt;- tempResponse(make_JDay(Winters_hours_gaps),</span></span>
<span id="cb211-946"><a href="#cb211-946" aria-hidden="true" tabindex="-1"></a><span class="in">                         Start_JDay = 63,</span></span>
<span id="cb211-947"><a href="#cb211-947" aria-hidden="true" tabindex="-1"></a><span class="in">                         End_JDay = 316,</span></span>
<span id="cb211-948"><a href="#cb211-948" aria-hidden="true" tabindex="-1"></a><span class="in">                         models = list (Cumulative_Temp = custom,</span></span>
<span id="cb211-949"><a href="#cb211-949" aria-hidden="true" tabindex="-1"></a><span class="in">                                        Chilling_Hours = Chilling_Hours,</span></span>
<span id="cb211-950"><a href="#cb211-950" aria-hidden="true" tabindex="-1"></a><span class="in">                                        Chill_Portions = Dynamic_Model,</span></span>
<span id="cb211-951"><a href="#cb211-951" aria-hidden="true" tabindex="-1"></a><span class="in">                                        Utah_Model = Utah_Model,</span></span>
<span id="cb211-952"><a href="#cb211-952" aria-hidden="true" tabindex="-1"></a><span class="in">                                        GDH = GDH))</span></span>
<span id="cb211-953"><a href="#cb211-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-954"><a href="#cb211-954" aria-hidden="true" tabindex="-1"></a><span class="in">kable(t_output) %&gt;%</span></span>
<span id="cb211-955"><a href="#cb211-955" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-956"><a href="#cb211-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-957"><a href="#cb211-957" aria-hidden="true" tabindex="-1"></a><span class="in"># Here we see a big difference between the outputs of various models, </span></span>
<span id="cb211-958"><a href="#cb211-958" aria-hidden="true" tabindex="-1"></a><span class="in"># due to the different parameters chosen? </span></span>
<span id="cb211-959"><a href="#cb211-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-960"><a href="#cb211-960" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-961"><a href="#cb211-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-962"><a href="#cb211-962" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-963"><a href="#cb211-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-964"><a href="#cb211-964" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 8: Making hourly temperatures</span></span>
<span id="cb211-965"><a href="#cb211-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-966"><a href="#cb211-966" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;8.1&lt;/span&gt;&amp;nbsp; Generating hourly temperatures</span></span>
<span id="cb211-967"><a href="#cb211-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-968"><a href="#cb211-968" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-969"><a href="#cb211-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-970"><a href="#cb211-970" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Most sources only provide daily data, usually including minimum and maximum temperature of the day, from which we can’t directly calculate Chilling Hours.</span>
<span id="cb211-971"><a href="#cb211-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-972"><a href="#cb211-972" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The rate of temperature increase in the morning is not the same as the rate of decrease in the evening. Besides, in particular the time of the lowest daily temperature varies considerably throughout the year (unless you’re close to the equator), and it would be good to consider this.</span>
<span id="cb211-973"><a href="#cb211-973" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>'Triangular' daily temperature pattern, achieved by interpolating linearly for hours between daily minimum temperature recorded at a certain time of day, and the maximum temperature at another time, is not realistic. </span>
<span id="cb211-974"><a href="#cb211-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-975"><a href="#cb211-975" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-976"><a href="#cb211-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-977"><a href="#cb211-977" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;8.1.1&lt;/span&gt;&amp;nbsp; Idealized daily temperature curves</span></span>
<span id="cb211-978"><a href="#cb211-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-979"><a href="#cb211-979" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-980"><a href="#cb211-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-981"><a href="#cb211-981" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">(Linvill, 1990)</span><span class="co">](https://journals.ashs.org/hortsci/view/journals/hortsci/25/1/article-p14.xml)</span> described the daily temperature curve using a combination of two mathematical equations: a sine curve to describe daytime warming, and a logarithmic decay function for nighttime cooling.</span>
<span id="cb211-982"><a href="#cb211-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-983"><a href="#cb211-983" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The transition points between the two parts were determined by sunrise and sunset, and the duration of the parts was related to daylength.</span>
<span id="cb211-984"><a href="#cb211-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-985"><a href="#cb211-985" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>One aspect that made Linvill’s equations hard to use across different locations was the dependency on sunrise and sunset times.</span>
<span id="cb211-986"><a href="#cb211-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-987"><a href="#cb211-987" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Fortunately, at least for locations without major topographic features, sunrise and sunset times can be calculated based on what we know about the geometry of our solar system.</span>
<span id="cb211-988"><a href="#cb211-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-989"><a href="#cb211-989" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use <span class="in">`daylength`</span> function to produce daily temperature curves.</span>
<span id="cb211-990"><a href="#cb211-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-991"><a href="#cb211-991" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>January 1st ist JDay 1, and December 31st either JDay 365 (in normal years) or JDay 366 (in leap years).</span>
<span id="cb211-992"><a href="#cb211-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-993"><a href="#cb211-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-994"><a href="#cb211-994" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 8.1.1}</span></span>
<span id="cb211-995"><a href="#cb211-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-996"><a href="#cb211-996" aria-hidden="true" tabindex="-1"></a><span class="in"># Make plots of the sunrise time, sunset time and daylength </span></span>
<span id="cb211-997"><a href="#cb211-997" aria-hidden="true" tabindex="-1"></a><span class="in"># at Klein-Altendorf (Latitude: 50.4°N) over the course of the year</span></span>
<span id="cb211-998"><a href="#cb211-998" aria-hidden="true" tabindex="-1"></a><span class="in">Days &lt;- daylength(latitude = 50.4, JDay = 1:365)</span></span>
<span id="cb211-999"><a href="#cb211-999" aria-hidden="true" tabindex="-1"></a><span class="in">Days_df &lt;- </span></span>
<span id="cb211-1000"><a href="#cb211-1000" aria-hidden="true" tabindex="-1"></a><span class="in">  data.frame(</span></span>
<span id="cb211-1001"><a href="#cb211-1001" aria-hidden="true" tabindex="-1"></a><span class="in">    JDay = 1:365,</span></span>
<span id="cb211-1002"><a href="#cb211-1002" aria-hidden="true" tabindex="-1"></a><span class="in">    Sunrise = Days$Sunrise,</span></span>
<span id="cb211-1003"><a href="#cb211-1003" aria-hidden="true" tabindex="-1"></a><span class="in">    Sunset = Days$Sunset,</span></span>
<span id="cb211-1004"><a href="#cb211-1004" aria-hidden="true" tabindex="-1"></a><span class="in">    Daylength = Days$Daylength</span></span>
<span id="cb211-1005"><a href="#cb211-1005" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb211-1006"><a href="#cb211-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1007"><a href="#cb211-1007" aria-hidden="true" tabindex="-1"></a><span class="in"># Use pivot_longer from tidyr to convert the data.frame, </span></span>
<span id="cb211-1008"><a href="#cb211-1008" aria-hidden="true" tabindex="-1"></a><span class="in"># so that the three time series (Sunrise, Sunset and Daylength) </span></span>
<span id="cb211-1009"><a href="#cb211-1009" aria-hidden="true" tabindex="-1"></a><span class="in"># were stacked on top of each other.</span></span>
<span id="cb211-1010"><a href="#cb211-1010" aria-hidden="true" tabindex="-1"></a><span class="in">Days_df &lt;- pivot_longer(Days_df, cols = c(Sunrise:Daylength))</span></span>
<span id="cb211-1011"><a href="#cb211-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1012"><a href="#cb211-1012" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(Days_df, aes(JDay, value)) +</span></span>
<span id="cb211-1013"><a href="#cb211-1013" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(lwd = 1.5) +</span></span>
<span id="cb211-1014"><a href="#cb211-1014" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(cols = vars(name)) +</span></span>
<span id="cb211-1015"><a href="#cb211-1015" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Time of Day / Daylength (Hours)") +</span></span>
<span id="cb211-1016"><a href="#cb211-1016" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 20)</span></span>
<span id="cb211-1017"><a href="#cb211-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1018"><a href="#cb211-1018" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1019"><a href="#cb211-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1020"><a href="#cb211-1020" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1021"><a href="#cb211-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1022"><a href="#cb211-1022" aria-hidden="true" tabindex="-1"></a><span class="fu">##### *Calculate hourly temperatures* {.unnumbered} </span></span>
<span id="cb211-1023"><a href="#cb211-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1024"><a href="#cb211-1024" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1025"><a href="#cb211-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1026"><a href="#cb211-1026" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`stack_hourly_temps()`</span> function takes as input a dataset of daily minimum and maximum temperatures</span>
<span id="cb211-1027"><a href="#cb211-1027" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Columns: <span class="in">`Tmin`</span>, <span class="in">`Tmax`</span>, <span class="in">`Year`</span>, <span class="in">`Month`</span>, <span class="in">`Day`</span></span>
<span id="cb211-1028"><a href="#cb211-1028" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Need the latitude of the place of interest</span>
<span id="cb211-1029"><a href="#cb211-1029" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Can also output the sunrise and sunset times</span>
<span id="cb211-1030"><a href="#cb211-1030" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-1031"><a href="#cb211-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1032"><a href="#cb211-1032" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 8.1.1a}</span></span>
<span id="cb211-1033"><a href="#cb211-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1034"><a href="#cb211-1034" aria-hidden="true" tabindex="-1"></a><span class="in"># Use KA_weather dataset to demonstrate stack_hourly_temps() function</span></span>
<span id="cb211-1035"><a href="#cb211-1035" aria-hidden="true" tabindex="-1"></a><span class="in">kable(chillR:: KA_weather[1:10, ]) %&gt;%</span></span>
<span id="cb211-1036"><a href="#cb211-1036" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-1037"><a href="#cb211-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1038"><a href="#cb211-1038" aria-hidden="true" tabindex="-1"></a><span class="in">## Adrian's codes </span></span>
<span id="cb211-1039"><a href="#cb211-1039" aria-hidden="true" tabindex="-1"></a><span class="in"># i recommend getting the prior day as well - because it will affect </span></span>
<span id="cb211-1040"><a href="#cb211-1040" aria-hidden="true" tabindex="-1"></a><span class="in"># the idealized curve pattern </span></span>
<span id="cb211-1041"><a href="#cb211-1041" aria-hidden="true" tabindex="-1"></a><span class="in">KA_weather_subset &lt;- </span></span>
<span id="cb211-1042"><a href="#cb211-1042" aria-hidden="true" tabindex="-1"></a><span class="in">  KA_weather %&gt;% </span></span>
<span id="cb211-1043"><a href="#cb211-1043" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Year == 1998) %&gt;% </span></span>
<span id="cb211-1044"><a href="#cb211-1044" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Month == 1) %&gt;% </span></span>
<span id="cb211-1045"><a href="#cb211-1045" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Day == 4</span></span>
<span id="cb211-1046"><a href="#cb211-1046" aria-hidden="true" tabindex="-1"></a><span class="in">         | Day == 5</span></span>
<span id="cb211-1047"><a href="#cb211-1047" aria-hidden="true" tabindex="-1"></a><span class="in">         | Day == 6</span></span>
<span id="cb211-1048"><a href="#cb211-1048" aria-hidden="true" tabindex="-1"></a><span class="in">         )</span></span>
<span id="cb211-1049"><a href="#cb211-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1050"><a href="#cb211-1050" aria-hidden="true" tabindex="-1"></a><span class="in">sh_data &lt;- stack_hourly_temps(KA_weather_subset, latitude = 50.4)</span></span>
<span id="cb211-1051"><a href="#cb211-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1052"><a href="#cb211-1052" aria-hidden="true" tabindex="-1"></a><span class="in"># stack_hourly_temps produces a list with 2 elements - the data and </span></span>
<span id="cb211-1053"><a href="#cb211-1053" aria-hidden="true" tabindex="-1"></a><span class="in"># a quality control table - select the hourtemps element to get the actual data</span></span>
<span id="cb211-1054"><a href="#cb211-1054" aria-hidden="true" tabindex="-1"></a><span class="in">sh_data &lt;- sh_data[["hourtemps"]]</span></span>
<span id="cb211-1055"><a href="#cb211-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1056"><a href="#cb211-1056" aria-hidden="true" tabindex="-1"></a><span class="in"># filter by day if you want to</span></span>
<span id="cb211-1057"><a href="#cb211-1057" aria-hidden="true" tabindex="-1"></a><span class="in">kable(sh_data %&gt;% filter(Day == 5)) %&gt;%</span></span>
<span id="cb211-1058"><a href="#cb211-1058" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-1059"><a href="#cb211-1059" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb211-1060"><a href="#cb211-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1061"><a href="#cb211-1061" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1062"><a href="#cb211-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1063"><a href="#cb211-1063" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1064"><a href="#cb211-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1065"><a href="#cb211-1065" aria-hidden="true" tabindex="-1"></a>Here, I will try to recreate the line graph shown in the coursebook.</span>
<span id="cb211-1066"><a href="#cb211-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1067"><a href="#cb211-1067" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 8.1.1b}</span></span>
<span id="cb211-1068"><a href="#cb211-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1069"><a href="#cb211-1069" aria-hidden="true" tabindex="-1"></a><span class="in"># Here I select from day 1 to 6 because the graph in the coursebook starts from</span></span>
<span id="cb211-1070"><a href="#cb211-1070" aria-hidden="true" tabindex="-1"></a><span class="in"># day 2. I found the graph lies flat if I started from day 2, so need to select</span></span>
<span id="cb211-1071"><a href="#cb211-1071" aria-hidden="true" tabindex="-1"></a><span class="in"># one day before and one day after to show the direction of the graph better</span></span>
<span id="cb211-1072"><a href="#cb211-1072" aria-hidden="true" tabindex="-1"></a><span class="in">KA_weather_subset &lt;- </span></span>
<span id="cb211-1073"><a href="#cb211-1073" aria-hidden="true" tabindex="-1"></a><span class="in">  KA_weather %&gt;% </span></span>
<span id="cb211-1074"><a href="#cb211-1074" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Year == 1998) %&gt;% </span></span>
<span id="cb211-1075"><a href="#cb211-1075" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Month == 1) %&gt;% </span></span>
<span id="cb211-1076"><a href="#cb211-1076" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Day == 1</span></span>
<span id="cb211-1077"><a href="#cb211-1077" aria-hidden="true" tabindex="-1"></a><span class="in">         | Day == 2</span></span>
<span id="cb211-1078"><a href="#cb211-1078" aria-hidden="true" tabindex="-1"></a><span class="in">         | Day == 3</span></span>
<span id="cb211-1079"><a href="#cb211-1079" aria-hidden="true" tabindex="-1"></a><span class="in">         | Day == 4</span></span>
<span id="cb211-1080"><a href="#cb211-1080" aria-hidden="true" tabindex="-1"></a><span class="in">         | Day == 5</span></span>
<span id="cb211-1081"><a href="#cb211-1081" aria-hidden="true" tabindex="-1"></a><span class="in">         | Day == 6</span></span>
<span id="cb211-1082"><a href="#cb211-1082" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb211-1083"><a href="#cb211-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1084"><a href="#cb211-1084" aria-hidden="true" tabindex="-1"></a><span class="in">sh_data &lt;- stack_hourly_temps(KA_weather_subset, latitude = 50.4)</span></span>
<span id="cb211-1085"><a href="#cb211-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1086"><a href="#cb211-1086" aria-hidden="true" tabindex="-1"></a><span class="in">sh_data &lt;- sh_data[["hourtemps"]]</span></span>
<span id="cb211-1087"><a href="#cb211-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1088"><a href="#cb211-1088" aria-hidden="true" tabindex="-1"></a><span class="in"># Choose from day 1 to 5 to show x-axis from day 2 to 5</span></span>
<span id="cb211-1089"><a href="#cb211-1089" aria-hidden="true" tabindex="-1"></a><span class="in">sh_data_plot &lt;- sh_data %&gt;%</span></span>
<span id="cb211-1090"><a href="#cb211-1090" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Day &gt;= 1 &amp; Day &lt;= 5) %&gt;%</span></span>
<span id="cb211-1091"><a href="#cb211-1091" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(DateTime = ymd_h(paste(Year, Month, Day, Hour, sep = "-")))</span></span>
<span id="cb211-1092"><a href="#cb211-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1093"><a href="#cb211-1093" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data with DateTime on the x-axis for continuous plotting and use</span></span>
<span id="cb211-1094"><a href="#cb211-1094" aria-hidden="true" tabindex="-1"></a><span class="in"># POSIXct to extend the curve a bit before day 2 and beyond day 5 like the graph</span></span>
<span id="cb211-1095"><a href="#cb211-1095" aria-hidden="true" tabindex="-1"></a><span class="in"># in the coursebook </span></span>
<span id="cb211-1096"><a href="#cb211-1096" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(sh_data_plot, aes(x = DateTime, y = Temp)) +</span></span>
<span id="cb211-1097"><a href="#cb211-1097" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(lwd = 1.5) +</span></span>
<span id="cb211-1098"><a href="#cb211-1098" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_datetime(limits = c(as.POSIXct("1998-01-01 20:00:00"), </span></span>
<span id="cb211-1099"><a href="#cb211-1099" aria-hidden="true" tabindex="-1"></a><span class="in">                              as.POSIXct("1998-01-05 07:00:00"))) +</span></span>
<span id="cb211-1100"><a href="#cb211-1100" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Date", y = "Temperature (°C)") +</span></span>
<span id="cb211-1101"><a href="#cb211-1101" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 10) </span></span>
<span id="cb211-1102"><a href="#cb211-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1103"><a href="#cb211-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1104"><a href="#cb211-1104" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1105"><a href="#cb211-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1106"><a href="#cb211-1106" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1107"><a href="#cb211-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1108"><a href="#cb211-1108" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;8.1.2&lt;/span&gt;&amp;nbsp; Empirical daily temperature curves</span></span>
<span id="cb211-1109"><a href="#cb211-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1110"><a href="#cb211-1110" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1111"><a href="#cb211-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1112"><a href="#cb211-1112" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There are some locations where idealized daily temperature curves don’t work, e.g., rugged topography<span class="dv">&amp;mdash;</span> trees maybe shaded for part of the day.</span>
<span id="cb211-1113"><a href="#cb211-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1114"><a href="#cb211-1114" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Also the temperature curve in an orchard, which may feature its own microclimate, with shaded and sunny spots, with dew-covered grass or bare ground etc., may not closely resemble the curve drawn up by <span class="co">[</span><span class="ot">Linvill (1990)</span><span class="co">](https://journals.ashs.org/hortsci/view/journals/hortsci/25/1/article-p14.xml)</span></span>
<span id="cb211-1115"><a href="#cb211-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1116"><a href="#cb211-1116" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Addressing the issue with <span class="co">[</span><span class="ot">(Buerkert et al., 2020)</span><span class="co">](https://link.springer.com/article/10.1007/s10584-020-02862-8)</span></span>
<span id="cb211-1117"><a href="#cb211-1117" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Obtain a dataset of hourly temperature data for the location interest (at least a full year, ideally multiple years)</span>
<span id="cb211-1118"><a href="#cb211-1118" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Then, use <span class="in">`Empirical_daily_temperature_curve()`</span>  function to determine the typical pattern of hourly temperatures at this location<span class="dv">&amp;mdash;</span> done separately for each month of the year (could be continuous?)</span>
<span id="cb211-1119"><a href="#cb211-1119" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Then, apply the obtained set of coefficients to a daily dataset from the same location to get a reasonable hourly temperature record. Use <span class="in">`Empirical_hourly_temperatures`</span> function which requires as inputs a set of hourly coefficients, and a daily temperature record (which includes <span class="in">`Tmin`</span> and <span class="in">`Tmax`</span> columns).</span>
<span id="cb211-1120"><a href="#cb211-1120" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-1121"><a href="#cb211-1121" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-1122"><a href="#cb211-1122" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 8.1.2}</span></span>
<span id="cb211-1123"><a href="#cb211-1123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1124"><a href="#cb211-1124" aria-hidden="true" tabindex="-1"></a><span class="in">empi_curve &lt;- Empirical_daily_temperature_curve(Winters_hours_gaps)</span></span>
<span id="cb211-1125"><a href="#cb211-1125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1126"><a href="#cb211-1126" aria-hidden="true" tabindex="-1"></a><span class="in"># Show results in a table </span></span>
<span id="cb211-1127"><a href="#cb211-1127" aria-hidden="true" tabindex="-1"></a><span class="in">kable(empi_curve[1:48, ]) %&gt;%</span></span>
<span id="cb211-1128"><a href="#cb211-1128" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-1129"><a href="#cb211-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1130"><a href="#cb211-1130" aria-hidden="true" tabindex="-1"></a><span class="in"># Show results in a figure</span></span>
<span id="cb211-1131"><a href="#cb211-1131" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = empi_curve[1:96, ],</span></span>
<span id="cb211-1132"><a href="#cb211-1132" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(Hour, Prediction_coefficient)) +</span></span>
<span id="cb211-1133"><a href="#cb211-1133" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(lwd = 1.3,</span></span>
<span id="cb211-1134"><a href="#cb211-1134" aria-hidden="true" tabindex="-1"></a><span class="in">            col = "red") +</span></span>
<span id="cb211-1135"><a href="#cb211-1135" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(rows = vars(Month)) +</span></span>
<span id="cb211-1136"><a href="#cb211-1136" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Hour of the day") +</span></span>
<span id="cb211-1137"><a href="#cb211-1137" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Prediction coefficient") + # hourly coefficients needed as inputs for step 3</span></span>
<span id="cb211-1138"><a href="#cb211-1138" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 20)</span></span>
<span id="cb211-1139"><a href="#cb211-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1140"><a href="#cb211-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1141"><a href="#cb211-1141" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1142"><a href="#cb211-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1143"><a href="#cb211-1143" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1144"><a href="#cb211-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1145"><a href="#cb211-1145" aria-hidden="true" tabindex="-1"></a><span class="fu">##### *`make_all_day_table` function* {.unnumbered}</span></span>
<span id="cb211-1146"><a href="#cb211-1146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1147"><a href="#cb211-1147" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1148"><a href="#cb211-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1149"><a href="#cb211-1149" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Fill gaps in daily or hourly temperature records</span>
<span id="cb211-1150"><a href="#cb211-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1151"><a href="#cb211-1151" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Summarize hourly records into daily minimum and maximum temperatures</span>
<span id="cb211-1152"><a href="#cb211-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1153"><a href="#cb211-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1154"><a href="#cb211-1154" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 8.1.2a}</span></span>
<span id="cb211-1155"><a href="#cb211-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1156"><a href="#cb211-1156" aria-hidden="true" tabindex="-1"></a><span class="in"># Summarize hourly records into daily minimum and maximum temperatures</span></span>
<span id="cb211-1157"><a href="#cb211-1157" aria-hidden="true" tabindex="-1"></a><span class="in">coeffs &lt;- Empirical_daily_temperature_curve(Winters_hours_gaps)</span></span>
<span id="cb211-1158"><a href="#cb211-1158" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_daily &lt;- </span></span>
<span id="cb211-1159"><a href="#cb211-1159" aria-hidden="true" tabindex="-1"></a><span class="in">  make_all_day_table(Winters_hours_gaps, input_timestep = "hour")</span></span>
<span id="cb211-1160"><a href="#cb211-1160" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_hours &lt;- Empirical_hourly_temperatures(Winters_daily, coeffs)</span></span>
<span id="cb211-1161"><a href="#cb211-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1162"><a href="#cb211-1162" aria-hidden="true" tabindex="-1"></a><span class="in"># Simplify data a bit to make it easier to use</span></span>
<span id="cb211-1163"><a href="#cb211-1163" aria-hidden="true" tabindex="-1"></a><span class="in"># require(reshape2)</span></span>
<span id="cb211-1164"><a href="#cb211-1164" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_hours &lt;- Winters_hours[, c("Year", "Month", "Day", "Hour", "Temp")]</span></span>
<span id="cb211-1165"><a href="#cb211-1165" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(Winters_hours)[ncol(Winters_hours)] &lt;- "Temp_empirical"</span></span>
<span id="cb211-1166"><a href="#cb211-1166" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_ideal &lt;-</span></span>
<span id="cb211-1167"><a href="#cb211-1167" aria-hidden="true" tabindex="-1"></a><span class="in">  stack_hourly_temps(Winters_daily, latitude = 38.5)$hourtemps</span></span>
<span id="cb211-1168"><a href="#cb211-1168" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_ideal &lt;- Winters_ideal[, c("Year", "Month", "Day", "Hour", "Temp")]</span></span>
<span id="cb211-1169"><a href="#cb211-1169" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(Winters_ideal)[ncol(Winters_ideal)] &lt;- "Temp_ideal"</span></span>
<span id="cb211-1170"><a href="#cb211-1170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1171"><a href="#cb211-1171" aria-hidden="true" tabindex="-1"></a><span class="in"># Make triangular dataset to understand how it works</span></span>
<span id="cb211-1172"><a href="#cb211-1172" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_triangle &lt;- Winters_daily</span></span>
<span id="cb211-1173"><a href="#cb211-1173" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_triangle[, "Hour"] &lt;- 0</span></span>
<span id="cb211-1174"><a href="#cb211-1174" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_triangle$Hour[nrow(Winters_triangle)] &lt;- 23</span></span>
<span id="cb211-1175"><a href="#cb211-1175" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_triangle[, "Temp"] &lt;- 0</span></span>
<span id="cb211-1176"><a href="#cb211-1176" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_triangle &lt;-</span></span>
<span id="cb211-1177"><a href="#cb211-1177" aria-hidden="true" tabindex="-1"></a><span class="in">  make_all_day_table(Winters_triangle, timestep = "hour")</span></span>
<span id="cb211-1178"><a href="#cb211-1178" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(Winters_triangle)[ncol(Winters_triangle)] &lt;-</span></span>
<span id="cb211-1179"><a href="#cb211-1179" aria-hidden="true" tabindex="-1"></a><span class="in">  "Temp_triangular"</span></span>
<span id="cb211-1180"><a href="#cb211-1180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1181"><a href="#cb211-1181" aria-hidden="true" tabindex="-1"></a><span class="in"># with the following loop, we fill in the daily Tmin and Tmax values for every</span></span>
<span id="cb211-1182"><a href="#cb211-1182" aria-hidden="true" tabindex="-1"></a><span class="in"># hour of the dataset</span></span>
<span id="cb211-1183"><a href="#cb211-1183" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 2:nrow(Winters_triangle))</span></span>
<span id="cb211-1184"><a href="#cb211-1184" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb211-1185"><a href="#cb211-1185" aria-hidden="true" tabindex="-1"></a><span class="in">  if (is.na(Winters_triangle$Tmin[i]))</span></span>
<span id="cb211-1186"><a href="#cb211-1186" aria-hidden="true" tabindex="-1"></a><span class="in">    Winters_triangle$Tmin[i] &lt;- Winters_triangle$Tmin[i - 1]</span></span>
<span id="cb211-1187"><a href="#cb211-1187" aria-hidden="true" tabindex="-1"></a><span class="in">  if (is.na(Winters_triangle$Tmax[i]))</span></span>
<span id="cb211-1188"><a href="#cb211-1188" aria-hidden="true" tabindex="-1"></a><span class="in">    Winters_triangle$Tmax[i] &lt;- Winters_triangle$Tmax[i - 1]</span></span>
<span id="cb211-1189"><a href="#cb211-1189" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb211-1190"><a href="#cb211-1190" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_triangle$Temp_triangular &lt;- NA</span></span>
<span id="cb211-1191"><a href="#cb211-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1192"><a href="#cb211-1192" aria-hidden="true" tabindex="-1"></a><span class="in"># now we assign the daily Tmin value to the 6th hour of every day</span></span>
<span id="cb211-1193"><a href="#cb211-1193" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_triangle$Temp_triangular[which(Winters_triangle$Hour == 6)] &lt;-</span></span>
<span id="cb211-1194"><a href="#cb211-1194" aria-hidden="true" tabindex="-1"></a><span class="in">  Winters_triangle$Tmin[which(Winters_triangle$Hour == 6)]</span></span>
<span id="cb211-1195"><a href="#cb211-1195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1196"><a href="#cb211-1196" aria-hidden="true" tabindex="-1"></a><span class="in"># we also assign the daily Tmax value to the 18th hour of every day</span></span>
<span id="cb211-1197"><a href="#cb211-1197" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_triangle$Temp_triangular[which(Winters_triangle$Hour == 18)] &lt;-</span></span>
<span id="cb211-1198"><a href="#cb211-1198" aria-hidden="true" tabindex="-1"></a><span class="in">  Winters_triangle$Tmax[which(Winters_triangle$Hour == 18)]</span></span>
<span id="cb211-1199"><a href="#cb211-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1200"><a href="#cb211-1200" aria-hidden="true" tabindex="-1"></a><span class="in"># in the following step, we use the chillR function "interpolate_gaps"</span></span>
<span id="cb211-1201"><a href="#cb211-1201" aria-hidden="true" tabindex="-1"></a><span class="in"># to fill in all the gaps in the hourly record with straight lines</span></span>
<span id="cb211-1202"><a href="#cb211-1202" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_triangle$Temp_triangular &lt;-</span></span>
<span id="cb211-1203"><a href="#cb211-1203" aria-hidden="true" tabindex="-1"></a><span class="in">  interpolate_gaps(Winters_triangle$Temp_triangular)$interp</span></span>
<span id="cb211-1204"><a href="#cb211-1204" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_triangle &lt;-</span></span>
<span id="cb211-1205"><a href="#cb211-1205" aria-hidden="true" tabindex="-1"></a><span class="in">  Winters_triangle[, c("Year", "Month", "Day", "Hour", "Temp_triangular")]</span></span>
<span id="cb211-1206"><a href="#cb211-1206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1207"><a href="#cb211-1207" aria-hidden="true" tabindex="-1"></a><span class="in"># Now, merge all these into data.frames to display them easily</span></span>
<span id="cb211-1208"><a href="#cb211-1208" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_temps &lt;-</span></span>
<span id="cb211-1209"><a href="#cb211-1209" aria-hidden="true" tabindex="-1"></a><span class="in">  merge(Winters_hours_gaps,</span></span>
<span id="cb211-1210"><a href="#cb211-1210" aria-hidden="true" tabindex="-1"></a><span class="in">        Winters_hours,</span></span>
<span id="cb211-1211"><a href="#cb211-1211" aria-hidden="true" tabindex="-1"></a><span class="in">        by = c("Year", "Month", "Day", "Hour"))</span></span>
<span id="cb211-1212"><a href="#cb211-1212" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_temps &lt;-</span></span>
<span id="cb211-1213"><a href="#cb211-1213" aria-hidden="true" tabindex="-1"></a><span class="in">  merge(Winters_temps,</span></span>
<span id="cb211-1214"><a href="#cb211-1214" aria-hidden="true" tabindex="-1"></a><span class="in">        Winters_triangle,</span></span>
<span id="cb211-1215"><a href="#cb211-1215" aria-hidden="true" tabindex="-1"></a><span class="in">        by = c("Year", "Month", "Day", "Hour"))</span></span>
<span id="cb211-1216"><a href="#cb211-1216" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_temps &lt;-</span></span>
<span id="cb211-1217"><a href="#cb211-1217" aria-hidden="true" tabindex="-1"></a><span class="in">  merge(Winters_temps,</span></span>
<span id="cb211-1218"><a href="#cb211-1218" aria-hidden="true" tabindex="-1"></a><span class="in">        Winters_ideal,</span></span>
<span id="cb211-1219"><a href="#cb211-1219" aria-hidden="true" tabindex="-1"></a><span class="in">        by = c("Year", "Month", "Day", "Hour"))</span></span>
<span id="cb211-1220"><a href="#cb211-1220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1221"><a href="#cb211-1221" aria-hidden="true" tabindex="-1"></a><span class="in"># Now we have a dataset with the observed temperatures and the three </span></span>
<span id="cb211-1222"><a href="#cb211-1222" aria-hidden="true" tabindex="-1"></a><span class="in"># approximations (triangular, idealized curve and empirical curve). </span></span>
<span id="cb211-1223"><a href="#cb211-1223" aria-hidden="true" tabindex="-1"></a><span class="in"># To plot this effectively, let’s convert the Year, Month, Day and Hour columns </span></span>
<span id="cb211-1224"><a href="#cb211-1224" aria-hidden="true" tabindex="-1"></a><span class="in"># into R’s date format (using ISOdate) and reorganize the data.frame a bit.</span></span>
<span id="cb211-1225"><a href="#cb211-1225" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_temps[, "DATE"] &lt;-</span></span>
<span id="cb211-1226"><a href="#cb211-1226" aria-hidden="true" tabindex="-1"></a><span class="in">  ISOdate(Winters_temps$Year,</span></span>
<span id="cb211-1227"><a href="#cb211-1227" aria-hidden="true" tabindex="-1"></a><span class="in">          Winters_temps$Month,</span></span>
<span id="cb211-1228"><a href="#cb211-1228" aria-hidden="true" tabindex="-1"></a><span class="in">          Winters_temps$Day,</span></span>
<span id="cb211-1229"><a href="#cb211-1229" aria-hidden="true" tabindex="-1"></a><span class="in">          Winters_temps$Hour)</span></span>
<span id="cb211-1230"><a href="#cb211-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1231"><a href="#cb211-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1232"><a href="#cb211-1232" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_temps_to_plot &lt;-</span></span>
<span id="cb211-1233"><a href="#cb211-1233" aria-hidden="true" tabindex="-1"></a><span class="in">  Winters_temps[, c("DATE",</span></span>
<span id="cb211-1234"><a href="#cb211-1234" aria-hidden="true" tabindex="-1"></a><span class="in">                    "Temp",</span></span>
<span id="cb211-1235"><a href="#cb211-1235" aria-hidden="true" tabindex="-1"></a><span class="in">                    "Temp_empirical",</span></span>
<span id="cb211-1236"><a href="#cb211-1236" aria-hidden="true" tabindex="-1"></a><span class="in">                    "Temp_triangular",</span></span>
<span id="cb211-1237"><a href="#cb211-1237" aria-hidden="true" tabindex="-1"></a><span class="in">                    "Temp_ideal")]</span></span>
<span id="cb211-1238"><a href="#cb211-1238" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_temps_to_plot &lt;- Winters_temps_to_plot[100:200, ]</span></span>
<span id="cb211-1239"><a href="#cb211-1239" aria-hidden="true" tabindex="-1"></a><span class="in">Winters_temps_to_plot &lt;- pivot_longer(Winters_temps_to_plot, cols=Temp:Temp_ideal)</span></span>
<span id="cb211-1240"><a href="#cb211-1240" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(Winters_temps_to_plot) &lt;- c("DATE", "Method", "Temperature")</span></span>
<span id="cb211-1241"><a href="#cb211-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1242"><a href="#cb211-1242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1243"><a href="#cb211-1243" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = Winters_temps_to_plot, aes(DATE, Temperature, colour = Method)) +</span></span>
<span id="cb211-1244"><a href="#cb211-1244" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(lwd = 1.3) + ylab("Temperature (°C)") + xlab("Date")</span></span>
<span id="cb211-1245"><a href="#cb211-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1246"><a href="#cb211-1246" aria-hidden="true" tabindex="-1"></a><span class="in"># This plots shows that the triangular curve is quite far off the mark. </span></span>
<span id="cb211-1247"><a href="#cb211-1247" aria-hidden="true" tabindex="-1"></a><span class="in"># Temp_empirical and Temp_ideal look pretty similar and are hard to distinguish.</span></span>
<span id="cb211-1248"><a href="#cb211-1248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1249"><a href="#cb211-1249" aria-hidden="true" tabindex="-1"></a><span class="in"># Use the `Root Mean Square Error` function-- useful for quantifying the </span></span>
<span id="cb211-1250"><a href="#cb211-1250" aria-hidden="true" tabindex="-1"></a><span class="in"># correspondence between predicted and observed values-- to compare these curves</span></span>
<span id="cb211-1251"><a href="#cb211-1251" aria-hidden="true" tabindex="-1"></a><span class="in"># a bit more thoroughly by computing</span></span>
<span id="cb211-1252"><a href="#cb211-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1253"><a href="#cb211-1253" aria-hidden="true" tabindex="-1"></a><span class="in"># here's the RMSE for the triangular method:</span></span>
<span id="cb211-1254"><a href="#cb211-1254" aria-hidden="true" tabindex="-1"></a><span class="in">RMSEP(Winters_temps$Temp_triangular, Winters_temps$Temp)</span></span>
<span id="cb211-1255"><a href="#cb211-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1256"><a href="#cb211-1256" aria-hidden="true" tabindex="-1"></a><span class="in"># here's the RMSE for the idealized-curve method:</span></span>
<span id="cb211-1257"><a href="#cb211-1257" aria-hidden="true" tabindex="-1"></a><span class="in">RMSEP(Winters_temps$Temp_ideal, Winters_temps$Temp)</span></span>
<span id="cb211-1258"><a href="#cb211-1258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1259"><a href="#cb211-1259" aria-hidden="true" tabindex="-1"></a><span class="in"># and here's the RMSE for the empirical-curve method:</span></span>
<span id="cb211-1260"><a href="#cb211-1260" aria-hidden="true" tabindex="-1"></a><span class="in">RMSEP(Winters_temps$Temp_empirical, Winters_temps$Temp)</span></span>
<span id="cb211-1261"><a href="#cb211-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1262"><a href="#cb211-1262" aria-hidden="true" tabindex="-1"></a><span class="in"># RMSE of 4.7 for the triangular method, an RMSE of 1.63 for the </span></span>
<span id="cb211-1263"><a href="#cb211-1263" aria-hidden="true" tabindex="-1"></a><span class="in"># idealized-curve method, and an RMSE of 1.41 for the empirical-curve method.</span></span>
<span id="cb211-1264"><a href="#cb211-1264" aria-hidden="true" tabindex="-1"></a><span class="in"># Since this metric should be low, we see that calibrating the prediction </span></span>
<span id="cb211-1265"><a href="#cb211-1265" aria-hidden="true" tabindex="-1"></a><span class="in"># function with observed hourly data brought some advantages, in particular </span></span>
<span id="cb211-1266"><a href="#cb211-1266" aria-hidden="true" tabindex="-1"></a><span class="in"># when compared with the triangular method.</span></span>
<span id="cb211-1267"><a href="#cb211-1267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1268"><a href="#cb211-1268" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1269"><a href="#cb211-1269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1270"><a href="#cb211-1270" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1271"><a href="#cb211-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1272"><a href="#cb211-1272" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;8.2&lt;/span&gt;&amp;nbsp; Exercise on hourly temperatures</span></span>
<span id="cb211-1273"><a href="#cb211-1273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1274"><a href="#cb211-1274" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1275"><a href="#cb211-1275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1276"><a href="#cb211-1276" aria-hidden="true" tabindex="-1"></a>***1. Choose a location of interest, find out its latitude and produce plots of daily sunrise, sunset and daylength.***</span>
<span id="cb211-1277"><a href="#cb211-1277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1278"><a href="#cb211-1278" aria-hidden="true" tabindex="-1"></a>My location of interest is M<span class="dv">&amp;ouml;</span>ssigen, an orchard town in Baden-W<span class="dv">&amp;uuml;</span>rttemberg, which is a state that ranks highest among regions for cultivation of top fruits, according to the <span class="co">[</span><span class="ot">report</span><span class="co">](https://www.destatis.de/EN/Themes/Economic-Sectors-Enterprises/Agriculture-Forestry-Fisheries/Fruit-Vegetables-Horticulture/Tables/2-2-area-of-tree-fruits-laender.html)</span> by Statistisches Bundesmat. The GPS coordinates of M<span class="dv">&amp;ouml;</span>ssigen are 48.40567° N latitude, and 9.05419° E longitude, as stated in <span class="co">[</span><span class="ot">database.earth</span><span class="co">](https://database.earth/countries/germany/regions/baden-wurttemberg/cities/mossingen)</span>.</span>
<span id="cb211-1279"><a href="#cb211-1279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1280"><a href="#cb211-1280" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 8.2.1}</span></span>
<span id="cb211-1281"><a href="#cb211-1281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1282"><a href="#cb211-1282" aria-hidden="true" tabindex="-1"></a><span class="in"># Compute daylength</span></span>
<span id="cb211-1283"><a href="#cb211-1283" aria-hidden="true" tabindex="-1"></a><span class="in">MS_days &lt;- daylength(latitude = 48.4, JDay = 1:365)</span></span>
<span id="cb211-1284"><a href="#cb211-1284" aria-hidden="true" tabindex="-1"></a><span class="in">MS_days_df &lt;- </span></span>
<span id="cb211-1285"><a href="#cb211-1285" aria-hidden="true" tabindex="-1"></a><span class="in">  data.frame(</span></span>
<span id="cb211-1286"><a href="#cb211-1286" aria-hidden="true" tabindex="-1"></a><span class="in">    JDay = 1:365,</span></span>
<span id="cb211-1287"><a href="#cb211-1287" aria-hidden="true" tabindex="-1"></a><span class="in">    Sunrise = MS_days$Sunrise,</span></span>
<span id="cb211-1288"><a href="#cb211-1288" aria-hidden="true" tabindex="-1"></a><span class="in">    Sunset = MS_days$Sunset,</span></span>
<span id="cb211-1289"><a href="#cb211-1289" aria-hidden="true" tabindex="-1"></a><span class="in">    Daylength = MS_days$Daylength</span></span>
<span id="cb211-1290"><a href="#cb211-1290" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb211-1291"><a href="#cb211-1291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1292"><a href="#cb211-1292" aria-hidden="true" tabindex="-1"></a><span class="in"># Convert data.frame for ggplot</span></span>
<span id="cb211-1293"><a href="#cb211-1293" aria-hidden="true" tabindex="-1"></a><span class="in">MS_days_df &lt;- pivot_longer(MS_days_df, cols = c(Sunrise:Daylength))</span></span>
<span id="cb211-1294"><a href="#cb211-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1295"><a href="#cb211-1295" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(MS_days_df, aes(JDay, value)) +</span></span>
<span id="cb211-1296"><a href="#cb211-1296" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(lwd = 1.5) +</span></span>
<span id="cb211-1297"><a href="#cb211-1297" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(cols = vars(name)) +</span></span>
<span id="cb211-1298"><a href="#cb211-1298" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Time of Day / Daylength (Hours)") +</span></span>
<span id="cb211-1299"><a href="#cb211-1299" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 20)</span></span>
<span id="cb211-1300"><a href="#cb211-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1301"><a href="#cb211-1301" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1302"><a href="#cb211-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1303"><a href="#cb211-1303" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1304"><a href="#cb211-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1305"><a href="#cb211-1305" aria-hidden="true" tabindex="-1"></a>***2. Produce an hourly dataset, based on idealized daily curves, for the `KA_weather` dataset (included in `chillR`)***</span>
<span id="cb211-1306"><a href="#cb211-1306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1307"><a href="#cb211-1307" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 8.2.2}</span></span>
<span id="cb211-1308"><a href="#cb211-1308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1309"><a href="#cb211-1309" aria-hidden="true" tabindex="-1"></a><span class="in"># I want to produce an hourly dataset for 4 October 1998</span></span>
<span id="cb211-1310"><a href="#cb211-1310" aria-hidden="true" tabindex="-1"></a><span class="in"># Chose values for one day before and one day after as they can impact the curve</span></span>
<span id="cb211-1311"><a href="#cb211-1311" aria-hidden="true" tabindex="-1"></a><span class="in">KA_weather_subset &lt;- </span></span>
<span id="cb211-1312"><a href="#cb211-1312" aria-hidden="true" tabindex="-1"></a><span class="in">  KA_weather %&gt;% </span></span>
<span id="cb211-1313"><a href="#cb211-1313" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Year == 1998) %&gt;% </span></span>
<span id="cb211-1314"><a href="#cb211-1314" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Month == 10) %&gt;% </span></span>
<span id="cb211-1315"><a href="#cb211-1315" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Day == 3</span></span>
<span id="cb211-1316"><a href="#cb211-1316" aria-hidden="true" tabindex="-1"></a><span class="in">         | Day == 4</span></span>
<span id="cb211-1317"><a href="#cb211-1317" aria-hidden="true" tabindex="-1"></a><span class="in">         | Day == 5</span></span>
<span id="cb211-1318"><a href="#cb211-1318" aria-hidden="true" tabindex="-1"></a><span class="in">         )</span></span>
<span id="cb211-1319"><a href="#cb211-1319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1320"><a href="#cb211-1320" aria-hidden="true" tabindex="-1"></a><span class="in"># Produce hourly dataset</span></span>
<span id="cb211-1321"><a href="#cb211-1321" aria-hidden="true" tabindex="-1"></a><span class="in">MS_sh_data &lt;- stack_hourly_temps(KA_weather_subset, latitude = 48.4)</span></span>
<span id="cb211-1322"><a href="#cb211-1322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1323"><a href="#cb211-1323" aria-hidden="true" tabindex="-1"></a><span class="in"># Select the hourtemps output only </span></span>
<span id="cb211-1324"><a href="#cb211-1324" aria-hidden="true" tabindex="-1"></a><span class="in">MS_sh_data &lt;- MS_sh_data[["hourtemps"]]</span></span>
<span id="cb211-1325"><a href="#cb211-1325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1326"><a href="#cb211-1326" aria-hidden="true" tabindex="-1"></a><span class="in"># Filter for day 4</span></span>
<span id="cb211-1327"><a href="#cb211-1327" aria-hidden="true" tabindex="-1"></a><span class="in">kable(MS_sh_data %&gt;% filter(Day == 4)) %&gt;%</span></span>
<span id="cb211-1328"><a href="#cb211-1328" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-1329"><a href="#cb211-1329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1330"><a href="#cb211-1330" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1331"><a href="#cb211-1331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1332"><a href="#cb211-1332" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1333"><a href="#cb211-1333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1334"><a href="#cb211-1334" aria-hidden="true" tabindex="-1"></a>***3. Produce empirical temperature curve parameters for the `Winters_hours_gaps` dataset, and use them to predict hourly values from daily temperatures (this is very similar to the example above, but please make sure you understand what’s going on)***</span>
<span id="cb211-1335"><a href="#cb211-1335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1336"><a href="#cb211-1336" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 8.2.3}</span></span>
<span id="cb211-1337"><a href="#cb211-1337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1338"><a href="#cb211-1338" aria-hidden="true" tabindex="-1"></a><span class="in"># Produce empirical daily temperature coefficients from observed hourly data</span></span>
<span id="cb211-1339"><a href="#cb211-1339" aria-hidden="true" tabindex="-1"></a><span class="in">WH_empi_temp_coeff &lt;- Empirical_daily_temperature_curve(Winters_hours_gaps)</span></span>
<span id="cb211-1340"><a href="#cb211-1340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1341"><a href="#cb211-1341" aria-hidden="true" tabindex="-1"></a><span class="in"># Fill the missing gaps in hourly data of daily records</span></span>
<span id="cb211-1342"><a href="#cb211-1342" aria-hidden="true" tabindex="-1"></a><span class="in">WH_daily &lt;- make_all_day_table(Winters_hours_gaps, input_timestep = "hour")</span></span>
<span id="cb211-1343"><a href="#cb211-1343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1344"><a href="#cb211-1344" aria-hidden="true" tabindex="-1"></a><span class="in"># Predict hourly temperatures from daily dataset using the obtained coefficients</span></span>
<span id="cb211-1345"><a href="#cb211-1345" aria-hidden="true" tabindex="-1"></a><span class="in">WH_hours &lt;- Empirical_hourly_temperatures(WH_daily, WH_empi_temp_coeff)</span></span>
<span id="cb211-1346"><a href="#cb211-1346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1347"><a href="#cb211-1347" aria-hidden="true" tabindex="-1"></a><span class="in"># Select necessary columns from WH_hours dataset</span></span>
<span id="cb211-1348"><a href="#cb211-1348" aria-hidden="true" tabindex="-1"></a><span class="in">WH_hours &lt;- WH_hours[, c("Year", "Month", "Day", "Hour", "Temp")]</span></span>
<span id="cb211-1349"><a href="#cb211-1349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1350"><a href="#cb211-1350" aria-hidden="true" tabindex="-1"></a><span class="in"># Rename the last column "Temp" to "Temp_empirical"</span></span>
<span id="cb211-1351"><a href="#cb211-1351" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(WH_hours)[ncol(WH_hours)] &lt;- "Temp_empirical"</span></span>
<span id="cb211-1352"><a href="#cb211-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1353"><a href="#cb211-1353" aria-hidden="true" tabindex="-1"></a><span class="in"># Merge predicted WH_hours with Winter_hours_gaps dataset to display</span></span>
<span id="cb211-1354"><a href="#cb211-1354" aria-hidden="true" tabindex="-1"></a><span class="in"># observed vs. approximated temperatures</span></span>
<span id="cb211-1355"><a href="#cb211-1355" aria-hidden="true" tabindex="-1"></a><span class="in">WH_temps &lt;- merge(Winters_hours_gaps,</span></span>
<span id="cb211-1356"><a href="#cb211-1356" aria-hidden="true" tabindex="-1"></a><span class="in">                  WH_hours,</span></span>
<span id="cb211-1357"><a href="#cb211-1357" aria-hidden="true" tabindex="-1"></a><span class="in">                  by = c("Year", "Month", "Day", "Hour"))</span></span>
<span id="cb211-1358"><a href="#cb211-1358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1359"><a href="#cb211-1359" aria-hidden="true" tabindex="-1"></a><span class="in"># Add a new "DATE" column with R's date format for plotting purpose</span></span>
<span id="cb211-1360"><a href="#cb211-1360" aria-hidden="true" tabindex="-1"></a><span class="in">WH_temps[, "DATE"] &lt;- ISOdate(WH_temps$Year,</span></span>
<span id="cb211-1361"><a href="#cb211-1361" aria-hidden="true" tabindex="-1"></a><span class="in">                              WH_temps$Month,</span></span>
<span id="cb211-1362"><a href="#cb211-1362" aria-hidden="true" tabindex="-1"></a><span class="in">                              WH_temps$Day,</span></span>
<span id="cb211-1363"><a href="#cb211-1363" aria-hidden="true" tabindex="-1"></a><span class="in">                              WH_temps$Hour)</span></span>
<span id="cb211-1364"><a href="#cb211-1364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1365"><a href="#cb211-1365" aria-hidden="true" tabindex="-1"></a><span class="in"># Select the necessary columns and add into a new data.frame</span></span>
<span id="cb211-1366"><a href="#cb211-1366" aria-hidden="true" tabindex="-1"></a><span class="in">WH_temps_to_plot &lt;- WH_temps[, c("DATE",</span></span>
<span id="cb211-1367"><a href="#cb211-1367" aria-hidden="true" tabindex="-1"></a><span class="in">                                 "Temp",</span></span>
<span id="cb211-1368"><a href="#cb211-1368" aria-hidden="true" tabindex="-1"></a><span class="in">                                 "Temp_empirical")]</span></span>
<span id="cb211-1369"><a href="#cb211-1369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1370"><a href="#cb211-1370" aria-hidden="true" tabindex="-1"></a><span class="in"># Specify rows 300-400 (October 20-25) to plot</span></span>
<span id="cb211-1371"><a href="#cb211-1371" aria-hidden="true" tabindex="-1"></a><span class="in">WH_temps_to_plot &lt;- WH_temps_to_plot[300:400, ]</span></span>
<span id="cb211-1372"><a href="#cb211-1372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1373"><a href="#cb211-1373" aria-hidden="true" tabindex="-1"></a><span class="in"># Stack columns into rows for plotting</span></span>
<span id="cb211-1374"><a href="#cb211-1374" aria-hidden="true" tabindex="-1"></a><span class="in">WH_temps_to_plot &lt;- pivot_longer(WH_temps_to_plot, cols = Temp:Temp_empirical)</span></span>
<span id="cb211-1375"><a href="#cb211-1375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1376"><a href="#cb211-1376" aria-hidden="true" tabindex="-1"></a><span class="in"># Rename columns for graph display </span></span>
<span id="cb211-1377"><a href="#cb211-1377" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(WH_temps_to_plot) &lt;- c("DATE", "Method", "Temperature")</span></span>
<span id="cb211-1378"><a href="#cb211-1378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1379"><a href="#cb211-1379" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate plot</span></span>
<span id="cb211-1380"><a href="#cb211-1380" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = WH_temps_to_plot, aes(DATE, Temperature, colour = Method)) +</span></span>
<span id="cb211-1381"><a href="#cb211-1381" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(lwd = 1.3) + ylab("Temperature (°C)") + xlab("Date")</span></span>
<span id="cb211-1382"><a href="#cb211-1382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1383"><a href="#cb211-1383" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1384"><a href="#cb211-1384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1385"><a href="#cb211-1385" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1386"><a href="#cb211-1386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1387"><a href="#cb211-1387" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 9: Some useful tools in R</span></span>
<span id="cb211-1388"><a href="#cb211-1388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1389"><a href="#cb211-1389" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;9.1&lt;/span&gt;&amp;nbsp; An evolving language&amp;mdash; and a lifelong learning process</span></span>
<span id="cb211-1390"><a href="#cb211-1390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1391"><a href="#cb211-1391" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1392"><a href="#cb211-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1393"><a href="#cb211-1393" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Possible to solve most problems with <span class="in">`base R`</span> functions</span>
<span id="cb211-1394"><a href="#cb211-1394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1395"><a href="#cb211-1395" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1396"><a href="#cb211-1396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1397"><a href="#cb211-1397" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;9.2&lt;/span&gt;&amp;nbsp; The `tidyverse`</span></span>
<span id="cb211-1398"><a href="#cb211-1398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1399"><a href="#cb211-1399" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1400"><a href="#cb211-1400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1401"><a href="#cb211-1401" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Access the whole collection of the <span class="in">`tidyverse`</span> package <span class="co">[</span><span class="ot">here.</span><span class="co">](https://www.tidyverse.org/)</span></span>
<span id="cb211-1402"><a href="#cb211-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1403"><a href="#cb211-1403" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Load <span class="in">`library(tidyverse)`</span> to access the package</span>
<span id="cb211-1404"><a href="#cb211-1404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1405"><a href="#cb211-1405" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1406"><a href="#cb211-1406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1407"><a href="#cb211-1407" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;9.3&lt;/span&gt;&amp;nbsp; The `ggplot2` package</span></span>
<span id="cb211-1408"><a href="#cb211-1408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1409"><a href="#cb211-1409" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1410"><a href="#cb211-1410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1411"><a href="#cb211-1411" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A great introduction to ggplot2 and links to various tutorials etc. can be accessed <span class="co">[</span><span class="ot">here.</span><span class="co">](https://ggplot2.tidyverse.org/)</span></span>
<span id="cb211-1412"><a href="#cb211-1412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1413"><a href="#cb211-1413" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1414"><a href="#cb211-1414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1415"><a href="#cb211-1415" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;9.3&lt;/span&gt;&amp;nbsp; The `tibble` package</span></span>
<span id="cb211-1416"><a href="#cb211-1416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1417"><a href="#cb211-1417" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1418"><a href="#cb211-1418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1419"><a href="#cb211-1419" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A <span class="in">`tibble`</span> is an advanced version of a <span class="in">`data.frame`</span>, which includes several improvements.</span>
<span id="cb211-1420"><a href="#cb211-1420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1421"><a href="#cb211-1421" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A <span class="in">`tibble`</span> doesn’t follow the classic <span class="in">`data.frame`</span> habit of converting strings to factors at times when you don’t expect it.</span>
<span id="cb211-1422"><a href="#cb211-1422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1423"><a href="#cb211-1423" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Read more <span class="co">[</span><span class="ot">here.</span><span class="co">](https://tibble.tidyverse.org/)</span></span>
<span id="cb211-1424"><a href="#cb211-1424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1425"><a href="#cb211-1425" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.3}</span></span>
<span id="cb211-1426"><a href="#cb211-1426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1427"><a href="#cb211-1427" aria-hidden="true" tabindex="-1"></a><span class="in"># Use as_tibble command to create a normal data.frame (or a similar structure)</span></span>
<span id="cb211-1428"><a href="#cb211-1428" aria-hidden="true" tabindex="-1"></a><span class="in">dat &lt;- data.frame(a = c(1, 2, 3),</span></span>
<span id="cb211-1429"><a href="#cb211-1429" aria-hidden="true" tabindex="-1"></a><span class="in">                  b = c(4, 5, 6))</span></span>
<span id="cb211-1430"><a href="#cb211-1430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1431"><a href="#cb211-1431" aria-hidden="true" tabindex="-1"></a><span class="in">d &lt;- as_tibble(dat)</span></span>
<span id="cb211-1432"><a href="#cb211-1432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1433"><a href="#cb211-1433" aria-hidden="true" tabindex="-1"></a><span class="in">d</span></span>
<span id="cb211-1434"><a href="#cb211-1434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1435"><a href="#cb211-1435" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1436"><a href="#cb211-1436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1437"><a href="#cb211-1437" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1438"><a href="#cb211-1438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1439"><a href="#cb211-1439" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;9.5&lt;/span&gt;&amp;nbsp; The `magrittr` package&amp;mdash; pipes</span></span>
<span id="cb211-1440"><a href="#cb211-1440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1441"><a href="#cb211-1441" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1442"><a href="#cb211-1442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1443"><a href="#cb211-1443" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The main thing <span class="in">`magrittr`</span> adds is a structure to organize workflows that are applied to the same dataset. </span>
<span id="cb211-1444"><a href="#cb211-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1445"><a href="#cb211-1445" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A data structure such as a <span class="in">`tibble`</span> can be subjected to one or multiple operations organized in a pipe<span class="dv">&amp;mdash;</span> <span class="in">`%&gt;%`</span></span>
<span id="cb211-1446"><a href="#cb211-1446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1447"><a href="#cb211-1447" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>After a pipe, the following function always assumes that the first input to the function is the product received through the pipe.</span>
<span id="cb211-1448"><a href="#cb211-1448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1449"><a href="#cb211-1449" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.5}</span></span>
<span id="cb211-1450"><a href="#cb211-1450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1451"><a href="#cb211-1451" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate the sum of all numbers in the tibble "d" created above</span></span>
<span id="cb211-1452"><a href="#cb211-1452" aria-hidden="true" tabindex="-1"></a><span class="in">d %&gt;% sum()</span></span>
<span id="cb211-1453"><a href="#cb211-1453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1454"><a href="#cb211-1454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1455"><a href="#cb211-1455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1456"><a href="#cb211-1456" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1457"><a href="#cb211-1457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1458"><a href="#cb211-1458" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;9.6&lt;/span&gt;&amp;nbsp; The `tidyr` package</span></span>
<span id="cb211-1459"><a href="#cb211-1459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1460"><a href="#cb211-1460" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1461"><a href="#cb211-1461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1462"><a href="#cb211-1462" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Provides useful functions for organizing data.</span>
<span id="cb211-1463"><a href="#cb211-1463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1464"><a href="#cb211-1464" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.6}</span></span>
<span id="cb211-1465"><a href="#cb211-1465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1466"><a href="#cb211-1466" aria-hidden="true" tabindex="-1"></a><span class="in"># Use KA_weather dataset to see how it works</span></span>
<span id="cb211-1467"><a href="#cb211-1467" aria-hidden="true" tabindex="-1"></a><span class="in">KAw &lt;- as_tibble(KA_weather[1:10, ])</span></span>
<span id="cb211-1468"><a href="#cb211-1468" aria-hidden="true" tabindex="-1"></a><span class="in">KAw</span></span>
<span id="cb211-1469"><a href="#cb211-1469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1470"><a href="#cb211-1470" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1471"><a href="#cb211-1471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1472"><a href="#cb211-1472" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1473"><a href="#cb211-1473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1474"><a href="#cb211-1474" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;9.6.1&lt;/span&gt;&amp;nbsp; `pivot_longer`</span></span>
<span id="cb211-1475"><a href="#cb211-1475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1476"><a href="#cb211-1476" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1477"><a href="#cb211-1477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1478"><a href="#cb211-1478" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use <span class="in">`pivot_longer`</span> to transfer data from separate columns into distinct rows.</span>
<span id="cb211-1479"><a href="#cb211-1479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1480"><a href="#cb211-1480" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Stack one row of a column over another row of another column<span class="dv">&amp;mdash;</span> often necessary, for instance, when using <span class="in">`ggplot2`</span> package for plotting data. </span>
<span id="cb211-1481"><a href="#cb211-1481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1482"><a href="#cb211-1482" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`pivot_longer`</span> fulfills a similar function to the <span class="in">`melt`</span> function of the <span class="in">`reshape2`</span> package</span>
<span id="cb211-1483"><a href="#cb211-1483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1484"><a href="#cb211-1484" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.6.1}</span></span>
<span id="cb211-1485"><a href="#cb211-1485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1486"><a href="#cb211-1486" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate a table with one row containing Tmin and one row for Tmax for </span></span>
<span id="cb211-1487"><a href="#cb211-1487" aria-hidden="true" tabindex="-1"></a><span class="in"># each day of the record (with a pipe)</span></span>
<span id="cb211-1488"><a href="#cb211-1488" aria-hidden="true" tabindex="-1"></a><span class="in">KAwlong &lt;- KAw %&gt;% pivot_longer(cols = Tmax:Tmin) # specify column we want to stack up </span></span>
<span id="cb211-1489"><a href="#cb211-1489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1490"><a href="#cb211-1490" aria-hidden="true" tabindex="-1"></a><span class="in">KAwlong</span></span>
<span id="cb211-1491"><a href="#cb211-1491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1492"><a href="#cb211-1492" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1493"><a href="#cb211-1493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1494"><a href="#cb211-1494" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1495"><a href="#cb211-1495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1496"><a href="#cb211-1496" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;9.6.2&lt;/span&gt;&amp;nbsp; `pivot_wider`</span></span>
<span id="cb211-1497"><a href="#cb211-1497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1498"><a href="#cb211-1498" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1499"><a href="#cb211-1499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1500"><a href="#cb211-1500" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We can also do an opposite conversion to the one implemented by <span class="in">`pivot_longer`</span> by using the <span class="in">`pivot_wider`</span> command.</span>
<span id="cb211-1501"><a href="#cb211-1501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1502"><a href="#cb211-1502" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.6.2}</span></span>
<span id="cb211-1503"><a href="#cb211-1503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1504"><a href="#cb211-1504" aria-hidden="true" tabindex="-1"></a><span class="in">KAwwide &lt;- KAwlong %&gt;% pivot_wider(names_from = name) #can work without () `here`</span></span>
<span id="cb211-1505"><a href="#cb211-1505" aria-hidden="true" tabindex="-1"></a><span class="in"># name_from specifies the column that contains new column header</span></span>
<span id="cb211-1506"><a href="#cb211-1506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1507"><a href="#cb211-1507" aria-hidden="true" tabindex="-1"></a><span class="in">KAwwide</span></span>
<span id="cb211-1508"><a href="#cb211-1508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1509"><a href="#cb211-1509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1510"><a href="#cb211-1510" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1511"><a href="#cb211-1511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1512"><a href="#cb211-1512" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1513"><a href="#cb211-1513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1514"><a href="#cb211-1514" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;9.6.3&lt;/span&gt;&amp;nbsp; `select`</span></span>
<span id="cb211-1515"><a href="#cb211-1515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1516"><a href="#cb211-1516" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1517"><a href="#cb211-1517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1518"><a href="#cb211-1518" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`select`</span> function picks out a subset of the columns of a <span class="in">`data.frame`</span> or <span class="in">`tibble`</span>. </span>
<span id="cb211-1519"><a href="#cb211-1519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1520"><a href="#cb211-1520" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.6.3}</span></span>
<span id="cb211-1521"><a href="#cb211-1521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1522"><a href="#cb211-1522" aria-hidden="true" tabindex="-1"></a><span class="in">KAw %&gt;% select(c(Month, Day, Tmax))</span></span>
<span id="cb211-1523"><a href="#cb211-1523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1524"><a href="#cb211-1524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1525"><a href="#cb211-1525" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1526"><a href="#cb211-1526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1527"><a href="#cb211-1527" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1528"><a href="#cb211-1528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1529"><a href="#cb211-1529" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;9.6.4&lt;/span&gt;&amp;nbsp; `filter`</span></span>
<span id="cb211-1530"><a href="#cb211-1530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1531"><a href="#cb211-1531" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1532"><a href="#cb211-1532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1533"><a href="#cb211-1533" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The <span class="in">`filter`</span> function reduces a <span class="in">`data.frame`</span> or <span class="in">`tibble`</span> to just the rows that fulfill certain conditions. </span>
<span id="cb211-1534"><a href="#cb211-1534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1535"><a href="#cb211-1535" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.6.4}</span></span>
<span id="cb211-1536"><a href="#cb211-1536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1537"><a href="#cb211-1537" aria-hidden="true" tabindex="-1"></a><span class="in">KAw %&gt;% filter(Tmax &gt; 10)</span></span>
<span id="cb211-1538"><a href="#cb211-1538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1539"><a href="#cb211-1539" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1540"><a href="#cb211-1540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1541"><a href="#cb211-1541" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1542"><a href="#cb211-1542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1543"><a href="#cb211-1543" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;9.6.5&lt;/span&gt;&amp;nbsp; `mutate`</span></span>
<span id="cb211-1544"><a href="#cb211-1544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1545"><a href="#cb211-1545" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1546"><a href="#cb211-1546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1547"><a href="#cb211-1547" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The <span class="in">`mutate`</span> function creates, modifies, and deletes columns from a <span class="in">`data.frame`</span> or <span class="in">`tibble`</span>. </span>
<span id="cb211-1548"><a href="#cb211-1548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1549"><a href="#cb211-1549" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Check out <span class="co">[</span><span class="ot">help file</span><span class="co">](https://dplyr.tidyverse.org/reference/mutate.html)</span> for more options that can be done with <span class="in">`mutate`</span>. </span>
<span id="cb211-1550"><a href="#cb211-1550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1551"><a href="#cb211-1551" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.6.5}</span></span>
<span id="cb211-1552"><a href="#cb211-1552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1553"><a href="#cb211-1553" aria-hidden="true" tabindex="-1"></a><span class="in"># Create two new columns that contain Tmin and Tmax in Kelvin </span></span>
<span id="cb211-1554"><a href="#cb211-1554" aria-hidden="true" tabindex="-1"></a><span class="in">KAw_K &lt;- KAw %&gt;% mutate(Tmax_K = Tmax + 273.5, Tmin_K = Tmin + 273.15)</span></span>
<span id="cb211-1555"><a href="#cb211-1555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1556"><a href="#cb211-1556" aria-hidden="true" tabindex="-1"></a><span class="in">KAw_K</span></span>
<span id="cb211-1557"><a href="#cb211-1557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1558"><a href="#cb211-1558" aria-hidden="true" tabindex="-1"></a><span class="in"># Delete these columns again, by setting them to NULL</span></span>
<span id="cb211-1559"><a href="#cb211-1559" aria-hidden="true" tabindex="-1"></a><span class="in">KAw_K %&gt;% mutate(Tmin_K = NULL, Tmax_K = NULL)</span></span>
<span id="cb211-1560"><a href="#cb211-1560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1561"><a href="#cb211-1561" aria-hidden="true" tabindex="-1"></a><span class="in"># Replace the original temperature values directly with the Kelvin values.</span></span>
<span id="cb211-1562"><a href="#cb211-1562" aria-hidden="true" tabindex="-1"></a><span class="in">KAw %&gt;% mutate(Tmin = Tmin + 273.15, Tmax = Tmax + 273.15)</span></span>
<span id="cb211-1563"><a href="#cb211-1563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1564"><a href="#cb211-1564" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1565"><a href="#cb211-1565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1566"><a href="#cb211-1566" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1567"><a href="#cb211-1567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1568"><a href="#cb211-1568" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;9.6.6&lt;/span&gt;&amp;nbsp; `arrange`</span></span>
<span id="cb211-1569"><a href="#cb211-1569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1570"><a href="#cb211-1570" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1571"><a href="#cb211-1571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1572"><a href="#cb211-1572" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`arrange`</span> is a function to sort data in <span class="in">`data.frames`</span> or <span class="in">`tibbles`</span>. </span>
<span id="cb211-1573"><a href="#cb211-1573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1574"><a href="#cb211-1574" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.6.6}</span></span>
<span id="cb211-1575"><a href="#cb211-1575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1576"><a href="#cb211-1576" aria-hidden="true" tabindex="-1"></a><span class="in">KAw %&gt;% arrange(Tmax, Tmin)</span></span>
<span id="cb211-1577"><a href="#cb211-1577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1578"><a href="#cb211-1578" aria-hidden="true" tabindex="-1"></a><span class="in"># Sort in descending order</span></span>
<span id="cb211-1579"><a href="#cb211-1579" aria-hidden="true" tabindex="-1"></a><span class="in">KAw %&gt;% arrange(desc(Tmax), Tmin)</span></span>
<span id="cb211-1580"><a href="#cb211-1580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1581"><a href="#cb211-1581" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1582"><a href="#cb211-1582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1583"><a href="#cb211-1583" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1584"><a href="#cb211-1584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1585"><a href="#cb211-1585" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;9.7&lt;/span&gt;&amp;nbsp; Loops</span></span>
<span id="cb211-1586"><a href="#cb211-1586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1587"><a href="#cb211-1587" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1588"><a href="#cb211-1588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1589"><a href="#cb211-1589" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A loop repeats the same operation many times without having to explicitly retype (or copy and paste) the code. </span>
<span id="cb211-1590"><a href="#cb211-1590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1591"><a href="#cb211-1591" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>More importantly, it also runs the same code while introducing certain modifications in every run.</span>
<span id="cb211-1592"><a href="#cb211-1592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1593"><a href="#cb211-1593" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Two basic types of loops: <span class="in">`for`</span> loops and <span class="in">`while`</span> loops<span class="dv">&amp;mdash;</span> both functions need instructions that regulate the number of runs, as well as instructions on what to do in each of the runs.</span>
<span id="cb211-1594"><a href="#cb211-1594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1595"><a href="#cb211-1595" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Read detailed explanations on loops <span class="co">[</span><span class="ot">here.</span><span class="co">](https://intro2r.com/loops.html)</span></span>
<span id="cb211-1596"><a href="#cb211-1596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1597"><a href="#cb211-1597" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1598"><a href="#cb211-1598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1599"><a href="#cb211-1599" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;9.7.1&lt;/span&gt;&amp;nbsp; `for` loops</span></span>
<span id="cb211-1600"><a href="#cb211-1600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1601"><a href="#cb211-1601" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1602"><a href="#cb211-1602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1603"><a href="#cb211-1603" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A <span class="in">`for`</span> loop requires explicit instructions on how many times the code within the loop should be run. </span>
<span id="cb211-1604"><a href="#cb211-1604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1605"><a href="#cb211-1605" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This is usually specified by providing a vector or list of elements and instructing R to run the code for each of these elements. </span>
<span id="cb211-1606"><a href="#cb211-1606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1607"><a href="#cb211-1607" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This means that the number of times the code is run equals the number of elements in the vector or list.</span>
<span id="cb211-1608"><a href="#cb211-1608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1609"><a href="#cb211-1609" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We need a *counter* (often called <span class="in">`i`</span> but can also be any other variable name) to keep track of which run we’re in.</span>
<span id="cb211-1610"><a href="#cb211-1610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1611"><a href="#cb211-1611" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The *counter* doesn’t have to be numeric, but it can assume many other shapes, e.g. that of a string. </span>
<span id="cb211-1612"><a href="#cb211-1612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1613"><a href="#cb211-1613" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.7.1}</span></span>
<span id="cb211-1614"><a href="#cb211-1614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1615"><a href="#cb211-1615" aria-hidden="true" tabindex="-1"></a><span class="in"># Run the code three times with for command</span></span>
<span id="cb211-1616"><a href="#cb211-1616" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:3) print("Hello")</span></span>
<span id="cb211-1617"><a href="#cb211-1617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1618"><a href="#cb211-1618" aria-hidden="true" tabindex="-1"></a><span class="in"># Make the structure more complex by providing multiple lines of code within</span></span>
<span id="cb211-1619"><a href="#cb211-1619" aria-hidden="true" tabindex="-1"></a><span class="in"># winged brackets</span></span>
<span id="cb211-1620"><a href="#cb211-1620" aria-hidden="true" tabindex="-1"></a><span class="in">addition &lt;- 1</span></span>
<span id="cb211-1621"><a href="#cb211-1621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1622"><a href="#cb211-1622" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:3) # operation is embedded in a loop</span></span>
<span id="cb211-1623"><a href="#cb211-1623" aria-hidden="true" tabindex="-1"></a><span class="in">{ </span></span>
<span id="cb211-1624"><a href="#cb211-1624" aria-hidden="true" tabindex="-1"></a><span class="in">  addition &lt;- addition + 1</span></span>
<span id="cb211-1625"><a href="#cb211-1625" aria-hidden="true" tabindex="-1"></a><span class="in">  print(addition) # need to instruct R to print value</span></span>
<span id="cb211-1626"><a href="#cb211-1626" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb211-1627"><a href="#cb211-1627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1628"><a href="#cb211-1628" aria-hidden="true" tabindex="-1"></a><span class="in"># Use i in more creative ways</span></span>
<span id="cb211-1629"><a href="#cb211-1629" aria-hidden="true" tabindex="-1"></a><span class="in">names &lt;- c("Paul", "Mary", "John")</span></span>
<span id="cb211-1630"><a href="#cb211-1630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1631"><a href="#cb211-1631" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:3)</span></span>
<span id="cb211-1632"><a href="#cb211-1632" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb211-1633"><a href="#cb211-1633" aria-hidden="true" tabindex="-1"></a><span class="in">  print(paste("Hello", names[i]))</span></span>
<span id="cb211-1634"><a href="#cb211-1634" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb211-1635"><a href="#cb211-1635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1636"><a href="#cb211-1636" aria-hidden="true" tabindex="-1"></a><span class="in"># Non-numerical counter</span></span>
<span id="cb211-1637"><a href="#cb211-1637" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in c("Paul", "Mary", "John"))</span></span>
<span id="cb211-1638"><a href="#cb211-1638" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb211-1639"><a href="#cb211-1639" aria-hidden="true" tabindex="-1"></a><span class="in">  print(paste("Hello", i))</span></span>
<span id="cb211-1640"><a href="#cb211-1640" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb211-1641"><a href="#cb211-1641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1642"><a href="#cb211-1642" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1643"><a href="#cb211-1643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1644"><a href="#cb211-1644" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1645"><a href="#cb211-1645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1646"><a href="#cb211-1646" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;9.7.2&lt;/span&gt;&amp;nbsp; `while` loops</span></span>
<span id="cb211-1647"><a href="#cb211-1647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1648"><a href="#cb211-1648" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1649"><a href="#cb211-1649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1650"><a href="#cb211-1650" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A loop with a <span class="in">`while`</span> statement will run, until the specified condition is no longer fulfilled.</span>
<span id="cb211-1651"><a href="#cb211-1651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1652"><a href="#cb211-1652" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This only makes sense, of course, if the condition can change as a result of what happens inside the loop.</span>
<span id="cb211-1653"><a href="#cb211-1653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1654"><a href="#cb211-1654" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Note that <span class="in">`while`</span> loops can easily cause problems if the condition remains fulfilled regardless of what happens in the code block. Your code will then get hung up and needs to be cancelled manually.</span>
<span id="cb211-1655"><a href="#cb211-1655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1656"><a href="#cb211-1656" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.7.2}</span></span>
<span id="cb211-1657"><a href="#cb211-1657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1658"><a href="#cb211-1658" aria-hidden="true" tabindex="-1"></a><span class="in"># Run the `while` loop till the condition is met--</span></span>
<span id="cb211-1659"><a href="#cb211-1659" aria-hidden="true" tabindex="-1"></a><span class="in"># stop running when cond reaches 0 (no longer fulfilled)</span></span>
<span id="cb211-1660"><a href="#cb211-1660" aria-hidden="true" tabindex="-1"></a><span class="in">cond &lt;- 5</span></span>
<span id="cb211-1661"><a href="#cb211-1661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1662"><a href="#cb211-1662" aria-hidden="true" tabindex="-1"></a><span class="in">while (cond &gt; 0) </span></span>
<span id="cb211-1663"><a href="#cb211-1663" aria-hidden="true" tabindex="-1"></a><span class="in">  {</span></span>
<span id="cb211-1664"><a href="#cb211-1664" aria-hidden="true" tabindex="-1"></a><span class="in">    print(cond)</span></span>
<span id="cb211-1665"><a href="#cb211-1665" aria-hidden="true" tabindex="-1"></a><span class="in">  cond &lt;- cond - 1</span></span>
<span id="cb211-1666"><a href="#cb211-1666" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb211-1667"><a href="#cb211-1667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1668"><a href="#cb211-1668" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1669"><a href="#cb211-1669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1670"><a href="#cb211-1670" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1671"><a href="#cb211-1671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1672"><a href="#cb211-1672" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;9.8&lt;/span&gt;&amp;nbsp; `apply` functions</span></span>
<span id="cb211-1673"><a href="#cb211-1673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1674"><a href="#cb211-1674" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1675"><a href="#cb211-1675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1676"><a href="#cb211-1676" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The functions from the <span class="in">`apply`</span> family<span class="dv">&amp;mdash;</span> <span class="in">`apply`</span>, <span class="in">`lapply`</span> and <span class="in">`sapply`</span><span class="dv">&amp;mdash;</span> are often a much faster way to apply certain operations to multiple elements at the same time. </span>
<span id="cb211-1677"><a href="#cb211-1677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1678"><a href="#cb211-1678" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The two central arguments that need to be provided to these functions are the list of items to apply the operation to, and the operation itself.</span>
<span id="cb211-1679"><a href="#cb211-1679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1680"><a href="#cb211-1680" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1681"><a href="#cb211-1681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1682"><a href="#cb211-1682" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;9.8.1&lt;/span&gt;&amp;nbsp; `sapply` </span></span>
<span id="cb211-1683"><a href="#cb211-1683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1684"><a href="#cb211-1684" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1685"><a href="#cb211-1685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1686"><a href="#cb211-1686" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The easiest function to apply an operation to a vector of elements is <span class="in">`sapply`</span>. </span>
<span id="cb211-1687"><a href="#cb211-1687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1688"><a href="#cb211-1688" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It only needs two arguments: the vector (<span class="in">`X`</span>), and the function to be applied (<span class="in">`FUN`</span>). </span>
<span id="cb211-1689"><a href="#cb211-1689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1690"><a href="#cb211-1690" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.8.1}</span></span>
<span id="cb211-1691"><a href="#cb211-1691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1692"><a href="#cb211-1692" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a simple function `func` which just adds 1 to an object</span></span>
<span id="cb211-1693"><a href="#cb211-1693" aria-hidden="true" tabindex="-1"></a><span class="in">func &lt;- function(x)</span></span>
<span id="cb211-1694"><a href="#cb211-1694" aria-hidden="true" tabindex="-1"></a><span class="in">  x + 1</span></span>
<span id="cb211-1695"><a href="#cb211-1695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1696"><a href="#cb211-1696" aria-hidden="true" tabindex="-1"></a><span class="in">sapply(1:5, func)</span></span>
<span id="cb211-1697"><a href="#cb211-1697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1698"><a href="#cb211-1698" aria-hidden="true" tabindex="-1"></a><span class="in"># If we apply this function to a list of numbers, the output is a matrix </span></span>
<span id="cb211-1699"><a href="#cb211-1699" aria-hidden="true" tabindex="-1"></a><span class="in"># (but the values are the same).</span></span>
<span id="cb211-1700"><a href="#cb211-1700" aria-hidden="true" tabindex="-1"></a><span class="in">sapply(list(1:5), func)</span></span>
<span id="cb211-1701"><a href="#cb211-1701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1702"><a href="#cb211-1702" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1703"><a href="#cb211-1703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1704"><a href="#cb211-1704" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1705"><a href="#cb211-1705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1706"><a href="#cb211-1706" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;9.8.2&lt;/span&gt;&amp;nbsp; `lapply` </span></span>
<span id="cb211-1707"><a href="#cb211-1707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1708"><a href="#cb211-1708" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1709"><a href="#cb211-1709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1710"><a href="#cb211-1710" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`lapply`</span> function produces output as a list.</span>
<span id="cb211-1711"><a href="#cb211-1711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1712"><a href="#cb211-1712" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It interprets the input element <span class="in">`X`</span> as a list and returns a list with as many elements as were provided in that list, with each one containing the output of applying <span class="in">`FUN`</span> to the respective element.</span>
<span id="cb211-1713"><a href="#cb211-1713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1714"><a href="#cb211-1714" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.8.2}</span></span>
<span id="cb211-1715"><a href="#cb211-1715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1716"><a href="#cb211-1716" aria-hidden="true" tabindex="-1"></a><span class="in">lapply(1:5, func)</span></span>
<span id="cb211-1717"><a href="#cb211-1717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1718"><a href="#cb211-1718" aria-hidden="true" tabindex="-1"></a><span class="in"># Note that if the input element X is itself a list, this list is treated as </span></span>
<span id="cb211-1719"><a href="#cb211-1719" aria-hidden="true" tabindex="-1"></a><span class="in"># one input element, with FUN applied to the entire list and the result returned</span></span>
<span id="cb211-1720"><a href="#cb211-1720" aria-hidden="true" tabindex="-1"></a><span class="in"># as a single list element.</span></span>
<span id="cb211-1721"><a href="#cb211-1721" aria-hidden="true" tabindex="-1"></a><span class="in">lapply(list(1:5), func) # example to understand how it works</span></span>
<span id="cb211-1722"><a href="#cb211-1722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1723"><a href="#cb211-1723" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1724"><a href="#cb211-1724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1725"><a href="#cb211-1725" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1726"><a href="#cb211-1726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1727"><a href="#cb211-1727" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;9.8.3&lt;/span&gt;&amp;nbsp; `apply` </span></span>
<span id="cb211-1728"><a href="#cb211-1728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1729"><a href="#cb211-1729" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1730"><a href="#cb211-1730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1731"><a href="#cb211-1731" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The basic <span class="in">`apply`</span> function is for applying functions to arrays, where we can operate either on the rows (<span class="in">`MARGIN = 1`</span>) or on the columns (<span class="in">`MARGIN = 1`</span>) of the array. *(Not use much)*</span>
<span id="cb211-1732"><a href="#cb211-1732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1733"><a href="#cb211-1733" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.8.3}</span></span>
<span id="cb211-1734"><a href="#cb211-1734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1735"><a href="#cb211-1735" aria-hidden="true" tabindex="-1"></a><span class="in">mat &lt;- matrix(c(1, 1, 1, 2, 2, 2, 3, 3, 3), c(3, 3))</span></span>
<span id="cb211-1736"><a href="#cb211-1736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1737"><a href="#cb211-1737" aria-hidden="true" tabindex="-1"></a><span class="in">mat</span></span>
<span id="cb211-1738"><a href="#cb211-1738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1739"><a href="#cb211-1739" aria-hidden="true" tabindex="-1"></a><span class="in">apply(mat, MARGIN = 1, sum) # adding up all the data in each row</span></span>
<span id="cb211-1740"><a href="#cb211-1740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1741"><a href="#cb211-1741" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1742"><a href="#cb211-1742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1743"><a href="#cb211-1743" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1744"><a href="#cb211-1744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1745"><a href="#cb211-1745" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;9.9&lt;/span&gt;&amp;nbsp; Exercise on useful R tools</span></span>
<span id="cb211-1746"><a href="#cb211-1746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1747"><a href="#cb211-1747" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1748"><a href="#cb211-1748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1749"><a href="#cb211-1749" aria-hidden="true" tabindex="-1"></a>***1. Based on the `Winters_hours_gaps` dataset, use `magrittr` pipes and functions of the `tidyverse` to accomplish the following:***</span>
<span id="cb211-1750"><a href="#cb211-1750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1751"><a href="#cb211-1751" aria-hidden="true" tabindex="-1"></a>**a. Convert the dataset into a `tibble`.**</span>
<span id="cb211-1752"><a href="#cb211-1752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1753"><a href="#cb211-1753" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.9.1a}</span></span>
<span id="cb211-1754"><a href="#cb211-1754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1755"><a href="#cb211-1755" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_tibble &lt;- as_tibble(Winters_hours_gaps)</span></span>
<span id="cb211-1756"><a href="#cb211-1756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1757"><a href="#cb211-1757" aria-hidden="true" tabindex="-1"></a><span class="in">print(WHG_tibble[1:5, ])</span></span>
<span id="cb211-1758"><a href="#cb211-1758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1759"><a href="#cb211-1759" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1760"><a href="#cb211-1760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1761"><a href="#cb211-1761" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1762"><a href="#cb211-1762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1763"><a href="#cb211-1763" aria-hidden="true" tabindex="-1"></a>**b. Select only the top 10 rows of the dataset**</span>
<span id="cb211-1764"><a href="#cb211-1764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1765"><a href="#cb211-1765" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.9.1b}</span></span>
<span id="cb211-1766"><a href="#cb211-1766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1767"><a href="#cb211-1767" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_data &lt;- as_tibble(Winters_hours_gaps[1:10, ])</span></span>
<span id="cb211-1768"><a href="#cb211-1768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1769"><a href="#cb211-1769" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_data</span></span>
<span id="cb211-1770"><a href="#cb211-1770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1771"><a href="#cb211-1771" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1772"><a href="#cb211-1772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1773"><a href="#cb211-1773" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1774"><a href="#cb211-1774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1775"><a href="#cb211-1775" aria-hidden="true" tabindex="-1"></a>**c. Convert the `tibble` to a `long` format, with separate rows for `Temp_gaps` and `Temp`**</span>
<span id="cb211-1776"><a href="#cb211-1776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1777"><a href="#cb211-1777" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.9.1c}</span></span>
<span id="cb211-1778"><a href="#cb211-1778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1779"><a href="#cb211-1779" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_data_long &lt;- WHG_tibble %&gt;% pivot_longer(cols = Temp_gaps:Temp)</span></span>
<span id="cb211-1780"><a href="#cb211-1780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1781"><a href="#cb211-1781" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_data_long[1:20, ]</span></span>
<span id="cb211-1782"><a href="#cb211-1782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1783"><a href="#cb211-1783" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1784"><a href="#cb211-1784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1785"><a href="#cb211-1785" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1786"><a href="#cb211-1786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1787"><a href="#cb211-1787" aria-hidden="true" tabindex="-1"></a>**d. Use `ggplot2` to plot `Temp_gaps` and `Temp` as facets (point or line plot)**</span>
<span id="cb211-1788"><a href="#cb211-1788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1789"><a href="#cb211-1789" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.9.1d}</span></span>
<span id="cb211-1790"><a href="#cb211-1790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1791"><a href="#cb211-1791" aria-hidden="true" tabindex="-1"></a><span class="in">## Point plot</span></span>
<span id="cb211-1792"><a href="#cb211-1792" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(WHG_data_long[1:28, ], aes(Hour, value, colour = name)) +</span></span>
<span id="cb211-1793"><a href="#cb211-1793" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_point() +</span></span>
<span id="cb211-1794"><a href="#cb211-1794" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(cols = vars(name)) +</span></span>
<span id="cb211-1795"><a href="#cb211-1795" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Hour (JDay 63)") +</span></span>
<span id="cb211-1796"><a href="#cb211-1796" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Temperature (°C)") +</span></span>
<span id="cb211-1797"><a href="#cb211-1797" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 20) +</span></span>
<span id="cb211-1798"><a href="#cb211-1798" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(colour = NULL) +</span></span>
<span id="cb211-1799"><a href="#cb211-1799" aria-hidden="true" tabindex="-1"></a><span class="in">  ggtitle("Point plot")</span></span>
<span id="cb211-1800"><a href="#cb211-1800" aria-hidden="true" tabindex="-1"></a><span class="in"># The first 28 rows is for JDay 63 and there is no missing data in Temp_gaps</span></span>
<span id="cb211-1801"><a href="#cb211-1801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1802"><a href="#cb211-1802" aria-hidden="true" tabindex="-1"></a><span class="in">## Line plot</span></span>
<span id="cb211-1803"><a href="#cb211-1803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1804"><a href="#cb211-1804" aria-hidden="true" tabindex="-1"></a><span class="in"># So, for the line plot I will choose the JDay with gaps in temperature</span></span>
<span id="cb211-1805"><a href="#cb211-1805" aria-hidden="true" tabindex="-1"></a><span class="in"># After checking the dataset, I found JDay 78 has some missing Temp_gaps values</span></span>
<span id="cb211-1806"><a href="#cb211-1806" aria-hidden="true" tabindex="-1"></a><span class="in"># JDay 78 (18 MAR 2008) is rows 701:748</span></span>
<span id="cb211-1807"><a href="#cb211-1807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1808"><a href="#cb211-1808" aria-hidden="true" tabindex="-1"></a><span class="in"># Line plot of Temp and Temp_gaps for JDay 78</span></span>
<span id="cb211-1809"><a href="#cb211-1809" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(WHG_data_long[701:748, ], aes(Hour, value, colour = name)) +</span></span>
<span id="cb211-1810"><a href="#cb211-1810" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_line(lwd = 1.5) +</span></span>
<span id="cb211-1811"><a href="#cb211-1811" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid(cols = vars(name)) +</span></span>
<span id="cb211-1812"><a href="#cb211-1812" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Hour (JDay 78)") +</span></span>
<span id="cb211-1813"><a href="#cb211-1813" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Temperature (°C)") +</span></span>
<span id="cb211-1814"><a href="#cb211-1814" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_bw(base_size = 20) +</span></span>
<span id="cb211-1815"><a href="#cb211-1815" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(colour = NULL) +</span></span>
<span id="cb211-1816"><a href="#cb211-1816" aria-hidden="true" tabindex="-1"></a><span class="in">  ggtitle("Line plot")</span></span>
<span id="cb211-1817"><a href="#cb211-1817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1818"><a href="#cb211-1818" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1819"><a href="#cb211-1819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1820"><a href="#cb211-1820" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1821"><a href="#cb211-1821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1822"><a href="#cb211-1822" aria-hidden="true" tabindex="-1"></a>**e. Convert the dataset back to the `wide` format**</span>
<span id="cb211-1823"><a href="#cb211-1823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1824"><a href="#cb211-1824" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.9.1e}</span></span>
<span id="cb211-1825"><a href="#cb211-1825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1826"><a href="#cb211-1826" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_data_wide &lt;- WHG_data_long %&gt;% pivot_wider()</span></span>
<span id="cb211-1827"><a href="#cb211-1827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1828"><a href="#cb211-1828" aria-hidden="true" tabindex="-1"></a><span class="in"># Display for JDay 78</span></span>
<span id="cb211-1829"><a href="#cb211-1829" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_data_wide[351:374, ]</span></span>
<span id="cb211-1830"><a href="#cb211-1830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1831"><a href="#cb211-1831" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1832"><a href="#cb211-1832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1833"><a href="#cb211-1833" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1834"><a href="#cb211-1834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1835"><a href="#cb211-1835" aria-hidden="true" tabindex="-1"></a>**f. Select only the following columns: `Year`, `Month`, `Day` and `Temp`**</span>
<span id="cb211-1836"><a href="#cb211-1836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1837"><a href="#cb211-1837" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.9.1f}</span></span>
<span id="cb211-1838"><a href="#cb211-1838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1839"><a href="#cb211-1839" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_data_wide[351:374, ] %&gt;% select(c(Year, Month, Day, Temp))</span></span>
<span id="cb211-1840"><a href="#cb211-1840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1841"><a href="#cb211-1841" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1842"><a href="#cb211-1842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1843"><a href="#cb211-1843" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1844"><a href="#cb211-1844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1845"><a href="#cb211-1845" aria-hidden="true" tabindex="-1"></a>**g. Sort the dataset by the `Temp` column, in descending order**</span>
<span id="cb211-1846"><a href="#cb211-1846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1847"><a href="#cb211-1847" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.9.1g}</span></span>
<span id="cb211-1848"><a href="#cb211-1848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1849"><a href="#cb211-1849" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_data_wide[351:374, ] %&gt;% arrange(desc(Temp))</span></span>
<span id="cb211-1850"><a href="#cb211-1850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1851"><a href="#cb211-1851" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1852"><a href="#cb211-1852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1853"><a href="#cb211-1853" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1854"><a href="#cb211-1854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1855"><a href="#cb211-1855" aria-hidden="true" tabindex="-1"></a>***2. For the `Winter_hours_gaps` dataset, write a `for` loop to convert all temperatures (Temp column) to degrees Fahrenheit***</span>
<span id="cb211-1856"><a href="#cb211-1856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1857"><a href="#cb211-1857" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.9.2}</span></span>
<span id="cb211-1858"><a href="#cb211-1858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1859"><a href="#cb211-1859" aria-hidden="true" tabindex="-1"></a><span class="in"># I want this output to match the output from 1.g</span></span>
<span id="cb211-1860"><a href="#cb211-1860" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_JDay78 &lt;- WHG_data_wide[351:374, ] %&gt;% arrange(desc(Temp))</span></span>
<span id="cb211-1861"><a href="#cb211-1861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1862"><a href="#cb211-1862" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in seq_len(nrow(WHG_JDay78))) </span></span>
<span id="cb211-1863"><a href="#cb211-1863" aria-hidden="true" tabindex="-1"></a><span class="in">{</span></span>
<span id="cb211-1864"><a href="#cb211-1864" aria-hidden="true" tabindex="-1"></a><span class="in">  WHG_JDay78$Temp[i] &lt;- WHG_JDay78$Temp[i] * 1.8 + 32</span></span>
<span id="cb211-1865"><a href="#cb211-1865" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb211-1866"><a href="#cb211-1866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1867"><a href="#cb211-1867" aria-hidden="true" tabindex="-1"></a><span class="in">print(WHG_JDay78)</span></span>
<span id="cb211-1868"><a href="#cb211-1868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1869"><a href="#cb211-1869" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1870"><a href="#cb211-1870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1871"><a href="#cb211-1871" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1872"><a href="#cb211-1872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1873"><a href="#cb211-1873" aria-hidden="true" tabindex="-1"></a>***3. Execute the same operation with a function from the `apply` family***</span>
<span id="cb211-1874"><a href="#cb211-1874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1875"><a href="#cb211-1875" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.9.3}</span></span>
<span id="cb211-1876"><a href="#cb211-1876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1877"><a href="#cb211-1877" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_JDay78_function &lt;- function(x)</span></span>
<span id="cb211-1878"><a href="#cb211-1878" aria-hidden="true" tabindex="-1"></a><span class="in"> x * 1.8 + 32</span></span>
<span id="cb211-1879"><a href="#cb211-1879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1880"><a href="#cb211-1880" aria-hidden="true" tabindex="-1"></a><span class="in"># Apply function to Temp column only</span></span>
<span id="cb211-1881"><a href="#cb211-1881" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_data_wide$Temp &lt;- sapply(WHG_data_wide$Temp, WHG_JDay78_function)</span></span>
<span id="cb211-1882"><a href="#cb211-1882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1883"><a href="#cb211-1883" aria-hidden="true" tabindex="-1"></a><span class="in"># Print in descending order</span></span>
<span id="cb211-1884"><a href="#cb211-1884" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_data_wide[351:374, ] %&gt;% arrange(desc(Temp))</span></span>
<span id="cb211-1885"><a href="#cb211-1885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1886"><a href="#cb211-1886" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1887"><a href="#cb211-1887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1888"><a href="#cb211-1888" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1889"><a href="#cb211-1889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1890"><a href="#cb211-1890" aria-hidden="true" tabindex="-1"></a>***4. Now use the `tidyverse` function `mutate` to achieve the same outcome***</span>
<span id="cb211-1891"><a href="#cb211-1891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1892"><a href="#cb211-1892" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 9.9.4}</span></span>
<span id="cb211-1893"><a href="#cb211-1893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1894"><a href="#cb211-1894" aria-hidden="true" tabindex="-1"></a><span class="in"># Call the WHG_data_wide again to run the original values</span></span>
<span id="cb211-1895"><a href="#cb211-1895" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_data_wide &lt;- WHG_data_long %&gt;% pivot_wider()</span></span>
<span id="cb211-1896"><a href="#cb211-1896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1897"><a href="#cb211-1897" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_mutate &lt;- WHG_data_wide[351:374, ] %&gt;% </span></span>
<span id="cb211-1898"><a href="#cb211-1898" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Temp_C = Temp, Temp_F = Temp * 1.8 + 32, Temp = NULL)</span></span>
<span id="cb211-1899"><a href="#cb211-1899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1900"><a href="#cb211-1900" aria-hidden="true" tabindex="-1"></a><span class="in">WHG_mutate &lt;- WHG_mutate %&gt;% </span></span>
<span id="cb211-1901"><a href="#cb211-1901" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(desc(Temp_F))</span></span>
<span id="cb211-1902"><a href="#cb211-1902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1903"><a href="#cb211-1903" aria-hidden="true" tabindex="-1"></a><span class="in">print(WHG_mutate)</span></span>
<span id="cb211-1904"><a href="#cb211-1904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1905"><a href="#cb211-1905" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1906"><a href="#cb211-1906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1907"><a href="#cb211-1907" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1908"><a href="#cb211-1908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1909"><a href="#cb211-1909" aria-hidden="true" tabindex="-1"></a>***5. Voluntary: consider taking a look at the instruction materials on all these functions, which I linked above, as well as at other sources on the internet. There’s a lot more to discover here, with lots of potential for making your coding more elegant and easier - and possibly even more fun!***</span>
<span id="cb211-1910"><a href="#cb211-1910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1911"><a href="#cb211-1911" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1912"><a href="#cb211-1912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1913"><a href="#cb211-1913" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 10: Getting temperature data</span></span>
<span id="cb211-1914"><a href="#cb211-1914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1915"><a href="#cb211-1915" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;10.1&lt;/span&gt;&amp;nbsp; Temperature data needs</span></span>
<span id="cb211-1916"><a href="#cb211-1916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1917"><a href="#cb211-1917" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1918"><a href="#cb211-1918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1919"><a href="#cb211-1919" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It is preferable to have a high-quality dataset collected in the exact place that you want to analyze.</span>
<span id="cb211-1920"><a href="#cb211-1920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1921"><a href="#cb211-1921" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If we don’t have such data, however, there are a few databases out there that we can draw on as an alternative option<span class="dv">&amp;mdash;</span> <span class="in">`chillR`</span> has access to one global database and one for California.</span>
<span id="cb211-1922"><a href="#cb211-1922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1923"><a href="#cb211-1923" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1924"><a href="#cb211-1924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1925"><a href="#cb211-1925" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;10.2&lt;/span&gt;&amp;nbsp; The Global Summary of the Day database</span></span>
<span id="cb211-1926"><a href="#cb211-1926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1927"><a href="#cb211-1927" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1928"><a href="#cb211-1928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1929"><a href="#cb211-1929" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>An invaluable source of temperature data: <span class="co">[</span><span class="ot">Global Summary of the Day (GSOD) database</span><span class="co">](https://www.geoplatform.gov/metadata/89cd9f7c-c14a-4ec2-a51d-7f69dc46ea41)</span> by the <span class="co">[</span><span class="ot">National Centers for Environmental Information (NCEI), formerly the National Climatic Data Center (NCDC)</span><span class="co">](https://www.ncei.noaa.gov/)</span> of the <span class="co">[</span><span class="ot"> United States National Oceanic and Atmospheric Administration (NOAA)</span><span class="co">](https://www.noaa.gov/)</span><span class="dv">&amp;mdash;</span> direct access to the weather data <span class="co">[</span><span class="ot">here.</span><span class="co">](https://www.ncei.noaa.gov/data/global-summary-of-the-day/access/)</span></span>
<span id="cb211-1930"><a href="#cb211-1930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1931"><a href="#cb211-1931" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`chillR`</span> automates the tedious data download and assembling process </span>
<span id="cb211-1932"><a href="#cb211-1932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1933"><a href="#cb211-1933" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`handle_gsod()`</span> can take care of all data retrieval steps by telling the function's <span class="in">`action`</span> parameter on what to do, since there are multiple steps involved.</span>
<span id="cb211-1934"><a href="#cb211-1934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1935"><a href="#cb211-1935" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1936"><a href="#cb211-1936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1937"><a href="#cb211-1937" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;10.2.1&lt;/span&gt;&amp;nbsp; `action=list_stations`</span></span>
<span id="cb211-1938"><a href="#cb211-1938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1939"><a href="#cb211-1939" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1940"><a href="#cb211-1940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1941"><a href="#cb211-1941" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`handle_gsod()`</span> retrieves the station list and sorts the station based on their proximity to a set of coordinates we specify. </span>
<span id="cb211-1942"><a href="#cb211-1942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1943"><a href="#cb211-1943" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 10.2.1}</span></span>
<span id="cb211-1944"><a href="#cb211-1944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1945"><a href="#cb211-1945" aria-hidden="true" tabindex="-1"></a><span class="in"># Search for stations near Bonn (Latitude: 50.73, Longitude: 7.10)</span></span>
<span id="cb211-1946"><a href="#cb211-1946" aria-hidden="true" tabindex="-1"></a><span class="in">station_list &lt;- handle_gsod(action = "list_stations",</span></span>
<span id="cb211-1947"><a href="#cb211-1947" aria-hidden="true" tabindex="-1"></a><span class="in">                            location = c(long = 7.10, lat = 50.73),</span></span>
<span id="cb211-1948"><a href="#cb211-1948" aria-hidden="true" tabindex="-1"></a><span class="in">                            time_interval = c(1990, 2020)) # limit search data</span></span>
<span id="cb211-1949"><a href="#cb211-1949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1950"><a href="#cb211-1950" aria-hidden="true" tabindex="-1"></a><span class="in">kable(station_list) %&gt;%</span></span>
<span id="cb211-1951"><a href="#cb211-1951" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 5)</span></span>
<span id="cb211-1952"><a href="#cb211-1952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1953"><a href="#cb211-1953" aria-hidden="true" tabindex="-1"></a><span class="in">#  25 closest stations to the location set, ordered by their </span></span>
<span id="cb211-1954"><a href="#cb211-1954" aria-hidden="true" tabindex="-1"></a><span class="in"># distance to the target coordinates</span></span>
<span id="cb211-1955"><a href="#cb211-1955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1956"><a href="#cb211-1956" aria-hidden="true" tabindex="-1"></a><span class="in"># Overlap_years column: the number of years that are available</span></span>
<span id="cb211-1957"><a href="#cb211-1957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1958"><a href="#cb211-1958" aria-hidden="true" tabindex="-1"></a><span class="in"># Perc_interval_covered column: the percentage of the target interval </span></span>
<span id="cb211-1959"><a href="#cb211-1959" aria-hidden="true" tabindex="-1"></a><span class="in"># that is covered based on BEGIN and END dates in the table - </span></span>
<span id="cb211-1960"><a href="#cb211-1960" aria-hidden="true" tabindex="-1"></a><span class="in"># it’s quite possible (and usually the case) that the dataset contains gaps, </span></span>
<span id="cb211-1961"><a href="#cb211-1961" aria-hidden="true" tabindex="-1"></a><span class="in"># which sometimes cover almost the entire record.</span></span>
<span id="cb211-1962"><a href="#cb211-1962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1963"><a href="#cb211-1963" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1964"><a href="#cb211-1964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1965"><a href="#cb211-1965" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1966"><a href="#cb211-1966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1967"><a href="#cb211-1967" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;10.2.2&lt;/span&gt;&amp;nbsp; `action="download_weather"`</span></span>
<span id="cb211-1968"><a href="#cb211-1968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1969"><a href="#cb211-1969" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1970"><a href="#cb211-1970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1971"><a href="#cb211-1971" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When used with this option, the <span class="in">`handle_gsod()`</span> function downloads the weather data for a particular station, based on a station-specific <span class="in">`chillR_code`</span>.</span>
<span id="cb211-1972"><a href="#cb211-1972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1973"><a href="#cb211-1973" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Rather than typing the code manually, we can refer to the code in the station_list.</span>
<span id="cb211-1974"><a href="#cb211-1974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1975"><a href="#cb211-1975" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 10.2.2}</span></span>
<span id="cb211-1976"><a href="#cb211-1976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1977"><a href="#cb211-1977" aria-hidden="true" tabindex="-1"></a><span class="in"># Download for the 4th entry in the list, which covers most of our period of interest</span></span>
<span id="cb211-1978"><a href="#cb211-1978" aria-hidden="true" tabindex="-1"></a><span class="in">  weather &lt;- handle_gsod(action = "download_weather",</span></span>
<span id="cb211-1979"><a href="#cb211-1979" aria-hidden="true" tabindex="-1"></a><span class="in">                       location = station_list$chillR_code[4], #Koln_bonn airport</span></span>
<span id="cb211-1980"><a href="#cb211-1980" aria-hidden="true" tabindex="-1"></a><span class="in">                       time_interval = c(1990, 2020))</span></span>
<span id="cb211-1981"><a href="#cb211-1981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1982"><a href="#cb211-1982" aria-hidden="true" tabindex="-1"></a><span class="in"># Result is a list of two elements:</span></span>
<span id="cb211-1983"><a href="#cb211-1983" aria-hidden="true" tabindex="-1"></a><span class="in"># Element 1 (weather[[1]]) - an indication of the database the data come from</span></span>
<span id="cb211-1984"><a href="#cb211-1984" aria-hidden="true" tabindex="-1"></a><span class="in"># Element 2 (weather[[2]]) - the actual dataset</span></span>
<span id="cb211-1985"><a href="#cb211-1985" aria-hidden="true" tabindex="-1"></a><span class="in">kable(weather[[1]][1:20, ]) %&gt;%</span></span>
<span id="cb211-1986"><a href="#cb211-1986" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 5)</span></span>
<span id="cb211-1987"><a href="#cb211-1987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1988"><a href="#cb211-1988" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-1989"><a href="#cb211-1989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1990"><a href="#cb211-1990" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-1991"><a href="#cb211-1991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1992"><a href="#cb211-1992" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The output looks pretty complicated, and it contains a lot of information we don't need.</span>
<span id="cb211-1993"><a href="#cb211-1993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-1994"><a href="#cb211-1994" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`chillR`</span> has a function to simplify this record. But,</span>
<span id="cb211-1995"><a href="#cb211-1995" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>This removes a lot of variables you may be interested in.</span>
<span id="cb211-1996"><a href="#cb211-1996" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>More importantly, this also removes quality flags, which may indicate that particular records aren’t reliable.</span>
<span id="cb211-1997"><a href="#cb211-1997" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-1998"><a href="#cb211-1998" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-1999"><a href="#cb211-1999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2000"><a href="#cb211-2000" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;10.2.3&lt;/span&gt;&amp;nbsp; downloaded weather as `action` argument</span></span>
<span id="cb211-2001"><a href="#cb211-2001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2002"><a href="#cb211-2002" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-2003"><a href="#cb211-2003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2004"><a href="#cb211-2004" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This way of calling <span class="in">`handle_gsod()`</span> serves to clean the dataset and convert it into a format that <span class="in">`chillR`</span> can easily handle</span>
<span id="cb211-2005"><a href="#cb211-2005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2006"><a href="#cb211-2006" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 10.2.3}</span></span>
<span id="cb211-2007"><a href="#cb211-2007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2008"><a href="#cb211-2008" aria-hidden="true" tabindex="-1"></a><span class="in"># Clean dataset</span></span>
<span id="cb211-2009"><a href="#cb211-2009" aria-hidden="true" tabindex="-1"></a><span class="in">cleaned_weather &lt;- handle_gsod(weather)</span></span>
<span id="cb211-2010"><a href="#cb211-2010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2011"><a href="#cb211-2011" aria-hidden="true" tabindex="-1"></a><span class="in">kable(cleaned_weather[[1]][1:20, ]) %&gt;%</span></span>
<span id="cb211-2012"><a href="#cb211-2012" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 5)</span></span>
<span id="cb211-2013"><a href="#cb211-2013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2014"><a href="#cb211-2014" aria-hidden="true" tabindex="-1"></a><span class="in"># Save the output files generated, so that we can use in the next chapters</span></span>
<span id="cb211-2015"><a href="#cb211-2015" aria-hidden="true" tabindex="-1"></a><span class="in">dir.create("data/Bonn")</span></span>
<span id="cb211-2016"><a href="#cb211-2016" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(station_list,"data/Bonn/station_list.csv",row.names=FALSE)</span></span>
<span id="cb211-2017"><a href="#cb211-2017" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(weather[[1]],"data/Bonn/Bonn_raw_weather.csv",row.names=FALSE)</span></span>
<span id="cb211-2018"><a href="#cb211-2018" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(cleaned_weather[[1]],"data/Bonn/Bonn_chillR_weather.csv",row.names=FALSE)</span></span>
<span id="cb211-2019"><a href="#cb211-2019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2020"><a href="#cb211-2020" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-2021"><a href="#cb211-2021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2022"><a href="#cb211-2022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2023"><a href="#cb211-2023" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-2024"><a href="#cb211-2024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2025"><a href="#cb211-2025" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The output record contains many strange numbers<span class="dv">&amp;mdash;</span> degrees Fahrenheit values in origianl database are converted to degrees Celsius </span>
<span id="cb211-2026"><a href="#cb211-2026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2027"><a href="#cb211-2027" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$Temperature<span class="ot">[^\circ C]</span> = (Temperature<span class="ot">[^\circ F]</span> - 32) . \frac{5}{9}$</span>
<span id="cb211-2028"><a href="#cb211-2028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2029"><a href="#cb211-2029" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The dataset still has pretty substantial gaps, including several entire years of missing data<span class="dv">&amp;mdash;</span> Filling gaps in temperature records</span>
<span id="cb211-2030"><a href="#cb211-2030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2031"><a href="#cb211-2031" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`chillR`</span> has a pretty similar function to download data from the <span class="co">[</span><span class="ot">California Irrigation Management Information System (CIMIS).</span><span class="co">](https://cimis.water.ca.gov/)</span></span>
<span id="cb211-2032"><a href="#cb211-2032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2033"><a href="#cb211-2033" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-2034"><a href="#cb211-2034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2035"><a href="#cb211-2035" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;10.3&lt;/span&gt;&amp;nbsp; Exercises on getting temperature data</span></span>
<span id="cb211-2036"><a href="#cb211-2036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2037"><a href="#cb211-2037" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-2038"><a href="#cb211-2038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2039"><a href="#cb211-2039" aria-hidden="true" tabindex="-1"></a>***1. Choose a location of interest and find the 25 closest weather stations using the `handle_gsod` function***</span>
<span id="cb211-2040"><a href="#cb211-2040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2041"><a href="#cb211-2041" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 10.3.1}</span></span>
<span id="cb211-2042"><a href="#cb211-2042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2043"><a href="#cb211-2043" aria-hidden="true" tabindex="-1"></a><span class="in"># Look for stations near M&amp;ouml;ssigen (48.40567° N, 9.05419° E)</span></span>
<span id="cb211-2044"><a href="#cb211-2044" aria-hidden="true" tabindex="-1"></a><span class="in">MS_station_list &lt;- handle_gsod(action = "list_stations",</span></span>
<span id="cb211-2045"><a href="#cb211-2045" aria-hidden="true" tabindex="-1"></a><span class="in">                               location = c(long = 9.05, lat = 48.40),</span></span>
<span id="cb211-2046"><a href="#cb211-2046" aria-hidden="true" tabindex="-1"></a><span class="in">                               time_interval = c(1990, 2020))</span></span>
<span id="cb211-2047"><a href="#cb211-2047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2048"><a href="#cb211-2048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2049"><a href="#cb211-2049" aria-hidden="true" tabindex="-1"></a><span class="in">kable(MS_station_list) %&gt;%</span></span>
<span id="cb211-2050"><a href="#cb211-2050" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-2051"><a href="#cb211-2051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2052"><a href="#cb211-2052" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-2053"><a href="#cb211-2053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2054"><a href="#cb211-2054" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-2055"><a href="#cb211-2055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2056"><a href="#cb211-2056" aria-hidden="true" tabindex="-1"></a>***2. Download weather data for the most promising station on the list***</span>
<span id="cb211-2057"><a href="#cb211-2057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2058"><a href="#cb211-2058" aria-hidden="true" tabindex="-1"></a>The most promising station in my case is the STUTTGART (airport) weather station (<span class="in">`chillR_code`</span>: 10738099999), which is 34.68 km away from our location of interest. </span>
<span id="cb211-2059"><a href="#cb211-2059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2060"><a href="#cb211-2060" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 10.3.2}</span></span>
<span id="cb211-2061"><a href="#cb211-2061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2062"><a href="#cb211-2062" aria-hidden="true" tabindex="-1"></a><span class="in"># Download weather data for STUTTGART</span></span>
<span id="cb211-2063"><a href="#cb211-2063" aria-hidden="true" tabindex="-1"></a><span class="in">STG_weather &lt;- handle_gsod(action = "download_weather",</span></span>
<span id="cb211-2064"><a href="#cb211-2064" aria-hidden="true" tabindex="-1"></a><span class="in">                           location = MS_station_list$chillR_code[3],</span></span>
<span id="cb211-2065"><a href="#cb211-2065" aria-hidden="true" tabindex="-1"></a><span class="in">                           time_interval = c(1990, 2020))</span></span>
<span id="cb211-2066"><a href="#cb211-2066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2067"><a href="#cb211-2067" aria-hidden="true" tabindex="-1"></a><span class="in"># Show output in table</span></span>
<span id="cb211-2068"><a href="#cb211-2068" aria-hidden="true" tabindex="-1"></a><span class="in">kable(STG_weather[[1]][1:20, ]) %&gt;%</span></span>
<span id="cb211-2069"><a href="#cb211-2069" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 5)</span></span>
<span id="cb211-2070"><a href="#cb211-2070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2071"><a href="#cb211-2071" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-2072"><a href="#cb211-2072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2073"><a href="#cb211-2073" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-2074"><a href="#cb211-2074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2075"><a href="#cb211-2075" aria-hidden="true" tabindex="-1"></a>***3. Convert the weather data into `chillR` format***</span>
<span id="cb211-2076"><a href="#cb211-2076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2077"><a href="#cb211-2077" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 10.3.3}</span></span>
<span id="cb211-2078"><a href="#cb211-2078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2079"><a href="#cb211-2079" aria-hidden="true" tabindex="-1"></a><span class="in"># Clean the dataset and convert to chillR format</span></span>
<span id="cb211-2080"><a href="#cb211-2080" aria-hidden="true" tabindex="-1"></a><span class="in">STG_cleaned_weather &lt;- handle_gsod(STG_weather)</span></span>
<span id="cb211-2081"><a href="#cb211-2081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2082"><a href="#cb211-2082" aria-hidden="true" tabindex="-1"></a><span class="in">kable(STG_cleaned_weather[[1]][1:20, ]) %&gt;%</span></span>
<span id="cb211-2083"><a href="#cb211-2083" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 5)</span></span>
<span id="cb211-2084"><a href="#cb211-2084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2085"><a href="#cb211-2085" aria-hidden="true" tabindex="-1"></a><span class="in"># Save the output </span></span>
<span id="cb211-2086"><a href="#cb211-2086" aria-hidden="true" tabindex="-1"></a><span class="in">dir.create("data/MS")</span></span>
<span id="cb211-2087"><a href="#cb211-2087" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(MS_station_list,"data/MS/MS_station_list.csv",row.names=FALSE)</span></span>
<span id="cb211-2088"><a href="#cb211-2088" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(STG_weather[[1]],"data/MS/STG_raw_weather.csv",row.names=FALSE)</span></span>
<span id="cb211-2089"><a href="#cb211-2089" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(STG_cleaned_weather[[1]],"data/MS/STG_chillR_weather.csv",row.names=FALSE)</span></span>
<span id="cb211-2090"><a href="#cb211-2090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2091"><a href="#cb211-2091" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-2092"><a href="#cb211-2092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2093"><a href="#cb211-2093" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-2094"><a href="#cb211-2094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2095"><a href="#cb211-2095" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 11: Filling gaps in temperature records</span></span>
<span id="cb211-2096"><a href="#cb211-2096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2097"><a href="#cb211-2097" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;11.1&lt;/span&gt;&amp;nbsp; Gaps</span></span>
<span id="cb211-2098"><a href="#cb211-2098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2099"><a href="#cb211-2099" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-2100"><a href="#cb211-2100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2101"><a href="#cb211-2101" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Lots of things can go wrong when recording temperature data, including malfunctioning equipment, flat batteries, power cuts or lack of maintenance. Data archiving, transmission and storage in a database presents the next hurdle. </span>
<span id="cb211-2102"><a href="#cb211-2102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2103"><a href="#cb211-2103" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Many datasets therefore have gaps<span class="dv">&amp;mdash;</span> many scientific methods don’t deal very well with missing data, so we need ways of filling such gaps.</span>
<span id="cb211-2104"><a href="#cb211-2104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2105"><a href="#cb211-2105" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-2106"><a href="#cb211-2106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2107"><a href="#cb211-2107" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;11.2&lt;/span&gt;&amp;nbsp; Filling short gaps in daily records</span></span>
<span id="cb211-2108"><a href="#cb211-2108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2109"><a href="#cb211-2109" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-2110"><a href="#cb211-2110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2111"><a href="#cb211-2111" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Simple linear interpolation is good enough for largely complete weather records, except for isolated incidences of missing daily minimum or maximum temperatures.</span>
<span id="cb211-2112"><a href="#cb211-2112" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Take the last recorded value before a gaps and the first after the gap and compute the average</span>
<span id="cb211-2113"><a href="#cb211-2113" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Also use for slightly longer gaps (e.g. 2-3 days) or maybe a few days more, but it will be dubious</span>
<span id="cb211-2114"><a href="#cb211-2114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2115"><a href="#cb211-2115" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In case gaps extend to several weeks or even months, linear interpolation, which simply connects the start and end points of the gap by a straight line, may miss important features of the local temperature dynamics. </span>
<span id="cb211-2116"><a href="#cb211-2116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2117"><a href="#cb211-2117" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In the extreme case, where we’re missing an entire year of data, such linear interpolation would miss entire seasons, producing unacceptable errors.</span>
<span id="cb211-2118"><a href="#cb211-2118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2119"><a href="#cb211-2119" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Other options:</span>
<span id="cb211-2120"><a href="#cb211-2120" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`fix_weather()`</span> function, without additional argument, linearly interpolates all gaps in the Tmin and Tmax columns</span>
<span id="cb211-2121"><a href="#cb211-2121" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`make_all_day_table()`</span> function adds news lines for the entire days missing in the records</span>
<span id="cb211-2122"><a href="#cb211-2122" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`start_year`</span> and <span class="in">`end_year`</span> to specify the range of years to apply this procedure for; <span class="in">`start_date`</span> and <span class="in">`end_date`</span> in Julian days for the dates to work on; and names of the columns to work on if these are different from <span class="in">`Tmin`</span> and <span class="in">`Tmax`</span> </span>
<span id="cb211-2123"><a href="#cb211-2123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2124"><a href="#cb211-2124" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-2125"><a href="#cb211-2125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2126"><a href="#cb211-2126" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.2}</span></span>
<span id="cb211-2127"><a href="#cb211-2127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2128"><a href="#cb211-2128" aria-hidden="true" tabindex="-1"></a><span class="in"># This add DATE column in R format</span></span>
<span id="cb211-2129"><a href="#cb211-2129" aria-hidden="true" tabindex="-1"></a><span class="in">weather &lt;- KA_weather %&gt;% make_all_day_table()</span></span>
<span id="cb211-2130"><a href="#cb211-2130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2131"><a href="#cb211-2131" aria-hidden="true" tabindex="-1"></a><span class="in"># Interpolate the gaps for Tmin (output: interp- numeric vector with all gaps </span></span>
<span id="cb211-2132"><a href="#cb211-2132" aria-hidden="true" tabindex="-1"></a><span class="in"># linearly interpolated and </span></span>
<span id="cb211-2133"><a href="#cb211-2133" aria-hidden="true" tabindex="-1"></a><span class="in"># missing- boolean vector, either TRUE (gap) or FALSE (no gap))</span></span>
<span id="cb211-2134"><a href="#cb211-2134" aria-hidden="true" tabindex="-1"></a><span class="in">Tmin_int &lt;- interpolate_gaps(weather[,"Tmin"])</span></span>
<span id="cb211-2135"><a href="#cb211-2135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2136"><a href="#cb211-2136" aria-hidden="true" tabindex="-1"></a><span class="in"># Add Tmin and Tmin_interpolated to weather dataset</span></span>
<span id="cb211-2137"><a href="#cb211-2137" aria-hidden="true" tabindex="-1"></a><span class="in">weather &lt;- weather %&gt;% mutate(Tmin = Tmin_int$interp,</span></span>
<span id="cb211-2138"><a href="#cb211-2138" aria-hidden="true" tabindex="-1"></a><span class="in">                              Tmin_interpolated = Tmin_int$missing)</span></span>
<span id="cb211-2139"><a href="#cb211-2139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2140"><a href="#cb211-2140" aria-hidden="true" tabindex="-1"></a><span class="in"># Interpolate the gaps for Tmax</span></span>
<span id="cb211-2141"><a href="#cb211-2141" aria-hidden="true" tabindex="-1"></a><span class="in">Tmax_int &lt;- interpolate_gaps(weather[,"Tmax"])</span></span>
<span id="cb211-2142"><a href="#cb211-2142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2143"><a href="#cb211-2143" aria-hidden="true" tabindex="-1"></a><span class="in"># Add Tmax and Tmax_interpolated to weather dataset</span></span>
<span id="cb211-2144"><a href="#cb211-2144" aria-hidden="true" tabindex="-1"></a><span class="in">weather &lt;- weather %&gt;% mutate(Tmax = Tmax_int$interp,</span></span>
<span id="cb211-2145"><a href="#cb211-2145" aria-hidden="true" tabindex="-1"></a><span class="in">                              Tmax_interpolated = Tmax_int$missing)</span></span>
<span id="cb211-2146"><a href="#cb211-2146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2147"><a href="#cb211-2147" aria-hidden="true" tabindex="-1"></a><span class="in"># add an extra day to the KA_weather dataset that is not connected to </span></span>
<span id="cb211-2148"><a href="#cb211-2148" aria-hidden="true" tabindex="-1"></a><span class="in"># the days that are already there.</span></span>
<span id="cb211-2149"><a href="#cb211-2149" aria-hidden="true" tabindex="-1"></a><span class="in"># this creates a large gap, which we can then interpolate</span></span>
<span id="cb211-2150"><a href="#cb211-2150" aria-hidden="true" tabindex="-1"></a><span class="in">KA_weather_gap &lt;- rbind(KA_weather, c(Year = 2011,</span></span>
<span id="cb211-2151"><a href="#cb211-2151" aria-hidden="true" tabindex="-1"></a><span class="in">                                      Month = 3,</span></span>
<span id="cb211-2152"><a href="#cb211-2152" aria-hidden="true" tabindex="-1"></a><span class="in">                                      Day = 3,</span></span>
<span id="cb211-2153"><a href="#cb211-2153" aria-hidden="true" tabindex="-1"></a><span class="in">                                      Tmax = 26,</span></span>
<span id="cb211-2154"><a href="#cb211-2154" aria-hidden="true" tabindex="-1"></a><span class="in">                                      Tmin = 14)) </span></span>
<span id="cb211-2155"><a href="#cb211-2155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2156"><a href="#cb211-2156" aria-hidden="true" tabindex="-1"></a><span class="in"># fill in the gaps between Julian date 300 (late October) and 100 (early April), </span></span>
<span id="cb211-2157"><a href="#cb211-2157" aria-hidden="true" tabindex="-1"></a><span class="in"># only returning data between 2000 and 2011</span></span>
<span id="cb211-2158"><a href="#cb211-2158" aria-hidden="true" tabindex="-1"></a><span class="in">fixed_winter_days &lt;- KA_weather_gap %&gt;% fix_weather(start_year = 2000,</span></span>
<span id="cb211-2159"><a href="#cb211-2159" aria-hidden="true" tabindex="-1"></a><span class="in">                                                    end_year = 2011,</span></span>
<span id="cb211-2160"><a href="#cb211-2160" aria-hidden="true" tabindex="-1"></a><span class="in">                                                    start_date = 300,</span></span>
<span id="cb211-2161"><a href="#cb211-2161" aria-hidden="true" tabindex="-1"></a><span class="in">                                                    end_date = 100)</span></span>
<span id="cb211-2162"><a href="#cb211-2162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2163"><a href="#cb211-2163" aria-hidden="true" tabindex="-1"></a><span class="in"># fill in all gaps</span></span>
<span id="cb211-2164"><a href="#cb211-2164" aria-hidden="true" tabindex="-1"></a><span class="in">fixed_all_days &lt;- KA_weather_gap %&gt;% fix_weather()</span></span>
<span id="cb211-2165"><a href="#cb211-2165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2166"><a href="#cb211-2166" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-2167"><a href="#cb211-2167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2168"><a href="#cb211-2168" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-2169"><a href="#cb211-2169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2170"><a href="#cb211-2170" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`fix_weather()`</span> function produces a list of two outputs:</span>
<span id="cb211-2171"><a href="#cb211-2171" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`weather`</span>: a <span class="in">`data.frame`</span> with the interpolated weather data, now including columns <span class="in">`no_Tmin`</span> and <span class="in">`no_Tmax`</span>, which contain <span class="in">`TRUE`</span> for rows where the respective values were originally missing (<span class="in">`FALSE`</span> otherwise).</span>
<span id="cb211-2172"><a href="#cb211-2172" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`QC`</span>: a quality control object that summarizes how many values were interpolated for each season.</span>
<span id="cb211-2173"><a href="#cb211-2173" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-2174"><a href="#cb211-2174" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-2175"><a href="#cb211-2175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2176"><a href="#cb211-2176" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.2a}</span></span>
<span id="cb211-2177"><a href="#cb211-2177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2178"><a href="#cb211-2178" aria-hidden="true" tabindex="-1"></a><span class="in"># QC elements for interpolated fixed_winter_days dataset</span></span>
<span id="cb211-2179"><a href="#cb211-2179" aria-hidden="true" tabindex="-1"></a><span class="in">kable(fixed_winter_days$QC, </span></span>
<span id="cb211-2180"><a href="#cb211-2180" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = </span></span>
<span id="cb211-2181"><a href="#cb211-2181" aria-hidden="true" tabindex="-1"></a><span class="in">      "Table 11.2a: Quality control summary produced by fixed_weather(), with</span></span>
<span id="cb211-2182"><a href="#cb211-2182" aria-hidden="true" tabindex="-1"></a><span class="in">      only winter days interpolated") %&gt;%</span></span>
<span id="cb211-2183"><a href="#cb211-2183" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-2184"><a href="#cb211-2184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2185"><a href="#cb211-2185" aria-hidden="true" tabindex="-1"></a><span class="in"># QC elements for interpolated fixed_all_days dataset</span></span>
<span id="cb211-2186"><a href="#cb211-2186" aria-hidden="true" tabindex="-1"></a><span class="in">kable(fixed_all_days$QC,</span></span>
<span id="cb211-2187"><a href="#cb211-2187" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = </span></span>
<span id="cb211-2188"><a href="#cb211-2188" aria-hidden="true" tabindex="-1"></a><span class="in">      "Table 11.2b: Quality control summary produced by fix_weather(),</span></span>
<span id="cb211-2189"><a href="#cb211-2189" aria-hidden="true" tabindex="-1"></a><span class="in">      with all days interpolated") %&gt;%</span></span>
<span id="cb211-2190"><a href="#cb211-2190" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-2191"><a href="#cb211-2191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2192"><a href="#cb211-2192" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-2193"><a href="#cb211-2193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2194"><a href="#cb211-2194" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-2195"><a href="#cb211-2195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2196"><a href="#cb211-2196" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Linear interpolation is usually acceptable for short gaps in the records, but it gets increasingly less convincing, when the gaps are longer. Here’s a quick demonstration of this:</span>
<span id="cb211-2197"><a href="#cb211-2197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2198"><a href="#cb211-2198" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.2b}</span></span>
<span id="cb211-2199"><a href="#cb211-2199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2200"><a href="#cb211-2200" aria-hidden="true" tabindex="-1"></a><span class="in"># Create gap_weather dataset with rows 200:305 of KA_weather dataset</span></span>
<span id="cb211-2201"><a href="#cb211-2201" aria-hidden="true" tabindex="-1"></a><span class="in">gap_weather &lt;- KA_weather[200:305,]</span></span>
<span id="cb211-2202"><a href="#cb211-2202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2203"><a href="#cb211-2203" aria-hidden="true" tabindex="-1"></a><span class="in"># Add a new Tmin_observed column which copies Tmin values</span></span>
<span id="cb211-2204"><a href="#cb211-2204" aria-hidden="true" tabindex="-1"></a><span class="in">gap_weather[,"Tmin_observed"] &lt;- gap_weather$Tmin</span></span>
<span id="cb211-2205"><a href="#cb211-2205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2206"><a href="#cb211-2206" aria-hidden="true" tabindex="-1"></a><span class="in"># Replace with NA for Tmin values in selected rows (Create gaps)</span></span>
<span id="cb211-2207"><a href="#cb211-2207" aria-hidden="true" tabindex="-1"></a><span class="in">gap_weather$Tmin[c(2,4:5,7:9,11:14,16:20,22:27,29:35,</span></span>
<span id="cb211-2208"><a href="#cb211-2208" aria-hidden="true" tabindex="-1"></a><span class="in">                   37:44,46:54,56:65,67:77,79:90,92:104)] &lt;- NA</span></span>
<span id="cb211-2209"><a href="#cb211-2209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2210"><a href="#cb211-2210" aria-hidden="true" tabindex="-1"></a><span class="in"># Interpolate the gaps with fix_weather function</span></span>
<span id="cb211-2211"><a href="#cb211-2211" aria-hidden="true" tabindex="-1"></a><span class="in">fixed_gaps &lt;- fix_weather(gap_weather)$weather # only select weather output</span></span>
<span id="cb211-2212"><a href="#cb211-2212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2213"><a href="#cb211-2213" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the result</span></span>
<span id="cb211-2214"><a href="#cb211-2214" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = fixed_gaps, aes(DATE)) +</span></span>
<span id="cb211-2215"><a href="#cb211-2215" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(aes(y = Tmin_observed, color = "Tmin Observed"), lwd = 1.3) +</span></span>
<span id="cb211-2216"><a href="#cb211-2216" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(aes(y = Tmin, color = "Tmin Interpolated"), lwd = 1.3) +</span></span>
<span id="cb211-2217"><a href="#cb211-2217" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(</span></span>
<span id="cb211-2218"><a href="#cb211-2218" aria-hidden="true" tabindex="-1"></a><span class="in">    values = c("Tmin Observed" = "black", "Tmin Interpolated" = "red"),</span></span>
<span id="cb211-2219"><a href="#cb211-2219" aria-hidden="true" tabindex="-1"></a><span class="in">    name = "Legend"</span></span>
<span id="cb211-2220"><a href="#cb211-2220" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb211-2221"><a href="#cb211-2221" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Date") +</span></span>
<span id="cb211-2222"><a href="#cb211-2222" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Daily minimum temperature (°C)")</span></span>
<span id="cb211-2223"><a href="#cb211-2223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2224"><a href="#cb211-2224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2225"><a href="#cb211-2225" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-2226"><a href="#cb211-2226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2227"><a href="#cb211-2227" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-2228"><a href="#cb211-2228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2229"><a href="#cb211-2229" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.2c}</span></span>
<span id="cb211-2230"><a href="#cb211-2230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2231"><a href="#cb211-2231" aria-hidden="true" tabindex="-1"></a><span class="in"># Calculate absolute difference between Tmin_iterpolated and Tmin_observed</span></span>
<span id="cb211-2232"><a href="#cb211-2232" aria-hidden="true" tabindex="-1"></a><span class="in">fixed_gaps[,"error"] &lt;- abs(fixed_gaps$Tmin - fixed_gaps$Tmin_observed)</span></span>
<span id="cb211-2233"><a href="#cb211-2233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2234"><a href="#cb211-2234" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data=fixed_gaps,</span></span>
<span id="cb211-2235"><a href="#cb211-2235" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(DATE,error)) +</span></span>
<span id="cb211-2236"><a href="#cb211-2236" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(lwd=1.3) +</span></span>
<span id="cb211-2237"><a href="#cb211-2237" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Date") +</span></span>
<span id="cb211-2238"><a href="#cb211-2238" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Error introduced by interpolation (°C)") +</span></span>
<span id="cb211-2239"><a href="#cb211-2239" aria-hidden="true" tabindex="-1"></a><span class="in">  # Show in cex=3 size dots the dates where observed Tmin is available</span></span>
<span id="cb211-2240"><a href="#cb211-2240" aria-hidden="true" tabindex="-1"></a><span class="in">  # Only include rows where no_Tmin is FALSE</span></span>
<span id="cb211-2241"><a href="#cb211-2241" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(data=fixed_gaps[which(!fixed_gaps$no_Tmin),],</span></span>
<span id="cb211-2242"><a href="#cb211-2242" aria-hidden="true" tabindex="-1"></a><span class="in">             aes(DATE,error),col="red",cex=3)</span></span>
<span id="cb211-2243"><a href="#cb211-2243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2244"><a href="#cb211-2244" aria-hidden="true" tabindex="-1"></a><span class="in"># Gaps of length == 1 only on the left, and gaps of length == 13 on the right -</span></span>
<span id="cb211-2245"><a href="#cb211-2245" aria-hidden="true" tabindex="-1"></a><span class="in"># temperature dynamics are captured quite well on the left, but </span></span>
<span id="cb211-2246"><a href="#cb211-2246" aria-hidden="true" tabindex="-1"></a><span class="in"># no longer very well on the right. </span></span>
<span id="cb211-2247"><a href="#cb211-2247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2248"><a href="#cb211-2248" aria-hidden="true" tabindex="-1"></a><span class="in"># How big the errors get obviously depends on the nature of the dataset - </span></span>
<span id="cb211-2249"><a href="#cb211-2249" aria-hidden="true" tabindex="-1"></a><span class="in"># was there a lot of variation during the period of interest, or not? </span></span>
<span id="cb211-2250"><a href="#cb211-2250" aria-hidden="true" tabindex="-1"></a><span class="in"># Yet we see a tendency here of errors getting bigger and bigger with </span></span>
<span id="cb211-2251"><a href="#cb211-2251" aria-hidden="true" tabindex="-1"></a><span class="in"># increasing gap sizes. Of course for the non-gap points (shown in red in </span></span>
<span id="cb211-2252"><a href="#cb211-2252" aria-hidden="true" tabindex="-1"></a><span class="in"># the plot), the error is zero, but especially in the middle of the larger gaps, </span></span>
<span id="cb211-2253"><a href="#cb211-2253" aria-hidden="true" tabindex="-1"></a><span class="in"># we can be quite far off from what actually happened.</span></span>
<span id="cb211-2254"><a href="#cb211-2254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2255"><a href="#cb211-2255" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-2256"><a href="#cb211-2256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2257"><a href="#cb211-2257" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-2258"><a href="#cb211-2258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2259"><a href="#cb211-2259" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;11.3&lt;/span&gt;&amp;nbsp; Filling long gaps in daily records</span></span>
<span id="cb211-2260"><a href="#cb211-2260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2261"><a href="#cb211-2261" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-2262"><a href="#cb211-2262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2263"><a href="#cb211-2263" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For longer gaps, we can experiment with more complex interpolation algorithms, or try to look for additional data<span class="dv">&amp;mdash;</span> find another weather station that is close enough to be in a climatically comparable setting and use the data from there to fill gaps for the site of interest.</span>
<span id="cb211-2264"><a href="#cb211-2264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2265"><a href="#cb211-2265" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This may work ok, if the auxiliary station is in a very similar climatic setting, but it will already introduce an error if we’re dealing with some elevation differences, or with other landscape features that have climatic effects (e.g. lakes, sea, forest). </span>
<span id="cb211-2266"><a href="#cb211-2266" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Such features, as well as topography, can modulate temperatures at a particular place in a way that makes them poor proxies of temperatures in another location.</span>
<span id="cb211-2267"><a href="#cb211-2267" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-2268"><a href="#cb211-2268" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-2269"><a href="#cb211-2269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2270"><a href="#cb211-2270" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`patch_weather()`</span> function can fill gaps in a weather record based on a list of weather datasets from auxiliary stations.</span>
<span id="cb211-2271"><a href="#cb211-2271" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>The function can also test for (some) biases, correct data for bias in mean temperatures, and use the result to fill gaps in the record for the location of interest.</span>
<span id="cb211-2272"><a href="#cb211-2272" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-2273"><a href="#cb211-2273" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.3a}</span></span>
<span id="cb211-2274"><a href="#cb211-2274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2275"><a href="#cb211-2275" aria-hidden="true" tabindex="-1"></a><span class="in"># Fill gaps in dataset for Bonn that was downloaded in Ch. 10</span></span>
<span id="cb211-2276"><a href="#cb211-2276" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn &lt;- read.csv("data/Bonn/Bonn_chillR_weather.csv")</span></span>
<span id="cb211-2277"><a href="#cb211-2277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2278"><a href="#cb211-2278" aria-hidden="true" tabindex="-1"></a><span class="in"># Check the quality control summary with fix_weather()</span></span>
<span id="cb211-2279"><a href="#cb211-2279" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_QC &lt;- fix_weather(Bonn)$QC</span></span>
<span id="cb211-2280"><a href="#cb211-2280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2281"><a href="#cb211-2281" aria-hidden="true" tabindex="-1"></a><span class="in"># Display the QC summary</span></span>
<span id="cb211-2282"><a href="#cb211-2282" aria-hidden="true" tabindex="-1"></a><span class="in">kable(Bonn_QC,</span></span>
<span id="cb211-2283"><a href="#cb211-2283" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "Table 11.3a: Quality control summary produced by fix_weather()",) %&gt;%</span></span>
<span id="cb211-2284"><a href="#cb211-2284" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-2285"><a href="#cb211-2285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2286"><a href="#cb211-2286" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-2287"><a href="#cb211-2287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2288"><a href="#cb211-2288" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-2289"><a href="#cb211-2289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2290"><a href="#cb211-2290" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The dataset has substantial gaps between 1998 and 2004 and in 2008 (almost all values missing), and some shorter gaps in 2015, 2018 and 2020.</span>
<span id="cb211-2291"><a href="#cb211-2291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2292"><a href="#cb211-2292" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We will use data from neighbouring weather stations to patch the dataset.</span>
<span id="cb211-2293"><a href="#cb211-2293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2294"><a href="#cb211-2294" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.3b}</span></span>
<span id="cb211-2295"><a href="#cb211-2295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2296"><a href="#cb211-2296" aria-hidden="true" tabindex="-1"></a><span class="in"># Find nearby weather stations using handle_gsod()</span></span>
<span id="cb211-2297"><a href="#cb211-2297" aria-hidden="true" tabindex="-1"></a><span class="in">station_list &lt;- handle_gsod(action = "list_stations",</span></span>
<span id="cb211-2298"><a href="#cb211-2298" aria-hidden="true" tabindex="-1"></a><span class="in">                            location = c(7.10, 50.73),</span></span>
<span id="cb211-2299"><a href="#cb211-2299" aria-hidden="true" tabindex="-1"></a><span class="in">                            time_interval = c(1990, 2020))</span></span>
<span id="cb211-2300"><a href="#cb211-2300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2301"><a href="#cb211-2301" aria-hidden="true" tabindex="-1"></a><span class="in">kable(station_list,</span></span>
<span id="cb211-2302"><a href="#cb211-2302" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Table 11.3b: List of GSOD weather stations close to Bonn") %&gt;%</span></span>
<span id="cb211-2303"><a href="#cb211-2303" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-2304"><a href="#cb211-2304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2305"><a href="#cb211-2305" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-2306"><a href="#cb211-2306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2307"><a href="#cb211-2307" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-2308"><a href="#cb211-2308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2309"><a href="#cb211-2309" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Many of these stations are not very useful because they only overlap with the record we already have for a few years, in some cases not at all.</span>
<span id="cb211-2310"><a href="#cb211-2310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2311"><a href="#cb211-2311" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Maybe we can combine data from multiple auxiliary stations to close all the gaps.</span>
<span id="cb211-2312"><a href="#cb211-2312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2313"><a href="#cb211-2313" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Stations that look promising are BONN-HARDTHOEHE, BONN-ROLEBER, and NORVENICH.</span>
<span id="cb211-2314"><a href="#cb211-2314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2315"><a href="#cb211-2315" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.3c}</span></span>
<span id="cb211-2316"><a href="#cb211-2316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2317"><a href="#cb211-2317" aria-hidden="true" tabindex="-1"></a><span class="in"># Download data for promising stations (position 2, 3, 6 in station_list) </span></span>
<span id="cb211-2318"><a href="#cb211-2318" aria-hidden="true" tabindex="-1"></a><span class="in"># and store them in a list.</span></span>
<span id="cb211-2319"><a href="#cb211-2319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2320"><a href="#cb211-2320" aria-hidden="true" tabindex="-1"></a><span class="in"># The handle_gsod function can download multiple files at ones, returning </span></span>
<span id="cb211-2321"><a href="#cb211-2321" aria-hidden="true" tabindex="-1"></a><span class="in"># a named list of station records.</span></span>
<span id="cb211-2322"><a href="#cb211-2322" aria-hidden="true" tabindex="-1"></a><span class="in">patch_weather &lt;- </span></span>
<span id="cb211-2323"><a href="#cb211-2323" aria-hidden="true" tabindex="-1"></a><span class="in">  handle_gsod(action = "download_weather",</span></span>
<span id="cb211-2324"><a href="#cb211-2324" aria-hidden="true" tabindex="-1"></a><span class="in">              location = as.character(station_list$chillR_code[c(2, 3, 6)]),</span></span>
<span id="cb211-2325"><a href="#cb211-2325" aria-hidden="true" tabindex="-1"></a><span class="in">              time_interval = c(1990, 2020)) %&gt;%</span></span>
<span id="cb211-2326"><a href="#cb211-2326" aria-hidden="true" tabindex="-1"></a><span class="in">  handle_gsod() # clean the downloaded data ?</span></span>
<span id="cb211-2327"><a href="#cb211-2327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2328"><a href="#cb211-2328" aria-hidden="true" tabindex="-1"></a><span class="in"># Use the list of dowloaded weather records to fill gaps in record for Bonn</span></span>
<span id="cb211-2329"><a href="#cb211-2329" aria-hidden="true" tabindex="-1"></a><span class="in">patched &lt;- patch_daily_temperatures(weather = Bonn,</span></span>
<span id="cb211-2330"><a href="#cb211-2330" aria-hidden="true" tabindex="-1"></a><span class="in">                                    patch_weather = patch_weather)</span></span>
<span id="cb211-2331"><a href="#cb211-2331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2332"><a href="#cb211-2332" aria-hidden="true" tabindex="-1"></a><span class="in"># Look at what happened by looking at `statistics` of the `patched` object</span></span>
<span id="cb211-2333"><a href="#cb211-2333" aria-hidden="true" tabindex="-1"></a><span class="in">kable(patched$statistics[[1]], </span></span>
<span id="cb211-2334"><a href="#cb211-2334" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Table 11.3c: Patch statistics for NORVENICH") %&gt;%</span></span>
<span id="cb211-2335"><a href="#cb211-2335" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-2336"><a href="#cb211-2336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2337"><a href="#cb211-2337" aria-hidden="true" tabindex="-1"></a><span class="in">kable(patched$statistics[[2]], </span></span>
<span id="cb211-2338"><a href="#cb211-2338" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Table 11.3d: Patch statistics for BONN-HARDTHOEHE") %&gt;%</span></span>
<span id="cb211-2339"><a href="#cb211-2339" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-2340"><a href="#cb211-2340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2341"><a href="#cb211-2341" aria-hidden="true" tabindex="-1"></a><span class="in">kable(patched$statistics[[3]], </span></span>
<span id="cb211-2342"><a href="#cb211-2342" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Table 11.3e: Patch statistics for BONN-ROLEBER") %&gt;%</span></span>
<span id="cb211-2343"><a href="#cb211-2343" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-2344"><a href="#cb211-2344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2345"><a href="#cb211-2345" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-2346"><a href="#cb211-2346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2347"><a href="#cb211-2347" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-2348"><a href="#cb211-2348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2349"><a href="#cb211-2349" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Here we see an analysis of how similar the temperature records (separately for Tmin and Tmax) were between each auxiliary station and our station of interest in Bonn, based on days for which both stations had data.</span>
<span id="cb211-2350"><a href="#cb211-2350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2351"><a href="#cb211-2351" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Besides the number of days for which information was taken from each auxiliary station (<span class="in">`filled`</span>) and the number of gaps that remained afterwards (<span class="in">`gaps_remain`</span>), we see two quality statistics:</span>
<span id="cb211-2352"><a href="#cb211-2352" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>the mean bias (<span class="in">`mean_bias`</span>), i.e. the mean temperature difference<span class="dv">&amp;mdash;</span> easy to address by setting threshold</span>
<span id="cb211-2353"><a href="#cb211-2353" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>the standard deviation of the daily differences (<span class="in">`stdev_bias`</span>)<span class="dv">&amp;mdash;</span> more problematic as this indicates the extent of additional (possibly unsystematic) differences between stations (not sure this can be adjusted or not); so for now we should treat this as an exclusion criterion (i.e. if stdev_bias is above a certain value, we reject the station)</span>
<span id="cb211-2354"><a href="#cb211-2354" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-2355"><a href="#cb211-2355" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-2356"><a href="#cb211-2356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2357"><a href="#cb211-2357" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Let’s set some limits for both metrics, which we can pass as arguments to <span class="in">`patch_daily_temperatures()`</span> (using the max_mean_bias and max_stdev_bias parameters). </span>
<span id="cb211-2358"><a href="#cb211-2358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2359"><a href="#cb211-2359" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Let’s cap the <span class="in">`mean_bias`</span> at 1 °C and the <span class="in">`stdev_bias`</span> at 2°C, and then look at the statistics again.</span>
<span id="cb211-2360"><a href="#cb211-2360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2361"><a href="#cb211-2361" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.3d}</span></span>
<span id="cb211-2362"><a href="#cb211-2362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2363"><a href="#cb211-2363" aria-hidden="true" tabindex="-1"></a><span class="in">patched &lt;- patch_daily_temperatures(weather = Bonn,</span></span>
<span id="cb211-2364"><a href="#cb211-2364" aria-hidden="true" tabindex="-1"></a><span class="in">                                    patch_weather = patch_weather,</span></span>
<span id="cb211-2365"><a href="#cb211-2365" aria-hidden="true" tabindex="-1"></a><span class="in">                                    max_mean_bias = 1,</span></span>
<span id="cb211-2366"><a href="#cb211-2366" aria-hidden="true" tabindex="-1"></a><span class="in">                                    max_stdev_bias = 2)</span></span>
<span id="cb211-2367"><a href="#cb211-2367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2368"><a href="#cb211-2368" aria-hidden="true" tabindex="-1"></a><span class="in">kable(patched$statistics[[1]], </span></span>
<span id="cb211-2369"><a href="#cb211-2369" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Table 11.3f: Patch statistics for NORVENICH") %&gt;%</span></span>
<span id="cb211-2370"><a href="#cb211-2370" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-2371"><a href="#cb211-2371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2372"><a href="#cb211-2372" aria-hidden="true" tabindex="-1"></a><span class="in">kable(patched$statistics[[2]], </span></span>
<span id="cb211-2373"><a href="#cb211-2373" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Table 11.3g: Patch statistics for BONN-HARDTHOEHE") %&gt;%</span></span>
<span id="cb211-2374"><a href="#cb211-2374" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-2375"><a href="#cb211-2375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2376"><a href="#cb211-2376" aria-hidden="true" tabindex="-1"></a><span class="in">kable(patched$statistics[[3]], </span></span>
<span id="cb211-2377"><a href="#cb211-2377" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Table 11.3h: Patch statistics for BONN-ROLEBER") %&gt;%</span></span>
<span id="cb211-2378"><a href="#cb211-2378" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-2379"><a href="#cb211-2379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2380"><a href="#cb211-2380" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-2381"><a href="#cb211-2381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2382"><a href="#cb211-2382" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-2383"><a href="#cb211-2383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2384"><a href="#cb211-2384" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>All records from BONN-HARDTHOEHE, as well as the <span class="in">`Tmax`</span> records from BONN-ROLEBER were rejected, because they didn’t pass the <span class="in">`mean_bias`</span> filter.</span>
<span id="cb211-2385"><a href="#cb211-2385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2386"><a href="#cb211-2386" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Data from NORVENICH are pretty good<span class="dv">&amp;mdash;</span> fill 2146 gaps for <span class="in">`Tmin`</span> and 2146 for <span class="in">`Tmax`</span>. Only 1 and 1 gaps remain for Tmin and Tmax, respectively.</span>
<span id="cb211-2387"><a href="#cb211-2387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2388"><a href="#cb211-2388" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use <span class="in">`fix_weather()`</span> function to take a look at where the remaining gaps are:</span>
<span id="cb211-2389"><a href="#cb211-2389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2390"><a href="#cb211-2390" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.3e}</span></span>
<span id="cb211-2391"><a href="#cb211-2391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2392"><a href="#cb211-2392" aria-hidden="true" tabindex="-1"></a><span class="in">post_patch_stats &lt;- fix_weather(patched)$QC</span></span>
<span id="cb211-2393"><a href="#cb211-2393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2394"><a href="#cb211-2394" aria-hidden="true" tabindex="-1"></a><span class="in">kable(post_patch_stats, </span></span>
<span id="cb211-2395"><a href="#cb211-2395" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Table 11.3i: Data completeness table for the weather record </span></span>
<span id="cb211-2396"><a href="#cb211-2396" aria-hidden="true" tabindex="-1"></a><span class="in">      from Bonn, after applying the patch procedure") %&gt;%</span></span>
<span id="cb211-2397"><a href="#cb211-2397" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-2398"><a href="#cb211-2398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2399"><a href="#cb211-2399" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-2400"><a href="#cb211-2400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2401"><a href="#cb211-2401" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-2402"><a href="#cb211-2402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2403"><a href="#cb211-2403" aria-hidden="true" tabindex="-1"></a><span class="ss">-  </span>Almost all gaps are filled, with only data for 1 day missing after the patching. It seems safe to use linear interpolation for such a short gap, by applying the <span class="in">`fix_weather()`</span> function.</span>
<span id="cb211-2404"><a href="#cb211-2404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2405"><a href="#cb211-2405" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.3f}</span></span>
<span id="cb211-2406"><a href="#cb211-2406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2407"><a href="#cb211-2407" aria-hidden="true" tabindex="-1"></a><span class="in"># Linear interpoloation to fix a short gap of one day</span></span>
<span id="cb211-2408"><a href="#cb211-2408" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_weather &lt;- fix_weather(patched)</span></span>
<span id="cb211-2409"><a href="#cb211-2409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2410"><a href="#cb211-2410" aria-hidden="true" tabindex="-1"></a><span class="in">post_patch_stats_2 &lt;- fix_weather(Bonn_weather)$QC</span></span>
<span id="cb211-2411"><a href="#cb211-2411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2412"><a href="#cb211-2412" aria-hidden="true" tabindex="-1"></a><span class="in">kable(post_patch_stats_2, </span></span>
<span id="cb211-2413"><a href="#cb211-2413" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Table 11.3j: Data completeness table for the weather record </span></span>
<span id="cb211-2414"><a href="#cb211-2414" aria-hidden="true" tabindex="-1"></a><span class="in">      from Bonn, after applying the linear interpolation") %&gt;%</span></span>
<span id="cb211-2415"><a href="#cb211-2415" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-2416"><a href="#cb211-2416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2417"><a href="#cb211-2417" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-2418"><a href="#cb211-2418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2419"><a href="#cb211-2419" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-2420"><a href="#cb211-2420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2421"><a href="#cb211-2421" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;11.3.1&lt;/span&gt;&amp;nbsp; Bias-correction for shorter intervals</span></span>
<span id="cb211-2422"><a href="#cb211-2422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2423"><a href="#cb211-2423" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-2424"><a href="#cb211-2424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2425"><a href="#cb211-2425" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In the <span class="in">`patch_daily_temperatures`</span> function, the bias correction is based on the average difference between the temperatures of a pair of weather stations over the entire year.</span>
<span id="cb211-2426"><a href="#cb211-2426" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>The between-station bias can varies throughout the year. </span>
<span id="cb211-2427"><a href="#cb211-2427" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>A particular station is useful data source for temperatures in certain seasons but not in others.</span>
<span id="cb211-2428"><a href="#cb211-2428" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>So, different bias corrections during different parts of the year give better approximations (smaller biases) than the bias correction for the entire year<span class="dv">&amp;mdash;</span> use <span class="in">`patch_daily_temps`</span> (not <span class="in">`patch_daily_temperatures`</span>)</span>
<span id="cb211-2429"><a href="#cb211-2429" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-2430"><a href="#cb211-2430" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-2431"><a href="#cb211-2431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2432"><a href="#cb211-2432" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The <span class="in">`patch_daily_temps`</span> function, as a default, evaluates temperature records on a monthly basis, i.e. it makes separate between-station comparisons for the temperatures of each calendar month.</span>
<span id="cb211-2433"><a href="#cb211-2433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2434"><a href="#cb211-2434" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It can then take separate decisions on whether a potential auxiliary station is a useful proxy for temperatures in this monthly interval, and it can apply month-specific bias correction.</span>
<span id="cb211-2435"><a href="#cb211-2435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2436"><a href="#cb211-2436" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.3.1a}</span></span>
<span id="cb211-2437"><a href="#cb211-2437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2438"><a href="#cb211-2438" aria-hidden="true" tabindex="-1"></a><span class="in">patched_monthly &lt;- patch_daily_temps(weather = Bonn,</span></span>
<span id="cb211-2439"><a href="#cb211-2439" aria-hidden="true" tabindex="-1"></a><span class="in">                                     patch_weather = patch_weather,</span></span>
<span id="cb211-2440"><a href="#cb211-2440" aria-hidden="true" tabindex="-1"></a><span class="in">                                     max_mean_bias = 1,</span></span>
<span id="cb211-2441"><a href="#cb211-2441" aria-hidden="true" tabindex="-1"></a><span class="in">                                     max_stdev_bias = 2,</span></span>
<span id="cb211-2442"><a href="#cb211-2442" aria-hidden="true" tabindex="-1"></a><span class="in">                                     time_interval = "month")</span></span>
<span id="cb211-2443"><a href="#cb211-2443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2444"><a href="#cb211-2444" aria-hidden="true" tabindex="-1"></a><span class="in"># Finding for minimum temperatures for the NORVENICH station</span></span>
<span id="cb211-2445"><a href="#cb211-2445" aria-hidden="true" tabindex="-1"></a><span class="in">kable(patched_monthly$statistics$Tmin$NORVENICH,</span></span>
<span id="cb211-2446"><a href="#cb211-2446" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Table 11.3.1a: Bias analysis table for the first station in the</span></span>
<span id="cb211-2447"><a href="#cb211-2447" aria-hidden="true" tabindex="-1"></a><span class="in">      proxy station list, showing biases on a monthly level") %&gt;%</span></span>
<span id="cb211-2448"><a href="#cb211-2448" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-2449"><a href="#cb211-2449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2450"><a href="#cb211-2450" aria-hidden="true" tabindex="-1"></a><span class="in"># The mean bias really varies quite a bit here- probably benefit from a </span></span>
<span id="cb211-2451"><a href="#cb211-2451" aria-hidden="true" tabindex="-1"></a><span class="in"># month-specific bias correction. </span></span>
<span id="cb211-2452"><a href="#cb211-2452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2453"><a href="#cb211-2453" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-2454"><a href="#cb211-2454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2455"><a href="#cb211-2455" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-2456"><a href="#cb211-2456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2457"><a href="#cb211-2457" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The <span class="in">`time_interval`</span> parameter of the <span class="in">`patch_daily_temps`</span> function allows us to specify the interval, i.e. either month or week or multiple of these, such as <span class="in">`10 days`</span> or <span class="in">`2 weeks`</span>.</span>
<span id="cb211-2458"><a href="#cb211-2458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2459"><a href="#cb211-2459" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Note that the function starts counting these intervals on 1^st^ January in each year<span class="dv">&amp;mdash;</span> lead to intervals at the end of the year that are smaller than the interval you selected ***(this generates warnings, as you can see below).***</span>
<span id="cb211-2460"><a href="#cb211-2460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2461"><a href="#cb211-2461" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Note also that the smaller these intervals get, the less data can be used for determining the bias. Especially for short time series, a very short interval may therefore not be desirable.</span>
<span id="cb211-2462"><a href="#cb211-2462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2463"><a href="#cb211-2463" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.3.1b, warning=TRUE}</span></span>
<span id="cb211-2464"><a href="#cb211-2464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2465"><a href="#cb211-2465" aria-hidden="true" tabindex="-1"></a><span class="in"># Warning for very short interval (shorter than specified)</span></span>
<span id="cb211-2466"><a href="#cb211-2466" aria-hidden="true" tabindex="-1"></a><span class="in">patch_2weeks &lt;- patch_daily_temps(weather = Bonn,</span></span>
<span id="cb211-2467"><a href="#cb211-2467" aria-hidden="true" tabindex="-1"></a><span class="in">                                  patch_weather = patch_weather,</span></span>
<span id="cb211-2468"><a href="#cb211-2468" aria-hidden="true" tabindex="-1"></a><span class="in">                                  max_mean_bias = 1,</span></span>
<span id="cb211-2469"><a href="#cb211-2469" aria-hidden="true" tabindex="-1"></a><span class="in">                                  max_stdev_bias = 2,</span></span>
<span id="cb211-2470"><a href="#cb211-2470" aria-hidden="true" tabindex="-1"></a><span class="in">                                  time_interval = "2 weeks")</span></span>
<span id="cb211-2471"><a href="#cb211-2471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2472"><a href="#cb211-2472" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-2473"><a href="#cb211-2473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2474"><a href="#cb211-2474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2475"><a href="#cb211-2475" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-2476"><a href="#cb211-2476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2477"><a href="#cb211-2477" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To illustrate the effects of this, let’s create 5000 gaps in the Bonn weather record and fill them with proxy data using annual, monthly and bi-weekly intervals for the bias evaluation. </span>
<span id="cb211-2478"><a href="#cb211-2478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2479"><a href="#cb211-2479" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.3.1c}</span></span>
<span id="cb211-2480"><a href="#cb211-2480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2481"><a href="#cb211-2481" aria-hidden="true" tabindex="-1"></a><span class="in">Gaps &lt;- sample(seq(1:nrow(Bonn)), size = 5000, replace = FALSE) # no duplicate indices</span></span>
<span id="cb211-2482"><a href="#cb211-2482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2483"><a href="#cb211-2483" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_gaps &lt;- Bonn %&gt;% mutate(obs_Tmin = Tmin,</span></span>
<span id="cb211-2484"><a href="#cb211-2484" aria-hidden="true" tabindex="-1"></a><span class="in">                             obs_Tmax = Tmax)</span></span>
<span id="cb211-2485"><a href="#cb211-2485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2486"><a href="#cb211-2486" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_gaps$Tmin[Gaps] &lt;- NA</span></span>
<span id="cb211-2487"><a href="#cb211-2487" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_gaps$Tmax[Gaps] &lt;- NA</span></span>
<span id="cb211-2488"><a href="#cb211-2488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2489"><a href="#cb211-2489" aria-hidden="true" tabindex="-1"></a><span class="in">patch_annual &lt;- patch_daily_temps(weather = Bonn_gaps,</span></span>
<span id="cb211-2490"><a href="#cb211-2490" aria-hidden="true" tabindex="-1"></a><span class="in">                                  patch_weather = patch_weather,</span></span>
<span id="cb211-2491"><a href="#cb211-2491" aria-hidden="true" tabindex="-1"></a><span class="in">                                  max_mean_bias = 1,</span></span>
<span id="cb211-2492"><a href="#cb211-2492" aria-hidden="true" tabindex="-1"></a><span class="in">                                  max_stdev_bias = 2,</span></span>
<span id="cb211-2493"><a href="#cb211-2493" aria-hidden="true" tabindex="-1"></a><span class="in">                                  time_interval = "year")</span></span>
<span id="cb211-2494"><a href="#cb211-2494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2495"><a href="#cb211-2495" aria-hidden="true" tabindex="-1"></a><span class="in">patch_month &lt;- patch_daily_temps(weather = Bonn_gaps,</span></span>
<span id="cb211-2496"><a href="#cb211-2496" aria-hidden="true" tabindex="-1"></a><span class="in">                                 patch_weather = patch_weather,</span></span>
<span id="cb211-2497"><a href="#cb211-2497" aria-hidden="true" tabindex="-1"></a><span class="in">                                 max_mean_bias = 1,</span></span>
<span id="cb211-2498"><a href="#cb211-2498" aria-hidden="true" tabindex="-1"></a><span class="in">                                 max_stdev_bias = 2,</span></span>
<span id="cb211-2499"><a href="#cb211-2499" aria-hidden="true" tabindex="-1"></a><span class="in">                                 time_interval = "month")</span></span>
<span id="cb211-2500"><a href="#cb211-2500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2501"><a href="#cb211-2501" aria-hidden="true" tabindex="-1"></a><span class="in">patch_2weeks &lt;- patch_daily_temps(weather = Bonn_gaps,</span></span>
<span id="cb211-2502"><a href="#cb211-2502" aria-hidden="true" tabindex="-1"></a><span class="in">                                  patch_weather = patch_weather,</span></span>
<span id="cb211-2503"><a href="#cb211-2503" aria-hidden="true" tabindex="-1"></a><span class="in">                                  max_mean_bias = 1,</span></span>
<span id="cb211-2504"><a href="#cb211-2504" aria-hidden="true" tabindex="-1"></a><span class="in">                                  max_stdev_bias = 2,</span></span>
<span id="cb211-2505"><a href="#cb211-2505" aria-hidden="true" tabindex="-1"></a><span class="in">                                  time_interval = "2 weeks")</span></span>
<span id="cb211-2506"><a href="#cb211-2506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2507"><a href="#cb211-2507" aria-hidden="true" tabindex="-1"></a><span class="in"># Add new column values of difference between observed and patched values</span></span>
<span id="cb211-2508"><a href="#cb211-2508" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_gaps[,"Tmin_annual"] &lt;- Bonn_gaps$obs_Tmin - patch_annual$weather$Tmin</span></span>
<span id="cb211-2509"><a href="#cb211-2509" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_gaps[,"Tmax_annual"] &lt;- Bonn_gaps$obs_Tmax - patch_annual$weather$Tmax</span></span>
<span id="cb211-2510"><a href="#cb211-2510" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_gaps[,"Tmin_month"] &lt;- Bonn_gaps$obs_Tmin - patch_month$weather$Tmin</span></span>
<span id="cb211-2511"><a href="#cb211-2511" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_gaps[,"Tmax_month"] &lt;- Bonn_gaps$obs_Tmax - patch_month$weather$Tmax</span></span>
<span id="cb211-2512"><a href="#cb211-2512" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_gaps[,"Tmin_2weeks"] &lt;- Bonn_gaps$obs_Tmin - patch_2weeks$weather$Tmin</span></span>
<span id="cb211-2513"><a href="#cb211-2513" aria-hidden="true" tabindex="-1"></a><span class="in">Bonn_gaps[,"Tmax_2weeks"] &lt;- Bonn_gaps$obs_Tmax - patch_2weeks$weather$Tmax</span></span>
<span id="cb211-2514"><a href="#cb211-2514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2515"><a href="#cb211-2515" aria-hidden="true" tabindex="-1"></a><span class="in"># Modify data for ggplotting</span></span>
<span id="cb211-2516"><a href="#cb211-2516" aria-hidden="true" tabindex="-1"></a><span class="in">Interval_eval &lt;- Bonn_gaps %&gt;%</span></span>
<span id="cb211-2517"><a href="#cb211-2517" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(is.na(Tmin)) %&gt;% # only choose when Tmin is NA</span></span>
<span id="cb211-2518"><a href="#cb211-2518" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_longer(Tmin_annual:Tmax_2weeks) %&gt;% # stack columns into rows under name</span></span>
<span id="cb211-2519"><a href="#cb211-2519" aria-hidden="true" tabindex="-1"></a><span class="in">    # create a new Type column as a factor to have specific order for plotting,</span></span>
<span id="cb211-2520"><a href="#cb211-2520" aria-hidden="true" tabindex="-1"></a><span class="in">    # rather than default alphabetical sorting</span></span>
<span id="cb211-2521"><a href="#cb211-2521" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Type=factor(name,</span></span>
<span id="cb211-2522"><a href="#cb211-2522" aria-hidden="true" tabindex="-1"></a><span class="in">                     levels = c("Tmin_annual",</span></span>
<span id="cb211-2523"><a href="#cb211-2523" aria-hidden="true" tabindex="-1"></a><span class="in">                                "Tmin_month",</span></span>
<span id="cb211-2524"><a href="#cb211-2524" aria-hidden="true" tabindex="-1"></a><span class="in">                                "Tmin_2weeks",</span></span>
<span id="cb211-2525"><a href="#cb211-2525" aria-hidden="true" tabindex="-1"></a><span class="in">                                "Tmax_annual",</span></span>
<span id="cb211-2526"><a href="#cb211-2526" aria-hidden="true" tabindex="-1"></a><span class="in">                                "Tmax_month",</span></span>
<span id="cb211-2527"><a href="#cb211-2527" aria-hidden="true" tabindex="-1"></a><span class="in">                                "Tmax_2weeks")) )</span></span>
<span id="cb211-2528"><a href="#cb211-2528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2529"><a href="#cb211-2529" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the resulting errors with ggplot2 using a violin plot</span></span>
<span id="cb211-2530"><a href="#cb211-2530" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(Interval_eval,</span></span>
<span id="cb211-2531"><a href="#cb211-2531" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(Type, value)) +</span></span>
<span id="cb211-2532"><a href="#cb211-2532" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_violin(draw_quantiles = c(0.25, 0.5, 0.75)) +</span></span>
<span id="cb211-2533"><a href="#cb211-2533" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Variable and bias evaluation interval") +</span></span>
<span id="cb211-2534"><a href="#cb211-2534" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Prediction error")</span></span>
<span id="cb211-2535"><a href="#cb211-2535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2536"><a href="#cb211-2536" aria-hidden="true" tabindex="-1"></a><span class="in"># Also evaluate the mean daily error</span></span>
<span id="cb211-2537"><a href="#cb211-2537" aria-hidden="true" tabindex="-1"></a><span class="in">error_eval &lt;- </span></span>
<span id="cb211-2538"><a href="#cb211-2538" aria-hidden="true" tabindex="-1"></a><span class="in">  data.frame(Variable = c(rep("Tmin", 3), rep("Tmax", 3)),</span></span>
<span id="cb211-2539"><a href="#cb211-2539" aria-hidden="true" tabindex="-1"></a><span class="in">             Interval = rep(c("Year", "Month", "Two weeks"), 2),</span></span>
<span id="cb211-2540"><a href="#cb211-2540" aria-hidden="true" tabindex="-1"></a><span class="in">             Error = c(</span></span>
<span id="cb211-2541"><a href="#cb211-2541" aria-hidden="true" tabindex="-1"></a><span class="in">  # Get absolute mean of temps differences for rows with missing values in Tmin/max</span></span>
<span id="cb211-2542"><a href="#cb211-2542" aria-hidden="true" tabindex="-1"></a><span class="in">               # na.rm set to TRUE to ignore any NA values in the vector</span></span>
<span id="cb211-2543"><a href="#cb211-2543" aria-hidden="true" tabindex="-1"></a><span class="in">               # na.rm set to FALSE will return NA if there are NA values in data</span></span>
<span id="cb211-2544"><a href="#cb211-2544" aria-hidden="true" tabindex="-1"></a><span class="in">               mean(abs(Bonn_gaps$Tmin_annual[is.na(Bonn_gaps$Tmin)]), na.rm = TRUE),</span></span>
<span id="cb211-2545"><a href="#cb211-2545" aria-hidden="true" tabindex="-1"></a><span class="in">               mean(abs(Bonn_gaps$Tmin_month[is.na(Bonn_gaps$Tmin)]), na.rm = TRUE),</span></span>
<span id="cb211-2546"><a href="#cb211-2546" aria-hidden="true" tabindex="-1"></a><span class="in">               mean(abs(Bonn_gaps$Tmin_2weeks[is.na(Bonn_gaps$Tmin)]),na.rm=TRUE),</span></span>
<span id="cb211-2547"><a href="#cb211-2547" aria-hidden="true" tabindex="-1"></a><span class="in">               mean(abs(Bonn_gaps$Tmax_annual[is.na(Bonn_gaps$Tmin)]),na.rm=TRUE),</span></span>
<span id="cb211-2548"><a href="#cb211-2548" aria-hidden="true" tabindex="-1"></a><span class="in">               mean(abs(Bonn_gaps$Tmax_month[is.na(Bonn_gaps$Tmin)]),na.rm=TRUE),</span></span>
<span id="cb211-2549"><a href="#cb211-2549" aria-hidden="true" tabindex="-1"></a><span class="in">               mean(abs(Bonn_gaps$Tmax_2weeks[is.na(Bonn_gaps$Tmin)]),na.rm=TRUE))</span></span>
<span id="cb211-2550"><a href="#cb211-2550" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb211-2551"><a href="#cb211-2551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2552"><a href="#cb211-2552" aria-hidden="true" tabindex="-1"></a><span class="in">kable(error_eval, </span></span>
<span id="cb211-2553"><a href="#cb211-2553" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Table 11.3.1b: Mean absolute prediction error for minimun and </span></span>
<span id="cb211-2554"><a href="#cb211-2554" aria-hidden="true" tabindex="-1"></a><span class="in">      maximum temperature when using different time intervals as a basis for</span></span>
<span id="cb211-2555"><a href="#cb211-2555" aria-hidden="true" tabindex="-1"></a><span class="in">      correcting for between-station biases") %&gt;%</span></span>
<span id="cb211-2556"><a href="#cb211-2556" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-2557"><a href="#cb211-2557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2558"><a href="#cb211-2558" aria-hidden="true" tabindex="-1"></a><span class="in"># The improvement isn't very impressive here, possibly because the stations used</span></span>
<span id="cb211-2559"><a href="#cb211-2559" aria-hidden="true" tabindex="-1"></a><span class="in"># are quite close to each other and the weather doesn't differ much between them.</span></span>
<span id="cb211-2560"><a href="#cb211-2560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2561"><a href="#cb211-2561" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-2562"><a href="#cb211-2562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2563"><a href="#cb211-2563" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-2564"><a href="#cb211-2564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2565"><a href="#cb211-2565" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;11.3.2&lt;/span&gt;&amp;nbsp; Saving the data for later</span></span>
<span id="cb211-2566"><a href="#cb211-2566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2567"><a href="#cb211-2567" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-2568"><a href="#cb211-2568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2569"><a href="#cb211-2569" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Save for later the fairly convincing long-term record (from 1990 to 2020) for Bonn, with no remaining gaps.</span>
<span id="cb211-2570"><a href="#cb211-2570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2571"><a href="#cb211-2571" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.3.2}</span></span>
<span id="cb211-2572"><a href="#cb211-2572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2573"><a href="#cb211-2573" aria-hidden="true" tabindex="-1"></a><span class="in"># Choose the dataset with bias correction on monthly intervals-</span></span>
<span id="cb211-2574"><a href="#cb211-2574" aria-hidden="true" tabindex="-1"></a><span class="in"># still need to interpolate the one missing day, before saving the record</span></span>
<span id="cb211-2575"><a href="#cb211-2575" aria-hidden="true" tabindex="-1"></a><span class="in">monthly_bias_fixed &lt;- fix_weather(patched_monthly)</span></span>
<span id="cb211-2576"><a href="#cb211-2576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2577"><a href="#cb211-2577" aria-hidden="true" tabindex="-1"></a><span class="in"># Save the record for weather element only- the data.frame that can easily be</span></span>
<span id="cb211-2578"><a href="#cb211-2578" aria-hidden="true" tabindex="-1"></a><span class="in"># saved as a spreadsheet table (.csv file).</span></span>
<span id="cb211-2579"><a href="#cb211-2579" aria-hidden="true" tabindex="-1"></a><span class="in"># We can also save list (including the QC element) but it is a bit more</span></span>
<span id="cb211-2580"><a href="#cb211-2580" aria-hidden="true" tabindex="-1"></a><span class="in"># complicated- save it for later.</span></span>
<span id="cb211-2581"><a href="#cb211-2581" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(monthly_bias_fixed$weather,</span></span>
<span id="cb211-2582"><a href="#cb211-2582" aria-hidden="true" tabindex="-1"></a><span class="in">          "data/Bonn/Bonn_weather.csv")</span></span>
<span id="cb211-2583"><a href="#cb211-2583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2584"><a href="#cb211-2584" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-2585"><a href="#cb211-2585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2586"><a href="#cb211-2586" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-2587"><a href="#cb211-2587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2588"><a href="#cb211-2588" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;11.4&lt;/span&gt;&amp;nbsp; Filling gaps in hourly records</span></span>
<span id="cb211-2589"><a href="#cb211-2589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2590"><a href="#cb211-2590" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-2591"><a href="#cb211-2591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2592"><a href="#cb211-2592" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Gaps in hourly records are a lot harder to handle, because linear interpolation usually isn't an option.</span>
<span id="cb211-2593"><a href="#cb211-2593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2594"><a href="#cb211-2594" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This works for very short gaps only, but it’s probably quite obvious that for gaps that extend over multiple days, you can’t just connect the start and end points with a straight line<span class="dv">&amp;mdash;</span> makes it hard to use hourly records, even when they are available.</span>
<span id="cb211-2595"><a href="#cb211-2595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2596"><a href="#cb211-2596" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">(Luedeling, 2018)</span><span class="co">](https://link.springer.com/article/10.1007/s00484-018-1582-7)</span> found a solution to make use of hourly data in such cases.</span>
<span id="cb211-2597"><a href="#cb211-2597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2598"><a href="#cb211-2598" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In principle, having an actual record of hourly temperatures is preferable to deriving hourly data from daily records, but it may cause problems when the record isn't complete, e.g. <span class="in">`Winters_hours_gaps`</span> dataset.</span>
<span id="cb211-2599"><a href="#cb211-2599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2600"><a href="#cb211-2600" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Such situations arise quite often, because temperature loggers can temporarily fail for many reasons.</span>
<span id="cb211-2601"><a href="#cb211-2601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2602"><a href="#cb211-2602" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.4}</span></span>
<span id="cb211-2603"><a href="#cb211-2603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2604"><a href="#cb211-2604" aria-hidden="true" tabindex="-1"></a><span class="in"># See what happens when we use linear interpolation for Winters_hours_gaps</span></span>
<span id="cb211-2605"><a href="#cb211-2605" aria-hidden="true" tabindex="-1"></a><span class="in"># Select rows to match the chart in coursebook</span></span>
<span id="cb211-2606"><a href="#cb211-2606" aria-hidden="true" tabindex="-1"></a><span class="in">gap_Winters &lt;- Winters_hours_gaps[39:350, ]</span></span>
<span id="cb211-2607"><a href="#cb211-2607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2608"><a href="#cb211-2608" aria-hidden="true" tabindex="-1"></a><span class="in"># Add date in chillR format (for plotting)</span></span>
<span id="cb211-2609"><a href="#cb211-2609" aria-hidden="true" tabindex="-1"></a><span class="in">gap_Winters &lt;- add_date(gap_Winters)</span></span>
<span id="cb211-2610"><a href="#cb211-2610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2611"><a href="#cb211-2611" aria-hidden="true" tabindex="-1"></a><span class="in"># View(gap_Winters)</span></span>
<span id="cb211-2612"><a href="#cb211-2612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2613"><a href="#cb211-2613" aria-hidden="true" tabindex="-1"></a><span class="in"># Create Tmin and Tmax columns to comply with chillR data format</span></span>
<span id="cb211-2614"><a href="#cb211-2614" aria-hidden="true" tabindex="-1"></a><span class="in">gap_Winters[, "Tmin"] &lt;- gap_Winters$Temp_gaps</span></span>
<span id="cb211-2615"><a href="#cb211-2615" aria-hidden="true" tabindex="-1"></a><span class="in">gap_Winters[, "Tmin_observed"] &lt;- gap_Winters$Temp</span></span>
<span id="cb211-2616"><a href="#cb211-2616" aria-hidden="true" tabindex="-1"></a><span class="in">gap_Winters[, "Tmax"] &lt;- gap_Winters$Temp # just placeholder</span></span>
<span id="cb211-2617"><a href="#cb211-2617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2618"><a href="#cb211-2618" aria-hidden="true" tabindex="-1"></a><span class="in"># View(gap_Winters)</span></span>
<span id="cb211-2619"><a href="#cb211-2619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2620"><a href="#cb211-2620" aria-hidden="true" tabindex="-1"></a><span class="in"># Interpolate the gaps in Temp_gaps</span></span>
<span id="cb211-2621"><a href="#cb211-2621" aria-hidden="true" tabindex="-1"></a><span class="in">Temp_int &lt;- interpolate_gaps(gap_Winters[, "Tmin"])</span></span>
<span id="cb211-2622"><a href="#cb211-2622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2623"><a href="#cb211-2623" aria-hidden="true" tabindex="-1"></a><span class="in"># Add interpolated Temp to the dataset</span></span>
<span id="cb211-2624"><a href="#cb211-2624" aria-hidden="true" tabindex="-1"></a><span class="in">weather_Winters &lt;- gap_Winters %&gt;% </span></span>
<span id="cb211-2625"><a href="#cb211-2625" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Temp_interpolated = Temp_int$interp,</span></span>
<span id="cb211-2626"><a href="#cb211-2626" aria-hidden="true" tabindex="-1"></a><span class="in">         Temps_interpolated = Temp_int$missing)</span></span>
<span id="cb211-2627"><a href="#cb211-2627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2628"><a href="#cb211-2628" aria-hidden="true" tabindex="-1"></a><span class="in"># View(weather_Winters)</span></span>
<span id="cb211-2629"><a href="#cb211-2629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2630"><a href="#cb211-2630" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the result</span></span>
<span id="cb211-2631"><a href="#cb211-2631" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data = weather_Winters[4:260, ], aes(Date)) +</span></span>
<span id="cb211-2632"><a href="#cb211-2632" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(aes(y = Tmin_observed, color = "Temp Observed"), lwd = 1.3) +</span></span>
<span id="cb211-2633"><a href="#cb211-2633" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(aes(y = Temp_interpolated, color = "Temp Interpolated"), lwd = 1.3) +</span></span>
<span id="cb211-2634"><a href="#cb211-2634" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(</span></span>
<span id="cb211-2635"><a href="#cb211-2635" aria-hidden="true" tabindex="-1"></a><span class="in">    values = c("Temp Observed" = "black", "Temp Interpolated" = "red"),</span></span>
<span id="cb211-2636"><a href="#cb211-2636" aria-hidden="true" tabindex="-1"></a><span class="in">    name = "Legend"</span></span>
<span id="cb211-2637"><a href="#cb211-2637" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb211-2638"><a href="#cb211-2638" aria-hidden="true" tabindex="-1"></a><span class="in">  xlab("Date") +</span></span>
<span id="cb211-2639"><a href="#cb211-2639" aria-hidden="true" tabindex="-1"></a><span class="in">  ylab("Temperature (°C)")</span></span>
<span id="cb211-2640"><a href="#cb211-2640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2641"><a href="#cb211-2641" aria-hidden="true" tabindex="-1"></a><span class="in"># In this interpolation, some daytime or nighttime cycles were missed entirely, </span></span>
<span id="cb211-2642"><a href="#cb211-2642" aria-hidden="true" tabindex="-1"></a><span class="in"># which can lead to substantial errors when calculating agroclimatic metrics, </span></span>
<span id="cb211-2643"><a href="#cb211-2643" aria-hidden="true" tabindex="-1"></a><span class="in"># such as chill or heat stress, that are of particular concern during the </span></span>
<span id="cb211-2644"><a href="#cb211-2644" aria-hidden="true" tabindex="-1"></a><span class="in"># warmest and coolest parts of the day.</span></span>
<span id="cb211-2645"><a href="#cb211-2645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2646"><a href="#cb211-2646" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-2647"><a href="#cb211-2647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2648"><a href="#cb211-2648" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-2649"><a href="#cb211-2649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2650"><a href="#cb211-2650" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`interpolate_gaps_hourly()`</span> can produce credible and continuous hourly records from a patchy dataset. It can also derive daily temperature extremes from hourly data that were recorded. Rough mode of operation:</span>
<span id="cb211-2651"><a href="#cb211-2651" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Express temperatures for each hour as a function of daily temperature extremes using the functions of <span class="co">[</span><span class="ot">Linvill (1990).</span><span class="co">](https://journals.ashs.org/hortsci/view/journals/hortsci/25/1/article-p14.xml)</span> According to this idealized curve, all hourly temperatures can be expressed as a function of <span class="in">`Tmin`</span> and <span class="in">`Tmax`</span> on the previous, same or next day of the temperature record (depending on which hour is of interest). For a day with a complete record, 24 equations can be set up.</span>
<span id="cb211-2652"><a href="#cb211-2652" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>For each daily temperature extreme, empirically solve the system of all equations that contain the respective <span class="in">`Tmin`</span> or <span class="in">`Tmax`</span> variable (this is only attempted, when a minimum of 5 equations are available, to avoid spurious results).</span>
<span id="cb211-2653"><a href="#cb211-2653" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Close gaps in the resulting dataset of daily Tmin and Tmax using data from proxy stations or, as a last resort, linear interpolation.</span>
<span id="cb211-2654"><a href="#cb211-2654" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Compute idealized temperature curves from the now continuous record of daily <span class="in">`Tmin`</span> and <span class="in">`Tmax`</span> values.</span>
<span id="cb211-2655"><a href="#cb211-2655" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Calculate the difference between recorded temperatures and this idealized curve.</span>
<span id="cb211-2656"><a href="#cb211-2656" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Linearly interpolate this difference and add then result to the idealized temperature curve.</span>
<span id="cb211-2657"><a href="#cb211-2657" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-2658"><a href="#cb211-2658" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-2659"><a href="#cb211-2659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2660"><a href="#cb211-2660" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.4a, eval=FALSE}</span></span>
<span id="cb211-2661"><a href="#cb211-2661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2662"><a href="#cb211-2662" aria-hidden="true" tabindex="-1"></a><span class="in"># See how this function works on the Winters dataset, using daily data from </span></span>
<span id="cb211-2663"><a href="#cb211-2663" aria-hidden="true" tabindex="-1"></a><span class="in"># a nearby station of the California Irrigation Management Information System </span></span>
<span id="cb211-2664"><a href="#cb211-2664" aria-hidden="true" tabindex="-1"></a><span class="in"># (CIMIS) as a proxy.  </span></span>
<span id="cb211-2665"><a href="#cb211-2665" aria-hidden="true" tabindex="-1"></a><span class="in"># Usually can't download coz of server fails to connect</span></span>
<span id="cb211-2666"><a href="#cb211-2666" aria-hidden="true" tabindex="-1"></a><span class="in">stations &lt;- handle_cimis("list_stations", # handle_cimis is similar to handle_gsod</span></span>
<span id="cb211-2667"><a href="#cb211-2667" aria-hidden="true" tabindex="-1"></a><span class="in">                         location = c(-122,38.5))</span></span>
<span id="cb211-2668"><a href="#cb211-2668" aria-hidden="true" tabindex="-1"></a><span class="in">downloaded_winters &lt;- handle_cimis("download_weather",</span></span>
<span id="cb211-2669"><a href="#cb211-2669" aria-hidden="true" tabindex="-1"></a><span class="in">                                   stations$chillR_code[2],</span></span>
<span id="cb211-2670"><a href="#cb211-2670" aria-hidden="true" tabindex="-1"></a><span class="in">                                   time_interval = c(2008,2008))</span></span>
<span id="cb211-2671"><a href="#cb211-2671" aria-hidden="true" tabindex="-1"></a><span class="in">winters_daily &lt;- handle_cimis(downloaded_winters)$weather</span></span>
<span id="cb211-2672"><a href="#cb211-2672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2673"><a href="#cb211-2673" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-2674"><a href="#cb211-2674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2675"><a href="#cb211-2675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2676"><a href="#cb211-2676" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We will use a provided dataset instead. </span>
<span id="cb211-2677"><a href="#cb211-2677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2678"><a href="#cb211-2678" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.4b}</span></span>
<span id="cb211-2679"><a href="#cb211-2679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2680"><a href="#cb211-2680" aria-hidden="true" tabindex="-1"></a><span class="in"># So, we use a ready-made dataset</span></span>
<span id="cb211-2681"><a href="#cb211-2681" aria-hidden="true" tabindex="-1"></a><span class="in">winters_daily &lt;- read.csv("data/OT/winters_daily.csv")</span></span>
<span id="cb211-2682"><a href="#cb211-2682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2683"><a href="#cb211-2683" aria-hidden="true" tabindex="-1"></a><span class="in"># View the dataset</span></span>
<span id="cb211-2684"><a href="#cb211-2684" aria-hidden="true" tabindex="-1"></a><span class="in">kable(winters_daily[1:5,]) %&gt;%</span></span>
<span id="cb211-2685"><a href="#cb211-2685" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-2686"><a href="#cb211-2686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2687"><a href="#cb211-2687" aria-hidden="true" tabindex="-1"></a><span class="in">## Use interpolate_gaps_hourly() function to patch</span></span>
<span id="cb211-2688"><a href="#cb211-2688" aria-hidden="true" tabindex="-1"></a><span class="in"># Call dataset to patch</span></span>
<span id="cb211-2689"><a href="#cb211-2689" aria-hidden="true" tabindex="-1"></a><span class="in">to_interp &lt;- Winters_hours_gaps</span></span>
<span id="cb211-2690"><a href="#cb211-2690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2691"><a href="#cb211-2691" aria-hidden="true" tabindex="-1"></a><span class="in"># Add Temp data to new Temp_recorded column</span></span>
<span id="cb211-2692"><a href="#cb211-2692" aria-hidden="true" tabindex="-1"></a><span class="in">to_interp[, "Temp_recorded"] &lt;- to_interp[, "Temp"]</span></span>
<span id="cb211-2693"><a href="#cb211-2693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2694"><a href="#cb211-2694" aria-hidden="true" tabindex="-1"></a><span class="in"># Add Temp_gaps data to the Temp column</span></span>
<span id="cb211-2695"><a href="#cb211-2695" aria-hidden="true" tabindex="-1"></a><span class="in">to_interp[, "Temp"] &lt;- to_interp[, "Temp_gaps"]</span></span>
<span id="cb211-2696"><a href="#cb211-2696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2697"><a href="#cb211-2697" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate continous hourly records</span></span>
<span id="cb211-2698"><a href="#cb211-2698" aria-hidden="true" tabindex="-1"></a><span class="in">interp &lt;- interpolate_gaps_hourly(hourtemps = to_interp, </span></span>
<span id="cb211-2699"><a href="#cb211-2699" aria-hidden="true" tabindex="-1"></a><span class="in">                                  latitude = 38.5,</span></span>
<span id="cb211-2700"><a href="#cb211-2700" aria-hidden="true" tabindex="-1"></a><span class="in">                                  daily_temps = list(Winters = winters_daily))</span></span>
<span id="cb211-2701"><a href="#cb211-2701" aria-hidden="true" tabindex="-1"></a><span class="in"># hourtemps: data.frame containing hourly temperatures. </span></span>
<span id="cb211-2702"><a href="#cb211-2702" aria-hidden="true" tabindex="-1"></a><span class="in">  # This has to contain columns c("Year","Month","Day","Hour","Temp").</span></span>
<span id="cb211-2703"><a href="#cb211-2703" aria-hidden="true" tabindex="-1"></a><span class="in"># latitude: location of interest</span></span>
<span id="cb211-2704"><a href="#cb211-2704" aria-hidden="true" tabindex="-1"></a><span class="in"># daily_temps: list of (chillR compliant) daily temperature data sets </span></span>
<span id="cb211-2705"><a href="#cb211-2705" aria-hidden="true" tabindex="-1"></a><span class="in">  # for patching gaps in the record.</span></span>
<span id="cb211-2706"><a href="#cb211-2706" aria-hidden="true" tabindex="-1"></a><span class="in"># Winters = : give name to the station, otherwise report as station_x in result</span></span>
<span id="cb211-2707"><a href="#cb211-2707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2708"><a href="#cb211-2708" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-2709"><a href="#cb211-2709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2710"><a href="#cb211-2710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2711"><a href="#cb211-2711" aria-hidden="true" tabindex="-1"></a>The resulting dataset has two elements: $weather and daily_patch_report. Let’s first look at the <span class="in">`daily_patch_report`</span> element.</span>
<span id="cb211-2712"><a href="#cb211-2712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2713"><a href="#cb211-2713" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The resulting table of the <span class="in">`daily_patch_report`</span> element contains information on </span>
<span id="cb211-2714"><a href="#cb211-2714" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>how many gaps in the daily record were filled by solving the system of hourly equations (‘solved’), </span>
<span id="cb211-2715"><a href="#cb211-2715" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>how many <span class="in">`Tmin`</span> and <span class="in">`Tmax`</span> values were derived from proxy stations (listed by name, if names were provided in the call to <span class="in">`interpolate_gaps_hourly`</span>; otherwise as station_x), </span>
<span id="cb211-2716"><a href="#cb211-2716" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>how many were filled by linear interpolation (this option can be turned off using the <span class="in">`interpolate_remaining`</span> parameter). </span>
<span id="cb211-2717"><a href="#cb211-2717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2718"><a href="#cb211-2718" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-2719"><a href="#cb211-2719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2720"><a href="#cb211-2720" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For proxy stations, it also provides the bias in mean Tmin and Tmax, which has been corrected, as well as the bias in the standard deviation of Tmin and Tmax (which was not corrected).</span>
<span id="cb211-2721"><a href="#cb211-2721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2722"><a href="#cb211-2722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2723"><a href="#cb211-2723" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.4c}</span></span>
<span id="cb211-2724"><a href="#cb211-2724" aria-hidden="true" tabindex="-1"></a><span class="in">kable(interp$daily_patch_report,</span></span>
<span id="cb211-2725"><a href="#cb211-2725" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "The element of `daily_patch_report`") %&gt;%</span></span>
<span id="cb211-2726"><a href="#cb211-2726" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-2727"><a href="#cb211-2727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2728"><a href="#cb211-2728" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-2729"><a href="#cb211-2729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2730"><a href="#cb211-2730" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-2731"><a href="#cb211-2731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2732"><a href="#cb211-2732" aria-hidden="true" tabindex="-1"></a>The <span class="in">`$weather`</span> element of the interpolation result contains the table of interpolated temperatures.</span>
<span id="cb211-2733"><a href="#cb211-2733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2734"><a href="#cb211-2734" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.4d}</span></span>
<span id="cb211-2735"><a href="#cb211-2735" aria-hidden="true" tabindex="-1"></a><span class="in"># Show only Day 6 of the dataset </span></span>
<span id="cb211-2736"><a href="#cb211-2736" aria-hidden="true" tabindex="-1"></a><span class="in">kable(interp$weather[63:86, ],</span></span>
<span id="cb211-2737"><a href="#cb211-2737" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "The element of `weather`") %&gt;%</span></span>
<span id="cb211-2738"><a href="#cb211-2738" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-2739"><a href="#cb211-2739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2740"><a href="#cb211-2740" aria-hidden="true" tabindex="-1"></a><span class="in">```</span> </span>
<span id="cb211-2741"><a href="#cb211-2741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2742"><a href="#cb211-2742" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-2743"><a href="#cb211-2743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2744"><a href="#cb211-2744" aria-hidden="true" tabindex="-1"></a>Here I will try to plot the result like in the coursebook. </span>
<span id="cb211-2745"><a href="#cb211-2745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2746"><a href="#cb211-2746" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This illustration shows that the <span class="in">`interpolate_gaps_hourly()`</span> function produced a pretty good approximation (red lines) to the actual temperatures (gray line).</span>
<span id="cb211-2747"><a href="#cb211-2747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2748"><a href="#cb211-2748" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.4e}</span></span>
<span id="cb211-2749"><a href="#cb211-2749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2750"><a href="#cb211-2750" aria-hidden="true" tabindex="-1"></a><span class="in"># Add date in chillR format</span></span>
<span id="cb211-2751"><a href="#cb211-2751" aria-hidden="true" tabindex="-1"></a><span class="in">interp_plot &lt;- add_date(interp$weather)</span></span>
<span id="cb211-2752"><a href="#cb211-2752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2753"><a href="#cb211-2753" aria-hidden="true" tabindex="-1"></a><span class="in">## Use codes from package example</span></span>
<span id="cb211-2754"><a href="#cb211-2754" aria-hidden="true" tabindex="-1"></a><span class="in"># Interpolated temperatures are shown in red, measured temperatures in black.</span></span>
<span id="cb211-2755"><a href="#cb211-2755" aria-hidden="true" tabindex="-1"></a><span class="in"># plot(interp_plot$Temp[45:320]~c(interp_plot$Date[45:320]),type="l",</span></span>
<span id="cb211-2756"><a href="#cb211-2756" aria-hidden="true" tabindex="-1"></a><span class="in">#   col="RED",lwd=2,xlab="Date",ylab="Temperature")</span></span>
<span id="cb211-2757"><a href="#cb211-2757" aria-hidden="true" tabindex="-1"></a><span class="in"># lines(interp_plot$Temp_measured[45:320]~c(interp_plot$Date[45:320]),lwd=2)</span></span>
<span id="cb211-2758"><a href="#cb211-2758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2759"><a href="#cb211-2759" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a subset of the data for the range between March 6-16</span></span>
<span id="cb211-2760"><a href="#cb211-2760" aria-hidden="true" tabindex="-1"></a><span class="in">interp_subset &lt;- interp_plot[45:320, ]</span></span>
<span id="cb211-2761"><a href="#cb211-2761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2762"><a href="#cb211-2762" aria-hidden="true" tabindex="-1"></a><span class="in"># Use ggplot </span></span>
<span id="cb211-2763"><a href="#cb211-2763" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(interp_subset, aes(x = Date)) +</span></span>
<span id="cb211-2764"><a href="#cb211-2764" aria-hidden="true" tabindex="-1"></a><span class="in">  # Add the fist line for recorded temperatures as a gray line</span></span>
<span id="cb211-2765"><a href="#cb211-2765" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(aes(y = Temp_recorded, color = "Temp Recorded"), size = 1.2) +</span></span>
<span id="cb211-2766"><a href="#cb211-2766" aria-hidden="true" tabindex="-1"></a><span class="in">  # Add the second line for interpolated temperatures as a red line</span></span>
<span id="cb211-2767"><a href="#cb211-2767" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(aes(y = Temp, color = "Temp Interpolated"), size = 1.2) +</span></span>
<span id="cb211-2768"><a href="#cb211-2768" aria-hidden="true" tabindex="-1"></a><span class="in">  # Add the third line for measured temperatures as a black line (this is choppy)</span></span>
<span id="cb211-2769"><a href="#cb211-2769" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(aes(y = Temp_measured, color = "Temp Measured"), size = 1.2) +</span></span>
<span id="cb211-2770"><a href="#cb211-2770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2771"><a href="#cb211-2771" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(</span></span>
<span id="cb211-2772"><a href="#cb211-2772" aria-hidden="true" tabindex="-1"></a><span class="in">    values = c(</span></span>
<span id="cb211-2773"><a href="#cb211-2773" aria-hidden="true" tabindex="-1"></a><span class="in">      "Temp Interpolated" = "red",</span></span>
<span id="cb211-2774"><a href="#cb211-2774" aria-hidden="true" tabindex="-1"></a><span class="in">      "Temp Measured" = "black",</span></span>
<span id="cb211-2775"><a href="#cb211-2775" aria-hidden="true" tabindex="-1"></a><span class="in">      "Temp Recorded" = "grey"</span></span>
<span id="cb211-2776"><a href="#cb211-2776" aria-hidden="true" tabindex="-1"></a><span class="in">    ),</span></span>
<span id="cb211-2777"><a href="#cb211-2777" aria-hidden="true" tabindex="-1"></a><span class="in">    name = "Legend" </span></span>
<span id="cb211-2778"><a href="#cb211-2778" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb211-2779"><a href="#cb211-2779" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb211-2780"><a href="#cb211-2780" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Date", y = "Temperature (°C)") </span></span>
<span id="cb211-2781"><a href="#cb211-2781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2782"><a href="#cb211-2782" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-2783"><a href="#cb211-2783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2784"><a href="#cb211-2784" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-2785"><a href="#cb211-2785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2786"><a href="#cb211-2786" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;11.4.1&lt;/span&gt;&amp;nbsp; Accuracy assessment</span></span>
<span id="cb211-2787"><a href="#cb211-2787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2788"><a href="#cb211-2788" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-2789"><a href="#cb211-2789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2790"><a href="#cb211-2790" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Since the actual hourly temperatures are known, the accuracy of the predictions produced by the various interpolation methods can be evaluated. </span>
<span id="cb211-2791"><a href="#cb211-2791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2792"><a href="#cb211-2792" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A common measure for validating predictions is the Root Mean Square Error of the Prediction (RMSEP).</span>
<span id="cb211-2793"><a href="#cb211-2793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2794"><a href="#cb211-2794" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-2795"><a href="#cb211-2795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2796"><a href="#cb211-2796" aria-hidden="true" tabindex="-1"></a><span class="fu">##### *Root Mean Square Error of the Prediction (RMSEP)* {.unnumbered}</span></span>
<span id="cb211-2797"><a href="#cb211-2797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2798"><a href="#cb211-2798" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-2799"><a href="#cb211-2799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2800"><a href="#cb211-2800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2801"><a href="#cb211-2801" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb211-2802"><a href="#cb211-2802" aria-hidden="true" tabindex="-1"></a>RMSEP = \sqrt{\frac{1}{n} \sum_{i=1}^{n} (y_i - \hat{y}_i)^2}</span>
<span id="cb211-2803"><a href="#cb211-2803" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb211-2804"><a href="#cb211-2804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2805"><a href="#cb211-2805" aria-hidden="true" tabindex="-1"></a>, with $\hat{y}_i$ being the observed values, $y_i$ the predicted values, and $n$ the number of values.</span>
<span id="cb211-2806"><a href="#cb211-2806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2807"><a href="#cb211-2807" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The RMSEP provides an indication of how far each predicted value deviates, on average, from the actual values.</span>
<span id="cb211-2808"><a href="#cb211-2808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2809"><a href="#cb211-2809" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It is, however, quite difficult to interpret RMSEP values alone, because whether they indicate a good or poor model fit depends on how variable the actual values are.</span>
<span id="cb211-2810"><a href="#cb211-2810" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>For instance, an RMSEP of 5 days for a phenology model (which is close to, but not quite the same as a mean error of 5 days), could indicate a very good model, if observed dates vary by several weeks or months (e.g. for bloom dates of deciduous trees), but a terrible model, if the phenological stage of interest occurs on the same day every year (e.g. the ‘phenological’ event of candles lighting up on ‘festive indoor conifers’).</span>
<span id="cb211-2811"><a href="#cb211-2811" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-2812"><a href="#cb211-2812" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-2813"><a href="#cb211-2813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2814"><a href="#cb211-2814" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This is why it makes sense to include in such accuracy assessment the variation in observed values. </span>
<span id="cb211-2815"><a href="#cb211-2815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2816"><a href="#cb211-2816" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This can be achieved by dividing the standard deviation of the observed data by the RMSEP to calculate the Residual Prediction Deviation (RPD).</span>
<span id="cb211-2817"><a href="#cb211-2817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2818"><a href="#cb211-2818" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-2819"><a href="#cb211-2819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2820"><a href="#cb211-2820" aria-hidden="true" tabindex="-1"></a><span class="fu">##### *Residual Prediction Deviation (RPD)* {.unnumbered}</span></span>
<span id="cb211-2821"><a href="#cb211-2821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2822"><a href="#cb211-2822" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-2823"><a href="#cb211-2823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2824"><a href="#cb211-2824" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb211-2825"><a href="#cb211-2825" aria-hidden="true" tabindex="-1"></a>RPD = \frac{sd_y}{RMSEP}</span>
<span id="cb211-2826"><a href="#cb211-2826" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb211-2827"><a href="#cb211-2827" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-2828"><a href="#cb211-2828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2829"><a href="#cb211-2829" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This equation contains the RMSEP as computed above as well as the standard deviation of the observed values from their mean, defined as:</span>
<span id="cb211-2830"><a href="#cb211-2830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2831"><a href="#cb211-2831" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb211-2832"><a href="#cb211-2832" aria-hidden="true" tabindex="-1"></a>sd_y = \sqrt{\frac{\sum_{i=1}^n (y_i - \bar{y})^2}{n-1}}</span>
<span id="cb211-2833"><a href="#cb211-2833" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb211-2834"><a href="#cb211-2834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2835"><a href="#cb211-2835" aria-hidden="true" tabindex="-1"></a>, with $\bar{y}$ being the mean over all observations.</span>
<span id="cb211-2836"><a href="#cb211-2836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2837"><a href="#cb211-2837" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The RPD is more useful than the RMSEP, but its use of the standard deviation can be a problem, when actual values of $y$ aren’t normally distributed (then the standard deviation can be a poor measure of variation).</span>
<span id="cb211-2838"><a href="#cb211-2838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2839"><a href="#cb211-2839" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A more robust approach is use the interquartile range instead of the standard deviation. This metric is called the Ratio of Performance to InterQuartile distance (RPIQ).</span>
<span id="cb211-2840"><a href="#cb211-2840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2841"><a href="#cb211-2841" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-2842"><a href="#cb211-2842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2843"><a href="#cb211-2843" aria-hidden="true" tabindex="-1"></a><span class="fu">##### *Ratio of Performance to InterQuartile distance (RPIQ)* {.unnumbered}</span></span>
<span id="cb211-2844"><a href="#cb211-2844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2845"><a href="#cb211-2845" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-2846"><a href="#cb211-2846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2847"><a href="#cb211-2847" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb211-2848"><a href="#cb211-2848" aria-hidden="true" tabindex="-1"></a>RPIQ = \frac{IQ}{RMSEP}</span>
<span id="cb211-2849"><a href="#cb211-2849" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb211-2850"><a href="#cb211-2850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2851"><a href="#cb211-2851" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-2852"><a href="#cb211-2852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2853"><a href="#cb211-2853" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>IQ is calculated by subtracting the 75^th^ percentile of the distribution of all $y$ from the 25^th^ percentile.</span>
<span id="cb211-2854"><a href="#cb211-2854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2855"><a href="#cb211-2855" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.4.1a}</span></span>
<span id="cb211-2856"><a href="#cb211-2856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2857"><a href="#cb211-2857" aria-hidden="true" tabindex="-1"></a><span class="in"># require(stats)</span></span>
<span id="cb211-2858"><a href="#cb211-2858" aria-hidden="true" tabindex="-1"></a><span class="in">y &lt;- rnorm(100)</span></span>
<span id="cb211-2859"><a href="#cb211-2859" aria-hidden="true" tabindex="-1"></a><span class="in">IQ &lt;- quantile(y)[4] - quantile(y)[2]</span></span>
<span id="cb211-2860"><a href="#cb211-2860" aria-hidden="true" tabindex="-1"></a><span class="in">IQ</span></span>
<span id="cb211-2861"><a href="#cb211-2861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2862"><a href="#cb211-2862" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-2863"><a href="#cb211-2863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2864"><a href="#cb211-2864" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-2865"><a href="#cb211-2865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2866"><a href="#cb211-2866" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The RPIQ score is a bit harder to evaluate than the RMSEP, with different quality thresholds in use and a very high context dependency.</span>
<span id="cb211-2867"><a href="#cb211-2867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2868"><a href="#cb211-2868" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Quite commonly, values above 2 are considered ‘good’ or even ‘excellent’, though some studies use substantially higher thresholds (up to 8 for excellence).</span>
<span id="cb211-2869"><a href="#cb211-2869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2870"><a href="#cb211-2870" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Since the RPIQ makes no assumption about the distribution of $y$, let’s use this for assessing the accuracy of the various interpolation methods. We have a total of four methods to evaluate:</span>
<span id="cb211-2871"><a href="#cb211-2871" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**idealized** temperature curves from **daily** records of `Tmin` and `Tmax`, based on records from a **nearby weather station**</span>
<span id="cb211-2872"><a href="#cb211-2872" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**idealized** temperature curves from **daily** records of `Tmin` and `Tmax`, based on records from **the same location**</span>
<span id="cb211-2873"><a href="#cb211-2873" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>**linear** interpolation of **hourly** temperatures</span>
<span id="cb211-2874"><a href="#cb211-2874" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>interpolation of **hourly** temperatures with <span class="in">`interpolate_gaps_hourly`</span></span>
<span id="cb211-2875"><a href="#cb211-2875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2876"><a href="#cb211-2876" aria-hidden="true" tabindex="-1"></a>\n</span>
<span id="cb211-2877"><a href="#cb211-2877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2878"><a href="#cb211-2878" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use the <span class="in">`make_all_day_table()`</span> function to generate a dataset of daily minimum and maximum temperatures from the hourly records for option 2. </span>
<span id="cb211-2879"><a href="#cb211-2879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2880"><a href="#cb211-2880" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.4.1b}</span></span>
<span id="cb211-2881"><a href="#cb211-2881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2882"><a href="#cb211-2882" aria-hidden="true" tabindex="-1"></a><span class="in"># Call dataset</span></span>
<span id="cb211-2883"><a href="#cb211-2883" aria-hidden="true" tabindex="-1"></a><span class="in">inter &lt;- interp$weather</span></span>
<span id="cb211-2884"><a href="#cb211-2884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2885"><a href="#cb211-2885" aria-hidden="true" tabindex="-1"></a><span class="in"># Add date column in chillR format</span></span>
<span id="cb211-2886"><a href="#cb211-2886" aria-hidden="true" tabindex="-1"></a><span class="in">inter[, "DATE"] &lt;- ISOdate(inter$Year,</span></span>
<span id="cb211-2887"><a href="#cb211-2887" aria-hidden="true" tabindex="-1"></a><span class="in">                           inter$Month,</span></span>
<span id="cb211-2888"><a href="#cb211-2888" aria-hidden="true" tabindex="-1"></a><span class="in">                           inter$Day,</span></span>
<span id="cb211-2889"><a href="#cb211-2889" aria-hidden="true" tabindex="-1"></a><span class="in">                           inter$Hour)</span></span>
<span id="cb211-2890"><a href="#cb211-2890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2891"><a href="#cb211-2891" aria-hidden="true" tabindex="-1"></a><span class="in"># Aggregate hourly records to daily Tmin, Tmean and Tmax </span></span>
<span id="cb211-2892"><a href="#cb211-2892" aria-hidden="true" tabindex="-1"></a><span class="in">orchard_extremes &lt;- make_all_day_table(inter,</span></span>
<span id="cb211-2893"><a href="#cb211-2893" aria-hidden="true" tabindex="-1"></a><span class="in">                                       timestep = "day",</span></span>
<span id="cb211-2894"><a href="#cb211-2894" aria-hidden="true" tabindex="-1"></a><span class="in">                                       input_timestep = "hour")</span></span>
<span id="cb211-2895"><a href="#cb211-2895" aria-hidden="true" tabindex="-1"></a><span class="in">kable(orchard_extremes[1:10, ]) %&gt;%</span></span>
<span id="cb211-2896"><a href="#cb211-2896" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-2897"><a href="#cb211-2897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2898"><a href="#cb211-2898" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-2899"><a href="#cb211-2899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2900"><a href="#cb211-2900" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-2901"><a href="#cb211-2901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2902"><a href="#cb211-2902" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Let’s first look at the performance of the four methods for the periods that were missing in the hourly temperature record:</span>
<span id="cb211-2903"><a href="#cb211-2903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2904"><a href="#cb211-2904" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.4.1c}</span></span>
<span id="cb211-2905"><a href="#cb211-2905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2906"><a href="#cb211-2906" aria-hidden="true" tabindex="-1"></a><span class="in"># Interpolate gaps in daily records and generate hourly temperatures</span></span>
<span id="cb211-2907"><a href="#cb211-2907" aria-hidden="true" tabindex="-1"></a><span class="in">winters_hours &lt;- stack_hourly_temps(fix_weather(winters_daily),</span></span>
<span id="cb211-2908"><a href="#cb211-2908" aria-hidden="true" tabindex="-1"></a><span class="in">                                    latitude = 38)$hourtemps</span></span>
<span id="cb211-2909"><a href="#cb211-2909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2910"><a href="#cb211-2910" aria-hidden="true" tabindex="-1"></a><span class="in"># Identify the date in winters_hours correspond to the first date of </span></span>
<span id="cb211-2911"><a href="#cb211-2911" aria-hidden="true" tabindex="-1"></a><span class="in"># missing period in inter dataset? </span></span>
<span id="cb211-2912"><a href="#cb211-2912" aria-hidden="true" tabindex="-1"></a><span class="in"># The output is 1499- row in the dataset???</span></span>
<span id="cb211-2913"><a href="#cb211-2913" aria-hidden="true" tabindex="-1"></a><span class="in">start_hour_winters &lt;- which(winters_hours$Year == head(inter$Year,1)&amp;</span></span>
<span id="cb211-2914"><a href="#cb211-2914" aria-hidden="true" tabindex="-1"></a><span class="in">                              winters_hours$Month == head(inter$Month,1)&amp;</span></span>
<span id="cb211-2915"><a href="#cb211-2915" aria-hidden="true" tabindex="-1"></a><span class="in">                              winters_hours$Day == head(inter$Day,1)&amp;</span></span>
<span id="cb211-2916"><a href="#cb211-2916" aria-hidden="true" tabindex="-1"></a><span class="in">                              winters_hours$Hour == head(inter$Hour,1))</span></span>
<span id="cb211-2917"><a href="#cb211-2917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2918"><a href="#cb211-2918" aria-hidden="true" tabindex="-1"></a><span class="in"># Identify the date in winters_hours correspond to the end date of </span></span>
<span id="cb211-2919"><a href="#cb211-2919" aria-hidden="true" tabindex="-1"></a><span class="in"># missing period in inter dataset? </span></span>
<span id="cb211-2920"><a href="#cb211-2920" aria-hidden="true" tabindex="-1"></a><span class="in"># The output is 7572- row in the dataset???</span></span>
<span id="cb211-2921"><a href="#cb211-2921" aria-hidden="true" tabindex="-1"></a><span class="in">end_hour_winters &lt;- which(winters_hours$Year == tail(inter$Year,1)&amp;</span></span>
<span id="cb211-2922"><a href="#cb211-2922" aria-hidden="true" tabindex="-1"></a><span class="in">                            winters_hours$Month == tail(inter$Month,1)&amp;</span></span>
<span id="cb211-2923"><a href="#cb211-2923" aria-hidden="true" tabindex="-1"></a><span class="in">                            winters_hours$Day == tail(inter$Day,1)&amp;</span></span>
<span id="cb211-2924"><a href="#cb211-2924" aria-hidden="true" tabindex="-1"></a><span class="in">                            winters_hours$Hour == tail(inter$Hour,1))</span></span>
<span id="cb211-2925"><a href="#cb211-2925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2926"><a href="#cb211-2926" aria-hidden="true" tabindex="-1"></a><span class="in"># Follow same process for orchard dataset?</span></span>
<span id="cb211-2927"><a href="#cb211-2927" aria-hidden="true" tabindex="-1"></a><span class="in">orchard_hours &lt;- stack_hourly_temps(orchard_extremes,</span></span>
<span id="cb211-2928"><a href="#cb211-2928" aria-hidden="true" tabindex="-1"></a><span class="in">                                    latitude = 38)$hourtemps</span></span>
<span id="cb211-2929"><a href="#cb211-2929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2930"><a href="#cb211-2930" aria-hidden="true" tabindex="-1"></a><span class="in">start_hour_orchard &lt;- which(orchard_hours$Year == head(inter$Year,1)&amp;</span></span>
<span id="cb211-2931"><a href="#cb211-2931" aria-hidden="true" tabindex="-1"></a><span class="in">                              orchard_hours$Month == head(inter$Month,1)&amp;</span></span>
<span id="cb211-2932"><a href="#cb211-2932" aria-hidden="true" tabindex="-1"></a><span class="in">                              orchard_hours$Day == head(inter$Day,1)&amp;</span></span>
<span id="cb211-2933"><a href="#cb211-2933" aria-hidden="true" tabindex="-1"></a><span class="in">                              orchard_hours$Hour == head(inter$Hour,1))</span></span>
<span id="cb211-2934"><a href="#cb211-2934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2935"><a href="#cb211-2935" aria-hidden="true" tabindex="-1"></a><span class="in">end_hour_orchard &lt;- which(orchard_hours$Year == tail(inter$Year,1)&amp;</span></span>
<span id="cb211-2936"><a href="#cb211-2936" aria-hidden="true" tabindex="-1"></a><span class="in">                            orchard_hours$Month == tail(inter$Month,1)&amp;</span></span>
<span id="cb211-2937"><a href="#cb211-2937" aria-hidden="true" tabindex="-1"></a><span class="in">                            orchard_hours$Day == tail(inter$Day,1)&amp;</span></span>
<span id="cb211-2938"><a href="#cb211-2938" aria-hidden="true" tabindex="-1"></a><span class="in">                            orchard_hours$Hour == tail(inter$Hour,1))</span></span>
<span id="cb211-2939"><a href="#cb211-2939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2940"><a href="#cb211-2940" aria-hidden="true" tabindex="-1"></a><span class="in">## Extract data for each option</span></span>
<span id="cb211-2941"><a href="#cb211-2941" aria-hidden="true" tabindex="-1"></a><span class="in"># Actual temp?</span></span>
<span id="cb211-2942"><a href="#cb211-2942" aria-hidden="true" tabindex="-1"></a><span class="in">observed &lt;- inter$Temp_recorded</span></span>
<span id="cb211-2943"><a href="#cb211-2943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2944"><a href="#cb211-2944" aria-hidden="true" tabindex="-1"></a><span class="in"># Use proxy data "winters"</span></span>
<span id="cb211-2945"><a href="#cb211-2945" aria-hidden="true" tabindex="-1"></a><span class="in">option1 &lt;- winters_hours$Temp[start_hour_winters:end_hour_winters]</span></span>
<span id="cb211-2946"><a href="#cb211-2946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2947"><a href="#cb211-2947" aria-hidden="true" tabindex="-1"></a><span class="in"># Use orchard_extremes data (same location)</span></span>
<span id="cb211-2948"><a href="#cb211-2948" aria-hidden="true" tabindex="-1"></a><span class="in">option2 &lt;- orchard_hours$Temp[start_hour_orchard:end_hour_orchard]</span></span>
<span id="cb211-2949"><a href="#cb211-2949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2950"><a href="#cb211-2950" aria-hidden="true" tabindex="-1"></a><span class="in"># Use liner interpolation</span></span>
<span id="cb211-2951"><a href="#cb211-2951" aria-hidden="true" tabindex="-1"></a><span class="in">option3 &lt;- interpolate_gaps(inter$Temp_gaps)$interp</span></span>
<span id="cb211-2952"><a href="#cb211-2952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2953"><a href="#cb211-2953" aria-hidden="true" tabindex="-1"></a><span class="in"># Use interpolate_gap_hourly() function</span></span>
<span id="cb211-2954"><a href="#cb211-2954" aria-hidden="true" tabindex="-1"></a><span class="in">option4 &lt;- inter$Temp</span></span>
<span id="cb211-2955"><a href="#cb211-2955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2956"><a href="#cb211-2956" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a data.frame for output, under two names of dataset</span></span>
<span id="cb211-2957"><a href="#cb211-2957" aria-hidden="true" tabindex="-1"></a><span class="in">eval_table &lt;- # This line might not be needed as eval_table is set again below?</span></span>
<span id="cb211-2958"><a href="#cb211-2958" aria-hidden="true" tabindex="-1"></a><span class="in">  eval_table_gaps &lt;-</span></span>
<span id="cb211-2959"><a href="#cb211-2959" aria-hidden="true" tabindex="-1"></a><span class="in">  data.frame(Option = 1:4,</span></span>
<span id="cb211-2960"><a href="#cb211-2960" aria-hidden="true" tabindex="-1"></a><span class="in">             Input_data = c("daily","daily","hourly","hourly"),</span></span>
<span id="cb211-2961"><a href="#cb211-2961" aria-hidden="true" tabindex="-1"></a><span class="in">             Interpolation_method = c("from proxy","local extremes",</span></span>
<span id="cb211-2962"><a href="#cb211-2962" aria-hidden="true" tabindex="-1"></a><span class="in">                                      "linear","hourly interpolation"),</span></span>
<span id="cb211-2963"><a href="#cb211-2963" aria-hidden="true" tabindex="-1"></a><span class="in">             RMSEP = NA,</span></span>
<span id="cb211-2964"><a href="#cb211-2964" aria-hidden="true" tabindex="-1"></a><span class="in">             RPIQ = NA)</span></span>
<span id="cb211-2965"><a href="#cb211-2965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2966"><a href="#cb211-2966" aria-hidden="true" tabindex="-1"></a><span class="in"># Extract the values in each option that correspond with the missing gaps</span></span>
<span id="cb211-2967"><a href="#cb211-2967" aria-hidden="true" tabindex="-1"></a><span class="in">observed_gaps &lt;- observed[which(is.na(inter$Temp_gaps))]</span></span>
<span id="cb211-2968"><a href="#cb211-2968" aria-hidden="true" tabindex="-1"></a><span class="in">option1_gaps &lt;- option1[which(is.na(inter$Temp_gaps))]</span></span>
<span id="cb211-2969"><a href="#cb211-2969" aria-hidden="true" tabindex="-1"></a><span class="in">option2_gaps &lt;- option2[which(is.na(inter$Temp_gaps))]</span></span>
<span id="cb211-2970"><a href="#cb211-2970" aria-hidden="true" tabindex="-1"></a><span class="in">option3_gaps &lt;- option3[which(is.na(inter$Temp_gaps))]</span></span>
<span id="cb211-2971"><a href="#cb211-2971" aria-hidden="true" tabindex="-1"></a><span class="in">option4_gaps &lt;- option4[which(is.na(inter$Temp_gaps))]</span></span>
<span id="cb211-2972"><a href="#cb211-2972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2973"><a href="#cb211-2973" aria-hidden="true" tabindex="-1"></a><span class="in"># Add result for RMSEP in the output table created above</span></span>
<span id="cb211-2974"><a href="#cb211-2974" aria-hidden="true" tabindex="-1"></a><span class="in"># Comparison between data from each option and the recorded data</span></span>
<span id="cb211-2975"><a href="#cb211-2975" aria-hidden="true" tabindex="-1"></a><span class="in">eval_table_gaps[,"RMSEP"] &lt;- round(c(RMSEP(option1_gaps, observed_gaps),</span></span>
<span id="cb211-2976"><a href="#cb211-2976" aria-hidden="true" tabindex="-1"></a><span class="in">                                     RMSEP(option2_gaps, observed_gaps),</span></span>
<span id="cb211-2977"><a href="#cb211-2977" aria-hidden="true" tabindex="-1"></a><span class="in">                                     RMSEP(option3_gaps, observed_gaps),</span></span>
<span id="cb211-2978"><a href="#cb211-2978" aria-hidden="true" tabindex="-1"></a><span class="in">                                     RMSEP(option4_gaps, observed_gaps)),</span></span>
<span id="cb211-2979"><a href="#cb211-2979" aria-hidden="true" tabindex="-1"></a><span class="in">                                   1) # round to 1 decimal point</span></span>
<span id="cb211-2980"><a href="#cb211-2980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2981"><a href="#cb211-2981" aria-hidden="true" tabindex="-1"></a><span class="in"># Add result for RPIQ in the output table created above</span></span>
<span id="cb211-2982"><a href="#cb211-2982" aria-hidden="true" tabindex="-1"></a><span class="in">eval_table_gaps[,"RPIQ"] &lt;- round(c(RPIQ(option1_gaps, observed_gaps),</span></span>
<span id="cb211-2983"><a href="#cb211-2983" aria-hidden="true" tabindex="-1"></a><span class="in">                                    RPIQ(option2_gaps, observed_gaps),</span></span>
<span id="cb211-2984"><a href="#cb211-2984" aria-hidden="true" tabindex="-1"></a><span class="in">                                    RPIQ(option3_gaps, observed_gaps),</span></span>
<span id="cb211-2985"><a href="#cb211-2985" aria-hidden="true" tabindex="-1"></a><span class="in">                                    RPIQ(option4_gaps, observed_gaps)),</span></span>
<span id="cb211-2986"><a href="#cb211-2986" aria-hidden="true" tabindex="-1"></a><span class="in">                                  1) # round to 1 decimal point</span></span>
<span id="cb211-2987"><a href="#cb211-2987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2988"><a href="#cb211-2988" aria-hidden="true" tabindex="-1"></a><span class="in"># Display the output table</span></span>
<span id="cb211-2989"><a href="#cb211-2989" aria-hidden="true" tabindex="-1"></a><span class="in">kable(eval_table_gaps) %&gt;%</span></span>
<span id="cb211-2990"><a href="#cb211-2990" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-2991"><a href="#cb211-2991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2992"><a href="#cb211-2992" aria-hidden="true" tabindex="-1"></a><span class="in"># This table shows that the interpolate_gaps_hourly function produced the </span></span>
<span id="cb211-2993"><a href="#cb211-2993" aria-hidden="true" tabindex="-1"></a><span class="in"># best results, with an RMSEP of 2 and an RPIQ of 5.4.</span></span>
<span id="cb211-2994"><a href="#cb211-2994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2995"><a href="#cb211-2995" aria-hidden="true" tabindex="-1"></a><span class="in"># Option 3, where hourly records collected in the orchard were interpolated </span></span>
<span id="cb211-2996"><a href="#cb211-2996" aria-hidden="true" tabindex="-1"></a><span class="in"># linearly, produced the worst fit. </span></span>
<span id="cb211-2997"><a href="#cb211-2997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-2998"><a href="#cb211-2998" aria-hidden="true" tabindex="-1"></a><span class="in"># This highlights that, at least in this case, using an idealized temperature </span></span>
<span id="cb211-2999"><a href="#cb211-2999" aria-hidden="true" tabindex="-1"></a><span class="in"># curve to close gaps in daily temperatures from the orchard (option 2) </span></span>
<span id="cb211-3000"><a href="#cb211-3000" aria-hidden="true" tabindex="-1"></a><span class="in"># and even from the proxy station (option 1) produced more accurate results.</span></span>
<span id="cb211-3001"><a href="#cb211-3001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3002"><a href="#cb211-3002" aria-hidden="true" tabindex="-1"></a><span class="in"># The quality of option 1 will depend on the similarity between weather at the </span></span>
<span id="cb211-3003"><a href="#cb211-3003" aria-hidden="true" tabindex="-1"></a><span class="in"># proxy station and in the orchard (in this case, this should be quite similar).</span></span>
<span id="cb211-3004"><a href="#cb211-3004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3005"><a href="#cb211-3005" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-3006"><a href="#cb211-3006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3007"><a href="#cb211-3007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3008"><a href="#cb211-3008" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Restricting the comparison to only the gaps in the record is a bit unfair, because of course records produced by option 3 (linear interpolation of hourly records from the orchard) are completely accurate for hours, when temperatures were recorded.</span>
<span id="cb211-3009"><a href="#cb211-3009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3010"><a href="#cb211-3010" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>So let’s also compare the relative performance of the four methods across all hours of the record.</span>
<span id="cb211-3011"><a href="#cb211-3011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3012"><a href="#cb211-3012" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.4.1d}</span></span>
<span id="cb211-3013"><a href="#cb211-3013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3014"><a href="#cb211-3014" aria-hidden="true" tabindex="-1"></a><span class="in"># Create data.frame for output table again</span></span>
<span id="cb211-3015"><a href="#cb211-3015" aria-hidden="true" tabindex="-1"></a><span class="in">eval_table &lt;-</span></span>
<span id="cb211-3016"><a href="#cb211-3016" aria-hidden="true" tabindex="-1"></a><span class="in">  data.frame(Option = 1:4,</span></span>
<span id="cb211-3017"><a href="#cb211-3017" aria-hidden="true" tabindex="-1"></a><span class="in">             Input_data = c("daily","daily","hourly","hourly"),</span></span>
<span id="cb211-3018"><a href="#cb211-3018" aria-hidden="true" tabindex="-1"></a><span class="in">             Interpolation_method = c("from proxy","local extremes",</span></span>
<span id="cb211-3019"><a href="#cb211-3019" aria-hidden="true" tabindex="-1"></a><span class="in">                                      "linear","hourly interpolation"),</span></span>
<span id="cb211-3020"><a href="#cb211-3020" aria-hidden="true" tabindex="-1"></a><span class="in">             RMSEP = NA,</span></span>
<span id="cb211-3021"><a href="#cb211-3021" aria-hidden="true" tabindex="-1"></a><span class="in">             RPIQ = NA)</span></span>
<span id="cb211-3022"><a href="#cb211-3022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3023"><a href="#cb211-3023" aria-hidden="true" tabindex="-1"></a><span class="in">## Comparison between whole datasets- not just the gaps</span></span>
<span id="cb211-3024"><a href="#cb211-3024" aria-hidden="true" tabindex="-1"></a><span class="in"># Add values for RMSEP </span></span>
<span id="cb211-3025"><a href="#cb211-3025" aria-hidden="true" tabindex="-1"></a><span class="in">eval_table[,"RMSEP"] &lt;- round(c(RMSEP(option1, observed),</span></span>
<span id="cb211-3026"><a href="#cb211-3026" aria-hidden="true" tabindex="-1"></a><span class="in">                                RMSEP(option2, observed),</span></span>
<span id="cb211-3027"><a href="#cb211-3027" aria-hidden="true" tabindex="-1"></a><span class="in">                                RMSEP(option3, observed),</span></span>
<span id="cb211-3028"><a href="#cb211-3028" aria-hidden="true" tabindex="-1"></a><span class="in">                                RMSEP(option4, observed)),</span></span>
<span id="cb211-3029"><a href="#cb211-3029" aria-hidden="true" tabindex="-1"></a><span class="in">                              1)</span></span>
<span id="cb211-3030"><a href="#cb211-3030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3031"><a href="#cb211-3031" aria-hidden="true" tabindex="-1"></a><span class="in"># Add values for RPIQ</span></span>
<span id="cb211-3032"><a href="#cb211-3032" aria-hidden="true" tabindex="-1"></a><span class="in">eval_table[,"RPIQ"] &lt;- round(c(RPIQ(option1, observed),</span></span>
<span id="cb211-3033"><a href="#cb211-3033" aria-hidden="true" tabindex="-1"></a><span class="in">                               RPIQ(option2, observed),</span></span>
<span id="cb211-3034"><a href="#cb211-3034" aria-hidden="true" tabindex="-1"></a><span class="in">                               RPIQ(option3, observed),</span></span>
<span id="cb211-3035"><a href="#cb211-3035" aria-hidden="true" tabindex="-1"></a><span class="in">                               RPIQ(option4, observed)),</span></span>
<span id="cb211-3036"><a href="#cb211-3036" aria-hidden="true" tabindex="-1"></a><span class="in">                             1)</span></span>
<span id="cb211-3037"><a href="#cb211-3037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3038"><a href="#cb211-3038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3039"><a href="#cb211-3039" aria-hidden="true" tabindex="-1"></a><span class="in"># Display output</span></span>
<span id="cb211-3040"><a href="#cb211-3040" aria-hidden="true" tabindex="-1"></a><span class="in">kable(eval_table) %&gt;%</span></span>
<span id="cb211-3041"><a href="#cb211-3041" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-3042"><a href="#cb211-3042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3043"><a href="#cb211-3043" aria-hidden="true" tabindex="-1"></a><span class="in"># The quality of the proxy-based idealized temperature curves went down </span></span>
<span id="cb211-3044"><a href="#cb211-3044" aria-hidden="true" tabindex="-1"></a><span class="in"># slightly, while all other approaches saw improvements in quality </span></span>
<span id="cb211-3045"><a href="#cb211-3045" aria-hidden="true" tabindex="-1"></a><span class="in"># (lower RMSEP and higher RPIQ).</span></span>
<span id="cb211-3046"><a href="#cb211-3046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3047"><a href="#cb211-3047" aria-hidden="true" tabindex="-1"></a><span class="in"># The RPIQ values for the two interpolations that were based on local data </span></span>
<span id="cb211-3048"><a href="#cb211-3048" aria-hidden="true" tabindex="-1"></a><span class="in"># (options 2 and 4) are very high, especially for option 4, which used the </span></span>
<span id="cb211-3049"><a href="#cb211-3049" aria-hidden="true" tabindex="-1"></a><span class="in"># interpolate_gaps_hourly function.</span></span>
<span id="cb211-3050"><a href="#cb211-3050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3051"><a href="#cb211-3051" aria-hidden="true" tabindex="-1"></a><span class="in"># The RPIQ score for option 4 almost exceeds the ‘excellence’ threshold for </span></span>
<span id="cb211-3052"><a href="#cb211-3052" aria-hidden="true" tabindex="-1"></a><span class="in"># the most conservative RPIQ evaluation scheme (threshold of 8). This is quite </span></span>
<span id="cb211-3053"><a href="#cb211-3053" aria-hidden="true" tabindex="-1"></a><span class="in"># remarkable, given the variable nature of daily temperature fluctuations and </span></span>
<span id="cb211-3054"><a href="#cb211-3054" aria-hidden="true" tabindex="-1"></a><span class="in"># the fact that about half of the actually recorded values were removed before </span></span>
<span id="cb211-3055"><a href="#cb211-3055" aria-hidden="true" tabindex="-1"></a><span class="in"># running the interpolation.</span></span>
<span id="cb211-3056"><a href="#cb211-3056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3057"><a href="#cb211-3057" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-3058"><a href="#cb211-3058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3059"><a href="#cb211-3059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3060"><a href="#cb211-3060" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>***In conclusion, the `interpolate_gaps_hourly` function provided a very good approximation of hourly temperatures for times when no values were recorded.***</span>
<span id="cb211-3061"><a href="#cb211-3061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3062"><a href="#cb211-3062" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-3063"><a href="#cb211-3063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3064"><a href="#cb211-3064" aria-hidden="true" tabindex="-1"></a><span class="fu">#### &lt;span style="color:#71797E"&gt;11.4.2&lt;/span&gt;&amp;nbsp; Computing agroclimatic metrics</span></span>
<span id="cb211-3065"><a href="#cb211-3065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3066"><a href="#cb211-3066" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-3067"><a href="#cb211-3067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3068"><a href="#cb211-3068" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Finally, let’s look at the implication of the choice of interpolation method on chill and heat estimates.</span>
<span id="cb211-3069"><a href="#cb211-3069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3070"><a href="#cb211-3070" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If we’re interested in using the Dynamic Model for winter chill or the Growing Degree Hours model for heat, we can simply calculate this using the <span class="in">`Dynamic_Model`</span> and <span class="in">`GDH()`</span> functions in <span class="in">`chillR`</span>.</span>
<span id="cb211-3071"><a href="#cb211-3071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3072"><a href="#cb211-3072" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For more functionality, see the <span class="in">`chilling()`</span> and particularly the <span class="in">`tempResponse()`</span> functions.</span>
<span id="cb211-3073"><a href="#cb211-3073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3074"><a href="#cb211-3074" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>First, look at the implications of method choice on chill accumulation:</span>
<span id="cb211-3075"><a href="#cb211-3075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3076"><a href="#cb211-3076" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.4.2a}</span></span>
<span id="cb211-3077"><a href="#cb211-3077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3078"><a href="#cb211-3078" aria-hidden="true" tabindex="-1"></a><span class="in"># Recall the dataset (just to make sure good knitting)</span></span>
<span id="cb211-3079"><a href="#cb211-3079" aria-hidden="true" tabindex="-1"></a><span class="in">observed &lt;- inter$Temp_recorded</span></span>
<span id="cb211-3080"><a href="#cb211-3080" aria-hidden="true" tabindex="-1"></a><span class="in">option1 &lt;- winters_hours$Temp[start_hour_winters:end_hour_winters]</span></span>
<span id="cb211-3081"><a href="#cb211-3081" aria-hidden="true" tabindex="-1"></a><span class="in">option2 &lt;- orchard_hours$Temp[start_hour_orchard:end_hour_orchard]</span></span>
<span id="cb211-3082"><a href="#cb211-3082" aria-hidden="true" tabindex="-1"></a><span class="in">option3 &lt;- interpolate_gaps(inter$Temp_gaps)$interp</span></span>
<span id="cb211-3083"><a href="#cb211-3083" aria-hidden="true" tabindex="-1"></a><span class="in">option4 &lt;- inter$Temp</span></span>
<span id="cb211-3084"><a href="#cb211-3084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3085"><a href="#cb211-3085" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a data.frame with results for each option</span></span>
<span id="cb211-3086"><a href="#cb211-3086" aria-hidden="true" tabindex="-1"></a><span class="in">all_chill &lt;- data.frame(DATE = inter$DATE,</span></span>
<span id="cb211-3087"><a href="#cb211-3087" aria-hidden="true" tabindex="-1"></a><span class="in">                        "Obs" = Dynamic_Model(observed),</span></span>
<span id="cb211-3088"><a href="#cb211-3088" aria-hidden="true" tabindex="-1"></a><span class="in">                        "Opt1" = Dynamic_Model(option1),</span></span>
<span id="cb211-3089"><a href="#cb211-3089" aria-hidden="true" tabindex="-1"></a><span class="in">                        "Opt2" = Dynamic_Model(option2),</span></span>
<span id="cb211-3090"><a href="#cb211-3090" aria-hidden="true" tabindex="-1"></a><span class="in">                        "Opt3" = Dynamic_Model(option3),</span></span>
<span id="cb211-3091"><a href="#cb211-3091" aria-hidden="true" tabindex="-1"></a><span class="in">                        "Opt4" = Dynamic_Model(option4))</span></span>
<span id="cb211-3092"><a href="#cb211-3092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3093"><a href="#cb211-3093" aria-hidden="true" tabindex="-1"></a><span class="in"># Collapse columns into rows</span></span>
<span id="cb211-3094"><a href="#cb211-3094" aria-hidden="true" tabindex="-1"></a><span class="in">all_chill &lt;- pivot_longer(all_chill, Obs:Opt4)</span></span>
<span id="cb211-3095"><a href="#cb211-3095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3096"><a href="#cb211-3096" aria-hidden="true" tabindex="-1"></a><span class="in"># Add a method column with legend names for each option</span></span>
<span id="cb211-3097"><a href="#cb211-3097" aria-hidden="true" tabindex="-1"></a><span class="in">all_chill[which(all_chill$name == "Obs"),"Method"] &lt;-</span></span>
<span id="cb211-3098"><a href="#cb211-3098" aria-hidden="true" tabindex="-1"></a><span class="in">  "Observed temperatures"</span></span>
<span id="cb211-3099"><a href="#cb211-3099" aria-hidden="true" tabindex="-1"></a><span class="in">all_chill[which(all_chill$name == "Opt1"),"Method"] &lt;-</span></span>
<span id="cb211-3100"><a href="#cb211-3100" aria-hidden="true" tabindex="-1"></a><span class="in">  "Option 1 - idealized record from proxy data"</span></span>
<span id="cb211-3101"><a href="#cb211-3101" aria-hidden="true" tabindex="-1"></a><span class="in">all_chill[which(all_chill$name == "Opt2"),"Method"] &lt;-</span></span>
<span id="cb211-3102"><a href="#cb211-3102" aria-hidden="true" tabindex="-1"></a><span class="in">  "Option 2 - idealized record from daily orchard data"</span></span>
<span id="cb211-3103"><a href="#cb211-3103" aria-hidden="true" tabindex="-1"></a><span class="in">all_chill[which(all_chill$name == "Opt3"),"Method"] &lt;-</span></span>
<span id="cb211-3104"><a href="#cb211-3104" aria-hidden="true" tabindex="-1"></a><span class="in">  "Option 3 - linear interpolation of hourly data"</span></span>
<span id="cb211-3105"><a href="#cb211-3105" aria-hidden="true" tabindex="-1"></a><span class="in">all_chill[which(all_chill$name == "Opt4"),"Method"] &lt;-</span></span>
<span id="cb211-3106"><a href="#cb211-3106" aria-hidden="true" tabindex="-1"></a><span class="in">  "Option 4 - use of interpolate_gaps_hourly"</span></span>
<span id="cb211-3107"><a href="#cb211-3107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3108"><a href="#cb211-3108" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data</span></span>
<span id="cb211-3109"><a href="#cb211-3109" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(all_chill, aes(x = DATE, y = value, colour = Method)) +</span></span>
<span id="cb211-3110"><a href="#cb211-3110" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(size = 1.2) +</span></span>
<span id="cb211-3111"><a href="#cb211-3111" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Date", y = "Chill accumulation (Chill Portions)") +</span></span>
<span id="cb211-3112"><a href="#cb211-3112" aria-hidden="true" tabindex="-1"></a><span class="in">theme(</span></span>
<span id="cb211-3113"><a href="#cb211-3113" aria-hidden="true" tabindex="-1"></a><span class="in">  legend.position = c(0.4, 0.85), </span></span>
<span id="cb211-3114"><a href="#cb211-3114" aria-hidden="true" tabindex="-1"></a><span class="in">  legend.background = element_rect(fill = "white", size = 0.2),</span></span>
<span id="cb211-3115"><a href="#cb211-3115" aria-hidden="true" tabindex="-1"></a><span class="in">  legend.text = element_text(size = 12),</span></span>
<span id="cb211-3116"><a href="#cb211-3116" aria-hidden="true" tabindex="-1"></a><span class="in">  legend.title = element_text(size = 14),</span></span>
<span id="cb211-3117"><a href="#cb211-3117" aria-hidden="true" tabindex="-1"></a><span class="in">  legend.key.size = unit(1.2, "lines")</span></span>
<span id="cb211-3118"><a href="#cb211-3118" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb211-3119"><a href="#cb211-3119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3120"><a href="#cb211-3120" aria-hidden="true" tabindex="-1"></a><span class="in">## I found another way to plot.</span></span>
<span id="cb211-3121"><a href="#cb211-3121" aria-hidden="true" tabindex="-1"></a><span class="in">## This is quite a roundabout but I will just save it here anyway.</span></span>
<span id="cb211-3122"><a href="#cb211-3122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3123"><a href="#cb211-3123" aria-hidden="true" tabindex="-1"></a><span class="in"># Create a data.frame with results for each option</span></span>
<span id="cb211-3124"><a href="#cb211-3124" aria-hidden="true" tabindex="-1"></a><span class="in"># all_chill &lt;- data.frame(DATE = inter$DATE,</span></span>
<span id="cb211-3125"><a href="#cb211-3125" aria-hidden="true" tabindex="-1"></a><span class="in">#                         "Obs" = Dynamic_Model(observed),</span></span>
<span id="cb211-3126"><a href="#cb211-3126" aria-hidden="true" tabindex="-1"></a><span class="in">#                         "Opt1" = Dynamic_Model(option1),</span></span>
<span id="cb211-3127"><a href="#cb211-3127" aria-hidden="true" tabindex="-1"></a><span class="in">#                         "Opt2" = Dynamic_Model(option2),</span></span>
<span id="cb211-3128"><a href="#cb211-3128" aria-hidden="true" tabindex="-1"></a><span class="in">#                         "Opt3" = Dynamic_Model(option3),</span></span>
<span id="cb211-3129"><a href="#cb211-3129" aria-hidden="true" tabindex="-1"></a><span class="in">#                         "Opt4" = Dynamic_Model(option4))</span></span>
<span id="cb211-3130"><a href="#cb211-3130" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb211-3131"><a href="#cb211-3131" aria-hidden="true" tabindex="-1"></a><span class="in"># The latter is not necessary but I just found out how to change names of column </span></span>
<span id="cb211-3132"><a href="#cb211-3132" aria-hidden="true" tabindex="-1"></a><span class="in"># all_chill_long &lt;- pivot_longer(all_chill, cols = Obs:Opt4, names_to = </span></span>
<span id="cb211-3133"><a href="#cb211-3133" aria-hidden="true" tabindex="-1"></a><span class="in">#                                  "Method", values_to = "Chill_Portion")</span></span>
<span id="cb211-3134"><a href="#cb211-3134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3135"><a href="#cb211-3135" aria-hidden="true" tabindex="-1"></a><span class="in"># Fill missing values for each method (ggplot gives blank plot with NA values)</span></span>
<span id="cb211-3136"><a href="#cb211-3136" aria-hidden="true" tabindex="-1"></a><span class="in"># When I first run the coursebook codes, there were NA values and I couldn't plot</span></span>
<span id="cb211-3137"><a href="#cb211-3137" aria-hidden="true" tabindex="-1"></a><span class="in"># After I filled the missing values using tidyr, I tried running the original</span></span>
<span id="cb211-3138"><a href="#cb211-3138" aria-hidden="true" tabindex="-1"></a><span class="in"># codes again and there were no NA. Don't know why but maybe this filling step</span></span>
<span id="cb211-3139"><a href="#cb211-3139" aria-hidden="true" tabindex="-1"></a><span class="in"># is not necessary. </span></span>
<span id="cb211-3140"><a href="#cb211-3140" aria-hidden="true" tabindex="-1"></a><span class="in"># all_chill_long &lt;- all_chill_long %&gt;%</span></span>
<span id="cb211-3141"><a href="#cb211-3141" aria-hidden="true" tabindex="-1"></a><span class="in">#   group_by(Method) %&gt;% # group_by to fill values separately for each method</span></span>
<span id="cb211-3142"><a href="#cb211-3142" aria-hidden="true" tabindex="-1"></a><span class="in">  # fill values in Chill_Portion using downup direction</span></span>
<span id="cb211-3143"><a href="#cb211-3143" aria-hidden="true" tabindex="-1"></a><span class="in">  # for values missing above and below within a group</span></span>
<span id="cb211-3144"><a href="#cb211-3144" aria-hidden="true" tabindex="-1"></a><span class="in">  # tidyr::fill(Chill_Portion, .direction = "downup") %&gt;%</span></span>
<span id="cb211-3145"><a href="#cb211-3145" aria-hidden="true" tabindex="-1"></a><span class="in">  # ungroup() # ungroup to return data to original data.frame</span></span>
<span id="cb211-3146"><a href="#cb211-3146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3147"><a href="#cb211-3147" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the results</span></span>
<span id="cb211-3148"><a href="#cb211-3148" aria-hidden="true" tabindex="-1"></a><span class="in"># ggplot(all_chill_long, aes(x = DATE, y = Chill_Portion, colour = Method)) +</span></span>
<span id="cb211-3149"><a href="#cb211-3149" aria-hidden="true" tabindex="-1"></a><span class="in">#   geom_line(size = 1.2) +</span></span>
<span id="cb211-3150"><a href="#cb211-3150" aria-hidden="true" tabindex="-1"></a><span class="in">#   labs(x = "Date", y = "Chill accumulation (Chill Portions)") +</span></span>
<span id="cb211-3151"><a href="#cb211-3151" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb211-3152"><a href="#cb211-3152" aria-hidden="true" tabindex="-1"></a><span class="in">#   scale_color_discrete(name = "Method", labels = </span></span>
<span id="cb211-3153"><a href="#cb211-3153" aria-hidden="true" tabindex="-1"></a><span class="in">#                            c("Observed temperatures",</span></span>
<span id="cb211-3154"><a href="#cb211-3154" aria-hidden="true" tabindex="-1"></a><span class="in">#                              "Option 1 - idealized record from proxy data", </span></span>
<span id="cb211-3155"><a href="#cb211-3155" aria-hidden="true" tabindex="-1"></a><span class="in">#                              "Option 2 - idealized record from daily orchard data",</span></span>
<span id="cb211-3156"><a href="#cb211-3156" aria-hidden="true" tabindex="-1"></a><span class="in">#                              "Option 3 - linear interpolation of hourly data",</span></span>
<span id="cb211-3157"><a href="#cb211-3157" aria-hidden="true" tabindex="-1"></a><span class="in">#                              "Option 4 - use of interpolate_gaps_hourly")) +</span></span>
<span id="cb211-3158"><a href="#cb211-3158" aria-hidden="true" tabindex="-1"></a><span class="in">#   theme(</span></span>
<span id="cb211-3159"><a href="#cb211-3159" aria-hidden="true" tabindex="-1"></a><span class="in">#     legend.position = c(0.25, 0.85), </span></span>
<span id="cb211-3160"><a href="#cb211-3160" aria-hidden="true" tabindex="-1"></a><span class="in">#     legend.background = element_rect(fill = "white", size = 0.2),</span></span>
<span id="cb211-3161"><a href="#cb211-3161" aria-hidden="true" tabindex="-1"></a><span class="in">#     legend.text = element_text(size = 18),</span></span>
<span id="cb211-3162"><a href="#cb211-3162" aria-hidden="true" tabindex="-1"></a><span class="in">#     legend.title = element_text(size = 20),</span></span>
<span id="cb211-3163"><a href="#cb211-3163" aria-hidden="true" tabindex="-1"></a><span class="in">#     legend.key.size = unit(1.2, "lines")</span></span>
<span id="cb211-3164"><a href="#cb211-3164" aria-hidden="true" tabindex="-1"></a><span class="in">#   )</span></span>
<span id="cb211-3165"><a href="#cb211-3165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3166"><a href="#cb211-3166" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-3167"><a href="#cb211-3167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3168"><a href="#cb211-3168" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This figure shows that chill accumulation differed substantially between the options. Both the use of proxy data and the use of linear interpolation of hourly temperatures led to considerable overestimation of chill accumulation.</span>
<span id="cb211-3169"><a href="#cb211-3169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3170"><a href="#cb211-3170" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Do the same assessment for heat:</span>
<span id="cb211-3171"><a href="#cb211-3171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3172"><a href="#cb211-3172" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.4.2b}</span></span>
<span id="cb211-3173"><a href="#cb211-3173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3174"><a href="#cb211-3174" aria-hidden="true" tabindex="-1"></a><span class="in">all_heat &lt;- data.frame(DATE = inter$DATE,</span></span>
<span id="cb211-3175"><a href="#cb211-3175" aria-hidden="true" tabindex="-1"></a><span class="in">                       "Obs" = GDH(observed),</span></span>
<span id="cb211-3176"><a href="#cb211-3176" aria-hidden="true" tabindex="-1"></a><span class="in">                       "Opt1" = GDH(option1),</span></span>
<span id="cb211-3177"><a href="#cb211-3177" aria-hidden="true" tabindex="-1"></a><span class="in">                       "Opt2" = GDH(option2),</span></span>
<span id="cb211-3178"><a href="#cb211-3178" aria-hidden="true" tabindex="-1"></a><span class="in">                       "Opt3" = GDH(option3),</span></span>
<span id="cb211-3179"><a href="#cb211-3179" aria-hidden="true" tabindex="-1"></a><span class="in">                       "Opt4" = GDH(option4))</span></span>
<span id="cb211-3180"><a href="#cb211-3180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3181"><a href="#cb211-3181" aria-hidden="true" tabindex="-1"></a><span class="in">all_heat &lt;- pivot_longer(all_heat, Obs:Opt4)</span></span>
<span id="cb211-3182"><a href="#cb211-3182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3183"><a href="#cb211-3183" aria-hidden="true" tabindex="-1"></a><span class="in">all_heat[which(all_heat$name == "Obs"),"Method"] &lt;-</span></span>
<span id="cb211-3184"><a href="#cb211-3184" aria-hidden="true" tabindex="-1"></a><span class="in">  "Observed temperatures"</span></span>
<span id="cb211-3185"><a href="#cb211-3185" aria-hidden="true" tabindex="-1"></a><span class="in">all_heat[which(all_heat$name == "Opt1"),"Method"] &lt;-</span></span>
<span id="cb211-3186"><a href="#cb211-3186" aria-hidden="true" tabindex="-1"></a><span class="in">  "Option 1 - idealized record from proxy data"</span></span>
<span id="cb211-3187"><a href="#cb211-3187" aria-hidden="true" tabindex="-1"></a><span class="in">all_heat[which(all_heat$name == "Opt2"),"Method"] &lt;-</span></span>
<span id="cb211-3188"><a href="#cb211-3188" aria-hidden="true" tabindex="-1"></a><span class="in">  "Option 2 - idealized record from daily orchard data"</span></span>
<span id="cb211-3189"><a href="#cb211-3189" aria-hidden="true" tabindex="-1"></a><span class="in">all_heat[which(all_heat$name == "Opt3"),"Method"] &lt;-</span></span>
<span id="cb211-3190"><a href="#cb211-3190" aria-hidden="true" tabindex="-1"></a><span class="in">  "Option 3 - linear interpolation of hourly data"</span></span>
<span id="cb211-3191"><a href="#cb211-3191" aria-hidden="true" tabindex="-1"></a><span class="in">all_heat[which(all_heat$name == "Opt4"),"Method"] &lt;-</span></span>
<span id="cb211-3192"><a href="#cb211-3192" aria-hidden="true" tabindex="-1"></a><span class="in">  "Option 4 - use of interpolate_gaps_hourly"</span></span>
<span id="cb211-3193"><a href="#cb211-3193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3194"><a href="#cb211-3194" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the data</span></span>
<span id="cb211-3195"><a href="#cb211-3195" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(all_heat, aes(x = DATE, y = value, colour = Method)) +</span></span>
<span id="cb211-3196"><a href="#cb211-3196" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(size = 1.2) +</span></span>
<span id="cb211-3197"><a href="#cb211-3197" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Date", y = "Heat accumulation (Growing Degree Hours)") +</span></span>
<span id="cb211-3198"><a href="#cb211-3198" aria-hidden="true" tabindex="-1"></a><span class="in">theme(</span></span>
<span id="cb211-3199"><a href="#cb211-3199" aria-hidden="true" tabindex="-1"></a><span class="in">  legend.position = c(0.4, 0.85), </span></span>
<span id="cb211-3200"><a href="#cb211-3200" aria-hidden="true" tabindex="-1"></a><span class="in">  legend.background = element_rect(fill = "white", size = 0.2),</span></span>
<span id="cb211-3201"><a href="#cb211-3201" aria-hidden="true" tabindex="-1"></a><span class="in">  legend.text = element_text(size = 12),</span></span>
<span id="cb211-3202"><a href="#cb211-3202" aria-hidden="true" tabindex="-1"></a><span class="in">  legend.title = element_text(size = 14),</span></span>
<span id="cb211-3203"><a href="#cb211-3203" aria-hidden="true" tabindex="-1"></a><span class="in">  legend.key.size = unit(1.2, "lines")</span></span>
<span id="cb211-3204"><a href="#cb211-3204" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb211-3205"><a href="#cb211-3205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3206"><a href="#cb211-3206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3207"><a href="#cb211-3207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3208"><a href="#cb211-3208" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-3209"><a href="#cb211-3209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3210"><a href="#cb211-3210" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-3211"><a href="#cb211-3211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3212"><a href="#cb211-3212" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This comparison doesn’t look quite as bad as for chill accumulation, but also here, option 4 clearly provided the most accurate estimate (it almost coincides with the red line, making the difference hard to see).</span>
<span id="cb211-3213"><a href="#cb211-3213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3214"><a href="#cb211-3214" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This dataset didn’t cover the winter season, so the chill numbers aren’t too meaningful, but it is nevertheless instructive to compare the total accumulation of chill and heat over the whole temperature record:</span>
<span id="cb211-3215"><a href="#cb211-3215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3216"><a href="#cb211-3216" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.4.2c}</span></span>
<span id="cb211-3217"><a href="#cb211-3217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3218"><a href="#cb211-3218" aria-hidden="true" tabindex="-1"></a><span class="in">CH_table &lt;-</span></span>
<span id="cb211-3219"><a href="#cb211-3219" aria-hidden="true" tabindex="-1"></a><span class="in">  data.frame(Option = 0:4,</span></span>
<span id="cb211-3220"><a href="#cb211-3220" aria-hidden="true" tabindex="-1"></a><span class="in">             Input_data = c("observed","daily","daily","hourly", "hourly"),</span></span>
<span id="cb211-3221"><a href="#cb211-3221" aria-hidden="true" tabindex="-1"></a><span class="in">             Interpolation_method = c("none", "from proxy","local extremes",</span></span>
<span id="cb211-3222"><a href="#cb211-3222" aria-hidden="true" tabindex="-1"></a><span class="in">                                      "linear","hourly interpolation"),</span></span>
<span id="cb211-3223"><a href="#cb211-3223" aria-hidden="true" tabindex="-1"></a><span class="in">             Chill_Portions = NA,</span></span>
<span id="cb211-3224"><a href="#cb211-3224" aria-hidden="true" tabindex="-1"></a><span class="in">             Growing_Degree_Hours= NA)</span></span>
<span id="cb211-3225"><a href="#cb211-3225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3226"><a href="#cb211-3226" aria-hidden="true" tabindex="-1"></a><span class="in">CH_table$Chill_Portions &lt;- (all_chill %&gt;% </span></span>
<span id="cb211-3227"><a href="#cb211-3227" aria-hidden="true" tabindex="-1"></a><span class="in">                          group_by(name) %&gt;%</span></span>
<span id="cb211-3228"><a href="#cb211-3228" aria-hidden="true" tabindex="-1"></a><span class="in">                         summarise(total_value = sum(value, na.rm = TRUE)) %&gt;%</span></span>
<span id="cb211-3229"><a href="#cb211-3229" aria-hidden="true" tabindex="-1"></a><span class="in">                         ungroup())$ total_value</span></span>
<span id="cb211-3230"><a href="#cb211-3230" aria-hidden="true" tabindex="-1"></a><span class="in">                              </span></span>
<span id="cb211-3231"><a href="#cb211-3231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3232"><a href="#cb211-3232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3233"><a href="#cb211-3233" aria-hidden="true" tabindex="-1"></a><span class="in">CH_table$Growing_Degree_Hours &lt;- (all_heat %&gt;% </span></span>
<span id="cb211-3234"><a href="#cb211-3234" aria-hidden="true" tabindex="-1"></a><span class="in">                          group_by(name) %&gt;%</span></span>
<span id="cb211-3235"><a href="#cb211-3235" aria-hidden="true" tabindex="-1"></a><span class="in">                         summarise(total_value = sum(value, na.rm = TRUE)) %&gt;%</span></span>
<span id="cb211-3236"><a href="#cb211-3236" aria-hidden="true" tabindex="-1"></a><span class="in">                         ungroup())$ total_value</span></span>
<span id="cb211-3237"><a href="#cb211-3237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3238"><a href="#cb211-3238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3239"><a href="#cb211-3239" aria-hidden="true" tabindex="-1"></a><span class="in">kable(CH_table) %&gt;%</span></span>
<span id="cb211-3240"><a href="#cb211-3240" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-3241"><a href="#cb211-3241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3242"><a href="#cb211-3242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3243"><a href="#cb211-3243" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-3244"><a href="#cb211-3244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3245"><a href="#cb211-3245" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-3246"><a href="#cb211-3246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3247"><a href="#cb211-3247" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This comparison shows that the choice of interpolation method can have substantial impact on our impression of accumulated chill and heat. </span>
<span id="cb211-3248"><a href="#cb211-3248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3249"><a href="#cb211-3249" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The <span class="in">`interpolate_gaps_hourly()`</span> function in <span class="in">`chillR`</span> outperformed all other methods evaluated here.</span>
<span id="cb211-3250"><a href="#cb211-3250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3251"><a href="#cb211-3251" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-3252"><a href="#cb211-3252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3253"><a href="#cb211-3253" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;11.5&lt;/span&gt;&amp;nbsp; Exercises on filling gaps</span></span>
<span id="cb211-3254"><a href="#cb211-3254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3255"><a href="#cb211-3255" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-3256"><a href="#cb211-3256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3257"><a href="#cb211-3257" aria-hidden="true" tabindex="-1"></a>*You already downloaded some weather data in the exercises for the Getting temperatures lesson. You can keep working with this.*</span>
<span id="cb211-3258"><a href="#cb211-3258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3259"><a href="#cb211-3259" aria-hidden="true" tabindex="-1"></a>***1. Use `chillR` functions to find out how many gaps you have in this dataset (even if you have none, please still follow all further steps)*** </span>
<span id="cb211-3260"><a href="#cb211-3260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3261"><a href="#cb211-3261" aria-hidden="true" tabindex="-1"></a>There are large gaps in the dataset, particularly missing data for whole years between 1992 and 2002. </span>
<span id="cb211-3262"><a href="#cb211-3262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3263"><a href="#cb211-3263" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.5.1}</span></span>
<span id="cb211-3264"><a href="#cb211-3264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3265"><a href="#cb211-3265" aria-hidden="true" tabindex="-1"></a><span class="in">MS_weather &lt;- read.csv("data/MS/STG_chillR_weather.csv")</span></span>
<span id="cb211-3266"><a href="#cb211-3266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3267"><a href="#cb211-3267" aria-hidden="true" tabindex="-1"></a><span class="in">MS_weather_gap_check &lt;- fix_weather(MS_weather)$QC</span></span>
<span id="cb211-3268"><a href="#cb211-3268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3269"><a href="#cb211-3269" aria-hidden="true" tabindex="-1"></a><span class="in">kable(MS_weather_gap_check) %&gt;%</span></span>
<span id="cb211-3270"><a href="#cb211-3270" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-3271"><a href="#cb211-3271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3272"><a href="#cb211-3272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3273"><a href="#cb211-3273" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-3274"><a href="#cb211-3274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3275"><a href="#cb211-3275" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-3276"><a href="#cb211-3276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3277"><a href="#cb211-3277" aria-hidden="true" tabindex="-1"></a>***2. Create a list of the 25 closest weather stations using the `handle_gsod` function***</span>
<span id="cb211-3278"><a href="#cb211-3278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3279"><a href="#cb211-3279" aria-hidden="true" tabindex="-1"></a>List of stations from GSOD database:</span>
<span id="cb211-3280"><a href="#cb211-3280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3281"><a href="#cb211-3281" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.5.2}</span></span>
<span id="cb211-3282"><a href="#cb211-3282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3283"><a href="#cb211-3283" aria-hidden="true" tabindex="-1"></a><span class="in"># Look for stations near M&amp;ouml;ssigen (48.40567° N, 9.05419° E)</span></span>
<span id="cb211-3284"><a href="#cb211-3284" aria-hidden="true" tabindex="-1"></a><span class="in">MS_station_list &lt;- handle_gsod(action = "list_stations",</span></span>
<span id="cb211-3285"><a href="#cb211-3285" aria-hidden="true" tabindex="-1"></a><span class="in">                               location = c(long = 9.05, lat = 48.40),</span></span>
<span id="cb211-3286"><a href="#cb211-3286" aria-hidden="true" tabindex="-1"></a><span class="in">                               time_interval = c(1990, 2020))</span></span>
<span id="cb211-3287"><a href="#cb211-3287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3288"><a href="#cb211-3288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3289"><a href="#cb211-3289" aria-hidden="true" tabindex="-1"></a><span class="in">kable(MS_station_list, </span></span>
<span id="cb211-3290"><a href="#cb211-3290" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "The 25 closet weather stations to Mössigen") %&gt;%</span></span>
<span id="cb211-3291"><a href="#cb211-3291" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-3292"><a href="#cb211-3292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3293"><a href="#cb211-3293" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-3294"><a href="#cb211-3294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3295"><a href="#cb211-3295" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-3296"><a href="#cb211-3296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3297"><a href="#cb211-3297" aria-hidden="true" tabindex="-1"></a>I tried to patch data with stations from GSOD database, using the <span class="in">`handle_gsod()`</span> function, but I could not patch the data. I think it could be problems with distance and the few overlap years<span class="dv">&amp;mdash;</span> it didn't work even when I used all stations in the list. </span>
<span id="cb211-3298"><a href="#cb211-3298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3299"><a href="#cb211-3299" aria-hidden="true" tabindex="-1"></a>So, I looked around a bit and found <span class="in">`handle_dwd()`</span> function, which draws data from the Deutscher Wetterdienst database. Since my location is in Germany, I decided to try it and it worked well. </span>
<span id="cb211-3300"><a href="#cb211-3300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3301"><a href="#cb211-3301" aria-hidden="true" tabindex="-1"></a>Here is the list of 25 closest stations using <span class="in">`handle_dwd()`</span></span>
<span id="cb211-3302"><a href="#cb211-3302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3303"><a href="#cb211-3303" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.5.2a}</span></span>
<span id="cb211-3304"><a href="#cb211-3304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3305"><a href="#cb211-3305" aria-hidden="true" tabindex="-1"></a><span class="in">MS_station_list_dwd&lt;-handle_dwd(action="list_stations",</span></span>
<span id="cb211-3306"><a href="#cb211-3306" aria-hidden="true" tabindex="-1"></a><span class="in">                                location=c(9.05, 48.40),</span></span>
<span id="cb211-3307"><a href="#cb211-3307" aria-hidden="true" tabindex="-1"></a><span class="in">                             time_interval=c(19900101,20201231))</span></span>
<span id="cb211-3308"><a href="#cb211-3308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3309"><a href="#cb211-3309" aria-hidden="true" tabindex="-1"></a><span class="in">kable(MS_station_list_dwd) %&gt;%</span></span>
<span id="cb211-3310"><a href="#cb211-3310" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-3311"><a href="#cb211-3311" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-3312"><a href="#cb211-3312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3313"><a href="#cb211-3313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3314"><a href="#cb211-3314" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-3315"><a href="#cb211-3315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3316"><a href="#cb211-3316" aria-hidden="true" tabindex="-1"></a>***3. Identify suitable weather stations for patching gaps***</span>
<span id="cb211-3317"><a href="#cb211-3317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3318"><a href="#cb211-3318" aria-hidden="true" tabindex="-1"></a>I chose the suitable weather stations based on the distance and start/end years. Here are the list of stations I chose for patching weather data:</span>
<span id="cb211-3319"><a href="#cb211-3319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3320"><a href="#cb211-3320" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.5.3}</span></span>
<span id="cb211-3321"><a href="#cb211-3321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3322"><a href="#cb211-3322" aria-hidden="true" tabindex="-1"></a><span class="in">kable(MS_station_list_dwd[c(1, 2, 4, 7),],</span></span>
<span id="cb211-3323"><a href="#cb211-3323" aria-hidden="true" tabindex="-1"></a><span class="in">  caption = "List of suitable weather stations for patching weather data") %&gt;%</span></span>
<span id="cb211-3324"><a href="#cb211-3324" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 5)</span></span>
<span id="cb211-3325"><a href="#cb211-3325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3326"><a href="#cb211-3326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3327"><a href="#cb211-3327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3328"><a href="#cb211-3328" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-3329"><a href="#cb211-3329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3330"><a href="#cb211-3330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3331"><a href="#cb211-3331" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-3332"><a href="#cb211-3332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3333"><a href="#cb211-3333" aria-hidden="true" tabindex="-1"></a>***4. Download weather data for promising stations, convert them to `chillR` format and compile them in a list***</span>
<span id="cb211-3334"><a href="#cb211-3334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3335"><a href="#cb211-3335" aria-hidden="true" tabindex="-1"></a>Unlike the <span class="in">`handle_gsod()`</span> function, there is no need to convert to <span class="in">`chillR`</span> format with an additional line of code with the <span class="in">`handle_dwd()`</span> function, as seen in the table below. </span>
<span id="cb211-3336"><a href="#cb211-3336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3337"><a href="#cb211-3337" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.5.3a}</span></span>
<span id="cb211-3338"><a href="#cb211-3338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3339"><a href="#cb211-3339" aria-hidden="true" tabindex="-1"></a><span class="in"># Download weather data for promising stations</span></span>
<span id="cb211-3340"><a href="#cb211-3340" aria-hidden="true" tabindex="-1"></a><span class="in">MS_patch_weather &lt;- handle_dwd(action = "download_weather",</span></span>
<span id="cb211-3341"><a href="#cb211-3341" aria-hidden="true" tabindex="-1"></a><span class="in">                            location = MS_station_list_dwd$Station_ID[c(2,4,7,1)])</span></span>
<span id="cb211-3342"><a href="#cb211-3342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3343"><a href="#cb211-3343" aria-hidden="true" tabindex="-1"></a><span class="in">kable(MS_patch_weather[[4]] [1:10, ]) %&gt;%</span></span>
<span id="cb211-3344"><a href="#cb211-3344" aria-hidden="true" tabindex="-1"></a><span class="in">    kable_styling("striped", position = "left", font_size = 5)</span></span>
<span id="cb211-3345"><a href="#cb211-3345" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-3346"><a href="#cb211-3346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3347"><a href="#cb211-3347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3348"><a href="#cb211-3348" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-3349"><a href="#cb211-3349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3350"><a href="#cb211-3350" aria-hidden="true" tabindex="-1"></a>***5. Use the `patch_daily_temperatures` function to fill gaps***</span>
<span id="cb211-3351"><a href="#cb211-3351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3352"><a href="#cb211-3352" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.5.5}</span></span>
<span id="cb211-3353"><a href="#cb211-3353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3354"><a href="#cb211-3354" aria-hidden="true" tabindex="-1"></a><span class="in">MS_weather &lt;- read.csv("data/MS/STG_chillR_weather.csv")</span></span>
<span id="cb211-3355"><a href="#cb211-3355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3356"><a href="#cb211-3356" aria-hidden="true" tabindex="-1"></a><span class="in">MS_patched &lt;- patch_daily_temperatures(weather = MS_weather,</span></span>
<span id="cb211-3357"><a href="#cb211-3357" aria-hidden="true" tabindex="-1"></a><span class="in">                                    patch_weather = MS_patch_weather,</span></span>
<span id="cb211-3358"><a href="#cb211-3358" aria-hidden="true" tabindex="-1"></a><span class="in">                                    max_mean_bias = 1,</span></span>
<span id="cb211-3359"><a href="#cb211-3359" aria-hidden="true" tabindex="-1"></a><span class="in">                                    max_stdev_bias = 2)</span></span>
<span id="cb211-3360"><a href="#cb211-3360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3361"><a href="#cb211-3361" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine list elements into a data.frame to display patched statistics</span></span>
<span id="cb211-3362"><a href="#cb211-3362" aria-hidden="true" tabindex="-1"></a><span class="in">patched_stats &lt;- do.call(rbind, MS_patched$statistics)  </span></span>
<span id="cb211-3363"><a href="#cb211-3363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3364"><a href="#cb211-3364" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(patched_stats, "data/MS/patched_stats.csv")</span></span>
<span id="cb211-3365"><a href="#cb211-3365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3366"><a href="#cb211-3366" aria-hidden="true" tabindex="-1"></a><span class="in">MS_patched_stats &lt;- read.csv("data/MS/patched_stats.csv")</span></span>
<span id="cb211-3367"><a href="#cb211-3367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3368"><a href="#cb211-3368" aria-hidden="true" tabindex="-1"></a><span class="in">kable(MS_patched_stats, caption = "Patched Statistics for Mössigen") %&gt;%</span></span>
<span id="cb211-3369"><a href="#cb211-3369" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-3370"><a href="#cb211-3370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3371"><a href="#cb211-3371" aria-hidden="true" tabindex="-1"></a><span class="in"># Save for later use</span></span>
<span id="cb211-3372"><a href="#cb211-3372" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(MS_patched$weather, "data/MS/MS_patched_weather.csv")</span></span>
<span id="cb211-3373"><a href="#cb211-3373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3374"><a href="#cb211-3374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3375"><a href="#cb211-3375" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-3376"><a href="#cb211-3376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3377"><a href="#cb211-3377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3378"><a href="#cb211-3378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3379"><a href="#cb211-3379" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-3380"><a href="#cb211-3380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3381"><a href="#cb211-3381" aria-hidden="true" tabindex="-1"></a>***6. Investigate the results&amp;mdash; have all gaps been filled?***</span>
<span id="cb211-3382"><a href="#cb211-3382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3383"><a href="#cb211-3383" aria-hidden="true" tabindex="-1"></a>All gaps have been filled as shown in the table. </span>
<span id="cb211-3384"><a href="#cb211-3384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3385"><a href="#cb211-3385" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 11.5.6}</span></span>
<span id="cb211-3386"><a href="#cb211-3386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3387"><a href="#cb211-3387" aria-hidden="true" tabindex="-1"></a><span class="in">MS_QC &lt;- fix_weather(MS_patched)$QC</span></span>
<span id="cb211-3388"><a href="#cb211-3388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3389"><a href="#cb211-3389" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(MS_QC,"data/MS/MS_QC.csv")</span></span>
<span id="cb211-3390"><a href="#cb211-3390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3391"><a href="#cb211-3391" aria-hidden="true" tabindex="-1"></a><span class="in">MS_patched_QC &lt;- read.csv("data/MS/MS_QC.csv")</span></span>
<span id="cb211-3392"><a href="#cb211-3392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3393"><a href="#cb211-3393" aria-hidden="true" tabindex="-1"></a><span class="in">kable(MS_patched_QC,</span></span>
<span id="cb211-3394"><a href="#cb211-3394" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Check gaps on patched weather dataset for Mössigen") %&gt;%</span></span>
<span id="cb211-3395"><a href="#cb211-3395" aria-hidden="true" tabindex="-1"></a><span class="in">  kable_styling("striped", position = "left", font_size = 10)</span></span>
<span id="cb211-3396"><a href="#cb211-3396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3397"><a href="#cb211-3397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3398"><a href="#cb211-3398" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb211-3399"><a href="#cb211-3399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3400"><a href="#cb211-3400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3401"><a href="#cb211-3401" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-3402"><a href="#cb211-3402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3403"><a href="#cb211-3403" aria-hidden="true" tabindex="-1"></a>***7. If necessary, repeat until you have a dataset you can work with in further analyses***</span>
<span id="cb211-3404"><a href="#cb211-3404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3405"><a href="#cb211-3405" aria-hidden="true" tabindex="-1"></a>I did repeat the process till I got the most suitable stations (in my opinion). The <span class="in">`handle_dwd()`</span> ran faster than the <span class="in">`handle_gsod()`</span>, so I could download all 25 stations within a few seconds. I downloaded all and check the statistics afterwards to see which stations filled the gaps. I initially chose the stations based on distance and overlap years, but then, I thought why not try all and see how it went?</span>
<span id="cb211-3406"><a href="#cb211-3406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3407"><a href="#cb211-3407" aria-hidden="true" tabindex="-1"></a>This is what I found:</span>
<span id="cb211-3408"><a href="#cb211-3408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3409"><a href="#cb211-3409" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The order to download the stations matters.</span>
<span id="cb211-3410"><a href="#cb211-3410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3411"><a href="#cb211-3411" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>At first, I found station 1 is the best choice<span class="dv">&amp;mdash;</span> closest in distance and it filled all the gaps if I didn't set threshold for <span class="in">`max_mean_bias`</span> and <span class="in">`max_stdev_bias`</span>. So, only one station would have been needed to patch all the gaps if I didn't mind <span class="in">`max_mean_bias`</span> values of a few decimal points above 1. (Why one though?) </span>
<span id="cb211-3412"><a href="#cb211-3412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3413"><a href="#cb211-3413" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When I set those bias values, the station 1 could fill all gaps for <span class="in">`Tmin`</span> but fill none for <span class="in">`Tmax`</span>. Since it filled all gaps in <span class="in">`Tmin`</span>, I think the program assumed that all gaps were filled (maybe the program consider <span class="in">`Tmin`</span> and <span class="in">`Tmax`</span> together?) and it would give <span class="in">`NA`</span> values for all remaining stations I downloaded. </span>
<span id="cb211-3414"><a href="#cb211-3414" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb211-3415"><a href="#cb211-3415" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Since I want the dataset to be patched with values below the bias thresholds, I downloaded the station 1 last (<span class="in">`MS_station_list_dwd$Station_ID[c(2,4,7,1)]`</span>), and it worked perfectly! </span>
<span id="cb211-3416"><a href="#cb211-3416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3417"><a href="#cb211-3417" aria-hidden="true" tabindex="-1"></a>Another thing I want to add here is I selected the best station from the list generated from the GSOD database, and patched that station with data from DWD database. Practically, I should have chosen the station 1 from the DWD list<span class="dv">&amp;mdash;</span> I wouldn't have any gaps and it would have been a better choice in terms of data quality. But, for the sake of doing the following exercises, I must either create gaps or use the station I chose from GSOD database. I chose the latter option because there might be times I could not go back to the past and redo everything<span class="dv">&amp;mdash;</span> I guess it is a better practice to adapt and keep going.</span>
<span id="cb211-3418"><a href="#cb211-3418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3419"><a href="#cb211-3419" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-3420"><a href="#cb211-3420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3421"><a href="#cb211-3421" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 12: Generating temperature scenarios</span></span>
<span id="cb211-3422"><a href="#cb211-3422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3423"><a href="#cb211-3423" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;12.1&lt;/span&gt;&amp;nbsp; Chill scenarios</span></span>
<span id="cb211-3424"><a href="#cb211-3424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3425"><a href="#cb211-3425" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-3426"><a href="#cb211-3426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3427"><a href="#cb211-3427" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Information on chill availability (or other agroclimatic conditions) at a given site is crucial for orchard managers selecting tree species and cultivars for their orchards.</span>
<span id="cb211-3428"><a href="#cb211-3428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3429"><a href="#cb211-3429" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Looking at the historic record has already given us a lot of useful information, but this isn’t yet exactly the information that a grower making planting decisions needs. </span>
<span id="cb211-3430"><a href="#cb211-3430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3431"><a href="#cb211-3431" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>What is really needed is a site-specific agroclimatic characterization that provides an impression of the range of conditions that we can reasonably expect at this location, i.e. how likely it is for the orchard to experience certain levels of chill, heat or whatever other metric we are interested in.</span>
<span id="cb211-3432"><a href="#cb211-3432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3433"><a href="#cb211-3433" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb211-3434"><a href="#cb211-3434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3435"><a href="#cb211-3435" aria-hidden="true" tabindex="-1"></a><span class="fu">### &lt;span style="color:#71797E"&gt;12.2&lt;/span&gt;&amp;nbsp; Risk assessment in orchard planning</span></span>
<span id="cb211-3436"><a href="#cb211-3436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3437"><a href="#cb211-3437" aria-hidden="true" tabindex="-1"></a>&lt;div style="height: 18px;"&gt;&lt;/div&gt;</span>
<span id="cb211-3438"><a href="#cb211-3438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3439"><a href="#cb211-3439" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Since trees live and are (hopefully) productive for many years, they experience many different temperature dynamics during their productive lifetime.</span>
<span id="cb211-3440"><a href="#cb211-3440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3441"><a href="#cb211-3441" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For optimal production, trees should fulfill their climatic needs in all of these years.</span>
<span id="cb211-3442"><a href="#cb211-3442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3443"><a href="#cb211-3443" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This is why, when we select trees for planting, we need information on the plausible range of ‘weathers’ we can expect. </span>
<span id="cb211-3444"><a href="#cb211-3444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3445"><a href="#cb211-3445" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Based on this, we would be able to select trees that safely fulfill their chilling requirements in all plausible weather situations, or we could choose trees that strike a balance between early flowering and the risk of spring frost. </span>
<span id="cb211-3446"><a href="#cb211-3446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3447"><a href="#cb211-3447" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>All such decisions require information on how likely it is for our orchard to experience certain conditions.</span>
<span id="cb211-3448"><a href="#cb211-3448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3449"><a href="#cb211-3449" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The plausible range of ‘weathers’ we can expect is defined by the local climate, which is the long-term average of the annually observed weather. </span>
<span id="cb211-3450"><a href="#cb211-3450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3451"><a href="#cb211-3451" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We can interpret this ‘climate’ as a virtual collection of all possible weather situations for a given location, from which we receive one random draw each year.</span>
<span id="cb211-3452"><a href="#cb211-3452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3453"><a href="#cb211-3453" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Annual weather can be interpreted as a random draw from the plausible distribution of all possible ‘weathers’.</span>
<span id="cb211-3454"><a href="#cb211-3454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3455"><a href="#cb211-3455" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For planning purposes, it would be much more useful to know this virtual distribution of possible ‘weathers’ than just looking at the random samples that happened to be drawn.</span>
<span id="cb211-3456"><a href="#cb211-3456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3457"><a href="#cb211-3457" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>So far, we’ve only been able to get these samples - that was the historic analysis of observed chill.</span>
<span id="cb211-3458"><a href="#cb211-3458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3459"><a href="#cb211-3459" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We’ll try to get to the actual climate, and from there to ways to use this knowledge for producing temperature profiles for locations of interest that facilitate orchard planning.</span>
<span id="cb211-3460"><a href="#cb211-3460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3461"><a href="#cb211-3461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3462"><a href="#cb211-3462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3463"><a href="#cb211-3463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3464"><a href="#cb211-3464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3465"><a href="#cb211-3465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3466"><a href="#cb211-3466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3467"><a href="#cb211-3467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3468"><a href="#cb211-3468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3469"><a href="#cb211-3469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3470"><a href="#cb211-3470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3471"><a href="#cb211-3471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3472"><a href="#cb211-3472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3473"><a href="#cb211-3473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3474"><a href="#cb211-3474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3475"><a href="#cb211-3475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3476"><a href="#cb211-3476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3477"><a href="#cb211-3477" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb211-3478"><a href="#cb211-3478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3479"><a href="#cb211-3479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3480"><a href="#cb211-3480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3481"><a href="#cb211-3481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3482"><a href="#cb211-3482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3483"><a href="#cb211-3483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3484"><a href="#cb211-3484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3485"><a href="#cb211-3485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3486"><a href="#cb211-3486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3487"><a href="#cb211-3487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3488"><a href="#cb211-3488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3489"><a href="#cb211-3489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3490"><a href="#cb211-3490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3491"><a href="#cb211-3491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3492"><a href="#cb211-3492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3493"><a href="#cb211-3493" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-3494"><a href="#cb211-3494" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-3495"><a href="#cb211-3495" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-3496"><a href="#cb211-3496" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb211-3497"><a href="#cb211-3497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3498"><a href="#cb211-3498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3499"><a href="#cb211-3499" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



<script src="Tree_Phenology_Analysis_in_R_Logbook_files/libs/quarto-html/zenscroll-min.js"></script>
</body></html>